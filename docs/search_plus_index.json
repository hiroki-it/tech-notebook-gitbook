{"./":{"url":"./","title":"ğŸ“– ï¸ã“ã®ã‚µã‚¤ãƒˆã«ã¤ã„ã¦","keywords":"","body":"ã“ã®ã‚µã‚¤ãƒˆã«ã¤ã„ã¦ ã‚µã‚¤ãƒˆã®ä½œæˆæ–¹æ³• GitBookã‚’ä½¿ç”¨ã—ã¦ï¼Œmdãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰HTMLã‚’ç”Ÿæˆã—ã¦ãŠã‚Šã¾ã™ï¼ ç”Ÿæˆå…ƒã®mdãƒ•ã‚¡ã‚¤ãƒ«ã¯ï¼Œhiroki-it/tech-notebook-gitbook ãƒªãƒã‚¸ãƒˆãƒªã«ã¦ç®¡ç†ã—ã¦ãŠã‚Šã¾ã™ï¼ ä½¿ã„æ–¹ æ¤œç´¢ã‹ã‚‰ ã‚¹ãƒãƒ›ã§ã¯ãªãï¼ŒPCã§ä½¿ç”¨ã—ã¾ã™ï¼ ç”»é¢å·¦ä¸Šã®æ¤œç´¢ãƒ•ã‚©ãƒ¼ãƒ ã‹ã‚‰ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã‚’æ¤œç´¢ã—ã¾ã™ï¼ æ¤œç´¢çµæœãŒè¤‡æ•°ã®ãƒãƒ¼ãƒˆã«ã¾ãŸãŒã‚‹å ´åˆï¼Œãƒãƒ¼ãƒˆã®ã‚¿ã‚¤ãƒˆãƒ«ã‚’å…ƒã«ï¼Œå‚ç…§ã™ã‚‹ã¹ããƒãƒ¼ãƒˆã‚’åˆ¤æ–­ã—ã¾ã™ï¼ ãƒãƒ¼ãƒˆã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¾ã™ï¼ æ¤œç´¢çµæœã‹ã‚‰ã¯ï¼Œãƒãƒ¼ãƒˆå†…ã§ä¸€ç•ªæœ€åˆã«å‡ºç¾ã—ãŸã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã«ã—ã‹ã‚¸ãƒ£ãƒ³ãƒ—ã§ãã¾ã›ã‚“ï¼ãã®ãŸã‚ï¼Œãƒ–ãƒ©ã‚¦ã‚¶ã®ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰æ©Ÿèƒ½ã‚’ä½¿ç”¨ã—ã¦ï¼Œãƒãƒ¼ãƒˆå†…ã§æ”¹ã‚ã¦ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã‚’æ¤œç´¢ã—ã¾ã™ï¼ ç›®æ¬¡ã‹ã‚‰ ã‚¹ãƒãƒ›ã§ã¯ãªãï¼ŒPCã§ä½¿ç”¨ã—ã¾ã™ï¼ ç›®æ¬¡ãƒšãƒ¼ã‚¸ ã‚’ç¢ºèªã—ã¾ã™ï¼ ãƒãƒ¼ãƒˆã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¾ã™ï¼ ã‚µã‚¤ãƒˆã®ç›®çš„ ã©ã“ã«ã§ã‚‚ã„ã‚‹ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ã® é•·è°·å·åºƒæ¨¹ ãŒï¼Œä»¥ä¸‹ã®ç›®çš„ã®ãŸã‚ã«ä½¿ç”¨ã—ã¦ã„ã¾ã™ï¼ ã‚¤ãƒ³ãƒ—ãƒƒãƒˆã—ãŸã“ã¨ã‚’è‡ªåˆ†ã®è¨€è‘‰ã§æ›¸ãï¼Œã‚¢ã‚¦ãƒˆãƒ—ãƒƒãƒˆã‚’è¡Œã†ï¼ èª¤ã£ãŸçŸ¥è­˜ã‚’ãã®éƒ½åº¦ä¿®æ­£ã—ï¼Œã¾ãŸä½“ç³»çš„ã«æ•´ç†ã™ã‚‹ï¼ ã‚¤ãƒ³ãƒ—ãƒƒãƒˆã—ãŸå†…å®¹ã‚’æ€ã„å‡ºã™ãŸã‚ã«é–²è¦§ã™ã‚‹ï¼ ãã®ãŸã‚ï¼Œèª¤ã£ãŸæƒ…å ±ï¼Œèª¤ã£ãŸä½“ç³»åŒ–ï¼Œã‚ã‹ã‚Šã«ãã„æ—¥æœ¬èªï¼ŒãŒå¤šãæ•£è¦‹ã•ã‚Œã‚‹ã¨æ€ã„ã¾ã™ï¼ ã“ã‚Œã‚‰ã«ã¤ãã¾ã—ã¦ã¯ï¼Œã”å®¹èµ¦ã„ãŸã ã‘ã‚‹ã¨å¹¸ã„ã§ã™ï¼ å­¦ç¿’æ–¹æ³• æœ¬ã‚µã‚¤ãƒˆã§ã¯ï¼Œä»¥ä¸‹ã‚’è¨˜è¼‰ã—ï¼Œãã®æ¦‚å¿µã‚’å­¦ç¿’ã™ã‚‹ã‚ˆã†ã«ã—ã¦ãŠã‚Šã¾ã™ï¼ å®šç¾©ã¥ã‘ï¼ˆæ¼”ç¹¹çš„ãªå­¦ç¿’ï¼‰ ä¾‹ï¼ˆå¸°ç´çš„ãªå­¦ç¿’ï¼‰ æ¦‚å¿µå›³ï¼ˆè¦–è¦šå„ªä½ãªå­¦ç¿’ï¼‰ ãã®ãŸã‚ï¼Œå†—é•·ãªè¨˜è¼‰ã¨ãªã‚‹ã“ã¨ã‚’ã”å®¹èµ¦ã„ãŸã ã‘ã‚‹ã¨å¹¸ã„ã§ã™ï¼ ãŠã‚ã³ ã“ã®ã‚µã‚¤ãƒˆã§ä½¿ã‚ã‚Œã¦ã„ã‚‹èª¬æ˜ã‚„ç”»åƒã«ã¤ãã¾ã—ã¦ï¼Œæ§˜ã€…ãªæ›¸ç±ã‚„ã‚µã‚¤ãƒˆã‹ã‚‰å¼•ç”¨ã•ã›ã¦ã„ãŸã ã„ã¦ãŠã‚Šã¾ã™ï¼ ã‚ãã¾ã§ï¼Œä¸Šè¨˜ã®ç›®çš„ã®ãŸã‚ã ã‘ã«ä½¿ç”¨ã•ã›ã¦ã„ãŸã ãã¨ã„ã†åç›®ã§ï¼Œå¼•ç”¨å…ƒã‚’ååˆ†ã«è¨˜è¼‰ã—ã¦ãŠã‚Šã¾ã›ã‚“ï¼ æ·±ããŠè©«ã³ç”³ã—ä¸Šã’ã¾ã™ï¼ "},"public/self_introduction.html":{"url":"public/self_introduction.html","title":"ğŸ“– ï¸ã‚µã‚¤ãƒˆç®¡ç†è€…","keywords":"","body":"ã‚µã‚¤ãƒˆç®¡ç†è€… çµŒæ­´ é•·è°·å·åºƒæ¨¹ã¨ç”³ã—ã¾ã™ï¼ 2019å¹´ã«ç†å­¦ä¿®å£«ã‚’ç¿’å¾—ã—ï¼Œå¤§å­¦é™¢ã‚’å’æ¥­å¾Œï¼Œãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ ã¨ã—ã¦ã‚­ãƒ£ãƒªã‚¢ã‚’ã‚¹ã‚¿ãƒ¼ãƒˆã„ãŸã—ã¾ã—ãŸï¼ ç¾åœ¨ã¯ï¼ŒSRE ã¨ã—ã¦åƒã‹ã•ã›ã¦ã„ãŸã ã„ã¦ãŠã‚Šã¾ã™ï¼ è©³ã—ãã¯ï¼Œä»¥ä¸‹ã®ãƒªãƒ³ã‚¯ã¾ã§ã”è¨ªå•ã„ãŸã ã‘ã‚‹ã¨å¹¸ã„ã§ã™ï¼ â–¶ GitHubï¼šhttps://github.com/hiroki-it â–¶ Wantedlyï¼šhttps://www.wantedly.com/id/h_hasegawa â–¶ Speaker Deckï¼šhttps://speakerdeck.com/hiroki_hasegawa é–¢å¿ƒã®ã‚ã‚‹æŠ€è¡“é ˜åŸŸ æ‹¡å¼µæ€§ï¼Œä¿å®ˆæ€§ï¼Œå¯èª­æ€§ã‚’é«˜ã‚ã‚‹æŠ€è¡“ã«é–¢å¿ƒãŒã”ã–ã„ã¾ã™ï¼ DDDï¼Œå‡é›†åº¦ã¨çµåˆåº¦ï¼Œã‚¯ãƒ©ã‚¦ãƒ‰ã‚¤ãƒ³ãƒ•ãƒ©ï¼ŒIaCï¼Œã‚³ãƒ³ãƒ†ãƒŠï¼ŒCI/CDï¼ŒGoï¼Œetc... "},"public/summary.html":{"url":"public/summary.html","title":"ğŸ“– ï¸ç›®æ¬¡","keywords":"","body":"ç›®æ¬¡ ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ &#x1F4D6; ï¸ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ åŸºæœ¬ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ï¼ˆOSï¼‰ &#x1F4D6; ï¸ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ &#x1F4D6; ï¸ã‚«ãƒ¼ãƒãƒ« è¨€èªãƒ—ãƒ­ã‚»ãƒƒã‚µ &#x1F4D6; ï¸è¨€èªãƒ—ãƒ­ã‚»ãƒƒã‚µ &#x1F4D6; ï¸è¨€èªåˆ¥ã®å‡¦ç†æ–¹å¼ &#x1F4D6; ï¸æ©Ÿæ¢°èªã¨é€²æ•° ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢ Webé–¢é€£ &#x1F4D6; ï¸Nginx &#x1F4D6; ï¸Apache ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³é–¢é€£ &#x1F4D6; ï¸PHP-FPM ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹é–¢é€£ &#x1F4D6; ï¸ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ &#x1F4D6; Myï¸SQL ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ &#x1F4D6; ï¸ãƒã‚¤ã‚¯ãƒ­ã‚µãƒ¼ãƒ“ã‚¹ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ &#x1F4D6; ï¸ãƒ‰ãƒ¡ã‚¤ãƒ³é§†å‹•è¨­è¨ˆ &#x1F4D6; ï¸ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ &#x1F4D6; ï¸CQRS ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ &#x1F4D6; ï¸ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³é–“é€£æº &#x1F4D6; ï¸JSON &#x1F4D6; ï¸ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³é–“é€šä¿¡ &#x1F4D6; ï¸èªè¨¼ï¼èªå¯ RESTful-API &#x1F4D6; ï¸RESTful-API &#x1F4D6; ï¸APIä»•æ§˜æ›¸ ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ PHP &#x1F4D6; PHPã‚³ãƒãƒ³ãƒ‰ã¨è¨­å®š ã‚¯ãƒ©ã‚¹ãƒ™ãƒ¼ã‚¹ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆæŒ‡å‘ &#x1F4D6; ï¸ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆæŒ‡å‘åˆ†æï¼è¨­è¨ˆï¼ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚° &#x1F4D6; ï¸ã‚¯ãƒ©ã‚¹ &#x1F4D6; ï¸ãƒ¡ã‚½ãƒƒãƒ‰ï¼ãƒ‡ãƒ¼ã‚¿ &#x1F4D6; ï¸ãƒ‡ãƒ¼ã‚¿æ§‹é€  ãƒ­ã‚¸ãƒƒã‚¯ &#x1F4D6; ï¸æ¤œè¨¼ãƒ­ã‚¸ãƒƒã‚¯ &#x1F4D6; ï¸ã‚¨ãƒ©ãƒ¼ã¨ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚° &#x1F4D6; ï¸åå¾©ãƒ­ã‚¸ãƒƒã‚¯ &#x1F4D6; ï¸ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ  ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ &#x1F4D6; ï¸Symfony &#x1F4D6; ï¸Laravel ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ &#x1F4D6; ï¸ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ç®¡ç† &#x1F4D6; ï¸MySQLãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ &#x1F4D6; ï¸ãã®ä»–ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ ãƒ†ã‚¹ãƒˆ &#x1F4D6; ï¸ãƒ†ã‚¹ãƒˆ &#x1F4D6; ï¸ã‚³ãƒ¼ãƒ‰ãƒ™ãƒ¼ã‚¹ã®ãƒ†ã‚¹ãƒˆ &#x1F4D6; ï¸ãƒ†ã‚¹ãƒˆä»•æ§˜æ›¸ãƒ™ãƒ¼ã‚¹ã®ãƒ†ã‚¹ãƒˆ ãƒ‡ãƒãƒƒã‚° &#x1F4D6; ï¸ãƒ‡ãƒãƒƒã‚° Go &#x1F4D6; Goã¨ã¯ &#x1F4D6; Goã‚³ãƒãƒ³ãƒ‰ã¨è¨­å®š ãƒ­ã‚¸ãƒƒã‚¯ &#x1F4D6; ãƒ¡ã‚½ãƒƒãƒ‰ï¼Œãƒ‡ãƒ¼ã‚¿ ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ï¼ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ &#x1F4D6; ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ &#x1F4D6; Gin ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ JavaScript ãƒ—ãƒ­ãƒˆã‚¿ã‚¤ãƒ—ãƒ™ãƒ¼ã‚¹ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆæŒ‡å‘ &#x1F4D6; ï¸ãƒ—ãƒ­ãƒˆã‚¿ã‚¤ãƒ— &#x1F4D6; ï¸ãƒ¡ã‚½ãƒƒãƒ‰ï¼ãƒ‡ãƒ¼ã‚¿ ãƒ­ã‚¸ãƒƒã‚¯ &#x1F4D6; ï¸æ¤œè¨¼ãƒ­ã‚¸ãƒƒã‚¯ &#x1F4D6; ï¸éåŒæœŸå‡¦ç†ãƒ­ã‚¸ãƒƒã‚¯ ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ï¼ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ &#x1F4D6; ï¸ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ &#x1F4D6; ï¸Vue.js &#x1F4D6; ï¸Nuxt.js ãƒ‡ãƒãƒƒã‚° &#x1F4D6; ï¸ãƒ‡ãƒãƒƒã‚° ãƒ–ãƒ©ã‚¦ã‚¶ &#x1F4D6; ï¸ãƒ–ãƒ©ã‚¦ã‚¶ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚° ãƒãƒ¼ãƒ‰ã‚¦ã‚§ã‚¢ &#x1F4D6; ï¸ãƒãƒ¼ãƒ‰ã‚¦ã‚§ã‚¢ &#x1F4D6; ï¸ãƒ¡ãƒ¢ãƒª &#x1F4D6; ï¸çµ„ã¿è¾¼ã¿æ©Ÿå™¨ ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ &#x1F4D6; ï¸ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ ãƒ‡ãƒ¼ã‚¿é€šä¿¡ã®ä»•çµ„ã¿ &#x1F4D6; ï¸OSIå‚ç…§ãƒ¢ãƒ‡ãƒ«ï¼TCPéšå±¤ãƒ¢ãƒ‡ãƒ« ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ &#x1F4D6; ï¸ã‚µã‚¤ãƒãƒ¼æ”»æ’ƒ &#x1F4D6; ï¸é€šä¿¡ãƒ‡ãƒ¼ã‚¿ã®æš—å·åŒ–æŠ€è¡“ ã‚¯ãƒ©ã‚¦ãƒ‰ã‚³ãƒ³ãƒ”ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚° &#x1F4D6; ï¸ã‚¯ãƒ©ã‚¦ãƒ‰ã‚³ãƒ³ãƒ”ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚° AWS &#x1F4D6; ï¸AWS &#x1F4D6; ï¸API Gatewayã¸ã®ymlã‚¤ãƒ³ãƒãƒ¼ãƒˆ &#x1F4D6; ï¸Lambdaé–¢æ•°ã®å®Ÿè£… &#x1F4D6; ï¸ã‚³ã‚¹ãƒˆç®¡ç† GCP &#x1F4D6; ï¸GCP Infrastructure as Code &#x1F4D6; ï¸Infrastructure as Code Terraform &#x1F4D6; ï¸Terraform &#x1F4D6; ï¸Terraformã‚’ç”¨ã„ãŸAWSæ§‹ç¯‰Tips &#x1F4D6; ï¸Terraformã®CICDãƒ•ãƒ­ãƒ¼ ä»®æƒ³åŒ– &#x1F4D6; ï¸ä»®æƒ³åŒ– ã‚³ãƒ³ãƒ†ãƒŠ Docker &#x1F4D6; ï¸dockerã‚³ãƒãƒ³ãƒ‰ &#x1F4D6; ï¸Dockerfile ã‚³ãƒ³ãƒ†ãƒŠã‚ªãƒ¼ã‚±ã‚¹ãƒˆãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ &#x1F4D6; ï¸ã‚³ãƒ³ãƒ†ãƒŠã‚ªãƒ¼ã‚±ã‚¹ãƒˆãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ Docker Compose &#x1F4D6; ï¸docker-composeã‚³ãƒãƒ³ãƒ‰ &#x1F4D6; ï¸docker-compose.yml &#x1F4D6; ï¸Kubernetes &#x1F4D6; ï¸Docker Swarm ï¸ä»®æƒ³ã‚µãƒ¼ãƒï¼ˆä»®æƒ³ãƒã‚·ãƒ³ï¼‰ &#x1F4D6; ï¸ä»®æƒ³ã‚µãƒ¼ãƒï¼ˆä»®æƒ³ãƒã‚·ãƒ³ï¼‰ CICD &#x1F4D6; ï¸CICD &#x1F4D6; ï¸CircleCI &#x1F4D6; ï¸Capistrano å¯è¦³æ¸¬æ€§ï¼ç›£è¦– &#x1F4D6; ï¸å¯è¦³æ¸¬æ€§ &#x1F4D6; ï¸ç›£è¦– Fluentdï¼FluentBit &#x1F4D6; ï¸Fluentdï¼FluentBit &#x1F4D6; ï¸FluentBit Datadog &#x1F4D6; ï¸ãƒ¡ãƒˆãƒªã‚¯ã‚¹åé›† &#x1F4D6; ï¸ãƒ­ã‚°åé›† &#x1F4D6; åˆ†æ•£ãƒˆãƒ¬ãƒ¼ã‚¹åé›† &#x1F4D6; ãƒ†ãƒ¬ãƒ¡ãƒˆãƒªãƒ¼é–“ã®ç´ä»˜ã‘ &#x1F4D6; ï¸ç›£è¦– ã‚·ã‚¹ãƒ†ãƒ é–‹ç™ºæ‰‹æ³•è«– &#x1F4D6; ï¸ã‚·ã‚¹ãƒ†ãƒ é–‹ç™ºæ‰‹æ³•è«– &#x1F4D6; ï¸ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆç®¡ç† Git &#x1F4D6; ï¸GitHub &#x1F4D6; ï¸Gitã‚³ãƒãƒ³ãƒ‰ çµ±è¨ˆè§£æ &#x1F4D6; ï¸Rè¨€èª "},"public/software/software.html":{"url":"public/software/software.html","title":"ğŸ“– ï¸ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢","keywords":"","body":"ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ ã¯ã˜ã‚ã« æœ¬ã‚µã‚¤ãƒˆã«ã¤ãã¾ã—ã¦ï¼Œä»¥ä¸‹ã‚’ã”èªè­˜ã®ã»ã©å®œã—ããŠé¡˜ã„ã„ãŸã—ã¾ã™ï¼ å‚è€ƒï¼šhttps://hiroki-it.github.io/tech-notebook-gitbook/ 01. ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ã¨ã¯ ãƒ¦ãƒ¼ã‚¶ã®æ“ä½œã«ã‚ˆã‚‹å‘½ä»¤ã®æµã‚Œ ãƒ¦ãƒ¼ã‚¶ã®æ“ä½œã«ã‚ˆã‚‹å‘½ä»¤ãŒï¼Œã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ã‚’ä»‹ã—ã¦ï¼Œãƒãƒ¼ãƒ‰ã‚¦ã‚§ã‚¢ã«ä¼ã‚ã‚‹ã¾ã§ï¼Œã‚’ä»¥ä¸‹ã«ç¤ºã™ï¼ ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ã®ç¨®é¡ 1. ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ï¼ˆå¿œç”¨ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ï¼‰ 2. ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢ 3. åŸºæœ¬ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ï¼ˆåºƒç¾©ã®OSï¼‰ 4. Firmware 5. ãƒ‡ãƒã‚¤ã‚¹ãƒ‰ãƒ©ã‚¤ãƒ 02. ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ï¼ˆå¿œç”¨ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ï¼‰ ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ã®ä¸€è¦§ ãƒã‚¤ãƒ†ã‚£ãƒ–ã‚¢ãƒ—ãƒª Webã‚¢ãƒ—ãƒªã¨ã‚¯ãƒ©ã‚¦ãƒ‰ã‚¢ãƒ—ãƒª ãƒã‚¤ãƒ–ãƒªãƒƒãƒ‰ã‚¢ãƒ—ãƒª åˆ©ç”¨å¯èƒ½ãªé€šä¿¡çŠ¶æ³ Onï¼Off On Onï¼Off ãƒã‚¤ãƒ†ã‚£ãƒ–ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ ç«¯æœ«ã®ã‚·ã‚¹ãƒ†ãƒ ã«ã‚ˆã£ã¦ç¨¼åƒã™ã‚‹ã‚¢ãƒ—ãƒªã®ã“ã¨ï¼ä¸€åº¦ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¦ã—ã¾ãˆã°ï¼Œã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆã«ç¹‹ãŒã£ã¦ã„ãªãã¨ã‚‚ï¼Œä½¿ç”¨ã§ãã‚‹ï¼ ï¼Šä¾‹ï¼Š Officeï¼ŒBookLiveã®ã‚¢ãƒ—ãƒªç‰ˆ Webã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã¨ã‚¯ãƒ©ã‚¦ãƒ‰ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ ãƒ»Webã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ Webã‚µãƒ¼ãƒä¸Šã§Webã‚·ã‚¹ãƒ†ãƒ ã‚’ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã™ã‚‹ã“ã¨ã«ã‚ˆã£ã¦ç¨¼åƒã™ã‚‹ã‚¢ãƒ—ãƒªã®ã“ã¨ï¼URLã‚’Webã‚µãƒ¼ãƒã«ãƒªã‚¯ã‚¨ã‚¹ãƒˆã™ã‚‹ã“ã¨ã§åˆ©ç”¨ã§ãï¼Œéšæ™‚ï¼ŒWebã‚µãƒ¼ãƒã¨ãƒ‡ãƒ¼ã‚¿é€šä¿¡ã‚’è¡Œã†ï¼å…¨ã¦ã®äººãŒç„¡æ–™ã§åˆ©ç”¨ã§ãã‚‹ã‚‚ã®ã¨ï¼ŒãŠé‡‘ã‚’æ‰•ã£ãŸäººã ã‘ãŒåˆ©ç”¨ã§ãã‚‹ã‚‚ã®ãŒã‚ã‚‹ï¼ ï¼Šä¾‹ï¼Š Googleã‚¢ãƒ—ãƒªï¼ŒAmazonï¼ŒBookLiveã®ãƒ–ãƒ©ã‚¦ã‚¶ç‰ˆï¼Œã‚µã‚¤ãƒœã‚¦ã‚º ãƒ»ã‚¯ãƒ©ã‚¦ãƒ‰ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ Webã‚µãƒ¼ãƒä¸Šã®ã‚·ã‚¹ãƒ†ãƒ ã«ã‚ˆã£ã¦ç¨¼åƒã™ã‚‹ã‚¢ãƒ—ãƒªã®ã†ã¡ï¼Œã‚¯ãƒ©ã‚¦ãƒ‰ã‚µãƒ¼ãƒ“ã‚¹ã‚’æä¾›ã™ã‚‹ã‚‚ã®ã®ã“ã¨ï¼ ï¼Šä¾‹ï¼Š Google Driveï¼ŒDropbox ãƒã‚¤ãƒ–ãƒªãƒƒãƒ‰ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ ç«¯æœ«ã§Webviewã‚’ç¨¼åƒã•ã›ï¼ŒWebã‚·ã‚¹ãƒ†ãƒ ã®ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ãªã©ã‚’Webviewä¸Šã§è¡Œã†ã‚¢ãƒ—ãƒªã®ã“ã¨ï¼ ï¼Šä¾‹ï¼Š ã‚¯ãƒƒã‚¯ãƒ‘ãƒƒãƒ‰ 03. ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢ Webã‚µãƒ¼ãƒã®ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢ ãƒ»Apache å‚è€ƒï¼šhttps://hiroki-it.github.io/tech-notebook-gitbook/public/software/software_middleware_web_apache.html ãƒ»Nginx å‚è€ƒï¼šhttps://hiroki-it.github.io/tech-notebook-gitbook/public/software/software_middleware_web_nginx.html Appã‚µãƒ¼ãƒã®ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢ ãƒ»Apacheã®æ‹¡å¼µãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ« å‚è€ƒï¼šhttps://hiroki-it.github.io/tech-notebook-gitbook/public/software/software_middleware_web_apache.html ãƒ»PHP-FPMï¼šPHP FastCGI Process Manager å‚è€ƒï¼šhttps://hiroki-it.github.io/tech-notebook-gitbook/public/software/software_middleware_application_php_fpm.html ãƒ»NGINX Unit Webã‚µãƒ¼ãƒã®Nginxã¨çµ„ã¿åˆã‚ã›ã¦ä½¿ç”¨ã§ãã‚‹ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢ï¼ DBã‚µãƒ¼ãƒã®ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢ ãƒ»MySQL ãƒ»MariaDB 04. åŸºæœ¬ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ï¼ˆåºƒç¾©ã®OSï¼‰ åŸºæœ¬ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ã®ç¨®é¡ ãƒ»Unixç³»OS Unixã‚’æºæµã¨ã—ã¦æ´¾ç”Ÿã—ãŸOSï¼ç¾åœ¨ã§ã¯ä¸»ã«ï¼ŒLinuxç³»çµ±ï¼ˆç·‘è‰²ï¼‰ï¼ŒBSDç³»çµ±ï¼ˆé»„è‰²ï¼‰ï¼ŒSystemVç³»çµ±ï¼ˆé’è‰²ï¼‰ã®ä¸‰ã¤ã«åˆ†ã‘ã‚‰ã‚Œã‚‹ï¼ â€»ã¡ãªã¿ã«ï¼ŒMacOSã¯BSDç³»çµ± ãƒ»WindowsOS MS-DOSã‚’æºæµã¨ã—ã¦æ´¾ç”Ÿã—ãŸOSï¼ä»Šã§ã¯ï¼Œå…¨ã¦ã®æ´¾ç”ŸãŒWindows 10ã«é›†ç´„ã•ã‚ŒãŸï¼ åŸºæœ¬ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ ãƒ»åŸºæœ¬ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ã®æ§‹æˆ ãƒ»ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ åŸºæœ¬ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ã®ãƒãƒ¼ãƒˆã‚’å‚ç…§ï¼ ãƒ»è¨€èªãƒ—ãƒ­ã‚»ãƒƒã‚µ åŸºæœ¬ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ã®ãƒãƒ¼ãƒˆã‚’å‚ç…§ï¼ ãƒ»åˆ¶å¾¡ãƒ—ãƒ­ã‚°ãƒ©ãƒ ï¼ˆã‚«ãƒ¼ãƒãƒ«ï¼‰ åŸºæœ¬ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ã®ãƒãƒ¼ãƒˆã‚’å‚ç…§ï¼ 04-02. Unixç³»OS Linuxç³»çµ± ãƒ»OSã¨ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã®ç¢ºèªã‚³ãƒãƒ³ãƒ‰ OSã¨ãƒãƒ¼ã‚¸ãƒ§ãƒ³ãŒ/etc/issueãƒ•ã‚¡ã‚¤ãƒ«ã«è¨˜è¼‰ã•ã‚Œã¦ã„ã‚‹ï¼ $ cat /etc/issue Debian GNU/Linux 10 \\n \\l ç¾åœ¨ï¼ŒLinuxç³»çµ±ã®OSã¯ï¼Œã•ã‚‰ã«3ã¤ã®ç³»çµ±ã«åˆ†ã‘ã‚‰ã‚Œã‚‹ï¼ ãƒ»RedHatç³»çµ± RedHatï¼ŒCentOSï¼ŒFedora ãƒ»Debianç³»çµ± Debianï¼ŒUbuntuï¼Œ ãƒ»Slackwareç³»çµ± Slackware BSDç³»çµ±ï½œMacOS ãƒ»ç’°å¢ƒå¤‰æ•°ã®ç¢ºèª ç’°å¢ƒå¤‰æ•°ã‚’ç¢ºèªã™ã‚‹ï¼å…¨ã¦ã®é …ç›®ã¯ï¼Œå®Ÿéš›ã«å®Ÿè¡Œã—ã¦ç¢ºèªã™ã‚‹ã“ã¨ï¼ $ export -p export EDITOR=vim export HOME=/Users/h.hasegawa export LANG=en_US.UTF-8 export SHELL=/bin/zsh export USER=h.hasegawa export VISUAL=vim ... 05. ãƒ‡ãƒã‚¤ã‚¹ãƒ‰ãƒ©ã‚¤ãƒ ãƒ‡ãƒã‚¤ã‚¹ãƒ‰ãƒ©ã‚¤ãƒã¨ã¯ è¦å‹‰å¼· 06. Firmware Firmwareã¨ã¯ ã‚·ã‚¹ãƒ†ãƒ ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ï¼ˆãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢ ï¼‹ åŸºæœ¬ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ï¼‰ã¨ãƒãƒ¼ãƒ‰ã‚¦ã‚§ã‚¢ã®é–“ã®æ®µéšã«ã‚ã‚‹ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ï¼ROMã«çµ„ã¿è¾¼ã¾ã‚Œã¦ã„ã‚‹ï¼ BIOSï¼šBasic Input/Output System UEFIï¼šUnited Extensible Firmware Interface Windows 8ä»¥é™ã§æ¡ç”¨ã•ã‚Œã¦ã„ã‚‹æ–°ã—ã„Firmware 07. OSSï¼šOpen Source Software OSSã¨ã¯ ä»¥ä¸‹ã®æ¡ä»¶ã‚’æº€ãŸã™ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ã‚’OSSã¨å‘¼ã¶ï¼ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ã‹ã‚‰åŸºæœ¬ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ã¾ã§ï¼Œæ§˜ã€…ãªã‚‚ã®ãŒã‚ã‚‹ï¼ åˆ©ç”¨è€…ã¯ï¼Œç„¡å„Ÿã‚ã‚‹ã„ã¯æœ‰å„Ÿã§è‡ªç”±ã«å†é…å¸ƒã§ãã‚‹ï¼ åˆ©ç”¨è€…ã¯ï¼Œã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã‚’å…¥æ‰‹ã§ãã‚‹ï¼ åˆ©ç”¨è€…ã¯ï¼Œã‚³ãƒ¼ãƒ‰ã‚’è‡ªç”±ã«å¤‰æ›´ã§ãã‚‹ï¼ã¾ãŸï¼Œå¤‰æ›´å¾Œã«æä¾›ã™ã‚‹å ´åˆï¼Œç•°ãªã‚‹ãƒ©ã‚¤ã‚»ãƒ³ã‚¹ã‚’è¿½åŠ ã§ãã‚‹ï¼ å·®åˆ†æƒ…å ±ã®é…å¸ƒã‚’èªã‚ã‚‹å ´åˆã«ã¯ï¼ŒåŒä¸€æ€§ã®ä¿æŒã‚’è¦æ±‚ã—ã¦ã‚‚ã‹ã¾ã‚ãªã„ï¼ â‡’ ã‚ˆãã‚ã‹ã‚‰ãªã„ æä¾›è€…ã¯ï¼Œç‰¹å®šã®å€‹äººã‚„ã‚°ãƒ«ãƒ¼ãƒ—ã‚’å·®åˆ¥ã§ããªã„ï¼ æä¾›è€…ã¯ï¼Œç‰¹å®šã®åˆ†é‡ã‚’å·®åˆ¥ã§ããªã„ï¼ æä¾›è€…ã¯ï¼Œå…¨ãåŒã˜OSSã®å†é…å¸ƒã«ãŠã„ã¦ï¼Œãƒ©ã‚¤ã‚»ãƒ³ã‚¹ã‚’è¿½åŠ ã§ããªã„ï¼ æä¾›è€…ã¯ï¼Œç‰¹å®šã®è£½å“ã§ã®ã¿æœ‰åŠ¹ãªãƒ©ã‚¤ã‚»ãƒ³ã‚¹ã‚’è¿½åŠ ã§ããªã„ï¼ æä¾›è€…ã¯ï¼Œä»–ã®ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ã‚’åˆ¶é™ã™ã‚‹ãƒ©ã‚¤ã‚»ãƒ³ã‚¹ã‚’è¿½åŠ ã§ããªã„ï¼ æä¾›è€…ã¯ï¼ŒæŠ€è¡“çš„ã«åã‚Šã®ã‚ã‚‹ãƒ©ã‚¤ã‚»ãƒ³ã‚¹ã‚’è¿½åŠ ã§ããªã„ï¼ ç¨®é¡ å¼•ç”¨ï¼šhttps://openstandia.jp/oss_info/ "},"public/software/software_basic_utility.html":{"url":"public/software/software_basic_utility.html","title":"ğŸ“– ï¸ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£","keywords":"","body":"ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ ã¯ã˜ã‚ã« æœ¬ã‚µã‚¤ãƒˆã«ã¤ãã¾ã—ã¦ï¼Œä»¥ä¸‹ã‚’ã”èªè­˜ã®ã»ã©å®œã—ããŠé¡˜ã„ã„ãŸã—ã¾ã™ï¼ å‚è€ƒï¼šhttps://hiroki-it.github.io/tech-notebook-gitbook/ 01. ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ã®ç¨®é¡ Unixã®å ´åˆ ä»Šå›ï¼Œä»¥ä¸‹ã«ç´¹ä»‹ã™ã‚‹ã‚‚ã®ã‚’ã¾ã¨ã‚ã‚‹ï¼RedHatç³»ã¨Debianç³»ã®ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ãŒå…¥ã‚Šæ··ã˜ã£ã¦ã„ã‚‹ã‹ã‚‚ã—ã‚Œãªã„ãŸã‚ï¼Œè¦èª¿æŸ»ï¼ ãƒ•ã‚¡ã‚¤ãƒ«ã‚·ã‚¹ãƒ†ãƒ ç³» ãƒ—ãƒ­ã‚»ã‚¹ç®¡ç†ç³» ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ç³» ãƒ†ã‚­ã‚¹ãƒˆå‡¦ç†ç³» ç’°å¢ƒå¤‰æ•°ç³» ãƒãƒ¼ãƒ‰ã‚¦ã‚§ã‚¢ç³» mkdir batch nslookup tail export df ls ps curl vim printenv free cp kill netstat grep timedatectl - find systemctl route history - - chmod cron ssh - - - rm - - - - - chown - - - - - ln - - - - - od - - - - - tar Windowsã®å ´åˆ Windowsã¯ï¼ŒGUIã§ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ã‚’ä½¿ç”¨ã™ã‚‹ï¼ã‚ˆãä½¿ã†ã‚‚ã®ã‚’è¨˜è¼‰ã™ã‚‹ï¼ ã‚·ã‚¹ãƒ†ãƒ ç³» ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ãƒ‡ãƒã‚¤ã‚¹ç®¡ç†ç³» ãƒ•ã‚¡ã‚¤ãƒ«ç®¡ç†ç³» ãã®ä»– ãƒãƒãƒ¼ã‚¸ãƒ£ ãƒ‡ãƒ•ãƒ©ã‚°ãƒ¡ãƒ³ãƒˆãƒ„ãƒ¼ãƒ« ãƒ•ã‚¡ã‚¤ãƒ«åœ§ç¸®ãƒ—ãƒ­ã‚°ãƒ©ãƒ  ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚»ãƒ¼ãƒãƒ¼ ã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰ ã‚¢ãƒ³ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ©ãƒ¼ - ãƒ•ã‚¡ã‚¤ã‚¢ã‚¦ã‚©ãƒ¼ãƒ« ãƒ¬ã‚¸ã‚¹ãƒˆãƒªã‚¯ãƒªãƒ¼ãƒŠ - - - ã‚¢ãƒ³ãƒã‚¦ã‚¤ãƒ«ã‚¹ - - - ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ã®ãƒã‚¤ãƒŠãƒªãƒ•ã‚¡ã‚¤ãƒ«ã®å ´æ‰€ ãƒã‚¤ãƒŠãƒªãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª ãƒã‚¤ãƒŠãƒªãƒ•ã‚¡ã‚¤ãƒ«ã®ç¨®é¡ /bin Unixãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ã®ãƒã‚¤ãƒŠãƒªãƒ•ã‚¡ã‚¤ãƒ«ã®å¤šãï¼ /usr/bin ç®¡ç†ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ã«ã‚ˆã£ã¦ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã‚‹ãƒã‚¤ãƒŠãƒªãƒ•ã‚¡ã‚¤ãƒ«ã®å¤šãï¼ /usr/local/bin Unixå¤–ã®ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ã«ã‚ˆã£ã¦ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚ŒãŸãƒã‚¤ãƒŠãƒªãƒ•ã‚¡ã‚¤ãƒ«ï¼æœ€åˆã¯ç©ºã«ãªã£ã¦ã„ã‚‹ï¼ /sbin Unixãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ã®ãƒã‚¤ãƒŠãƒªãƒ•ã‚¡ã‚¤ãƒ«ã†ã¡ï¼Œsudoæ¨©é™ãŒå¿…è¦ãªã‚‚ã®ï¼ /usr/sbin ç®¡ç†ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ã«ã‚ˆã£ã¦ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚ŒãŸãƒã‚¤ãƒŠãƒªãƒ•ã‚¡ã‚¤ãƒ«ã®ã†ã¡ï¼Œsudoæ¨©é™ãŒå¿…è¦ãªã‚‚ã®ï¼ /usr/local/sbin Unixå¤–ã®ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ã«ã‚ˆã£ã¦ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚ŒãŸãƒã‚¤ãƒŠãƒªãƒ•ã‚¡ã‚¤ãƒ«ã®ã†ã¡ï¼Œsudoæ¨©é™ãŒå¿…è¦ãªã‚‚ã®ï¼æœ€åˆã¯ç©ºã«ãªã£ã¦ã„ã‚‹ï¼ # ãƒã‚¤ãƒŠãƒªãƒ•ã‚¡ã‚¤ãƒ«ãŒå…¨ã¦ã®å ´æ‰€ã§è¦‹ã¤ã‹ã‚‰ãªã„ã‚¨ãƒ©ãƒ¼ $ which python3 which: no python3 in (/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin) # ãƒã‚¤ãƒŠãƒªãƒ•ã‚¡ã‚¤ãƒ«ã®å ´æ‰€ $ which python3 /usr/bin/python3 02. å…¥åŠ›ã¨å‡ºåŠ› æ¨™æº–å…¥å‡ºåŠ› ãƒ»æ¨™æº–å…¥å‡ºåŠ›ã¨ã¯ ç¨®é¡ èª¬æ˜ stddinï¼ˆæ¨™æº–å…¥åŠ›ï¼‰ ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ã‹ã‚‰ã®ã‚³ãƒãƒ³ãƒ‰ã«å¯¾ã—ã¦ï¼Œãƒ‡ãƒ¼ã‚¿ã‚’å…¥åŠ›ã™ã‚‹ãŸã‚ã®ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã®ã“ã¨ï¼ãƒ—ãƒ­ã‚»ã‚¹ã”ã¨ã«å­˜åœ¨ã™ã‚‹ï¼ stdoutï¼ˆæ¨™æº–å‡ºåŠ›ï¼‰ ã‚³ãƒãƒ³ãƒ‰ã‹ã‚‰ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ã«å¯¾ã—ã¦ï¼Œã‚¨ãƒ©ãƒ¼ä»¥å¤–ã®ãƒ‡ãƒ¼ã‚¿ã‚’å‡ºåŠ›ã™ã‚‹ãŸã‚ã®ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã®ã“ã¨ï¼ãƒ—ãƒ­ã‚»ã‚¹ã”ã¨ã«å­˜åœ¨ã™ã‚‹ï¼ stderrï¼ˆæ¨™æº–ã‚¨ãƒ©ãƒ¼å‡ºåŠ›ï¼‰ ã‚³ãƒãƒ³ãƒ‰ã‹ã‚‰ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ã«å¯¾ã—ã¦ï¼Œã‚¨ãƒ©ãƒ¼ãƒ‡ãƒ¼ã‚¿ã‚’å‡ºåŠ›ã™ã‚‹ãŸã‚ã®ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã®ã“ã¨ï¼ãƒ—ãƒ­ã‚»ã‚¹ã”ã¨ã«å­˜åœ¨ã™ã‚‹ï¼ ãƒ»æ¨™æº–å‡ºåŠ›ã«å‡ºåŠ› ã‚³ãƒãƒ³ãƒ‰å‡¦ç†ã®å¾Œã«ï¼Œã€Œ>&1ã€ã‚’è¿½åŠ ã™ã‚‹ã¨ï¼Œå‡¦ç†ã®çµæœã‚’ï¼Œãƒ—ãƒ­ã‚»ã‚¹ã®æ¨™æº–å‡ºåŠ›ã«å‡ºåŠ›ã§ãã‚‹ï¼ ï¼Šã‚³ãƒãƒ³ãƒ‰ä¾‹ï¼Š $ echo \"text\" >&1 ã¾ãŸï¼Œãƒ—ãƒ­ã‚»ã‚¹ã®æ¨™æº–å‡ºåŠ›ã¯/proc//fdãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã®ãƒ•ã‚¡ã‚¤ãƒ«ãƒ‡ã‚£ã‚¹ã‚¯ãƒªãƒ—ã‚¿ç•ªå·ï¼ˆï¼‘ç•ªï¼‰ã§ç¢ºèªã§ãã‚‹ï¼ãƒ—ãƒ­ã‚»ã‚¹IDã¯psã‚³ãƒãƒ³ãƒ‰ã§äº‹å‰ã«ç¢ºèªã™ã‚‹ï¼ ï¼Šã‚³ãƒãƒ³ãƒ‰ä¾‹ï¼Š PHP-FPMã®ç¨¼åƒã™ã‚‹ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ä¾‹ $ ps -aux USER PID %CPU %MEM VSZ RSS TTY STAT START TIME COMMAND root 1 0.0 0.6 83736 25408 ? Ss 01:56 0:03 php-fpm: master process (/usr/local/etc/php-fpm.conf) www-data 2739 3.6 0.7 247968 29296 ? Sl 13:24 1:36 php-fpm: pool www www-data 2815 3.6 0.7 247968 29288 ? Sl 13:43 0:55 php-fpm: pool www www-data 2902 3.6 0.7 247968 29304 ? Sl 14:05 0:07 php-fpm: pool www root 2928 0.0 0.0 9732 3316 pts/0 R+ 14:08 0:00 ps -aux # æ¨™æº–å‡ºåŠ›ã‚’ç¢ºèª $ cat /proc/1/fd/1 å‚è€ƒï¼šhttps://debimate.jp/2020/07/04/%e8%b5%b7%e5%8b%95%e6%b8%88%e3%81%bf%e3%83%97%e3%83%ad%e3%82%bb%e3%82%b9%ef%bc%88%e4%be%8b%ef%bc%9a%e3%83%87%e3%83%bc%e3%83%a2%e3%83%b3%e3%83%97%e3%83%ad%e3%82%bb%e3%82%b9%ef%bc%89%e3%81%ae%e6%a8%99/ ãƒ»æ¨™æº–ã‚¨ãƒ©ãƒ¼å‡ºåŠ›ã«å‡ºåŠ› ã‚³ãƒãƒ³ãƒ‰å‡¦ç†ã®å¾Œã«ï¼Œã€Œ>&2ã€ã‚’è¿½åŠ ã™ã‚‹ã¨ï¼Œå‡¦ç†ã®çµæœã‚’ï¼Œãƒ—ãƒ­ã‚»ã‚¹ã®æ¨™æº–ã‚¨ãƒ©ãƒ¼å‡ºåŠ›ã«å‡ºåŠ›ã§ãã‚‹ï¼ ï¼Šã‚³ãƒãƒ³ãƒ‰ä¾‹ï¼Š $ echo \"text\" >&2 ã¾ãŸï¼Œãƒ—ãƒ­ã‚»ã‚¹ã®æ¨™æº–å‡ºåŠ›ã¯/proc//fdãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã®ãƒ•ã‚¡ã‚¤ãƒ«ãƒ‡ã‚£ã‚¹ã‚¯ãƒªãƒ—ã‚¿ç•ªå·ï¼ˆï¼’ç•ªï¼‰ã§ç¢ºèªã§ãã‚‹ï¼ãƒ—ãƒ­ã‚»ã‚¹IDã¯psã‚³ãƒãƒ³ãƒ‰ã§äº‹å‰ã«ç¢ºèªã™ã‚‹ï¼ ï¼Šã‚³ãƒãƒ³ãƒ‰ä¾‹ï¼Š PHP-FPMã®ç¨¼åƒã™ã‚‹ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ä¾‹ $ ps -aux USER PID %CPU %MEM VSZ RSS TTY STAT START TIME COMMAND root 1 0.0 0.6 83736 25408 ? Ss 01:56 0:03 php-fpm: master process (/usr/local/etc/php-fpm.conf) www-data 2739 3.6 0.7 247968 29296 ? Sl 13:24 1:36 php-fpm: pool www www-data 2815 3.6 0.7 247968 29288 ? Sl 13:43 0:55 php-fpm: pool www www-data 2902 3.6 0.7 247968 29304 ? Sl 14:05 0:07 php-fpm: pool www root 2928 0.0 0.0 9732 3316 pts/0 R+ 14:08 0:00 ps -aux # æ¨™æº–ã‚¨ãƒ©ãƒ¼å‡ºåŠ›ã‚’ç¢ºèª $ cat /proc/1/fd/2 å‚è€ƒï¼šhttps://debimate.jp/2020/07/04/%e8%b5%b7%e5%8b%95%e6%b8%88%e3%81%bf%e3%83%97%e3%83%ad%e3%82%bb%e3%82%b9%ef%bc%88%e4%be%8b%ef%bc%9a%e3%83%87%e3%83%bc%e3%83%a2%e3%83%b3%e3%83%97%e3%83%ad%e3%82%bb%e3%82%b9%ef%bc%89%e3%81%ae%e6%a8%99/ ãƒ»æ¨™æº–å‡ºåŠ›ã¨ãƒ•ã‚¡ã‚¤ãƒ«ã«å‡ºåŠ› ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã§teeã‚³ãƒãƒ³ãƒ‰ã‚’ç¹‹ãã¨ï¼Œæ¨™æº–å‡ºåŠ›ã¨ãƒ•ã‚¡ã‚¤ãƒ«ã®ä¸¡æ–¹ã«å‡ºåŠ›ã§ãã‚‹ï¼ å‚è€ƒï¼šhttps://glorificatio.org/archives/2903 ï¼Šã‚³ãƒãƒ³ãƒ‰ä¾‹ï¼Š $ echo \"text\" | tee stdout.log pipeline ãƒ»pipelineã¨ã¯ ã€Œ|ã€ã®ç¸¦æ£’è¨˜å·ã®ã“ã¨ï¼è¤‡æ•°ã®ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã®å…¥å‡ºåŠ›ã‚’ç¹‹ãã“ã¨ãŒã§ãã‚‹ï¼ ãƒ»grepã¨ã®çµ„ã¿åˆã‚ã› ã‚³ãƒãƒ³ãƒ‰ã®å‡ºåŠ›çµæœã‚’grepã‚³ãƒãƒ³ãƒ‰ã«æ¸¡ã—ï¼Œãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°ã‚’è¡Œã†ï¼ ï¼Šã‚³ãƒãƒ³ãƒ‰ä¾‹ï¼Š æ¤œç´¢ã•ã‚ŒãŸãƒ•ã‚¡ã‚¤ãƒ«å†…ã§ï¼Œã•ã‚‰ã«æ–‡å­—åˆ—ã‚’æ¤œç´¢ã™ã‚‹ï¼ $ find /* \\ -type f | xargs grep \"\" ãƒ»killã¨ã®çµ„ã¿åˆã‚ã› ã‚³ãƒãƒ³ãƒ‰ã®å‡ºåŠ›çµæœã«å¯¾ã—ã¦ï¼Œkillã‚³ãƒãƒ³ãƒ‰ã‚’è¡Œã†ï¼ ï¼Šã‚³ãƒãƒ³ãƒ‰ä¾‹ï¼Š ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°ã•ã‚ŒãŸãƒ—ãƒ­ã‚»ã‚¹ã‚’å‰Šé™¤ã™ã‚‹ï¼ $ sudo pgrep \\ -f | sudo xargs kill -9 ãƒ»awkã¨ã®çµ„ã¿åˆã‚ã› ã‚³ãƒãƒ³ãƒ‰ã®å‡ºåŠ›çµæœã«å¯¾ã—ã¦ï¼Œawkã‚³ãƒãƒ³ãƒ‰ã‚’è¡Œã†ï¼ ï¼Šã‚³ãƒãƒ³ãƒ‰ä¾‹ï¼Š æ¤œç´¢ã•ã‚ŒãŸãƒ•ã‚¡ã‚¤ãƒ«ã®å®¹é‡ã‚’åˆè¨ˆã™ã‚‹ï¼ $ find ./* -name \"*.js\" -type f -printf \"%s\\n\" | awk \"{ sum += $1; } END { print sum; }\" $ find ./* -name \"*.css\" -type f -printf \"%s\\n\" | awk \"{ sum += $1; } END { print sum; }\" $ find ./* -name \"*.png\" -type f -printf \"%s\\n\" | awk \"{ sum += $1; } END { print sum; }\" ãƒ»sortã¨ã®çµ„ã¿åˆã‚ã› ã‚³ãƒãƒ³ãƒ‰ã®å‡ºåŠ›çµæœã«å¯¾ã—ã¦ï¼Œä¸¦ã³é †ã‚’å¤‰æ›´ã™ã‚‹ï¼ ï¼Šã‚³ãƒãƒ³ãƒ‰ä¾‹ï¼Š è¡¨ç¤ºã•ã‚ŒãŸç’°å¢ƒå¤‰æ•°ã‚’AZæ˜‡é †ã«ä¸¦ã³æ›¿ãˆã‚‹ï¼ $ printenv | sort -f 03. ã‚·ã‚§ãƒ«ã‚¹ã‚¯ãƒªãƒ—ãƒˆï¼Makefile ã‚·ã‚§ãƒ«ã‚¹ã‚¯ãƒªãƒ—ãƒˆ ãƒ»ã‚·ã‚§ãƒ«ã‚¹ã‚¯ãƒªãƒ—ãƒˆã¨ã¯ ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ã®å‡¦ç†ã‚’æ‰‹ç¶šãçš„ã«å®Ÿè£…ã—ãŸãƒ•ã‚¡ã‚¤ãƒ«ï¼æœ€åˆã®ã€Œ#!ã€ã‚’ã‚·ã‚§ãƒãƒ³ã¨ã„ã†ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š #!/bin/bash echo \"foo\" echo \"bar\" echo \"baz\" Makefile ãƒ»Makefileã¨ã¯ ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ã®å‡¦ç†ã‚’æ‰‹ç¶šãçš„ã«å®Ÿè£…ã—ãŸãƒ•ã‚¡ã‚¤ãƒ«ï¼ã‚¿ãƒ¼ã‚²ãƒƒãƒˆã”ã¨ã«å‡¦ç†ã‚’å®Ÿè£…ã™ã‚‹ï¼è¤‡æ•°ã®ã‚¿ãƒ¼ã‚²ãƒƒãƒˆåã‚’å‰²ã‚Šå½“ã¦ã‚‰ã‚Œã‚‹ï¼ foo: echo \"foo\" bar: echo \"bar\" baz qux: # è¤‡æ•°ã®ã‚¿ãƒ¼ã‚²ãƒƒãƒˆå echo \"baz\" ãƒ»ã‚¿ãƒ¼ã‚²ãƒƒãƒˆé–“ä¾å­˜é–¢ä¿‚ ç‰¹å®šã®ã‚¿ãƒ¼ã‚²ãƒƒãƒˆã®å®Ÿè¡Œå‰ã«ï¼Œä»–ã®ã‚¿ãƒ¼ã‚²ãƒƒãƒˆã‚’å®Ÿè¡Œã—ã¦ãŠããŸã„å ´åˆï¼Œä¾å­˜é–¢ä¿‚ã‚’å®šç¾©ã§ãã‚‹ï¼ã“ã‚Œã¯è¤‡æ•°å®šç¾©ã§ãã‚‹ï¼ foo: echo \"foo\" bar: foo # fooã‚’äº‹å‰ã«å®Ÿè¡Œã™ã‚‹ï¼ echo \"bar\" baz: foo baz # fooï¼Œbazã‚’äº‹å‰ã«å®Ÿè¡Œã™ã‚‹ï¼ echo \"baz\" ã‚·ã‚§ãƒ«ã‚¹ã‚¯ãƒªãƒ—ãƒˆã®å®Ÿè¡Œæ–¹æ³• ãƒ»source ç¾åœ¨é–‹ã‹ã‚Œã¦ã„ã‚‹ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ãƒ†ã‚£ãƒ–ã§å‡¦ç†ã‚’å®Ÿè¡Œã™ã‚‹ï¼ãã®ãŸã‚ï¼Œã‚·ã‚§ãƒ«ã‚¹ã‚¯ãƒªãƒ—ãƒˆå†…ã§å®šç¾©ã—ãŸå¤‰æ•°ã¯ï¼Œã‚·ã‚§ãƒ«ã‚¹ã‚¯ãƒªãƒ—ãƒˆã®å®Ÿè¡Œå¾Œã‚‚ç¶­æŒã•ã‚Œã‚‹ï¼ $ source hello.sh ãƒ»bash æ–°ã—ãã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ãƒ†ã‚£ãƒ–ã‚’é–‹ãï¼Œå‡¦ç†ã‚’å®Ÿè¡Œã™ã‚‹ï¼ãã®ãŸã‚ï¼Œã‚·ã‚§ãƒ«ã‚¹ã‚¯ãƒªãƒ—ãƒˆå†…ã§å®šç¾©ã—ãŸå¤‰æ•°ã¯ï¼Œã‚·ã‚§ãƒ«ã‚¹ã‚¯ãƒªãƒ—ãƒˆã®å®Ÿè¡Œå¾Œã«ç ´æ£„ã•ã‚Œã‚‹ï¼ $ bash hello.sh ãƒ»ãƒ‰ãƒƒãƒˆ $ . hello.sh ãƒ»ãƒ‘ã‚¹æŒ‡å®š ç›¸å¯¾ãƒ‘ã‚¹ã‚‚ã—ãã¯çµ¶å¯¾ãƒ‘ã‚¹ã§ã‚·ã‚§ãƒ«ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’æŒ‡å®šã™ã‚‹ï¼å®Ÿè¡Œã™ã‚‹ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚«ãƒ¬ãƒ³ãƒˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ç½®ãã“ã¨ã¯ã§ããªã„ï¼ $ ./hello.sh Makefileã®å®Ÿè¡Œæ–¹æ³•ã¨ã‚ªãƒ—ã‚·ãƒ§ãƒ³ ãƒ»make MakefileãŒç½®ã‹ã‚ŒãŸéšå±¤ã§ï¼Œmakeã‚³ãƒãƒ³ãƒ‰ã®å¼•æ•°ã¨ã—ã¦ã‚¿ãƒ¼ã‚²ãƒƒãƒˆåã‚„ç’°å¢ƒå¤‰æ•°ã‚’æ¸¡ã›ã‚‹ï¼Makefileå†…ã§ç’°å¢ƒå¤‰æ•°ã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã‚’å®šç¾©ã§ãã‚‹ï¼ $ make = ï¼Šå®Ÿè£…ä¾‹ï¼Š $ make foo FOO=foo FOO=default foo: echo ${FOO} ãƒ­ã‚¸ãƒƒã‚¯ ãƒ»ãƒ’ã‚¢ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ ãƒ’ã‚¢ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã§ä½œæˆã—ãŸã‚·ã‚§ãƒ«ã‚¹ã‚¯ãƒªãƒ—ãƒˆã«ã¯ï¼Œå„è¡Œã«echoãŒè¿½åŠ ã•ã‚Œã‚‹ï¼ #!/bin/bash cat \"echo.sh\" #!/bin/bash hoge fuga EOF #!/bin/bash echo hoge echo fuga ãƒ»for ï¼Šå®Ÿè£…ä¾‹ï¼Š #!/bin/bash for i in 1 2 3 4 5 do echo \"$i\" done ãƒ»switch-case å¤‰æ•°ã«ä»£å…¥ã•ã‚ŒãŸå€¤ã«ã‚ˆã£ã¦ï¼Œå‡¦ç†ã‚’åˆ†ã‘ã‚‹ï¼å…¨ã¦ã®å ´åˆä»¥å¤–ã‚’ã‚¢ã‚¹ã‚¿ãƒªã‚¹ã‚¯ã§å®šç¾©ã™ã‚‹ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š #!/bin/bash case \"$ENV\" in \"test\") VAR=\"XXXXX\" ;; \"stg\") VAR=\"YYYYY\" ;; \"prd\") VAR=\"ZZZZZ\" ;; *) echo \"The parameter ${ENV} is invalid.\" exit 1 ;; esac 04. ãƒ•ã‚¡ã‚¤ãƒ«ã‚·ã‚¹ãƒ†ãƒ ç³» chmodï¼šchange mode ãƒ» ãƒ•ã‚¡ã‚¤ãƒ«ã®æ¨©é™ã‚’å¤‰æ›´ã™ã‚‹ï¼ã‚ˆãä½¿ç”¨ã•ã‚Œã‚‹ãƒ‘ãƒ¼ãƒŸãƒƒã‚·ãƒ§ãƒ³ã®ãƒ‘ã‚¿ãƒ¼ãƒ³ã¯æ¬¡ã®é€šã‚Šï¼ $ chmod 600 ãƒ»-R ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªå†…ã®ãƒ•ã‚¡ã‚¤ãƒ«ã«å¯¾ã—ã¦ï¼Œå†å¸°çš„ã«æ¨©é™ã‚’ä»˜ä¸ã™ã‚‹ï¼ $ chmod -R 600 ãƒ»100ç•ªåˆ»ã¿ã®è¦å‰‡æ€§ æ‰€æœ‰è€…ä»¥å¤–ã«å…¨æ¨©é™ãŒä¸ãˆã‚‰ã‚Œãªã„ï¼ æ•°å­— æ‰€æœ‰è€… ã‚°ãƒ«ãƒ¼ãƒ— ãã®ä»– ç‰¹å¾´ 500 r-x --- --- æ‰€æœ‰è€…ä»¥å¤–ã«å…¨æ¨©é™ãªã— 600 rw- --- --- æ‰€æœ‰è€…ä»¥å¤–ã«å…¨æ¨©é™ãªã— 700 rwx --- --- æ‰€æœ‰è€…ä»¥å¤–ã«å…¨æ¨©é™ãªã— ãƒ»111ç•ªåˆ»ã¿ã®è¦å‰‡æ€§ å…¨ã¦ã®ãƒ‘ã‚¿ãƒ¼ãƒ³ã§åŒã˜æ¨©é™ã«ãªã‚‹ï¼ æ•°å­— æ‰€æœ‰è€… ã‚°ãƒ«ãƒ¼ãƒ— ãã®ä»– ç‰¹å¾´ 555 r-x r-x r-x å…¨ã¦ã«Writeæ¨©é™ãªã— 666 rw- rw- rw- å…¨ã¦ã«Executæ¨©é™ãªã— 777 rwx rwx rwx å…¨ã¦ã«å…¨æ¨©é™ã‚ã‚Š ãƒ»ãã®ä»–ã§ã‚ˆãä½¿ã†ç•ªå· æ•°å­— æ‰€æœ‰è€… ã‚°ãƒ«ãƒ¼ãƒ— ãã®ä»– ç‰¹å¾´ 644 rw- r-- r-- æ‰€æœ‰è€…ä»¥å¤–ã«Writeï¼ŒExecuteæ¨©é™ãªã— 755 rwx r-x r-x æ‰€æœ‰è€…ä»¥å¤–ã«Writeæ¨©é™ãªã— cp ãƒ»-Rp ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã®å±æ€§æƒ…å ±ã‚‚å«ã‚ã¦ï¼Œãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹é€ ã¨ãƒ•ã‚¡ã‚¤ãƒ«ã‚’å†å¸°çš„ã«ã‚³ãƒ”ãƒ¼ï¼ $ cp -Rp // // # éš ã—ãƒ•ã‚¡ã‚¤ãƒ«ã‚‚å«ã‚ã¦ï¼Œãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã®ä¸­èº«ã‚’ä»–ã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªå†…ã«ã‚³ãƒ”ãƒ¼ # ã€Œã‚¢ã‚¹ã‚¿ãƒªã‚¹ã‚¯ã€ã§ãªãã€Œãƒ‰ãƒƒãƒˆã€ã«ã™ã‚‹ $ cp -Rp // / ãƒ»-p ã€ãƒ•ã‚¡ã‚¤ãƒ«å.YYYYmmddã€ã®å½¢å¼ã§ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆ $ cp -p .`date +\"%Y%m%d\"` echo ãƒ»ã‚ªãƒ—ã‚·ãƒ§ãƒ³ç„¡ã— å®šç¾©ã•ã‚ŒãŸã‚·ã‚§ãƒ«å¤‰æ•°ã‚’å‡ºåŠ›ã™ã‚‹ï¼å¤‰æ•°åã«ã¯$ãƒãƒ¼ã‚¯ã‚’ä»˜ã‘ã‚‹ï¼ãƒ€ãƒ–ãƒ«ã‚¯ã‚ªãƒ¼ãƒˆã¯ã‚ã£ã¦ã‚‚ãªãã¦ã‚‚ã‚ˆã„ï¼ $ = $ echo $ $ echo \"$\" file ãƒ»ã‚ªãƒ—ã‚·ãƒ§ãƒ³ç„¡ã— ãƒ•ã‚¡ã‚¤ãƒ«ã®æ”¹è¡Œã‚³ãƒ¼ãƒ‰ã‚’ç¢ºèªã™ã‚‹ï¼ # LFã®å ´åˆï¼ˆä½•ã‚‚è¡¨ç¤ºã•ã‚Œãªã„ï¼‰ $ file foo.txt foo.txt: ASCII text # CRLFã®å ´åˆ $ file foo.txt foo.txt: ASCII text, with CRLF line terminators # CRã®å ´åˆ $ file foo.txt foo.txt: ASCII text, with CR line terminators find ãƒ»-type ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æ¤œç´¢ã™ã‚‹ãŸã‚ã®ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ï¼ã‚¢ã‚¹ã‚¿ãƒªã‚¹ã‚¯ã‚’ä»˜ã‘ãªãã¨ã‚‚ï¼Œè‡ªå‹•çš„ã«ãƒ¯ã‚¤ãƒ«ãƒ‰ã‚«ãƒ¼ãƒ‰ãŒåƒãï¼ $ find /* -type f | xargs grep \"\" # ãƒ‘ãƒ¼ãƒŸãƒƒã‚·ãƒ§ãƒ³ã‚¨ãƒ©ãƒ¼ãªã©ã®ãƒ­ã‚°ã‚’ç ´æ£„ã—ã¦æ¤œç´¢ï¼ $ find /* -type f | xargs grep \"\" 2> /dev/null ãƒ»-name åå‰ãŒ .conf ã§çµ‚ã‚ã‚‹ãƒ•ã‚¡ã‚¤ãƒ«ã‚’å…¨ã¦æ¤œç´¢ã™ã‚‹ï¼ $ find /* -name \"*.conf\" -type f åå‰ãŒ dir ã§çµ‚ã‚ã‚‹ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’å…¨ã¦æ¤œç´¢ã™ã‚‹ï¼ $ find /* -name \"*dir\" -type d ãƒ«ãƒ¼ãƒˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªä»¥ä¸‹ã§ï¼Œ ã¨ã„ã†æ–‡å­—ã‚’ã‚‚ã¡ï¼Œãƒ•ã‚¡ã‚¤ãƒ«åãŒ .conf ã§çµ‚ã‚ã‚‹ãƒ•ã‚¡ã‚¤ãƒ«ã‚’å…¨ã¦æ¤œç´¢ã™ã‚‹ï¼ $ find /* -name \"*.conf\" -type f | xargs grep \"\" ln ãƒ»ã‚·ãƒ³ãƒœãƒªãƒƒã‚¯ãƒªãƒ³ã‚¯ã¨ã¯ ãƒ•ã‚¡ã‚¤ãƒ«ã‚„ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã®ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆã®ã“ã¨ï¼ã‚·ãƒ³ãƒœãƒªãƒƒã‚¯ãƒªãƒ³ã‚¯ã«å¯¾ã™ã‚‹å‡¦ç†ã¯ï¼Œãƒªãƒ³ã‚¯å…ƒã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚„ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«è»¢é€ã•ã‚Œã‚‹ï¼ ãƒ»-s ã‚«ãƒ¬ãƒ³ãƒˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ï¼Œã‚·ãƒ³ãƒœãƒªãƒƒã‚¯ãƒªãƒ³ã‚¯ã‚’ä½œæˆã™ã‚‹ï¼ãƒªãƒ³ã‚¯ã®å…ƒã«ãªã‚‹ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚„ãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒ‘ã‚¹ã‚’æŒ‡å®šã™ã‚‹ï¼ $ ln -s ls ãƒ»-lï¼Œ-a éš ã—ãƒ•ã‚¡ã‚¤ãƒ«ã‚„éš ã—ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚‚å«ã‚ã¦ï¼Œå…¨ã¦ã®è©³ç´°ã‚’è¡¨ç¤ºã™ã‚‹ï¼ $ ls -l -a mkdir ãƒ»-p è¤‡æ•°éšå±¤ã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’ä½œæˆã™ã‚‹ï¼ $ mkdir -p // rm ãƒ»-R ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªè‡ªä½“ã¨ä¸­ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’å†å¸°çš„ã«å‰Šé™¤ã™ã‚‹ï¼ $ rm -R odï¼šoctal dump ãƒ»ã‚ªãƒ—ã‚·ãƒ§ãƒ³ç„¡ã— ãƒ•ã‚¡ã‚¤ãƒ«ã‚’8é€²æ•°ã®æ©Ÿæ¢°èªã§å‡ºåŠ›ã™ã‚‹ï¼ $ od ãƒ»-Adï¼Œ-tx ãƒ•ã‚¡ã‚¤ãƒ«ã‚’16é€²æ•°ã®æ©Ÿæ¢°èªã§å‡ºåŠ›ã™ã‚‹ï¼ $ od -Ad -tx set ãƒ»ã‚ªãƒ—ã‚·ãƒ§ãƒ³ç„¡ã— ç¾åœ¨è¨­å®šã•ã‚Œã¦ã„ã‚‹ã‚·ã‚§ãƒ«å¤‰æ•°ã‚’ä¸€è¦§ã§è¡¨ç¤ºã™ã‚‹ï¼ $ set ãƒ»-n ã‚·ã‚§ãƒ«ã‚¹ã‚¯ãƒªãƒ—ãƒˆã®æ§‹æ–‡è§£æã‚’è¡Œã†ï¼ $ set -n ãƒ»-e ä¸€é€£ã®å‡¦ç†ã®é€”ä¸­ã§0ä»¥å¤–ã®çµ‚äº†ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãŒå‡ºåŠ›ã•ã‚ŒãŸå ´åˆï¼Œå…¨ã¦ã®å‡¦ç†ã‚’çµ‚äº†ã™ã‚‹ï¼ $ set -e ãƒ»-x ä¸€é€£ã®å‡¦ç†ã‚’ãƒ‡ãƒãƒƒã‚°æƒ…å ±ã¨ã—ã¦å‡ºåŠ›ã™ã‚‹ï¼ $ set -x ãƒ»-u ä¸€é€£ã®å‡¦ç†ã®ä¸­ã§ï¼Œæœªå®šç¾©ã®å¤‰æ•°ãŒå­˜åœ¨ã—ãŸå ´åˆï¼Œå…¨ã¦ã®å‡¦ç†ã‚’çµ‚äº†ã™ã‚‹ï¼ $ set -u ãƒ»-o pipefail ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ï¼ˆ|ï¼‰å†…ã®ä¸€é€£ã®å‡¦ç†ã®é€”ä¸­ã§ï¼Œã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ãŸå ´åˆï¼Œãã®çµ‚äº†ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚’å‡ºåŠ›ã—ï¼Œå…¨ã¦ã®å‡¦ç†ã‚’çµ‚äº†ã™ã‚‹ï¼ $ set -o pipefail tar ãƒ»-x åœ§ç¸®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’è§£å‡ã™ã‚‹ï¼ $ tar -xf foo.tar.gz ãƒ»-f åœ§ç¸®ãƒ•ã‚¡ã‚¤ãƒ«åã‚’æŒ‡å®šã™ã‚‹ï¼ã“ã‚Œã‚’ä»˜ã‘ãªã„å ´åˆï¼Œãƒ†ãƒ¼ãƒ—ãƒ‰ãƒ©ã‚¤ãƒ–ãŒæŒ‡å®šã•ã‚Œã‚‹ï¼ $ tar -xf foo.tar.gz ãƒ»-v è§£å‡ä¸­ã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªï¼ãƒ•ã‚¡ã‚¤ãƒ«ã®ç”Ÿæˆãƒ­ã‚°ã‚’è¡¨ç¤ºã™ã‚‹ï¼ $ tar -xvf foo.tar.gz ./ ./opt/ ./opt/foo/ ./opt/foo/bar/ ./opt/foo/bar/install.sh ./opt/foo/bar/baz/ ./opt/foo/bar/baz/init.sh ãƒ»-g gzipæ‹¡å¼µå­ã®åœ§ç¸®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’è§£å‡ã™ã‚‹ï¼ãŸã ã—ï¼Œæ¨™æº–ã§æœ‰åŠ¹ã«ãªã£ã¦ã„ã‚‹ãŸã‚ï¼Œã‚ªãƒ—ã‚·ãƒ§ãƒ³ã¯ä»˜ã‘ãªã„ãã¦ã‚‚å•é¡Œãªã„ï¼ $ tar -zxf foo.tar.gz unlink ãƒ»ã‚ªãƒ—ã‚·ãƒ§ãƒ³ç„¡ã— ã‚«ãƒ¬ãƒ³ãƒˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã®ã‚·ãƒ³ãƒœãƒªãƒƒã‚¯ãƒªãƒ³ã‚¯ã‚’å‰Šé™¤ã™ã‚‹ï¼ $ unlink 04-02. ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ç³» curl ãƒ»ã‚ªãƒ—ã‚·ãƒ§ãƒ³ç„¡ã— GETãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é€ä¿¡ã™ã‚‹ï¼jqã‚³ãƒãƒ³ãƒ‰ã‚’ä½¿ç”¨ã™ã‚‹ã¨ï¼Œãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’æ•´å½¢ã§ãã‚‹ï¼ $ curl http://example.co.jp/foos/1 | jq . ãƒ»-Xï¼Œ-Tï¼Œ-d Content-Typeã‚’æŒ‡å®šã—ã¦ï¼ŒPOSTãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é€ä¿¡ã™ã‚‹ï¼ $ curl -X POST -H \"Content-Type: application/json\" -d '{}' https://example.co.jp/foos ãƒ»-oï¼ˆå°æ–‡å­—ï¼‰ ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«å¾Œã®ãƒ•ã‚¡ã‚¤ãƒ«åã‚’å®šç¾©ã™ã‚‹ï¼ã“ã‚Œã‚’æŒ‡å®šã—ãªã„å ´åˆï¼Œ-Oã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’æœ‰åŠ¹åŒ–ã™ã‚‹å¿…è¦ãŒã‚ã‚‹ï¼ $ curl -o https://example.co.jp ãƒ»-Oï¼ˆå¤§æ–‡å­—ï¼‰ ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«å¾Œã®ãƒ•ã‚¡ã‚¤ãƒ«åã¯ãã®ã¾ã¾ã§ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹ï¼ã“ã‚Œã‚’æŒ‡å®šã—ãªã„å ´åˆï¼Œ-oã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’æœ‰åŠ¹åŒ–ã™ã‚‹å¿…è¦ãŒã‚ã‚‹ï¼ ãƒ»-L æŒ‡å®šã—ãŸURLã§ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆãŒè¡Œã‚ã‚Œã¦ã‚‚ï¼Œãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆå¾Œã®URLã‹ã‚‰ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹ï¼ $ curl -L https://example.co.jp/foos sshï¼šsecure shell ãƒ»-lï¼Œ-pï¼Œï¼Œ-iï¼Œ-T äº‹å‰ã«ï¼Œç§˜å¯†éµã®æ¨©é™ã¯ã€Œ600ã€ã«ã—ã¦ãŠãï¼ttyï¼ˆæ“¬ä¼¼ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ï¼‰ã‚’ä½¿ç”¨ã™ã‚‹å ´åˆã¯ï¼Œ-Tã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’ã¤ã‘ã‚‹ï¼ $ ssh -l @ -p 22 -i -T ãƒ»-lï¼Œ-pï¼Œï¼Œ-iï¼Œ-Tï¼Œ-vvv # -vvvï¼šãƒ­ã‚°ã‚’å‡ºåŠ›ã™ã‚‹ $ ssh -l @ -p 22 -i -T -vvv ãƒ»è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆ~/.ssh/configï¼‰ è¨­å®šãŒé¢å€’ãªsshã‚³ãƒãƒ³ãƒ‰ã®ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã®å¼•æ•°ã‚’ï¼Œ~/.ssh/configãƒ•ã‚¡ã‚¤ãƒ«ã«è¨˜è¿°ã—ã¦ãŠãï¼ # ã‚µãƒ¼ãƒï¼‘ Host User Port 22 HostName IdentityFile # ã‚µãƒ¼ãƒï¼’ Host User Port 22 HostName IdentityFile ã“ã‚Œã«ã‚ˆã‚Šï¼Œã‚³ãƒãƒ³ãƒ‰å®Ÿè¡Œæ™‚ã®å€¤æ¸¡ã—ã‚’çœç•¥ã§ãã‚‹ï¼ttyï¼ˆæ“¬ä¼¼ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ï¼‰ã‚’ä½¿ç”¨ã™ã‚‹å ´åˆã¯ï¼Œ-Tã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’ã¤ã‘ã‚‹ï¼ # ç§˜å¯†éµã®æ¨©é™ã¯ï¼Œäº‹å‰ã«ã€Œ600ã€ã«ã—ã¦ãŠã $ ssh -T 04-03. ãƒ—ãƒ­ã‚»ã‚¹ç³» psï¼š process status ãƒ»-aux ç¨¼åƒã—ã¦ã„ã‚‹ãƒ—ãƒ­ã‚»ã‚¹ã®è©³ç´°æƒ…å ±ã‚’è¡¨ç¤ºã™ã‚‹ãŸã‚ã®ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ï¼ # ç¨¼åƒã—ã¦ã„ã‚‹ãƒ—ãƒ­ã‚»ã‚¹ã®ã†ã¡ï¼Œè©³ç´°æƒ…å ±ã«ã€Œxxxã€ã‚’å«ã‚€ã‚‚ã®ã‚’è¡¨ç¤ºã™ã‚‹ï¼ $ ps -aux | grep \"\" systemctlï¼šsystem controlï¼ˆæ—§serviceï¼‰ ãƒ»systemctlã¨ã¯ ãƒ‡ãƒ¼ãƒ¢ãƒ³ã‚’èµ·å‹•ã™ã‚‹systemdã‚’åˆ¶å¾¡ã™ã‚‹ãŸã‚ã®ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ï¼ ãƒ»list-unit-files ãƒ‡ãƒ¼ãƒ¢ãƒ³ã®Unitã‚’ä¸€è¦§ã§ç¢ºèªã™ã‚‹ï¼ $ systemctl list-unit-files --type=service crond.service enabled # enableï¼šè‡ªå‹•èµ·å‹•ã™ã‚‹ supervisord.service disabled # disableï¼šè‡ªå‹•èµ·å‹•ã—ãªã„ systemd-reboot.service static # enableï¼šä»–ã‚µãƒ¼ãƒ“ã‚¹ä¾å­˜ ãƒ»enable ãƒã‚·ãƒ³èµ·å‹•æ™‚ã«ãƒ‡ãƒ¼ãƒ¢ãƒ³ãŒè‡ªå‹•èµ·å‹•ã™ã‚‹ã‚ˆã†ã«è¨­å®šã™ã‚‹ï¼ $ systemctl enable # ä¾‹ï¼šCronï¼ŒApache $ systemctl enable crond.service $ systemctl enable httpd.service ãƒ»disable ãƒã‚·ãƒ³èµ·å‹•æ™‚ã«ãƒ‡ãƒ¼ãƒ¢ãƒ³ãŒè‡ªå‹•èµ·å‹•ã—ãªã„ã‚ˆã†ã«è¨­å®šã™ã‚‹ï¼ $ systemctl disable # ä¾‹ï¼šCronï¼ŒApache $ systemctl disable crond.service $ systemctl disable httpd.service ãƒ»systemdï¼šsystem daemon ã®Unitã®ç¨®é¡ å„ãƒ‡ãƒ¼ãƒ¢ãƒ³ã‚’ï¼Œ/usr/lib/systemd/systemã‚„/etc/systemd/systemä¸‹ã§Unitåˆ¥ã«ç®¡ç†ã—ï¼ŒUnitã”ã¨ã«èµ·å‹•ã™ã‚‹ï¼Unitã¯æ‹¡å¼µå­ã®é•ã„ã§åˆ¤åˆ¥ã™ã‚‹ï¼ Unitã®æ‹¡å¼µå­ æ„å‘³ ãƒ‡ãƒ¼ãƒ¢ãƒ³ä¾‹ mount ãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒã‚¦ãƒ³ãƒˆã«é–¢ã™ã‚‹ãƒ‡ãƒ¼ãƒ¢ãƒ³ï¼ service ãƒ—ãƒ­ã‚»ã‚¹èµ·å‹•åœæ­¢ã«é–¢ã™ã‚‹ãƒ‡ãƒ¼ãƒ¢ãƒ³ï¼ httpdï¼šhttp daemon socket ã‚½ã‚±ãƒƒãƒˆã¨ãƒ—ãƒ­ã‚»ã‚¹ã®ç´ä»˜ã‘ã«é–¢ã™ã‚‹ãƒ‡ãƒ¼ãƒ¢ãƒ³ kill ãƒ»-9 æŒ‡å®šã—ãŸPIDã®ãƒ—ãƒ­ã‚»ã‚¹ã‚’å‰Šé™¤ã™ã‚‹ï¼ $ kill -9 æŒ‡å®šã—ãŸã‚³ãƒãƒ³ãƒ‰ã«ã‚ˆã‚‹ãƒ—ãƒ­ã‚»ã‚¹ã‚’å…¨ã¦å‰Šé™¤ã™ã‚‹ï¼ $ sudo pgrep -f | sudo xargs kill -9 cron ãƒ»cronã¨ã¯ æŒ‡å®šã—ãŸã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ã«å¾“ã£ã¦ï¼ŒæŒ‡å®šã•ã‚ŒãŸãƒ—ãƒ­ã‚°ãƒ©ãƒ ã‚’å®šæœŸå®Ÿè¡Œã™ã‚‹å¸¸é§ãƒ—ãƒ­ã‚°ãƒ©ãƒ ï¼ ãƒ»cronãƒ•ã‚¡ã‚¤ãƒ« ãƒ•ã‚¡ã‚¤ãƒ«åãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªå åˆ©ç”¨è€… ä¸»ãªç”¨é€” /etc/crontab root æ¯æ™‚ï¼Œæ¯æ—¥ï¼Œæ¯æœˆï¼Œæ¯é€±ã®è‡ªå‹•ã‚¿ã‚¹ã‚¯ã®ãƒ¡ã‚¤ãƒ³è¨­å®šãƒ•ã‚¡ã‚¤ãƒ« /etc/cron.hourly root æ¯æ™‚å®Ÿè¡Œã•ã‚Œã‚‹è‡ªå‹•ã‚¿ã‚¹ã‚¯è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç½®ããƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª /etc/cron.daily root æ¯æ—¥å®Ÿè¡Œã•ã‚Œã‚‹è‡ªå‹•ã‚¿ã‚¹ã‚¯è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç½®ããƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª /etc/cron.monthly root æ¯æœˆå®Ÿè¡Œã•ã‚Œã‚‹è‡ªå‹•ã‚¿ã‚¹ã‚¯è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç½®ããƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª /etc/cron.weekly root æ¯é€±å®Ÿè¡Œã•ã‚Œã‚‹è‡ªå‹•ã‚¿ã‚¹ã‚¯è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç½®ããƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª ï¼Šå®Ÿè£…ä¾‹ï¼Š ã‚ã‚‰ã‹ã˜ã‚ï¼Œå„ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«cronãƒ•ã‚¡ã‚¤ãƒ«ã‚’é…ç½®ã—ã¦ãŠãï¼ cronã¨ã—ã¦ç™»éŒ²ã™ã‚‹ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã™ã‚‹ï¼run-partsã‚³ãƒãƒ³ãƒ‰ã§ï¼ŒæŒ‡å®šã—ãŸæ™‚é–“ã«ï¼Œå„cronãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªå†…ã®cronãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä¸€æ‹¬ã§å®Ÿè¡Œã™ã‚‹ã‚ˆã†ã«è¨˜è¿°ã—ã¦ãŠãï¼ # è¨­å®š SHELL=/bin/bash PATH=/sbin:/bin:/usr/sbin:/usr/bin MAILTO=\"example@gmail.com\" LANG=ja_JP.UTF-8 LC_ALL=ja_JP.UTF-8 CONTENT_TYPE=text/plain; charset=UTF-8 # For details see man 4 crontabs # Example of job definition: # .---------------- minute (0 - 59) # | .------------- hour (0 - 23) # | | .---------- day of month (1 - 31) # | | | .------- month (1 - 12) OR jan,feb,mar,apr ... # | | | | .---- day of week (0 - 6) (Sunday=0 or 7) OR sun,mon,tue,wed,thu,fri,sat # | | | | | # * * * * * user-name command to be executed # run-parts 1 * * * * root run-parts /etc/cron.hourly # æ¯æ™‚ãƒ»1åˆ† 5 2 * * * root run-parts /etc/cron.daily # æ¯æ—¥ãƒ»2æ™‚5åˆ† 20 2 * * 0 root run-parts /etc/cron.weekly # æ¯é€±æ—¥æ›œæ—¥ãƒ»2æ™‚20åˆ† 40 2 1 * * root run-parts /etc/cron.monthly # æ¯æœˆä¸€æ—¥ãƒ»2æ™‚40åˆ† @reboot make clean html # cronèµ·å‹•æ™‚ã«ä¸€åº¦ã ã‘ ãƒ»cron.dãƒ•ã‚¡ã‚¤ãƒ« è¤‡æ•°ã®cronãƒ•ã‚¡ã‚¤ãƒ«ã§å…¨ã¦ã®ä¸€ã¤ã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã§ç®¡ç†ã™ã‚‹å ´åˆã«ç”¨ã„ã‚‹ï¼ ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªå åˆ©ç”¨è€… ä¸»ãªç”¨é€” /etc/cron.d root ä¸Šè¨˜ä»¥å¤–ã®è‡ªå‹•ã‚¿ã‚¹ã‚¯è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç½®ããƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª ãƒ»supervisorã¨ã®çµ„ã¿åˆã‚ã› ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒï¼ŒOSä¸Šã®ãƒ—ãƒ­ã‚»ã‚¹ã‚’åˆ¶å¾¡ã§ãã‚‹ã‚ˆã†ã«ã™ã‚‹ãŸã‚ã®ãƒ—ãƒ­ã‚°ãƒ©ãƒ ï¼ # ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ« $ pip3 install supervisor # /etc/supervisor/supervisord.conf ã«è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç½®ã„ã¦èµ·å‹•ï¼ $ /usr/local/bin/supervisord ä»¥ä¸‹ã«è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã®ä¾‹ã‚’ç¤ºã™ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š [supervisord] # å®Ÿè¡Œãƒ¦ãƒ¼ã‚¶ user=root # ãƒ•ã‚©ã‚¢ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ã§èµ·å‹• nodaemon=true # ãƒ­ã‚° logfile=/var/log/supervisord.log # Pid pidfile=/var/tmp/supervisord.pid [program:crond] # å®Ÿè¡Œã‚³ãƒãƒ³ãƒ‰ command=/usr/sbin/crond -n # ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã®è‡ªå‹•èµ·å‹• autostart=true # ãƒ—ãƒ­ã‚°ãƒ©ãƒ åœæ­¢å¾Œã®å†èµ·å‹• autorestart=true # ã‚³ãƒãƒ³ãƒ‰ã®å®Ÿè¡Œãƒ­ã‚° stdout_logfile=/var/log/command.log stderr_logfile=/var/log/command-error.log # ã‚³ãƒãƒ³ãƒ‰ã®å®Ÿè¡Œãƒ¦ãƒ¼ã‚¶ user=root # ã‚³ãƒãƒ³ãƒ‰ã®å®Ÿè¡Œãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª directory=/var/www/tech-notebook crontab ãƒ»crontabã¨ã¯ cronãƒ‡ãƒ¼ãƒ¢ãƒ³ã®å‹•ä½œãŒå®šç¾©ã•ã‚ŒãŸcrontabãƒ•ã‚¡ã‚¤ãƒ«ã‚’æ“ä½œã™ã‚‹ãŸã‚ã®ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ï¼ ãƒ»ã‚ªãƒ—ã‚·ãƒ§ãƒ³ç„¡ã— ä½œæˆã—ãŸcronãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç™»éŒ²ã™ã‚‹ï¼cron.dãƒ•ã‚¡ã‚¤ãƒ«ã¯æ“ä½œã§ããªã„ï¼ $ crontab ãƒ»ç™»éŒ²ã•ã‚ŒãŸcronãƒ•ã‚¡ã‚¤ãƒ«ã®å‡¦ç†ã‚’ç¢ºèª $ crontab -l # crontabã‚³ãƒãƒ³ãƒ‰ã§ç™»éŒ²ã•ã‚ŒãŸcronãƒ•ã‚¡ã‚¤ãƒ«ã®å‡¦ç† 1 * * * * rm foo ãƒ»cronãƒ•ã‚¡ã‚¤ãƒ«ã®ç™»éŒ²æ‰‹é † ï¼Šå®Ÿè£…ä¾‹ï¼Š ï¼‘. æ‹¡å¼µå­ã¯è‡ªç”±ã§ï¼Œæ™‚åˆ»ã¨ã‚³ãƒãƒ³ãƒ‰ãŒå®Ÿè£…ã•ã‚ŒãŸãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç”¨æ„ã™ã‚‹ï¼ã“ã®æ™‚ï¼Œæœ€å¾Œã«æ”¹è¡ŒãŒãªã„ã¨ã‚¨ãƒ©ãƒ¼ï¼ˆpremature EOFï¼‰ã«ãªã‚‹ãŸã‚ï¼Œæ”¹è¡Œã‚’è¿½åŠ ã™ã‚‹ï¼ å‚è€ƒï¼š # cron-hourly.txt # æ¯æ™‚ãƒ»1åˆ† 1 * * * * root run-parts /etc/cron.hourly # cron-daily.txt # æ¯æ—¥ãƒ»2æ™‚5åˆ† 5 2 * * * root run-parts /etc/cron.daily # cron-monthly.txt # æ¯é€±æ—¥æ›œæ—¥ãƒ»2æ™‚20åˆ† 20 2 * * 0 root run-parts /etc/cron.weekly # cron-weekly.txt # æ¯æœˆä¸€æ—¥ãƒ»2æ™‚40åˆ† 40 2 1 * * root run-parts /etc/cron.monthly # cronèµ·å‹•æ™‚ã«ä¸€åº¦ã ã‘ @reboot make clean html ï¼’. ã“ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’crontabã‚³ãƒãƒ³ãƒ‰ã§ç™»éŒ²ã™ã‚‹ï¼cronãƒ•ã‚¡ã‚¤ãƒ«ã®å®Ÿä½“ã¯ãªã„ã“ã¨ã¨ï¼Œãƒ•ã‚¡ã‚¤ãƒ«ã®å†…å®¹ã‚’å¤‰æ›´ã—ãŸå ´åˆã¯ç™»éŒ²ã—ç›´ã•ãªã‘ã‚Œã°ã„ã‘ãªã„ã“ã¨ã«æ³¨æ„ã™ã‚‹ï¼ $ crontab /foo/cron-hourly.txt ï¼“. ç™»éŒ²ã•ã‚Œã¦ã„ã‚‹å‡¦ç†ã‚’ç¢ºèªã™ã‚‹ï¼ $ crontab -l 1 * * * * root run-parts /etc/cron.hourly ï¼”. ãƒ­ã‚°ã«è¡¨ç¤ºã•ã‚Œã¦ã„ã‚‹ã‹ã‚’ç¢ºèªï¼ $ cd /var/log $ tail -f cron ï¼•. æ”¹è¡Œã‚³ãƒ¼ãƒ‰ã‚’ç¢ºèªï¼æ”¹è¡Œã‚³ãƒ¼ãƒ‰ãŒè¡¨ç¤ºã•ã‚Œãªã„å ´åˆã¯LFã§ã‚ã‚Šï¼Œå•é¡Œãªã„ï¼ $ file /foo/cron-hourly.txt foo.txt: ASCII text crond ãƒ»crondã¨ã¯ cronãƒ‡ãƒ¼ãƒ¢ãƒ³ã‚’èµ·å‹•ã™ã‚‹ãŸã‚ã®ãƒ—ãƒ­ã‚°ãƒ©ãƒ  ãƒ»-n ãƒ•ã‚©ã‚¢ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ãƒ—ãƒ­ã‚»ã‚¹ã¨ã—ã¦cronã‚’èµ·å‹• $ crond -n 04-04. ãƒ†ã‚­ã‚¹ãƒˆå‡¦ç†ç³» vimï¼šVi Imitaionï¼ŒVi Improved ãƒ»ã‚ªãƒ—ã‚·ãƒ§ãƒ³ç„¡ã— vimä¸Šã§ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é–‹ãï¼ $ vim history ãƒ»ã‚ªãƒ—ã‚·ãƒ§ãƒ³ç„¡ã— å±¥æ­´1000ä»¶ã®ä¸­ã‹ã‚‰ã‚³ãƒãƒ³ãƒ‰ã‚’æ¤œç´¢ã™ã‚‹ï¼ $ history | grep tr #!/bin/bash cat ./src.txt | tr \"\\n\" \",\" > ./dst.txt 04-05. ç’°å¢ƒå¤‰æ•°ç³» export ãƒ»ã‚ªãƒ—ã‚·ãƒ§ãƒ³ç„¡ã— åŸºæœ¬çš„ãªæ‰‹é †ã¨ã—ã¦ã¯ï¼Œã‚·ã‚§ãƒ«å¤‰æ•°ã‚’è¨­å®šã—ï¼Œã“ã‚Œã‚’ç’°å¢ƒå¤‰æ•°ã«è¿½åŠ ã™ã‚‹ï¼ # ã‚·ã‚§ãƒ«å¤‰æ•°ã‚’è¨­å®š $ PATH=$PATH: # ç’°å¢ƒå¤‰æ•°ã«è¿½åŠ  $ export PATH ã‚·ã‚§ãƒ«å¤‰æ•°ã®è¨­å®šã¨ï¼Œç’°å¢ƒå¤‰æ•°ã¸ã®è¿½åŠ ã¯ï¼Œä»¥ä¸‹ã®é€šã‚ŠåŒæ™‚ã«è¨˜è¿°ã§ãã‚‹ï¼ # ç’°çŠ¶å¤‰æ•°ã¨ã—ã¦ï¼ŒæŒ‡å®šã—ãŸãƒã‚¤ãƒŠãƒªãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆbinï¼‰ã®ã‚ã‚‹ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã¸ã®çµ¶å¯¾ãƒ‘ã‚¹ã‚’è¿½åŠ ï¼ # ãƒã‚¤ãƒŠãƒªãƒ•ã‚¡ã‚¤ãƒ«ã‚’å…¥åŠ›ã™ã‚‹ã¨ï¼Œçµ¶å¯¾ãƒ‘ã‚¹ $ export PATH=$PATH: # ä¸è¦ãªãƒ‘ã‚¹ã‚’å‰Šé™¤ã—ãŸã„å ´åˆã¯ã“ã¡ã‚‰ # ç’°çŠ¶å¤‰æ•°ã¨ã—ã¦ï¼ŒæŒ‡å®šã—ãŸãƒã‚¤ãƒŠãƒªãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆbinï¼‰ã®ã‚ã‚‹ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã¸ã®çµ¶å¯¾ãƒ‘ã‚¹ã‚’ä¸Šæ›¸ã $ export PATH=/sbin:/bin:/usr/sbin:/usr/bin ãƒ».bashrcã¸ã®è¿½è¨˜ exportã®çµæœã¯ï¼ŒOSã®å†èµ·å‹•ã§åˆæœŸåŒ–ã•ã‚Œã¦ã—ã¾ã†ï¼ãã®ãŸã‚ï¼Œå†èµ·å‹•æ™‚ã«è‡ªå‹•çš„ã«å®Ÿè¡Œã•ã‚Œã‚‹ã‚ˆã†ï¼Œ/home/centos/.bashrcã«è¿½è¨˜ã—ã¦ãŠãï¼ # Source global definitions if [ -f /etc/bashrc ]; then . /etc/bashrc fi # User specific environment PATH=\"$HOME/.local/bin:$HOME/bin:$PATH\" # xxxãƒã‚¤ãƒŠãƒªãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒ‘ã‚¹ã‚’è¿½åŠ  ã‚’è¿½åŠ  printenv ãƒ»ã‚ªãƒ—ã‚·ãƒ§ãƒ³ç„¡ã— å…¨ã¦ã®ç’°å¢ƒå¤‰æ•°ã‚’è¡¨ç¤ºã™ã‚‹ï¼ $ printenv ã¾ãŸï¼Œç‰¹å®šã®ç’°å¢ƒå¤‰æ•°ã‚’è¡¨ç¤ºã™ã‚‹ï¼ $ printenv VAR timedatactl ãƒ»set-timezone # ã‚¿ã‚¤ãƒ ã‚¾ãƒ¼ãƒ³ã‚’æ—¥æœ¬æ™‚é–“ã«å¤‰æ›´ $ timedatectl set-timezone Asia/Tokyo # ã‚¿ã‚¤ãƒ ã‚¾ãƒ¼ãƒ³ãŒå¤‰æ›´ã•ã‚ŒãŸã‹ã‚’ç¢ºèª $ date 04-06. ãƒãƒ¼ãƒ‰ã‚¦ã‚§ã‚¢ç³» top ãƒ»ã‚ªãƒ—ã‚·ãƒ§ãƒ³ç„¡ã— å„ãƒ—ãƒ­ã‚»ã‚¹ã®ç¨¼åƒæƒ…å ±ï¼ˆãƒ¦ãƒ¼ã‚¶åï¼ŒCPUï¼Œãƒ¡ãƒ¢ãƒªï¼‰ã‚’ç¢ºèªã™ã‚‹ï¼ CPUä½¿ç”¨ç‡æ˜‡é †ã«ä¸¦ã¹ã‚‹ $ top ãƒ»-a ãƒ¡ãƒ¢ãƒªä½¿ç”¨ç‡æ˜‡é †ã«ä¸¦ã¹ã‚‹ï¼ $ top -a free ãƒ»-mï¼Œ-total ç‰©ç†ãƒ¡ãƒ¢ãƒªï¼Œã‚¹ãƒ¯ãƒƒãƒ—é ˜åŸŸï¼Œã®ä½¿ç”¨çŠ¶æ³ã‚’ãƒ¡ã‚¬ãƒã‚¤ãƒˆã§ç¢ºèªã™ã‚‹ï¼ # mï¼šMega Bytes # t: -total $ free -m -total df ãƒ»-hï¼Œ-mï¼Œ-t ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã®ä½¿ç”¨çŠ¶æ³ã‚’ãƒ¡ã‚¬ãƒã‚¤ãƒˆã§ç¢ºèªã™ã‚‹ï¼ # hï¼š--human-readable # t: -total $ df -h -m -t mkswapï¼Œswaponï¼Œswapoff ãƒ»ã‚¹ãƒ¯ãƒƒãƒ”ãƒ³ã‚°æ–¹å¼ ç‰©ç†ãƒ¡ãƒ¢ãƒªã®ã‚¢ãƒ‰ãƒ¬ã‚¹ç©ºé–“ç®¡ç†ã®æ–¹æ³•ã®ä¸€ã¤ï¼ãƒãƒ¼ãƒ‰ã‚¦ã‚§ã‚¢ã®ãƒãƒ¼ãƒˆã‚’å‚ç…§ï¼ ãƒ»ã‚¹ãƒ¯ãƒƒãƒ—é ˜åŸŸã®ä½œæˆæ–¹æ³• # æŒ‡å®šã—ãŸãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’ã‚¹ãƒ¯ãƒƒãƒ—é ˜åŸŸã¨ã—ã¦ä½¿ç”¨ $ mkswap /swap_volume # ã‚¹ãƒ¯ãƒƒãƒ—é ˜åŸŸã‚’æœ‰åŠ¹åŒ– # å„ªå…ˆåº¦ã®ãƒ—ãƒ­ã‚°ãƒ©ãƒ ãŒï¼Œãƒ¡ãƒ¢ãƒªã‹ã‚‰ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ï¼Œä¸€æ™‚çš„ã«é€€é¿ã•ã‚Œã‚‹ã‚ˆã†ã«ãªã‚‹ $ swapon /swap_volume # ã‚¹ãƒ¯ãƒƒãƒ—é ˜åŸŸã®ä½¿ç”¨çŠ¶æ³ã‚’ç¢ºèª $ swapon -s # ã‚¹ãƒ¯ãƒƒãƒ—é ˜åŸŸã‚’ç„¡åŠ¹åŒ– $ swapoff /swap_volume 05. ç®¡ç†ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ ç®¡ç†ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ã®ç¨®é¡ ãƒ»ç®¡ç†ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ã®å¯¾è±¡ æ§˜ã€…ãªãƒ¬ãƒ™ãƒ«ã‚’å¯¾è±¡ã«ã—ãŸç®¡ç†ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ãŒã‚ã‚‹ï¼ ãƒ»ãƒ©ã‚¤ãƒ–ãƒ©ãƒªç®¡ç†ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£å å¯¾è±¡ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°è¨€èª composer.pharï¼šComposer PHP pipï¼šPackage Installer for Python Python npmï¼šNode Package Manager Node.js mavenï¼šApache Maven Java gemï¼šRuby Gems Ruby ãƒ»ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ç®¡ç†ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£å å¯¾è±¡OS ä¾å­˜é–¢ä¿‚ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«å¯å¦ Rpmï¼šRed Hat Package Manager RedHatç³» âœ• Yumï¼šYellow dog Updater ModifiedDNFï¼šDandified Yum RedHatç³» ã€‡ Aptï¼šAdvanced Packaging Tool Debianç³» ã€‡ Apkï¼šAlpine Linux package management Alpine Linux ã€‡ ãƒ»è¨€èªãƒãƒ¼ã‚¸ãƒ§ãƒ³ç®¡ç†ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£å å¯¾è±¡ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°è¨€èª phpenv PHP pyenv Python rbenv Ruby 05-02. ãƒ©ã‚¤ãƒ–ãƒ©ãƒªç®¡ç†ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ pip ãƒ»install æŒ‡å®šã—ãŸãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹ï¼ # /usr/local ä»¥ä¸‹ã«ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ« $ pip install --user # requirements.txt ã‚’å…ƒã«ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ« $ pip install -r requirements.txt # æŒ‡å®šã—ãŸãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ« pip install -r requirements.txtã€€--prefix=/usr/local ãƒ»freeze pipã§ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚ŒãŸãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’å…ƒã«ï¼Œè¦ä»¶ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã™ã‚‹ï¼ $ pip freeze > requirements.txt ãƒ»show pipã§ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ãŸãƒ‘ãƒƒã‚±ãƒ¼ã‚¸æƒ…å ±ã‚’è¡¨ç¤ºã™ã‚‹ï¼ $ pip show sphinx Name: Sphinx Version: 3.2.1 Summary: Python documentation generator Home-page: http://sphinx-doc.org/ Author: Georg Brandl Author-email: georg@python.org License: BSD # ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«å ´æ‰€ Location: /usr/local/lib/python3.8/site-packages # ã“ã®ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®ä¾å­˜å¯¾è±¡ Requires: sphinxcontrib-applehelp, imagesize, docutils, sphinxcontrib-serializinghtml, snowballstemmer, sphinxcontrib-htmlhelp, sphinxcontrib-devhelp, sphinxcontrib-jsmath, setuptools, packaging, Pygments, babel, alabaster, sphinxcontrib-qthelp, requests, Jinja2 # ã“ã®ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’ä¾å­˜å¯¾è±¡ã¨ã—ã¦ã„ã‚‹ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ Required-by: sphinxcontrib.sqltable, sphinx-rtd-theme, recommonmark npm ãƒ»å…¥æ‰‹æ–¹æ³• # ãƒªãƒã‚¸ãƒˆãƒªã®ä½œæˆ $ curl -sL https://rpm.nodesource.com/setup_.x | bash - # nodejsã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã«npmã‚‚å«ã¾ã‚Œã‚‹ $ yum install nodejs ãƒ»init package.jsonã‚’ç”Ÿæˆã™ã‚‹ï¼ $ npm init ãƒ»install ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ« # ãƒ­ãƒ¼ã‚«ãƒ«ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ« $ npm install # ã‚°ãƒ­ãƒ¼ãƒãƒ«ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ï¼ˆã‚ã¾ã‚Šä½¿ã‚ãªã„ï¼‰ $ npm install -g 05-03. ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ç®¡ç†ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ rpm ãƒ»-ivh ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã¾ãŸã¯æ›´æ–°ã™ã‚‹ï¼ä¸€åº¦ã«è¤‡æ•°ã®ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’çµ„ã¿åˆã‚ã›ã¦è¨˜è¿°ã™ã‚‹ï¼ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æ™‚ã«ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸é–“ã®ä¾å­˜é–¢ä¿‚ã‚’è§£æ±ºã§ããªã„ã®ã§æ³¨æ„ï¼ # ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ« # -ivhï¼š--install -v --hash $ rpm -ivh # ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’æ›´æ–° # -Uvhï¼š--upgrade -v --hash $ rpm -Uvh ãƒ»-qa ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚ŒãŸå…¨ã¦ã®ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®ä¸­ã§ï¼ŒæŒ‡å®šã—ãŸæ–‡å­—ã‚’åå‰ã«å«ã‚€ã‚‚ã®ã‚’è¡¨ç¤ºã™ã‚‹ï¼ # -qaï¼š $ rpm -qa | grep ãƒ»-ql æŒ‡å®šã—ãŸãƒ‘ãƒƒã‚±ãƒ¼ã‚¸åã§ï¼Œé–¢é€£ã™ã‚‹å…¨ã¦ã®ãƒ•ã‚¡ã‚¤ãƒ«ã®å ´æ‰€ã‚’è¡¨ç¤ºã™ã‚‹ï¼ # -qlï¼š $ rpm -ql ãƒ»-qi æŒ‡å®šã—ãŸãƒ‘ãƒƒã‚±ãƒ¼ã‚¸åã§ï¼Œã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æ—¥ãªã©ã®æƒ…å ±ã‚’è¡¨ç¤ºã™ã‚‹ï¼ # -qiï¼š $ rpm -qi yumï¼Œdnf ãƒ»installï¼Œreinstall rpmã¨åŒæ§˜ã®ä½¿ã„æ–¹ãŒã§ãã‚‹ï¼ã¾ãŸï¼Œã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æ™‚ã«ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸é–“ã®ä¾å­˜é–¢ä¿‚ã‚’è§£æ±ºã§ãã‚‹ï¼ # ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ« $ yum install -y # å†ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹æ™‚ã¯ï¼Œreinstallã¨ã™ã‚‹ã“ã¨ $ yum reinstall -y ãƒ»list ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚ŒãŸå…¨ã¦ã®ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’è¡¨ç¤ºã™ã‚‹ï¼ # æŒ‡å®šã—ãŸæ–‡å­—ã‚’åå‰ã«å«ã‚€ã‚‚ã®ã‚’è¡¨ç¤ºï¼ $ yum list | grep ãƒ»EPELãƒªãƒã‚¸ãƒˆãƒªï¼ŒRemiãƒªãƒã‚¸ãƒˆãƒª CentOSå…¬å¼ãƒªãƒã‚¸ãƒˆãƒªã¯ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ãŒå¤ã„ã“ã¨ãŒã‚ã‚‹ï¼ãã“ã§ï¼Œ--enablerepoã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’ä½¿ç”¨ã™ã‚‹ã¨ï¼ŒCentOSå…¬å¼ãƒªãƒã‚¸ãƒˆãƒªã§ã¯ãªãï¼Œæœ€æ–°ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’æ‰±ã†å¤–éƒ¨ãƒªãƒã‚¸ãƒˆãƒªï¼ˆEPELï¼ŒRemiï¼‰ã‹ã‚‰ï¼Œãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã§ãã‚‹ï¼å¤–éƒ¨ãƒªãƒã‚¸ãƒˆãƒªé–“ã§ä¾å­˜é–¢ä¿‚ã«ã‚ã‚‹ãŸã‚ï¼Œä¸¡æ–¹ã®ãƒªãƒã‚¸ãƒˆãƒªã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹å¿…è¦ãŒã‚ã‚‹ï¼ CentOSã®EPELãƒªãƒã‚¸ãƒˆãƒªã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ï¼ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æ™‚ã®è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã¯ï¼Œ/etc/yu.repos.d/* ã«é…ç½®ã•ã‚Œã‚‹ï¼ # CentOS7ç³»ã®å ´åˆ $ yum install -y https://dl.fedoraproject.org/pub/epel/epel-release-latest-7.noarch.rpm # CentOS8ç³»ã®å ´åˆ $ dnf install -y https://dl.fedoraproject.org/pub/epel/epel-release-latest-8.noarch.rpm # ã“ã¡ã‚‰ã§ã‚‚ã‚ˆã„ $ yum install -y epel-release ã§ã‚‚ã‚ˆã„ CentOSã®Remiãƒªãƒã‚¸ãƒˆãƒªã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ï¼Remiãƒãƒ¼ã‚¸ãƒ§ãƒ³ã¯CentOSãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’è¦ç¢ºèªï¼ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æ™‚ã®è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã¯ï¼Œ/etc/yu.repos.d/*ã«é…ç½®ã•ã‚Œã‚‹ï¼ # CentOS7ç³»ã®å ´åˆ $ yum install -y https://rpms.remirepo.net/enterprise/remi-release-7.rpm # CentOS8ç³»ã®å ´åˆ $ dnf install -y https://rpms.remirepo.net/enterprise/remi-release-8.rpm è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã¸ã¯ï¼Œã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«å…ˆã®ãƒªãƒ³ã‚¯ãªã©ãŒè‡ªå‹•çš„ã«æ›¸ãè¾¼ã¾ã‚Œã‚‹ï¼ [epel] name=Extra Packages for Enterprise Linux 6 - $basearch #baseurl=http://download.fedoraproject.org/pub/epel/6/$basearch mirrorlist=https://mirrors.fedoraproject.org/metalink?repo=epel-6&arch=$basearch failovermethod=priority enabled=0 gpgcheck=1 gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-EPEL-6 [epel-debuginfo] name=Extra Packages for Enterprise Linux 6 - $basearch - Debug #baseurl=http://download.fedoraproject.org/pub/epel/6/$basearch/debug mirrorlist=https://mirrors.fedoraproject.org/metalink?repo=epel-debug-6&arch=$basearch failovermethod=priority enabled=0 gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-EPEL-6 gpgcheck=1 [epel-source] name=Extra Packages for Enterprise Linux 6 - $basearch - Source #baseurl=http://download.fedoraproject.org/pub/epel/6/SRPMS mirrorlist=https://mirrors.fedoraproject.org/metalink?repo=epel-source-6&arch=$basearch failovermethod=priority enabled=0 gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-EPEL-6 gpgcheck=1 Remiãƒªãƒã‚¸ãƒˆãƒªã®æœ‰åŠ¹åŒ–ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’æ°¸ç¶šçš„ã«ä½¿ç”¨ã§ãã‚‹ã‚ˆã†ã«ã™ã‚‹ï¼ # CentOS7ã®å ´åˆ $ yum install -y yum-utils # æ°¸ç¶šçš„ã«æœ‰åŠ¹åŒ– $ yum-config-manager --enable remi-php74 # CentOS8ã®å ´åˆï¼ˆdnf moduleã‚³ãƒãƒ³ãƒ‰ã‚’ä½¿ç”¨ï¼‰ $ dnf module enable php:remi-7.4 remiãƒªãƒã‚¸ãƒˆãƒªã‚’æŒ‡å®šã—ã¦ï¼Œphpï¼Œphp-mbstringï¼Œphp-mcryptã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹ï¼Remiãƒªãƒã‚¸ãƒˆãƒªã‚’çµŒç”±ã—ã¦ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ãŸã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ã¯/opt/remi/*ã«é…ç½®ã•ã‚Œã‚‹ï¼ # CentOS7ã®å ´åˆ # ä¸€æ™‚çš„ã«æœ‰åŠ¹åŒ–ã§ãã‚‹ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’åˆ©ç”¨ã—ã¦ï¼Œæ˜ç¤ºçš„ã«remiã‚’æŒ‡å®š $ yum install --enablerepo=remi,remi-php74 -y php php-mbstring php-mcrypt # CentOS8ã®å ´åˆ # ãƒªãƒã‚¸ãƒˆãƒªã®èªè­˜ã«å¤±æ•—ã™ã‚‹ã“ã¨ãŒã‚ã‚‹ã®ã§ã‚ªãƒ—ã‚·ãƒ§ãƒ³ãªã— $ dnf install -y php php-mbstring php-mcrypt å†ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹æ™‚ã¯ï¼Œreinstallã¨ã™ã‚‹ã“ã¨ï¼ # CentOS7ã®å ´åˆ # ä¸€æ™‚çš„ã«æœ‰åŠ¹åŒ–ã§ãã‚‹ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’åˆ©ç”¨ã—ã¦ï¼Œæ˜ç¤ºçš„ã«remiã‚’æŒ‡å®š $ yum reinstall --enablerepo=remi,remi-php74 -y php php-mbstring php-mcrypt # CentOS8ã®å ´åˆ # ãƒªãƒã‚¸ãƒˆãƒªã®èªè­˜ã«å¤±æ•—ã™ã‚‹ã“ã¨ãŒã‚ã‚‹ã®ã§ã‚ªãƒ—ã‚·ãƒ§ãƒ³ãªã— $ dnf reinstall -y php php-mbstring php-mcrypt 05-04. è¨€èªãƒãƒ¼ã‚¸ãƒ§ãƒ³ç®¡ç†ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ pyenv ãƒ»which # pythonã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’ç¢ºèª $ pyenv which python /.pyenv/versions/3.8.0/bin/python "},"public/software/software_basic_kernel.html":{"url":"public/software/software_basic_kernel.html","title":"ğŸ“– ï¸ã‚«ãƒ¼ãƒãƒ«","keywords":"","body":"åˆ¶å¾¡ãƒ—ãƒ­ã‚°ãƒ©ãƒ ï¼ˆã‚«ãƒ¼ãƒãƒ«ï¼‰ ã¯ã˜ã‚ã« æœ¬ã‚µã‚¤ãƒˆã«ã¤ãã¾ã—ã¦ï¼Œä»¥ä¸‹ã‚’ã”èªè­˜ã®ã»ã©å®œã—ããŠé¡˜ã„ã„ãŸã—ã¾ã™ï¼ å‚è€ƒï¼šhttps://hiroki-it.github.io/tech-notebook-gitbook/ 01. åˆ¶å¾¡ãƒ—ãƒ­ã‚°ãƒ©ãƒ ï¼ˆã‚«ãƒ¼ãƒãƒ«ï¼‰ ï¼ˆä¾‹ï¼‰ã‚«ãƒ¼ãƒãƒ«ï¼Œãƒã‚¤ã‚¯ãƒ­ã‚«ãƒ¼ãƒãƒ«ï¼Œãƒ¢ãƒãƒªã‚·ãƒƒã‚¯ã‚«ãƒ¼ãƒãƒ« 02. é€šä¿¡ç®¡ç† SELinuxï¼šSecurity Enhanced Linux Linuxã«æ¨™æº–ã§å°å…¥ã•ã‚Œã¦ã„ã‚‹ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢ï¼ãŸã ã—ï¼Œã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã¨ä»–ã®ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ã®é€šä¿¡ã‚’é®æ–­ã—ã¦ã—ã¾ã†ã“ã¨ãŒã‚ã‚‹ãŸã‚ï¼ŒåŸºæœ¬çš„ã«ã¯ç„¡åŠ¹ã«ã—ã¦ãŠãï¼ SELinuxã®çŠ¶æ…‹ã‚’ç¢ºèª $ getenforce # æœ‰åŠ¹ã®å ´åˆ Enforcing /etc/sellnux/configã‚’ä¿®æ­£ã™ã‚‹ï¼ # This file controls the state of SELinux on the system. # SELINUX= can take one of these three values: # enforcing - SELinux security policy is enforced. # permissive - SELinux prints warnings instead of enforcing. # disabled - No SELinux policy is loaded. SELINUX=disabled # OSã‚’å†èµ·å‹• OSã‚’å†èµ·å‹•ã—ãªã„ã¨è¨­å®šãŒåæ˜ ã•ã‚Œãªã„ï¼ 03 ã‚¸ãƒ§ãƒ–ç®¡ç† ã‚¸ãƒ§ãƒ–ç®¡ç†ã¨ã¯ ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã¯ï¼Œãƒã‚¹ã‚¿ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ã«å¯¾ã—ã¦ï¼Œã‚¸ãƒ§ãƒ–ã‚’å®Ÿè¡Œã™ã‚‹ãŸã‚ã®å‘½ä»¤ã‚’ä¸ãˆã‚‹ï¼ ãƒã‚¹ã‚¿ã‚¹ã‚±ã‚¸ãƒ¥ãƒ©ï¼Œã‚¸ãƒ§ãƒ–ã‚¹ã‚±ã‚¸ãƒ¥ãƒ© ã‚¸ãƒ§ãƒ–ã¨ã¯ï¼Œãƒ—ãƒ­ã‚»ã‚¹ã®ã‚»ãƒƒãƒˆã®ã“ã¨ï¼ãƒã‚¹ã‚¿ã‚¹ã‚±ã‚¸ãƒ¥ãƒ©ã¯ï¼Œã‚¸ãƒ§ãƒ–ã‚¹ã‚±ã‚¸ãƒ¥ãƒ©ã«ã‚¸ãƒ§ãƒ–ã®å®Ÿè¡Œã‚’å‘½ä»¤ã™ã‚‹ï¼ãƒ‡ãƒ¼ã‚¿ã‚’ã‚³ãƒ³ãƒ”ãƒ¥ãƒ¼ã‚¿ã«å…¥åŠ›ã—ï¼Œè¤‡æ•°ã®å‡¦ç†ãŒå®Ÿè¡Œã•ã‚Œï¼ŒçµæœãŒå‡ºåŠ›ã•ã‚Œã‚‹ã¾ã§ã®ä¸€é€£ã®å‡¦ç†ã®ã“ã¨ï¼ã€Taskã€ã¨ã€Jobã€ã®å®šç¾©ã¯æ›–æ˜§ãªã®ã§ï¼Œã€processã€ã¨ã€set of processesã€ã‚’ä½¿ã†ã¹ãã¨ã®ã“ã¨ï¼ å¼•ç”¨ï¼šhttps://stackoverflow.com/questions/3073948/job-task-and-process-whats-the-difference/31212568 è¤‡æ•°ã®ã‚¸ãƒ§ãƒ–ï¼ˆãƒ—ãƒ­ã‚°ãƒ©ãƒ ã‚„ãƒãƒƒãƒï¼‰ã®èµ·å‹•ã¨çµ‚äº†ã‚’åˆ¶å¾¡ã—ãŸã‚Šï¼Œã‚¸ãƒ§ãƒ–ã®å®Ÿè¡Œã¨çµ‚äº†ã‚’ç›£è¦–å ±å‘Šã™ã‚‹ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ï¼ã‚„ã‚„ã“ã—ã„ã“ã¨ã«ï¼Œã‚¿ã‚¹ã‚¯ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ©ã¨ã‚‚å‘¼ã¶ï¼ ãƒ»Reader ã‚¸ãƒ§ãƒ–å¾…ã¡è¡Œåˆ—ã«ç™»éŒ² ãƒ»Initiator ã‚¸ãƒ§ãƒ–ã‚¹ãƒ†ãƒƒãƒ—ã«åˆ†è§£ ãƒ»Terminator å‡ºåŠ›å¾…ã¡è¡Œåˆ—ã«ç™»éŒ² ãƒ»Writer å„ªå…ˆåº¦é †ã«å‡ºåŠ›ã®å‡¦ç†ãƒ•ãƒ­ãƒ¼ã‚’å®Ÿè¡Œ Initiatorã«ã‚ˆã‚‹ã‚¸ãƒ§ãƒ–ã®ã‚¸ãƒ§ãƒ–ã‚¹ãƒ†ãƒƒãƒ—ã¸ã®åˆ†è§£ Initiatorã«ã‚ˆã£ã¦ï¼Œã‚¸ãƒ§ãƒ–ã¯ã‚¸ãƒ§ãƒ–ã‚¹ãƒ†ãƒƒãƒ—ã«åˆ†è§£ã•ã‚Œã‚‹ï¼ 04. ã‚¿ã‚¹ã‚¯ç®¡ç† ã‚¿ã‚¹ã‚¯ç®¡ç†ã¨ã¯ ã‚¿ã‚¹ã‚¯ã¨ã¯ï¼Œã‚¹ãƒ¬ãƒƒãƒ‰ã«ä¼¼ãŸã‚ˆã†ãªï¼Œå˜ä¸€ã®ãƒ—ãƒ­ã‚»ã‚¹ã®ã“ã¨ï¼Initiatorã«ã‚ˆã‚‹ã‚¸ãƒ§ãƒ–ã‚¹ãƒ†ãƒƒãƒ—ã‹ã‚‰ï¼Œã‚¿ã‚¹ã‚¯ç®¡ç†ã«ã‚ˆã£ã¦ï¼Œã‚¿ã‚¹ã‚¯ãŒç”Ÿæˆã•ã‚Œã‚‹ï¼ã‚¿ã‚¹ã‚¯ãŒç”Ÿæˆã•ã‚Œã‚‹ã¨å®Ÿè¡Œå¯èƒ½çŠ¶æ…‹ã«ãªã‚‹ï¼ãƒ‡ã‚£ã‚¹ãƒ‘ãƒƒãƒãƒ£ã«ã‚ˆã£ã¦å®Ÿè¡Œå¯èƒ½çŠ¶æ…‹ã‹ã‚‰å®Ÿè¡ŒçŠ¶æ…‹ã«ãªã‚‹ï¼ å„ªå…ˆé †æ–¹å¼ å„ã‚¿ã‚¹ã‚¯ã«å„ªå…ˆåº¦ã‚’è¨­å®šã—ï¼Œå„ªå…ˆåº¦ã®é«˜ã„ã‚¿ã‚¹ã‚¯ã‹ã‚‰é †ã«ï¼Œãƒ‡ã‚£ã‚¹ãƒ‘ãƒƒãƒã—ã¦ã„ãæ–¹å¼ï¼ åˆ°ç€é †æ–¹å¼ å¾…ã¡è¡Œåˆ—ã«ç™»éŒ²ã•ã‚ŒãŸã‚¿ã‚¹ã‚¯ã‹ã‚‰é †ã«ï¼Œãƒ‡ã‚£ã‚¹ãƒ‘ãƒƒãƒã—ã¦ã„ãæ–¹å¼ï¼ ï¼Šä¾‹ï¼Š ä»¥ä¸‹ã®æ§˜ã«ï¼Œã‚¿ã‚¹ã‚¯ãŒCPUã«å‰²ã‚Šå½“ã¦ã‚‰ã‚Œã¦ã„ãï¼ Round robin æ–¹å¼ Round robinã¯ï¼Œã€ç·å½“ãŸã‚Šã€ã®æ„å‘³ï¼ä¸€å®šæ™‚é–“ï¼ˆã‚¿ã‚¤ãƒ ã‚¯ã‚¦ã‚©ãƒ³ã‚¿ãƒ ï¼‰ã”ã¨ã«ï¼Œå®Ÿè¡ŒçŠ¶æ…‹ã«ã‚ã‚‹ã‚¿ã‚¹ã‚¯ãŒå¼·åˆ¶çš„ã«å¾…ã¡è¡Œåˆ—ã«ç™»éŒ²ã•ã‚Œã‚‹ï¼äº¤ä»£ã™ã‚‹ã‚ˆã†ã«ï¼Œä»–ã®ã‚¿ã‚¹ã‚¯ãŒãƒ‡ã‚£ã‚¹ãƒ‘ãƒƒãƒã•ã‚Œã‚‹ï¼ ï¼Šä¾‹ï¼Š ç”Ÿæˆã•ã‚ŒãŸã‚¿ã‚¹ã‚¯ã®åˆ°ç€æ™‚åˆ»ã¨å‡¦ç†æ™‚é–“ã¯ä»¥ä¸‹ã®ã¨ãŠã‚Šã§ã‚ã‚‹ï¼å¼·åˆ¶çš„ãªãƒ‡ã‚£ã‚¹ãƒ‘ãƒƒãƒã¯ï¼Œã€20ç§’ã€ã”ã¨ã«èµ·ã“ã‚‹ã¨ã™ã‚‹ï¼ ã‚¿ã‚¹ã‚¯AãŒ0ç§’ã«å¾…ã¡è¡Œåˆ—ã¸ç™»éŒ²ã•ã‚Œã‚‹ï¼ 20ç§’é–“ï¼Œã‚¿ã‚¹ã‚¯Aã¯å®Ÿè¡ŒçŠ¶æ…‹ã¸å‰²ã‚Šå½“ã¦ã‚‰ã‚Œã‚‹ï¼ 20ç§’æ™‚ç‚¹ã§ï¼Œã‚¿ã‚¹ã‚¯Aã¯å®Ÿè¡ŒçŠ¶æ…‹ã‹ã‚‰å¾…ã¡è¡Œåˆ—ã«è¿½åŠ ã•ã‚Œã‚‹ï¼åŒæ™‚ã«ï¼Œå¾…ã¡è¡Œåˆ—ã®å…ˆé ­ã«ã„ã‚‹ã‚¿ã‚¹ã‚¯Bã¯ï¼Œå®Ÿè¡Œå¯èƒ½çŠ¶æ…‹ã‹ã‚‰å®Ÿè¡ŒçŠ¶æ…‹ã«ãƒ‡ã‚£ã‚¹ãƒ‘ãƒƒãƒã•ã‚Œã‚‹ï¼ 40ç§’æ™‚ç‚¹ã§ï¼Œã‚¿ã‚¹ã‚¯Cã¯å®Ÿè¡ŒçŠ¶æ…‹ã‹ã‚‰å¾…ã¡è¡Œåˆ—ã«è¿½åŠ ã•ã‚Œã‚‹ï¼åŒæ™‚ã«ï¼Œå¾…ã¡è¡Œåˆ—ã®å…ˆé ­ã«ã„ã‚‹ã‚¿ã‚¹ã‚¯Aã¯ï¼Œå®Ÿè¡Œå¯èƒ½çŠ¶æ…‹ã‹ã‚‰å®Ÿè¡ŒçŠ¶æ…‹ã«ãƒ‡ã‚£ã‚¹ãƒ‘ãƒƒãƒã•ã‚Œã‚‹ï¼ 05. å…¥å‡ºåŠ›ç®¡ç† å…¥å‡ºåŠ›ç®¡ç†ã¨ã¯ ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‹ã‚‰ä½é€Ÿãªå‘¨è¾ºæ©Ÿå™¨ã¸ãƒ‡ãƒ¼ã‚¿ã‚’å‡ºåŠ›ã™ã‚‹æ™‚ï¼Œã¾ãšï¼ŒCPUã¯ã‚¹ãƒ—ãƒ¼ãƒ©ã«ãƒ‡ãƒ¼ã‚¿ã‚’å‡ºåŠ›ã™ã‚‹ï¼Spoolerã¯ï¼Œå…¨ã¦ã®ãƒ‡ãƒ¼ã‚¿ã‚’ã¾ã¨ã‚ã¦å‡ºåŠ›ã™ã‚‹ã®ã§ã¯ãªãï¼Œä¸€æ™‚çš„ã«è£œåŠ©è¨˜æ†¶è£…ç½®ï¼ˆSpoolï¼‰ã«ãŸã‚ã¦ãŠããªãŒã‚‰ï¼Œå°‘ã—ãšã¤å‡ºåŠ›ã™ã‚‹ï¼ˆSpoolingï¼‰ï¼ "},"public/software/software_basic_language_processor.html":{"url":"public/software/software_basic_language_processor.html","title":"ğŸ“– ï¸è¨€èªãƒ—ãƒ­ã‚»ãƒƒã‚µ","keywords":"","body":"è¨€èªãƒ—ãƒ­ã‚»ãƒƒã‚µ ã¯ã˜ã‚ã« æœ¬ã‚µã‚¤ãƒˆã«ã¤ãã¾ã—ã¦ï¼Œä»¥ä¸‹ã‚’ã”èªè­˜ã®ã»ã©å®œã—ããŠé¡˜ã„ã„ãŸã—ã¾ã™ï¼ å‚è€ƒï¼šhttps://hiroki-it.github.io/tech-notebook-gitbook/ 01. ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°è¨€èª è¨€èªã®ç¨®é¡ ãƒ—ãƒ­ã‚°ãƒ©ãƒ è¨€èªã®ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã¯ï¼Œè¨€èªãƒ—ãƒ­ã‚»ãƒƒã‚µã«ã‚ˆã£ã¦æ©Ÿæ¢°èªã«å¤‰æ›ã•ã‚ŒãŸå¾Œï¼ŒCPUã«ã‚ˆã£ã¦å®Ÿè¡Œã•ã‚Œã‚‹ï¼ãã—ã¦ï¼Œã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã«æ›¸ã‹ã‚ŒãŸæ§˜ã€…ãªå‡¦ç†ãŒå®Ÿè¡Œã•ã‚Œã‚‹ï¼ ã‚³ãƒ³ãƒ‘ã‚¤ãƒ©å‹è¨€èª ãƒ»ã‚³ãƒ³ãƒ‘ã‚¤ãƒ©å‹è¨€èªã¨ã¯ ã‚³ãƒ³ãƒ‘ã‚¤ãƒ©ã¨ã„ã†è¨€èªãƒ—ãƒ­ã‚»ãƒƒã‚µã«ã‚ˆã£ã¦ï¼Œã‚³ãƒ³ãƒ‘ã‚¤ãƒ©æ–¹å¼ã§ç¿»è¨³ã•ã‚Œã‚‹è¨€èªï¼ ãƒ»ä¾‹ Goï¼ŒCï¼ŒC#ï¼Œãªã©ï¼ ã‚¤ãƒ³ã‚¿ãƒ—ãƒªã‚¿å‹è¨€èª ãƒ»ã‚¤ãƒ³ã‚¿ãƒ—ãƒªã‚¿å‹è¨€èªã¨ã¯ ã‚¤ãƒ³ã‚¿ãƒ—ãƒªã‚¿ã¨ã„ã†è¨€èªãƒ—ãƒ­ã‚»ãƒƒã‚µã«ã‚ˆã£ã¦ï¼Œã‚¤ãƒ³ã‚¿ãƒ—ãƒªã‚¿æ–¹å¼ã§ç¿»è¨³ã•ã‚Œã‚‹è¨€èªã‚’ã‚¤ãƒ³ã‚¿ãƒ—ãƒªã‚¿å‹è¨€èªã¨ã„ã†ï¼ ãƒ»ä¾‹ PHPï¼ŒRubyï¼ŒJavaScriptï¼ŒPythonï¼Œãªã©ï¼ ä¸­é–“å‹è¨€èª ãƒ»ä¸­é–“å‹è¨€èªã¨ã¯ Javaä»®æƒ³ãƒã‚·ãƒ³ã«ã‚ˆã£ã¦ï¼Œä¸­é–“è¨€èªæ–¹å¼ã§ç¿»è¨³ã•ã‚Œã‚‹ï¼ å‚è€ƒï¼šhttps://kanda-it-school-kensyu.com/java-basic-intro-contents/jbi_ch01/jbi_0102/ ãƒ»ä¾‹ Javaï¼ŒScalaï¼ŒGroovyï¼ŒKotlinï¼Œãªã©ï¼ 02. è¨€èªãƒ—ãƒ­ã‚»ãƒƒã‚µã«ã‚ˆã‚‹ç¿»è¨³æ–¹å¼ ã‚¢ã‚»ãƒ³ãƒ–ãƒ©æ–¹å¼ ãƒ»ã‚¢ã‚»ãƒ³ãƒ–ãƒ©æ–¹å¼ã¨ã¯ ã‚¢ã‚»ãƒ³ãƒ–ãƒªå‹è¨€èªã‚’æ©Ÿæ¢°èªã«ç¿»è¨³ã™ã‚‹æ–¹æ³•ã®ã“ã¨ï¼ ã‚³ãƒ³ãƒ‘ã‚¤ãƒ©æ–¹å¼ ãƒ»ã‚³ãƒ³ãƒ‘ã‚¤ãƒ©æ–¹å¼ã¨ã¯ ã‚³ãƒ³ãƒ‘ã‚¤ãƒ©å‹è¨€èªã‚’æ©Ÿæ¢°èªã«ç¿»è¨³ã™ã‚‹æ–¹æ³•ã®ã“ã¨ï¼ ã‚¤ãƒ³ã‚¿ãƒ—ãƒªã‚¿æ–¹å¼ ãƒ»ã‚¤ãƒ³ã‚¿ãƒ—ãƒªã‚¿æ–¹å¼ã¨ã¯ ã‚¤ãƒ³ã‚¿ãƒ—ãƒªã‚¿å‹è¨€èªã‚’æ©Ÿæ¢°èªã«ç¿»è¨³ã™ã‚‹æ–¹æ³•ã®ã“ã¨ï¼ 02-02. ã‚¢ã‚»ãƒ³ãƒ–ãƒªå‹è¨€èªã®æ©Ÿæ¢°èªç¿»è¨³ 02-03. ã‚³ãƒ³ãƒ‘ã‚¤ãƒ©å‹è¨€èªã®æ©Ÿæ¢°èªç¿»è¨³ ã‚³ãƒ³ãƒ‘ã‚¤ãƒ©æ–¹å¼ ãƒ»æ©Ÿæ¢°èªç¿»è¨³ã¨å®Ÿè¡Œ ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã‚’ãƒã‚¤ãƒŠãƒªå½¢å¼ã®ã‚³ãƒ¼ãƒ‰ã«ç¿»è¨³ã—ãŸå¾Œï¼ŒCPUä¸Šã§å‘½ä»¤ãŒå®Ÿè¡Œã•ã‚Œã‚‹ï¼å‘½ä»¤ã®çµæœã¯ãƒ¡ãƒ¢ãƒªã«ä¿ç®¡ã•ã‚Œã‚‹ï¼ å‚è€ƒï¼š http://samuiui.com/2019/02/24/google-colaboratory%E3%81%A7python%E5%85%A5%E9%96%80/ https://qiita.com/tk_01/items/a84408b5436ec97bfbe1#%E3%83%97%E3%83%AD%E3%82%B0%E3%83%A9%E3%83%A0%E3%81%8C%E5%8B%95%E3%81%8F%E4%BB%95%E7%B5%84%E3%81%BF ãƒ»ã‚³ãƒ³ãƒ‘ã‚¤ãƒ©ã«ã‚ˆã‚‹ãƒ“ãƒ«ãƒ‰ ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã«ã‚ˆã£ã¦ï¼Œã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã¯æ©Ÿæ¢°èªã‹ã‚‰ãªã‚‹ãƒã‚¤ãƒŠãƒªå½¢å¼ã®ã‚³ãƒ¼ãƒ‰ã«å¤‰æ›ã•ã‚Œã‚‹ï¼ãã®å¾Œï¼Œãƒã‚¤ãƒŠãƒªå½¢å¼ã®ã‚³ãƒ¼ãƒ‰ã¯ãƒªãƒ³ã‚¯ã•ã‚Œï¼exeãƒ•ã‚¡ã‚¤ãƒ«ã¨ãªã‚‹ï¼ã“ã®ä¸€é€£ã®ãƒ—ãƒ­ã‚»ã‚¹ã‚’ã€ãƒ“ãƒ«ãƒ‰ã€ã¨ã„ã†ï¼ã¾ãŸï¼Œãƒ“ãƒ«ãƒ‰ã«ã‚ˆã£ã¦ç”Ÿæˆã•ã‚ŒãŸãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã€ã‚¢ãƒ¼ãƒ†ã‚£ãƒ•ã‚¡ã‚¯ãƒˆï¼ˆæˆæœç‰©ï¼‰ã€ã¨ã„ã†ï¼ ä»•çµ„ã¿ ï¼ˆï¼‘ï¼‰Lexical analysisï¼ˆå­—å¥è§£æï¼‰ ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã®æ–‡å­—åˆ—ã‚’è¨€èªã®æœ€å°å˜ä½ï¼ˆãƒˆãƒ¼ã‚¯ãƒ³ï¼‰ã®åˆ—ã«åˆ†è§£ï¼ ä»¥ä¸‹ã«ï¼Œãƒˆãƒ¼ã‚¯ãƒ³ã®åˆ†é¡æ–¹æ³•ã®ä¾‹ã‚’ç¤ºã™ï¼ ï¼ˆï¼’ï¼‰Syntax analysisï¼ˆæ§‹æ–‡è§£æï¼‰ ãƒˆãƒ¼ã‚¯ãƒ³ã®åˆ—ã‚’ãƒ„ãƒªãƒ¼æ§‹é€ ã«å¤‰æ›ï¼ ï¼ˆï¼“ï¼‰Semantics analysisï¼ˆæ„å‘³è§£æï¼‰ ãƒ„ãƒªãƒ¼æ§‹é€ ã‚’åŸºã«ï¼Œã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã«è«–ç†çš„ãªèª¤ã‚ŠãŒãªã„ã‹è§£æï¼ ï¼ˆï¼”ï¼‰Code optimizationï¼ˆã‚³ãƒ¼ãƒ‰æœ€é©åŒ–ï¼‰ ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã®å†—é•·ãªéƒ¨åˆ†ã‚’å‰Šé™¤ã¾ãŸã¯ç·¨é›†ï¼æ©Ÿæ¢°èªã‚’ã‚ˆã‚ŠçŸ­ãã™ã‚‹ã“ãŒã§ãã‚‹ï¼ ï¼ˆï¼•ï¼‰Code generationï¼ˆã‚³ãƒ¼ãƒ‰ç”Ÿæˆï¼‰ æœ€é©åŒ–ã•ã‚ŒãŸã‚³ãƒ¼ãƒ‰ã‚’ãƒã‚¤ãƒŠãƒªå½¢å¼ã®ã‚³ãƒ¼ãƒ‰ã«å¤‰æ›ï¼ ï¼ˆï¼–ï¼‰ãƒªãƒ³ã‚¯ ãƒã‚¤ãƒŠãƒªå½¢å¼ã®ã‚³ãƒ¼ãƒ‰ã‚’ãƒªãƒ³ã‚¯ã™ã‚‹ï¼ ï¼ˆï¼—ï¼‰å‘½ä»¤ã®å®Ÿè¡Œ ãƒªãƒ³ã‚¯ã•ã‚ŒãŸãƒã‚¤ãƒŠãƒªå½¢å¼ã®ã‚³ãƒ¼ãƒ‰ã‚’åŸºã«ï¼Œå‘½ä»¤ãŒå®Ÿè¡Œã•ã‚Œã‚‹ï¼ makeã«ã‚ˆã‚‹ãƒ“ãƒ«ãƒ‰ ï¼ˆï¼‘ï¼‰ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ« # ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’å…¬å¼ã‹ã‚‰ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã¨è§£ç­” $ wget $ tar # ãƒ“ãƒ«ãƒ‰ç”¨ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã®ä½œæˆï¼ $ mkdir build $ cd build ï¼ˆï¼’ï¼‰ãƒ“ãƒ«ãƒ‰ã®ãƒ«ãƒ¼ãƒ«ã‚’å®šç¾© configureãƒ•ã‚¡ã‚¤ãƒ«ã‚’å…ƒã«ï¼Œãƒ«ãƒ¼ãƒ«ãŒå®šç¾©ã•ã‚ŒãŸMakefileã‚’ä½œæˆã™ã‚‹ï¼ # configureã¸ã®ãƒ‘ã‚¹ã«æ³¨æ„ï¼ $ ../configure --prefix=\"\" ï¼ˆï¼“ï¼‰ãƒ“ãƒ«ãƒ‰ ï¼ˆã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ï¼‹ãƒªãƒ³ã‚¯ï¼‰ ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã‹ã‚‰exeãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ“ãƒ«ãƒ‰ã™ã‚‹ï¼ # -j ã§ä½¿ç”¨ã™ã‚‹ã‚³ã‚¢æ•°ã‚’å®£è¨€ã—ï¼Œå‡¦ç†ã®é€Ÿåº¦ã‚’ä¸Šã’ã‚‰ã‚Œã‚‹ï¼ $ make -j4 ä»»æ„ã§ï¼Œexeãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒ†ã‚¹ãƒˆã‚’è¡Œãˆã‚‹ï¼ $ make check ï¼ˆï¼”ï¼‰exeãƒ•ã‚¡ã‚¤ãƒ«ã®å®Ÿè¡Œ ç”Ÿæˆã•ã‚ŒãŸã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ï¼ŒæŒ‡å®šã—ãŸãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ã‚³ãƒ”ãƒ¼ï¼ # installã¨å‘½ä»¤ã™ã‚‹ãŒï¼Œå®Ÿéš›ã¯ã‚³ãƒ”ãƒ¼ï¼sudoã‚’ä»˜ã‘ã‚‹ï¼ $ sudo make install å…ƒã¨ãªã£ãŸã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã‚„ãƒã‚¤ãƒŠãƒªå½¢å¼ã®ã‚³ãƒ¼ãƒ‰ã‚’å‰Šé™¤ï¼ $ make clean 02-04. ã‚¤ãƒ³ã‚¿ãƒ—ãƒªã‚¿å‹è¨€èªã®æ©Ÿæ¢°èªç¿»è¨³ ã‚¤ãƒ³ã‚¿ãƒ—ãƒªã‚¿æ–¹å¼ ãƒ»æ©Ÿæ¢°èªç¿»è¨³ã¨å®Ÿè¡Œ ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã‚’ãƒã‚¤ãƒŠãƒªå½¢å¼ã®ã‚³ãƒ¼ãƒ‰ã«ä¸€è¡Œãšã¤å¤‰æ›ã—ï¼Œãã®éƒ½åº¦ï¼ŒCPUä¸Šã§å‘½ä»¤ãŒå®Ÿè¡Œã•ã‚Œã‚‹ï¼å‘½ä»¤ã®çµæœã¯ãƒ¡ãƒ¢ãƒªã«ä¿ç®¡ã•ã‚Œã‚‹ï¼ å‚è€ƒï¼š http://samuiui.com/2019/02/24/google-colaboratory%E3%81%A7python%E5%85%A5%E9%96%80/ https://qiita.com/tk_01/items/a84408b5436ec97bfbe1#%E3%83%97%E3%83%AD%E3%82%B0%E3%83%A9%E3%83%A0%E3%81%8C%E5%8B%95%E3%81%8F%E4%BB%95%E7%B5%84%E3%81%BF ã‚³ãƒãƒ³ãƒ‰ãƒ©ã‚¤ãƒ³ã§ãã®ã¾ã¾å…¥åŠ›ã—ï¼Œæ©Ÿæ¢°èªç¿»è¨³ã¨å®Ÿè¡Œã‚’è¡Œã†ã“ã¨ãŒã§ãã‚‹ï¼ #=========== # PHPã®å ´åˆ #=========== # PHPãªã®ã§ï¼Œå‡¦ç†çµ‚ã‚ã‚Šã«ã‚»ãƒŸã‚³ãƒ­ãƒ³ãŒå¿…è¦ $ php -r \"\" # Hello Worldã‚’å‡ºåŠ› $ php -r \"echo \"Hello World\";\" # phpinfoã‚’å‡ºåŠ› $ php -r \"phpinfo();\" # ï¼ˆãŠã¾ã‘ï¼‰phpinfoã®å‡ºåŠ›ã‚’ãƒ†ã‚­ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã«ä¿å­˜ $ php -r \"phpinfo();\" > phpinfo.txt # php.iniã®èª­ã¿è¾¼ã¿çŠ¶æ³ã‚’å‡ºåŠ› $ php --ini ä»•çµ„ã¿ ï¼ˆï¼‘ï¼‰Lexical analysisï¼ˆå­—å¥è§£æï¼‰ ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã®æ–‡å­—åˆ—ã‚’è¨€èªã®æœ€å°å˜ä½ï¼ˆãƒˆãƒ¼ã‚¯ãƒ³ï¼‰ã®åˆ—ã«åˆ†è§£ï¼ ä»¥ä¸‹ã«ï¼Œãƒˆãƒ¼ã‚¯ãƒ³ã®åˆ†é¡æ–¹æ³•ã®ä¾‹ã‚’ç¤ºã™ï¼ ï¼ˆï¼’ï¼‰Syntax analysisï¼ˆæ§‹æ–‡è§£æï¼‰ ãƒˆãƒ¼ã‚¯ãƒ³ã®åˆ—ã‚’ãƒ„ãƒªãƒ¼æ§‹é€ ã«å¤‰æ›ï¼ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã‹ã‚‰æ§‹é€ ä½“ã‚’æ§‹ç¯‰ã™ã‚‹ã“ã¨ã‚’æ§‹æ–‡è§£æã¨ã„ã„ï¼Œhtmlã‚’æ§‹æ–‡è§£æã—ã¦DOMãƒ„ãƒªãƒ¼ã‚’æ§‹ç¯‰ã™ã‚‹å‡¦ç†ã¨ã¯åˆ¥ç‰©ãªã®ã§æ³¨æ„ï¼ ï¼ˆï¼“ï¼‰Semantics analysisï¼ˆæ„å‘³è§£æï¼‰ ãƒ„ãƒªãƒ¼æ§‹é€ ã‚’åŸºã«ï¼Œã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã«è«–ç†çš„ãªèª¤ã‚ŠãŒãªã„ã‹è§£æï¼ ï¼ˆï¼”ï¼‰å‘½ä»¤ã®å®Ÿè¡Œ æ„å‘³è§£æã®çµæœã‚’åŸºã«ï¼Œå‘½ä»¤ãŒå®Ÿè¡Œã•ã‚Œã‚‹ï¼ ï¼ˆï¼•ï¼‰ï¼‘ã‹ã‚‰ï¼”ã‚’ã‚³ãƒ¼ãƒ‰è¡Œã”ã¨ã«ç¹°ã‚Šè¿”ã™ 02-05. ä¸­é–“å‹è¨€èªã®æ©Ÿæ¢°èªç¿»è¨³ ä¸­é–“è¨€èªæ–¹å¼ ãƒ»ä¸­é–“è¨€èªæ–¹å¼ã®æ©Ÿæ¢°èªç¿»è¨³ã®æµã‚Œ Javaã¾ãŸã¯JVMå‹è¨€èªã®ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã‚’ï¼ŒJavaãƒã‚¤ãƒˆã‚³ãƒ¼ãƒ‰ã‚’å«ã‚€ã‚¯ãƒ©ã‚¹ãƒ•ã‚¡ã‚¤ãƒ«ã«å¤‰æ›ã™ã‚‹ï¼ JVMï¼šJava Virtual Machineå†…ã§ï¼Œã‚¤ãƒ³ã‚¿ãƒ—ãƒªã‚¿ã«ã‚ˆã£ã¦ï¼Œã‚¯ãƒ©ã‚¹ãƒ‡ãƒ¼ã‚¿ã‚’æ©Ÿæ¢°èªã«ç¿»è¨³ã™ã‚‹ï¼ çµæœçš„ã«ï¼ŒOSï¼ˆåˆ¶å¾¡ãƒ—ãƒ­ã‚°ãƒ©ãƒ ï¼Ÿï¼‰ã«ä¾å­˜ã›ãšã«ï¼Œå‘½ä»¤ã‚’å®Ÿè¡Œã§ãã‚‹ï¼ï¼ˆCè¨€èªï¼‰ ãƒ»Cè¨€èªã¨Javaã®OSã¸ã®ä¾å­˜åº¦æ¯”è¼ƒ JVMè¨€èª ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ "},"public/software/software_basic_language_processor_process_mode.html":{"url":"public/software/software_basic_language_processor_process_mode.html","title":"ğŸ“– ï¸è¨€èªåˆ¥ã®å‡¦ç†æ–¹å¼","keywords":"","body":"è¨€èªåˆ¥ã®å‡¦ç†æ–¹å¼ ã¯ã˜ã‚ã« æœ¬ã‚µã‚¤ãƒˆã«ã¤ãã¾ã—ã¦ï¼Œä»¥ä¸‹ã‚’ã”èªè­˜ã®ã»ã©å®œã—ããŠé¡˜ã„ã„ãŸã—ã¾ã™ï¼ å‚è€ƒï¼šhttps://hiroki-it.github.io/tech-notebook-gitbook/ 01. ã‚¨ãƒ³ãƒˆãƒªãƒã‚¤ãƒ³ãƒˆ ã‚¨ãƒ³ãƒˆãƒªãƒã‚¤ãƒ³ãƒˆã¨ã¯ ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã‚’å®Ÿè¡Œã™ã‚‹æ™‚ã®èµ·ç‚¹ã¨ãªã‚‹ãƒ•ã‚¡ã‚¤ãƒ«ï¼é–¢æ•°ã®ã“ã¨ï¼ã‚¨ãƒ³ãƒˆãƒªãƒã‚¤ãƒ³ãƒˆã®ãƒ•ã‚¡ã‚¤ãƒ«ï¼é–¢æ•°ã‚’èµ·ç‚¹ã¨ã—ã¦ï¼Œãã®ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã®å…¨ã¦ã®ãƒ•ã‚¡ã‚¤ãƒ«ã®å‡¦ç†ãŒå®Ÿè¡Œã•ã‚Œã‚‹ï¼ å‚è€ƒï¼šhttps://en.wikipedia.org/wiki/Entry_point å‹•çš„å‹ä»˜ã‘å‹è¨€èªã®ã‚¨ãƒ³ãƒˆãƒªãƒã‚¤ãƒ³ãƒˆ ãƒ»ç‰¹å¾´ å‹•çš„å‹ä»˜ã‘è¨€èªã§ã¯ï¼Œã‚¨ãƒ³ãƒˆãƒªãƒã‚¤ãƒ³ãƒˆã®å®šç¾©æ–¹æ³•ãŒå¼·åˆ¶ã•ã‚Œãšï¼ŒæŒ‡å®šã—ãŸãƒ•ã‚¡ã‚¤ãƒ«ã®å…ˆé ­è¡ŒãŒã‚¨ãƒ³ãƒˆãƒªãƒã‚¤ãƒ³ãƒˆã«ãªã‚‹ï¼ãŸã ã—æ…£ä¾‹ã¨ã—ã¦ï¼Œã€indexã€ã¨ã„ã†åå‰ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚¨ãƒ³ãƒˆãƒªãƒã‚¤ãƒ³ãƒˆã¨ã™ã‚‹è¨€èªãŒå¤šã„ï¼ ãƒ»PHPã®å ´åˆ æ…£ä¾‹ã¨ã—ã¦index.phpãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚¨ãƒ³ãƒˆãƒªãƒã‚¤ãƒ³ãƒˆã¨ã™ã‚‹ã“ã¨ã«ãªã£ã¦ã„ã‚‹ï¼ é™çš„å‹ä»˜ã‘å‹è¨€èªã®ã‚¨ãƒ³ãƒˆãƒªãƒã‚¤ãƒ³ãƒˆ ãƒ»ç‰¹å¾´ é™çš„å‹ä»˜ã‘è¨€èªã§ã¯ï¼Œã‚¨ãƒ³ãƒˆãƒªãƒã‚¤ãƒ³ãƒˆã®å®šç¾©æ–¹æ³•ãŒå¼·åˆ¶ã•ã‚Œã‚‹ï¼ã€mainã€ã¨ã„ã†åå‰ã®é–¢æ•°ã§ã‚¨ãƒ³ãƒˆãƒªãƒã‚¤ãƒ³ãƒˆã‚’å®šç¾©ã•ã›ã‚‹è¨€èªãŒå¤šã„ï¼ ãƒ»Javaã®å ´åˆ ä¿®é£¾å­ãŒã€public staticã€ï¼Œè¿”å´å€¤å‹ãŒã€voidã€ï¼Œå¼•æ•°åãŒã€argsã€ï¼Œå¼•æ•°å‹ãŒã€String[]ã€ã§ã‚ã‚‹mainé–¢æ•°ãŒï¼Œè‡ªå‹•çš„ã«ã‚¨ãƒ³ãƒˆãƒªãƒã‚¤ãƒ³ãƒˆã«ãªã‚‹ï¼ import java.util.*; public class Main { // ã‚¨ãƒ³ãƒˆãƒªãƒã‚¤ãƒ³ãƒˆã¨ãªã‚‹é–¢æ•° public static void main(String[] args) { // ä»–ã®å…¨ãƒ•ã‚¡ã‚¤ãƒ«ã«ç¹‹ãŒã‚‹å‡¦ç† } } ãƒ»Goã®å ´åˆ ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸åãŒã€mainã€ã§ã‚ã‚‹`mainãŒï¼Œè‡ªå‹•çš„ã«ã‚¨ãƒ³ãƒˆãƒªãƒã‚¤ãƒ³ãƒˆã¨ãªã‚‹ï¼ package main // ã‚¨ãƒ³ãƒˆãƒªãƒã‚¤ãƒ³ãƒˆã¨ãªã‚‹é–¢æ•° func main() { // ä»–ã®å…¨ãƒ•ã‚¡ã‚¤ãƒ«ã«ç¹‹ãŒã‚‹å‡¦ç† } 02. ä¸¦è¡Œå‡¦ç†ï¼ˆConcurrent processingï¼‰ ä¸¦è¡Œå‡¦ç†ã¨ã¯ ãƒ—ãƒ­ã‚»ã‚¹ã§ã‚·ãƒ³ã‚°ãƒ«ã‚¹ãƒ¬ãƒƒãƒ‰ãŒå®Ÿè¡Œã•ã‚Œã¦ã„ã‚‹å ´åˆã«ï¼Œè¤‡æ•°ã®å‡¦ç†ã‚’ã€ç‹¬ç«‹çš„ã€ã«å®Ÿè¡Œã™ã‚‹ã“ã¨ï¼ å‚è€ƒï¼š https://techdifferences.com/difference-between-concurrency-and-parallelism.html https://moz.hatenablog.jp/entry/2018/04/10/175643 https://zenn.dev/hsaki/books/golang-concurrency/viewer/term è¨€èªåˆ¥ã®ä¸¦è¡Œå‡¦ç† 03. ä¸¦åˆ—å‡¦ç†ï¼ˆParallel processingï¼‰ ä¸¦åˆ—å‡¦ç†ã¨ã¯ ãƒ—ãƒ­ã‚»ã‚¹ã§ãƒãƒ«ãƒã‚¹ãƒ¬ãƒƒãƒ‰ãŒå®Ÿè¡Œã•ã‚Œã¦ã„ã‚‹å ´åˆã«ï¼Œå„ã‚¹ãƒ¬ãƒƒãƒ‰ä¸Šã§è¤‡æ•°ã®å‡¦ç†ã‚’ã€åŒæ™‚ç™ºç”Ÿçš„ã€ã«å®Ÿè¡Œã™ã‚‹ã“ã¨ï¼é–‹å§‹ã¯åŒæ™‚ã§ã‚ã‚‹ãŒï¼Œçµ‚äº†ã¯ãƒãƒ©ãƒãƒ©ã«ãªã‚‹ï¼ å‚è€ƒï¼š https://techdifferences.com/difference-between-concurrency-and-parallelism.html https://moz.hatenablog.jp/entry/2018/04/10/175643 è¨€èªåˆ¥ã®ä¸¦åˆ—å‡¦ç† ãƒ»PHPã®å ´åˆ parallelãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’ä½¿ç”¨ã™ã‚‹ï¼ å‚è€ƒï¼š https://github.com/krakjoe/parallel https://qiita.com/WhiteGrouse/items/6fb906386b8fbabd6405 ãƒ»JavaScriptã®å ´åˆ WebWorkerã‚’ä½¿ç”¨ã™ã‚‹ï¼ å‚è€ƒï¼šhttps://developer.mozilla.org/ja/docs/Web/API/Web_Workers_API/Using_web_workers ãƒ»Goã®å ´åˆ Goroutinesã‚’ä½¿ç”¨ã™ã‚‹ï¼ãŸã ã—ï¼Œå®Ÿè¡Œç’°å¢ƒã«ã‚ˆã£ã¦ã¯ä¸¦åˆ—å‡¦ç†ã«ãªã‚‰ãšã«ï¼Œä¸¦è¡Œå‡¦ç†ã«ãªã£ã¦ã—ã¾ã†ã“ã¨ãŒã‚ã‚‹ï¼ãã‚ŒãŒç†ç”±ã‹ã©ã†ã‹ã¯ã‚ã‹ã‚‰ãªã„ãŒï¼ŒGoã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã§ã¯ï¼ŒGoroutinesã¯concurrencyã®é …ç›®ã«è¨˜è¼‰ã•ã‚Œã¦ã„ã‚‹ï¼ å‚è€ƒï¼š https://medium.com/sprocket-inc/goroutine-concurrent-and-parallel-programming-669eaae55e73 https://golang.org/doc/effective_go#concurrency https://qiita.com/taigamikami/items/fc798cdd6a4eaf9a7d5e 04. åŒæœŸå‡¦ç†ï¼ˆSynchronous processingï¼‰ åŒæœŸå‡¦ç†ã¨ã¯ å®Œäº†ã‚’å¾…ã£ã¦ã‹ã‚‰å¾Œç¶šã®å‡¦ç†ãŒå§‹ã¾ã‚‹ã‚ˆã†ãªå‡¦ç†ã®ã“ã¨ï¼ 05. éåŒæœŸå‡¦ç†ï¼ˆAsynchronous processingï¼‰ éåŒæœŸå‡¦ç†ã¨ã¯ å®Œäº†ã‚’å¾…ãŸãšã«å¾Œç¶šã®å‡¦ç†ãŒå§‹ã¾ã‚Šï¼Œå¾Œç¶šã®å‡¦ç†ã¨åŒæ™‚ã«å®Ÿè¡Œã•ã‚Œã‚‹ã‚ˆã†ãªå‡¦ç†ã®ã“ã¨ï¼ å‚è€ƒï¼š https://qiita.com/kiyodori/items/da434d169755cbb20447 https://qiita.com/klme_u6/items/ea155f82cbe44d6f5d88 éåŒæœŸå‡¦ç†ã®çµæœã‚’ç”¨ã„ã‚‹å¾Œç¶šå‡¦ç† ãƒ»å¾Œç¶šå‡¦ç†ã®å®šç¾© å¾Œç¶šã®å…¨å‡¦ç†ãŒéåŒæœŸå‡¦ç†ã¨ç„¡é–¢ä¿‚ã§ã‚ã‚Œã°ï¼Œãã®ã¾ã¾ã§å•é¡Œã¯èµ·ã“ã‚‰ãªã„ï¼ã—ã‹ã—ï¼Œå¾Œç¶šã®å‡¦ç†ã«éåŒæœŸå‡¦ç†ã®çµæœã‚’ä½¿ç”¨ã™ã‚‹ã‚‚ã®ãŒå«ã¾ã‚Œã¦ã„ã‚‹å ´åˆï¼Œã“ã®å‡¦ç†ã ã‘ã¯éåŒæœŸå‡¦ç†ã®å¾Œã«å®Ÿè¡Œã•ã‚Œã‚‹ã‚ˆã†ã«å®šç¾©ã™ã‚‹å¿…è¦ãŒã‚ã‚‹ï¼è¨€èªåˆ¥ã«ï¼ŒéåŒæœŸå‡¦ç†ã®æˆå¦ã‚’ç®¡ç†ã—ï¼Œå¾Œç¶šã™ã‚‹å‡¦ç†ã‚’å®šç¾©ã§ãã‚‹æ©Ÿèƒ½ãŒæä¾›ã•ã‚Œã¦ã„ã‚‹ï¼ ãƒ»JavaScriptã®å ´åˆ å‚è€ƒï¼šhttps://hiroki-it.github.io/tech-notebook-gitbook/public/software/software_application_frontend_js_logic_asynchronous_process.html "},"public/software/software_basic_language_processor_machine_language_and_radix.html":{"url":"public/software/software_basic_language_processor_machine_language_and_radix.html","title":"ğŸ“– ï¸æ©Ÿæ¢°èªã¨é€²æ•°","keywords":"","body":"æ©Ÿæ¢°èªã¨é€²æ•° ã¯ã˜ã‚ã« æœ¬ã‚µã‚¤ãƒˆã«ã¤ãã¾ã—ã¦ï¼Œä»¥ä¸‹ã‚’ã”èªè­˜ã®ã»ã©å®œã—ããŠé¡˜ã„ã„ãŸã—ã¾ã™ï¼ å‚è€ƒï¼šhttps://hiroki-it.github.io/tech-notebook-gitbook/ 01. æ©Ÿæ¢°èªã¨2é€²æ•°ã®é–¢ä¿‚ æ©Ÿæ¢°èªã¨ã¯ ã‚ã‚‰ã‚†ã‚‹æƒ…å ±ã‚’ã€0ã€ã¨ã€1ã€ã®2é€²æ•°ã‚’æ©Ÿæ¢°èªã¨ã—ã¦ï¼ŒCPUã«å¯¾ã—ã¦ï¼Œå‘½ä»¤ãŒå®Ÿè¡Œã•ã‚Œã‚‹ï¼ æ§˜ã€…ãªé€²æ•°ã¨bitã®é–¢ä¿‚ ã—ã‹ã—ï¼Œäººé–“ãŒæ‰±ã†ä¸Šã§ã¯8é€²æ•°ã‚ã‚‹ã„ã¯16é€²æ•°ã«å¤‰æ›ã—ã¦è¡¨ç¾ã™ã‚‹ã“ã¨ãŒé©ã—ã¦ã„ã‚‹ï¼2é€²æ•°1ã‚±ã‚¿ãŒã€1 bitã€ã¨å®šç¾©ã•ã‚Œã¦ã„ã‚‹ï¼8é€²æ•°ã®1ã‚±ã‚¿ã¯2é€²æ•°ã®3ã‚±ã‚¿ï¼ˆï¼3 bitï¼‰ã«ç›¸å½“ã—ï¼Œ16é€²æ•°ã®1ã‚±ã‚¿ã¯2é€²æ•°ã®4ã‚±ã‚¿ï¼ˆ4 bitï¼‰ã«ç›¸å½“ã™ã‚‹ï¼ ãªãœï¼˜bitã‚’1Byteã¨ã™ã‚‹ã®ã‹ï¼Ÿï¼ˆåŠè§’è‹±æ•°å­—ã¨bitã®é–¢ä¿‚ï¼‰ ï¼˜bitã‚’ä¸€åŒºåˆ‡ã‚Šã¨ã—ã¦ï¼Œï¼‘Byteã¨è¡¨ç¾ã™ã‚‹ï¼ã“ã‚Œã¯ï¼ŒåŠè§’è‹±æ•°å­—ä¸€æ–‡å­—ãŒï¼˜bitã®ãƒ‡ãƒ¼ã‚¿é‡ã‚’æŒã¤ã‹ã‚‰ã§ã‚ã‚‹ï¼ Byteå˜ä½ 1000 Byte = 1k Byte ä¸€èˆ¬çš„ãªCPUãŒæ‰±ãˆã‚‹æƒ…å ±ã®ç¨®æ•° CPUã§ã¯ï¼Œå„ãƒ‡ãƒ¼ã‚¿ã¯2é€²æ³•ã«ã‚ˆã£ã¦åŒºåˆ¥ã•ã‚Œã¦ã„ã‚‹ï¼CPUã¯4 ï¼Œ8ï¼Œ16ï¼Œ32-bitãƒãƒ¼ã‚¸ãƒ§ãƒ³ã¨é€²æ­©ã—ï¼Œ2008å¹´ã®å¾ŒåŠã‹ã‚‰ã¯ 64-bitãƒãƒ¼ã‚¸ãƒ§ãƒ³ã®CPUãŒæ™®åŠã—å§‹ã‚ãŸï¼1-bitã¯2ç¨®é¡ã®æƒ…å ±ã‚’è¡¨ã™ã“ã¨ãŒã§ãã‚‹ãŸã‚ï¼Œ32-bitã®CPUã§ã¯2^32ï¼Œ64-bitã§ã¯2^64ã®ç¨®é¡ã®æƒ…å ±ã‚’æ‰±ã†äº‹ãŒã§ãã‚‹ï¼ 01-02. æ©Ÿæ¢°èªå‘½ä»¤ã®ç¨®é¡ è¨­å®šå‘½ä»¤ ãƒ»å®Ÿè¡Œã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’ãƒ¬ã‚¸ã‚¹ã‚¿ã«è¨­å®šã™ã‚‹å ´åˆ ãƒ»å®Ÿè¡Œã‚¢ãƒ‰ãƒ¬ã‚¹ãŒæŒ‡ã™èªã®å†…å®¹ã‚’ãƒ¬ã‚¸ã‚¹ã‚¿ã«è¨­å®šã™ã‚‹å ´åˆ ãƒ»ãƒ¬ã‚¸ã‚¹ã‚¿ã®å†…å®¹ã‚’å®Ÿè¡Œã‚¢ãƒ‰ãƒ¬ã‚¹ã«æ ¼ç´ã™ã‚‹å ´åˆ ã‚·ãƒ•ãƒˆå‘½ä»¤ï¼ˆâ€»åˆ¥ç¯€ã‚’å‚ç…§ã›ã‚ˆï¼‰ è¨ˆç®—å‘½ä»¤ ãƒ¬ã‚¸ã‚¹ã‚¿ã‹ã‚‰å–ã‚Šå‡ºã—ãŸå€¤ã‚’åˆ¥ã®å€¤ã¨è¶³ã—ï¼Œãã®çµæœã‚’å…ƒã®ãƒ¬ã‚¸ã‚¹ã‚¿ã«è¨­å®šã™ã‚‹ã“ã¨ï¼ è«–ç†æ¼”ç®—å‘½ä»¤ï¼ˆâ€»3ç« ã‚’å‚ç…§ã›ã‚ˆï¼‰ 01-03. ã‚·ãƒ•ãƒˆå‘½ä»¤ è«–ç†å·¦ã‚·ãƒ•ãƒˆ æœ€ä¸Šä½ã«æ­£è² ã‚’è¡¨ã™ã€ç¬¦å·bitã€ã‚’è¨­å®šã›ãšã«ï¼Œã‚·ãƒ•ãƒˆã‚’è¡Œã†ï¼ ï¼’é€²æ•°ã®å ´åˆâ€¦ å·¦ã«ï¼‘bitã‚·ãƒ•ãƒˆã™ã‚‹ã¨ã€2å€ã€ å·¦ã«ï¼‘bitã‚·ãƒ•ãƒˆã—ï¼Œå…ƒã®å€¤ã‚’è¶³ã™ã‚’ã€3å€ã€ å·¦ã«ï¼’bitã‚·ãƒ•ãƒˆã™ã‚‹ã¨ã€4å€ã€ å·¦ã«ï¼’bitã‚·ãƒ•ãƒˆã—ï¼Œå…ƒã®å€¤ã‚’è¶³ã™ã¨ã€5å€ã€ å·¦ã«ï¼’bitã‚·ãƒ•ãƒˆã—ï¼Œå…ƒã®å€¤ã‚’è¶³ã—ã¦ã€5å€ã€ï¼ã•ã‚‰ã«ï¼’bitã‚·ãƒ•ãƒˆã™ã‚‹ã¨ã€10å€ã€ å·¦ã«ï¼“bitã‚·ãƒ•ãƒˆã™ã‚‹ã¨ã€8å€ã€ ãƒ»æ­£ã®æ•°ã®å ´åˆ ï¼Šä¾‹ï¼Š 00011100 ãƒ»è² ã®æ•°ã®å ´åˆ ï¼Šä¾‹ï¼Š 11100100 è«–ç†å³ã‚·ãƒ•ãƒˆ æœ€ä¸Šä½ã«æ­£è² ã‚’è¡¨ã™ã€ç¬¦å·bitã€ã‚’è¨­å®šã›ãšã«ï¼Œã‚·ãƒ•ãƒˆã‚’è¡Œã†ï¼ ï¼’é€²æ•°ã®å ´åˆâ€¦ å³ã«ï¼‘bitã‚·ãƒ•ãƒˆã™ã‚‹ã¨ã€1/2ã€ å³ã«ï¼’bitã‚·ãƒ•ãƒˆã™ã‚‹ã¨ã€1/4ã€ å³ã«ï¼“bitã‚·ãƒ•ãƒˆã™ã‚‹ã¨ã€1/8ã€ ãƒ»æ­£ã®æ•°ã®å ´åˆ ï¼Šä¾‹ï¼Š 00011100 ãƒ»è² ã®æ•°ã®å ´åˆï¼ˆè¨ˆç®—ã¯ã§ããªã„ï¼‰ ï¼Šä¾‹ï¼Š 11100100 è² ã®æ•°ã§è«–ç†å³ã‚·ãƒ•ãƒˆã‚’è¡Œã†å ´åˆï¼Œé–“é•ã£ãŸè¨ˆç®—ãŒè¡Œã‚ã‚Œã¦ã—ã¾ã†ï¼ã“ã†ã„ã†å ´åˆï¼Œç®—è¡“ã‚·ãƒ•ãƒˆãŒç”¨ã„ã‚‰ã‚Œã‚‹ï¼ ç®—è¡“å·¦ã‚·ãƒ•ãƒˆ æœ€ä¸Šä½ã«æ­£è² ã‚’è¡¨ã™ã€ç¬¦å·bitã€ã‚’è¨­å®šã—ï¼Œã‚·ãƒ•ãƒˆã‚’è¡Œã†ï¼ ï¼’é€²æ•°ã®å ´åˆâ€¦ å·¦ã«ï¼‘bitã‚·ãƒ•ãƒˆã™ã‚‹ã¨ã€2å€ã€ å·¦ã«ï¼‘bitã‚·ãƒ•ãƒˆã—ï¼Œå…ƒã®å€¤ã‚’è¶³ã™ã‚’ã€3å€ã€ å·¦ã«ï¼’bitã‚·ãƒ•ãƒˆã™ã‚‹ã¨ã€4å€ã€ å·¦ã«ï¼’bitã‚·ãƒ•ãƒˆã—ï¼Œå…ƒã®å€¤ã‚’è¶³ã™ã¨ã€5å€ã€ å·¦ã«ï¼’bitã‚·ãƒ•ãƒˆã—ï¼Œå…ƒã®å€¤ã‚’è¶³ã—ã¦ã€5å€ã€ï¼ã•ã‚‰ã«ï¼’bitã‚·ãƒ•ãƒˆã™ã‚‹ã¨ã€10å€ã€ å·¦ã«ï¼“bitã‚·ãƒ•ãƒˆã™ã‚‹ã¨ã€8å€ã€ ãƒ»æ­£ã®æ•°ã®å ´åˆ ï¼Šä¾‹ï¼Š 00011100 ãƒ»è² ã®æ•°ã®å ´åˆ ï¼Šä¾‹ï¼Š 00011100 ç®—è¡“å³ã‚·ãƒ•ãƒˆ ï¼’é€²æ•°ã®å ´åˆâ€¦ æœ€ä¸Šä½ã«æ­£è² ã‚’è¡¨ã™ã€ç¬¦å·bitã€ã‚’è¨­å®šã—ï¼Œã‚·ãƒ•ãƒˆã‚’è¡Œã†ï¼ å³ã«ï¼‘bitã‚·ãƒ•ãƒˆã™ã‚‹ã¨ã€1/2ã€ å³ã«ï¼’bitã‚·ãƒ•ãƒˆã™ã‚‹ã¨ã€1/4ã€ å³ã«ï¼“bitã‚·ãƒ•ãƒˆã™ã‚‹ã¨ã€1/8ã€ ãƒ»æ­£ã®æ•°ã®å ´åˆ ï¼Šä¾‹ï¼Š 00011100 ãƒ»è² ã®æ•°ã®å ´åˆ 01-04. æ©Ÿæ¢°èªå‘½ä»¤ã®å®Ÿè¡Œæ‰‹é † å®Ÿè¡Œæ‰‹é † 16é€²æ•°ãŒ2é€²æ•°ã«å¤‰æ›ã•ã‚Œï¼Œè¨˜å·ã¸å€¤ãŒå‰²ã‚Šå½“ã¦ã‚‰ã‚Œã‚‹ï¼ï¼ˆãƒ“ãƒƒãƒˆåˆ†å‰²ï¼‰ è¨˜å·ã®å€¤ã‚’åŸºã«ï¼Œå®Ÿè¡Œã‚¢ãƒ‰ãƒ¬ã‚¹ã®è¨ˆç®—æ–¹æ³•ãŒé¸æŠã•ã‚Œï¼Œå®Ÿè¡Œã•ã‚Œã‚‹ï¼ï¼ˆå®Ÿè¡Œã‚¢ãƒ‰ãƒ¬ã‚¹ã®è¨ˆç®—ï¼‰ å®Ÿè¡Œã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’åŸºã«ï¼Œæ©Ÿæ¢°èªå‘½ä»¤ãŒå®Ÿè¡Œã•ã‚Œï¼Œå€¤ãŒãƒ¬ã‚¸ã‚¹ã‚¿ã‚„ãƒ¡ãƒ¢ãƒªã«æ›¸ãç•™ã‚ã‚‰ã‚Œã‚‹ï¼ï¼ˆæ©Ÿæ¢°èªå‘½ä»¤ã®ãƒˆãƒ¬ãƒ¼ã‚¹ï¼‰ ï¼ˆï¼‘ï¼‰ãƒ“ãƒƒãƒˆåˆ†å‰² ï¼Šä¾‹ï¼Š å‘½ä»¤ï¼š20B3h ãƒ»16é€²æ•°ã®2é€²æ•°ã¸ã®å¤‰æ› ãƒ»è¨˜å·ã¸ã®å€¤ã®å‰²ã‚Šå½“ã¦ ï¼ˆï¼’ï¼‰å®ŸåŠ¹ã‚¢ãƒ‰ãƒ¬ã‚¹ã®è¨ˆç®— ãƒ»å®Ÿè¡Œã‚¢ãƒ‰ãƒ¬ã‚¹ã®è¨ˆç®—æ–¹æ³•ã®é¸æŠ ã€Xï¼2ã€ï¼Œã€I = 1ã€ã‚ˆã‚Šï¼Œè¡¨ã®ç¶²æ›ã‘ã®è¨ˆç®—å¼ã‚’é¸æŠï¼ ãƒ»å®ŸåŠ¹ã‚¢ãƒ‰ãƒ¬ã‚¹ã®è¨ˆç®—ã®å®Ÿè¡Œ ã“ã“ã«ï¼Œãƒ¬ã‚¸ã‚¹ã‚¿ç•ªå·ã¨å†…å®¹ã®è¡¨ã‚’å¼µã‚‹ï¼ (å®ŸåŠ¹ã‚¢ãƒ‰ãƒ¬ã‚¹) = [adr + [X] ] = [1000h + [ãƒ¬ã‚¸ã‚¹ã‚¿2] ]ï¼ˆâ€»é…åˆ—ã®ã‚ˆã†ã«ï¼Œãƒ¬ã‚¸ã‚¹ã‚¿2ã®å€¤ã‚’å‚ç…§ï¼‰ = [1000h + 0002h] = [1002h] = 1003h ï¼ˆï¼“ï¼‰æ©Ÿæ¢°èªå‘½ä»¤ã®ãƒˆãƒ¬ãƒ¼ã‚¹ 01-05. æ§‹æ–‡è§£æã«ãŠã‘ã‚‹æ•°å¼ã®èªè­˜æ–¹æ³• é€†ãƒãƒ¼ãƒ©ãƒ³ãƒ‰è¡¨è¨˜æ³•ï¼ˆå¾Œç½®è¡¨è¨˜æ³•ï¼‰ æ¼”ç®—å­ï¼ˆï¼‹ï¼Œï¼ï¼ŒÃ—ï¼ŒÃ·ãªã©ï¼‰ã‚’è¢«æ¼”ç®—å­ï¼ˆæ•°å€¤ã‚„å¤‰æ•°ï¼Œã¾ãŸè¨ˆç®—ã®çµæœï¼‰ã®å¾Œã‚ã«æ›¸ãã“ã¨ã§æ•°å¼ã‚’è¡¨ç¾ã™ã‚‹æ–¹æ³•ï¼ã¡ãªã¿ã«ï¼Œäººé–“ãŒä½¿ã£ã¦ã„ã‚‹è¡¨è¨˜æ–¹æ³•ã¯ï¼Œã€ä¸­ç½®è¨˜æ³•ã€ã¨ã„ã†ï¼ ï¼Šä¾‹ï¼Š Y = ( A + B ) Ã— ( C ï¼ ( D Ã· E ) ) æ‹¬å¼§ã¯å…ˆã«è¨ˆç®—ã™ã‚‹ã®ã§å¡Šã¨è¦‹ãªã™ï¼ ( A + B ) â‡’ AB+ æ‹¬å¼§ã¯å…ˆã«è¨ˆç®—ã™ã‚‹ã®ã§å¡Šã¨è¦‹ãªã™ï¼ ( D Ã· E ) â‡’ DE Ã· æ‹¬å¼§ã¯å…ˆã«è¨ˆç®—ã™ã‚‹ã®ã§å¡Šã¨è¦‹ãªã™ï¼ ( AB + ) Ã— ( C ï¼ DE Ã· ) â‡’ ( AB + ) ( CDE Ã· ï¼) Ã— æ‹¬å¼§ã‚’å¤–ã—ã¦ã‚‚ï¼Œå¡Šã¯ãã®ã¾ã¾ï¼ ã€€ã€€( AB + ) ( CDE Ã· ï¼) Ã— â‡’ AB+CDEÃ·ï¼Ã— å·¦è¾ºã¨å³è¾ºã‚’ãã‚Œãã‚Œå¡Šã¨è¦‹ãªã™ï¼ ã€€ã€€Y = AB+CDEÃ·ï¼Ã— â‡’ YAB+CDEÃ·ï¼Ã—= 01-06. CPUã«ãŠã‘ã‚‹å°æ•°ã®å‡¦ç†æ–¹æ³• å›ºå®šå°æ•°ç‚¹æ•° ã€ã“ã®ä½ç½®ã«å°æ•°ç‚¹ãŒã‚ã‚‹ã€ãªå‰æã§æ•°å­—ã‚’æ‰±ã†ã“ã¨ã«ã‚ˆã£ã¦ï¼Œå°æ•°ç‚¹ã‚’å«ã‚€æ•°å€¤ã‚’è¡¨ç¾ã™ã‚‹æ–¹æ³•ï¼ CPUã¯ï¼Œæ•°å€¤ã«å¯¾ã—ï¼Œç‰¹å®šã®ä½ç½®ã«å°æ•°ç‚¹ã‚’æ‰“ã¤ï¼ æµ®å‹•å°æ•°ç‚¹æ•° æŒ‡æ•°è¡¨è¨˜ã‚’ç”¨ã„ã‚‹ã“ã¨ã«ã‚ˆã£ã¦ï¼Œå°æ•°ç‚¹ã‚’å«ã‚€æ•°å€¤ã‚’è¡¨ç¾ã™ã‚‹æ–¹æ³•ï¼ ãƒ»æ­£è¦åŒ–ã—ãŸæ•°å¼ã‹ã‚‰æµ®å‹•å°æ•°ç‚¹æ•°ã¸ã®å¤‰æ› ãƒ»æµ®å‹•å°æ•°ç‚¹æ•°ã‹ã‚‰æ­£è¦åŒ–ã—ãŸæ•°å¼ã¸ã®å¤‰æ› æŒ‡æ•°éƒ¨ã¨ä»®æ•°éƒ¨ã‚’èª¿ç¯€ã—ã¦ï¼Œã§ãã‚‹ã ã‘ä»®æ•°éƒ¨ã®ä¸Šä½æ¡ã«0ãŒå…¥ã‚‰ãªã„ã‚ˆã†ã«ã—ã¦ï¼Œèª¤å·®ã‚’å°‘ãªãã™ã‚‹ã“ã¨ï¼ä¾‹ãˆã°ï¼Œã‚ã‚‹è¨ˆç®—ã®çµæœãŒ0.012345Ã—10^ï¼3ã ã£ãŸå ´åˆï¼Œä»®æ•°éƒ¨ã‚’0.1ï½1ã®ç¯„å›²ã«åã‚ã‚‹ãŸã‚ã«0.12345Ã—10^ï¼4ã«å¤‰æ›´ã™ã‚‹ï¼ 01-07. èª¤å·® ã€èª¤å·®ã€ï¼šå®Ÿéš›ã®æ•°å€¤ã¨CPUãŒè¡¨ç¾ã§ãã‚‹æ•°å€¤ã®é–“ã«ç”Ÿã˜ã‚‹ã‚ºãƒ¬ã®ã“ã¨ï¼ ç„¡é™å°æ•° æ¡æº¢ã‚Œèª¤å·® ï¼Šä¾‹ï¼Š åˆä»£ãƒ‰ãƒ©ã‚¯ã‚¨ åˆä»£ã®ãƒ‰ãƒ©ã‚´ãƒ³ã‚¯ã‚¨ã‚¹ãƒˆã®çµŒé¨“å€¤ã®ä¸Šé™ã¯ã€Œ65535ã€ã ã£ãŸï¼ã“ã‚Œã¯ï¼ŒçµŒé¨“å€¤ãŒ16bitï¼ˆ2 Byteï¼‰ã§è¡¨ã•ã‚Œã¦ãŠã‚Šï¼Œæ¡æº¢ã‚ŒãŒèµ·ãã‚‹ã“ã¨ã‚’é˜²ããŸã‚ã«65535ä»¥ä¸Šã¯è¨ˆç®—ã—ãªã„ã‚ˆã†ã«ãªã£ã¦ã„ãŸï¼ æƒ…å ±è½ã¡ æ‰“åˆ‡ã‚Šèª¤å·® å††å‘¨ç‡ã¯ï¼Œé€”ä¸­ã§è¨ˆç®—ã‚’æ‰“ã¡åˆ‡ã‚‹ï¼ æ¡è½ã¡ ä¸¸ã‚èª¤å·® 02. N é€²æ•° â” 10é€²æ•°ï¼ˆé‡ã¿æ›ã‘ã‚’è¡Œã†ï¼‰ 16é€²æ•° â” 10é€²æ•° ãƒ»æ•´æ•° ï¼Šä¾‹ï¼Šã€CA125ã€ ã€(16^0 Ã— 5) + (16^1 Ã— 2) + (16^2 Ã— 1) + (16^3 Ã— A) + (16^4 Ã— C) ã€ã¨ã„ã†ã‚ˆã†ã«ï¼Œä¸‹ã®ä½ã‹ã‚‰ï¼Œé †ã«16^Nã‚’ã‹ã‘ã¦ã„ãï¼ï¼ˆAã¨Cã¯ï¼Œ10é€²æ•°ã«å¤‰æ›ã—ã¦ã€10ã€ã¨ã€12ã€ï¼‰ (1Ã—5) + (16Ã—2) + (256Ã—1) + (4096Ã—10) + (65536Ã—12) ï¼ 827685 ãƒ»å°‘æ•° 2é€²æ•° â” 10é€²æ•° ãƒ»æ•´æ•° ã€1101101ã€ ã€(2^0 Ã— 1) + (2^1 Ã— 0) + (2^2 Ã— 1) + (2^3 Ã— 1) + (2^4 Ã— 0) + (2^5 Ã— 1) + (2^6 Ã— 1)ã€ã¨ã„ã†ã‚ˆã†ã«ï¼Œä¸‹ã®ä½ã‹ã‚‰ï¼Œé †ã«2^Nã‚’ã‹ã‘ã¦ã„ãï¼ ãƒ»å°‘æ•° 02-02. 10é€²æ•° â” N é€²æ•°ï¼ˆNã§å‰²ã‚Šç¶šã‘ã‚‹ï¼‰ 10é€²æ•° â” 16é€²æ•° ãƒ»æ•´æ•° ï¼Šä¾‹ï¼Šã€27ã€ 27ã‚’16ã§å‰²ã‚Šç¶šã‘ã‚‹ï¼ 16é€²æ•°ã§10ï½15ã¯ï¼ŒAï½Fã§è¡¨è¨˜ã•ã‚Œã‚‹ãŸã‚ï¼Œ11ã‚’Bã§è¡¨è¨˜ï¼ ä½™ã‚Šã‚’ä¸¦ã¹ï¼Œç­”ãˆã¯ã€1Bã€ ãƒ»å°‘æ•° ï¼Šä¾‹ï¼Šã€0.1015625ã€ 1.ã€0.1015625ã€ã«16ã‚’ã‹ã‘ï¼Œæ•´æ•°éƒ¨åˆ†ã‚’å–ã‚Šå‡ºã™ï¼ï¼ˆ0.1015625 Ã— 16 = 1.625ï¼ã€1ã€ã‚’å–ã‚Šå‡ºã—ï¼Œ16é€²æ•°ã«å¤‰æ›ã—ã¦ã€1ã€ï¼‰ 2ï¼è¨ˆç®—çµæœã®å°‘æ•°éƒ¨åˆ†ã«16ã‚’ã•ã‚‰ã«ã‹ã‘ã‚‹ï¼å°‘æ•°éƒ¨åˆ†ãŒ0ã«ãªã‚‹ã¾ã§ï¼Œã“ã‚Œã‚’ç¹°ã‚Šè¿”ã™ï¼ï¼ˆ0.625 Ã— 16 = 10.0ã‚ˆã‚Šï¼Œã€10ã€ã‚’å–ã‚Šå‡ºã—ï¼Œ16é€²æ•°ã«å¤‰æ›ã—ã¦ã€Aã€ï¼‰ 3ï¼å°‘æ•°éƒ¨åˆ†ãŒ0ã«ãªã£ãŸã®ã§ï¼Œå–ã‚Šå‡ºã—ãŸæ•°ã‚’é †ã«ä¸¦ã¹ï¼Œç­”ãˆã¯ã€0.1Aã€ 10é€²æ•° â” 2é€²æ•° ãƒ»æ•´æ•° ï¼Šä¾‹ï¼Šã€109ã€ ãƒ»å°‘æ•° 02-03. X é€²æ•° â” 10é€²æ•° â” Y é€²æ•° ä¸€åº¦ï¼Œ10é€²æ•°ã«å¤‰æ›ã—ã¦ã‹ã‚‰ï¼Œä»»æ„ã®é€²æ•°ã«å¤‰æ›ã™ã‚‹ï¼ 16é€²æ•° â” 2é€²æ•° ãƒ»æ•´æ•° ï¼Šä¾‹ï¼Šã€20B3ã€ 2ï¼Œ0ï¼ŒBï¼Œ3ã‚’10é€²æ•°ã«å¤‰æ›ã—ã¦ï¼Œã€(16^0 Ã— 3) + (16^1 Ã— 11) + (16^2 Ã— 0) + (16^3 Ã— 2) = 8371ã€ 10ã¨15ã‚’2é€²æ•°ã«å¤‰æ›ã—ã¦ï¼Œã€0010ã€ï¼Œã€0000ã€ï¼Œã€1011ã€ï¼Œã€0011ã€ ã‚ˆã£ã¦ï¼ŒAFã¯10é€²æ³•ã«å¤‰æ›ã—ã¦ã€0010000010110011ã€ 02-04. X é€²æ•° â” 10 é€²æ•° â” Y é€²æ•° â” 10 é€²æ•° 16é€²æ•° â” 2é€²æ•° ãƒ»å°‘æ•° ï¼Šä¾‹ï¼Š 2A.4C æ•´æ•°éƒ¨åˆ†ã®2Aã‚’10é€²æ•°ã«å¤‰æ›ã—ã¦ï¼Œ 42ã‚’2é€²æ•°ã«å¤‰æ›ã—ã¦ï¼Œã€101010ã€ï¼ã¾ãŸï¼Œä½™ã‚Šè¨ˆç®—ã®æ™‚ï¼Œä½™ã‚Šï¼‘ã‚’2^Nã«ç›´ã—ã¦ãŠãï¼ æ•´æ•°ã®å ´åˆï¼Œä¸‹ä½ã®æ¡ã‹ã‚‰ï¼Œã€(2^0 Ã— 0) + (2^1 Ã— 1) + (2^2 Ã— 0) + (2^3 Ã— 1) + (2^4 Ã— 0) + (2^5 Ã— 1) + (2^6 Ã— 0) + (2^7 Ã— 0) + (2^8 Ã— 0) ã€ =ã€2^5ï¼‹2^3ï¼‹2^1ã€ ï¼ˆâ€»16é€²æ•°ã‹ã‚‰ã®å¤‰æ›ã®å ´åˆï¼Œ101010ã¯ï¼Œ00101010ã¨ã—ã¦æ‰±ã†ã“ã¨ã«æ³¨æ„ï¼‰ 76ã‚’2é€²æ•°ã«å¤‰æ›ã—ã¦ï¼Œã€1001100ã€ï¼ã¾ãŸï¼Œä½™ã‚Šè¨ˆç®—ã®æ™‚ï¼Œä½™ã‚Šï¼‘ã‚’2^Nã«ç›´ã—ã¦ãŠãï¼ å°‘æ•°éƒ¨åˆ†ã®å ´åˆï¼Œä¸Šä½ã®æ¡ã‹ã‚‰ï¼Œã€(2^ï¼1 Ã— 0) + (2^ï¼2 Ã— 1) + (2^ï¼3 Ã— 0) + (2^ï¼4 Ã— 0) + (2^ï¼5 Ã— 1) + (2^ï¼6 Ã— 1) + (2^ï¼7 Ã— 0) + (2^ï¼8 Ã— 0) ã€ =ã€ 2^ï¼2ï¼‹2^ï¼5ï¼‹2^ï¼6 ã€ ï¼ˆâ€»16é€²æ•°ã‹ã‚‰ã®å¤‰æ›ã®å ´åˆï¼Œ1001100ã¯ï¼Œ01001100ã¨ã—ã¦æ‰±ã†ã“ã¨ã«æ³¨æ„ï¼‰ ã—ãŸãŒã£ã¦ï¼Œã€2^5ï¼‹2^3ï¼‹2^1ï¼‹2^ï¼2ï¼‹2^ï¼5ï¼‹2^ï¼6ã€ 03. è«–ç†å›è·¯ è«–ç†å¼ ä»¥ä¸‹ã®ãƒ™ãƒ³å›³ã§ã¯ï¼Œé›†åˆAã¨é›†åˆBã¯å…¥åŠ›ãŒã€1ã€ã®å ´åˆï¼Œå¤–å´ã¯å…¥åŠ›ãŒã€0ã€ã®å ´åˆã‚’è¡¨ã—ã¦ã„ã‚‹ï¼æ¼”ç®—æ–¹æ³•ã‚’æ€ã„å‡ºã™ã¨ãã«ã¯ï¼Œãƒ™ãƒ³å›³ã‚’æ€ã„å‡ºã›ï¼ å¦å®šå›è·¯ï¼ˆNOTå›è·¯ï¼‰ï¼ŒNOTæ¼”ç®—ï¼Œãƒ™ãƒ³å›³ ä¸¸ã„è¨˜å·ãŒå¦å®šã‚’è¡¨ã™ï¼ è«–ç†ç©å›è·¯ï¼ˆANDå›è·¯ï¼‰ï¼ŒANDæ¼”ç®—ï¼Œãƒ™ãƒ³å›³ ï¼’ã¤ã®bitã‚’æ¯”è¼ƒã—ã¦ï¼Œã©ã¡ã‚‰ã‚‚ã€1ã€ãªã‚‰ã€1ã€ã‚’å‡ºåŠ›ï¼ å¦å®šè«–ç†ç©å›è·¯ï¼ˆNANDå›è·¯ï¼‰ï¼ŒNANDæ¼”ç®—ï¼Œãƒ™ãƒ³å›³ ï¼’ã¤ã®bitã‚’æ¯”è¼ƒã—ã¦ï¼Œã©ã¡ã‚‰ã‚‚ã€1ã€ãªã‚‰ã€0ã€ã‚’å‡ºåŠ›ï¼ãƒ™ãƒ³å›³ã§ã¯ä¸¡æ–¹ãŒã€1ã€ä»¥å¤–ã®å ´åˆã‚’æŒ‡ã—ã¦ã„ã‚‹ãŒï¼Œå›è·¯ã®å‡ºåŠ›ã‚’ã†ã¾ãèª¬æ˜ã§ããªã„â€¦ï¼ è«–ç†å’Œå›è·¯ï¼ˆORå›è·¯ï¼‰ï¼ŒORæ¼”ç®—ï¼Œãƒ™ãƒ³å›³ ï¼’ã¤ã®bitã‚’æ¯”è¼ƒã—ã¦ï¼Œã©ã¡ã‚‰ã‹ãŒã€1ã€ãªã‚‰ã€1ã€ã‚’å‡ºåŠ›ï¼ æ’ä»–çš„è«–ç†å’Œå›è·¯ï¼ˆEORå›è·¯ï¼XORå›è·¯ï¼‰ï¼ŒEORæ¼”ç®—ï¼Œãƒ™ãƒ³å›³ ï¼’ã¤ã®bitã‚’æ¯”è¼ƒã—ã¦ï¼Œã©ã¡ã‚‰ã‹ã ã‘ãŒã€1ã€ãªã‚‰ã€1ã€ã‚’å‡ºåŠ›ï¼ å¦å®šè«–ç†å’Œå›è·¯ï¼ˆNORå›è·¯ï¼‰ï¼ŒNORæ¼”ç®—ï¼Œãƒ™ãƒ³å›³ ï¼’ã¤ã®bitã‚’æ¯”è¼ƒã—ã¦ï¼Œã©ã¡ã‚‰ã‚‚ã€0ã€ãªã‚‰ã€1ã€ã‚’å‡ºåŠ›ï¼ ãƒ•ãƒªãƒƒãƒ—ãƒ•ãƒ­ãƒƒãƒ—å›è·¯ ã‚ã‹ã‚Šã‚„ã™ã„å‹•ç”»è§£èª¬ï¼šhttps://www.youtube.com/watch?v=4vAGaWyGanU SRAMã®é›»å­å›è·¯ã«ç”¨ã„ã‚‰ã‚Œã¦ã„ã‚‹ï¼ˆ6ç« ã‚’å‚ç…§ï¼‰ï¼Setå´ã«åˆæœŸå€¤ã€1ã€ãŒå…¥åŠ›ã•ã‚Œã‚‹ï¼å…¥åŠ›ã‚’ã€0ã€ã«å¤‰ãˆã¦ã‚‚ï¼Œä¸¡æ–¹ã®å‡ºåŠ›çµæœã¯å¤‰ã‚ã‚‰ãšï¼Œå®‰å®šã—ã¦ã„ã‚‹ï¼ Resetå´ã«ã€1ã€ã‚’å…¥åŠ›ã™ã‚‹ã¨ï¼Œä¸¡æ–¹ã®å‡ºåŠ›çµæœã¯å¤‰åŒ–ã™ã‚‹ï¼ 03-02. è«–ç†æ¼”ç®—å‘½ä»¤ è«–ç†ç© ï¼Šä¾‹é¡Œï¼Š 16é€²æ•°ã®ã€Fã€ã¯ï¼Œ2é€²æ•°ã§ã€0000 0000 0000 1111ã€ã§è¡¨ã•ã‚Œã‚‹ï¼ã‚ˆã£ã¦ï¼Œ000Fã‚’ç”¨ã„ã¦ANDæ¼”ç®—ã—ãŸå ´åˆï¼Œä¸‹ä½4æ¡ã‚’å¤‰åŒ–ã•ã›ãšã«å–ã‚Šå‡ºã™ã“ã¨ãŒã§ãã‚‹ï¼ 1100 1101 1111 1000 0000 0000 0000 1111 ãƒ¼ãƒ¼ãƒ¼ãƒ¼ãƒ¼ãƒ¼ãƒ¼ãƒ¼ãƒ¼ãƒ¼ãƒ¼ 0000 0000 0000 1000 å¼•ç”¨ï¼šhttps://ameblo.jp/kou05/entry-10883110086.html ï¼Šä¾‹é¡Œï¼Š 16é€²æ•°ã®ã€7Fã€ã¯ï¼Œ2é€²æ•°ã§ã€0000 0000 0111 1111ã€ã§è¡¨ã•ã‚Œã‚‹ï¼ã‚ˆã£ã¦ï¼Œ7Fã‚’ç”¨ã„ã¦ANDæ¼”ç®—ã—ãŸå ´åˆï¼Œä¸‹ä½7æ¡ã‚’å¤‰åŒ–ã•ã›ãšã«å–ã‚Šå‡ºã™ã“ã¨ãŒã§ãã‚‹ï¼ 1100 1101 1111 1000 0000 0000 0111 1111 ãƒ¼ãƒ¼ãƒ¼ãƒ¼ãƒ¼ãƒ¼ãƒ¼ãƒ¼ãƒ¼ãƒ¼ãƒ¼ 0000 0000 0111 1000 ï¼Šä¾‹é¡Œï¼Š å¦å®šè«–ç†ç© è«–ç†å’Œ æ’ä»–çš„è«–ç†å’Œ å¦å®šè«–ç†å’Œ ï¼Šä¾‹é¡Œï¼Š Xã¨Yã®å¦å®šè«–ç†ç© X NAND Yã¯ï¼ŒNOT(X AND Y)ã¨ã—ã¦å®šç¾©ã•ã‚Œã‚‹ï¼X OR Yã‚’NANDã ã‘ã‚’ä½¿ã£ã¦è¡¨ã—ãŸè«–ç†å¼ã¯ã©ã‚Œã‹ï¼ â‡’Xï¼0ï¼ŒYï¼0ã®ã¨ãã«X OR YãŒã€0ã€ã«ãªã‚‹ã“ã¨ã‹ã‚‰ï¼Œã€0ã€ã«ãªã‚‹é¸æŠè‚¢ã‚’æ¢ã™ï¼ ãƒ»((X NAND Y) NAND X) NAND Y ((0 NAND 0)NAND 0)NAND 0 ï¼(1 NAND 0) NAND 0 ï¼1 NAND 0 ï¼1 ãƒ»(X NAND X) NAND (Y NAND Y) (0 NAND 0)NAND(0 NAND 0) ï¼1 NAND 1 ï¼0 ãƒ»(X NAND Y) NAND (X NAND Y) (0 NAND 0)NAND(0 NAND 0) ï¼1 NAND 1 ï¼0 ãƒ»X NAND (Y NAND (X NAND Y)) 0 NAND(0 NAND(0 NAND 0)) ï¼0 NAND (0 NAND 1) ï¼0 NAND 1 ï¼1 "},"public/software/software_middleware_web_nginx.html":{"url":"public/software/software_middleware_web_nginx.html","title":"ğŸ“– ï¸Nginx","keywords":"","body":"Nginx ã¯ã˜ã‚ã« æœ¬ã‚µã‚¤ãƒˆã«ã¤ãã¾ã—ã¦ï¼Œä»¥ä¸‹ã‚’ã”èªè­˜ã®ã»ã©å®œã—ããŠé¡˜ã„ã„ãŸã—ã¾ã™ï¼ å‚è€ƒï¼šhttps://hiroki-it.github.io/tech-notebook-gitbook/ 01. Tips ã‚³ãƒãƒ³ãƒ‰ãƒªãƒ•ã‚¡ãƒ¬ãƒ³ã‚¹ ãƒ»nginx å‚è€ƒï¼šhttps://httpd.apache.org/docs/trunk/ja/programs/apachectl.html ã‚ˆãä½¿ã†ã‚³ãƒãƒ³ãƒ‰ ãƒ»èµ·å‹•ï¼åœæ­¢ $ sudo systemctl start nginx $ sudo systemctl stop nginx ãƒ»è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ $ sudo service nginx configtest # ã‚‚ã—ãã¯ã“ã¡ã‚‰ $ sudo nginx -t ãƒ»è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã®åæ˜ ã¨å®‰å…¨ãªå†èµ·å‹• $ sudo systemctl reload nginx ãƒ»èª­ã¿è¾¼ã¾ã‚ŒãŸè¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã¨è¨­å®šå€¤ã®ä¸€è¦§ èª­ã¿è¾¼ã¾ã‚Œã¦ã„ã‚‹å…¨ã¦ã®è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆincludeãƒ‡ã‚£ãƒ¬ã‚¯ãƒ†ã‚£ãƒ–ã®å¯¾è±¡ã‚‚å«ã‚€ï¼‰ã®å†…å®¹ã‚’å±•é–‹ã—ã¦è¡¨ç¤ºã™ã‚‹ï¼ $ sudo nginx -T 02. æ©Ÿèƒ½ã®ç¨®é¡ Webã‚µãƒ¼ãƒï¼ã‚³ãƒ³ãƒ†ãƒŠã®ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢ã¨ã—ã¦ ãƒ»PHP-FPMã¨ã®çµ„ã¿åˆã‚ã› é™çš„ãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆãŒé€ä¿¡ã•ã‚Œã¦ããŸå ´åˆï¼ŒNginxã¯ãã®ã¾ã¾ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’è¿”ä¿¡ã™ã‚‹ï¼å‹•çš„ãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆãŒé€ä¿¡ã•ã‚Œã¦ããŸå ´åˆï¼ŒNginxã¯ï¼ŒFastCGIãƒ—ãƒ­ãƒˆã‚³ãƒ«ã‚’ä»‹ã—ã¦ï¼ŒPHP-FPMã«ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆã™ã‚‹ï¼ # è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ $ php-fpm -t ï¼Šå®Ÿè£…ä¾‹ï¼Š #------------------------------------- # HTTPãƒªã‚¯ã‚¨ã‚¹ãƒˆ #------------------------------------- server { listen 80; server_name example.com; root /var/www/example/public; index index.php index.html; include /etc/nginx/default/xxx.conf; #ã€/ã€ã§å§‹ã¾ã‚‹å…¨ã¦ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆã®å ´åˆ location / { try_files $uri $uri/ /index.php?$query_string; } #-------------------------------------------------- # FastCGIã‚’ç”¨ã„ãŸAppã‚µãƒ¼ãƒï¼ã‚³ãƒ³ãƒ†ãƒŠã¸ã®è»¢é€ï¼Œå—ä¿¡ # OSã«ã‚ˆã£ã¦ï¼Œfastcgi_paramsãƒ•ã‚¡ã‚¤ãƒ«ã®å¿…è¦ãªè¨­å®šãŒç•°ãªã‚‹ #-------------------------------------------------- location ~ \\.php$ { # ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆå…ˆã®TCPã‚½ã‚±ãƒƒãƒˆ fastcgi_pass 127.0.0.1:9000; # ã‚‚ã—ãã¯ï¼ŒUnixã‚½ã‚±ãƒƒãƒˆ # fastcgi_pass unix:/run/php-fpm/www.sock; # ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆå…ˆã®URLï¼ˆrootãƒ‡ã‚£ãƒ¬ã‚¯ãƒ†ã‚£ãƒ–å€¤+ãƒ‘ã‚¹ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ï¼‰ fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name; # è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã‚’èª­ã¿è¾¼ã‚€ include fastcgi_params; } } ãƒ»/etc/nginx/fastcgi_paramsãƒ•ã‚¡ã‚¤ãƒ« ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã§ä½¿ç”¨ã§ãã‚‹å¤‰æ•°ã‚’å®šç¾©ã™ã‚‹ï¼nginx.confãƒ•ã‚¡ã‚¤ãƒ«ã«ã‚ˆã£ã¦èª­ã¿è¾¼ã¾ã‚Œã‚‹ï¼OSã‚„ãã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã«ã‚ˆã£ã¦ã¯ï¼Œå¤‰æ•°ã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ãŒæ›¸ãæ›ãˆã‚‰ã‚Œã¦ã„ã‚‹ã“ã¨ãŒã‚ã‚‹ï¼å®Ÿéš›ã«ã‚µãƒ¼ãƒï¼ã‚³ãƒ³ãƒ†ãƒŠå†…ã«æ¥ç¶šã—ï¼Œä¸Šæ›¸ãè¨­å®šãŒå¿…è¦ãªã‚‚ã®ã¨ä¸è¦ãªã‚‚ã®ã‚’åˆ¤æ–­ã™ã‚‹å¿…è¦ãŒã‚ã‚‹ï¼ä»¥ä¸‹ã¯ï¼ŒDebian 10ã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã§ã‚ã‚‹ï¼ å‚è€ƒï¼šhttps://mogile.web.fc2.com/nginx_wiki/start/topics/examples/phpfcgi/ ï¼Šå®Ÿè£…ä¾‹ï¼Š #------------------------------------------------------- # OSã«ã‚ˆã£ã¦ï¼Œfastcgi_paramsãƒ•ã‚¡ã‚¤ãƒ«ã®å¿…è¦ãªè¨­å®šãŒç•°ãªã‚‹ #------------------------------------------------------- fastcgi_param QUERY_STRING $query_string; fastcgi_param REQUEST_METHOD $request_method; fastcgi_param CONTENT_TYPE $content_type; fastcgi_param CONTENT_LENGTH $content_length; fastcgi_param SCRIPT_NAME $fastcgi_script_name; fastcgi_param REQUEST_URI $request_uri; fastcgi_param DOCUMENT_URI $document_uri; fastcgi_param DOCUMENT_ROOT $document_root; fastcgi_param SERVER_PROTOCOL $server_protocol; fastcgi_param REQUEST_SCHEME $scheme; fastcgi_param HTTPS $https if_not_empty; fastcgi_param GATEWAY_INTERFACE CGI/1.1; fastcgi_param SERVER_SOFTWARE nginx/$nginx_version; fastcgi_param REMOTE_ADDR $remote_addr; fastcgi_param REMOTE_PORT $remote_port; fastcgi_param SERVER_ADDR $server_addr; fastcgi_param SERVER_PORT $server_port; fastcgi_param SERVER_NAME $server_name; # PHPã ã‘ã§å¿…è¦ãªè¨­å®š fastcgi_param REDIRECT_STATUS 200; ãƒ­ãƒ¼ãƒ‰ãƒãƒ©ãƒ³ã‚µï¼ã®ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢ã¨ã—ã¦ HTTPãƒ—ãƒ­ãƒˆã‚³ãƒ«ã§å—ä¿¡ã—ãŸãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’ï¼ŒHTTPSãƒ—ãƒ­ãƒˆã‚³ãƒ«ã«å¤‰æ›ã—ã¦è»¢é€ã™ã‚‹ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š #------------------------------------- # HTTPãƒªã‚¯ã‚¨ã‚¹ãƒˆ #------------------------------------- server { server_name example.com; listen 80; return 301 https://$host$request_uri; } #------------------------------------- # HTTPSãƒªã‚¯ã‚¨ã‚¹ãƒˆ #------------------------------------- server { server_name example.com; listen 443 ssl http2; index index.php index.html; #------------------------------------- # SSL #------------------------------------- ssl on; ssl_certificate /etc/nginx/ssl/server.crt; ssl_certificate_key /etc/nginx/ssl/server.key; add_header Strict-Transport-Security \"max-age=86400\"; location / { proxy_pass http://app1; proxy_set_header Host $host; proxy_set_header X-Forwarded-Proto $scheme; proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for; proxy_set_header X-Forwarded-Port $remote_port; } } ãƒªãƒãƒ¼ã‚¹Proxyã®ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢ã¨ã—ã¦ å‰æã¨ã—ã¦ï¼Œãƒ­ãƒ¼ãƒ‰ãƒãƒ©ãƒ³ã‚µï¼ã‹ã‚‰è»¢é€ã•ã‚ŒãŸHTTPãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’å—ä¿¡ã™ã‚‹ã¨ã™ã‚‹ï¼é™çš„ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆã¯ï¼Œãƒªãƒãƒ¼ã‚¹Proxyï¼ˆNginxï¼‰ã§ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’è¿”ä¿¡ã™ã‚‹ï¼Webã‚µãƒ¼ãƒã¯ï¼Œå¿…ãšãƒªãƒãƒ¼ã‚¹Proxyã‚’çµŒç”±ã—ã¦ï¼Œå‹•çš„ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’å—ä¿¡ã™ã‚‹ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š #------------------------------------- # HTTPãƒªã‚¯ã‚¨ã‚¹ãƒˆ #------------------------------------- server { server_name example.com; listen 80; return 301 https://$host$request_uri; #------------------------------------- # é™çš„ãƒ•ã‚¡ã‚¤ãƒ«ã§ã‚ã‚Œã°Nginxã§ãƒ¬ã‚¹ãƒãƒ³ã‚¹ #------------------------------------- location ~ ^/(images|javascript|js|css|flash|media|static)/ { root /var/www/example/static; expires 30d; } #------------------------------------- # å‹•çš„ãƒ•ã‚¡ã‚¤ãƒ«ã§ã‚ã‚Œã°Webã‚µãƒ¼ãƒã«è»¢é€ #------------------------------------- location / { proxy_pass http://127.0.0.1:8080; } } 03-01. Coreæ©Ÿèƒ½ ãƒ–ãƒ­ãƒƒã‚¯ ãƒ»events å‚è€ƒï¼šhttps://nginx.org/en/docs/ngx_core_module.html#events ï¼Šå®Ÿè£…ä¾‹ï¼Š events { worker_connections 1024; } ãƒ‡ã‚£ãƒ¬ã‚¯ãƒ†ã‚£ãƒ– ãƒ»user æœ¬è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã®å®Ÿè¡Œãƒ¦ãƒ¼ã‚¶ã¨ã‚°ãƒ«ãƒ¼ãƒ—ã‚’è¨­å®šã™ã‚‹ï¼ã‚°ãƒ«ãƒ¼ãƒ—åã‚’å…¥åŠ›ã—ãªã‹ã£ãŸå ´åˆï¼Œãƒ¦ãƒ¼ã‚¶åã¨åŒã˜ã‚‚ã®ãŒè‡ªå‹•çš„ã«è¨­å®šã•ã‚Œã‚‹ï¼ user www www; ãƒ»error_log error_log logs/error.log; ãƒ»include å…±é€šåŒ–ã•ã‚ŒãŸè¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã‚’èª­ã¿è¾¼ã‚€ï¼ã‚¢ã‚¹ã‚¿ãƒªã‚¹ã‚¯ã«ã‚ˆã‚‹ãƒ¯ã‚¤ãƒ«ãƒ‰ã‚«ãƒ¼ãƒ‰ã«å¯¾å¿œã—ã¦ã„ã‚‹ï¼ include /etc/nginx/conf.d/*.conf; ãƒ»pid pid logs/nginx.pid; ãƒ»worker_connections workerãƒ—ãƒ­ã‚»ã‚¹ãŒåŒæ™‚ã«å‡¦ç†å¯èƒ½ãªã‚³ãƒã‚¯ã‚·ãƒ§ãƒ³ã®æœ€å¤§æ•°ã‚’è¨­å®šã™ã‚‹ï¼ å‚è€ƒï¼šhttps://nginx.org/en/docs/ngx_core_module.html#worker_connections worker_connections 1024; ãƒ»worker_processes worker_processes 5; ãƒ»worker_rlimit_nofile worker_rlimit_nofile 8192; è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã®ç¨®é¡ ãƒ»/etc/nginx/conf.d/*.confãƒ•ã‚¡ã‚¤ãƒ« ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®è¨­å®šãŒå®šç¾©ã•ã‚Œã¦ã„ã‚‹ã„ãã¤ã‹ã®ãƒ•ã‚¡ã‚¤ãƒ«ï¼åŸºæœ¬çš„ã«ã¯èª­ã¿è¾¼ã‚€ã‚ˆã†ã«ã™ã‚‹ï¼ãŸã ã—ï¼Œnginx.confãƒ•ã‚¡ã‚¤ãƒ«ã®è¨­å®šãŒä¸Šæ›¸ãã•ã‚Œã¦ã—ã¾ã‚ãªã„ã‹ã‚’æ³¨æ„ã™ã‚‹ï¼ include /etc/nginx/conf.d/*.conf; ãƒ»/etc/nginx/mime.typesãƒ•ã‚¡ã‚¤ãƒ« ãƒªã‚¯ã‚¨ã‚¹ãƒˆã®Content-Typeã®MIMEã‚¿ã‚¤ãƒ—ã¨ãƒ•ã‚¡ã‚¤ãƒ«æ‹¡å¼µå­ã®é–“ã®å¯¾å¿œé–¢ä¿‚ãŒå®šç¾©ã•ã‚Œã¦ã„ã‚‹ãƒ•ã‚¡ã‚¤ãƒ«ï¼ include /etc/nginx/mime.types; ãƒ»/usr/share/nginx/modules/*.confãƒ•ã‚¡ã‚¤ãƒ« ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã®èª­ã¿è¾¼ã¿å‡¦ç†ãŒå®šç¾©ã•ã‚Œã¦ã„ã‚‹ãƒ•ã‚¡ã‚¤ãƒ«ï¼ include /usr/share/nginx/modules/*.conf; ä¾‹ãˆã°ï¼Œmod-http-image-filter.confãƒ•ã‚¡ã‚¤ãƒ«ã®å†…å®¹ã¯ä»¥ä¸‹ã®é€šã‚Šï¼ load_module \"/usr/lib64/nginx/modules/ngx_http_image_filter_module.so\"; 03-02. http_core_module ãƒ–ãƒ­ãƒƒã‚¯ ãƒ»http å…¨ã¦ã®Webã‚µãƒ¼ãƒã«å…±é€šã™ã‚‹å‡¦ç†ã‚’è¨­å®šã™ã‚‹ï¼ å‚è€ƒï¼šhttps://nginx.org/en/docs/http/ngx_http_core_module.html#http http { # Nginxã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’è¡¨ç¤ºã™ã‚‹ã‹ã©ã†ã‹ server_tokens off; # MIMEã‚¿ã‚¤ãƒ—ã‚’è¨­å®š include /etc/nginx/mime.types; default_type application/octet-stream; # ãƒ­ã‚°ã®ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ log_format main \"$remote_addr - $remote_user [$time_local] \"$request\" \" \"$status $body_bytes_sent \"$http_referer\" \" \"\"$http_user_agent\" \"$http_x_forwarded_for\"\"; access_log /var/log/nginx/access.log main; # sendfileã‚·ã‚¹ãƒ†ãƒ ã‚³ãƒ¼ãƒ«ã‚’ä½¿ç”¨ã™ã‚‹ã‹ã©ã†ã‹ sendfile on; # ãƒ˜ãƒƒãƒ€ãƒ¼ã¨ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã¾ã¨ã‚ã¦ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã™ã‚‹ã‹ã©ã†ã‹ tcp_nopush on; # keepaliveã‚’ç¶­æŒã™ã‚‹æ™‚é–“ keepalive_timeout 65; default_type application/octet-stream; include /etc/nginx/mime.types; include /etc/nginx/conf.d/*.conf; server { # ï½ ä¸­ç•¥ ï½ } } ãƒ»location å€‹åˆ¥ã®Webã‚µãƒ¼ãƒï¼ã‚³ãƒ³ãƒ†ãƒŠã«ãŠã‘ã‚‹ç‰¹å®šã®URLã®å‡¦ç†ã‚’è¨­å®šã™ã‚‹ï¼ https://nginx.org/en/docs/http/ngx_http_core_module.html#location ï¼Šå®Ÿè£…ä¾‹ï¼Š å„è¨­å®šã®å„ªå…ˆé †ä½ã«æ²¿ã£ãŸä»¥ä¸‹ã®é †ç•ªã§å®Ÿè£…ã—ãŸæ–¹ãŒè‰¯ã„ï¼ # 1. ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆãƒ«ãƒ¼ãƒˆã‚’æŒ‡å®šã—ãŸãƒªã‚¯ã‚¨ã‚¹ãƒˆã®å ´åˆ location = / { } # 2. ã€/images/ã€ã§å§‹ã¾ã‚‹ãƒªã‚¯ã‚¨ã‚¹ãƒˆã®å ´åˆ location ^~ /images/ { } # 3ã¨4. æœ«å°¾ãŒã€ã€gifï¼Œjpgï¼Œjpegã®å½¢å¼ã€ ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆã®å ´åˆ # ãƒãƒƒã‚¯ã‚¹ãƒ©ãƒƒã‚·ãƒ¥ã§ãƒ‰ãƒƒãƒˆã‚’ã‚¨ã‚¹ã‚±ãƒ¼ãƒ—ã—ï¼Œä»»æ„ã®æ–‡å­—ã§ã¯ãªãã€ãƒ‰ãƒƒãƒˆæ–‡å­—ã€ã¨ã—ã¦èªè­˜ã§ãã‚‹ã‚ˆã†ã«ã™ã‚‹ï¼ location ~* \\.(gif|jpg|jpeg)$ { } # 5-1. ã€/docs/ã€ã§å§‹ã¾ã‚‹å…¨ã¦ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆã®å ´åˆ location /docs/ { } # 5-2. ã€/ã€ã§å§‹ã¾ã‚‹å…¨ã¦ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆã®å ´åˆ location / { } ãƒ«ãƒ¼ãƒˆã®ä¸€è‡´æ¡ä»¶ã¯ï¼Œä»¥ä¸‹ã®é€šã‚Šã§ã‚ã‚‹ï¼ å„ªå…ˆé †ä½ prefix ãƒ«ãƒ¼ãƒˆã®ä¸€è‡´æ¡ä»¶ ãƒ«ãƒ¼ãƒˆä¾‹ 1 = æŒ‡å®šã—ãŸãƒ«ãƒ¼ãƒˆã«ä¸€è‡´ã™ã‚‹å ´åˆï¼ http://example.com/ 2 ^~ æŒ‡å®šã—ãŸãƒ«ãƒ¼ãƒˆã§å§‹ã¾ã‚‹å ´åˆï¼ http://example.com/images/foo.gif 3 ~ æ­£è¦è¡¨ç¾ï¼ˆå¤§æ–‡å­—ãƒ»å°æ–‡å­—ã‚’åŒºåˆ¥ã™ã‚‹ï¼‰ï¼ http://example.com/images/FOO.jpg 4 ~* æ­£è¦è¡¨ç¾ï¼ˆå¤§æ–‡å­—ãƒ»å°æ–‡å­—ã‚’åŒºåˆ¥ã—ãªã„ï¼‰ï¼ http://example.com/images/foo.jpg 5 ãªã— æŒ‡å®šã—ãŸãƒ«ãƒ¼ãƒˆã§å§‹ã¾ã‚‹å ´åˆï¼ ãƒ»http://example.com/foo.htmlãƒ»http://example.com/docs/foo.html ãƒ»server å€‹åˆ¥ã®Webã‚µãƒ¼ãƒï¼ã‚³ãƒ³ãƒ†ãƒŠã®å‡¦ç†ã‚’è¨­å®šã™ã‚‹ï¼ å‚è€ƒï¼šhttps://nginx.org/en/docs/http/ngx_http_core_module.html#server ï¼Šå®Ÿè£…ä¾‹ï¼Š server { # 80ç•ªãƒãƒ¼ãƒˆã§å—ä¿¡ listen 80; # ãƒ›ã‚¹ãƒˆå server_name example.com; root /var/www/example; index index.php index.html; location / { try_files $uri $uri/ /index.php?$query_string; } location ~ \\.php$ { fastcgi_pass unix:/run/php-fpm/www.sock; fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name; include fastcgi_params; } } ãƒ»ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆã¨ãƒªãƒ©ã‚¤ãƒˆã®é•ã„ ä»¥ä¸‹ã®ãƒªãƒ³ã‚¯ã‚’å‚è€ƒã«ã›ã‚ˆï¼ å‚è€ƒï¼šhttps://hiroki-it.github.io/tech-notebook-gitbook/public/software/software_application_collaboration_api_restful.html ãƒ‡ã‚£ãƒ¬ã‚¯ãƒ†ã‚£ãƒ– ãƒ»default_type Content-Typeãƒ˜ãƒƒãƒ€ãƒ¼ã®å€¤ãŒmime.typesãƒ•ã‚¡ã‚¤ãƒ«ã«ãªã„MIME typeã§ã‚ã£ãŸå ´åˆã«é©ç”¨ã™ã‚‹MIME typeã‚’è¨­å®šã™ã‚‹ï¼ å‚è€ƒï¼šhttps://nginx.org/en/docs/http/ngx_http_core_module.html#default_type ï¼Šå®Ÿè£…ä¾‹ï¼Š # application/octet-streamï¼šä»»æ„ã®MIME typeï¼ˆæŒ‡å®šãªã—ï¼‰ã¨è¦‹ãªã—ã¦é€ä¿¡ default_type application/octet-stream ãƒ»listen HTTPãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’80ç•ªãƒãƒ¼ãƒˆã§ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’å—ä¿¡ã™ã‚‹ï¼ å‚è€ƒï¼šhttps://nginx.org/en/docs/http/ngx_http_core_module.html#listen ï¼Šå®Ÿè£…ä¾‹ï¼Š listen 80; HTTPSãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’443ç•ªãƒãƒ¼ãƒˆã§ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’å—ä¿¡ã™ã‚‹ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š listen 443 ssl; ãƒ»sendfile ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã¸ã®ãƒ¬ã‚¹ãƒãƒ³ã‚¹æ™‚ã«ï¼Œãƒ•ã‚¡ã‚¤ãƒ«é€ä¿¡ã®ãŸã‚ã«Linuxã®sendfileã‚·ã‚¹ãƒ†ãƒ ã‚³ãƒ¼ãƒ«ã‚’ä½¿ç”¨ã™ã‚‹ã‹ã©ã†ã‹ã‚’è¨­å®šã™ã‚‹ï¼ãƒ•ã‚¡ã‚¤ãƒ«è¿”ä¿¡å‡¦ç†ã‚’OSå†…ã§è¡Œã†ãŸã‚ï¼Œå‡¦ç†ãŒé€Ÿããªã‚‹ï¼ä½¿ç”¨ã—ãªã„å ´åˆï¼ŒNginxãŒãƒ¬ã‚¹ãƒãƒ³ã‚¹æ™‚ã«è‡ªèº«ã§ãƒ•ã‚¡ã‚¤ãƒ«è¿”ä¿¡å‡¦ç†ã‚’è¡Œã†ï¼ å‚è€ƒï¼šhttps://nginx.org/en/docs/http/ngx_http_core_module.html#sendfile ï¼Šå®Ÿè£…ä¾‹ï¼Š sendfile on; ãƒ»server_name ãƒ‘ãƒ–ãƒªãƒƒã‚¯IPã‚¢ãƒ‰ãƒ¬ã‚¹ã«ç´ä»˜ããƒ‰ãƒ¡ã‚¤ãƒ³åã‚’è¨­å®šã™ã‚‹ï¼ å‚è€ƒï¼šhttps://nginx.org/en/docs/http/ngx_http_core_module.html#server_name server_name example.com; ãƒ‘ãƒ–ãƒªãƒƒã‚¯IPã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’ç›´æ¥è¨˜è¿°ã—ã¦ã‚‚ã‚ˆã„ï¼ server_name 192.168.0.0; ãƒ»ssl Nginxã§HTTPSãƒ—ãƒ­ãƒˆã‚³ãƒ«ã‚’å—ä¿¡ã™ã‚‹å ´åˆï¼Œsslãƒ—ãƒ­ãƒˆã‚³ãƒ«ã‚’æœ‰åŠ¹ã«ã™ã‚‹å¿…è¦ãŒã‚ã‚‹ï¼ å‚è€ƒï¼šhttps://nginx.org/en/docs/http/ngx_http_core_module.html#ssl ï¼Šå®Ÿè£…ä¾‹ï¼Š ssl on; ãƒ»ssl_certificate PEMè¨¼æ˜æ›¸ã®ãƒ‘ã‚¹ã‚’è¨­å®šã™ã‚‹ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š ssl_certificate /etc/nginx/ssl/server.crt; ãƒ»ssl_certificate_key PEMç§˜å¯†éµã®ãƒ‘ã‚¹ã‚’è¨­å®šã™ã‚‹ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š ssl_certificate_key /etc/nginx/ssl/server.key; ãƒ»tcp_nopush ä¸Šè¿°ã®Linuxã®sendfileã‚·ã‚¹ãƒ†ãƒ ã‚³ãƒ¼ãƒ«ã‚’ä½¿ç”¨ã™ã‚‹å ´åˆã«ï¼Œé©ç”¨ã§ãã‚‹ï¼ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã¸ã®ãƒ¬ã‚¹ãƒãƒ³ã‚¹æ™‚ï¼Œãƒ˜ãƒƒãƒ€ãƒ¼ã¨ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ï¼Œä¸€ã¤ã®ãƒ‘ã‚±ãƒƒãƒˆã«ã¾ã¨ã‚ã¦è¿”ä¿¡ã™ã‚‹ã‹ã©ã†ã‹ã‚’è¨­å®šã™ã‚‹ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š tcp_nopush on; ãƒ»try_files æŒ‡å®šã•ã‚ŒãŸãƒ‘ã‚¹ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é †ã«æ¢ã—ã¦ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ï¼ã¾ãŸï¼Œæœ€å¾Œã®ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã§å†…éƒ¨ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆã™ã‚‹ï¼æœ€å¾Œã®ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã§ã¯ï¼Œç•°ãªã‚‹ãƒ‘ã‚¹ã¾ãŸã¯ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚³ãƒ¼ãƒ‰ã‚’æŒ‡å®šã§ãã‚‹ï¼ã‚‚ã—ï¼Œnginxã¨ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’åˆ¥ã€…ã®ã‚µãƒ¼ãƒï¼ã‚³ãƒ³ãƒ†ãƒŠã§ç¨¼åƒã•ã›ã¦ã„ã‚‹å ´åˆï¼Œtry_filesãƒ‡ã‚£ãƒ¬ã‚¯ãƒ†ã‚£ãƒ–ãŒãƒ•ã‚¡ã‚¤ãƒ«æ¢ç´¢ã®å¯¾è±¡ã¨ã™ã‚‹å ´æ‰€ã¯ï¼Œã‚ãã¾ã§nginxã®ç¨¼åƒã™ã‚‹ã‚µãƒ¼ãƒï¼ã‚³ãƒ³ãƒ†ãƒŠå†…ã«ãªã‚‹ã“ã¨ã«æ³¨æ„ã™ã‚‹ï¼å†…éƒ¨ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆã«ã‚ˆã£ã¦ï¼Œnginxå†…ã§ãƒªã‚¯ã‚¨ã‚¹ãƒˆãŒå†å‡¦ç†ã•ã‚Œã‚‹ï¼ç•°ãªã‚‹ãƒ‘ã‚¹ã«å†…éƒ¨ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆã—ã¦ã„ãŸå ´åˆã¯ï¼Œãƒ‘ã‚¹ã«åˆã£ãŸlocationãƒ–ãƒ­ãƒƒã‚¯ã§æ”¹ã‚ã¦å‡¦ç†ã•ã‚Œã‚‹ï¼å†…éƒ¨ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆã¯ï¼ŒURLã‚’æ›¸ãæ›ãˆã¦ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆã›ãšã«å‡¦ç†ã‚’ç¶šè¡Œã™ã‚‹ã€ãƒªãƒ©ã‚¤ãƒˆã€ã¨ã¯ç•°ãªã‚‹ã“ã¨ã«æ³¨æ„ã™ã‚‹ï¼ å‚è€ƒï¼šhttps://nginx.org/en/docs/http/ngx_http_core_module.html#try_files location / { try_files file ... uri; } location / { try_files file ... =code; } ï¼Šå®Ÿè£…ä¾‹ï¼Š location / { # 1. ã€/foo.htmlã€ã®ãƒ‘ã‚¹ã§ã‚µãƒ¼ãƒï¼ã‚³ãƒ³ãƒ†ãƒŠã‹ã‚‰ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ¬ã‚¹ãƒãƒ³ã‚¹ # 2. ã€/foo.html/ã€ã®ãƒ‘ã‚¹ã§ã‚µãƒ¼ãƒï¼ã‚³ãƒ³ãƒ†ãƒŠã‹ã‚‰ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ¬ã‚¹ãƒãƒ³ã‚¹ # 3. ã€/index.php?query_stringã€ã®ãƒ‘ã‚¹ã§å†…éƒ¨ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ try_files $uri $uri/ /index.php?query_string; } # å†…éƒ¨ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆå¾Œã¯ï¼Œã€/index.php?foo=barã€ã®ãŸã‚ï¼Œä»¥ä¸‹ã§å‡¦ç†ã•ã‚Œã‚‹ï¼ location ~ \\.php$ { # php-fpmã«è»¢é€ã•ã‚Œã‚‹ï¼ fastcgi_pass 127.0.0.1:9000; fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name; include fastcgi_params; } ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯ã®å—ä¿¡ ãƒ»nginxã«ã‚ˆã‚‹ãƒ¬ã‚¹ãƒãƒ³ã‚¹ Webã‚µãƒ¼ãƒï¼ã‚³ãƒ³ãƒ†ãƒŠã®ã¿ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯ã‚’å—ä¿¡ã™ã‚‹ï¼ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯ç”¨ã®serverãƒ–ãƒ­ãƒƒã‚¯ã§ï¼Œgifãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’è¿”ä¿¡ã™ã‚‹ã‚ˆã†ã«locationãƒ–ãƒ­ãƒƒã‚¯ã‚’å®šç¾©ã™ã‚‹ï¼Nginxã§ã‚¢ã‚¯ã‚»ã‚¹ãƒ­ã‚°ã‚’å‡ºåŠ›ã™ã‚‹å¿…è¦ã¯ãªã„ãŸã‚ï¼Œlocationãƒ–ãƒ­ãƒƒã‚¯ã§ã¯access_logã‚’ç„¡åŠ¹åŒ–ã™ã‚‹ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š server { listen 80 default_server; listen [::]:80 default_server; root /var/www/example; index index.php index.html; location /healthcheck { empty_gif; access_log off; break; } } ãƒ»ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã«ã‚ˆã‚‹ãƒ¬ã‚¹ãƒãƒ³ã‚¹ Webã‚µãƒ¼ãƒï¼ã‚³ãƒ³ãƒ†ãƒŠã¨ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ä¸¡æ–¹ã§ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯ã‚’å—ä¿¡ã™ã‚‹ï¼ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å´ã«200ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã®ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’è¿”ä¿¡ã™ã‚‹ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã‚’å®Ÿè£…ã—ãŸã†ãˆã§ï¼Œãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯ç”¨ã®serverãƒ–ãƒ­ãƒƒã‚¯ã§ï¼Œã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã«ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã™ã‚‹ã‚ˆã†ã«locationãƒ–ãƒ­ãƒƒã‚¯ã‚’å®šç¾©ã™ã‚‹ï¼Nginxã§ã‚¢ã‚¯ã‚»ã‚¹ãƒ­ã‚°ã‚’å‡ºåŠ›ã™ã‚‹å¿…è¦ã¯ãªã„ãŸã‚ï¼Œlocationãƒ–ãƒ­ãƒƒã‚¯ã§ã¯access_logã‚’ç„¡åŠ¹åŒ–ã™ã‚‹ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š server { listen 80 default_server; listen [::]:80 default_server; root /var/www/example; index index.php index.html; location /healthcheck { try_files $uri $uri/ /index.php?$query_string; access_log off; } } 03-03. http_index_module ãƒ‡ã‚£ãƒ¬ã‚¯ãƒ†ã‚£ãƒ– ãƒ»index ãƒªã‚¯ã‚¨ã‚¹ãƒˆã®URLãŒãƒˆãƒ¬ã‚¤ãƒªãƒ³ã‚°ã‚¹ãƒ©ãƒƒã‚·ãƒ¥ã§çµ‚ã‚ã‚‹å…¨ã¦ã®å ´åˆã«ï¼ŒæŒ‡å®šã•ã‚ŒãŸãƒ•ã‚¡ã‚¤ãƒ«ã‚’URLã®æœ«å°¾ã«è¿½åŠ ã™ã‚‹ï¼ å‚è€ƒï¼šhttps://nginx.org/en/docs/http/ngx_http_index_module.html ï¼Šå®Ÿè£…ä¾‹ï¼Š index index.php; 03-04. http_headers_module ãƒ‡ã‚£ãƒ¬ã‚¯ãƒ†ã‚£ãƒ– ãƒ»add_header ãƒ¬ã‚¹ãƒãƒ³ã‚¹ãƒ˜ãƒƒãƒ€ãƒ¼ã‚’è¨­å®šã™ã‚‹ï¼ å‚è€ƒï¼šhttps://nginx.org/en/docs/http/ngx_http_headers_module.html#add_header ï¼Šå®Ÿè£…ä¾‹ï¼Š # Referrer-Policyãƒ˜ãƒƒãƒ€ãƒ¼ã«å€¤ã‚’è¨­å®šã™ã‚‹ add_header Referrer-Policy \"no-referrer-when-downgrade\"; 03-05. http_upstream_module ãƒ–ãƒ­ãƒƒã‚¯ ãƒ»upstream å‚è€ƒï¼šhttps://nginx.org/en/docs/http/ngx_http_upstream_module.html#upstream ï¼Šå®Ÿè£…ä¾‹ï¼Š upstream big_server_com { server 127.0.0.3:8000 weight=5; server 127.0.0.3:8001 weight=5; server 192.168.0.1:8000; server 192.168.0.1:8001; } 03-06. http_fast_cgi_module ãƒ‡ã‚£ãƒ¬ã‚¯ãƒ†ã‚£ãƒ– ãƒ»fastcgi_params FastCGIãƒ—ãƒ­ãƒˆã‚³ãƒ«ã‚’ä½¿ç”¨ã—ã¦Appã‚µãƒ¼ãƒï¼ã‚³ãƒ³ãƒ†ãƒŠã«ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’è»¢é€ã™ã‚‹å ´åˆã«ï¼Œè»¢é€å…ˆã§ä½¿ç”¨ã™ã‚‹å¤‰æ•°ã¨ãã®å€¤ã‚’è¨­å®šã™ã‚‹ï¼ å‚è€ƒï¼šhttps://nginx.org/en/docs/http/ngx_http_fastcgi_module.html#fastcgi_param ï¼Šå®Ÿè£…ä¾‹ï¼Š fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name; ãƒ»fastcgi_pass FastCGIãƒ—ãƒ­ãƒˆã‚³ãƒ«ã‚’ä½¿ç”¨ã—ã¦Appã‚µãƒ¼ãƒï¼ã‚³ãƒ³ãƒ†ãƒŠã«ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’è»¢é€ã™ã‚‹å ´åˆã«ï¼Œè»¢é€å…ˆã®ã‚¢ãƒ‰ãƒ¬ã‚¹ã¨ãƒãƒ¼ãƒˆã‚’è¨­å®šã™ã‚‹ï¼ å‚è€ƒï¼šhttps://nginx.org/en/docs/http/ngx_http_fastcgi_module.html#fastcgi_pass ï¼Šå®Ÿè£…ä¾‹ï¼Š fastcgi_pass 127.0.0.1:9000; 03-07. http_proxy_module ãƒ‡ã‚£ãƒ¬ã‚¯ãƒ†ã‚£ãƒ– ãƒ»proxy_pass HTTPãƒ—ãƒ­ãƒˆã‚³ãƒ«ã‚’ä½¿ç”¨ã—ã¦Appã‚µãƒ¼ãƒï¼ã‚³ãƒ³ãƒ†ãƒŠã«ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’è»¢é€ã™ã‚‹å ´åˆã«ï¼Œè»¢é€å…ˆã®ã‚¢ãƒ‰ãƒ¬ã‚¹ã¨ãƒãƒ¼ãƒˆã‚’è¨­å®šã™ã‚‹ï¼ å‚è€ƒï¼šhttps://nginx.org/en/docs/http/ngx_http_proxy_module.html#proxy_pass ï¼Šå®Ÿè£…ä¾‹ï¼Š proxy_pass http://127.0.0.1:8080/; "},"public/software/software_middleware_web_apache.html":{"url":"public/software/software_middleware_web_apache.html","title":"ğŸ“– ï¸Apache","keywords":"","body":"Apache ã¯ã˜ã‚ã« æœ¬ã‚µã‚¤ãƒˆã«ã¤ãã¾ã—ã¦ï¼Œä»¥ä¸‹ã‚’ã”èªè­˜ã®ã»ã©å®œã—ããŠé¡˜ã„ã„ãŸã—ã¾ã™ï¼ å‚è€ƒï¼šhttps://hiroki-it.github.io/tech-notebook-gitbook/ 01. ã‚³ãƒãƒ³ãƒ‰ ãƒªãƒ•ã‚¡ãƒ¬ãƒ³ã‚¹ ãƒ»httpd å‚è€ƒï¼šhttps://httpd.apache.org/docs/trunk/ja/programs/httpd.html ãƒ»apachectl å‚è€ƒï¼šhttps://httpd.apache.org/docs/trunk/ja/programs/apachectl.html ã‚³ãƒãƒ³ãƒ‰ ãƒ»ãƒ‡ã‚£ãƒ¬ã‚¯ãƒ†ã‚£ãƒ–ã®å®Ÿè£…å ´æ‰€ã®ä¸€è¦§ ç‰¹å®šã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒ†ã‚£ãƒ–ã‚’å®Ÿè£…ã™ã‚‹ã¹ãè¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä¸€è¦§ã§è¡¨ç¤ºã™ã‚‹ï¼ $ sudo httpd -L ãƒ»è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ # systemctlã‚³ãƒãƒ³ãƒ‰ã§ã¯å®Ÿè¡Œä¸å¯èƒ½ $ sudo service httpd configtest $ sudo apachectl configtest $ sudo apachectl -t ãƒ»ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«æ¸ˆã¿ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã®ä¸€è¦§ ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«æ¸ˆã¿ã®ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’ä¸€è¦§ã§è¡¨ç¤ºã™ã‚‹ï¼è¡¨ç¤ºã•ã‚Œã¦ã„ã‚‹ã‹ã‚‰ã¨ã„ã£ã¦ï¼Œèª­ã¿è¾¼ã¾ã‚Œã¦ã„ã‚‹ã¨ã¯é™ã‚‰ãªã„ï¼ $ sudo httpd -l ãƒ»èª­ã¿è¾¼ã¿æ¸ˆã¿ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã®ä¸€è¦§ ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«æ¸ˆã¿ã®ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã®ã†ã¡ã§ï¼Œå®Ÿéš›ã«èª­ã¿è¾¼ã¾ã‚Œã¦ã„ã‚‹ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’è¡¨ç¤ºã™ã‚‹ï¼ $ sudo httpd -M ãƒ»èª­ã¿è¾¼ã¿æ¸ˆã¿confãƒ•ã‚¡ã‚¤ãƒ«ã®ä¸€è¦§ èª­ã¿è¾¼ã¾ã‚ŒãŸconfãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä¸€è¦§ã§è¡¨ç¤ºã™ã‚‹ï¼ã“ã®çµæœã‹ã‚‰ï¼Œä½¿ã‚ã‚Œã¦ã„ãªã„confãƒ•ã‚¡ã‚¤ãƒ«ã‚‚ã‚’æ¤œå‡ºã§ãã‚‹ï¼ $ sudo httpd -t -D DUMP_CONFIG 2>/dev/null | grep \"# In\" | awk \"{print $4}\" ãƒ»èª­ã¿è¾¼ã¾ã‚Œã‚‹VirtualHostè¨­å®šã®ä¸€è¦§ $ sudo httpd -S ãƒ»å¼·åˆ¶çš„ãªèµ·å‹•ï¼åœæ­¢ï¼å†èµ·å‹• # èµ·å‹• $ sudo systemctl start httpd # åœæ­¢ $ sudo systemctl stop httpd # å†èµ·å‹• $ sudo systemctl restart httpd ãƒ»å®‰å…¨ãªå†èµ·å‹• Apacheã‚’æ®µéšçš„ã«å†èµ·å‹•ã™ã‚‹ï¼å®‰å…¨ã«å†èµ·å‹•ã§ãã‚‹ï¼ $ sudo apachectl graceful 02. æ©Ÿèƒ½ã®ç¨®é¡ Webã‚µãƒ¼ãƒã®ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢ã¨ã—ã¦ Appã‚µãƒ¼ãƒã®ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢ã¨ã—ã¦ mod_phpãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’èª­ã¿è¾¼ã‚€ã“ã¨ã«ã‚ˆã£ã¦ï¼ŒAppã‚µãƒ¼ãƒã®ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢ã¨ã—ã¦ã‚‚æ©Ÿèƒ½ã•ã›ã‚‹ã“ã¨ãŒã§ãã‚‹ï¼ 03. Coreã«ãŠã‘ã‚‹è¨­å®šãƒ‡ã‚£ãƒ¬ã‚¯ãƒ†ã‚£ãƒ– ServerRoot ãƒ»ServerRootã¨ã¯ ä»–ã®è¨­å®šãƒ‡ã‚£ãƒ¬ã‚¯ãƒ†ã‚£ãƒ–ã§ï¼Œç›¸å¯¾ãƒ‘ã‚¹ãŒè¨­å®šã•ã‚Œã¦ã„ã‚‹å ´åˆã«é©ç”¨ã•ã‚Œã‚‹ï¼ãã®ãƒ«ãƒ¼ãƒˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’å®šç¾©ã™ã‚‹ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š é€šå¸¸ã§ã‚ã‚Œã°ï¼Œetcãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªä»¥ä¸‹ã«confãƒ•ã‚¡ã‚¤ãƒ«ãŒé…ç½®ã•ã‚Œã‚‹ï¼ ServerRoot /etc/httpd CentOSã®EPELãƒªãƒã‚¸ãƒˆãƒªçµŒç”±ã§ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ãŸå ´åˆï¼ŒApacheã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«å¾Œã«ï¼Œoptãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªä»¥ä¸‹ã«confãƒ•ã‚¡ã‚¤ãƒ«ãŒè¨­ç½®ã•ã‚Œã‚‹ï¼ ServerRoot /opt/rh/httpd24/root/etc/httpd VirtualHost ãƒ»VirtualHostã¨ã¯ ãƒ‡ã‚£ãƒ¬ã‚¯ãƒ†ã‚£ãƒ–ã‚’å›²ã†ãƒ‡ã‚£ãƒ¬ã‚¯ãƒ†ã‚£ãƒ–ã®ä¸€ã¤ï¼ç‰¹å®šã®ãƒ›ã‚¹ãƒˆåã‚„IPã‚¢ãƒ‰ãƒ¬ã‚¹ã«ãƒªã‚¯ã‚¨ã‚¹ãƒˆãŒã‚ã£ãŸæ™‚ã«å®Ÿè¡Œã™ã‚‹ãƒ‡ã‚£ãƒ¬ã‚¯ãƒ†ã‚£ãƒ–ã‚’å®šç¾©ã™ã‚‹ï¼VirtualHostã¨ã„ã†åå‰ã®é€šã‚Šï¼Œ1 ã¤ã®ã‚µãƒ¼ãƒä¸Šã§ï¼Œä»®æƒ³çš„ã«è¤‡æ•°ã®ãƒ‰ãƒ¡ã‚¤ãƒ³ã‚’æ‰±ã†ã‚ˆã†ãªå‡¦ç†ã‚‚å®šç¾©ã§ãã‚‹ï¼è¤‡æ•°ã®VirtualHostã‚’è¨­å®šã—ãŸå ´åˆï¼Œä¸€ã¤ç›®ãŒãƒ‡ãƒ•ã‚©ãƒ«ãƒˆè¨­å®šã¨ã—ã¦èªè­˜ã•ã‚Œã‚‹ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š Listen 80 NameVirtualHost *:80 # Defaultã‚µãƒ¼ãƒã¨ã—ã¦æ‰±ã†ï¼ DocumentRoot /www/foo ServerName www.example.com DocumentRoot /www/bar ServerName www.example.org ãƒ»IPãƒ™ãƒ¼ã‚¹VirtualHost å„ãƒ‰ãƒ¡ã‚¤ãƒ³ã«ç•°ãªã‚‹IPã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’å‰²ã‚ŠæŒ¯ã‚‹ãƒãƒ¼ãƒãƒ£ãƒ«ãƒ›ã‚¹ãƒˆï¼ ãƒ»åå‰ãƒ™ãƒ¼ã‚¹VirtualHost å…¨ã¦ã®ãƒ‰ãƒ¡ã‚¤ãƒ³ã«åŒã˜IPã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’å‰²ã‚ŠæŒ¯ã‚‹ãƒãƒ¼ãƒãƒ£ãƒ«ãƒ›ã‚¹ãƒˆï¼ DocumentRoot ãƒ»DocumentRootã¨ã¯ ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã®ãƒ«ãƒ¼ãƒˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’å®šç¾©ã™ã‚‹ï¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆãƒ«ãƒ¼ãƒˆã«ã€index.htmlã€ã¨ã„ã†ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç½®ãã¨ï¼Œãƒ•ã‚¡ã‚¤ãƒ«åã‚’æŒ‡å®šã—ãªãã¨ã‚‚ï¼Œãƒ«ãƒ¼ãƒˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªå†…ã®index.htmlãƒ•ã‚¡ã‚¤ãƒ«ãŒï¼Œã‚¨ãƒ³ãƒˆãƒªãƒ¼ãƒã‚¤ãƒ³ãƒˆã¨ã—ã¦è‡ªå‹•çš„ã«èªè­˜ã•ã‚Œã¦è¡¨ç¤ºã•ã‚Œã‚‹ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š DocumentRoot /www/foo: ServerName www.example.com index.htmlä»¥å¤–ã®åå‰ã‚’ã‚¨ãƒ³ãƒˆãƒªãƒ¼ãƒã‚¤ãƒ³ãƒˆã«ã™ã‚‹å ´åˆï¼Œãƒ•ã‚¡ã‚¤ãƒ«åã‚’æŒ‡å®šã™ã‚‹å¿…è¦ãŒã‚ã‚‹ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š DocumentRoot /www/foo:/start-up.html ServerName www.example.com Directory ãƒ»Directoryã¨ã¯ ãƒ‡ã‚£ãƒ¬ã‚¯ãƒ†ã‚£ãƒ–ã‚’å›²ã†ãƒ‡ã‚£ãƒ¬ã‚¯ãƒ†ã‚£ãƒ–ã®ä¸€ã¤ï¼æŒ‡å®šã—ãŸãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªå†…ã«ãƒªã‚¯ã‚¨ã‚¹ãƒˆãŒã‚ã£ãŸæ™‚ã«å®Ÿè¡Œã™ã‚‹ãƒ‡ã‚£ãƒ¬ã‚¯ãƒ†ã‚£ãƒ–ã‚’å®šç¾©ã™ã‚‹ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š DirectoryIndex index.php AllowOverride All Userï¼ŒGroup ãƒ»Userã¨ã¯ httpdãƒ—ãƒ­ã‚»ã‚¹ã®ãƒ¦ãƒ¼ã‚¶åã‚’å®šç¾©ã™ã‚‹ï¼httpdãƒ—ãƒ­ã‚»ã‚¹ã«ã‚ˆã£ã¦ä½œæˆã•ã‚ŒãŸãƒ•ã‚¡ã‚¤ãƒ«ã®æ‰€æœ‰è€…åã¯ï¼Œã“ã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒ†ã‚£ãƒ–ã§å®šç¾©ã—ãŸã‚‚ã®ã«ãªã‚‹ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š User apache ãƒ»Groupã¨ã¯ httpdãƒ—ãƒ­ã‚»ã‚¹ã®ã‚°ãƒ«ãƒ¼ãƒ—åã‚’å®šç¾©ã™ã‚‹ï¼httpdãƒ—ãƒ­ã‚»ã‚¹ã«ã‚ˆã£ã¦ä½œæˆã•ã‚ŒãŸãƒ•ã‚¡ã‚¤ãƒ«ã®ã‚°ãƒ«ãƒ¼ãƒ—åã¯ï¼Œã“ã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒ†ã‚£ãƒ–ã§å®šç¾©ã—ãŸã‚‚ã®ã«ãªã‚‹ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š Group apache KeepAliveï¼ŒMaxKeepAliveRequestsï¼ŒKeepAliveTimeout ãƒ»KeepAliveã¨ã¯ HTTPãƒ—ãƒ­ãƒˆã‚³ãƒ«ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆã®ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã«å¯¾ã—ã¦ï¼Œã‚»ãƒƒã‚·ãƒ§ãƒ³IDã‚’ä»˜ä¸ã™ã‚‹ã‹ã©ã†ã‹ï¼Œã‚’å®šç¾©ã™ã‚‹ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š KeepAlive On ãƒ»KeepAliveTimeout ã‚»ãƒƒã‚·ãƒ§ãƒ³IDã‚’ä»˜ä¸ä¸­ã®ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã«ãŠã„ã¦ï¼Œå†ã³ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é€ä¿¡ã™ã‚‹ã¾ã§ã«ä½•ç§’é–“ç©ºã„ãŸã‚‰ï¼Œã‚»ãƒƒã‚·ãƒ§ãƒ³IDã‚’ç ´æ£„ã™ã‚‹ã‹ï¼Œã‚’å®šç¾©ã™ã‚‹ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š # KeepAliveãŒOnã®æ™‚ã®ã¿ KeepAliveTimeout 5 ãƒ»MaxKeepAliveRequests ã‚»ãƒƒã‚·ãƒ§ãƒ³IDã‚’ä»˜ä¸ä¸­ã®ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã«ãŠã„ã¦ï¼Œãƒªã‚¯ã‚¨ã‚¹ãƒˆã®ãƒ•ã‚¡ã‚¤ãƒ«ã®æœ€å¤§æ•°ã‚’å®šç¾©ã™ã‚‹ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š # KeepAliveãŒOnã®æ™‚ã®ã¿ MaxKeepAliveRequests 1000 04. mod_soã«ãŠã‘ã‚‹è¨­å®šãƒ‡ã‚£ãƒ¬ã‚¯ãƒ†ã‚£ãƒ– LoadModule ãƒ»LoadModule ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’èª­ã¿è¾¼ã¿ï¼Œè¨­å®šãƒ‡ã‚£ãƒ¬ã‚¯ãƒ†ã‚£ãƒ–ã‚’å®£è¨€ã§ãã‚‹ã‚ˆã†ã«ã™ã‚‹ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š ç›¸å¯¾ãƒ‘ã‚¹ã‚’æŒ‡å®šã—ï¼ŒServerRootã‚’é©ç”¨ã•ã›ã‚‹ï¼ã“ã‚Œã«ã‚ˆã‚Šï¼Œhttpdãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã®modulesãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªãŒå‚ç…§ã•ã‚Œã‚‹ï¼ # ServerRoot ãŒ /opt/rh/httpd24/root/etc/httpd ã ã¨ã™ã‚‹ï¼ LoadModule dir_module modules/mod_dir.so 04-02. mod_dirã«ãŠã‘ã‚‹è¨­å®šãƒ‡ã‚£ãƒ¬ã‚¯ãƒ†ã‚£ãƒ– DirectoryIndex ãƒ»DirectoryIndexã¨ã¯ Directoryãƒ‡ã‚£ãƒ¬ã‚¯ãƒ†ã‚£ãƒ–ã«ã‚ˆã£ã¦ãƒªã‚¯ã‚¨ã‚¹ãƒˆã•ã‚ŒãŸãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã®ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã™ã‚‹ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š DirectoryIndex index.html index.php ï¼Šå®Ÿè£…ä¾‹ï¼Š DirectoryIndex index.html DirectoryIndex index.php AllowOverride ãƒ»AllowOverrideã¨ã¯ åˆ¥ã«ç”¨æ„ã—ãŸ.htaccessãƒ•ã‚¡ã‚¤ãƒ«ã«ã¦ï¼Œæœ‰åŠ¹åŒ–ã™ã‚‹ãƒ‡ã‚£ãƒ¬ã‚¯ãƒ†ã‚£ãƒ–ã‚’å®šç¾©ã™ã‚‹ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š DirectoryIndex index.php AllowOverride All ãƒ»All åˆ¥ã«ç”¨æ„ã—ãŸ.htaccessãƒ•ã‚¡ã‚¤ãƒ«ã«ã¦ï¼Œå®Ÿè£…å¯èƒ½ãªãƒ‡ã‚£ãƒ¬ã‚¯ãƒ†ã‚£ãƒ–ã‚’å…¨ã¦æœ‰åŠ¹åŒ–ã™ã‚‹ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š AllowOverride All ãƒ»None åˆ¥ã«ç”¨æ„ã—ãŸ.htaccessãƒ•ã‚¡ã‚¤ãƒ«ã«ã¦ï¼Œå®Ÿè£…å¯èƒ½ãªãƒ‡ã‚£ãƒ¬ã‚¯ãƒ†ã‚£ãƒ–ã‚’å…¨ã¦ç„¡åŠ¹åŒ–ã™ã‚‹ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š AllowOverride None ãƒ»Indexes åˆ¥ã«ç”¨æ„ã—ãŸ.htaccessãƒ•ã‚¡ã‚¤ãƒ«ã«ã¦ï¼ŒDirectoryIndexãƒ‡ã‚£ãƒ¬ã‚¯ãƒ†ã‚£ãƒ–ã‚’æœ‰åŠ¹åŒ–ã™ã‚‹ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š AllowOverride Indexes 04-03. mod_writeã«ãŠã‘ã‚‹è¨­å®šãƒ‡ã‚£ãƒ¬ã‚¯ãƒ†ã‚£ãƒ– RewriteCond ãƒ»RewriteCondã¨ã¯ æ¡ä»¶åˆ†å²ã¨ï¼Œãã‚Œã«ã‚ˆã‚‹å‡¦ç†ã‚’å®šç¾©ã™ã‚‹ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š RewriteCond %å¤‰æ•°å æ¡ä»¶ ï¼Šå®Ÿè£…ä¾‹ï¼Š RewriteCond %{HTTP:X-Forwarded-Port} !^443$ RewriteRule ãƒ»ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆã¨ãƒªãƒ©ã‚¤ãƒˆã®é•ã„ ä»¥ä¸‹ã®ãƒªãƒ³ã‚¯ã‚’å‚è€ƒã«ã›ã‚ˆï¼ å‚è€ƒï¼šhttps://hiroki-it.github.io/tech-notebook-gitbook/public/software/software_application_collaboration_api_restful.html ãƒ»RewriteRuleã¨ã¯ æ¡ä»¶åˆ†å²ã«ã‚ˆã‚‹å‡¦ç†ã‚’å®šç¾©ã™ã‚‹ï¼ RewriteRule URLæ›¸æ›ï¼†è»¢é€ã®è¨˜è¿° ï¼Šå®Ÿè£…ä¾‹ï¼Š ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’HTTPSãƒ—ãƒ­ãƒˆã‚³ãƒ«ã«å¤‰æ›ã—ã¦ï¼Œãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆã™ã‚‹ï¼ RewriteRule ^(.*)?$ https://%{HTTP_HOST}$1 [R=301,L] 04-04. mod_setenvifã«ãŠã‘ã‚‹è¨­å®šãƒ‡ã‚£ãƒ¬ã‚¯ãƒ†ã‚£ãƒ– SetEnvIf ãƒ»SetEnvIfã¨ã¯ æ¡ä»¶åˆ†å²ã¨ç’°å¢ƒå¤‰æ•°ã®è¨­å®šã‚’å®šç¾©ã™ã‚‹ï¼ # ã‚¯ã‚¨ãƒªãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãŒä»¥ä¸‹ã®æ‹¡å¼µå­ã®å ´åˆã«ï¼Œ SetEnvIf Request_URI \"\\.(gif|jpe?g|png|js|css)$\" object-is-ignore ãƒ»nolog ãƒ­ã‚°ã‚’å‡ºåŠ›ã—ãªã„å ´åˆã‚’è¨­å®šã§ãã‚‹ï¼ 04-05. mod_log_configã«ãŠã‘ã‚‹è¨­å®šãƒ‡ã‚£ãƒ¬ã‚¯ãƒ†ã‚£ãƒ– LogFormat ãƒ»LogFormatã¨ã¯ ã‚¢ã‚¯ã‚»ã‚¹ãƒ­ã‚°ãƒ•ã‚¡ã‚¤ãƒ«ã®æ›¸å¼ã‚’å®šç¾©ã™ã‚‹ï¼ ãƒ»ã‚¢ã‚¯ã‚»ã‚¹ãƒ­ã‚°å½¢å¼ã¨å‡ºåŠ›å†…å®¹ ã‚¢ã‚¯ã‚»ã‚¹ãƒ­ã‚°ã®å‡ºåŠ›å…ˆãƒ­ã‚°ãƒ•ã‚¡ã‚¤ãƒ«ã¨ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã‚’åˆã‚ã›ã¦å®šç¾©ã™ã‚‹ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š # commonå½¢å¼ CustomLog logs/access_log common LogFormat \"%h %l %u %t \"%r\" %>s %b\" common # combineå½¢å¼ CustomLog logs/access_log combined LogFormat \"%h %l %u %t \"%r\" %>s %b \"%{Referer}i\" \"%{User-Agent}i\"\" combined ä»¥ä¸‹ã®ã‚ˆã†ãªãƒ­ã‚°ã«ãªã‚‹ï¼ # commonå½¢å¼ 118.86.194.71 - - [17/Aug/2011:23:04:03 +0900] \"GET /home/name/category/web HTTP/1.1\" 200 11815 # combineå½¢å¼ 118.86.194.71 - - [17/Aug/2011:23:04:03 +0900] \"GET /home/name/category/web HTTP/1.1\" 200 11815 \"http://naoberry.com/home/name/\" \"Mozilla/5.0 (Windows NT 6.1) AppleWebKit/535.1 (KHTML, like Gecko) Chrome/13.0.782.112 Safari/535.1\" ãƒ»ãƒ­ã‚°ã®å¤‰æ•°ä¸€è¦§ å¤‰æ•° å€¤ ä¾‹ %h ãƒªãƒ¢ãƒ¼ãƒˆãƒ›ã‚¹ãƒˆ 118.86.194.71 %l ãƒªãƒ¢ãƒ¼ãƒˆãƒ­ã‚°åï¼ˆåŸºæœ¬â€-â€œã«ãªã‚‹ï¼‰ - %u ãƒªãƒ¢ãƒ¼ãƒˆãƒ¦ãƒ¼ã‚¶ï¼ˆBasicèªè¨¼ã®ãƒ¦ãƒ¼ã‚¶ï¼‰ - %t ãƒªã‚¯ã‚¨ã‚¹ãƒˆå—ä»˜æ™‚åˆ» [17/Aug/2011:23:04:03 +0900] %r ãƒªã‚¯ã‚¨ã‚¹ãƒˆã®æœ€åˆã®è¡Œ GET /home/name/category/web HTTP/1.1 %s ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ 200 %b ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã®ãƒã‚¤ãƒˆæ•° 11815 %{Referer}i ãƒªãƒ•ã‚¡ãƒ© http://naoberry.com/home/name/ %{User-Agent}i ãƒ¦ãƒ¼ã‚¶ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆ Mozilla/5.0 (Windows NT 6.1) AppleWebKit/535.1 (KHTML, like Gecko) Chrome/13.0.782.112 Safari/535.1 ErrorLog ãƒ»ErrorLogã¨ã¯ ã‚¨ãƒ©ãƒ¼ãƒ­ã‚°ãƒ•ã‚¡ã‚¤ãƒ«ã®æ›¸å¼ã‚’å®šç¾©ã™ã‚‹ï¼ ãƒ»ã‚¨ãƒ©ãƒ¼ãƒ­ã‚°å½¢å¼ã¨å‡ºåŠ›å†…å®¹ ã‚¨ãƒ©ãƒ¼ãƒ­ã‚°ã®å‡ºåŠ›å…ˆã‚’å®šç¾©ã™ã‚‹ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š ErrorLog /var/log/httpd/error_log LogLevel ãƒ»LogLevelã¨ã¯ ã©ã®ãƒ¬ãƒ™ãƒ«ã¾ã§ãƒ­ã‚°ã‚’å‡ºåŠ›ã™ã‚‹ã‹ã‚’å®šç¾©ã™ã‚‹ï¼ ãƒ­ã‚°ãƒ¬ãƒ™ãƒ« æ„å‘³ è¨­å®šã®ç›®å®‰ emerg ã‚µãƒ¼ãƒãŒç¨¼å‹•ã§ããªã„ã»ã©ã®é‡å¤§ãªã‚¨ãƒ©ãƒ¼ alert critã‚ˆã‚Šã‚‚é‡å¤§ãªã‚¨ãƒ©ãƒ¼ crit é‡å¤§ãªã‚¨ãƒ©ãƒ¼ error ã‚¨ãƒ©ãƒ¼ warn è­¦å‘Š æœ¬ç•ªç’°å¢ƒ notice é€šçŸ¥ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ info ã‚µãƒ¼ãƒæƒ…å ± ã‚¹ãƒ†ãƒ¼ã‚¸ãƒ³ã‚°ç’°å¢ƒ debug ãƒ‡ãƒãƒƒã‚¯ç”¨ã®æƒ…å ± 04-06. mod_sslã«ãŠã‘ã‚‹è¨­å®šãƒ‡ã‚£ãƒ¬ã‚¯ãƒ†ã‚£ãƒ– SSLCertificateFile ãƒ»SSLCertificateFileã¨ã¯ PKIã«ãŠã‘ã‚‹å…¬é–‹éµã®æ¤œè¨¼ã«å¿…è¦ãªSSLã‚µãƒ¼ãƒè¨¼æ˜æ›¸ã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’å®šç¾©ã™ã‚‹ï¼æœ¬ç•ªç’°å¢ƒã§ã¯AWSã®ACMè¨¼æ˜æ›¸ã‚’ç”¨ã„ã‚‹ã“ã¨ãŒå¤šã„ãŸã‚ï¼ŒåŸºæœ¬çš„ãªç”¨é€”ã¨ã—ã¦ã¯ï¼Œãƒ­ãƒ¼ã‚«ãƒ«é–‹ç™ºã§ã®ã‚ªãƒ¬ã‚ªãƒ¬è¨¼æ˜æ›¸èª­ã¿è¾¼ã¿ã®ãŸã‚ã«ç”¨ã„ã‚‹ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š SSLCertificateFile /etc/httpd/conf.d/server.crt SSLCertificateKeyFile ãƒ»SSLCertificateKeyFileã¨ã¯ PKIã«ãŠã‘ã‚‹å…¬é–‹éµã®æ¤œè¨¼ã«å¿…è¦ãªç§˜å¯†éµã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’å®šç¾©ã™ã‚‹ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š SSLCertificateKeyFile /etc/httpd/conf.d/server.key 04-07. mod_headersã«ãŠã‘ã‚‹è¨­å®šãƒ‡ã‚£ãƒ¬ã‚¯ãƒ†ã‚£ãƒ– Header ãƒ»Headerã¨ã¯ ãƒ¬ã‚¹ãƒãƒ³ã‚¹ãƒ˜ãƒƒãƒ€ãƒ¼ã‚’å®šç¾©ã™ã‚‹ï¼setï¼Œappendï¼Œaddï¼Œunsetï¼Œechoã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’è¨­å®šã§ãã‚‹ï¼æ¨™æº–ã§ã¯2xxã¨3xxã®ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚³ãƒ¼ãƒ‰ã®ã¿ã§è¨­å®šãŒé©ç”¨ã•ã‚Œã‚‹ï¼ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã¨ã—ã¦ï¼Œalwaysã‚’è¨­å®šã™ã‚‹ã“ã¨ã§ï¼Œå…¨ã¦ã®ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚³ãƒ¼ãƒ‰ã§ãƒ˜ãƒƒãƒ€ãƒ¼ã‚’è¨­å®šã™ã‚‹ï¼ ãƒ»set ãƒ¬ã‚¹ãƒãƒ³ã‚¹ãƒ˜ãƒƒãƒ€ãƒ¼ã‚’è¿½åŠ ã™ã‚‹ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š Referrer-Policyãƒ˜ãƒƒãƒ€ãƒ¼ã‚’è¿½åŠ ã—ï¼Œå€¤ã‚’no-referrer-when-downgradeã¨ã™ã‚‹ï¼ã¡ãªã¿ã«ï¼ŒChrome85ä»¥é™ã®Referrer-Policyãƒ˜ãƒƒãƒ€ãƒ¼åˆæœŸå€¤ã®ä»•æ§˜å¤‰æ›´ã«ã¤ã„ã¦ã¯ï¼Œä»¥ä¸‹ã‚’å‚è€ƒã«ã›ã‚ˆï¼ å‚è€ƒï¼šhttps://www.chromestatus.com/feature/6251880185331712 Header set Referrer-Policy \"no-referrer-when-downgrade\" Header set Referrer-Policy \"no-referrer-when-downgrade\" always ãƒ»unset ãƒ¬ã‚¹ãƒãƒ³ã‚¹ãƒ˜ãƒƒãƒ€ãƒ¼ã‚’å‰Šé™¤ã™ã‚‹ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š Referrer-Policyãƒ˜ãƒƒãƒ€ãƒ¼ã‚’å‰Šé™¤ã™ã‚‹ Header unset Referrer-Policy \"no-referrer-when-downgrade Header unset Referrer-Policy \"no-referrer-when-downgrade\" always 05. htaccess å½±éŸ¿ç¯„å›² ãƒ»ãƒ«ãƒ¼ãƒˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã®å ´åˆ å…¨ã¦ã®ãƒ•ã‚¡ã‚¤ãƒ«ã«å¯¾ã—ã¦ï¼Œãƒ‡ã‚£ãƒ¬ã‚¯ãƒ†ã‚£ãƒ–ãŒé©ç”¨ã•ã‚Œã‚‹ï¼ ãƒ»ãã‚Œä»¥å¤–ã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã®å ´åˆ è¨­ç½®ã—ãŸãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªä»¥ä¸‹ã®éšå±¤ã®ãƒ•ã‚¡ã‚¤ãƒ«ã«å¯¾ã—ã¦é©ç”¨ã•ã‚Œã‚‹ï¼ "},"public/software/software_middleware_application_php_fpm.html":{"url":"public/software/software_middleware_application_php_fpm.html","title":"ğŸ“– ï¸PHP-FPM","keywords":"","body":"PHP-FPMï¼šPHP FastCGI Process Manager ã¯ã˜ã‚ã« æœ¬ã‚µã‚¤ãƒˆã«ã¤ãã¾ã—ã¦ï¼Œä»¥ä¸‹ã‚’ã”èªè­˜ã®ã»ã©å®œã—ããŠé¡˜ã„ã„ãŸã—ã¾ã™ï¼ å‚è€ƒï¼šhttps://hiroki-it.github.io/tech-notebook-gitbook/ 01. CGIã«ã¤ã„ã¦ ãƒ»CGIã¨ã¯ FastCGIï¼šFast Common Gateway Interface ãƒ»FastCGIã¨ã¯ CGIãƒ—ãƒ­ãƒˆã‚³ãƒ«ã®ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã‚’å‘ä¸Šã•ã›ãŸãƒ—ãƒ­ãƒˆã‚³ãƒ«ä»•æ§˜ã®ã“ã¨ï¼ PHP-FPM ãƒ»PHP-FPMã¨ã¯ PHPã®ãŸã‚ã«å®Ÿè£…ã•ã‚ŒãŸFastCGIã®ã“ã¨ï¼Webã‚µãƒ¼ãƒã¨PHPãƒ•ã‚¡ã‚¤ãƒ«ã®é–“ã§ãƒ‡ãƒ¼ã‚¿é€šä¿¡ã‚’è¡Œã†ï¼ å‚è€ƒï¼šhttps://developpaper.com/shared-cgi-fastcgi-and-php-fpm-1/ 02. è¨­å®š /etc/php-fpm.d/www.confãƒ•ã‚¡ã‚¤ãƒ« ãƒ»/etc/php-fpm.d/www.confãƒ•ã‚¡ã‚¤ãƒ«ã¨ã¯ PHP-FPMã®è¨­å®šã‚’å®šç¾©ã™ã‚‹ï¼php.iniãƒ•ã‚¡ã‚¤ãƒ«ã«ã‚ˆã£ã¦èª­ã¿è¾¼ã¾ã‚Œã‚‹ï¼php.iniãƒ•ã‚¡ã‚¤ãƒ«ã‚ˆã‚Šã‚‚å„ªå…ˆã•ã‚Œã‚‹ã®ã§ï¼Œè¨­å®šé …ç›®ãŒé‡è¤‡ã—ã¦ã„ã‚‹å ´åˆã¯ï¼Œã“ã¡ã‚‰ã‚’å¤‰æ›´ã™ã‚‹ï¼Nginxã‹ã‚‰ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’å—ä¿¡ã™ã‚‹å ´åˆï¼Œ/etc/php-fpm.d/www.confãƒ•ã‚¡ã‚¤ãƒ«ã¨/etc/nginx/nginx.confãƒ•ã‚¡ã‚¤ãƒ«ã®ä¸¡æ–¹ã§ï¼Œãƒ—ãƒ­ã‚»ã‚¹ã®ãƒ¦ãƒ¼ã‚¶åã‚’ã€www-dataã€ã¨ã™ã‚‹å¿…è¦ãŒã‚ã‚‹ï¼ã€www-dataã€ã¯Apacheãƒ—ãƒ­ã‚»ã‚¹ã®ãƒ¦ãƒ¼ã‚¶åã®æ¨™æº–å€¤ã§ã‚ã‚‹ï¼ å‚è€ƒï¼šhttps://www.php.net/manual/ja/install.unix.nginx.php ï¼Šå®Ÿè£…ä¾‹ï¼Š [www] # ãƒ—ãƒ­ã‚»ã‚¹ã®ãƒ¦ãƒ¼ã‚¶åï¼Œã‚°ãƒ«ãƒ¼ãƒ—å user = www-data group = www-data # UNIXãƒ‰ãƒ¡ã‚¤ãƒ³ã‚½ã‚±ãƒƒãƒˆã‚’ä½¿ç”¨ã™ã‚‹ãŸã‚ã«ï¼Œsockãƒ•ã‚¡ã‚¤ãƒ«ã‚’æŒ‡å®š listen = /var/run/php-fpm/php-fpm.sock # 127.0.0.1:9000 # UNIXãƒ‰ãƒ¡ã‚¤ãƒ³ã‚½ã‚±ãƒƒãƒˆã‚’ä½¿ç”¨ã™ã‚‹ãŸã‚ã«ï¼Œãƒ—ãƒ­ã‚»ã‚¹ã®ãƒ¦ãƒ¼ã‚¶åã‚’å¤‰æ›´ listen.owner = www-data listen.group = www-data listen.mode = 0660 # ã‚³ãƒ¡ãƒ³ãƒˆã‚¢ã‚¦ãƒˆæ¨å¥¨ ;listen.acl_users = apache,nginx # TCPã‚½ã‚±ãƒƒãƒˆã®IPã‚¢ãƒ‰ãƒ¬ã‚¹ listen.allowed_clients = 127.0.0.1 # ã‚¢ã‚¯ã‚»ã‚¹ãƒ­ã‚°ã‚’æ¨™æº–å‡ºåŠ›ã«å‡ºåŠ›ã™ã‚‹ï¼ access.log = /dev/stdout pm = dynamic pm.max_children = 50 pm.start_servers = 5 pm.min_spare_servers = 5 pm.max_spare_servers = 35 # ã‚·ã‚¹ãƒ†ãƒ ãƒ­ã‚°ãƒ•ã‚¡ã‚¤ãƒ«ã®å ´æ‰€ slowlog = /var/log/php-fpm/www-slow.log # ã‚¨ãƒ©ãƒ¼ãƒ­ã‚°ãƒ•ã‚¡ã‚¤ãƒ«ã®å ´æ‰€ # é–‹ç™ºç’°å¢ƒã§ã¯ï¼Œã‚¨ãƒ©ãƒ¼ãƒ­ã‚°ãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆ/var/log/php-fpm/www-error.logï¼‰ã«å‡ºåŠ› php_admin_value[error_log] = /dev/stderr php_admin_flag[log_errors] = on # ã‚»ãƒƒã‚·ãƒ§ãƒ³ã®ä¿å­˜æ–¹æ³•ï¼ã“ã“ã§ã¯redisã®ã‚­ãƒ¼ã¨ã—ã¦ä¿å­˜ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã¯filesï¼‰ php_value[session.save_handler] = redis # ã‚»ãƒƒã‚·ãƒ§ãƒ³ã®ä¿å­˜å ´æ‰€ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã¯ï¼Œ/var/lib/php/sessionï¼‰ php_value[session.save_path] = \"tcp://foo-redis.*****.ng.0001.apne1.cache.amazonaws.com:6379\" php_value[soap.wsdl_cache_dir] = /var/lib/php/wsdlcache ãƒ»Dockerã§ä½¿ç”¨ã™ã‚‹å ´åˆ PHP-FPMãƒ™ãƒ¼ã‚¹ã‚¤ãƒ¡ãƒ¼ã‚¸ã«ã¯zz-docker.confãƒ•ã‚¡ã‚¤ãƒ«ãŒçµ„ã¿è¾¼ã¾ã‚Œã¦ãŠã‚Šï¼Œã“ã®ãƒ•ã‚¡ã‚¤ãƒ«ã«ã¯PHP-FPMã®ä¸€éƒ¨ã®è¨­å®šãŒå®Ÿè£…ã•ã‚Œã¦ã„ã‚‹ï¼ã“ã‚Œã«å¾Œå‹ã¡ã™ã‚‹ãŸã‚ã«ï¼Œãƒ›ã‚¹ãƒˆå´ã§ã¯www.confãƒ•ã‚¡ã‚¤ãƒ«ã¨ã—ã¦å®šç¾©ã—ã¦ãŠãï¼Œã‚³ãƒ³ãƒ†ãƒŠå´ã«ã‚³ãƒ”ãƒ¼ã™ã‚‹æ™‚ã¯zzz-www.confãƒ•ã‚¡ã‚¤ãƒ«ã¨ã™ã‚‹ï¼ å‚è€ƒï¼šhttps://kengotakimoto.com/docker-laravel/#toc8 COPY ./php-fpm.d/www.conf /usr/local/etc/php-fpm.d/zzz-www.conf 04. ãƒ­ã‚° ãƒ­ã‚°ã®ç¨®é¡ ãƒ»NOTICE [01-Sep-2021 00:00:00] NOTICE: fpm is running, pid 1 ãƒ»WARNING [01-Sep-2021 00:00:00] WARNING: [pool www] server reached pm.max_children setting (5), consider raising it ãƒ»Fatal Error Fatal error: Allowed memory size of xxxxx bytes exhausted (tried to allocate 16 bytes) "},"public/software/software_middleware_database.html":{"url":"public/software/software_middleware_database.html","title":"ğŸ“– ï¸ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹","keywords":"","body":"ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ ã¯ã˜ã‚ã« æœ¬ã‚µã‚¤ãƒˆã«ã¤ãã¾ã—ã¦ï¼Œä»¥ä¸‹ã‚’ã”èªè­˜ã®ã»ã©å®œã—ããŠé¡˜ã„ã„ãŸã—ã¾ã™ï¼ å‚è€ƒï¼šhttps://hiroki-it.github.io/tech-notebook-gitbook/ 01. RDBï¼ˆé–¢ä¿‚ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ï¼‰ã¨ã¯ RDBMSï¼ˆé–¢ä¿‚ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ ï¼‰ã®ä»•çµ„ã¿ RDBã¯ï¼Œãƒ‡ãƒ¼ã‚¿åŒå£«ãŒãƒ†ãƒ¼ãƒ–ãƒ«çŠ¶ã«é–¢ä¿‚ã‚’æŒã¤ãƒ‡ãƒ¼ã‚¿æ ¼ç´å½¢å¼ã§ã‚ã‚‹ï¼ãƒ‡ãƒ¼ã‚¿ã¯ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã«ä¿å­˜ã™ã‚‹ï¼ RDBMSã¨RDBã®ç¨®é¡ ãƒ»MariaDB MariaDBãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚’ç®¡ç†ã§ãã‚‹RDBMS ãƒ»MySQL MySQLãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚’ç®¡ç†ã§ãã‚‹RDBMS ãƒ»PostgreSQL PostgreSQLãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚’ç®¡ç†ã§ãã‚‹RDBMS RDBSã«ãŠã‘ã‚‹ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚¨ãƒ³ã‚¸ãƒ³ RDBMSãŒãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã«å¯¾ã—ã¦ãƒ‡ãƒ¼ã‚¿ã®CRUDã®å‡¦ç†ã‚’è¡Œã†ãŸã‚ã«å¿…è¦ãªã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ã®ã“ã¨ï¼ ãƒ»InnoDB 01-02. NoSQLï¼ˆéé–¢ä¿‚ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ï¼‰ã¨ã¯ NoSQLã¯ï¼Œãƒ‡ãƒ¼ã‚¿åŒå£«ãŒé–¢ä¿‚ã‚’æŒãŸãªã„ãƒ‡ãƒ¼ã‚¿æ ¼ç´å½¢å¼ã§ã‚ã‚‹ï¼ãƒ‡ãƒ¼ã‚¿ã‚’ãƒ¡ã‚¤ãƒ³ãƒ¡ãƒ¢ãƒªã«ä¿å­˜ã™ã‚‹ï¼ NoSQLã®ç¨®é¡ 01-04. ãƒ†ãƒ¼ãƒ–ãƒ«è¨­è¨ˆ ERå›³ï¼šEntity Relation Diagram ä»¥ä¸‹ã®ãƒªãƒ³ã‚¯ã‚’å‚è€ƒã«ã›ã‚ˆï¼ å‚è€ƒï¼šhttps://hiroki-it.github.io/tech-notebook-gitbook/public/software/software_application_backend_php_object_orientation_analysis_design_programming.html æ­£è¦åŒ– ãƒ»æ­£è¦åŒ–ã¨ã¯ ç¹°ã‚Šè¿”ã—è¦ç´ ã®ã‚ã‚‹è¡¨ã‚’ã€æ­£è¦å½¢ã€ï¼Œãã®é€†ã‚’ã€éæ­£è¦å½¢ã€ã¨ã„ã†ï¼éæ­£è¦å½¢ã®è¡¨ã‹ã‚‰ï¼Œä»–ã¨é€£å‹•ã™ã‚‹ã‚«ãƒ©ãƒ ã‚’ç‹¬ç«‹ã•ã›ï¼Œæ­£è¦å½¢ã®è¡¨ã«å¤‰æ›´ã™ã‚‹ã“ã¨ã‚’ã€æ­£è¦åŒ–ã€ã¨ã„ã†ï¼ ãƒ»æ–¹æ³• ï¼Šä¾‹ï¼Š ã¾ãšï¼Œä¸»ã‚­ãƒ¼ãŒå—æ³¨Noã¨å•†å“IDã®2ã¤ã§ã‚ã‚‹ã“ã¨ã‚’ç¢ºèªï¼ã“ã‚Œã‚‰ã®ä¸»ã‚­ãƒ¼ã¯ï¼Œè¤‡åˆä¸»ã‚­ãƒ¼ã§ã¯ãªã„ã¨ã™ã‚‹ï¼ ã‚¨ã‚¯ã‚»ãƒ«ã§è¡¨ã‚’ä½œæˆ ã‚¨ã‚¯ã‚»ãƒ«ã§ä½œã‚‰ã‚ŒãŸä»¥ä¸‹ã®è¡¨ãŒã‚ã‚‹ã¨ä»®å®šï¼ ç¬¬ä¸€æ­£è¦åŒ–ï¼ˆç¹°ã‚Šè¿”ã—è¦ç´ ã®æ’é™¤ï¼‰ ãƒ¬ã‚³ãƒ¼ãƒ‰ã‚’1ã¤ãšã¤ã«åˆ†å‰²ï¼ ç¬¬äºŒæ­£è¦åŒ–ï¼ˆä¸»ã‚­ãƒ¼ã®é–¢æ•°å¾“å±æ€§ã‚’æ’é™¤ï¼‰ ä¸»ã‚­ãƒ¼ã¨ç‰¹å®šã®ã‚«ãƒ©ãƒ ãŒé€£å‹•ã™ã‚‹ï¼ˆé–¢æ•°å¾“å±æ€§ãŒã‚ã‚‹ï¼‰å ´åˆï¼Œã‚«ãƒ©ãƒ ã‚’å·¦è¡¨ã¨ã—ã¦ç‹¬ç«‹ã•ã›ã‚‹ï¼ä»Šå›ï¼Œä¸»ã‚­ãƒ¼ãŒ2ã¤ã‚ã‚‹ã®ã§ï¼Œã¾ãšå—æ³¨Noã‹ã‚‰é–¢æ•°å¾“å±æ€§ã‚’æ’é™¤ã—ã¦ã„ãï¼å—æ³¨Noã¨ä»–3ã‚«ãƒ©ãƒ ãŒé€£å‹•ã—ã¦ãŠã‚Šï¼Œå·¦è¡¨ã¨ã—ã¦ç‹¬ç«‹ã•ã›ã‚‹ï¼ä¸»ã‚­ãƒ¼ã¨é€£å‹•ã—ã¦ã„ãŸã‚«ãƒ©ãƒ ã‚’é™¤ã„ãŸã‚‚ã®ã‚’å³è¡¨ã¨ã™ã‚‹ï¼ã¾ãŸï¼Œä¸»ã‚­ãƒ¼ãŒé‡è¤‡ã™ã‚‹ãƒ­ãƒ¼ã‚’å‰Šé™¤ã™ã‚‹ï¼ æ¬¡ã«ï¼Œå•†å“IDã®é–¢æ•°å¾“å±æ€§ã‚’æ’é™¤ã—ã¦ã„ãï¼å•†å“IDã¨ä»–2ã‚«ãƒ©ãƒ ã«é–¢æ•°å¾“å±æ€§ãŒã‚ã‚Šï¼Œå·¦è¡¨ã¨ã—ã¦ç‹¬ç«‹ã•ã›ã‚‹ï¼ä¸»ã‚­ãƒ¼ã¨é€£å‹•ã—ã¦ã„ãŸã‚«ãƒ©ãƒ ã‚’é™¤ã„ãŸã‚‚ã®ã‚’å³è¡¨ã¨ã™ã‚‹ï¼ã¾ãŸï¼Œä¸»ã‚­ãƒ¼ãŒé‡è¤‡ã™ã‚‹ãƒ­ãƒ¼ã‚’å‰Šé™¤ã™ã‚‹ï¼ã“ã‚Œã§ï¼Œä¸»ã‚­ãƒ¼ã®é–¢æ•°å¾“å±æ€§ã®æ’é™¤ã¯çµ‚äº†ï¼ ç¬¬ä¸‰æ­£è¦åŒ–ï¼ˆä¸»ã‚­ãƒ¼ä»¥å¤–ã®ã‚«ãƒ©ãƒ ã®é–¢æ•°å¾“å±æ€§ã‚’æ’é™¤ï¼‰ æ¬¡ã«ä¸»ã‚­ãƒ¼ä»¥å¤–ã®ã‚«ãƒ©ãƒ ã®é–¢ä¿‚å¾“å±æ€§ã‚’æ’é™¤ã—ã¦ã„ãï¼ä¸Šè¨˜ã§ç‹¬ç«‹ã•ã›ãŸ3ã¤ã®è¡¨ã®ã†ã¡ï¼Œä¸€ç•ªå·¦ã®è¡¨ã§ï¼Œé¡§å®¢IDã¨é¡§å®¢åã«é–¢æ•°å¾“å±æ€§ãŒã‚ã‚‹ã®ã§ï¼Œé¡§å®¢IDã‚’æ–°ã—ã„ä¸»ã‚­ãƒ¼ã«è¨­å®šã—ï¼Œå·¦è¡¨ã¨ã—ã¦ç‹¬ç«‹ã•ã›ã‚‹ï¼ä¸»ã‚­ãƒ¼ã¨é€£å‹•ã—ã¦ã„ãŸã‚«ãƒ©ãƒ ã‚’é™¤ã„ãŸã‚‚ã®ã‚’å³è¡¨ã¨ã™ã‚‹ï¼ ã¾ã¨ã‚ ä¸»ã‚­ãƒ¼ã®é–¢ä¿‚å¾“å±æ€§ã®æ’é™¤ã«ã‚ˆã£ã¦ï¼Œå—æ³¨è¡¨ï¼Œå•†å“è¡¨ï¼Œæ•°é‡è¡¨ã«åˆ†å‰²ã§ããŸï¼ã¾ãŸï¼Œä¸»ã‚­ãƒ¼ä»¥å¤–ã®é–¢ä¿‚å¾“å±æ€§ã®æ’é™¤ã«ã‚ˆã£ã¦ï¼Œé¡§å®¢IDã‚’æ–°ã—ã„ä¸»ã‚­ãƒ¼ã¨ã—ãŸé¡§å®¢è¡¨ã«åˆ†å‰²ã§ããŸï¼ ï¼Šä¾‹ï¼Š ã‚¨ã‚¯ã‚»ãƒ«ã§è¡¨ã‚’ä½œæˆ ä»¥ä¸‹ã®ã‚ˆã†ãªè¡¨ã®å ´åˆï¼Œè¡Œã‚’åˆ†å‰²ã—ï¼Œç•°ãªã‚‹è¡¨ã¨è¦‹ãªã™ï¼ ç¬¬ä¸€æ­£è¦åŒ–ï¼ˆç¹°ã‚Šè¿”ã—è¦ç´ ã®æ’é™¤ï¼‰ ãƒ‡ãƒ¼ã‚¿ã®è¿½åŠ ï¼å‰Šé™¤ ãƒ‡ãƒ¼ã‚¿ã‚’è¿½åŠ ã™ã‚‹ã‚ã‚‹ã„ã¯å‰Šé™¤ã™ã‚‹å ´åˆï¼Œã‚«ãƒ©ãƒ ã§ã¯ãªãï¼Œãƒ¬ã‚³ãƒ¼ãƒ‰ã®å¢—æ¸›ã‚’è¡Œã†ï¼ã‚«ãƒ©ãƒ ã®å¢—æ¸›ã®å‡¦ç†ã«ã¯æ™‚é–“ãŒã‹ã‹ã‚‹ï¼ä¸€æ–¹ã§ï¼Œãƒ¬ã‚³ãƒ¼ãƒ‰ã®å¢—æ¸›ã®å‡¦ç†ã«ã¯æ™‚é–“ãŒã‹ã‹ã‚‰ãªã„ï¼ ï¼Šä¾‹ï¼Š è³ä¸ã‚’å¹´1å›ã‹ã‚‰ï¼Œ2å›ãƒ»3å›ã¨å¤‰ãˆã‚‹å ´åˆï¼Œä¸»ã‚­ãƒ¼ã‚’ç¹°ã‚Šè¿”ã—ï¼Œæ–°ã—ãè³ä¸åŒºåˆ†ã¨é‡‘é¡åŒºåˆ†ã‚’ä½œã‚‹ï¼ ãƒ†ãƒ¼ãƒ–ãƒ«å‘½åè¦å‰‡ ãƒ»ãƒ†ãƒ¼ãƒ–ãƒ«åã¯è¤‡æ•°å½¢ ä¾‹ãˆã°ï¼Œfoosã¨ã™ã‚‹ï¼ ã‚«ãƒ©ãƒ å‘½åè¦å‰‡ ãƒ»ãƒ—ãƒ¬ãƒ•ã‚£ã‚¯ã‚¹ã¯å˜æ•°å½¢ãƒ†ãƒ¼ãƒ–ãƒ«å ä¾‹ãˆã°ï¼Œfoo_idï¼Œfoo_nameï¼Œfoo_typeã¨ã™ã‚‹ï¼ãŸã ã—ï¼Œå­ãƒ†ãƒ¼ãƒ–ãƒ«ã®å¤–éƒ¨ã‚­ãƒ¼ã¨ç´ä»˜ãã‚«ãƒ©ãƒ ãŒã‚ã‚‹å ´åˆï¼Œãã®ã‚«ãƒ©ãƒ ã®ãƒ—ãƒ¬ãƒ•ã‚£ã‚¯ã‚¹ã¯ï¼Œå­ãƒ†ãƒ¼ãƒ–ãƒ«åã®å˜æ•°å½¢ã¨ã™ã‚‹ï¼ä¾‹ãˆã°ï¼Œbar_idã¨ã™ã‚‹ï¼ä¾‹å¤–ã¨ã—ã¦ï¼ŒActiveRecordãƒ‘ã‚¿ãƒ¼ãƒ³ã®ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ï¼ˆLaravelãªã©ï¼‰ã§ã¯ä½¿ç”¨ã—ãªã„æ–¹ãŒã‚ˆã„ã‹ã‚‚ã—ã‚Œãªã„ï¼ã“ã‚Œã‚‰ã®ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã§ã¯ï¼Œå˜æ•°å½¢ãƒ†ãƒ¼ãƒ–ãƒ«åã®ãƒ—ãƒ¬ãƒ•ã‚£ã‚¯ã‚¹ãŒãªã„ã‚«ãƒ©ãƒ åã‚’æƒ³å®šã—ã¦æ©Ÿèƒ½ãŒå‚™ã‚ã£ã¦ã„ã‚‹ã“ã¨ãŒã‚ã‚‹ï¼ã“ã®å ´åˆï¼ŒDBã¨ã®é€£æºã§æ¯å›ã‚«ãƒ©ãƒ åã‚’æ˜ç¤ºã™ã‚‹å¿…è¦ãŒã‚ã£ãŸã‚Šï¼Œæ¨™æº–ã§ã¯ãªã„ã‚«ãƒ©ãƒ åã‚’ä½¿ç”¨ã™ã‚‹ã“ã¨ã«ã‚ˆã‚‹ä¸å…·åˆãŒç™ºç”Ÿã—ãŸã‚Šï¼Œä¸ä¾¿ãªã“ã¨ãŒå¤šã‹ã£ãŸã‚Šã™ã‚‹ãŸã‚ï¼ŒãŠã™ã™ã‚ã—ãªã„ï¼ foo_id bar_id foo_name foo_type 1 1 foo 2 02. ACID ACIDã¨ã¯ ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³ã‚’å®Ÿç¾ã™ã‚‹ãŸã‚å¿…è¦ãªæ©Ÿèƒ½ã‚’ç•¥ã—ã¦ã€ACIDã€ã¨ã„ã†ï¼ å‚è€ƒï¼š http://tooljp.com/jyosho/docs/ACID/ACID.html https://atmarkit.itmedia.co.jp/ait/articles/1801/31/news011.html Atomicityï¼ˆä¸å¯åˆ†æ€§ï¼‰ ãƒ»Atomicityã¨ã¯ ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³ã«å«ã¾ã‚Œã‚‹å…¨ã¦ã®å‡¦ç†ãŒæˆåŠŸã™ã‚‹ã“ã¨ã¨ï¼Œã¾ãŸã¯ã„ãšã‚Œã‹ãŒå¤±æ•—ã—ãŸå ´åˆã«ã¯ä½•ã‚‚å®Ÿè¡Œã•ã‚Œã¦ã„ãªã„çŠ¶æ…‹ã«æˆ»ã‚‹ã“ã¨ã‚’ä¿è¨¼ã™ã‚‹æ€§è³ªã®ã“ã¨ï¼ã‚³ãƒŸãƒƒãƒˆãƒ¡ãƒ³ãƒˆåˆ¶å¾¡ã«ã‚ˆã£ã¦å®Ÿè£…ã•ã‚Œã‚‹ï¼ Consistencyï¼ˆæ•´åˆæ€§ï¼‰ ãƒ»Consistencyã¨ã¯ ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³ã®å®Ÿè¡Œå‰å¾Œã§ã‚ã£ã¦ã‚‚ï¼Œãƒ‡ãƒ¼ã‚¿ã¯å¸¸ã«DBã®ãƒ«ãƒ¼ãƒ«ã«å‰‡ã£ã¦ã„ã‚‹æ€§è³ªã®ã“ã¨ï¼ã‚«ãƒ©ãƒ ã®åˆ¶ç´„ã«ã‚ˆã£ã¦å®Ÿè£…ã•ã‚Œã‚‹ï¼ Isolationï¼ˆç‹¬ç«‹æ€§ï¼‰ ãƒ»Isolationã¨ã¯ ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³ã¯ãŠäº’ã„ã«ç‹¬ç«‹ã—ï¼Œå½±éŸ¿ã‚’ä¸ãˆåˆã‚ãªã„æ€§è³ªã®ã“ã¨ï¼æ’ä»–åˆ¶å¾¡ã«ã‚ˆã£ã¦å®Ÿè£…ã•ã‚Œã‚‹ï¼ Durabilityï¼ˆæ°¸ç¶šæ€§ï¼‰ ãƒ»Durabilityã¨ã¯ ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³ã®å®Œäº†å¾Œã¯ï¼ŒãŸã¨ãˆã‚·ã‚¹ãƒ†ãƒ éšœå®³ãŒã‚ã£ãŸã¨ã—ã¦ã‚‚ï¼Œãƒ‡ãƒ¼ã‚¿ã¯å¤±ã‚ã‚Œãªã„æ€§è³ªã®ã“ã¨ï¼éšœå®³å›å¾©åˆ¶å¾¡ã«ã‚ˆã£ã¦å®Ÿè£…ã•ã‚Œã‚‹ï¼ 02-02. ã‚³ãƒŸãƒƒãƒˆãƒ¡ãƒ³ãƒˆåˆ¶å¾¡ RDBã®æ›¸ãè¾¼ã¿ç³»ã®æ“ä½œ ãƒ»CREATEï¼UPDATE/DELETEå‡¦ç†ã®æµã‚Œ ãƒ»RDBã®æ“ä½œã¨å®Ÿéš›ã®ãƒ¡ã‚½ãƒƒãƒ‰ã®å¯¾å¿œé–¢ä¿‚ RDBã®æ›¸ãè¾¼ã¿ç³»ã®æ“ä½œ PDOã§ã®ãƒ¡ã‚½ãƒƒãƒ‰å ãƒ©ãƒƒãƒ”ãƒ³ã‚° ã‚·ã‚¹ãƒ†ãƒ éšœå®³ã‹ã‚‰ã®å›å¾© æ›´æ–°å‰ãƒ­ã‚°ã®è¨˜éŒ² â†“ â†“ â†“ â†“ â†“ ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³é–‹å§‹ beginTransaction() execute()é–‹å§‹ â†“ â†“ â†“ â¬†ï¸ ãƒ»Cï¼Uï¼Dã®å‡¦ç†ãƒ»ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³çµ‚äº† ãƒ»insert()ãƒ»update()ãƒ»delete() flush() â¬†ï¸ã€€Roll backï¼šrollBack() â†“ â†“ â†“ â¬†ï¸ Commitã«ã‚ˆã‚‹æ›´æ–°å¾Œãƒ­ã‚°ã®æ›¸ãè¾¼ã¿ï¼ commit()é–‹å§‹ â†“ â†“ â†“ â†“ â¬‡ï¸ â†“ â†“ â†“ â¬‡ï¸ã€€Roll forward â†“ â†“ â†“ â¬‡ï¸ Check Pointã«ã‚ˆã‚‹æ›´æ–°å¾Œãƒ­ã‚°ã®DBåæ˜  commit()çµ‚äº† execute()çµ‚äº† ãƒ»PDOã«ã‚ˆã‚‹RDBã®æ›¸ãè¾¼ã¿ç³»ã®æ“ä½œ PDOã§ã¯æ›¸ãè¾¼ã¿å‡¦ç†ã«execãƒ¡ã‚½ãƒƒãƒ‰ï¼Œèª­ã¿å‡ºã—å‡¦ç†ã«queryãƒ¡ã‚½ãƒƒãƒ‰ã‚’ä½¿ç”¨ã™ã‚‹ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š setAttribute(PDO::ATTR_ERRMODE, PDO::ERRMODE_EXCEPTION); // ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³ã‚’é–‹å§‹ï¼ $db->beginTransaction(); // ã„ãã¤ã‹ã®SQLãŒå®Ÿè¡Œã•ã‚Œã‚‹ï¼â€»ã‚‚ã—å¤±æ•—ã—ãŸå ´åˆï¼ŒERRMODE_EXCEPTIONã‚’å®Ÿè¡Œï¼ $db->exec(\"INSERT INTO movie(title, price) VALUES(\"ãƒãƒªãƒã‚¿\", 2000)\") $db->exec(\"INSERT INTO movie(title, price) VALUES(\"ã‚·ã‚¹ã‚¿ãƒ¼\", 2000)\") // ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³å†…ã®ä¸€é€£ã®ã‚¹ãƒ†ãƒ¼ãƒˆãƒ¡ãƒ³ãƒˆãŒæˆåŠŸã—ãŸã‚‰ï¼Œãƒ­ã‚°ãƒ•ã‚¡ã‚¤ãƒ«ã«ã‚³ãƒŸãƒƒãƒˆï¼ $db->commit(); } catch{ // ä¾‹å¤–ãŒç™ºç”Ÿã—ãŸã‚‰ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯ã—ï¼Œã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å‡ºåŠ›ï¼ $db->rollBack(); print \"å¤±æ•—ã—ã¾ã—ãŸï¼ï¼š{$e->getMessage()}\" } ãƒ»Doctrineã«ã‚ˆã‚‹RDBã®æ›¸ãè¾¼ã¿ç³»ã®æ“ä½œ è©³ã—ãã¯ï¼Œä»¥ä¸‹ã®ãƒªãƒ³ã‚¯ã‚’å‚è€ƒã«ã›ã‚ˆï¼ å‚è€ƒï¼šhttps://hiroki-it.github.io/tech-notebook-gitbook/public/backend_framework_symfony.html ã‚³ãƒŸãƒƒãƒˆã«ã‚ˆã‚‹ãƒ­ã‚°ãƒ•ã‚¡ã‚¤ãƒ«ã¸ã®æ›´æ–°å‰ãƒ­ã‚°ã¸ã®æ›¸ãè¾¼ã¿ ãƒ»ã‚³ãƒŸãƒƒãƒˆ ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³å†…ã®ä¸€é€£ã®ã‚¹ãƒ†ãƒ¼ãƒˆãƒ¡ãƒ³ãƒˆã‚’ï¼Œãƒ­ã‚°ãƒ•ã‚¡ã‚¤ãƒ«ã®æ›´æ–°å‰ãƒ­ã‚°ã¨ã—ã¦æ›¸ãè¾¼ã‚€ï¼ ãƒ»äºŒç›¸ã‚³ãƒŸãƒƒãƒˆ ã‚³ãƒŸãƒƒãƒˆã‚’ä»¥ä¸‹ã®äºŒã¤ã®æ®µéšã«åˆ†ã‘ã¦è¡Œã†ã“ã¨ï¼ACIDã®ã†ã¡ï¼ŒåŸå­æ€§ã¨ä¸€è²«æ€§ã‚’å®Ÿè£…ã—ã¦ã„ã‚‹ï¼ ä»–ã®ã‚µã‚¤ãƒˆã«æ›´æ–°å¯èƒ½ã‹ã©ã†ã‹ã‚’ç¢ºèªï¼ å…¨ã‚µã‚¤ãƒˆã‹ã‚‰ã®åˆæ„ãŒå¾—ã‚‰ã‚ŒãŸå ´åˆã«æ›´æ–°ã‚’ç¢ºå®šï¼ ãƒã‚§ãƒƒã‚¯ãƒã‚¤ãƒ³ãƒˆã«ãŠã‘ã‚‹ãƒ‡ãƒ¼ã‚¿ãƒ•ã‚¡ã‚¤ãƒ«ã¸ã®æ›¸ãè¾¼ã¿ ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³ã®çµ‚äº†å¾Œï¼ŒDBMSã¯ï¼Œå‡¦ç†é€Ÿåº¦ã‚’é«˜ã‚ã‚‹ãŸã‚ã«ï¼Œãƒ­ã‚°ãƒ•ã‚¡ã‚¤ãƒ«ã®æ›´æ–°å¾Œãƒ­ã‚°ã‚’ã„ã£ãŸã‚“ãƒ¡ãƒ¢ãƒªä¸Šã§ç®¡ç†ã™ã‚‹ï¼ ãã—ã¦ï¼Œãƒã‚§ãƒƒã‚¯ãƒã‚¤ãƒ³ãƒˆã§ï¼Œãƒ­ã‚°ãƒ•ã‚¡ã‚¤ãƒ«ã®æ›´æ–°å¾Œãƒ­ã‚°ã‚’ãƒ‡ã‚£ã‚¹ã‚¯ä¸Šã®ãƒ‡ãƒ¼ã‚¿ãƒ•ã‚¡ã‚¤ãƒ«ã«åæ˜ ã•ã›ã‚‹ï¼ã“ã®æ™‚ï¼Œãƒã‚§ãƒƒã‚¯ãƒã‚¤ãƒ³ãƒˆã¯ï¼Œè‡ªå‹•å®Ÿè¡Œã¾ãŸã¯æ‰‹å‹•å®Ÿè¡Œã§ä½œæˆã™ã‚‹ï¼ 02-03. éšœå®³å›å¾©åˆ¶å¾¡ ã‚·ã‚¹ãƒ†ãƒ éšœå®³ã‹ã‚‰ã®å›å¾© ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚µãƒ¼ãƒã®ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢éšœå®³ã®ã“ã¨ï¼ä¾‹ãˆã°ï¼ŒDBMSã‚„OSã®ãƒˆãƒ©ãƒ–ãƒ«ç­‰ã«ã‚ˆã‚Šã‚·ã‚¹ãƒ†ãƒ å…¨ä½“ãŒåœæ­¢ã™ã‚‹ï¼ ãƒ»ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯ éšœå®³ã«ã‚ˆã£ã¦ï¼Œãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³å†…ã®ä¸€é€£ã®ã‚¹ãƒ†ãƒ¼ãƒˆãƒ¡ãƒ³ãƒˆãŒã™ã¹ã¦å®Ÿè¡Œã•ã‚Œãªã‹ã£ãŸå ´åˆã«ï¼Œãƒ­ã‚°ãƒ•ã‚¡ã‚¤ãƒ«ã®æ›´æ–°å‰ãƒ­ã‚°ã‚’ç”¨ã„ã¦ï¼Œãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³ã®é–‹å§‹å‰ã®çŠ¶æ…‹ã«æˆ»ã™ï¼ ãƒ»ãƒ­ãƒ¼ãƒ«ãƒ•ã‚©ãƒ¯ãƒ¼ãƒ‰ éšœå®³ã«ã‚ˆã£ã¦ï¼Œãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³ã®çµ‚äº†å¾Œã«ä¸€é€£ã®ã‚¹ãƒ†ãƒ¼ãƒˆãƒ¡ãƒ³ãƒˆã®æ›´æ–°çµæœãŒãƒ‡ã‚£ã‚¹ã‚¯ã«åæ˜ ã•ã‚Œãªã‹ã£ãŸå ´åˆã«ï¼Œãƒ­ã‚°ãƒ•ã‚¡ã‚¤ãƒ«ã®æ›´æ–°å¾Œãƒ­ã‚°ã‚’ç”¨ã„ã¦ï¼Œãƒ‡ã‚£ã‚¹ã‚¯ä¸Šã®ãƒ‡ãƒ¼ã‚¿ãƒ•ã‚¡ã‚¤ãƒ«ã«æ›´æ–°çµæœã‚’åæ˜ ã•ã›ã‚‹ï¼ ï¼Šä¾‹ï¼Š ã€aã€ã®å€¤ã‚’æ›´æ–°ã™ã‚‹ã‚¹ãƒ†ãƒ¼ãƒˆãƒ¡ãƒ³ãƒˆã‚’å«ã‚€ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³ã®å¾Œã«ï¼Œã‚·ã‚¹ãƒ†ãƒ ãŒç•°å¸¸çµ‚äº†ã—ãŸå ´åˆï¼Œãƒ­ã‚°ãƒ•ã‚¡ã‚¤ãƒ«ã®æ›´æ–°å¾Œãƒ­ã‚°ã€a = 5ã€ã‚’ç”¨ã„ã¦ï¼Œãƒ‡ã‚£ã‚¹ã‚¯ä¸Šã®ãƒ‡ãƒ¼ã‚¿ãƒ•ã‚¡ã‚¤ãƒ«ã«æ›´æ–°çµæœã‚’åæ˜ ã•ã›ã‚‹ï¼ï¼ˆãƒ­ãƒ¼ãƒ«ãƒ•ã‚©ãƒ¯ãƒ¼ãƒ‰ï¼‰ ã€bã€ã®å€¤ã‚’æ›´æ–°ã™ã‚‹ã‚¹ãƒ†ãƒ¼ãƒˆãƒ¡ãƒ³ãƒˆã‚’å«ã‚€ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³ã®é€”ä¸­ã«ï¼Œã‚·ã‚¹ãƒ†ãƒ ãŒç•°å¸¸çµ‚äº†ã—ãŸå ´åˆï¼Œãƒ­ã‚°ãƒ•ã‚¡ã‚¤ãƒ«ã®æ›´æ–°å‰ãƒ­ã‚°ã€b = 1ã€ã‚’ç”¨ã„ã¦ï¼Œéšœå®³ç™ºç”Ÿå‰ã®çŠ¶æ…‹ã«æˆ»ã™ï¼ï¼ˆãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯ï¼‰ åª’ä½“éšœå®³ã‹ã‚‰ã®å›å¾© ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚µãƒ¼ãƒã®ãƒãƒ¼ãƒ‰ã‚¦ã‚§ã‚¢éšœå®³ã®ã“ã¨ï¼ä¾‹ãˆã°ï¼Œãƒãƒ¼ãƒ‰ãƒ‡ã‚£ã‚¹ã‚¯ã®éšœå®³ãŒã‚ã‚‹ï¼ãƒ‡ã‚£ã‚¹ã‚¯ã‚’åˆæœŸåŒ–ï¼äº¤æ›ã—ãŸå¾Œï¼Œãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚’ä¿®å¾©ã—ï¼Œãƒ­ã‚°ãƒ•ã‚¡ã‚¤ãƒ«ã®æ›´æ–°å¾Œãƒ­ã‚°ã€a = 5ã€ã€b = 1ã€ã‚’ç”¨ã„ã¦ï¼Œä¿®å¾©ã§ãã‚‹é™ã‚Šãƒ­ãƒ¼ãƒ«ãƒ•ã‚©ãƒ¯ãƒ¼ãƒ‰ã‚’è¡Œã†ï¼ ï¼Šä¾‹ï¼Š ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ãƒ•ã‚¡ã‚¤ãƒ«ã®å®Ÿéš›ã®ã‚³ãƒ¼ãƒ‰ -- -------------------------------------------------------- -- Host: xxxxx -- Server version: 10.1.38-MariaDB - mariadb.org binary distribution -- Server OS: Win64 -- HeidiSQL Version: 10.2.0.5611 -- -------------------------------------------------------- /*!40101 SET @OLD_CHARACTER_SET_CLIENT=@@CHARACTER_SET_CLIENT */; /*!40101 SET NAMES utf8 */; /*!50503 SET NAMES utf8mb4 */; /*!40014 SET @OLD_FOREIGN_KEY_CHECKS=@@FOREIGN_KEY_CHECKS, FOREIGN_KEY_CHECKS=0 */; /*!40101 SET @OLD_SQL_MODE=@@SQL_MODE, SQL_MODE=\"NO_AUTO_VALUE_ON_ZERO\" */; # ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ä½œæˆ -- Dumping database structure for kizukeba_pronami_php CREATE DATABASE IF NOT EXISTS `kizukeba_pronami_php` /*!40100 DEFAULT CHARACTER SET utf8 COLLATE utf8_unicode_ci */; USE `kizukeba_pronami_php`; # ãƒ†ãƒ¼ãƒ–ãƒ«ã®ãƒ‡ãƒ¼ã‚¿å‹ã‚’æŒ‡å®š -- Dumping structure for table kizukeba_pronami_php.mst_staff CREATE TABLE IF NOT EXISTS `mst_staff` ( `code` int(11) NOT NULL AUTO_INCREMENT, `name` varchar(15) COLLATE utf8_unicode_ci NOT NULL, `password` varchar(32) COLLATE utf8_unicode_ci NOT NULL, PRIMARY KEY (`code`) ) ENGINE=InnoDB AUTO_INCREMENT=22 DEFAULT CHARSET=utf8 COLLATE=utf8_unicode_ci; # ãƒ¬ã‚³ãƒ¼ãƒ‰ã‚’ä½œæˆ -- Dumping data for table kizukeba_pronami_php.mst_staff: ~8 rows (approximately) /*!40000 ALTER TABLE `mst_staff` DISABLE KEYS */; INSERT INTO `mst_staff` (`code`, `name`, `password`) VALUES (1, \"ç§¦åŸºåš\", \"xxxxxxx\"), (2, \"è—¤åŸåŸºå¤®\", \"xxxxxxx\"); /*!40000 ALTER TABLE `mst_staff` ENABLE KEYS */; /*!40101 SET SQL_MODE=IFNULL(@OLD_SQL_MODE, \"\") */; /*!40014 SET FOREIGN_KEY_CHECKS=IF(@OLD_FOREIGN_KEY_CHECKS IS NULL, 1, @OLD_FOREIGN_KEY_CHECKS) */; /*!40101 SET CHARACTER_SET_CLIENT=@OLD_CHARACTER_SET_CLIENT */; 02-04. æ’ä»–åˆ¶å¾¡ UPDATEå‡¦ç†ç«¶åˆå•é¡Œ ãƒ»UPDATEå‡¦ç†ç«¶åˆå•é¡Œã¨ã¯ ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ãƒ¬ã‚³ãƒ¼ãƒ‰ã®UPDATEå‡¦ç†ãŒï¼Œãƒ¬ã‚³ãƒ¼ãƒ‰ã®å–å¾—ã¨æ›´æ–°ã‹ã‚‰ãªã‚‹ã¨ã™ã‚‹ï¼ã‚·ã‚¹ãƒ†ãƒ ã®ãƒ¦ãƒ¼ã‚¶Aã¨BãŒãŠã‚Šï¼Œãƒ¦ãƒ¼ã‚¶BãŒUPDATEå‡¦ç†æ™‚ã«å–å¾—ã—ãªã‘ã‚Œã°ãªã‚‰ãªã„ãƒ¬ã‚³ãƒ¼ãƒ‰ã®çŠ¶æ…‹ã¯ï¼Œãƒ¦ãƒ¼ã‚¶AãŒUPDATEå‡¦ç†ã‚’çµ‚ãˆãŸå¾Œã®ã‚‚ã®ã§ã‚ã‚‹ï¼ã—ã‹ã—ï¼Œãƒ¦ãƒ¼ã‚¶AãŒãƒ¬ã‚³ãƒ¼ãƒ‰ã‚’å–å¾—ã—ã¦ã‹ã‚‰æ›´æ–°ã‚’çµ‚ãˆã‚‹ã¾ã§ã®é–“ã«ï¼Œãƒ¦ãƒ¼ã‚¶BãŒåŒã˜ããƒ¬ã‚³ãƒ¼ãƒ‰ã‚’å–å¾—ã—ã¦ã—ã¾ã†ã“ã¨ãŒã‚ã‚‹ï¼çµæœã¨ã—ã¦ï¼Œãƒ¦ãƒ¼ã‚¶Bã®UPDATEå‡¦ç†ã«ã‚ˆã£ã¦ï¼Œãƒ¦ãƒ¼ã‚¶Aã®å‡¦ç†ãŒä¸Šæ›¸ãã•ã‚Œï¼Œç„¡ã‹ã£ãŸã“ã¨ã«ãªã£ã¦ã—ã¾ã†ï¼ å‚è€ƒï¼šhttps://qiita.com/NagaokaKenichi/items/73040df85b7bd4e9ecfc ãƒ¦ãƒ¼ã‚¶Aã¨ãƒ¦ãƒ¼ã‚¶Bã®UPDATEå‡¦ç†ãŒä¸¦è¡Œã—ãŸã¨ã—ã¦ã‚‚ï¼Œãƒ¦ãƒ¼ã‚¶Aã®å‡¦ç†ãŒç„¡ã‹ã£ãŸã“ã¨ã«ãªã‚‰ãªã„ã‚ˆã†ä¿è¨¼ã™ã‚‹æ–¹æ³•ã¨ã—ã¦ï¼Œã€æ’ä»–åˆ¶å¾¡ã€ãŒã‚ã‚‹ï¼ æ’ä»–åˆ¶å¾¡ ãƒ»ç¨®é¡ å‚è€ƒï¼šhttps://qiita.com/momotaro98/items/5e37eefc62d726a30aee ç¨®é¡ èª¬æ˜ å…±æœ‰ï¼å æœ‰ãƒ­ãƒƒã‚¯ DBã«ã‚ˆã‚‹ãƒ­ãƒƒã‚¯æ©Ÿèƒ½ï¼ æ¥½è¦³çš„ï¼æ‚²è¦³çš„ãƒ­ãƒƒã‚¯ ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã¾ãŸã¯DBã«ã‚ˆã‚‹ãƒ­ãƒƒã‚¯æ©Ÿèƒ½ï¼ ãƒ»UPDATEå‡¦ç†ç«¶åˆå•é¡Œã®è¨±å®¹ UPDATEå‡¦ç†ç«¶åˆå•é¡Œã‚’è¨±å®¹ã—ï¼Œæ’ä»–åˆ¶å¾¡ã‚’ä½¿ç”¨ã—ãªã„é¸æŠè‚¢ã‚‚ã‚ã‚‹ï¼ å…±æœ‰ï¼å æœ‰ãƒ­ãƒƒã‚¯ ãƒ»å…±æœ‰ãƒ­ãƒƒã‚¯ DBã«ãŠã„ã¦ï¼ŒCRUDã®READå‡¦ç†ä»¥å¤–ã®å‡¦ç†ã‚’å®Ÿè¡Œä¸å¯èƒ½ã«ã™ã‚‹ï¼ãƒ¬ã‚³ãƒ¼ãƒ‰ã®READå‡¦ç†ã‚’å®Ÿè¡Œã™ã‚‹æ™‚ã«ï¼Œä»–è€…ã«ã‚ˆã£ã¦UPDATEå‡¦ç†ã•ã‚ŒãŸããªã„å ´åˆã«ç”¨ã„ã‚‹ï¼ã€Œå…±æœ‰ã€ã®åã®é€šã‚Šï¼Œå…±æœ‰ãƒ­ãƒƒã‚¯ã•ã‚Œã¦ã„ã‚‹ãƒ¬ã‚³ãƒ¼ãƒ‰ã«å¯¾ã—ã¦ï¼Œä»–ã®äººã‚‚å…±æœ‰ãƒ­ãƒƒã‚¯ã‚’è¡Œã†ã“ã¨ãŒã§ãã‚‹ï¼MySQLã§ã¯ï¼Œã€SELECT ... LOCK IN SHARE MODEã€ã‚’ä½¿ç”¨ã™ã‚‹ï¼ å‚è€ƒï¼šhttps://dev.mysql.com/doc/refman/5.7/en/innodb-locking-reads.html ãƒ»å æœ‰ãƒ­ãƒƒã‚¯ DBã«ãŠã„ã¦ï¼ŒCRUDã®å…¨ã¦ã®å‡¦ç†ã‚’å®Ÿè¡Œä¸å¯èƒ½ã«ã™ã‚‹ï¼ãƒ¬ã‚³ãƒ¼ãƒ‰ã®UPDATEå‡¦ç†ã‚’å®Ÿè¡Œã™ã‚‹æ™‚ã«ï¼Œä»–è€…ã«ã‚ˆã£ã¦UPDATEï¼READå‡¦ç†ã®ä¸¡æ–¹ã‚’å®Ÿè¡Œã•ã›ãªã„å ´åˆã«ç”¨ã„ã‚‹ï¼MySQLã§ã¯ï¼Œã€SELECT ... FOR UPDATEã€ã‚’ä½¿ç”¨ã™ã‚‹ï¼ å‚è€ƒï¼šhttps://dev.mysql.com/doc/refman/5.7/en/innodb-locking-reads.html ãƒ»ãƒ‡ãƒƒãƒ‰ãƒ­ãƒƒã‚¯ç¾è±¡ è¤‡æ•°ã®ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³ãŒï¼Œäº’ã„ã«ä»–è€…ãŒä½¿ã„ãŸã„ãƒ¬ã‚³ãƒ¼ãƒ‰ã‚’ãƒ­ãƒƒã‚¯ã—ã¦ã—ã¾ã„ï¼ŒãŠäº’ã„ã®ãƒ­ãƒƒã‚¯è§£é™¤ã‚’å¾…ã¡ç¶šã‘ã‚‹çŠ¶æ…‹ã®ã“ã¨ï¼ã‚‚ã†ä¸€æ–¹ã®ãƒ¬ã‚³ãƒ¼ãƒ‰ã®ãƒ­ãƒƒã‚¯ãŒè§£é™¤ã•ã‚Œãªã„ã¨ï¼Œè‡ªèº«ã®ãƒ¬ã‚³ãƒ¼ãƒ‰ã®ãƒ­ãƒƒã‚¯ã‚’è§£é™¤ã§ããªã„æ™‚ï¼Œãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³ãŒåœæ­¢ã™ã‚‹ï¼ å…±æœ‰ãƒ­ãƒƒã‚¯ã®å®Ÿè¡Œ å æœ‰ãƒ­ãƒƒã‚¯ã®å®Ÿè¡Œ å…±æœ‰ãƒ­ãƒƒã‚¯ã•ã‚ŒãŸãƒ¬ã‚³ãƒ¼ãƒ‰ ã€‡ âœ• å æœ‰ãƒ­ãƒƒã‚¯ã•ã‚ŒãŸãƒ¬ã‚³ãƒ¼ãƒ‰ âœ• âœ• æ¥½è¦³çš„ï¼æ‚²è¦³çš„ãƒ­ãƒƒã‚¯ ãƒ»æ¥½è¦³çš„ãƒ­ãƒƒã‚¯ DBã®ãƒ¬ã‚³ãƒ¼ãƒ‰ã«ã¯ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã«é–¢ã™ã‚‹ã‚«ãƒ©ãƒ å€¤ï¼ˆæœ€çµ‚æ›´æ–°æ—¥æ™‚ãªã©ï¼‰ãŒå­˜åœ¨ã—ã¦ã„ã‚‹ã¨ã™ã‚‹ï¼UPDATEå‡¦ç†ã®ãŸã‚ã«ãƒ¦ãƒ¼ã‚¶AãŒDBã®ãƒ¬ã‚³ãƒ¼ãƒ‰ã‚’å–å¾—ã—ãŸæ™‚ã«ï¼Œãƒãƒ¼ã‚¸ãƒ§ãƒ³å€¤ã‚’ä¸€æ™‚çš„ã«ä¿æŒã—ã¦ãŠãï¼ç¶šã‘ã¦æ›´æ–°ã™ã‚‹ç›´å‰ã«ï¼ŒDBã‹ã‚‰ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã®å€¤ã‚’æ”¹ã‚ã¦å–å¾—ã™ã‚‹ï¼ä¿æŒã—ã¦ãŠã„ãŸãƒãƒ¼ã‚¸ãƒ§ãƒ³å€¤ã¨DBã®å€¤ã‚’æ¯”è¼ƒã—ï¼ŒDBã®å€¤ã®æ–¹ãŒã‚ˆã‚Šæ–°ã—ã„ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã ã£ãŸå ´åˆï¼ŒUPDATEå‡¦ç†ãŒå¤±æ•—ã™ã‚‹ã‚ˆã†ã«ã™ã‚‹ï¼ç«¶åˆã«ã‚ˆã‚‹ã‚¨ãƒ©ãƒ¼ã‚’è¡¨ã™409ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚’ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã¨ã—ã¦è¿”ä¿¡ã™ã‚‹ã¨ã‚ˆã„ï¼ å‚è€ƒï¼š https://e-words.jp/w/%E6%A5%BD%E8%A6%B3%E3%83%AD%E3%83%83%E3%82%AF-%E6%82%B2%E8%A6%B3%E3%83%AD%E3%83%83%E3%82%AF.html https://medium-company.com/%E6%82%B2%E8%A6%B3%E3%83%AD%E3%83%83%E3%82%AF%E3%81%A8%E6%A5%BD%E8%A6%B3%E3%83%AD%E3%83%83%E3%82%AF%E3%81%AE%E9%81%95%E3%81%84/ ãƒ»æ‚²è¦³çš„ãƒ­ãƒƒã‚¯ ãƒ¦ãƒ¼ã‚¶AãŒDBã®ãƒ¬ã‚³ãƒ¼ãƒ‰ã‚’å–å¾—ã—ãŸæ™‚ç‚¹ã§ãƒ­ãƒƒã‚¯ã‚’èµ·å‹•ã—ï¼Œãƒ¦ãƒ¼ã‚¶Bã¯ãƒ¬ã‚³ãƒ¼ãƒ‰ã®å–å¾—ã™ã‚‰ã§ããªãã™ã‚‹ï¼ãƒ¦ãƒ¼ã‚¶AãŒæ›´æ–°ã‚’çµ‚ãˆã¦ãƒ­ãƒƒã‚¯ãŒè§£é™¤ã•ã‚Œï¼Œãã“ã§åˆã‚ã¦ãƒ¦ãƒ¼ã‚¶Bã¯ãƒ¬ã‚³ãƒ¼ãƒ‰ã‚’å–å¾—ã§ãã‚‹ã‚ˆã†ã«ãªã‚‹ï¼ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã§æ‚²è¦³çš„ãƒ­ãƒƒã‚¯ã‚’å®Ÿè£…ã™ã‚‹ã“ã¨ã¯é›£æ˜“åº¦ãŒé«˜ãï¼ŒåŸºæœ¬çš„ã«ã¯DBãŒæä¾›ã™ã‚‹ãƒ­ãƒƒã‚¯æ©Ÿèƒ½ã‚’ç”¨ã„ã‚‹ï¼ å‚è€ƒï¼š https://e-words.jp/w/%E6%A5%BD%E8%A6%B3%E3%83%AD%E3%83%83%E3%82%AF-%E6%82%B2%E8%A6%B3%E3%83%AD%E3%83%83%E3%82%AF.html https://medium-company.com/%E6%82%B2%E8%A6%B3%E3%83%AD%E3%83%83%E3%82%AF%E3%81%A8%E6%A5%BD%E8%A6%B3%E3%83%AD%E3%83%83%E3%82%AF%E3%81%AE%E9%81%95%E3%81%84/ ãƒ»ORMã®æ¥½è¦³çš„ãƒ­ãƒƒã‚¯ã«ã¤ã„ã¦ ORMãŒæ¥½è¦³çš„ãƒ­ãƒƒã‚¯ã®æ©Ÿèƒ½ã‚’æŒã£ã¦ã„ã‚‹å ´åˆãŒã‚ã‚‹ï¼PHPã®ORMã§ã‚ã‚‹Doctrineã®ãƒ­ãƒƒã‚¯æ©Ÿèƒ½ã«ã¤ã„ã¦ã¯ï¼Œä»¥ä¸‹ã®ãƒªãƒ³ã‚¯ã‚’å‚è€ƒã«ã›ã‚ˆï¼ å‚è€ƒï¼š https://www.doctrine-project.org/projects/doctrine-orm/en/2.9/reference/transactions-and-concurrency.html#locking-support https://qiita.com/tatsurou313/items/053cffdfe940a89d7f5a#or-%E3%83%9E%E3%83%83%E3%83%91%E3%83%BC%E3%81%AB%E3%81%8A%E3%81%91%E3%82%8B%E6%A5%BD%E8%A6%B3%E7%9A%84%E3%83%AD%E3%83%83%E3%82%AF%E3%81%AE%E5%AE%9F%E8%A3%85%E6%9C%89%E7%84%A1 ãƒ­ãƒƒã‚¯ã®ç²’åº¦ DB ï¼ ãƒ†ãƒ¼ãƒ–ãƒ« ï¼ ãƒ¬ã‚³ãƒ¼ãƒ‰ ï¼ ã‚«ãƒ©ãƒ  ã®é †ã«ï¼Œç²’åº¦ã¯å¤§ãã„ï¼ãƒ­ãƒƒã‚¯ã®ç²’åº¦ãŒç´°ã‹ã‘ã‚Œã°ï¼Œãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³ã®åŒæ™‚å®Ÿè¡Œæ€§ãŒé«˜ããªã£ã¦åŠ¹ç‡ã¯å‘ä¸Šã™ã‚‹ï¼ˆè¤‡æ•°ã®äººãŒDBã«å¯¾ã—ã¦ä½œæ¥­ã§ãã‚‹ï¼‰ï¼ã—ã‹ã—ï¼Œãƒ­ãƒƒã‚¯ã®ç²’åº¦ã‚’ç´°ã‹ãã™ã‚Œã°ã™ã‚‹ã»ã©ï¼Œãã‚Œã ã‘ãƒ™ãƒ¼ã‚¹ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ ã®CPUè² è·ã¯å¤§ãããªã‚‹ï¼ "},"public/software/software_middleware_database_mysql.html":{"url":"public/software/software_middleware_database_mysql.html","title":"ğŸ“– Myï¸SQL","keywords":"","body":"MySQL ã¯ã˜ã‚ã« æœ¬ã‚µã‚¤ãƒˆã«ã¤ãã¾ã—ã¦ï¼Œä»¥ä¸‹ã‚’ã”èªè­˜ã®ã»ã©å®œã—ããŠé¡˜ã„ã„ãŸã—ã¾ã™ï¼ å‚è€ƒï¼šhttps://hiroki-it.github.io/tech-notebook-gitbook/ 01. è¨­å®šãƒ•ã‚¡ã‚¤ãƒ« å…ƒã€…ã®å€¤ã‚’ã‚³ãƒ¡ãƒ³ãƒˆã‚¢ã‚¦ãƒˆã§ç¤ºã™ [mysqld] skip-host-cache # è¨˜è¿°ãªã— skip-name-resolve # è¨˜è¿°ãªã— datadir = /var/lib/mysql socket = /var/lib/mysql/mysql.sock secure-file-priv = /var/lib/mysql-files user = mysql pid-file = /var/run/mysqld/mysqld.pid # character set / collation character_set_server = utf8mb4 # latin1 collation_server = utf8mb4_general_ci # latin1 # timezone default-time-zone = SYSTEM log_timestamps = SYSTEM # UTC # Error Log log-error = mysql-error.log # /var/log/mysqld.log # Slow Query Log slow_query_log = 1 # off slow_query_log_file = mysql-slow.log # host_name-slow.log long_query_time = 3 # 10 log_queries_not_using_indexes = 0 # off # General Log general_log = 1 # off general_log_file = mysql-general.log # host_name.log [mysql] default-character-set = utf8mb4 # utf8 [client] default-character-set = utf8mb4 # utf8 02. ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ MySQLã®æº–å‚™ ãƒ»CentOSã«ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ« mysqlã‚³ãƒãƒ³ãƒ‰ã®ã¿ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ãŸã„å ´åˆ $ dnf install -y mysql mysqlã‚³ãƒãƒ³ãƒ‰ï¼Œãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚µãƒ¼ãƒæ©Ÿèƒ½ï¼Œã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ãŸã„å ´åˆã¯ã“ã¡ã‚‰ $ dnf install -y mysql-server ãƒ»DBã«æ¥ç¶š DBã«æ¥ç¶šã™ã‚‹ï¼pã‚ªãƒ—ã‚·ãƒ§ãƒ³ã®å€¤ã«ã¯ã‚¹ãƒšãƒ¼ã‚¹ãŒä¸è¦ã§ã‚ã‚‹ã“ã¨ã«æ³¨æ„ã™ã‚‹ï¼ $ mysql -u -p -h ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ ãƒ»ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã®è¡¨ç¤º ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã«ç™»éŒ²ã•ã‚Œã¦ã„ã‚‹ã‚°ãƒ­ãƒ¼ãƒãƒ«ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã¨ã‚»ãƒƒã‚·ãƒ§ãƒ³ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’è¡¨ç¤ºã™ã‚‹ï¼ -- ã‚»ãƒƒã‚·ãƒ§ãƒ³ï¼ã‚°ãƒ­ãƒ¼ãƒãƒ«ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’è¡¨ç¤º SHOW SESSION VARIABLES; SHOW GLOBAL VARIABLES; -- OSã¨DBã®ã‚¿ã‚¤ãƒ ã‚¾ãƒ¼ãƒ³ã«é–¢ã™ã‚‹ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’è¡¨ç¤º SHOW SESSION VARIABLES LIKE \"%time_zone\"; SHOW GLOBAL VARIABLES LIKE \"%time_zone\"; ãƒ»ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã®è¨­å®š -- ã‚°ãƒ­ãƒ¼ãƒãƒ«ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã®å ´åˆ SET GLOBAL time_zone = \"Asia/Tokyo\"; -- ã‚»ãƒƒã‚·ãƒ§ãƒ³ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã®å ´åˆ SET time_zone = \"Asia/Tokyo\"; 03. ãƒ†ãƒ¼ãƒ–ãƒ« CREATE TABLEå¥ ãƒ»ä½¿ã„æ–¹ ï¼Šå®Ÿè£…ä¾‹ï¼Š -- æ³¨æ–‡ãƒ†ãƒ¼ãƒ–ãƒ«ä½œæˆ CREATE TABLE order_data ( -- ãƒ—ãƒ©ã‚¤ãƒãƒªã‚­ãƒ¼åˆ¶ç´„ order_id INT(10) PRIMARY KEY COMMENT \"æ³¨æ–‡ID\", -- Not Nullåˆ¶ç´„ order_kbn INT(3) NOT NULL COMMENT \"æ³¨æ–‡åŒºåˆ†\", system_create_date_time DATETIME NOT NULL COMMENT \"ã‚·ã‚¹ãƒ†ãƒ ç™»éŒ²æ—¥æ™‚\", system_update_date_time DATETIME NOT NULL COMMENT \"ã‚·ã‚¹ãƒ†ãƒ æ›´æ–°æ—¥æ™‚\", delete_flg INT(1) DEFAULT 0 NOT NULL COMMENT \"0ï¼šé€šå¸¸ï¼Œ1ï¼šå‰Šé™¤æ¸ˆ\", -- è¤‡åˆãƒ—ãƒ©ã‚¤ãƒãƒªã‚­ãƒ¼åˆ¶ç´„ï¼ˆã“ã‚Œã‚’æŒ‡å®šã™ã‚‹å ´åˆï¼Œä¸Šè¨˜ã®ãƒ—ãƒ©ã‚¤ãƒãƒªã‚­ãƒ¼åˆ¶ç´„ã®è¨˜è¿°ã¯ä¸è¦ï¼‰ PRIMARY KEY(order_id, order_kbn) -- å‚ç…§åˆ¶ç´„ã‚­ãƒ¼ FOREIGN KEY order_kbn REFERENCES order_kbn_data ) CREATE VIEWå¥ ãƒ»ä½¿ã„æ–¹ ãƒ“ãƒ¥ãƒ¼ã¨ã¯ã‚ã‚‹è¡¨ã®ç‰¹å®šã®ã‚«ãƒ©ãƒ ã‚„æŒ‡å®šã—ãŸæ¡ä»¶ã«åˆè‡´ã™ã‚‹ãƒ¬ã‚³ãƒ¼ãƒ‰ãªã©ã‚’å–ã‚Šå‡ºã—ãŸä»®æƒ³ã®è¡¨ï¼ã¾ãŸï¼Œè¤‡æ•°ã®è¡¨ã‚’çµåˆã—ãŸãƒ“ãƒ¥ãƒ¼ã‚’ä½œæˆã§ãã‚‹ï¼ãƒ“ãƒ¥ãƒ¼ã‚’ä½œæˆã™ã‚‹ã“ã¨ã«ã‚ˆã‚Šãƒ¦ãƒ¼ã‚¶ã«å¿…è¦æœ€å°é™ã®ã‚«ãƒ©ãƒ ã‚„ãƒ¬ã‚³ãƒ¼ãƒ‰ã®ã¿ã«ã‚¢ã‚¯ã‚»ã‚¹ã•ã›ã‚‹äº‹ãŒã§ãï¼Œã¾ãŸçµåˆæ¡ä»¶ã‚’æŒ‡å®šã—ãªãã¦ã‚‚æ—¢ã«çµåˆã•ã‚ŒãŸè¡¨ã«ã‚¢ã‚¯ã‚»ã‚¹ã§ãã‚‹ï¼ â‡’ã‚ˆãã‚ã‹ã‚‰ã‚“â€¦ ï¼Šå®Ÿè£…ä¾‹ï¼Š CREATE VIEW { ãƒ†ãƒ¼ãƒ–ãƒ«å } AS SELECT * FROM { ãƒ†ãƒ¼ãƒ–ãƒ«å }; ãƒ—ãƒ©ã‚¤ãƒãƒªã‚­ãƒ¼ ãƒ»ãƒ—ãƒ©ã‚¤ãƒãƒªã‚­ãƒ¼ã¨ã¯ ãƒ†ãƒ¼ãƒ–ãƒ«ã®ä¸­ã§ï¼Œãƒ¬ã‚³ãƒ¼ãƒ‰ã‚’ä¸€æ„ã«è­˜åˆ¥ã§ãã‚‹å€¤ã‚’ã€ãƒ—ãƒ©ã‚¤ãƒãƒªã‚­ãƒ¼ã€ã®å€¤ã¨å‘¼ã¶ï¼ ãƒ»ãƒ—ãƒ©ã‚¤ãƒãƒªã‚­ãƒ¼ã¨ã—ã¦ä½¿ç”¨å¯èƒ½ãªã‚‚ã® ä¸€æ„ã«è­˜åˆ¥ã§ãã‚‹ã‚‚ã®ã‚ã‚Œã°ï¼Œä½•ã‚’ãƒ—ãƒ©ã‚¤ãƒãƒªã‚­ãƒ¼ã¨ã—ã¦ä½¿ç”¨ã—ã¦ã‚‚å•é¡Œãªãï¼ŒåŸºæœ¬çš„ã«ä»¥ä¸‹ãŒä½¿ç”¨ã•ã‚Œã‚‹ï¼ ç¨®é¡ èª¬æ˜ è£œè¶³ MySQLã®Auto Incrementæ©Ÿèƒ½ã«ã‚ˆã£ã¦å¢—åŠ ã™ã‚‹ç•ªå·ã‚«ãƒ©ãƒ  ãƒ—ãƒ©ã‚¤ãƒãƒªã‚­ãƒ¼åˆ¶ç´„ã‚’èª²ã—ãŸã‚«ãƒ©ãƒ ã®Auto Incrementæ©Ÿèƒ½ã‚’æœ‰åŠ¹åŒ–ã—ã¦ãŠãï¼CREATEå‡¦ç†ã§ãƒ‰ãƒ¡ã‚¤ãƒ³ãƒ¢ãƒ‡ãƒ«ã‚’ä½œæˆã™ã‚‹æ™‚ã«ï¼Œã€0ã€ã¾ãŸã¯ã€nullã€ã‚’ãƒ¢ãƒ‡ãƒ«ã®IDå€¤ã¨ã—ã¦å‰²ã‚Šå½“ã¦ã‚‹ï¼ã“ã‚Œã«ã‚ˆã‚Šï¼Œå‡¦ç†ã«ã‚ˆã£ã¦æ–°ã—ã„ãƒ¬ã‚³ãƒ¼ãƒ‰ãŒè¿½åŠ ã•ã‚Œã‚‹æ™‚ã«ï¼Œç¾åœ¨ã®æœ€æ–°ç•ªå·ã«ï¼‹ï¼‘ã—ãŸç•ªå·ãŒå‰²ã‚Šå½“ã¦ã‚‰ã‚Œã‚‹ã‚ˆã†ã«ãªã‚‹ï¼ã“ã‚Œã¯ãƒ—ãƒ©ã‚¤ãƒãƒªã‚­ãƒ¼åˆ¶ç´„ã‚’æº€ãŸã™ï¼å‚è€ƒï¼šhttps://dev.mysql.com/doc/refman/8.0/en/example-auto-increment.html ãƒ»ãƒ‰ãƒ¡ã‚¤ãƒ³ãƒ¢ãƒ‡ãƒ«ã¨DBãŒã‚ˆã‚Šå¯†çµåˆã«ãªã‚Šï¼ŒActive Recordãƒ‘ã‚¿ãƒ¼ãƒ³ã¨ç›¸æ€§ãŒã‚ˆã„ï¼MySQLã®ç’°å¢ƒå¤‰æ•°ã¨ã—ã¦ã€NO_AUTO_VALUE_ON_ZEROã€ã‚’è¨­å®šã™ã‚‹ã¨ï¼Œã€0ã€ã®å‰²ã‚Šå½“ã¦ã«ã‚ˆã‚‹è‡ªå‹•é€£ç•ªãŒæ‹’å¦ã•ã‚Œã‚‹ã‚ˆã†ã«ãªã‚‹ï¼ UUIDï¼ˆä¾‹ï¼š3cc807ab-8e31-3071-aee4-f8f03781cb91ï¼‰ CREATEå‡¦ç†ã§ãƒ¢ãƒ‡ãƒ«ã‚’ä½œæˆã™ã‚‹æ™‚ã«ï¼Œã‚¢ãƒ—ã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã§ç”Ÿæˆã—ãŸUUIDå€¤ã‚’ãƒ‰ãƒ¡ã‚¤ãƒ³ãƒ¢ãƒ‡ãƒ«ã®IDå€¤ã¨ã—ã¦å‰²ã‚Šå½“ã¦ã‚‹ï¼UUIDå€¤ãŒé‡è¤‡ã™ã‚‹ã“ã¨ã¯åŸºæœ¬çš„ã«èµ·ã“ã‚Šå¾—ãªã„ãŸã‚ï¼Œãƒ—ãƒ©ã‚¤ãƒãƒªã‚­ãƒ¼åˆ¶ç´„ã‚’æº€ãŸã™ï¼UUIDå€¤ã®ç”Ÿæˆé–¢æ•°ã¯è¨€èªã®æ¨™æº–ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã¨ã—ã¦ç”¨æ„ã•ã‚Œã¦ã„ã‚‹ï¼ ãƒ»ãƒ‰ãƒ¡ã‚¤ãƒ³ãƒ¢ãƒ‡ãƒ«ã¨DBãŒã‚ˆã‚Šç–çµåˆã«ã§ãï¼ŒRepositoryãƒ‘ã‚¿ãƒ¼ãƒ³ã¨ç›¸æ€§ãŒã‚ˆã„ï¼UUIDå€¤ã¯æ–‡å­—åˆ—ã¨ã—ã¦ç®¡ç†ã•ã‚Œã‚‹ãŸã‚ï¼ŒDBã‚¢ã‚¯ã‚»ã‚¹å‡¦ç†ã®è² è·ãŒé«˜ã¾ã£ã¦ã—ã¾ã†ï¼ãƒ—ãƒ©ã‚¤ãƒãƒªã‚­ãƒ¼ã‚’ä½¿ç”¨ã—ã¦ã‚½ãƒ¼ãƒˆã§ããªã„ï¼ ãƒ»è¤‡åˆãƒ—ãƒ©ã‚¤ãƒãƒªã‚­ãƒ¼ ãƒ—ãƒ©ã‚¤ãƒãƒªã‚­ãƒ¼ã¯è¤‡æ•°è¨­å®šã™ã‚‹ã“ã¨ãŒã§ãï¼Œè¤‡åˆãƒ—ãƒ©ã‚¤ãƒãƒªã‚­ãƒ¼ã®å ´åˆï¼Œç‰‡æ–¹ã®ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®å€¤ãŒç•°ãªã‚Œã°ï¼Œç•°ãªã‚‹ãƒ—ãƒ©ã‚¤ãƒãƒªã‚­ãƒ¼ã¨ã—ã¦è¦‹ãªã•ã‚Œã‚‹ï¼ ï¼Šä¾‹ï¼Š ãƒ¦ãƒ¼ã‚¶IDã¨æœŸé–“é–‹å§‹æ—¥ä»˜ã‚’è¤‡åˆãƒ—ãƒ©ã‚¤ãƒãƒªã‚­ãƒ¼ã¨ã™ã‚‹ã¨ï¼Œä¸€äººã®ãƒ¦ãƒ¼ã‚¶ãŒè¤‡æ•°ã®æœŸé–“ã‚’æŒã¤ã“ã¨ã‚’è¡¨ç¾ã§ãã‚‹ï¼ user_id period_start_date period_end_date fee_yen 1 2019-04-03 2019-05-03 200 1 2019-10-07 2019-11-07 400 2 2019-10-11 2019-11-11 200 ãƒ»æ¡ç•ªãƒ†ãƒ¼ãƒ–ãƒ« å„ãƒ†ãƒ¼ãƒ–ãƒ«ã®ãƒ—ãƒ©ã‚¤ãƒãƒªã‚­ãƒ¼ã‚’çµ±åˆçš„ã«ç®¡ç†ã™ã‚‹ãƒ†ãƒ¼ãƒ–ãƒ«ã‚’æ¡ç•ªãƒ†ãƒ¼ãƒ–ãƒ«ã¨ã„ã†ï¼å„ãƒ†ãƒ¼ãƒ–ãƒ«ã®ãƒ—ãƒ©ã‚¤ãƒãƒªã‚­ãƒ¼ã¯æ¡ç•ªãƒ†ãƒ¼ãƒ–ãƒ«ã‚’å…ƒã«å‰²ã‚Šå½“ã¦ã‚‰ã‚Œã‚‹ãŸã‚ï¼Œé€£ç•ªã§ã¯ãªãé£›ã³é£›ã³ã«ãªã‚‹ï¼ å‚è€ƒï¼šhttp://blog.livedoor.jp/sasata299/archives/51280681.html ã‚ã‚‰ã‹ã˜ã‚ï¼Œæœ€åˆã®ãƒ¬ã‚³ãƒ¼ãƒ‰ã®ã¿æ‰‹å‹•ã§æŒ¿å…¥ã—ã¦ãŠãï¼ # æ¡ç•ªãƒ†ãƒ¼ãƒ–ãƒ«ã®ä½œæˆã™ã‚‹ï¼ CREATE TABLE id_sequence (id BIGINT NOT NULL); # æœ€åˆã®ãƒ¬ã‚³ãƒ¼ãƒ‰ã‚’æ‰‹å‹•ã§æŒ¿å…¥ã™ã‚‹ï¼ INSERT INTO id_sequence VALUES (0); CREATEå‡¦ç†æ™‚ã«ã¯ï¼Œäº‹å‰ã«ï¼Œæ¡ç•ªãƒ†ãƒ¼ãƒ–ãƒ«ã«æ–°ã—ããƒ—ãƒ©ã‚¤ãƒãƒªã‚­ãƒ¼ã‚’ä½œæˆã™ã‚‹ï¼INSERTæ–‡ã®ãƒ—ãƒ©ã‚¤ãƒãƒªã‚­ãƒ¼ã«ã€0ã€ã‚„ã€nullã€ã‚’å‰²ã‚Šå½“ã¦ã‚‹ã®ã§ã¯ãªãï¼Œæ¡ç•ªãƒ†ãƒ¼ãƒ–ãƒ«ã‹ã‚‰å–å¾—ã—ãŸIDã‚’å‰²ã‚Šå½“ã¦ã‚‹ã‚ˆã†ã«ã™ã‚‹ï¼ # æ–°ã—ããƒ—ãƒ©ã‚¤ãƒãƒªã‚­ãƒ¼ã‚’ä½œæˆã™ã‚‹ï¼ UPDATE id_sequence SET id = LAST_INSERT_ID(id + 1); # ãƒ—ãƒ©ã‚¤ãƒãƒªã‚­ãƒ¼ã‚’å–å¾—ã™ã‚‹ï¼ SELECT LAST_INSERT_ID(); åˆ¶ç´„ ãƒ»åˆ¶ç´„ã¨ã¯ DBã«ãŠã„ã¦ï¼Œã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®CRUDå‡¦ç†ã«å¯¾ã™ã‚‹ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã®ãƒ«ãƒ¼ãƒ«ã‚’å®šç¾©ã™ã‚‹ï¼ã—ã‹ã—ï¼Œå¿…ãšã—ã‚‚åˆ¶ç´„ã‚’ä½¿ç”¨ã™ã‚‹å¿…è¦ã¯ãªãï¼Œä»£ã‚ã‚Šã®ãƒ­ã‚¸ãƒƒã‚¯ã‚’ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å´ã§å®Ÿè£…ã—ã¦ã‚‚ã‚ˆã„ï¼ãã®åˆ¶ç´„ã‚’ï¼ŒDBã¨ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ã„ãšã‚Œã®è²¬å‹™ã¨ã™ã‚‹ã‹ã‚’è€ƒãˆï¼Œä½¿ç”¨ã™ã‚‹ã‹å¦ã‹ã‚’åˆ¤æ–­ã™ã‚‹ï¼ ãƒ»ãƒ—ãƒ©ã‚¤ãƒãƒªã‚­ãƒ¼åˆ¶ç´„ ãƒ—ãƒ©ã‚¤ãƒãƒªã‚­ãƒ¼ã¨ã™ã‚‹ã‚«ãƒ©ãƒ ã«ã¯ãƒ—ãƒ©ã‚¤ãƒãƒªã‚­ãƒ¼åˆ¶ç´„ã‚’èª²ã™ã‚ˆã†ã«ã™ã‚‹ï¼ãƒ—ãƒ©ã‚¤ãƒãƒªã‚­ãƒ¼åˆ¶ç´„ã«ã‚ˆã£ã¦ï¼ŒUniqueåˆ¶ç´„ã¨Not Nullåˆ¶ç´„ã®ä¸¡æ–¹ãŒèª²ã•ã‚Œã‚‹ï¼ ãƒ»Not Nullåˆ¶ç´„ ãƒ¬ã‚³ãƒ¼ãƒ‰ã«æŒ¿å…¥ã•ã‚Œã‚‹å€¤ã®ãƒ‡ãƒ¼ã‚¿å‹ã‚’æŒ‡å®šã—ã¦ãŠãã“ã¨ã«ã‚ˆã£ã¦ï¼Œãƒ‡ãƒ¼ã‚¿å‹ä¸ä¸€è‡´ã‚„Nullã®ãŸã‚ã®ä¾‹å¤–å‡¦ç†ã‚’å®Ÿè£…ã—ãªãã¦ã‚‚ã‚ˆããªã‚‹ï¼ ãƒ»å¤–éƒ¨ã‚­ãƒ¼åˆ¶ç´„ è¦ªãƒ†ãƒ¼ãƒ–ãƒ«ã®ã‚«ãƒ©ãƒ ã‚’å‚ç…§ã™ã‚‹å­ãƒ†ãƒ¼ãƒ–ãƒ«ã®ã‚«ãƒ©ãƒ ã‚’ã€å¤–éƒ¨ã‚­ãƒ¼ã€ã¨ã„ã„ï¼Œã“ã®æ™‚ã«å­ãƒ†ãƒ¼ãƒ–ãƒ«ã«èª²ã™åˆ¶ç´„ã‚’ã€å¤–éƒ¨ã‚­ãƒ¼åˆ¶ç´„ã€ã¨ã„ã†ï¼å­ãƒ†ãƒ¼ãƒ–ãƒ«ã«ãŠã‘ã‚‹å¤–éƒ¨ã‚­ãƒ¼åˆ¶ç´„ã«ã‚ˆã£ã¦ï¼Œè¦ªå­ãƒ†ãƒ¼ãƒ–ãƒ«é–“ã«ä»¥ä¸‹ã®æ•´åˆæ€§ãƒ«ãƒ¼ãƒ«ãŒèª²ã•ã‚Œã‚‹ï¼ è¦ªãƒ†ãƒ¼ãƒ–ãƒ«ã®å‚ç…§å…ƒã‚«ãƒ©ãƒ ã«å­˜åœ¨ã—ãªã„å€¤ã¯ï¼Œå­ãƒ†ãƒ¼ãƒ–ãƒ«ã«ç™»éŒ²ã§ããªã„ï¼ å­ãƒ†ãƒ¼ãƒ–ãƒ«ã®å¤–éƒ¨ã‚­ãƒ¼ãŒå‚ç…§ã™ã‚‹å€¤ãŒï¼Œè¦ªãƒ†ãƒ¼ãƒ–ãƒ«ã®å‚ç…§å…ƒã‚«ãƒ©ãƒ ã«å­˜åœ¨ã™ã‚‹å ´åˆï¼Œå‚ç…§å…ƒã‚«ãƒ©ãƒ ã¯å‰Šé™¤ã§ããªã„ï¼ ï¼Šä¾‹ï¼Š ä¼šç¤¾æƒ…å ±ãƒ†ãƒ¼ãƒ–ãƒ«ï¼ˆè¦ªãƒ†ãƒ¼ãƒ–ãƒ«ï¼‰ã¨å€‹äººæƒ…å ±ãƒ†ãƒ¼ãƒ–ãƒ«ï¼ˆå­ãƒ†ãƒ¼ãƒ–ãƒ«ï¼‰ãŒã‚ã‚‹ã¨ã™ã‚‹ï¼å­ãƒ†ãƒ¼ãƒ–ãƒ«ã®ä¼šç¤¾IDã‚«ãƒ©ãƒ ã‚’å¤–éƒ¨ã‚­ãƒ¼ã¨ã—ã¦ï¼Œè¦ªãƒ†ãƒ¼ãƒ–ãƒ«ã®ä¼šç¤¾IDã‚«ãƒ©ãƒ ã‚’å‚ç…§ã™ã‚‹ï¼è¦ªãƒ†ãƒ¼ãƒ–ãƒ«ã®å‚ç…§å…ƒã‚«ãƒ©ãƒ ã«å­˜åœ¨ã—ãªã„IDã¯ï¼Œå­ãƒ†ãƒ¼ãƒ–ãƒ«ã®å¤–éƒ¨ã‚­ãƒ¼ã«ç™»éŒ²ã§ããªã„ï¼ã¾ãŸï¼Œè¦ªãƒ†ãƒ¼ãƒ–ãƒ«ã®å‚ç…§å…ƒã‚«ãƒ©ãƒ ã¯å¤–éƒ¨ã‚­ãƒ¼ã«å‚ç…§ã•ã‚Œã¦ã„ã‚‹ãŸã‚ï¼Œå‚ç…§å…ƒã‚«ãƒ©ãƒ ã¯å‰Šé™¤ã§ããªã„ï¼ stored procedure ãƒ»stored procedureã¨ã¯ ã‚ã‚‰ã‹ã˜ã‚ä¸€é€£ã®SQLæ–‡ã‚’ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã«æ ¼ç´ã—ã¦ãŠãï¼ŒCallæ–‡ã§å‘¼ã³å‡ºã™æ–¹å¼ï¼ ãƒ»ä½¿ã„æ–¹ ï¼Šå®Ÿè£…ä¾‹ï¼Š SELECTæ–‡ã®stored procedureã‚’ä½œæˆã™ã‚‹ã¨ã™ã‚‹ï¼ -- PROCEDUREã‚’ä½œæˆã—ï¼Œãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã¸æ ¼ç´ã—ã¦ãŠãï¼ CREATE PROCEDURE SelectContact AS SELECT { ã‚«ãƒ©ãƒ å } FROM { ãƒ†ãƒ¼ãƒ–ãƒ«å } -- PROCEDUREã‚’å®Ÿè¡Œ EXEC SelectContact ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆï¼Œã‚¤ãƒ³ãƒãƒ¼ãƒˆ ãƒ»ãƒ†ãƒ¼ãƒ–ãƒ«ã®ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ DBã‹ã‚‰ãƒ†ãƒ¼ãƒ–ãƒ«ã‚’ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã™ã‚‹ï¼ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã—ãŸã„ãƒ†ãƒ¼ãƒ–ãƒ«ã®æ•°ã ã‘ï¼Œãƒ†ãƒ¼ãƒ–ãƒ«åã‚’é€£ã­ã‚‹ $ mysqldump --force -u \"{ ã‚¢ã‚«ã‚¦ãƒ³ãƒˆ }\" -p -h \"{ DBã®ãƒ›ã‚¹ãƒˆ }\" \"{ DBå }\" \"{ ãƒ†ãƒ¼ãƒ–ãƒ«å1 }\" \"{ ãƒ†ãƒ¼ãƒ–ãƒ«å2 }\" > table.sql ãƒ»ãƒ†ãƒ¼ãƒ–ãƒ«ã®ã‚¤ãƒ³ãƒãƒ¼ãƒˆ DBã«ãƒ†ãƒ¼ãƒ–ãƒ«ã‚’ã‚¤ãƒ³ãƒãƒ¼ãƒˆã™ã‚‹ï¼forceã‚ªãƒ—ã‚·ãƒ§ãƒ³ã§ï¼Œã‚¨ãƒ©ãƒ¼ãŒå‡ºã¦ã‚‚å¼·åˆ¶çš„ã«ã‚¤ãƒ³ãƒãƒ¼ãƒˆï¼ $ mysql --force -u \"{ ã‚¢ã‚«ã‚¦ãƒ³ãƒˆ }\" -p -h \"{ DBã®ãƒ›ã‚¹ãƒˆ }\" \"{ DBå }\" ãƒ‡ãƒ¼ã‚¿å‹ ãƒ»æ•°å€¤å‹ æ•´æ•°å€¤ãŒã©ã®ãã‚‰ã„å¢—ãˆã‚‹ã‹ã«ã‚ˆã£ã¦ï¼Œ3ã¤ã‚’ä½¿ã„åˆ†ã‘ã‚‹ï¼ç¬¦å·ãªã—ï¼ˆUnsignedï¼‰ã‚’æœ‰åŠ¹åŒ–ã—ãŸå ´åˆï¼Œãƒã‚¤ãƒŠã‚¹å€¤ã‚’ä½¿ç”¨ã—ãªããªã£ãŸåˆ†ï¼Œä½¿ç”¨å¯èƒ½ãªãƒ—ãƒ©ã‚¹å€¤ãŒå¢—ãˆã‚‹ï¼ ãƒ‡ãƒ¼ã‚¿å‹ å€¤ ç¬¦å·ãªã—ï¼ˆUnsignedï¼‰ã‚’æœ‰åŠ¹åŒ–ã—ãŸå ´åˆ TINYINT -128~ +127 0~ +255 INT 2147483648~ +2147483647 0~ +4294967295 BIGINT -9223372036854775808~ +9223372036854775807 0~ +18446744073709551615 ãƒ»æ–‡å­—åˆ—å‹ æ–‡å­—æ•°ãŒã©ã®ãã‚‰ã„å¢—ãˆã‚‹ã‹ã«ã‚ˆã£ã¦ï¼Œ3ã¤ã‚’ä½¿ã„åˆ†ã‘ã‚Œã°è‰¯ã„ï¼ ãƒ‡ãƒ¼ã‚¿å‹ æœ€å¤§ãƒã‚¤ãƒˆæ•° VARCHAR(M) 255 TEXT 65535 MEDIUMTEXT 16777215 Collationï¼ˆç…§åˆé †åºï¼‰ ãƒ»æ–‡å­—åˆ—å‹ã®ç…§åˆé †åºã¨ã¯ æ–‡å­—åˆ—å‹ã®ã‚«ãƒ©ãƒ ã«é–¢ã—ã¦ï¼ŒWHEREå¥ã®æ¯”è¼ƒã«ãŠã‘ã‚‹å€¤ã®ç‰¹å®šï¼ŒORDER BYå¥ã«ãŠã‘ã‚‹ä¸¦ã³æ›¿ãˆã®æ˜‡é †é™é †ï¼ŒJOINå¥ã«ãŠã‘ã‚‹çµåˆï¼ŒGROUP BYã«ãŠã‘ã‚‹ã‚°ãƒ«ãƒ¼ãƒ—åŒ–ã®ãƒ«ãƒ¼ãƒ«ã‚’å®šç¾©ã™ã‚‹ï¼ã‚«ãƒ©ãƒ ï¼ãƒ†ãƒ¼ãƒ–ãƒ«ï¼DBå˜ä½ã§è¨­å®šã§ãï¼Œæ¯”è¼ƒã™ã‚‹ã‚«ãƒ©ãƒ åŒå£«ã§ã¯åŒã˜ç…§åˆé †åºãŒè¨­å®šã•ã‚Œã¦ã„ã‚‹å¿…è¦ãŒã‚ã‚‹ï¼ å‚è€ƒï¼šhttps://johobase.com/sqlserver-where-collate/ ãƒ»ç¨®é¡ å¯¿å¸ã¨ãƒ“ãƒ¼ãƒ«ã®çµµæ–‡å­—ãŒåŒºåˆ¥ã•ã‚Œãªã„ã“ã¨ã‚’ã€å¯¿å¸ãƒ“ãƒ¼ãƒ«å•é¡Œã€ã¨ã„ã†ï¼å¤§æ–‡å­—Aã¨å°æ–‡å­—aã‚’åŒºåˆ¥ã—ãªã„ã“ã¨ã¯ï¼ŒCIï¼šCase Insensitiveã¨è¡¨ç¾ã•ã‚Œï¼Œç…§åˆé †åºåã«ã‚‚ç‰¹å¾´ã¨ã—ã¦CIã®æ–‡å­—ãŒå«ã¾ã‚Œã¦ã„ã‚‹ï¼ ç…§åˆé †åºå Aï¼a ï¼:beer: ã¯ï¼ã±ï¼ã° ã‚„ï¼ã‚ƒ utf8mb4_unicode_ci = = = = utf8mb4_unicode_520_ci = â‰  = = utf8mb4_general_ci = = â‰  â‰  utf8mb4_bin â‰  â‰  â‰  â‰  04. ãƒ¦ãƒ¼ã‚¶ã®ç®¡ç† CREATE ãƒ»ãƒ¦ãƒ¼ã‚¶ä½œæˆ CREATE USER \"{ ãƒ¦ãƒ¼ã‚¶å }\" IDENTIFIED BY \"{ ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ }\"; ãƒ»ãƒ¦ãƒ¼ã‚¶ä¸€è¦§ ã“ã“ã§è¡¨ç¤ºã•ã‚Œã‚‹ç‰¹æ¨©ã¨ï¼ALLç‰¹æ¨©ã¯ç•°ãªã‚‹ï¼ SELECT * FROM mysql.user; DROP ãƒ»ãƒ¦ãƒ¼ã‚¶å‰Šé™¤ -- ãƒ¦ãƒ¼ã‚¶åˆ¥ã®ãƒ›ã‚¹ãƒˆåã®ç¢ºèª SELECT * FROM mysql.user; -- ãƒ›ã‚¹ãƒˆãŒã€Œ%ã€ã ã£ãŸå ´åˆ DROP USER { ãƒ¦ãƒ¼ã‚¶å }@`%`; GRANT ãƒ»å…¨ã¦ã®æ“ä½œæ¨©é™ã‚’ä»˜ä¸ ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹åã¯ï¼Œã‚·ãƒ³ã‚°ãƒ«ã‚¯ã‚ªãƒ¼ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ã§å›²ã†å¿…è¦ãŒç„¡ã„ï¼å…¨æ¨©é™ã‚’ä»˜ä¸ã™ã‚‹å ´åˆï¼ŒPRIVILEGESã¯çœç•¥ã§ãã‚‹ãŒï¼Œå³å¯†ã«ã¯çœç•¥ã—ãªã„ã‚ˆã†ã»ã†ãŒã‚ˆã„ï¼ -- å…¨ã¦ã®ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã«é–¢ã™ã‚‹æ¨©é™ã‚’ä»˜ä¸ GRANT ALL PRIVILEGES ON *.* TO \"{ ãƒ¦ãƒ¼ã‚¶å }\"; -- Amazon Auroraã¾ãŸã¯RDSã®å ´åˆã¯ã“ã¡ã‚‰ GRANT ALL PRIVILEGES ON `%`.* TO \"{ ãƒ¦ãƒ¼ã‚¶ãƒ¼å }\"; -- Amazon Auroraã‚‚åŒã˜ã -- ç‰¹å®šã®ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã«é–¢ã™ã‚‹å…¨æ¨©é™ã‚’ä»˜ä¸ GRANT ALL PRIVILEGES ON {DBå}.* TO \"{ ãƒ¦ãƒ¼ã‚¶å }\"; ãƒ»ä¸€éƒ¨ã®æ“ä½œæ¨©é™ã‚’ä»˜ä¸ ç‰¹å®šã®ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã«é–¢ã™ã‚‹èª­ã¿å‡ºã—æ¨©é™ã®ã¿ä»˜ä¸ã™ã‚‹ï¼ GRANT SELECT ON {DBå}.* TO \"{ ãƒ¦ãƒ¼ã‚¶å }\"; ãƒ»æ¨©é™ã®æŒ¯ã‚Šæ–¹ ãƒ¦ãƒ¼ã‚¶ã®ç¨®é¡ æ¨©é™ admin ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ GRANT ALL PRIVILEGES ON {DBå}.* TO '{ ãƒ¦ãƒ¼ã‚¶ãƒ¼å }' èª­ã¿å‡ºã—ï¼æ›¸ãè¾¼ã¿ãƒ¦ãƒ¼ã‚¶ GRANT ALL PRIVILEGES ON {DBå}.* TO '{ ãƒ¦ãƒ¼ã‚¶ãƒ¼å }' èª­ã¿å‡ºã—ãƒ¦ãƒ¼ã‚¶ GRANT SELECT ON {DBå}.* TO '{ ãƒ¦ãƒ¼ã‚¶å }'; ãƒ»ãƒ¦ãƒ¼ã‚¶æ¨©é™ä¸€è¦§ ãƒ¦ãƒ¼ã‚¶ã«ä»˜ä¸ã•ã‚Œã¦ã„ã‚‹æ¨©é™ã‚’è¡¨ç¤ºã™ã‚‹ï¼ SHOW GRANTS FOR \"{ ãƒ¦ãƒ¼ã‚¶å }\"; ä½œæˆã—ãŸã ã‘ã§æ¨©é™ã‚’ä½•ã‚‚ä»˜ä¸ã—ã¦ãªã„ãƒ¦ãƒ¼ã‚¶ã®å ´åˆï¼Œã€Œãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚µãƒ¼ãƒå†…ã®å…¨ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã«é–¢ã—ã¦ï¼Œå…¨æ¨©é™ãªã—ã€ã‚’è¡¨ã™USAGEã¨ã—ã¦è¡¨ç¤ºã•ã‚Œã‚‹ï¼ GRANT USAGE ON *.* TO \"{ ãƒ¦ãƒ¼ã‚¶ãƒ¼å }\"; ç‰¹å®šã®ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®æ“ä½œæ¨©é™ã‚’ä¸ãˆã‚‹ã¨ï¼Œä¸Šè¨˜ã«åŠ ãˆã¦ï¼Œä»˜ä¸ã—ãŸGRANTæ¨©é™ã‚‚è¡¨ç¤ºã•ã‚Œã‚‹ã‚ˆã†ã«ãªã‚‹ï¼ REVOKE ãƒ»å…¨æ¨©é™å‰Šé™¤ å…¨æ¨©é™ã‚’å‰Šé™¤ã—ï¼ŒGRANTæ¨©é™ã‚’USAGEã«æˆ»ã™ï¼ -- Amazon Auroraã¾ãŸã¯RDSã®å ´åˆ REVOKE ALL PRIVILEGES ON `%`.* FROM \"{ ãƒ¦ãƒ¼ã‚¶å }\"; REVOKE ALL PRIVILEGES ON { DBå }.* FROM \"{ ãƒ¦ãƒ¼ã‚¶å }\"; ãƒ»ãƒ¦ãƒ¼ã‚¶åå¤‰æ›´ RENAME USER \"{ å¤ã„ãƒ¦ãƒ¼ã‚¶å }\" TO \"{ æ–°ã—ã„ãƒ¦ãƒ¼ã‚¶å }\"; 05. ãƒ¬ã‚³ãƒ¼ãƒ‰ã®èª­ã¿å‡ºã—ï¼šREAD ã¯ã˜ã‚ã« ãƒ»å¥ã®å‡¦ç†ã®é †ç•ª FROM ---> JOIN ---> WHERE ---> GROUP BY ---> HAVING ---> SELECT ---> ORDER BY SELECTå¥ ãƒ»ãªã— æŒ‡å®šã—ãŸã‚«ãƒ©ãƒ ã‚’å–å¾—ã™ã‚‹ï¼MySQLã§ã¯ï¼Œå–å¾—çµæœã«æ¨™æº–ã®ä¸¦ã³é †ãŒå­˜åœ¨ã—ãªã„ãŸã‚ï¼Œãƒ—ãƒ©ã‚¤ãƒãƒªã‚­ãƒ¼ã®æ˜‡é †ã§å–å¾—ã—ãŸã„å ´åˆã¯ï¼ŒORDER BYå¥ã‚’ä½¿ç”¨ã—ã¦ï¼Œæ˜ç¤ºçš„ã«ä¸¦ã³æ›¿ãˆã‚‹ã‚ˆã†ã«ã™ã‚‹ï¼ å‚è€ƒï¼šhttps://www.quora.com/What-is-the-default-order-of-records-for-a-SELECT-statement-in-MySQL SELECT * FROM { ãƒ†ãƒ¼ãƒ–ãƒ«å }; ãƒ»SUMé–¢æ•° æŒ‡å®šã—ãŸã‚«ãƒ©ãƒ ã§ï¼Œã€ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã€ã®åˆè¨ˆã‚’å–å¾—ã™ã‚‹ï¼ SELECT SUM({ ã‚«ãƒ©ãƒ å }) FROM { ãƒ†ãƒ¼ãƒ–ãƒ«å }; ãƒ»AVGé–¢æ•° æŒ‡å®šã—ãŸã‚«ãƒ©ãƒ ã§ï¼Œã€ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã€ã®å¹³å‡å€¤ã‚’å–å¾—ã™ã‚‹ï¼ SELECT AVG({ ã‚«ãƒ©ãƒ å }) FROM { ãƒ†ãƒ¼ãƒ–ãƒ«å }; ãƒ»MINé–¢æ•° æŒ‡å®šã—ãŸã‚«ãƒ©ãƒ ã§ï¼Œã€ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã€ã®æœ€å°å€¤ã‚’å–å¾—ã™ã‚‹ï¼ SELECT MIN({ ã‚«ãƒ©ãƒ å }) FROM { ãƒ†ãƒ¼ãƒ–ãƒ«å }; ãƒ»MAXé–¢æ•° æŒ‡å®šã—ãŸã‚«ãƒ©ãƒ ã§ï¼Œã€ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã€ã®æœ€å¤§å€¤ã‚’å–å¾—ã™ã‚‹ï¼ SELECT MAX({ ã‚«ãƒ©ãƒ å }) FROM { ãƒ†ãƒ¼ãƒ–ãƒ«å }; ãƒ»COUNTé–¢æ•° æŒ‡å®šã—ãŸã‚«ãƒ©ãƒ ã§ï¼Œã€ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã€ã®å€‹æ•°ã‚’å–å¾—ã™ã‚‹ï¼ SELECT { ã‚«ãƒ©ãƒ å } COUNT(*) FROM { ãƒ†ãƒ¼ãƒ–ãƒ«å }; â€»æ¶ˆå»æ³•ã®å°æŠ€ï¼šé›†åˆé–¢æ•°ã‚’å…¥ã‚Œå­çŠ¶ã«ã¯ã§ããªã„ ï¼Šå®Ÿè£…ä¾‹ï¼Š é›†åˆé–¢æ•°ã‚’é›†åˆé–¢æ•°ã®ä¸­ã«å…¥ã‚Œå­çŠ¶ã«ã™ã‚‹ã“ã¨ã¯ã§ããªã„ï¼ -- SELECT AVG(SUM({ ã‚«ãƒ©ãƒ å })) FROM { ãƒ†ãƒ¼ãƒ–ãƒ«å }; æŒ‡å®šã—ãŸã‚«ãƒ©ãƒ ã§ï¼Œå€¤ç„¡ã—ã‚‚å«ã‚€ã€ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã€ã‚’å–å¾—ã™ã‚‹ï¼ SELECT { ã‚«ãƒ©ãƒ å } COUNT(*) FROM { ãƒ†ãƒ¼ãƒ–ãƒ«å }; æŒ‡å®šã—ãŸã‚«ãƒ©ãƒ ã§ï¼Œå€¤ç„¡ã—ã‚’é™¤ã„ãŸã€ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã€ã‚’å–å¾—ã™ã‚‹ï¼ SELECT { ã‚«ãƒ©ãƒ å } COUNT(*); ãƒ»LAST_INSERT_IDé–¢æ•° ä»»æ„ã®ãƒ†ãƒ¼ãƒ–ãƒ«ã«æœ€å¾Œã«æŒ¿å…¥ã•ã‚ŒãŸIDã‚’èª­ã¿å‡ºã™ï¼ãƒ†ãƒ¼ãƒ–ãƒ«åã‚’æŒ‡å®šã™ã‚‹å¿…è¦ã¯ãªã„ï¼ SELECT LAST_INSERT_ID(); ãƒ»MD5é–¢æ•° æ–‡å­—åˆ—ã‚’ãƒãƒƒã‚·ãƒ¥åŒ– SELECT MD5(\"xxxxx\"); CASEå¥ ã‚«ãƒ©ãƒ 1ãŒtrueã ã£ãŸã‚‰ï¼Œã‚«ãƒ©ãƒ 2ã‚’å–å¾—ã™ã‚‹ï¼falseã§ã‚ã£ãŸã‚‰ï¼Œã‚«ãƒ©ãƒ 3ã‚’å–å¾—ã™ã‚‹ï¼ SELECT CASE WHEN { ã‚¨ã‚¤ãƒªã‚¢ã‚¹ }.{ ã‚«ãƒ©ãƒ å1 } = 1 THEN { ã‚¨ã‚¤ãƒªã‚¢ã‚¹ }.{ ã‚«ãƒ©ãƒ å2 } ELSE { ã‚¨ã‚¤ãƒªã‚¢ã‚¹ }.{ ã‚«ãƒ©ãƒ å3 } END AS name FROM { ãƒ†ãƒ¼ãƒ–ãƒ«å } AS { ã‚¨ã‚¤ãƒªã‚¢ã‚¹ }; FROMå¥ ãƒ»JOINå¥ã®ç¨®é¡ ãƒ»LEFT JOINï¼ˆå·¦å¤–éƒ¨çµåˆï¼‰ ã€usersã€ãƒ†ãƒ¼ãƒ–ãƒ«ã¨ã€itemsã€ãƒ†ãƒ¼ãƒ–ãƒ«ã®å•†å“IDãŒä¸€è‡´ã—ã¦ã„ã‚‹ãƒ‡ãƒ¼ã‚¿ã¨ï¼Œå…ƒã¨ãªã‚‹ã€usersã€ãƒ†ãƒ¼ãƒ–ãƒ«ã«ã—ã‹å­˜åœ¨ã—ãªã„ãƒ‡ãƒ¼ã‚¿ãŒï¼Œã‚»ãƒƒãƒˆã§å–å¾—ã•ã‚Œã‚‹ï¼ ãƒ»INNER JOINï¼ˆå†…éƒ¨çµåˆï¼‰ åŸºæœ¬æƒ…å ±æŠ€è¡“è€…è©¦é¨“ã§ã¯ï¼Œå†…éƒ¨çµåˆï¼ˆAâˆ©Bï¼‰ã—ã‹å‡ºé¡Œã•ã‚Œãªã„ï¼ ãƒ»å†…éƒ¨çµåˆã«WHEREã‚’ç”¨ã„ã‚‹å ´åˆ 2ã¤ã®WHEREæ–‡ãŒï¼ŒANDã§çµã³ã¤ã‘ã‚‰ã‚Œã¦ã„ã‚‹æ™‚ï¼Œã¾ãšä¸€ã¤ç›®ã®WHEREã‚’æº€ãŸã™ãƒ¬ã‚³ãƒ¼ãƒ‰ã‚’å–å¾—ã—ãŸå¾Œï¼Œå–å¾—ã—ãŸãƒ¬ã‚³ãƒ¼ãƒ‰ã®ä¸­ã‹ã‚‰ï¼ŒäºŒã¤ç›®ã®WHEREã‚’æº€ãŸã™ãƒ¬ã‚³ãƒ¼ãƒ‰ã‚’å–å¾—ã™ã‚‹ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š -- ã€ã‚«ãƒ©ãƒ ã€ã ã‘ã§ãªãï¼Œã©ã®ã€è¡¨ã€ãªã®ç‰©ãªã®ã‹ã‚‚æŒ‡å®š SELECT { ãƒ†ãƒ¼ãƒ–ãƒ«å1 }.{ ã‚«ãƒ©ãƒ å1 }, -- è¤‡æ•°ã®è¡¨ã‚’æŒ‡å®š FROM { ãƒ†ãƒ¼ãƒ–ãƒ«å1 }, { ãƒ†ãƒ¼ãƒ–ãƒ«å2 }, -- ã¾ãšï¼Œ1ã¤ç›®ã®ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã¨2ã¤ç›®ã®ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ãŒåŒã˜ãƒ¬ã‚³ãƒ¼ãƒ‰ã‚’å–å¾—ã™ã‚‹ï¼ WHERE -- æ¬¡ã«ï¼Œä¸Šè¨˜ã§å–å¾—ã—ãŸãƒ¬ã‚³ãƒ¼ãƒ‰ã®ã†ã¡ï¼Œæ¬¡ã®æ¡ä»¶ã‚‚æº€ãŸã™ãƒ¬ã‚³ãƒ¼ãƒ‰ã®ã¿ã‚’å–å¾—ã™ã‚‹ï¼ { ãƒ¬ã‚³ãƒ¼ãƒ‰å1 } = { ãƒ¬ã‚³ãƒ¼ãƒ‰å2 } AND { ãƒ¬ã‚³ãƒ¼ãƒ‰å2 } = { ãƒ¬ã‚³ãƒ¼ãƒ‰å3 } ãƒ»å†…éƒ¨çµåˆã«INNER JOIN ONã‚’ç”¨ã„ã‚‹å ´åˆ ï¼Šå®Ÿè£…ä¾‹ï¼Š -- ã€ã‚«ãƒ©ãƒ ã€ã ã‘ã§ãªãï¼Œã©ã®ã€è¡¨ã€ãªã®ç‰©ãªã®ã‹ã‚‚æŒ‡å®š SELECT { ãƒ†ãƒ¼ãƒ–ãƒ«å1 }.{ ã‚«ãƒ©ãƒ å1 }, -- è¤‡æ•°ã®è¡¨ã‚’æŒ‡å®š FROM { ãƒ†ãƒ¼ãƒ–ãƒ«å1 } -- 2ã¤ç›®ã®è¡¨ã®ã€ãƒ¬ã‚³ãƒ¼ãƒ‰ã€ã¨ç…§åˆ INNER JOIN { ãƒ†ãƒ¼ãƒ–ãƒ«å2 } ON { ãƒ†ãƒ¼ãƒ–ãƒ«å1 }.{ ã‚«ãƒ©ãƒ å1 } = { ãƒ†ãƒ¼ãƒ–ãƒ«å2 }.{ ã‚«ãƒ©ãƒ å2 } -- 3ã¤ç›®ã®è¡¨ã®ã€ãƒ¬ã‚³ãƒ¼ãƒ‰ã€ã¨ç…§åˆ INNER JOIN { ãƒ†ãƒ¼ãƒ–ãƒ«å3 } ON { ãƒ†ãƒ¼ãƒ–ãƒ«å1 }.{ ã‚«ãƒ©ãƒ å1 } = { ãƒ†ãƒ¼ãƒ–ãƒ«å3 }.{ ã‚«ãƒ©ãƒ å3 } ORDER BYå¥ ãƒ»ä½¿ã„æ–¹ ï¼Šå®Ÿè£…ä¾‹ï¼Š $order) { switch ($key) { case \"id\": return sprintf(\"ss.id %s\", $order); } } } // INå¥é †ã®å ´åˆ return sprintf(\"FIELD(ss.id, %s)\", $idList); }); $sql = INå¥ï¼ŒANYå¥ã®é•ã„ ãƒ»INå¥ã®ä½¿ã„æ–¹ æŒ‡å®šã—ãŸå€¤ã¨åŒã˜ã€ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã€ã‚’å–å¾—ã™ã‚‹ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š æŒ‡å®šã—ãŸã‚«ãƒ©ãƒ ã§ï¼ŒæŒ‡å®šã—ãŸå€¤ã®ã€ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã€ã‚’å–å¾—ã™ã‚‹ï¼ SELECT * FROM { ãƒ†ãƒ¼ãƒ–ãƒ«å } WHERE { ã‚«ãƒ©ãƒ å } in (xxx, xxx,...); æŒ‡å®šã—ãŸã‚«ãƒ©ãƒ ã§ï¼ŒæŒ‡å®šã—ãŸå€¤ä»¥å¤–ã®ã€ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã€ã‚’å–å¾—ã™ã‚‹ï¼ SELECT * FROM { ãƒ†ãƒ¼ãƒ–ãƒ«å } WHERE { ã‚«ãƒ©ãƒ å } not in ({ ãƒ¬ã‚³ãƒ¼ãƒ‰å1 }, { ãƒ¬ã‚³ãƒ¼ãƒ‰å2 },...); æŒ‡å®šã—ãŸã‚«ãƒ©ãƒ ã§ï¼ŒSELECTã§èª­ã¿å‡ºã—ãŸå€¤ä»¥å¤–ã®ã€ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã€ã‚’å–å¾—ã™ã‚‹ï¼ SELECT * FROM { ãƒ†ãƒ¼ãƒ–ãƒ«å } WHERE { ã‚«ãƒ©ãƒ å } not in ( -- SELECT { ã‚«ãƒ©ãƒ å } FROM { ãƒ†ãƒ¼ãƒ–ãƒ«å } WHERE { ãƒ¬ã‚³ãƒ¼ãƒ‰å } >= 160 ); ã€INå¥ã‚’ä½¿ç”¨ã—ãªã‹ã£ãŸå ´åˆã€‘ SELECT * FROM fruit WHERE name = \"ã¿ã‹ã‚“\" OR name = \"ã‚Šã‚“ã”\"; ã€INå¥ã‚’ä½¿ç”¨ã—ãŸå ´åˆã€‘ SELECT * FROM fruit WHERE name IN(\"ã¿ã‹ã‚“\", \"ã‚Šã‚“ã”\"); ãƒ»ANYå¥ã®ä½¿ã„æ–¹ æ›¸ãæ–¹ãŒç•°ãªã‚‹ã ã‘ã§ï¼Œinã¨åŒã˜å‡ºåŠ› SELECT * FROM { ãƒ†ãƒ¼ãƒ–ãƒ«å } WHERE { ã‚«ãƒ©ãƒ å } = ANY(xxx, xxx, xxx); GROUP BYå¥ ãƒ»ä½¿ã„æ–¹ ã‚«ãƒ©ãƒ ã‚’ã‚°ãƒ«ãƒ¼ãƒ—åŒ–ã—ï¼Œé›†åˆé–¢æ•°ã‚’ä½¿ç”¨ã—ã¦ï¼Œãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®å€¤ã‚’è¨ˆç®—ã™ã‚‹ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š æŒ‡å®šã—ãŸã‚«ãƒ©ãƒ ã‚’ã‚°ãƒ«ãƒ¼ãƒ—åŒ–ã—ï¼Œãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®å€¤ã®å¹³å‡å€¤ã‚’ç®—å‡ºã™ã‚‹ï¼ SELECT { ã‚«ãƒ©ãƒ å1 }, AVG({ ã‚«ãƒ©ãƒ å2 }) FROM { ãƒ†ãƒ¼ãƒ–ãƒ«å } GROUP BY { ã‚«ãƒ©ãƒ å1 }; HAVINGå¥ ãƒ»ä½¿ã„æ–¹ å„å¥ã®å‡¦ç†ã®é †ç•ªã‹ã‚‰è€ƒæ…®ã—ã¦ï¼ŒGROUP BYã§ã‚°ãƒ«ãƒ¼ãƒ—åŒ–ã—ãŸçµæœã‹ã‚‰ï¼ŒHAVINGã§ã€ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã€ã‚’å–å¾—ã™ã‚‹ï¼SELECTã«ãŠã‘ã‚‹é›†è¨ˆé–¢æ•°ãŒï¼ŒHAVINGã«ãŠã‘ã‚‹é›†è¨ˆé–¢æ•°ã®çµæœã‚’æŒ‡å®šã—ã¦ã„ã‚‹ã“ã¨ã«æ³¨æ„ã›ã‚ˆï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š -- HAVINGã«ã‚ˆã‚‹é›†è¨ˆçµæœã‚’æŒ‡å®šã—ã¦å‡ºåŠ›ï¼ SELECT { ã‚«ãƒ©ãƒ å1 }, COUNT({ ã‚«ãƒ©ãƒ å2 }) FROM { ãƒ†ãƒ¼ãƒ–ãƒ«å } GROUP BY -- ã‚°ãƒ«ãƒ¼ãƒ—åŒ–ã—ãŸçµæœã‚’é›†è¨ˆã—ï¼Œï¼’å€‹ä»¥ä¸Šã®ã€ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã€ã‚’å–å¾—ã™ã‚‹ï¼ { ã‚«ãƒ©ãƒ å1 } HAVING COUNT(*) >= 2; â€»ä»¥ä¸‹ã®å ´åˆï¼ŒGROUP BY + HAVINGã‚’ä½¿ã£ã¦ã‚‚ï¼ŒWHEREã‚’ä½¿ã£ã¦ã‚‚ï¼ŒåŒã˜å‡ºåŠ›çµæœã«ãªã‚‹ï¼ SELECT { ã‚«ãƒ©ãƒ å } FROM { ãƒ†ãƒ¼ãƒ–ãƒ«å } GROUP BY { ã‚«ãƒ©ãƒ å } HAVING { ãƒ¬ã‚³ãƒ¼ãƒ‰å }; SELECT { ã‚«ãƒ©ãƒ å } FROM { ãƒ†ãƒ¼ãƒ–ãƒ«å } WHERE { ãƒ¬ã‚³ãƒ¼ãƒ‰å } GROUP BY { ã‚«ãƒ©ãƒ å }; WILDCARDå¥ ãƒ»ä½¿ã„æ–¹ ï¼Šå®Ÿè£…ä¾‹ï¼Š SELECT * FROM { ãƒ†ãƒ¼ãƒ–ãƒ«å } WHERE { ã‚«ãƒ©ãƒ å } LIKE \"%å–¶æ¥­\"; SELECT * FROM { ãƒ†ãƒ¼ãƒ–ãƒ«å } WHERE { ã‚«ãƒ©ãƒ å } LIKE \"_å–¶æ¥­\"; BETWEENå¥ ãƒ»ä½¿ã„æ–¹ ï¼Šå®Ÿè£…ä¾‹ï¼Š æŒ‡å®šã—ãŸã‚«ãƒ©ãƒ ã§ï¼Œ1ä»¥ä¸Š10ä»¥ä¸‹ã®ã€ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã€ã‚’å–å¾—ã™ã‚‹ï¼ SELECT * FROM { ãƒ†ãƒ¼ãƒ–ãƒ«å } BETWEEN 1 AND 10; SETå¥ ãƒ»ä½¿ã„æ–¹ ï¼Šå®Ÿè£…ä¾‹ï¼Š SET @A = { ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿å€¤ }; SET @B = { ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿å€¤ }; UPDATE { ãƒ†ãƒ¼ãƒ–ãƒ«å } SET { ã‚«ãƒ©ãƒ å } = @A, WHERE { ã‚«ãƒ©ãƒ å } = @B; ã‚µãƒ–ã‚¯ã‚¨ãƒª ãƒ»ä½¿ã„æ–¹ æ›ã‘ç®—ã¨åŒæ§˜ã«ï¼Œæ‹¬å¼§å†…ã‹ã‚‰å…ˆã«å‡¦ç†ã‚’è¡Œã†ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š -- Main-query SELECT * FROM { ãƒ†ãƒ¼ãƒ–ãƒ«å } WHERE { ã‚«ãƒ©ãƒ å } != ( -- Sub-query SELECT max({ ã‚«ãƒ©ãƒ å }) FROM { ãƒ†ãƒ¼ãƒ–ãƒ«å } ); ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ ãƒ»ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã¨ã¯ ãƒ†ãƒ¼ãƒ–ãƒ«ã‹ã‚‰ç‰¹å®šã®ã‚«ãƒ©ãƒ ã ã‘ã‚’æŠœãå‡ºã—ï¼Œæ¤œç´¢ã—ã‚„ã™ã„ã‚ˆã†ã«ä¸¦ã³æ›¿ãˆï¼Œåå‰ã‚’ä»˜ã‘ã¦ä¿å­˜ã—ã¦ãŠã„ãŸã‚‚ã®ï¼ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã¨ã—ã¦ä¿å­˜ã•ã‚ŒãŸã‚«ãƒ©ãƒ ã‹ã‚‰ç‰¹å®šã®ãƒ¬ã‚³ãƒ¼ãƒ‰ã‚’ç›´æ¥å–å¾—ã§ãã‚‹ãŸã‚ï¼ŒSQLã®å®Ÿè¡Œæ™‚é–“ãŒã‚«ãƒ©ãƒ æ•°ã«ä¾å­˜ã—ãªããªã‚‹ï¼ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã‚’ä½¿ç”¨ã—ãªã„å ´åˆï¼ŒSQLã®å®Ÿè¡Œæ™‚ã«å…¨ã¦ã‚«ãƒ©ãƒ ã‚’å–å¾—ã™ã‚‹ãŸã‚ï¼Œå®Ÿè¡Œæ™‚é–“ãŒãƒ†ãƒ¼ãƒ–ãƒ«ã®ã‚«ãƒ©ãƒ æ•°ã«ä¾å­˜ã—ã¦ã—ã¾ã†ï¼ ãƒ»ã‚¯ãƒ©ã‚¹ã‚¿ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ ãƒ—ãƒ©ã‚¤ãƒãƒªã‚­ãƒ¼ã‚ã‚‹ã„ã¯ãƒ¦ãƒ‹ãƒ¼ã‚¯ã‚­ãƒ¼ã®ã‚«ãƒ©ãƒ ã‚’æŠœãå‡ºã—ã¦ä¸¦ã³æ›¿ãˆãŸã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã®ã“ã¨ï¼ ãƒ»ã‚»ã‚«ãƒ³ãƒ€ãƒªã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ ãƒ—ãƒ©ã‚¤ãƒãƒªã‚­ãƒ¼ã‚ã‚‹ã„ã¯ãƒ¦ãƒ‹ãƒ¼ã‚¯ã‚­ãƒ¼ã§ã¯ãªã„ã‚«ãƒ©ãƒ ã‚’æŠœãå‡ºã—ã¦ä¸¦ã³æ›¿ãˆãŸã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã®ã“ã¨ï¼ ãƒ»è¤‡åˆã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ è¤‡æ•°ã®ã‚«ãƒ©ãƒ ã‚’ã²ã¨ã¾ã¨ã‚ã«æŠœãå‡ºã—ã¦ä¸¦ã³æ›¿ãˆãŸã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã®ã“ã¨ï¼å¯¾è±¡ã¨ã—ãŸã‚«ãƒ©ãƒ ã”ã¨ã«ç•°ãªã‚‹å€¤ã®ãƒ¬ã‚³ãƒ¼ãƒ‰æ•°ãŒè¨ˆæ¸¬ã•ã‚Œï¼Œã“ã®æ•°ãŒå°‘ãªã„ï¼ˆä¸€æ„ã®å€¤ã®å¤šã„ï¼‰ã‚«ãƒ©ãƒ ãŒæ¤œå‡ºã•ã‚Œã‚‹ï¼ãã—ã¦ï¼Œã‚«ãƒ©ãƒ ã®ãƒ¬ã‚³ãƒ¼ãƒ‰ã®æ˜‡é †ã§ä¸¦ã³æ›¿ãˆã‚‰ã‚Œï¼Œã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã¨ã—ã¦ä¿å­˜ã•ã‚Œã‚‹ï¼ ï¼Šä¾‹ï¼Š ä»¥ä¸‹ã®ã‚ˆã†ãªãƒ†ãƒ¼ãƒ–ãƒ«ãŒã‚ã‚Šï¼Œnameã‚«ãƒ©ãƒ ã¨addressã‚«ãƒ©ãƒ ã‚’ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã¨ã—ã¦æŠœãå‡ºã™ã¨ã™ã‚‹ï¼ id name address old 1 Suzuki Tokyo 24 2 Yamada Osaka 18 3 Takahashi Nagoya 18 4 Honda Tokyo 16 5 Endou Tokyo 24 æŠœãå‡ºã•ã‚ŒãŸã‚«ãƒ©ãƒ ã”ã¨ã«ç•°ãªã‚‹å€¤ã®ãƒ¬ã‚³ãƒ¼ãƒ‰æ•°ãŒè¨ˆæ¸¬ã•ã‚Œï¼Œnameã‚«ãƒ©ãƒ ã¯addressã‚«ãƒ©ãƒ ã‚ˆã‚Šã‚‚ä¸€æ„ã®ãƒ¬ã‚³ãƒ¼ãƒ‰ãŒå¤šã„ãŸã‚ï¼Œnameã‚«ãƒ©ãƒ ã®æ˜‡é †ï¼ˆã‚¢ãƒ«ãƒ•ã‚¡ãƒ™ãƒƒãƒˆé †ï¼‰ã«ä¸¦ã³æ›¿ãˆã‚‰ã‚Œï¼Œã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã¨ã—ã¦ä¿å­˜ã•ã‚Œã‚‹ï¼ name address Endou Tokyo Honda Tokyo Suzuki Tokyo Takahashi Nagoya Yamada Osaka EXPLAINå¥ ãƒ»ä½¿ã„æ–¹ è¨­å®šã—ãŸSELECTå¥ãŒä»®ã«å®Ÿè¡Œã•ã‚ŒãŸå ´åˆã«ï¼Œã„ãšã‚Œã®ãƒ†ãƒ¼ãƒ–ãƒ«ã®ã„ãšã‚Œã®ã‚«ãƒ©ãƒ ã‚’å–å¾—ã™ã‚‹ã“ã¨ã«ãªã‚‹ã‹ï¼ˆå®Ÿè¡Œè¨ˆç”»ï¼‰ã‚’è¡¨ç¤ºã™ã‚‹ï¼ã¾ãŸï¼Œæƒ³å®šå®Ÿè¡Œæ™‚é–“ã‚‚æ¤œå‡ºã§ãã‚‹ãŸã‚ï¼Œã‚¹ãƒ­ãƒ¼ã‚¯ã‚¨ãƒªã®æ¤œå‡ºã«å½¹ç«‹ã¤ï¼ å‚è€ƒï¼šhttps://dev.mysql.com/doc/refman/5.7/en/explain-output.html EXPLAIN SELECT * FROM t1, t2 WHERE t1.c1 = 1 AND t1.c2 = t2.c3 *************************** 1. row *************************** id: 1 select_type: SIMPLE table: t1 type: ref possible_keys: index_t1_on_c1_and_c2 key: index_t1_on_c1_and_c2 key_len: 5 ref: const rows: 10 Extra: Using where; Using index *************************** 2. row *************************** id: 1 select_type: SIMPLE table: t2 type: ref possible_keys: index_t2_on_c3 key: index_t2_on_c3 key_len: 5 ref: sample.t1.c2 rows: 1 Extra: Using index ãƒ»select_type SQLã®ç¨®é¡ãŒè¡¨ç¤ºã•ã‚Œã‚‹ï¼ã‚µãƒ–ã‚¯ã‚¨ãƒªã‚’å«ã¾ãªã„SQLã¯SIMPLEã¨ãªã‚Šï¼Œã‚µãƒ–ã‚¯ã‚¨ãƒªã‚’å«ã‚€ã¨ï¼Œã‚µãƒ–ã‚¯ã‚¨ãƒªã®ç¨®é¡ã«å¿œã˜ã¦ï¼ŒPRIMARYï¼ŒSUBQUERYï¼ŒDEPENDENT SUBQUERYï¼ŒUNCACHEABLE SUBQUERYï¼ŒDERIVEDï¼Œã®ã„ãšã‚Œã‹ãŒè¡¨ç¤ºã•ã‚Œã‚‹ï¼ ãƒ»table è¨­å®šã—ãŸSELECTå¥ãŒã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ãƒ†ãƒ¼ãƒ–ãƒ«åãŒè¡¨ç¤ºã•ã‚Œã‚‹ï¼ ãƒ»type è¨­å®šã—ãŸSELECTå¥ãŒãƒ†ãƒ¼ãƒ–ãƒ«ã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹æ™‚ã«ï¼Œã©ã®ç¨‹åº¦ã®æ•°ã®ã‚«ãƒ©ãƒ ã‚’æ¤œç´¢ã™ã‚‹ã®ã‹ãŒè¡¨ç¤ºã•ã‚Œã‚‹ï¼æ¤œç´¢ã™ã‚‹ã‚«ãƒ©ãƒ ãŒå¤šã„SQLã»ã©ï¼Œæƒ³å®šå®Ÿè¡Œæ™‚é–“ãŒé•·ããªã‚‹ï¼ ç¨®é¡ æ¡ä»¶ æ¤œç´¢ã™ã‚‹ã‚«ãƒ©ãƒ æ•° è£œè¶³ ALL ãƒ»ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã‚’ä½¿ç”¨ã—ã¦ã„ãªã„ï¼ å…¨ã¦ã®ã‚«ãƒ©ãƒ  å…¨ã¦ã®ã‚«ãƒ©ãƒ ã‚’æ¤œç´¢ã™ã‚‹ãŸã‚ï¼Œå®Ÿè¡Œæ™‚é–“ãŒæœ€ã‚‚é•·ãï¼Œæ”¹å–„ã™ã‚‹å¿…è¦ãŒã‚ã‚‹ï¼ index ãƒ»ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã‚’ä½¿ç”¨ã—ã¦ã„ãªã„ï¼ å…¨ã¦ã®ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã®ã‚«ãƒ©ãƒ  range ãƒ»ã‚»ã‚«ãƒ³ãƒ€ãƒªã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã‚’ä½¿ç”¨ã—ã¦ã„ã‚‹ï¼ãƒ»WHEREå¥ã«é‡è¤‡ã—ãŸãƒ¬ã‚³ãƒ¼ãƒ‰å€¤ï¼ŒINå¥ï¼ŒBETWEENå¥ã‚’ä½¿ç”¨ã—ã¦ã„ã‚‹ï¼ ç‰¹å®šã®è¤‡æ•°ã‚«ãƒ©ãƒ  ref ãƒ»ã‚»ã‚«ãƒ³ãƒ€ãƒªã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã‚’ä½¿ç”¨ã—ã¦ã„ã‚‹ï¼ãƒ»WHEREå¥ã«é‡è¤‡ã—ãªã„ãƒ¬ã‚³ãƒ¼ãƒ‰å€¤ ç‰¹å®šã®è¤‡æ•°ã‚«ãƒ©ãƒ  eq_ref ãƒ»ã‚¯ãƒ©ã‚¹ã‚¿ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã‚’ä½¿ç”¨ã—ã¦ã„ã‚‹ï¼ ä¸€ã¤ã®ã‚«ãƒ©ãƒ  ä¸€ã¤ã®ã‚«ãƒ©ãƒ ã—ã‹fetchã—ãªã„ãŸã‚ï¼ŒJOINå¥ã‚’ä½¿ç”¨ã—ãŸã‚¢ã‚¯ã‚»ã‚¹ã®ä¸­ã§ï¼Œå®Ÿè¡Œæ™‚é–“ãŒæœ€ã‚‚çŸ­ã„ï¼ const ãƒ»ã‚¯ãƒ©ã‚¹ã‚¿ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã‚’ä½¿ç”¨ã—ã¦ã„ã‚‹ï¼ãƒ»JOINå¥ã‚’ä½¿ç”¨ã—ã¦ã„ãªã„ï¼ ä¸€ã¤ã®ã‚«ãƒ©ãƒ  ä¸€ã¤ã®ã‚«ãƒ©ãƒ ã—ã‹fetchã—ãªã„ãŸã‚ï¼Œå®Ÿè¡Œæ™‚é–“ãŒæœ€ã‚‚çŸ­ã„ï¼ ãƒ»possible_keys ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã¨ã—ã¦è¨­å®šã•ã‚ŒãŸã‚«ãƒ©ãƒ ã®ã†ã¡ã§ï¼Œå®Ÿéš›ã«åˆ©ç”¨å¯èƒ½ãªã‚‚ã®ã®ä¸€è¦§ãŒè¡¨ç¤ºã•ã‚Œã‚‹ï¼ Tips ãƒ»å„ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹å®¹é‡ã®ç¢ºèª SELECT table_schema, sum(data_length) / 1024 / 1024 AS mb FROM information_schema.tables GROUP BY table_schema ORDER BY sum(data_length + index_length) DESC; ãƒ»ã‚«ãƒ©ãƒ ã®æ¤œç´¢ SELECT table_name, column_name FROM information_schema.columns WHERE column_name = { æ¤œç´¢ã—ãŸã„ã‚«ãƒ©ãƒ å } AND table_schema = { æ¤œç´¢å¯¾è±¡ã®ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹å } ãƒ»æœ€é©ãªã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã®æ¤œå‡º ãƒ¬ã‚³ãƒ¼ãƒ‰ã®çªãåˆã‚ã›å‡¦ç†ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ  ãƒ»çªãåˆã‚ã›å‡¦ç†ã¨ã¯ ãƒ“ã‚¸ãƒã‚¹ã®åŸºç›¤ã¨ãªã‚‹ãƒã‚¹ã‚¿ãƒ‡ãƒ¼ã‚¿ï¼ˆå•†å“ãƒ‡ãƒ¼ã‚¿ï¼Œå–å¼•å…ˆãƒ‡ãƒ¼ã‚¿ãªã©ï¼‰ã¨ï¼Œæ—¥ã€…æ›´æ–°ã•ã‚Œã‚‹ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³ãƒ‡ãƒ¼ã‚¿ï¼ˆè²©å£²å±¥æ­´ï¼Œå…¥é‡‘å±¥æ­´ãªã©ï¼‰ã‚’çªãåˆã‚ã›ï¼Œæ–°ã—ã„ãƒ‡ãƒ¼ã‚¿ã‚’ä½œæˆã™ã‚‹å‡¦ç†ã®ã“ã¨ï¼ ãƒ»ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ  ãƒ»å…·ä½“ä¾‹ ã¨ã‚ã‚‹ç”Ÿå‘½ä¿é™ºä¼šç¤¾ã§ã¯ï¼Œé¡§å®¢ã®ä¿é™ºå¥‘ç´„ãƒ‡ãƒ¼ã‚¿ã‚’å¥‘ç´„ãƒã‚¹ã‚¿ãƒ†ãƒ¼ãƒ–ãƒ«ã§ï¼Œã¾ãŸãã‚Œã¨ã¯åˆ¥ã«ï¼Œä¿é™ºå¥‘ç´„ãƒ‡ãƒ¼ã‚¿ã®å¤‰æ›´ç‚¹ï¼ˆç•°å‹•äº‹ç”±ï¼‰ã‚’ç•°å‹•ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³ãƒ†ãƒ¼ãƒ–ãƒ«ã§ï¼Œç®¡ç†ã—ã¦ã„ã‚‹ï¼æ¯æ—¥ï¼Œå¥‘ç´„ãƒã‚¹ã‚¿ãƒ†ãƒ¼ãƒ–ãƒ«ã¨ç•°å‹•ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³ãƒ†ãƒ¼ãƒ–ãƒ«ã«ãŠã‘ã‚‹å‰æ—¥ãƒ¬ã‚³ãƒ¼ãƒ‰ã‚’çªãåˆã‚ã›ï¼Œå„å¥‘ç´„ã®ç•°å‹•äº‹ç”±ã«å¿œã˜ã¦ï¼Œå¤‰æ›´å¾Œå¥‘ç´„ãƒ‡ãƒ¼ã‚¿ã¨ã—ã¦ï¼Œæ–°å¥‘ç´„ãƒã‚¹ã‚¿ãƒ†ãƒ¼ãƒ–ãƒ«ã«æŒ¿å…¥ã™ã‚‹ï¼ å‰å‡¦ç†ã¨ã—ã¦ï¼Œå¥‘ç´„ãƒã‚¹ã‚¿ãƒ‡ãƒ¼ã‚¿ã¨ç•°å‹•ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³ãƒ‡ãƒ¼ã‚¿ã«å…±é€šã™ã‚‹è­˜åˆ¥å­ãŒåŒã˜é †ç•ªã§ä¸¦ã‚“ã§ã„ã‚‹å¿…è¦ãŒã‚ã‚‹ï¼ å¥‘ç´„ãƒã‚¹ã‚¿ãƒ‡ãƒ¼ã‚¿ã®1è¡Œç›®ã¨ï¼Œç•°å‹•ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³ãƒ‡ãƒ¼ã‚¿ã®1è¡Œç›®ã®è­˜åˆ¥å­ã‚’çªãåˆã‚ã›ã‚‹ï¼ã€å¥‘ç´„ãƒã‚¹ã‚¿ãƒ‡ãƒ¼ã‚¿ = ç•°å‹•ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³ãƒ‡ãƒ¼ã‚¿ã€ã®æ™‚ï¼Œç•°å‹•ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³ãƒ‡ãƒ¼ã‚¿ã‚’åŸºã«å¥‘ç´„ãƒã‚¹ã‚¿ãƒ‡ãƒ¼ã‚¿ã‚’æ›´æ–°ã—ï¼Œãã‚Œã‚’æ–°ã—ã„ãƒ‡ãƒ¼ã‚¿ã¨ã—ã¦å¤‰æ›´å¾Œå¥‘ç´„ãƒã‚¹ã‚¿ãƒ‡ãƒ¼ã‚¿ã«æŒ¿å…¥ã™ã‚‹ï¼ å¥‘ç´„ãƒã‚¹ã‚¿ãƒ‡ãƒ¼ã‚¿ã®2è¡Œç›®ã¨ï¼Œç•°å‹•ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³ãƒ‡ãƒ¼ã‚¿ã®2è¡Œç›®ã®è­˜åˆ¥å­ã‚’çªãåˆã‚ã›ã‚‹ï¼ã€ãƒã‚¹ã‚¿ãƒ‡ãƒ¼ã‚¿ ãƒã‚¹ã‚¿ãƒ‡ãƒ¼ã‚¿ã®3è¡Œç›®ã¨ï¼Œå›ºå®šã—ãŸã¾ã¾ã®ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³ãƒ‡ãƒ¼ã‚¿ã®2è¡Œç›®ã®è­˜åˆ¥å­ã‚’çªãåˆã‚ã›ã‚‹ï¼ã€ãƒã‚¹ã‚¿ãƒ‡ãƒ¼ã‚¿ = ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³ãƒ‡ãƒ¼ã‚¿ã€ã®æ™‚ï¼Œãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³ãƒ‡ãƒ¼ã‚¿ã‚’åŸºã«ãƒã‚¹ã‚¿ãƒ‡ãƒ¼ã‚¿ã‚’æ›´æ–°ã—ï¼Œãã‚Œã‚’å¤‰æ›´å¾Œãƒ‡ãƒ¼ã‚¿ã¨ã—ã¦å¤‰æ›´å¾Œãƒã‚¹ã‚¿ãƒ†ãƒ¼ãƒ–ãƒ«ã«æŒ¿å…¥ã™ã‚‹ï¼ ã€å¥‘ç´„ãƒã‚¹ã‚¿ãƒ‡ãƒ¼ã‚¿ æœ€çµ‚çš„ã«ï¼Œå¤‰æ›´å¾Œãƒã‚¹ã‚¿ãƒ†ãƒ¼ãƒ–ãƒ«ã¯ä»¥ä¸‹ã®é€šã‚Šã«ãªã‚‹ï¼ "},"public/software/software_application_architecture_backend_microservice.html":{"url":"public/software/software_application_architecture_backend_microservice.html","title":"ğŸ“– ï¸ãƒã‚¤ã‚¯ãƒ­ã‚µãƒ¼ãƒ“ã‚¹ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£","keywords":"","body":"ãƒã‚¤ã‚¯ãƒ­ã‚µãƒ¼ãƒ“ã‚¹ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ ã¯ã˜ã‚ã« æœ¬ã‚µã‚¤ãƒˆã«ã¤ãã¾ã—ã¦ï¼Œä»¥ä¸‹ã‚’ã”èªè­˜ã®ã»ã©å®œã—ããŠé¡˜ã„ã„ãŸã—ã¾ã™ï¼ å‚è€ƒï¼šhttps://hiroki-it.github.io/tech-notebook-gitbook/ 01. ã‚¤ãƒ³ãƒˆãƒ­ãƒ€ã‚¯ã‚·ãƒ§ãƒ³ ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã®ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã®æ­´å² ãƒ»ãƒã‚¤ã‚¯ãƒ­ã‚µãƒ¼ãƒ“ã‚¹ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã‚’å–ã‚Šå·»ãç’°å¢ƒ å‚è€ƒï¼›https://tech-blog.rakus.co.jp/entry/20201218/architecture å¹´ä»£ ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ èª¬æ˜ 1999 ï½ ãƒ¢ãƒãƒªã‚·ãƒƒã‚¯ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ 1999å¹´å°ï¼Œãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã®ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã¨ã—ã¦ãƒ¢ãƒãƒªã‚·ãƒƒã‚¯ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ãŒå°é ­ã—ã¦ã„ãŸï¼ã—ã‹ã—ï¼Œãƒ¢ãƒãƒªã‚·ãƒƒã‚¯ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã¯ç„¡ç§©åºã§ã¤ãã¯ãã ã‚‰ã‘ã®ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã«ãªã‚‹ã“ã¨ãŒè«–æ–‡ï¼ˆã€å¤§ããªæ³¥ã ã‚“ã”ã€ï¼‰ã§æŒ‡æ‘˜ã•ã‚ŒãŸï¼å‚è€ƒï¼šhttps://ja.wikipedia.org/wiki/%E5%A4%A7%E3%81%8D%E3%81%AA%E6%B3%A5%E3%81%A0%E3%82%93%E3%81%94 2014 ãƒã‚¤ã‚¯ãƒ­ã‚µãƒ¼ãƒ“ã‚¹ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ 2014å¹´ã«ThoughtWorksç¤¾ã¯ï¼Œã‚µãƒ¼ãƒ“ã‚¹æŒ‡å‘ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã¨ãƒ‰ãƒ¡ã‚¤ãƒ³é§†å‹•è¨­è¨ˆã‚’çµ±åˆã—ï¼Œã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ç‹¬ç«‹ã—ãŸã‚µãƒ¼ãƒ“ã‚¹ã®é›†ã¾ã‚Šã«åˆ†å‰²ã™ã‚‹ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã‚’è€ƒæ¡ˆã—ãŸï¼å‚è€ƒï¼šãƒ»https://martinfowler.com/articles/microservices.htmlãƒ»https://atmarkit.itmedia.co.jp/ait/articles/2110/22/news006.html 2017 ãƒŸãƒ‹ã‚µãƒ¼ãƒ“ã‚¹ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ ãƒã‚¤ã‚¯ãƒ­ã‚µãƒ¼ãƒ“ã‚¹ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã®ã‚µãƒ¼ãƒ“ã‚¹è‡ªä½“ã‚’ç‹¬ç«‹ã—ãŸãƒ¢ãƒãƒªã‚¹ãªã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã¨æ‰ãˆã‚‹ã¨ï¼Œãã®åˆ†ã ã‘é–‹ç™ºãƒãƒ¼ãƒ ï¼ˆãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼ã¨ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ï¼‰ãŒå¿…è¦ã«ãªã£ã¦ã—ã¾ã†ï¼2017å¹´ã«Cloud Elementsç¤¾ã¯ï¼Œã“ã‚Œã«å¯¾å‡¦ã™ã‚‹ãŸã‚ã«ãƒŸãƒ‹ã‚µãƒ¼ãƒ“ã‚¹ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã‚’è€ƒæ¡ˆã—ãŸï¼ã“ã®ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã§ã¯ï¼Œãƒã‚¤ã‚¯ãƒ­ã‚µãƒ¼ãƒ“ã‚¹ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã¨ãƒ¢ãƒãƒªã‚¹ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã®é–“ã‚’ã¨ã£ãŸç²’åº¦ã§ï¼Œã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’è¤‡æ•°ã®ã‚µãƒ¼ãƒ“ã‚¹ã«åˆ†å‰²ã™ã‚‹ï¼ã“ã®ç²’åº¦ã‚’ï¼Œãƒã‚¤ã‚¯ãƒ­ã‚µãƒ¼ãƒ“ã‚¹ã«å¯¾æŠ—ã—ã¦ã€ãƒŸãƒ‹ã‚µãƒ¼ãƒ“ã‚¹ã€ã¾ãŸã¯ã€MASAã€ã¨ã‚ˆã¶ï¼å‚è€ƒï¼šãƒ»https://blog.cloud-elements.com/pragmatic-microservices-architectureãƒ»https://atmarkit.itmedia.co.jp/ait/articles/2110/22/news006.html 2018 ãƒ¢ã‚¸ãƒ¥ãƒ©ãƒ¼ãƒ¢ãƒãƒªã‚¹ ãƒŸãƒ‹ã‚µãƒ¼ãƒ“ã‚¹ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã§ã¯ã‚µãƒ¼ãƒ“ã‚¹ã®ç²’åº¦ãŒå¤§ãããªã£ãŸã‚‚ã®ã®ï¼Œè¤‡æ•°ã®ã‚µãƒ¼ãƒ“ã‚¹ãŒå¿…è¦ã«ãªã‚‹ã“ã¨ã¯å¤‰ã‚ã‚‰ãšï¼Œãã®åˆ†ã ã‘é–‹ç™ºãƒãƒ¼ãƒ ãŒå¿…è¦ã«ãªã‚‹å•é¡Œã¯è§£æ¶ˆã•ã‚Œãªã‹ã£ãŸï¼ãã“ã§ï¼ŒRoot Insuranceç¤¾ã¯ãƒ¢ã‚¸ãƒ¥ãƒ©ãƒ¢ãƒãƒªã‚¹ã‚’è€ƒæ¡ˆã—ãŸï¼ãƒ¢ã‚¸ãƒ¥ãƒ©ãƒ¢ãƒãƒªã‚¹ã§ã¯ï¼Œã‚µãƒ¼ãƒ“ã‚¹ã®æ¦‚å¿µã‚’å–ã‚Šå…¥ã‚Œãšã«ï¼Œã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ç´°ã‹ã„ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã«åˆ†å‰²ã™ã‚‹ï¼å‚è€ƒï¼šhttps://medium.com/@dan_manges/the-modular-monolith-rails-architecture-fb1023826fc4 ãƒ»ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ï¼ã‚µãƒ¼ãƒ“ã‚¹ã®ç²’åº¦ã®æ¯”è¼ƒ å‚è€ƒï¼šhttps://tech-blog.rakus.co.jp/entry/20201218/architecture ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã®å¤§ãã• ç¨®é¡ èª¬æ˜ ä¸€ç•ªå¤§ãã„ ãƒ¢ãƒãƒªã‚·ãƒƒã‚¯ ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ãŒåˆ†å‰²ã•ã‚Œã¦ãŠã‚‰ãšï¼Œã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ãƒ‡ãƒ—ãƒ­ã‚¤ã®å˜ä½ã¨ã™ã‚‹ï¼ ãƒ¢ã‚¸ãƒ¥ãƒ©ãƒ¼ ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãŒãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã«åˆ†å‰²ã•ã‚Œã¦ãŠã‚Šï¼Œã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ãƒ‡ãƒ—ãƒ­ã‚¤ã®å˜ä½ã¨ã™ã‚‹ï¼ ãƒŸãƒ‹ã‚µãƒ¼ãƒ“ã‚¹ ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãŒã‚µãƒ–ãƒ‰ãƒ¡ã‚¤ãƒ³ï¼ˆã¾ãŸã¯å¢ƒç•Œä»˜ã‘ã‚‰ã‚ŒãŸã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆï¼‰ã‚’å˜ä½ã¨ã—ãŸã‚µãƒ¼ãƒ“ã‚¹ã«åˆ†å‰²ã•ã‚Œã¦ãŠã‚Šï¼Œã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’æ§‹æˆã™ã‚‹ã‚µãƒ¼ãƒ“ã‚¹ã®ã‚ã‚‹ç¨‹åº¦ã®ã¾ã¨ã¾ã‚Šã‚’ãƒ‡ãƒ—ãƒ­ã‚¤ã®å˜ä½ã¨ã™ã‚‹ï¼ã¾ãŸï¼ŒDBã‚’å„ã‚µãƒ¼ãƒ“ã‚¹ã§å…±æœ‰ã™ã‚‹ï¼ ä¸€ç•ªå°ã•ã„ ãƒã‚¤ã‚¯ãƒ­ ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãŒã‚µãƒ–ãƒ‰ãƒ¡ã‚¤ãƒ³ï¼ˆã¾ãŸã¯å¢ƒç•Œä»˜ã‘ã‚‰ã‚ŒãŸã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆï¼‰ã‚’å˜ä½ã¨ã—ãŸã‚µãƒ¼ãƒ“ã‚¹ã¾ãŸã¯ãƒ«ãƒ¼ãƒˆã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã«åˆ†å‰²ã•ã‚Œã¦ãŠã‚Šï¼Œã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’æ§‹æˆã™ã‚‹ã‚µãƒ¼ãƒ“ã‚¹ãã‚Œãã‚Œã‚’ãƒ‡ãƒ—ãƒ­ã‚¤ã®å˜ä½ã¨ã™ã‚‹ï¼ã¾ãŸï¼ŒDBã‚’å„ã‚µãƒ¼ãƒ“ã‚¹ã§å…±æœ‰ã›ãšã«ï¼Œã‚µãƒ¼ãƒ“ã‚¹ã”ã¨ã«è¨­ç½®ã™ã‚‹ï¼ ãƒã‚¤ã‚¯ãƒ­ã‚µãƒ¼ãƒ“ã‚¹ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã®ç‰¹å¾´ ãƒ»ãƒ“ã‚¸ãƒã‚¹ã®ã‚¹ã‚±ãƒ¼ãƒªãƒ³ã‚°ã«å¼·ã„ ãƒ“ã‚¸ãƒã‚¹ãŒã‚¹ã‚±ãƒ¼ãƒªãƒ³ã‚°ã™ã‚‹æ™‚ï¼Œã‚µãƒ¼ãƒ“ã‚¹ã®æ–°è¦å®Ÿè£…ã¾ãŸã¯å‰Šé™¤ã‚’è¡Œãˆã°è‰¯ã„ãŸã‚ï¼Œãƒ‰ãƒ¡ã‚¤ãƒ³å±¤ã®æ¿€ã—ã„å¤‰åŒ–ã«å¼·ã„ï¼ ãƒ»ã‚³ãƒ³ã‚¦ã‚§ã‚¤ã®æ³•å‰‡ãŒåƒã ãƒã‚¤ã‚¯ãƒ­ã‚µãƒ¼ãƒ“ã‚¹ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã«ã‚ˆã‚Šï¼Œçµ„ç¹”æ§‹é€ ãŒå°ã•ãªãƒãƒ¼ãƒ ã®é›†ã¾ã‚Šã«å¤‰åŒ–ã™ã‚‹ã“ã¨ã‚’æœŸå¾…ã§ãã‚‹ï¼ ãƒ»é«˜é »åº¦ã§ãƒªãƒªãƒ¼ã‚¹å¯èƒ½ å„ã‚µãƒ¼ãƒ“ã‚¹ã‚’ç‹¬ç«‹ã—ã¦ãƒ‡ãƒ—ãƒ­ã‚¤ã§ãã‚‹ãŸã‚ï¼Œé«˜é »åº¦ã§ãƒªãƒªãƒ¼ã‚¹ã§ãã‚‹ï¼ ãƒ»éšœå®³ã®å½±éŸ¿ãŒéƒ¨åˆ†çš„ ã„ãšã‚Œã‹ã®ã‚µãƒ¼ãƒ“ã‚¹ã«éšœå®³ãŒèµ·ã“ã£ãŸã¨ã—ã¦ï¼Œã‚µãƒ¼ã‚­ãƒƒãƒˆãƒ–ãƒ¬ã‚¤ã‚«ãƒ¼ã‚’ç”¨ã„ã‚‹ã“ã¨ã«ã‚ˆã‚Šï¼Œä¸Šæµã‚µãƒ¼ãƒ“ã‚¹ã¸ã®éšœå®³ã®æ³¢åŠã‚’é£Ÿã„æ­¢ã‚ã‚‰ã‚Œã‚‹ï¼ãã®ãŸã‚ï¼Œéšœå®³ã®å½±éŸ¿ãŒéƒ¨åˆ†çš„ã¨ãªã‚Šï¼Œã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å…¨ä½“ãŒè½ã¡ã¦ã—ã¾ã†ã“ã¨ãŒãªã„ï¼ ãƒ»è¤‡æ•°ã®é–‹ç™ºè¨€èªã‚’ä½¿ç”¨å¯èƒ½ ã‚µãƒ¼ãƒ“ã‚¹é–“ã§ï¼Œå…±é€šã®ãƒ‡ãƒ¼ã‚¿è¨˜è¿°è¨€èªã‚’ä½¿ç”¨ã—ã¦ãƒ‡ãƒ¼ã‚¿é€šä¿¡ã‚’è¡Œãˆã°ï¼Œå„ã‚µãƒ¼ãƒ“ã‚¹ã®é–‹ç™ºè¨€èªãŒç•°ãªã£ã¦ã„ã¦ã‚‚å•é¡Œãªã„ï¼ ãƒªãƒã‚¸ãƒˆãƒªã®ç²’åº¦ ãƒ»ãƒ¢ãƒãƒªãƒã‚¸ãƒˆãƒª å…¨ã¦ã®ã‚µãƒ¼ãƒ“ã‚¹ã‚’ä¸€ã¤ã®ãƒªãƒã‚¸ãƒˆãƒªã§ç®¡ç†ã™ã‚‹ï¼Googleã§ã¯ãƒ¢ãƒãƒªãƒã‚¸ãƒˆãƒªã«ã‚ˆã‚‹ãƒã‚¤ã‚¯ãƒ­ã‚µãƒ¼ãƒ“ã‚¹ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ãŒæ¡ç”¨ã•ã‚Œã¦ã„ã‚‹ï¼ å‚è€ƒï¼šhttps://www.fourtheorem.com/blog/monorepo ãƒ»ãƒãƒªãƒ¬ãƒã‚¸ãƒˆãƒª å„ã‚µãƒ¼ãƒ“ã‚¹ã‚’ç•°ãªã‚‹ãƒªãƒã‚¸ãƒˆãƒªã§ç®¡ç†ã™ã‚‹ï¼ ãƒã‚¤ã‚¯ãƒ­ã‚µãƒ¼ãƒ“ã‚¹ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã®ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ ãƒ»dapr å‚è€ƒï¼š https://www.publickey1.jp/blog/19/dapr.html https://github.com/dapr/dapr 02. å„åˆ†æ•£ã‚·ã‚¹ãƒ†ãƒ ã®ç²’åº¦ ã‚µãƒ¼ãƒ“ã‚¹ ãƒ»ã‚µãƒ¼ãƒ“ã‚¹ã¨ã¯ ãƒã‚¤ã‚¯ãƒ­ã‚µãƒ¼ãƒ“ã‚¹ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã«ãŠã‘ã‚‹ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã®åˆ†æ•£ã‚·ã‚¹ãƒ†ãƒ ã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®ã“ã¨ï¼ç‰¹å®šã®ã‚µãƒ¼ãƒ“ã‚¹ãŒä»–ã®ã‚µãƒ¼ãƒ“ã‚¹ã«ä¾µé£Ÿã•ã‚Œï¼Œã‚µãƒ¼ãƒ“ã‚¹ã®å‡é›†åº¦ãŒä½ããªã‚‰ãªã„ã‚ˆã†ã«ã™ã‚‹ãŸã‚ã«ï¼ŒACLï¼šAnti Corruption Layerï¼ˆè…é£Ÿé˜²æ­¢ãƒ¬ã‚¤ãƒ¤ãƒ¼ï¼‰ã‚’è¨­ã‘ã‚‹å¿…è¦ãŒã‚ã‚‹ï¼è…é£Ÿé˜²æ­¢ãƒ¬ã‚¤ãƒ¤ãƒ¼ã¯ï¼Œç•°ãªã‚‹ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã‹ã‚‰å—ä¿¡ã—ãŸãƒ‡ãƒ¼ã‚¿ã‚’ï¼Œãã®ã‚µãƒ¼ãƒ“ã‚¹ã®ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã«ã‚ã£ãŸãƒ‡ãƒ¼ã‚¿å½¢å¼ã«å¤‰æ›ã™ã‚‹è²¬å‹™ã‚’æŒã¤ï¼CQRSã§ã¯ï¼Œã“ã‚Œã¯ãƒ—ãƒ­ã‚»ã‚¹ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ‘ã‚¿ãƒ¼ãƒ³ã¨ã—ã¦çŸ¥ã‚‰ã‚Œã¦ã„ã‚‹ï¼ä¸€æ–¹ã§Sagaãƒ‘ã‚¿ãƒ¼ãƒ³ã¨ã‚‚å‘¼ã°ã‚Œã‚‹ãŒï¼Œåˆ†æ•£ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³ã§ã‚‚åŒä¸€ã®ç”¨èªãŒã‚ã‚‹ãŸã‚ï¼Œæ··ä¹±ã‚’é¿ã‘ã‚‹ãŸã‚ã«ãƒ—ãƒ­ã‚»ã‚¹ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ‘ã‚¿ãƒ¼ãƒ³ã¨ã™ã‚‹ï¼ å‚è€ƒï¼š https://github.com/czeslavo/process-manager https://www.oreilly.com/library/view/what-is-domain-driven/9781492057802/ch04.html https://docs.microsoft.com/ja-jp/previous-versions/msp-n-p/jj591569(v=pandp.10)?redirectedfrom=MSDN ãƒ»å„ã‚µãƒ¼ãƒ“ã‚¹ã®ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ å„ã‚µãƒ¼ãƒ“ã‚¹ã®ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã¯è‡ªç”±ã§ã‚ã‚‹ï¼ã“ã®æ™‚ï¼Œãƒ‰ãƒ¡ã‚¤ãƒ³é§†å‹•è¨­è¨ˆã®ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã«åŸºã¥ã„ã¦å®Ÿè£…ã™ã‚‹ã“ã¨ãŒå¯èƒ½ã§ã‚ã‚‹ï¼ ï¼Šä¾‹ï¼Š å‚è€ƒï¼šhttps://little-hands.hatenablog.com/entry/2017/12/07/bouded-context-implementation ECã‚µã‚¤ãƒˆãŒã‚ã‚Šï¼Œã“ã‚Œã®å•†å“è²©å£²ãƒ‰ãƒ¡ã‚¤ãƒ³ã‚’è²©å£²ã‚µãƒ–ãƒ‰ãƒ¡ã‚¤ãƒ³ã¨é…é€ã‚µãƒ–ãƒ‰ãƒ¡ã‚¤ãƒ³ã«åˆ†å‰²ã§ãã‚‹ã¨ã™ã‚‹ï¼ã“ã®æ™‚ï¼Œãã‚Œãã‚Œã®ã‚µãƒ–ãƒ‰ãƒ¡ã‚¤ãƒ³ã®å•é¡Œã‚’è§£æ±ºã™ã‚‹è²©å£²ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã¨é…é€ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã‚’ã‚µãƒ¼ãƒ“ã‚¹ã®ç²’åº¦ã¨ãªã‚Šï¼Œã‚ªãƒ‹ã‚ªãƒ³ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã®ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³é–“ã§åŒæœŸé€šä¿¡ï¼éåŒæœŸé€šä¿¡ã‚’è¡Œã†ï¼ ã‚µãƒ¼ãƒ“ã‚¹ã®åˆ†å‰²æ‰‹æ³• ãƒ»ã‚µãƒ¼ãƒ“ã‚¹ã®åˆ†å‰²ä¾‹ ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ ãƒªãƒ³ã‚¯ åˆ†å‰²æ–¹æ³• ã‚µãƒ¼ãƒ“ã‚¹ã®ç¨®é¡ Eã‚³ãƒãƒ¼ã‚¹ https://github.com/GoogleCloudPlatform/microservices-demo ãƒ«ãƒ¼ãƒˆã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ ã‚«ãƒ¼ãƒˆï¼Œå•†å“æ¤œç´¢ã¨ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ï¼Œé€šè²¨ã®å¤‰æ›ï¼Œã‚¯ãƒ¬ã‚¸ãƒƒãƒˆã‚«ãƒ¼ãƒ‰ï¼Œé€æ–™ã¨ç™ºé€ï¼Œæ³¨æ–‡ç¢ºèªãƒ¡ãƒ¼ãƒ«ï¼Œæ³¨æ–‡ãƒ•ãƒ­ãƒ¼ï¼Œãƒ¬ã‚³ãƒ¡ãƒ³ãƒ‰ï¼Œåºƒå‘Šï¼Œåˆæˆç›£è¦– Eã‚³ãƒãƒ¼ã‚¹ https://github.com/DataDog/ecommerce-workshop ãƒ«ãƒ¼ãƒˆã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ åºƒå‘Šï¼Œå‰²å¼• ãƒ»ã‚µãƒ–ãƒ‰ãƒ¡ã‚¤ãƒ³ï¼Œå¢ƒç•Œä»˜ã‘ã‚‰ã‚ŒãŸã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã‚’å˜ä½ã¨ã—ãŸåˆ†å‰² ã‚µãƒ–ãƒ‰ãƒ¡ã‚¤ãƒ³ã‚’ã‚µãƒ¼ãƒ“ã‚¹ã®ç²’åº¦ã¨ã™ã‚‹ï¼ã“ã“ã§ã¯ï¼Œè§£æ±ºé ˜åŸŸã¨ãªã‚‹å¢ƒç•Œä»˜ã‘ã‚‰ã‚ŒãŸã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆãŒã‚µãƒ–ãƒ‰ãƒ¡ã‚¤ãƒ³ã®ä¸­ã«ä¸€ã¤ã—ã‹å«ã¾ã‚Œã¦ã„ãªã„å ´åˆã‚’æŒ‡ã—ã¦ãŠã‚Šï¼Œä»£ã‚ã‚Šã«ï¼Œå¢ƒç•Œä»˜ã‘ã‚‰ã‚ŒãŸã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã‚’ã‚µãƒ¼ãƒ“ã‚¹ã®ç²’åº¦ã—ã¦è€ƒãˆã¦ã‚‚è‰¯ã„ï¼ã‚µãƒ–ãƒ‰ãƒ¡ã‚¤ãƒ³ã‚’ç²’åº¦ã¨ã™ã‚‹ã“ã¨ã‚’ç¬¬ä¸€æ®µéšã¨ã—ã¦ï¼Œã•ã‚‰ã«å°ã•ãªç²’åº¦ã«åˆ†å‰²ã™ã‚‹ãŸã‚ã«ï¼Œæ¬¡ã®æ®µéšã¨ã—ã¦ãƒ«ãƒ¼ãƒˆã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã‚’ç²’åº¦ã¨ã™ã‚‹ã¨ã‚ˆã„ï¼ å‚è€ƒï¼š https://microservices.io/patterns/decomposition/decompose-by-subdomain.html https://www.amazon.co.jp/dp/4873119316/ref=cm_sw_em_r_mt_dp_PVDKB4F74K7S07E4CTFF ãƒ»ãƒ«ãƒ¼ãƒˆã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã‚’å˜ä½ã¨ã—ãŸåˆ†å‰² ãƒ«ãƒ¼ãƒˆã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã‚’ã‚µãƒ¼ãƒ“ã‚¹ã®å˜ä½ã¨ã™ã‚‹ï¼ãŸã ã—ï¼Œã‚¤ãƒ™ãƒ³ãƒˆé§†å‹•æ–¹å¼ã§ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’é€£æºã—ãŸå ´åˆã«é™ã‚Šï¼Œå¾“æ¥ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆæ–¹å¼ã§ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’é€£æºã™ã‚‹å ´åˆã®ãƒ«ãƒ¼ãƒˆã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã‚’ä½¿ç”¨ã™ã‚‹ã“ã¨ã¯ã‚¢ãƒ³ãƒãƒ‘ã‚¿ãƒ¼ãƒ³ã§ã‚ã‚‹ï¼æœ€è‰¯ãªè§£æ±ºç­–ã¨ã—ã¦ï¼Œã‚µãƒ¼ãƒ“ã‚¹ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®çŠ¶æ…‹ç®¡ç†æ–¹å¼ã¨ã—ã¦ï¼Œå¾“æ¥ã®ãƒ‡ãƒ¼ã‚¿ã«ç€ç›®ã—ãŸã‚¹ãƒ†ãƒ¼ãƒˆã‚½ãƒ¼ã‚·ãƒ³ã‚°ã§ã¯ãªãï¼ŒæŒ¯ã‚‹èˆã„ã«ç€ç›®ã—ãŸã‚¤ãƒ™ãƒ³ãƒˆã‚½ãƒ¼ã‚·ãƒ³ã‚°ã‚’ä½¿ç”¨ã™ã‚‹å¿…è¦ãŒã‚ã‚‹ï¼ã¾ãŸï¼Œå„ã‚µãƒ¼ãƒ“ã‚¹ã‚’åè©ã§ã¯ãªãå‹•è©ã§å‘½åã™ã‚‹ã¨ã‚ˆã„ï¼ãã®ä»–ï¼Œå„ã‚µãƒ¼ãƒ“ã‚¹ã§DBã‚’å®Œå…¨ã«ç‹¬ç«‹ã•ã›ã‚‹ã“ã¨ã‚„ï¼ŒSAGAãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’ä½¿ç”¨ã™ã‚‹ã“ã¨ï¼ŒãŒã‚ã‚‹ï¼ å‚è€ƒï¼š https://github.com/GoogleCloudPlatform/microservices-demo https://www.koslib.com/posts/entity-services-anti-pattern/ https://www.michaelnygard.com/blog/2018/01/services-by-lifecycle/ https://medium.com/transferwise-engineering/how-to-avoid-entity-services-58bacbe3ee0b 03. åˆ†æ•£ã‚·ã‚¹ãƒ†ãƒ é–“ã®é€£æº Orchestrationï¼ˆã‚ªãƒ¼ã‚±ã‚¹ãƒˆãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ï¼‰ ãƒ»ã‚ªãƒ¼ã‚±ã‚¹ãƒˆãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã¨ã¯ ä¸­å¤®é›†æ¨©å‹ã‚·ã‚¹ãƒ†ãƒ ã¨ã‚‚è¨€ã†ï¼å…¨ã¦ã®ã‚µãƒ¼ãƒ“ã‚¹ã‚’åˆ¶å¾¡ã™ã‚‹è²¬å‹™ã‚’æŒã£ãŸã‚ªãƒ¼ã‚±ã‚¹ãƒˆãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã‚’è¨­ç½®ã™ã‚‹è¨­è¨ˆæ–¹æ³•ï¼ä¸€ã¤ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆãŒé€ä¿¡ã•ã‚ŒãŸæ™‚ã«ï¼Œã‚ªãƒ¼ã‚±ã‚¹ãƒˆãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã¯å„ã‚µãƒ¼ãƒ“ã‚¹ã‚’ã‚³ãƒ¼ãƒ«ã—ãªãŒã‚‰å‡¦ç†ã®çµæœã‚’ç¹‹ã„ã§ã„ãï¼ãƒã‚¤ã‚¯ãƒ­ã‚µãƒ¼ãƒ“ã‚¹ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã ã‘ã§ãªãï¼Œã‚µãƒ¼ãƒ“ã‚¹æŒ‡å‘ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã§ã‚‚ä½¿ç”¨ã•ã‚Œã‚‹ï¼ å‚è€ƒï¼š https://news.mynavi.jp/itsearch/article/devsoft/1598 https://blogs.itmedia.co.jp/itsolutionjuku/2019/08/post_729.html https://www.fiorano.com/jp/blog/integration/integration-architecture/%E3%82%B3%E3%83%AC%E3%82%AA%E3%82%B0%E3%83%A9%E3%83%95%E3%82%A3-vs-%E3%82%AA%E3%83%BC%E3%82%B1%E3%82%B9%E3%83%88%E3%83%AC%E3%83%BC%E3%82%B7%E3%83%A7%E3%83%B3/ ãƒ»ãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒªãƒ—ãƒ©ã‚¤æ–¹å¼ ã‚ªãƒ¼ã‚±ã‚¹ãƒˆãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã§ã¯ï¼Œå€‹ã€…ã®ã‚µãƒ¼ãƒ“ã‚¹é–“ã®é€£æºæ–¹å¼ã«ãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒªãƒ—ãƒ©ã‚¤æ–¹å¼ã‚’æ¡ç”¨ã™ã‚‹ï¼ã“ã®æ–¹å¼ã§ã¯ï¼Œã‚µãƒ¼ãƒ“ã‚¹é–“ã§RESTfulAPIã‚’ç”¨ã„ãŸåŒæœŸé€šä¿¡ã‚’å®Ÿè¡Œã™ã‚‹ï¼ Choreographyï¼ˆã‚³ãƒ¬ã‚ªã‚°ãƒ©ãƒ•ã‚£ï¼‰ ãƒ»ã‚³ãƒ¬ã‚ªã‚°ãƒ©ãƒ•ã‚£ã¨ã¯ åˆ†æ•£å‹ã‚·ã‚¹ãƒ†ãƒ ã¨ã‚‚è¨€ã†ï¼ã‚ªãƒ¼ã‚±ã‚¹ãƒˆãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã¨ã—ã¦ã®ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã¯å­˜åœ¨ã›ãšï¼Œå„ã‚µãƒ¼ãƒ“ã‚¹ã§ä¸‹æµã‚µãƒ¼ãƒ“ã‚¹ã«é€£æºã™ã‚‹è²¬å‹™ã‚’æŒãŸã›ã‚‹è¨­è¨ˆæ–¹æ³•ã§ã‚ã‚‹ï¼å€‹ã€…ã®ã‚µãƒ¼ãƒ“ã‚¹é–“ã®é€£æºæ–¹å¼ã§ã¯ï¼Œã‚¤ãƒ™ãƒ³ãƒˆé§†å‹•æ–¹å¼ã‚’æ¡ç”¨ã™ã‚‹ï¼ä¸€ã¤ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆãŒé€ä¿¡ã•ã‚ŒãŸæ™‚ã«ï¼Œã‚µãƒ¼ãƒ“ã‚¹ã‹ã‚‰ã‚µãƒ¼ãƒ“ã‚¹ã«å‡¦ç†ãŒç¹‹ãŒã£ã¦ã„ãï¼ãƒã‚¤ã‚¯ãƒ­ã‚µãƒ¼ãƒ“ã‚¹ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã§ã¯ï¼Œã‚³ãƒ¬ã‚ªã‚°ãƒ©ãƒ•ã‚£ã«ã‚ˆã‚‹é€£æºãŒæ¨å¥¨ã•ã‚Œã¦ã„ã‚‹ï¼ å‚è€ƒï¼š https://blogs.itmedia.co.jp/itsolutionjuku/2019/08/post_729.html https://www.fiorano.com/jp/blog/integration/integration-architecture/%E3%82%B3%E3%83%AC%E3%82%AA%E3%82%B0%E3%83%A9%E3%83%95%E3%82%A3-vs-%E3%82%AA%E3%83%BC%E3%82%B1%E3%82%B9%E3%83%88%E3%83%AC%E3%83%BC%E3%82%B7%E3%83%A7%E3%83%B3/ ãƒ»ã‚¤ãƒ™ãƒ³ãƒˆé§†å‹•æ–¹å¼ ã‚³ãƒ¬ã‚ªã‚°ãƒ©ãƒ•ã‚£ã§ã¯ï¼Œä¸Šæµï¼ä¸‹æµã®ã‚µãƒ¼ãƒ“ã‚¹é–“ã®é€£æºæ–¹å¼ã«ã‚¤ãƒ™ãƒ³ãƒˆãƒ‰ãƒªãƒ–ãƒ³æ–¹å¼ã‚’æ¡ç”¨ã™ã‚‹ï¼ã“ã®æ–¹å¼ã§ã¯ï¼Œã‚µãƒ¼ãƒ“ã‚¹é–“ã§ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚­ãƒ¥ãƒ¼ã‚’ç”¨ã„ãŸéåŒæœŸé€šä¿¡ã‚’è¡Œã†ï¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚­ãƒ¥ãƒ¼ã§ã¯å—ä¿¡ã—ãŸãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’ä¸€æ–¹å‘ã«ã—ã‹é…ä¿¡ã§ããªã„ãŸã‚ï¼Œã‚‚ã—ã‚µãƒ¼ãƒ“ã‚¹é–“åŒæ–¹å‘ã«é€ä¿¡ã—ãŸã„å ´åˆã¯ï¼Œä¸Šæµã‚µãƒ¼ãƒ“ã‚¹ã‹ã‚‰ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å—ä¿¡ã™ã‚‹ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚­ãƒ¥ãƒ¼ã¨ï¼ä¸‹æµã‚µãƒ¼ãƒ“ã‚¹ã‹ã‚‰å—ä¿¡ã™ã‚‹ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚­ãƒ¥ãƒ¼ã‚’åˆ¥ã€…ã«è¨­ç½®ã™ã‚‹ï¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚­ãƒ¥ãƒ¼ã¯Pubï¼Subãƒ‡ã‚¶ã‚¤ãƒ³ãƒ‘ã‚¿ãƒ¼ãƒ³ã§å®Ÿè£…ã™ã‚‹ã‹ï¼Œã¾ãŸã¯AWS-SQSãªã©ã®ãƒ„ãƒ¼ãƒ«ã‚’ä½¿ç”¨ã™ã‚‹ï¼ ãƒ»å®Ÿè£…ä¾‹ ä»¥ä¸‹ã®ãƒªãƒã‚¸ãƒˆãƒªã‚’å‚è€ƒã«ã›ã‚ˆï¼ å‚è€ƒï¼šhttps://github.com/fedeoliv/microservices-transactions 04. ãƒ‡ãƒ¼ã‚¿æ°¸ç¶šåŒ–æ–¹å¼ ãƒ­ãƒ¼ã‚«ãƒ«ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³ ãƒ»ãƒ­ãƒ¼ã‚«ãƒ«ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³ã¨ã¯ å„ã‚µãƒ¼ãƒ“ã‚¹ã«ç‹¬ç«‹ã—ãŸãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³å‡¦ç†ãŒå­˜åœ¨ã—ã¦ãŠã‚Šï¼Œä¸€ã¤ã®ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³å‡¦ç†ã«ã‚ˆã£ã¦ï¼Œç‰¹å®šã®ã‚µãƒ¼ãƒ“ã‚¹ã®ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®ã¿ã‚’æ“ä½œã™ã‚‹è¨­è¨ˆæ–¹æ³•ï¼æ¨å¥¨ã§ã‚ã‚‹ï¼ã“ã®ãƒãƒ¼ãƒˆã§ã¯ï¼Œãƒ­ãƒ¼ã‚«ãƒ«ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³ã‚’ç”¨ã„ãŸã‚¤ãƒ³ãƒ•ãƒ©ã‚¹ãƒˆãƒ©ã‚¯ãƒãƒ£å±¤ã®é€£æºã‚’èª¬æ˜ã™ã‚‹ï¼ ãƒ»Sagaãƒ‘ã‚¿ãƒ¼ãƒ³ã¨ã¯ ãƒ­ãƒ¼ã‚«ãƒ«ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³ã®æ™‚ã«ï¼Œã‚¤ãƒ³ãƒ•ãƒ©ã‚¹ãƒˆãƒ©ã‚¯ãƒãƒ£å±¤ã‚’å®Ÿç¾ã™ã‚‹è¨­è¨ˆæ–¹æ³•ï¼ä¸Šæµã‚µãƒ¼ãƒ“ã‚¹ã®ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®æ“ä½œå®Œäº†ã‚’ã‚¤ãƒ™ãƒ³ãƒˆã¨ã—ã¦ï¼Œä¸‹æµã‚µãƒ¼ãƒ“ã‚¹ã®ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®æ“ä½œå‡¦ç†ã‚’é€£ç¶šçš„ã«ã‚³ãƒ¼ãƒ«ã™ã‚‹ï¼ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯æ™‚ã«ã¯è£œå„Ÿãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³ãŒå®Ÿè¡Œã•ã‚Œï¼Œé€†é †ã«ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®çŠ¶æ…‹ãŒå…ƒã«æˆ»ã•ã‚Œã‚‹ï¼ ã‚°ãƒ­ãƒ¼ãƒãƒ«ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³ ãƒ»ã‚°ãƒ­ãƒ¼ãƒãƒ«ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³ã¨ã¯ åˆ†æ•£ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³ã¨ã‚‚è¨€ã†ï¼ä¸€ã¤ã®ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³å‡¦ç†ãŒå„ã‚µãƒ¼ãƒ“ã‚¹ã«åˆ†æ•£ã—ã¦ãŠã‚Šï¼Œä¸€ã¤ã®ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³å‡¦ç†ã«ã‚ˆã¦ï¼Œå„ã‚µãƒ¼ãƒ“ã‚¹ã®ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚’é€£ç¶šçš„ã«æ“ä½œã™ã‚‹è¨­è¨ˆæ–¹æ³•ï¼éæ¨å¥¨ã§ã‚ã‚‹ï¼ 05. ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆãƒ¢ãƒ‡ãƒªãƒ³ã‚°æ–¹å¼ ã‚¤ãƒ™ãƒ³ãƒˆã‚½ãƒ¼ã‚·ãƒ³ã‚° ãƒ»ã‚¤ãƒ™ãƒ³ãƒˆã‚½ãƒ¼ã‚·ãƒ³ã‚°ã¨ã¯ ãƒ“ã‚¸ãƒã‚¹ã®å‡ºæ¥äº‹ã‚’ãƒ¢ãƒ‡ãƒªãƒ³ã‚°ã—ï¼Œãƒ‡ãƒ¼ã‚¿ã¨ã—ã¦æ°¸ç¶šåŒ–ã™ã‚‹ï¼ç¾åœ¨ã®çŠ¶æ…‹ã‚’å–å¾—ã™ã‚‹å ´åˆã¯ï¼ŒåˆæœŸã®ãƒ‡ãƒ¼ã‚¿ã«å…¨ã¦ã®å‡ºæ¥äº‹ã‚’é©ç”¨ã™ã‚‹ï¼CQRSã¨ç›¸æ€§ãŒè‰¯ã„ï¼ å‚è€ƒï¼š https://qiita.com/suin/items/f559e3dcde7c811ed4e1 https://martinfowler.com/articles/201701-event-driven.html ã‚¹ãƒ†ãƒ¼ãƒˆã‚½ãƒ¼ã‚·ãƒ³ã‚° ãƒ»ã‚¹ãƒ†ãƒ¼ãƒˆã‚½ãƒ¼ã‚·ãƒ³ã‚°ã¨ã¯ ãƒ“ã‚¸ãƒã‚¹ã®ç¾åœ¨ã®çŠ¶æ…‹ã‚’ãƒ¢ãƒ‡ãƒªãƒ³ã‚°ã—ï¼Œãƒ‡ãƒ¼ã‚¿ã¨ã—ã¦æ°¸ç¶šåŒ–ã™ã‚‹ï¼éå»ã®çŠ¶æ…‹ã¯ä¸Šæ›¸ãã•ã‚Œã‚‹ï¼ å‚è€ƒï¼šhttp://masuda220.jugem.jp/?eid=435 06. åˆ†æ•£ã‚·ã‚¹ãƒ†ãƒ ã«ãŠã‘ã‚‹ãƒ†ã‚¹ãƒˆ CDCãƒ†ã‚¹ãƒˆï¼šConsumer Drive Contract ãƒ»CDCãƒ†ã‚¹ãƒˆã¨ã¯ ã‚µãƒ¼ãƒ“ã‚¹ã®ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãŒã‚³ãƒ¼ãƒ«ã•ã‚Œã¦ã‹ã‚‰ï¼Œãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®æ“ä½œãŒå®Œäº†ã™ã‚‹ã¾ã§ã‚’ï¼Œãƒ†ã‚¹ãƒˆã™ã‚‹ï¼ä¸‹æµã‚µãƒ¼ãƒ“ã‚¹ã®ã‚³ãƒ¼ãƒ«ã¯ãƒ¢ãƒƒã‚¯åŒ–ã¾ãŸã¯ã‚¹ã‚¿ãƒ–åŒ–ã™ã‚‹ï¼ 07. é‹ç”¨ éšœå®³å¯¾ç­– ãƒ»ã‚µãƒ¼ã‚­ãƒƒãƒˆãƒ–ãƒ¬ã‚¤ã‚«ãƒ¼ã¨ã¯ ã‚µãƒ¼ãƒ“ã‚¹é–“ã«è¨­ç½®ã•ã‚Œï¼Œä»–ã®ã‚µãƒ¼ãƒ“ã‚¹ã«é€£é–ã™ã‚‹éšœå®³ã‚’å¸åã™ã‚‹ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã®ã“ã¨ï¼ä¸‹æµã‚µãƒ¼ãƒ“ã‚¹ã«éšœå®³ãŒèµ·ã“ã£ãŸæ™‚ã«ï¼Œä¸Šæµã‚µãƒ¼ãƒ“ã‚¹ã«ã‚¨ãƒ©ãƒ¼ã‚’è¿”ã—ã¦ã—ã¾ã‚ãªã„ã‚ˆã†ï¼Œç›´è¿‘ã®æˆåŠŸæ™‚ã®å‡¦ç†çµæœã‚’è¿”ä¿¡ã™ã‚‹ï¼ æ¨ªæ–­çš„ãªç›£è¦– ãƒ»åˆ†æ•£ãƒˆãƒ¬ãƒ¼ã‚·ãƒ³ã‚°ã¨ã¯ ã‚µãƒ¼ãƒ“ã‚¹é–“ã§åˆ†æ•£ã—ã¦ã—ã¾ã†å„ãƒ­ã‚°ã‚’ï¼Œä¸€æ„ãªIDã§ç´ä»˜ã‘ã‚‹æ–¹æ³•ï¼ ãƒ»ãƒ¢ãƒ‹ã‚¿ãƒªãƒ³ã‚°ã‚µãƒ¼ãƒ“ã‚¹ Datadogã«ã‚ˆã‚‹åˆ†æ•£ãƒˆãƒ¬ãƒ¼ã‚¹ã®ç›£è¦–ã«ã¤ã„ã¦ã¯ï¼Œä»¥ä¸‹ã®ãƒªãƒ³ã‚¯ã‚’å‚è€ƒã«ã›ã‚ˆï¼ å‚è€ƒï¼šhttps://hiroki-it.github.io/tech-notebook-gitbook/public/observability_monitering/observability_datadog_metrics.html "},"public/software/software_application_architecture_backend_domain_driven_design.html":{"url":"public/software/software_application_architecture_backend_domain_driven_design.html","title":"ğŸ“– ï¸ãƒ‰ãƒ¡ã‚¤ãƒ³é§†å‹•è¨­è¨ˆ","keywords":"","body":"ãƒ‰ãƒ¡ã‚¤ãƒ³é§†å‹•è¨­è¨ˆ ã¯ã˜ã‚ã« æœ¬ã‚µã‚¤ãƒˆã«ã¤ãã¾ã—ã¦ï¼Œä»¥ä¸‹ã‚’ã”èªè­˜ã®ã»ã©å®œã—ããŠé¡˜ã„ã„ãŸã—ã¾ã™ï¼ å‚è€ƒï¼šhttps://hiroki-it.github.io/tech-notebook-gitbook/ 01. ãƒ‰ãƒ¡ã‚¤ãƒ³é§†å‹•è¨­è¨ˆã®å…¨ä½“åƒ æˆ¦ç•¥çš„è¨­è¨ˆã®æ‰‹é † æˆ¦ç•¥çš„è¨­è¨ˆã§ã¯ï¼Œãƒ‰ãƒ¡ã‚¤ãƒ³å…¨ä½“ã‹ã‚‰å¢ƒç•Œä»˜ã‘ã‚‰ã‚ŒãŸã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã‚’æ˜ç¢ºã«ã™ã‚‹ï¼ å‚è€ƒï¼šhttps://qiita.com/crossroad0201/items/875c5f76ed3794ed56c4 ãƒ‰ãƒ¡ã‚¤ãƒ³ã‚¨ã‚­ã‚¹ãƒ‘ãƒ¼ãƒˆã¨è©±ã—åˆã„ï¼Œãƒ‰ãƒ¡ã‚¤ãƒ³å…¨ä½“ã®ä¸­ã‹ã‚‰ã‚³ã‚¢ãƒ‰ãƒ¡ã‚¤ãƒ³ã¨ã‚µãƒ–ãƒ‰ãƒ¡ã‚¤ãƒ³ã‚’åˆ‡ã‚Šåˆ†ã‘ã‚‹ï¼ ãƒ‰ãƒ¡ã‚¤ãƒ³ã‚¨ã‚­ã‚¹ãƒ‘ãƒ¼ãƒˆã®éƒ¨ç½²ã‚„æ¥­å‹™ãƒ•ãƒ­ãƒ¼ã®ç«‹ã¡ä½ç½®ã«ã‚ˆã£ã¦ã¯ï¼ŒåŒã˜ã€å˜èªã€ã‚„ã€å‹•è©ã€ã§ã‚ã£ã¦ã‚‚ï¼Œæ„å‘³åˆã„ï¼å®šç¾©ã¥ã‘ãŒç•°ãªã‚‹å ´åˆãŒã‚ã‚‹ï¼ã“ã®æ™‚ï¼Œãã‚Œãã‚Œã‚’åˆ¥ã€…ã®åå‰ã‹ã‚‰ãªã‚‹ãƒ¦ãƒ“ã‚­ã‚¿ã‚¹è¨€èªã¨ã—ã¦å®šç¾©ã¥ã‘ã‚‹ï¼ ãƒ¦ãƒ“ã‚­ã‚¿ã‚¹è¨€èªã‚’å…ƒã«ï¼Œå¢ƒç•Œä»˜ã‘ã‚‰ã‚ŒãŸã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã‚’å®šç¾©ã¥ã‘ã‚‹ï¼ ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆãƒãƒƒãƒ—ã‚’ä½œæˆã—ï¼Œå¢ƒç•Œä»˜ã‘ã‚‰ã‚ŒãŸã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆé–“ã®é–¢ä¿‚ã‚’æ˜ã‚‰ã‹ã«ã™ã‚‹ï¼ æˆ¦è¡“çš„è¨­è¨ˆã®æ‰‹é † æˆ¦è¡“çš„è¨­è¨ˆã§ã¯ï¼Œå¢ƒç•Œä»˜ã‘ã‚‰ã‚ŒãŸã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã‚’ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã‚„ãƒ‡ã‚¶ã‚¤ãƒ³ãƒ‘ã‚¿ãƒ¼ãƒ³ã«è½ã¨ã—è¾¼ã‚€ï¼ ãƒ‰ãƒ¡ã‚¤ãƒ³ã‚¨ã‚­ã‚¹ãƒ‘ãƒ¼ãƒˆã¨è©±ã—åˆã„ï¼Œå¢ƒç•Œä»˜ã‘ã‚‰ã‚ŒãŸã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã«å«ã¾ã‚Œã‚‹è¦ä»¶ã‚’ãƒ’ã‚¢ãƒªãƒ³ã‚°ã‚’è¡Œã†ï¼ã“ã®æ™‚ï¼Œãƒ“ã‚¸ãƒã‚¹ã®ãƒ«ãƒ¼ãƒ«ï¼åˆ¶ç´„ã‚’ååˆ†ã«ãƒ’ã‚¢ãƒªãƒ³ã‚°ã™ã‚‹ï¼ è¦ä»¶ã‹ã‚‰ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹å›³ã‚’ä½œæˆã™ã‚‹ï¼ã“ã®æ™‚ï¼Œã€ã‚·ã‚¹ãƒ†ãƒ ãŒï¼Œã€‡ã€‡ã‚’â–³â–³ã™ã‚‹ï¼ã€ã¨è€ƒãˆã‚‹ã¨ã‚ˆã„ï¼ é€šå¸¸ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆæŒ‡å‘åˆ†æï¼è¨­è¨ˆã§ã¯ï¼Œãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹å›³ã®å¾Œã«ã‚¯ãƒ©ã‚¹å›³ã‚’ä½œæˆã™ã‚‹ï¼ã—ã‹ã—ãƒ‰ãƒ¡ã‚¤ãƒ³é§†å‹•è¨­è¨ˆã§ã¯ï¼Œã‚¯ãƒ©ã‚¹å›³ä½œæˆã‚ˆã‚Šã‚‚å…ˆã«é›†ç´„ã®ç²’åº¦ã‚’æ˜ç¢ºåŒ–ã™ã‚‹ãŸã‚ã«ï¼Œãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹å›³ã‹ã‚‰ã€åè©ã€ã‚’æŠ½å‡ºã—ï¼Œã“ã‚Œã‚’ä¸€ã¤ã®ãƒ‰ãƒ¡ã‚¤ãƒ³ãƒ¢ãƒ‡ãƒ«ã¨ã—ãŸãƒ‰ãƒ¡ã‚¤ãƒ³ãƒ¢ãƒ‡ãƒ«å›³ã‚’ä½œæˆã™ã‚‹ï¼ãƒ‰ãƒ¡ã‚¤ãƒ³ãƒ¢ãƒ‡ãƒ«å›³ã§ã¯ï¼Œãƒ“ã‚¸ãƒã‚¹ã®ãƒ«ãƒ¼ãƒ«ï¼åˆ¶ç´„ã‚’å¹ãå‡ºã—ã«æ›¸ãè¾¼ã‚€ï¼å„ãƒ¢ãƒ‡ãƒ«ã®ãƒ«ãƒ¼ãƒ«ï¼åˆ¶ç´„ã«ä¾å­˜é–¢ä¿‚ãŒã‚ã‚Šï¼Œãƒ‡ãƒ¼ã‚¿ã‚’ã‚»ãƒƒãƒˆã§æ‰±ã†å¿…è¦ãŒã‚ã‚‹ã‚ˆã†ãªå ´åˆï¼Œã“ã‚Œã‚‰ã‚’ä¸€ã¤ã®é›†ç´„ã¨ã—ã¦å®šç¾©ã¥ã‘ã‚‹ã¨ã‚ˆã„ï¼ å¿…è¦ã§ã‚ã‚Œã°ãƒ‰ãƒ¡ã‚¤ãƒ³ã‚¨ã‚­ã‚¹ãƒ‘ãƒ¼ãƒˆã«å†ãƒ’ã‚¢ãƒªãƒ³ã‚°ã‚’è¡Œã„ï¼Œãƒ‰ãƒ¡ã‚¤ãƒ³ãƒ¢ãƒ‡ãƒ«å›³ã‚’æ”¹å–„ã™ã‚‹ï¼ ãƒ‰ãƒ¡ã‚¤ãƒ³ãƒ¢ãƒ‡ãƒ«å›³ã‚’å…ƒã«ï¼Œã‚¯ãƒ©ã‚¹å›³ã‚’ä½œæˆã™ã‚‹ï¼ã“ã®æ™‚ï¼Œãƒ¢ãƒ‡ãƒ«ã‚’ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã‚„å€¤ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’åˆ‡ã‚Šåˆ†ã‘ã‚‹ã‚ˆã†ã«ã™ã‚‹ï¼ ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ï¼ˆãƒ¬ã‚¤ãƒ¤ãƒ¼ãƒ‰å‹ï¼Œãƒ˜ã‚­ã‚µã‚´ãƒŠãƒ«å‹ï¼Œã‚ªãƒ‹ã‚ªãƒ³å‹ï¼Œã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ï¼‰ã‚’æ±ºã‚ï¼Œã‚¯ãƒ©ã‚¹å›³ã‚’å…ƒã«ãƒ‰ãƒ¡ã‚¤ãƒ³å±¤ã‚’å®Ÿè£…ã™ã‚‹ï¼ é‹ç”¨å¾Œã«å•é¡ŒãŒèµ·ã“ã£ãŸå ´åˆï¼Œãƒ¢ãƒ‡ãƒªãƒ³ã‚°ã‚’ä¿®æ­£ã™ã‚‹ï¼å ´åˆã«ã‚ˆã£ã¦ã¯ï¼Œãƒ‡ã‚¶ã‚¤ãƒ³ãƒ‘ã‚¿ãƒ¼ãƒ³ã«åˆ‡ã‚Šåˆ†ã‘ã‚‹ï¼ 02. æˆ¦ç•¥çš„è¨­è¨ˆ ãƒ‰ãƒ¡ã‚¤ãƒ³ ãƒ»ãƒ‰ãƒ¡ã‚¤ãƒ³ã¨ã¯ ãƒ“ã‚¸ãƒã‚¹ãƒ¢ãƒ‡ãƒ«å…¨ä½“ã§è¦‹ãŸæ™‚ã«ï¼Œã‚·ã‚¹ãƒ†ãƒ åŒ–ã®å¯¾è±¡ã¨ãªã‚‹éƒ¨åˆ†é ˜åŸŸã®ã“ã¨ï¼ãƒ“ã‚¸ãƒã‚¹ãƒ¢ãƒ‡ãƒ«å…¨ä½“ã‚’ã„ãã¤ã‹ã®ãƒ‰ãƒ¡ã‚¤ãƒ³ã‚’åˆ†å‰²ã™ã‚‹æ–¹æ³•ã¨ã—ã¦ï¼Œä¸€é€£ã®æ¥­å‹™ãƒ•ãƒ­ãƒ¼ã®ä¸­ã§ï¼Œæ¥­å‹™ã®æ‹…å½“è€…ã®å±æ€§ãŒå¤‰åŒ–ã™ã‚‹ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã«ç€ç›®ã™ã‚‹ã¨è‰¯ã„ï¼ ï¼Šä¾‹ï¼Š ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆåºƒå‘Šä»£ç†åº—ã®ä¾‹ï¼ãƒ“ã‚¸ãƒã‚¹ãƒ¢ãƒ‡ãƒ«ã«åŸºã¥ãè¤‡æ•°ã®ãƒ‰ãƒ¡ã‚¤ãƒ³ã‚’ç¤ºã™ï¼æ¥­å‹™ãƒ•ãƒ­ãƒ¼ã®æ‹…å½“è€…ã®å¤‰åŒ–ã¨ã—ã¦ï¼Œã¾ãšå•ã„åˆã‚ã›ã§æ³¨æ–‡ã‚’å—ã‘ã¦åºƒå‘Šã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’ä½œæˆã™ã‚‹ã€å–¶æ¥­æ‹…å½“è€…ã€ï¼Œåˆ¶ä½œã—ãŸåºƒå‘Šã‚’ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã«å…¥ç¨¿ã™ã‚‹ã€åˆ¶ä½œæ‹…å½“è€…ã€ï¼Œå…¥ç¨¿ã•ã‚ŒãŸåºƒå‘Šã‚’é‹ç”¨ã—ã¦åºƒå‘ŠåŠ¹æœã‚’é«˜ã‚ã‚‹ã€ãƒãƒ¼ã‚±ãƒ†ã‚£ãƒ³ã‚°æ‹…å½“è€…ã€ï¼Œæœ€å¾Œã«åºƒå‘Šã®ä¾é ¼è€…ã«æ–™é‡‘ã‚’è«‹æ±‚ã™ã‚‹ã€çµŒç†æ‹…å½“è€…ã€ãŒæŒ™ã’ã‚‰ã‚Œã‚‹ï¼ã“ã‚Œã«ã‚ˆã‚Šï¼Œã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆåºƒå‘Šä»£ç†åº—ã®ãƒ“ã‚¸ãƒã‚¹ãƒ¢ãƒ‡ãƒ«ã¯ï¼Œå„æ‹…å½“è€…ã«å¯¾å¿œã™ã‚‹ãƒ‰ãƒ¡ã‚¤ãƒ³ã«åˆ†å‰²ã§ãã‚‹ï¼ å‚è€ƒï¼šhttps://labs.septeni.co.jp/entry/2021/04/15/130000 ï¼Šä¾‹ï¼Š å®Œå…¨å€‹å®¤ã‚¸ãƒ ã‚’é‹å–¶ã™ã‚‹ãƒã‚³ã‚¸ãƒ ã®ä¾‹ï¼ãƒ“ã‚¸ãƒã‚¹ãƒ¢ãƒ‡ãƒ«ã«åŸºã¥ãè¤‡æ•°ã®ãƒ‰ãƒ¡ã‚¤ãƒ³ã‚’ç¤ºã™ï¼æ¥­å‹™ãƒ•ãƒ­ãƒ¼ã®æ‹…å½“è€…ã®å¤‰åŒ–ã¨ã—ã¦ï¼Œã¾ãšå€‹å®¤ã‚¸ãƒ ã«é©ã™ã‚‹ç‰©ä»¶ã‚’æ¢ã™ã€ç‰©ä»¶æ‹…å½“è€…ã€ï¼Œã‚¸ãƒ ã®ãƒˆãƒ¬ãƒ¼ãƒŠãƒ¼ã‚’æ¡ç”¨ã—ã¦ä¼šå“¡ã«ç´¹ä»‹ã™ã‚‹ã€æ¡ç”¨æ‹…å½“è€…ã€ï¼Œå€‹å®¤ã‚¸ãƒ ã®åˆ©ç”¨ä¼šå“¡ã‚’ç²å¾—ã™ã‚‹ã€å–¶æ¥­æ‹…å½“è€…ã€ãŒæŒ™ã’ã‚‰ã‚Œã‚‹ï¼ã“ã‚Œã«ã‚ˆã‚Šï¼Œãƒã‚³ã‚¸ãƒ ã®ãƒ“ã‚¸ãƒã‚¹ãƒ¢ãƒ‡ãƒ«ã¯ï¼Œå„æ‹…å½“è€…ã«å¯¾å¿œã™ã‚‹ãƒ‰ãƒ¡ã‚¤ãƒ³ã«åˆ†å‰²ã§ãã‚‹ï¼ å‚è€ƒï¼š https://hacogym.jp/ https://zenn.dev/hsshss/articles/e11efefc7011ab ã‚³ã‚¢ãƒ‰ãƒ¡ã‚¤ãƒ³ï¼Œã‚µãƒ–ãƒ‰ãƒ¡ã‚¤ãƒ³ï¼Œãƒ‰ãƒ¡ã‚¤ãƒ³ã‚¨ã‚­ã‚¹ãƒ‘ãƒ¼ãƒˆ ãƒ»ã‚³ã‚¢ãƒ‰ãƒ¡ã‚¤ãƒ³ï¼Œã‚µãƒ–ãƒ‰ãƒ¡ã‚¤ãƒ³ï¼Œãƒ‰ãƒ¡ã‚¤ãƒ³ã‚¨ã‚­ã‚¹ãƒ‘ãƒ¼ãƒˆã¨ã¯ å„ãƒ‰ãƒ¡ã‚¤ãƒ³ã®ãƒ‰ãƒ¡ã‚¤ãƒ³ã‚¨ã‚­ã‚¹ãƒ‘ãƒ¼ãƒˆï¼ˆãƒ“ã‚¸ãƒã‚¹ãƒ«ãƒ¼ãƒ«ã«è©³ã—ã„äººï¼‰ã¨ï¼Œã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ãŒè©±ã—åˆã„ãªãŒã‚‰ï¼Œãƒ‰ãƒ¡ã‚¤ãƒ³å†…ã®ä¸»è¦æ¥­å‹™ã‚’ã‚³ã‚¢ãƒ‰ãƒ¡ã‚¤ãƒ³ï¼Œè£œåŠ©çš„ãªæ¥­å‹™ã‚’ã‚µãƒ–ãƒ‰ãƒ¡ã‚¤ãƒ³ã«åˆ†é¡ã™ã‚‹ï¼ å‚è€ƒï¼š https://qiita.com/crossroad0201/items/875c5f76ed3794ed56c4 https://labs.septeni.co.jp/entry/2021/04/15/130000 ï¼Šä¾‹ï¼Š å®Œå…¨å€‹å®¤ã‚¸ãƒ ã‚’é‹å–¶ã™ã‚‹ãƒã‚³ã‚¸ãƒ ã®ä¾‹ï¼ãƒ‰ãƒ¡ã‚¤ãƒ³ã®ã†ã¡ã§ï¼Œå€‹å®¤ã‚¸ãƒ ãƒ‰ãƒ¡ã‚¤ãƒ³ã«åŸºã¥ãã‚³ã‚¢ãƒ‰ãƒ¡ã‚¤ãƒ³ã¨ã‚µãƒ–ãƒ‰ãƒ¡ã‚¤ãƒ³ã‚’ç¤ºã™ï¼ã‚³ã‚¢ãƒ‰ãƒ¡ã‚¤ãƒ³ã¯äºˆç´„ãƒ‰ãƒ¡ã‚¤ãƒ³ï¼Œãã‚Œä»¥å¤–ã¯ã‚µãƒ–ãƒ‰ãƒ¡ã‚¤ãƒ³ã¨ã—ã¦ã„ã‚‹ï¼ å‚è€ƒï¼š https://hacogym.jp/ https://zenn.dev/hsshss/articles/e11efefc7011ab ï¼Šä¾‹ï¼Š ECã‚µã‚¤ãƒˆã‚’é‹å–¶ã™ã‚‹ã‚¢ã‚¹ã‚¯ãƒ«ã®ä¾‹ï¼ãƒ‰ãƒ¡ã‚¤ãƒ³ã®ã†ã¡ã§ï¼Œå€‹äººå‘ã‘è²©å£²ãƒ‰ãƒ¡ã‚¤ãƒ³ï¼ˆã‚µã‚¤ãƒˆåã¯LOHACOï¼‰ã«åŸºã¥ãã‚µãƒ–ãƒ‰ãƒ¡ã‚¤ãƒ³ã‚’ç¤ºã™ï¼é…é€ï¼æ³¨æ–‡ï¼å•†å“ï¼ãƒ¦ãƒ¼ã‚¶ç®¡ç†ï¼åœ¨åº«ï¼å—æ³¨ã‚’ãã‚Œãã‚Œã‚µãƒ–ãƒ‰ãƒ¡ã‚¤ãƒ³ã¨ã—ã¦ã„ã‚‹ï¼ˆã‚³ã‚¢ãƒ‰ãƒ¡ã‚¤ãƒ³ã¯æ˜è¨€ã•ã‚Œã¦ã„ãªã„ï¼‰ï¼ å‚è€ƒï¼šhttps://speakerdeck.com/askul/ddd-and-clean-architecture-at-lohaco?slide=28 ãƒ¦ãƒ“ã‚­ã‚¿ã‚¹è¨€èªï¼Œå¢ƒç•Œä»˜ã‘ã‚‰ã‚ŒãŸã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆ ãƒ»ãƒ¦ãƒ“ã‚­ã‚¿ã‚¹è¨€èªã¨ã¯ ãƒ‰ãƒ¡ã‚¤ãƒ³ã‚¨ã‚­ã‚¹ãƒ‘ãƒ¼ãƒˆé–“ã§ï¼Œç‰¹å®šã®ã€å˜èªã€ã‚„ã€å‹•è©ã€ã®æ„å‘³åˆã„ï¼å®šç¾©ã¥ã‘ãŒç•°ãªã‚‹å ´åˆï¼Œã“ã‚Œã‚’åˆ¥ã€…ã®åå‰ã‹ã‚‰ãªã‚‹ãƒ¦ãƒ“ã‚­ã‚¿ã‚¹è¨€èªã¨ã—ã¦å®šç¾©ã¥ã‘ã‚‹ï¼ å‚è€ƒï¼šhttps://qiita.com/kmdsbng/items/bf415afbeec239a7fd63 ãƒ»å¢ƒç•Œä»˜ã‘ã‚‰ã‚ŒãŸã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã¨ã¯ ãƒ‰ãƒ¡ã‚¤ãƒ³ã‚¨ã‚­ã‚¹ãƒ‘ãƒ¼ãƒˆã®æ¥­å‹™ãƒ•ãƒ­ãƒ¼ã®ç«‹ã¡ä½ç½®ãŒç•°ãªã‚Œã°ï¼ŒåŒã˜ã€å˜èªã€ã‚„ã€å‹•è©ã€ã§ã‚ã£ã¦ã‚‚ï¼Œç•°ãªã‚‹æ„å‘³åˆã„ï¼å®šç¾©ã¥ã‘ã®ãƒ¦ãƒ“ã‚­ã‚¿ã‚¹è¨€èªãŒä½¿ç”¨ã•ã‚Œã‚‹ï¼ç•°ãªã‚‹ãƒ¦ãƒ“ã‚­ã‚¿ã‚¹è¨€èªã‚’å…ƒã«ã—ã¦ï¼Œå¢ƒç•Œä»˜ã‘ã‚‰ã‚ŒãŸã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã‚’å®šç¾©ã™ã‚‹ï¼ã“ã®æ™‚ï¼Œãƒ¦ãƒ“ã‚­ã‚¿ã‚¹è¨€èªã¯ï¼Œä»–ã®å¢ƒç•Œä»˜ã‘ã‚‰ã‚ŒãŸã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã§ã¯é€šã˜ãªã„ã‚‚ã®ã§ã‚ã‚Œã°ã‚ã‚‹ã»ã©ã‚ˆã„ï¼å¢ƒç•Œä»˜ã‘ã‚‰ã‚ŒãŸã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆãã‚Œãã‚Œã®ãƒ¦ãƒ“ã‚­ã‚¿ã‚¹è¨€èªã«åˆã‚ã›ã¦ï¼Œç•°ãªã‚‹åå‰ã§ãƒ¢ãƒ‡ãƒªãƒ³ã‚°ã—ã¦ã„ãï¼å¢ƒç•Œä»˜ã‘ã‚‰ã‚ŒãŸã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã‚’å®šç¾©ã—ãªã„å ´åˆï¼Œç•°ãªã‚‹ãƒ¦ãƒ“ã‚­ã‚¿ã‚¹è¨€èªã‚’ã‚³ã‚¢ãƒ‰ãƒ¡ã‚¤ãƒ³ã‚„ã‚µãƒ–ãƒ‰ãƒ¡ã‚¤ãƒ³é–“ã§å…±æœ‰ã™ã‚‹ã“ã¨ã¨ãªã‚Šï¼Œãã‚Œãã‚Œã®é–¢å¿ƒã«ç„¡é–¢ä¿‚ãªãƒ‡ãƒ¼ã‚¿ã‚’ä¿æŒã™ã‚‹ã“ã¨ã«ãªã£ã¦ã—ã¾ã†ï¼ ï¼Šä¾‹ï¼Š æœ¬ã‚’è²©å£²ã™ã‚‹ECã‚µã‚¤ãƒˆã®ä¾‹ï¼ã‚³ã‚¢ãƒ‰ãƒ¡ã‚¤ãƒ³ã¨ã‚µãƒ–ãƒ‰ãƒ¡ã‚¤ãƒ³ã«åŸºã¥ã„ãŸãƒ¦ãƒ“ã‚­ã‚¿ã‚¹è¨€èªã¨å¢ƒç•Œä»˜ã‘ã‚‰ã‚ŒãŸã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã‚’ç¤ºã™ï¼ãƒã‚¤ãƒ¤ãƒ¼ï¼ˆä»•å…¥ã‚Œï¼‰éƒ¨ï¼Œãƒãƒ¼ã‚±ãƒ†ã‚£ãƒ³ã‚°éƒ¨ï¼Œåœ¨åº«ç®¡ç†éƒ¨ã®ãƒ‰ãƒ¡ã‚¤ãƒ³ã‚¨ã‚­ã‚¹ãƒ‘ãƒ¼ãƒˆã¯ï¼Œã€æœ¬ï¼ˆå•†å“ï¼‰ã€ã¨ã„ã†å˜èªã«å¯¾ã™ã‚‹æ„å‘³åˆã„ï¼å®šç¾©ã¥ã‘ãŒç•°ãªã‚‹ï¼ãã®ãŸã‚ï¼Œãã‚Œãã‚Œã‚’ã€æœ¬ã€ã€ã‚¯ãƒ¼ãƒãƒ³ã€ã€åœ¨åº«ã€ã¨ã„ã†ãƒ¦ãƒ“ã‚­ã‚¿ã‚¹è¨€èªã¨ã—ã¦å®šç¾©ã§ãï¼Œãƒ¢ãƒ‡ãƒ«åï¼ãƒ‡ãƒ¼ã‚¿åã¯ãã‚Œãã‚Œã®ãƒ¦ãƒ“ã‚­ã‚¿ã‚¹è¨€èªã«åˆã‚ã›ãŸåå‰ã«ãªã‚‹ï¼ä¾‹ãˆã°ï¼Œãƒãƒ¼ã‚±ã®å¢ƒç•Œä»˜ã‘ã‚‰ã‚ŒãŸã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã§ã¯ï¼Œãƒ¢ãƒ‡ãƒ«åã¯Couponã¨ãªã‚Šï¼Œå‰²å¼•æœŸé–“ãƒ‡ãƒ¼ã‚¿ã‚’ä¿æŒã™ã‚‹å¿…è¦ãŒã‚ã‚‹ãŒï¼Œä»•å…¥éƒ¨ã‚„åœ¨åº«éƒ¨ã§ã¯ã“ã®ãƒ‡ãƒ¼ã‚¿ã¯ä¸è¦ã§ã‚ã‚‹ï¼ä¸€æ–¹ï¼ŒISBNã¯å…¨ã¦ã®å¢ƒç•Œä»˜ã‘ã‚‰ã‚ŒãŸã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã®ãƒ¢ãƒ‡ãƒ«ã«å¿…è¦ãªãƒ‡ãƒ¼ã‚¿ã§ã‚ã‚‹ï¼å¢ƒç•Œä»˜ã‘ã‚‰ã‚ŒãŸã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã‚’å®šç¾©ã—ãªã„å ´åˆï¼Œä¸€ã¤ã®å•†å“ãƒ¢ãƒ‡ãƒ«ãŒå…¨ã¦ã®ãƒ‡ãƒ¼ã‚¿ã‚’ä¿æŒã™ã‚‹ã“ã¨ã¨ãªã‚Šï¼Œãã‚Œãã‚Œã®ãƒ‰ãƒ¡ã‚¤ãƒ³ã‚¨ã‚­ã‚¹ãƒ‘ãƒ¼ãƒˆãŒé–¢å¿ƒã‚’æŒãŸãªã„ãƒ‡ãƒ¼ã‚¿ã‚‚ä¿æŒã™ã‚‹ã“ã¨ã«ãªã£ã¦ã—ã¾ã†ï¼ å‚è€ƒï¼šhttps://kenta-kosugi.medium.com/%E3%83%9E%E3%82%A4%E3%82%AF%E3%83%AD%E3%82%B5%E3%83%BC%E3%83%93%E3%82%B9%E3%81%AE%E4%B8%8A%E6%89%8B%E3%81%AA%E5%88%86%E5%89%B2-ff5bb01d1062 ï¼Šä¾‹ï¼Š å®Œå…¨å€‹å®¤ã‚¸ãƒ ã‚’é‹å–¶ã™ã‚‹ãƒã‚³ã‚¸ãƒ ã®ä¾‹ï¼å€‹å®¤ã‚¸ãƒ ãƒ‰ãƒ¡ã‚¤ãƒ³ã®ã‚³ã‚¢ãƒ‰ãƒ¡ã‚¤ãƒ³ã¨ã‚µãƒ–ãƒ‰ãƒ¡ã‚¤ãƒ³ã«åŸºã¥ãå¢ƒç•Œä»˜ã‘ã‚‰ã‚ŒãŸã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆï¼èªè¨¼ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆï¼Œäºˆç´„ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆï¼Œé¡§å®¢ç®¡ç†ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆï¼ŒéŠ€è¡Œæ”¯æ‰•ã„ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆï¼Œã‚¯ãƒ¬ã‚¸ãƒƒãƒˆã‚«ãƒ¼ãƒ‰æ”¯æ‰•ã„ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆãŒã‚ã‚‹ï¼ å‚è€ƒï¼š https://hacogym.jp/ https://zenn.dev/hsshss/articles/e11efefc7011ab ï¼Šä¾‹ï¼Š å¥‘ç´„è«‹æ±‚ç®¡ç†ã‚¢ãƒ—ãƒªã‚’æä¾›ã™ã‚‹ã‚¢ãƒ«ãƒ—ã®ä¾‹ï¼ã‚³ã‚¢ãƒ‰ãƒ¡ã‚¤ãƒ³ã¨ã‚µãƒ–ãƒ‰ãƒ¡ã‚¤ãƒ³ã«åŸºã¥ã„ãŸãƒ¦ãƒ“ã‚­ã‚¿ã‚¹è¨€èªã¨å¢ƒç•Œä»˜ã‘ã‚‰ã‚ŒãŸã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã‚’ç¤ºã™ï¼å¥‘ç´„ç®¡ç†ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆï¼Œå•†å“ç®¡ç†ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆï¼Œè«‹æ±‚ç®¡ç†ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆï¼ŒãŒã‚ã‚‹ï¼å–ã‚Šçµ„ã¿ã¨ã—ã¦ï¼Œé€±æ¬¡ã§ãƒ¦ãƒ“ã‚­ã‚¿ã‚¹è¨€èªã®æ›´æ–°ã‚’è¡Œã£ã¦ã„ã‚‹ï¼ å‚è€ƒï¼š https://note.com/alpinc/n/nab47ab9273c6 https://thealp.co.jp/ ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆãƒãƒƒãƒ— ãƒ»ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆãƒãƒƒãƒ—ã¨ã¯ åºƒç¾©ã®ãƒ‰ãƒ¡ã‚¤ãƒ³å…¨ä½“ã®ä¿¯ç°ã™ã‚‹å›³ã®ã“ã¨ï¼ã‚³ã‚¢ãƒ‰ãƒ¡ã‚¤ãƒ³ï¼Œã‚µãƒ–ãƒ‰ãƒ¡ã‚¤ãƒ³ï¼Œå¢ƒç•Œä»˜ã‘ã‚‰ã‚ŒãŸã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã‚’å®šç¾©ã—ãŸå¾Œï¼Œã“ã‚Œã‚‰ã®é–¢ä¿‚æ€§ã‚’è¦–è¦šåŒ–ã™ã‚‹ï¼ç•°ãªã‚‹ã‚µãƒ–ãƒ‰ãƒ¡ã‚¤ãƒ³ã®é–“ã§ç•°ãªã‚‹ãƒ¦ãƒ“ã‚­ã‚¿ã‚¹è¨€èªã‚’ä½¿ç”¨ã™ã‚‹å ´åˆï¼Œå¢ƒç•Œä»˜ã‘ã‚‰ã‚ŒãŸã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã¯ã‚µãƒ–ãƒ‰ãƒ¡ã‚¤ãƒ³ã‚’ã¾ãŸãŒãªã„ï¼ä¸€æ–¹ã§ï¼ŒåŒã˜ãƒ¦ãƒ“ã‚­ã‚¿ã‚¹è¨€èªã‚’ä½¿ç”¨ã™ã‚‹å ´åˆï¼Œå¢ƒç•Œä»˜ã‘ã‚‰ã‚ŒãŸã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã¯è¤‡æ•°ã®ã‚µãƒ–ãƒ‰ãƒ¡ã‚¤ãƒ³ã«ã¾ãŸãŒã‚‹ï¼å¯èƒ½ãªé™ã‚Šï¼Œå„å¢ƒç•Œä»˜ã‘ã‚‰ã‚ŒãŸã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã§ã¯ç•°ãªã‚‹ãƒ¦ãƒ“ã‚­ã‚¿ã‚¹è¨€èªã‚’ä½¿ç”¨ã—ï¼Œå¢ƒç•Œä»˜ã‘ã‚‰ã‚ŒãŸã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆãŒè¤‡æ•°ã®ã‚µãƒ–ãƒ‰ãƒ¡ã‚¤ãƒ³ã«ã¾ãŸãŒãªã„ã‚ˆã†ã«ã—ãŸæ–¹ãŒè‰¯ã„ï¼ˆã“ã‚Œé‡è¦ï¼‰ï¼ å‚è€ƒï¼šhttps://qiita.com/crossroad0201/items/875c5f76ed3794ed56c4 ï¼Šä¾‹ï¼Š å®Œå…¨å€‹å®¤ã‚¸ãƒ ã‚’é‹å–¶ã™ã‚‹ãƒã‚³ã‚¸ãƒ ã®ä¾‹ï¼å€‹å®¤ã‚¸ãƒ ãƒ‰ãƒ¡ã‚¤ãƒ³ã®ãã‚Œãã‚Œã®å¢ƒç•Œä»˜ã‘ã‚‰ã‚ŒãŸã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã«åŸºã¥ããƒ¢ãƒ‡ãƒªãƒ³ã‚°ï¼ã‚³ã‚¢ãƒ‰ãƒ¡ã‚¤ãƒ³ã®äºˆç´„ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã¨ã‚¹ãƒãƒ¼ãƒˆãƒ­ãƒƒã‚¯ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã¯ï¼Œä¸€ã¤ã®ãƒã‚¤ã‚¯ãƒ­ã‚µãƒ¼ãƒ“ã‚¹ã¨ã—ã¦å†…è£½åŒ–ã—ã¦ã„ã‚‹ï¼ä¸€æ–¹ã§ï¼Œãã‚Œä»¥å¤–ã®å¢ƒç•Œä»˜ã‘ã‚‰ã‚ŒãŸã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã¯å¤–è£½åŒ–ã—ã¦ã„ã‚‹ï¼ 03. æˆ¦è¡“çš„è¨­è¨ˆ MVCã‹ã‚‰ãƒ¬ã‚¤ãƒ¤ãƒ¼ãƒ‰ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã¸ã®å¤‰é· ãƒ»MVCã¨å•é¡Œç‚¹ ãƒ‰ãƒ¡ã‚¤ãƒ³é§†å‹•è¨­è¨ˆãŒè€ƒæ¡ˆã•ã‚Œã‚‹ä»¥å‰ï¼ŒMVCã®è€ƒãˆæ–¹ãŒä¸»æµã§ã‚ã£ãŸï¼ã—ã‹ã—ï¼Œç‰¹ã«Modelã®å½¹å‰²ãŒæŠ½è±¡çš„éããŸãŸã‚ï¼Œé–‹ç™ºè¦æ¨¡ãŒå¤§ãããªã‚‹ã«ã¤ã‚Œã¦ï¼ŒModelã«å½¹å‰²ã‚’é›†ä¸­ã•ã›éãã¦ã—ã¾ã†ã“ã¨ãŒã‚ã£ãŸï¼ ãƒ»MVCã‹ã‚‰ãƒ¬ã‚¤ãƒ¤ãƒ¼ãƒ‰ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã¸ã®ç§»è¡Œ ãƒ‰ãƒ¡ã‚¤ãƒ³é§†å‹•è¨­è¨ˆãŒç™»å ´ã—ãŸã“ã¨ã«ã‚ˆã£ã¦ï¼ŒMVCã¯ç™ºå±•ã—ï¼ŒMãƒ»Vãƒ»Cãã‚Œãã‚Œã®å½¹å‰²ãŒã‚ˆã‚Šå…·ä½“çš„ã§ç²¾å¯†ã«ãªã£ãŸï¼Modelã®è‚¥å¤§åŒ–ã¯ï¼ŒModelãŒã‚‚ã¤ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ã‚’ãƒ‰ãƒ¡ã‚¤ãƒ³å±¤ï¼Œã¾ãŸCRUDå‡¦ç†ã‚’ã‚¤ãƒ³ãƒ•ãƒ©ã‚¹ãƒˆãƒ©ã‚¯ãƒãƒ£å±¤ã¨ã—ã¦åˆ†å‰²ã™ã‚‹ã“ã¨ã«ã‚ˆã£ã¦ï¼Œå¯¾å‡¦ã•ã‚ŒãŸï¼ DDDã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ ãƒ»ãƒ¬ã‚¤ãƒ¤ãƒ¼ãƒ‰ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ æœ€åˆã«è€ƒæ¡ˆã•ã‚ŒãŸå®Ÿç¾æ–¹æ³•ï¼ å‚è€ƒï¼šhttps://www.amazon.co.jp/dp/4798121967/ref=cm_sw_r_tw_dp_ZD0VGXSNQMNZF7K1ME8J?_encoding=UTF8&psc=1 ãƒ»ãƒ˜ã‚­ã‚µã‚´ãƒŠãƒ«ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ åˆ¥åã€ãƒãƒ¼ãƒˆã‚¢ãƒ³ãƒ‰ã‚¢ãƒ€ãƒ—ã‚¿ãƒ¼ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã€ã¨ã„ã†ï¼ãƒ¬ã‚¤ãƒ¤ãƒ¼ãƒ‰ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã®ã‚¤ãƒ³ãƒ•ãƒ©ã‚¹ãƒˆãƒ©ã‚¯ãƒãƒ£å±¤ã«å¯¾ã—ã¦ï¼Œä¾å­˜æ€§é€†è»¢ã‚’çµ„ã¿è¾¼ã‚“ã ã‚‚ã®ï¼ãƒ‰ãƒ¡ã‚¤ãƒ³å±¤ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã¯ï¼Œãƒ‰ãƒ¡ã‚¤ãƒ³å±¤ã®ä»–ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã«ä¾å­˜ã™ã‚‹ä»¥å¤–ï¼Œä½•ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã«ã‚‚å¤–éƒ¨ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã«ã‚‚ä¾å­˜ã—ãªã„ï¼é€†ã«è€ƒãˆã‚Œã°ï¼Œã“ã‚Œã‚‰ã«ä¾å­˜ã™ã‚‹ã‚‚ã®ã¯ãƒ‰ãƒ¡ã‚¤ãƒ³å±¤ã«ç½®ãã¹ãã§ã¯ãªã„ã¨åˆ¤æ–­ã§ãã‚‹ï¼æœ¬è³ªçš„ã«ã¯ï¼Œä»–ã®ã€ã‚ªãƒ‹ã‚ªãƒ³ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã€ã€ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã€ã«åŒã˜ã§ã‚ã‚‹ï¼ å‚è€ƒï¼šhttps://www.amazon.co.jp/dp/B00UX9VJGW/ref=cm_sw_r_tw_dp_S20HJ24MHWTSED7T0ZCP ãƒ»ã‚ªãƒ‹ã‚ªãƒ³ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ ãƒ¬ã‚¤ãƒ¤ãƒ¼ãƒ‰ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã®ã‚¤ãƒ³ãƒ•ãƒ©ã‚¹ãƒˆãƒ©ã‚¯ãƒãƒ£å±¤ã«å¯¾ã—ã¦ï¼Œä¾å­˜æ€§é€†è»¢ã‚’çµ„ã¿è¾¼ã‚“ã ã‚‚ã®ï¼ãƒ‰ãƒ¡ã‚¤ãƒ³å±¤ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã¯ï¼Œãƒ‰ãƒ¡ã‚¤ãƒ³å±¤ã®ä»–ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã«ä¾å­˜ã™ã‚‹ä»¥å¤–ï¼Œä½•ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã«ã‚‚å¤–éƒ¨ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã«ã‚‚ä¾å­˜ã—ãªã„ï¼é€†ã«è€ƒãˆã‚Œã°ï¼Œã“ã‚Œã‚‰ã«ä¾å­˜ã™ã‚‹ã‚‚ã®ã¯ãƒ‰ãƒ¡ã‚¤ãƒ³å±¤ã«ç½®ãã¹ãã§ã¯ãªã„ã¨åˆ¤æ–­ã§ãã‚‹ï¼æœ¬è³ªçš„ã«ã¯ï¼Œä»–ã®ã€ãƒ˜ã‚­ã‚µã‚´ãƒŠãƒ«ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã€ã€ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã€ã«åŒã˜ã§ã‚ã‚‹ï¼ å‚è€ƒï¼š https://jeffreypalermo.com/2008/07/the-onion-architecture-part-1/ https://little-hands.hatenablog.com/entry/2017/10/11/075634 ãƒ»ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ ãƒ¬ã‚¤ãƒ¤ãƒ¼ãƒ‰ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã®ã‚¤ãƒ³ãƒ•ãƒ©ã‚¹ãƒˆãƒ©ã‚¯ãƒãƒ£å±¤ã«å¯¾ã—ã¦ï¼Œä¾å­˜æ€§é€†è»¢ã‚’çµ„ã¿è¾¼ã‚“ã ã‚‚ã®ï¼ãƒ‰ãƒ¡ã‚¤ãƒ³å±¤ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã¯ï¼Œãƒ‰ãƒ¡ã‚¤ãƒ³å±¤ã®ä»–ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã«ä¾å­˜ã™ã‚‹ä»¥å¤–ï¼Œä½•ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã«ã‚‚å¤–éƒ¨ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã«ã‚‚ä¾å­˜ã—ãªã„ï¼é€†ã«è€ƒãˆã‚Œã°ï¼Œã“ã‚Œã‚‰ã«ä¾å­˜ã™ã‚‹ã‚‚ã®ã¯ãƒ‰ãƒ¡ã‚¤ãƒ³å±¤ã«ç½®ãã¹ãã§ã¯ãªã„ã¨åˆ¤æ–­ã§ãã‚‹ï¼æœ¬è³ªçš„ã«ã¯ï¼Œä»–ã®ã€ãƒ˜ã‚­ã‚µã‚´ãƒŠãƒ«ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã€ã€ã‚ªãƒ‹ã‚ªãƒ³ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã€ã«åŒã˜ã§ã‚ã‚‹ï¼ å‚è€ƒï¼šhttps://blog.cleancoder.com/uncle-bob/2012/08/13/the-clean-architecture.html DDDãƒ‡ã‚¶ã‚¤ãƒ³ãƒ‘ã‚¿ãƒ¼ãƒ³ ãƒ»DDDãƒ‡ã‚¶ã‚¤ãƒ³ãƒ‘ã‚¿ãƒ¼ãƒ³é›† å‚è€ƒï¼šhttps://www.ogis-ri.co.jp/otc/hiroba/technical/DDDEssence/chap1.html ãƒ‰ãƒ¡ã‚¤ãƒ³ãƒ¢ãƒ‡ãƒ« ãƒ»ã‚³ã‚¢ãƒ‰ãƒ¡ã‚¤ãƒ³ã¨ã‚µãƒ–ãƒ‰ãƒ¡ã‚¤ãƒ³ã®ãƒ¢ãƒ‡ãƒ«åŒ– ã‚³ã‚¢ãƒ‰ãƒ¡ã‚¤ãƒ³ã¨ã‚µãƒ–ãƒ‰ãƒ¡ã‚¤ãƒ³ã‚’å¯¾è±¡ã¨ã—ã¦ï¼Œå¢ƒç•Œä»˜ã‘ã‚‰ã‚ŒãŸã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆå†…ã®ãƒ¦ãƒ“ã‚­ã‚¿ã‚¹è¨€èªã«åŸºã¥ã„ã¦ãƒ‰ãƒ¡ã‚¤ãƒ³ãƒ¢ãƒ‡ãƒ«ã‚’è¨­è¨ˆã™ã‚‹ï¼ã‚³ã‚¢ãƒ‰ãƒ¡ã‚¤ãƒ³ã®ã‚·ã‚¹ãƒ†ãƒ ã¯å†…è£½ã§ã‚ã‚‹å¿…è¦ãŒã‚ã‚‹ãŒï¼Œã‚µãƒ–ãƒ‰ãƒ¡ã‚¤ãƒ³ã®ã‚·ã‚¹ãƒ†ãƒ ã¯å¤–è£½ï¼å†…è£½ã®ã„ãšã‚Œã§ã‚‚å•é¡Œãªã„ï¼ å‚è€ƒï¼šhttps://qiita.com/crossroad0201/items/875c5f76ed3794ed56c4 ãƒ»ãƒ‰ãƒ¡ã‚¤ãƒ³ãƒ¢ãƒ‡ãƒ«å›³ ã‚¯ãƒ©ã‚¹å›³ã‚ˆã‚Šã‚‚å…ˆã«ä½œæˆã—ï¼Œã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆé–“ã®Aggregationï¼ˆé›†ç´„ï¼‰ã®ç²’åº¦ã‚’æ˜ç¢ºã«ã™ã‚‹ï¼ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹å›³ã‹ã‚‰ã€åè©ã€ã‚’æŠ½å‡ºã—ï¼Œã“ã‚Œã‚’ãƒ‰ãƒ¡ã‚¤ãƒ³ãƒ¢ãƒ‡ãƒ«ã¨ã—ã¦ï¼Œã‚¯ãƒ©ã‚¹å›³ã¨åŒã˜ã‚ˆã†ã«ãƒ‰ãƒ¡ã‚¤ãƒ³ãƒ¢ãƒ‡ãƒ«é–“ã®é–¢ä¿‚ã‚’è¡¨ç¾ã™ã‚‹ï¼ãŸã ã—ï¼Œã‚¯ãƒ©ã‚¹å›³ã¨ã¯ç•°ãªã‚Šï¼Œã‚¯ãƒ©ã‚¹ã®ãƒ¡ã‚½ãƒƒãƒ‰ã¯çœç•¥ã—ï¼Œä¿æŒã™ã‚‹ãƒ‡ãƒ¼ã‚¿ã®ã¿ã«æ³¨ç›®ã™ã‚‹ï¼ãƒ‰ãƒ¡ã‚¤ãƒ³ãƒ¢ãƒ‡ãƒ«ã‚’æ—¥æœ¬èªã§è¡¨ç¾ã—ã¦ã‚ˆã„ï¼ãƒ‰ãƒ¡ã‚¤ãƒ³ãƒ¢ãƒ‡ãƒ«å›³ã®ä½œæˆæ‰‹é †ã«ã¤ã„ã¦ã¯ï¼Œä»¥ä¸‹ã‚’å‚è€ƒã«ã›ã‚ˆï¼ å‚è€ƒï¼š https://www.eureka-moments-blog.com/entry/2018/12/29/145802 https://github.com/ShisatoYano/PlantUML/blob/master/DomainModelDiagram/DomainModelDiagram.pdf "},"public/software/software_application_architecture_backend_domain_driven_design_clean_architecture.html":{"url":"public/software/software_application_architecture_backend_domain_driven_design_clean_architecture.html","title":"ğŸ“– ï¸ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£","keywords":"","body":"ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ ã¯ã˜ã‚ã« æœ¬ã‚µã‚¤ãƒˆã«ã¤ãã¾ã—ã¦ï¼Œä»¥ä¸‹ã‚’ã”èªè­˜ã®ã»ã©å®œã—ããŠé¡˜ã„ã„ãŸã—ã¾ã™ï¼ å‚è€ƒï¼šhttps://hiroki-it.github.io/tech-notebook-gitbook/ 01. ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£æ¦‚è¦ ãƒ»æ€æƒ³ DDDãŒé©ã™ã‚‹æ©Ÿèƒ½è¦ä»¶ã®å¤šã„ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã ã‘ã§ãªãï¼Œã‚ã‚‰ã‚†ã‚‹ç¨®é¡ã®ã‚·ã‚¹ãƒ†ãƒ ã«é©ç”¨ã§ãã‚‹ï¼ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£åŸè‘—ã®åºæ–‡ã«ã¦ï¼Œè‘—è€…ã¯ã€ç§ã¯ï¼Œä»Šã¾ã§è‰²ã€…ãªç¨®é¡ã®ã‚·ã‚¹ãƒ†ãƒ ã‚’ä½œã£ã¦ããŸãŒï¼Œã©ã®ã‚·ã‚¹ãƒ†ãƒ ã‚‚ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã‚‚ãƒ«ãƒ¼ãƒ«ã¯åŒã˜ã ã£ãŸï¼ç•°ãªã‚‹ã‚·ã‚¹ãƒ†ãƒ ã§ã‚‚åŒã˜ãƒ«ãƒ¼ãƒ«ã‚’å…±æœ‰ã™ã‚‹å¿…è¦ãŒã‚ã‚‹ã€ã¨ã„ã†ã‚ˆã†ãªã“ã¨ã‚’è¿°ã¹ã¦ã„ã‚‹ï¼ å‚è€ƒï¼šhttps://www.amazon.co.jp/dp/B07FSBHS2V ãƒ»æ§‹æˆ å‚è€ƒï¼šhttps://blog.cleancoder.com/uncle-bob/2012/08/13/the-clean-architecture.html 02. ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹å±¤ï¼ˆé»„ç·‘ï¼‰ ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ© ãƒ»ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ã¨ã¯ å…¥åŠ›ï¼å‡ºåŠ›ã®å‡¦ç†æ™‚ã§ï¼Œè²¬å‹™ã‚’ä»¥ä¸‹ã®ã‚ˆã†ã«åˆ†é¡ã§ãã‚‹ï¼ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ã®è²¬å‹™ã‚’ãƒ‡ã‚¶ã‚¤ãƒ³ãƒ‘ã‚¿ãƒ¼ãƒ³ã«åˆ‡ã‚Šåˆ†ã‘ã¦ã‚‚è‰¯ã„ï¼ å…¥åŠ›æ™‚ï¼å‡ºåŠ›æ™‚ è²¬å‹™ è£œè¶³ å…¥åŠ› ã‚¤ãƒ³ãƒ•ãƒ©å±¤ã®ãƒ«ãƒ¼ã‚¿ã‹ã‚‰å…¥åŠ›ã•ã‚Œã‚‹èªè¨¼æƒ…å ±ã‚’ç…§åˆã—ï¼Œèªè¨¼ã‚’å®Ÿè¡Œã™ã‚‹ï¼ èªè¨¼ã¯ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹å±¤ã‚ã‚‹ã„ã¯ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹å±¤ã«å®Ÿè£…ã™ã‚‹ï¼å‚è€ƒï¼šãƒ»https://github.com/little-hands/ddd-q-and-a/issues/173 ã‚¤ãƒ³ãƒ•ãƒ©å±¤ã®ãƒ«ãƒ¼ã‚¿ãƒ¼ã‹ã‚‰å…¥åŠ›ã•ã‚Œã‚‹ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’APIä»•æ§˜ï¼ˆå¿…é ˆï¼Œæ›¸å¼ï¼Œãªã©ï¼‰ã¨ç…§ã‚‰ã—åˆã‚ã›ï¼Œãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’å®Ÿè¡Œã™ã‚‹ï¼ ãƒ‡ãƒ¼ã‚¿ã®å€¤ãŒAPIä»•æ§˜ã¨æ¯”è¼ƒã—ã¦æ­£ã—ã„ã‹ã©ã†ã‹ã‚’æ¤œè¨¼ã™ã‚‹ã“ã¨ã«æ­¢ã¾ã‚Šï¼Œãƒ‡ãƒ¼ã‚¿ã®å€¤ãŒæ­£ã—ã„ã‹ã©ã†ã‹ã®æ¤œè¨¼ã¯ï¼Œãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹å±¤ã‚„ãƒ‰ãƒ¡ã‚¤ãƒ³å±¤ã«å®Ÿè£…ã™ã‚‹ï¼ ã‚¤ãƒ³ãƒ•ãƒ©å±¤ã®ãƒ«ãƒ¼ã‚¿ãƒ¼ã‹ã‚‰å…¥åŠ›ã•ã‚Œã‚‹ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’ãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒ¢ãƒ‡ãƒ«ã«å¤‰æ›ã—ï¼Œãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹å±¤ã®ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ©ã‚¯ã‚¿ãƒ¼ã«å…¥åŠ›ã™ã‚‹ï¼ ãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒ¢ãƒ‡ãƒ«ç”Ÿæˆå‡¦ç†ã§ï¼Œãƒ‰ãƒ¡ã‚¤ãƒ³å±¤ã¸ã®ä¾å­˜ãŒå¿…è¦ã«ãªã‚‹ï¼ãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒ¢ãƒ‡ãƒ«ç”Ÿæˆå‡¦ç†ã‚’åˆ‡ã‚Šåˆ†ã‘ï¼Œãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹å±¤ã«ç½®ãã¨ï¼Œã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãŒãƒ‰ãƒ¡ã‚¤ãƒ³å±¤ã«ä¾å­˜ã™ã‚‹ã“ã¨ã‚’é˜²ã’ã‚‹ï¼ å‡ºåŠ› ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹å±¤ã®ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ©ã‚¯ã‚¿ãƒ¼ã‹ã‚‰å‡ºåŠ›ã•ã‚Œã‚‹ãƒ¬ã‚¹ãƒãƒ³ã‚¹ãƒ¢ãƒ‡ãƒ«ã‚’ï¼ŒJSONãƒ‡ãƒ¼ã‚¿ã¨ã—ã¦ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã«ã«è¿”ä¿¡ã™ã‚‹ï¼ ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã‚’APIã¨ã—ã¦ç”¨ã„ã‚‹å ´åˆï¼Œãƒ—ãƒ¬ã‚¼ãƒ³ã‚¿ãƒ¼ã¯ä¸è¦ã§ã‚ã‚‹ï¼ ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹å±¤ã®ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ©ã‚¯ã‚¿ãƒ¼ã‹ã‚‰å‡ºåŠ›ã•ã‚Œã‚‹ãƒ—ãƒ¬ã‚¼ãƒ³ã‚¿ãƒ¼ã‚’ãƒ“ãƒ¥ãƒ¼ãƒ¢ãƒ‡ãƒ«ã«å¤‰æ›ã—ï¼Œãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã®ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚¨ãƒ³ã‚¸ãƒ³ã«å‡ºåŠ›ã™ã‚‹ï¼ ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã§ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚¨ãƒ³ã‚¸ãƒ³ã‚’ç”¨ã„ã¦HTMLã‚’ç”Ÿæˆã™ã‚‹å ´åˆï¼Œãƒ—ãƒ¬ã‚¼ãƒ³ã‚¿ãƒ¼ãŒå¿…è¦ã§ã‚ã‚‹ï¼ ãƒ—ãƒ¬ã‚¼ãƒ³ã‚¿ãƒ¼ ãƒ»ãƒ—ãƒ¬ã‚¼ãƒ³ã‚¿ãƒ¼ã¨ã¯ ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã‹ã‚‰ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã«å‡ºåŠ›ã™ã‚‹ãŸã‚ï¼Œï¼ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ãŒãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚¨ãƒ³ã‚¸ãƒ³ã‚’æŒã¤ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã®æ™‚ã«ï¼Œãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã‹ã‚‰ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã®ãƒ­ã‚¸ãƒƒã‚¯ã‚’åˆ†é›¢ã™ã‚‹ãŸã‚ã«ç”¨ã„ã‚‹ï¼ä¸€æ–¹ã§ï¼Œãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã¨ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã‚’å®Œå…¨ã«åˆ†é›¢ã—ï¼Œãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ãŒJSONãƒ‡ãƒ¼ã‚¿ã‚’è¿”ä¿¡ã™ã‚‹APIã¨ã—ã¦æ©Ÿèƒ½ã™ã‚‹å ´åˆã‚„ï¼Œãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã«ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚¨ãƒ³ã‚¸ãƒ³ã‚’çµ„ã¿è¾¼ã‚€å ´åˆã¯ï¼Œãƒ—ãƒ¬ã‚¼ãƒ³ã‚¿ãƒ¼ã‚’ç”¨ã„ãªã„ï¼è£œè¶³ã¨ã—ã¦ï¼Œã‚¢ã‚¦ãƒˆãƒ—ãƒƒãƒˆãƒã‚¦ãƒ³ãƒ€ãƒªã¯ãƒ—ãƒ¬ã‚¼ãƒ³ã‚¿ãƒ¼ã®ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã®ãŸã‚ï¼Œãƒ—ãƒ¬ã‚¼ãƒ³ã‚¿ãƒ¼ã‚’ç”¨ã„ãªã‘ã‚Œã°ï¼Œã‚¢ã‚¦ãƒˆãƒ—ãƒƒãƒˆãƒã‚¦ãƒ³ãƒ€ãƒªã‚‚ç”¨ã„ãªã„ï¼ å‚è€ƒï¼š https://izumisy.work/entry/2019/12/12/000521 https://codezine.jp/article/detail/9749 ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ãƒ‘ã‚¿ãƒ¼ãƒ³ ãƒ»ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ãƒ‘ã‚¿ãƒ¼ãƒ³ã¨ã¯ ãƒ‡ã‚¶ã‚¤ãƒ³ãƒ‘ã‚¿ãƒ¼ãƒ³ã®ä¸€ã¤ï¼ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹å±¤ã®ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã§ã¯ï¼Œãƒ‡ãƒ¼ã‚¿ã®å¿…é ˆã‚„æ›¸å¼ã‚’æ¤œè¨¼ã™ã‚‹ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š æ—¥æ™‚ãƒ‡ãƒ¼ã‚¿ã®ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã‚’æ¤œè¨¼ã™ã‚‹ï¼ validate($dateTime)) { return false; } return true; } } 03. ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹å±¤ï¼ˆèµ¤ï¼‰ å‡¦ç†ãƒ•ãƒ­ãƒ¼ ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹å±¤ã‹ã‚‰ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹å±¤ã¾ã§ã®å‡¦ç†ã®æµã‚Œã‚’ç¤ºã™ï¼ å‚è€ƒï¼šhttp://www.plainionist.net/Implementing-Clean-Architecture-Controller-Presenter/ ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ©ã‚¯ã‚¿ãƒ¼ ãƒ»ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ©ã‚¯ã‚¿ãƒ¼ã¨ã¯ å…¥åŠ›ï¼å‡ºåŠ›ã®å‡¦ç†æ™‚ã§ï¼Œè²¬å‹™ã‚’ä»¥ä¸‹ã®ã‚ˆã†ã«åˆ†é¡ã§ãã‚‹ï¼ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹ã”ã¨ã«ç•°ãªã‚‹Interactorã‚¯ãƒ©ã‚¹ã‚’å®šç¾©ã™ã‚‹æ–¹æ³•ã¨ï¼Œå…¨ã¦ã®ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹ã‚’è²¬å‹™ã¨ã—ã¦ã‚‚ã¤Interactorã‚¯ãƒ©ã‚¹ã‚’å®šç¾©ã™ã‚‹æ–¹æ³•ãŒã‚ã‚‹ï¼ã¾ãŸï¼ŒInteractorã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã‚’ç”¨æ„ã—ã¦ï¼Œã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹å±¤ã®ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ã¯ã“ã‚Œã‚’çµŒç”±ã—ã¦ï¼Œå®Ÿè£…Interactorã‚¯ãƒ©ã‚¹ã®ãƒ¡ã‚½ãƒƒãƒ‰ã‚’ã‚³ãƒ¼ãƒ«ã™ã‚‹ã‚ˆã†ã«ã™ã‚‹ï¼ å…¥åŠ›æ™‚ï¼å‡ºåŠ›æ™‚ è²¬å‹™ è£œè¶³ å…¥åŠ› ãƒ—ãƒ¬ã‚¼ãƒ³ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³å±¤ã®ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ã‹ã‚‰å…¥åŠ›ã•ã‚Œã‚‹ãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’ï¼Œã‚·ã‚¹ãƒ†ãƒ ä¸Šã®ãƒ«ãƒ¼ãƒ«ã¨ç…§ã‚‰ã—åˆã‚ã›ã¦ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’å®Ÿè¡Œã™ã‚‹ï¼ ãƒ‡ãƒ¼ã‚¿ã®å€¤ãŒã‚·ã‚¹ãƒ†ãƒ ä¸Šã‚ã‚Šå¾—ãªã„ã‹ã©ã†ã‹ã‚’æ¤œè¨¼ã™ã‚‹ï¼ãƒ“ã‚¸ãƒã‚¹ä¸Šã‚ã‚Šå¾—ãªã„å€¤ã‹ã©ã†ã‹ã¯ãƒ‰ãƒ¡ã‚¤ãƒ³å±¤ã«Specificationãƒ‘ã‚¿ãƒ¼ãƒ³ã¨ã—ã¦å®Ÿè£…ã™ã‚‹ï¼ ãƒ‰ãƒ¡ã‚¤ãƒ³å±¤ã®ãƒ¡ã‚½ãƒƒãƒ‰ã‚’çµ„ã¿åˆã‚ã›ã¦ï¼Œãƒ¦ãƒ¼ã‚¶ã®è¦æ±‚ã«å¯¾ã™ã‚‹ã‚·ã‚¹ãƒ†ãƒ ã®æŒ¯èˆï¼ˆãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹ï¼‰ã‚’å…·ç¾åŒ–ã™ã‚‹ï¼ ãƒ—ãƒ¬ã‚¼ãƒ³ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³å±¤ã®ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ã‹ã‚‰å…¥åŠ›ã•ã‚Œã‚‹ãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’ï¼Œãƒ‰ãƒ¡ã‚¤ãƒ³å±¤ã®ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ãƒªãƒã‚¸ãƒˆãƒªã«æ¸¡ã›ã‚‹ãƒ‰ãƒ¡ã‚¤ãƒ³ãƒ¢ãƒ‡ãƒ«ã«å¤‰æ›ã™ã‚‹ï¼ å‡ºåŠ› ãƒ‰ãƒ¡ã‚¤ãƒ³å±¤ã®ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ãƒªãƒã‚¸ãƒˆãƒªã‹ã‚‰å‡ºåŠ›ã•ã‚Œã‚‹ãƒ‰ãƒ¡ã‚¤ãƒ³ãƒ¢ãƒ‡ãƒ«ã‚’ãƒ¬ã‚¹ãƒãƒ³ã‚¹ãƒ¢ãƒ‡ãƒ«ã«å¤‰æ›ã—ï¼Œã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹å±¤ã®ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ã«å‡ºåŠ›ã™ã‚‹ï¼ ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã‚’APIã¨ã—ã¦ç”¨ã„ã‚‹å ´åˆï¼Œãƒ—ãƒ¬ã‚¼ãƒ³ã‚¿ãƒ¼ã¯ä¸è¦ã§ã‚ã‚‹ï¼ ãƒ‰ãƒ¡ã‚¤ãƒ³å±¤ã®ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ãƒªãƒã‚¸ãƒˆãƒªã‹ã‚‰å‡ºåŠ›ã•ã‚Œã‚‹ãƒ‰ãƒ¡ã‚¤ãƒ³ãƒ¢ãƒ‡ãƒ«ã‚’ãƒ¬ã‚¹ãƒãƒ³ã‚¹ãƒ¢ãƒ‡ãƒ«ã‚’çµŒã¦ãƒ—ãƒ¬ã‚¼ãƒ³ã‚¿ãƒ¼ã«å¤‰æ›ã—ï¼Œã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹å±¤ã®ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ã«å‡ºåŠ›ã™ã‚‹ï¼ ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã§ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚¨ãƒ³ã‚¸ãƒ³ã‚’ç”¨ã„ã¦HTMLã‚’ç”Ÿæˆã™ã‚‹å ´åˆï¼Œãƒ—ãƒ¬ã‚¼ãƒ³ã‚¿ãƒ¼ãŒå¿…è¦ã§ã‚ã‚‹ï¼ ãƒ»ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹ã¨ãƒ¡ã‚½ãƒƒãƒ‰å ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ©ã‚¯ã‚¿ãƒ¼ã§ã¯ï¼Œãƒ‰ãƒ¡ã‚¤ãƒ³å±¤ã‚’çµ„ã¿åˆã‚ã›ã¦ã‚·ã‚¹ãƒ†ãƒ ã®æŒ¯èˆï¼ˆãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹ï¼‰ã‚’å…·ç¾åŒ–ã™ã‚‹ï¼ãã®ãŸã‚ï¼Œãƒ¡ã‚½ãƒƒãƒ‰åã¯ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹ã‚’é©åˆ‡ã«è¡¨ç¾ã—ãŸè‡ªç”±ãªè‹±å˜èªã‚’ç”¨ã„ã‚‹ï¼Laravelã®åŸºæœ¬çš„ãªãƒ¡ã‚½ãƒƒãƒ‰åï¼ˆindexï¼Œstoreï¼Œcreateï¼Œshowï¼Œupdateï¼Œï¼‰ãŒå‚è€ƒã«ãªã‚‹ï¼CREATEå‡¦ç†ã¨UPDATEå‡¦ç†ã‚’SAVEå‡¦ç†ã¨ã—ã¦ã¾ã¨ã‚ã¦ã‚‚ã‚ˆã„ï¼ ãƒ¡ã‚½ãƒƒãƒ‰å å¼•æ•°å‹ è¿”å´å€¤å‹ å‡¦ç†å†…å®¹ indexFoo indexFooRequest indexFooResponse showFoo showFooRequest showFooResponse createFoo createFooRequest createFooResponse updateFoo updateFooRequest updateFooResponse saveFooï¼ˆupsertFooï¼‰ saveFooRequestï¼ˆupsertFooRequestï¼‰ saveFooResponseï¼ˆupsertFooResponseï¼‰ ãƒªãƒã‚¸ãƒˆãƒªã®findãƒ¡ã‚½ãƒƒãƒ‰ã‚’ã‚³ãƒ¼ãƒ«ã—ã¦é‡è¤‡ç¢ºèªã‚’å®Ÿè¡Œã—ï¼Œãã®çµæœã«å¿œã˜ã¦createãƒ¡ã‚½ãƒƒãƒ‰ã¾ãŸã¯updateãƒ¡ã‚½ãƒƒãƒ‰ã‚’ã‚³ãƒ¼ãƒ«ã™ã‚‹ï¼å‚è€ƒï¼šhttps://github.com/little-hands/ddd-q-and-a/issues/241 deleteFoo deleteFooRequest deleteFooResponse ãƒ»ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹å›³ ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹å›³ã«ã¤ã„ã¦ã¯ï¼Œä»¥ä¸‹ã®ãƒªãƒ³ã‚¯ã‚’å‚è€ƒã«ã›ã‚ˆï¼ å‚è€ƒï¼šhttps://hiroki-it.github.io/tech-notebook-gitbook/public/software/software_application_backend_php_object_orientation_analysis_design_programming.html ï¼Šå®Ÿè£…ä¾‹ï¼Š ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã‚’APIã¨ã—ã¦ç”¨ã„ã‚‹å ´åˆï¼Œãƒ—ãƒ¬ã‚¼ãƒ³ã‚¿ãƒ¼ã¯ä¸è¦ã¨ãªã‚‹ï¼ã“ã®å ´åˆã‚’ç¤ºã™ï¼ fooRepository = $fooRepository; } /** * @param CreateFooRequest $createFooRequest * @return CreateFooResponse */ public function createFoo(CreateFooRequest $createFooRequest): CreateFooResponse { $foo = $this->fooRepository->create( new Bar($createFooRequest->bar), new Baz($createFooRequest->baz) ); // ä½•ã‚‰ã‹ã®å‡¦ç† } } fooRepository = $fooRepository; } /** * @param CreateFooRequest $createFooRequest * @return CreateFooResponse */ public function createFoo(CreateFooRequest $createFooRequest): CreateFooResponse { $foo = $this->fooRepository->create( new Bar($createFooRequest->bar), new Baz($createFooRequest->baz) ); // ä½•ã‚‰ã‹ã®å‡¦ç† } /** * @param GetFooRequest $getFooRequest * @return GetFooResponse */ public function getFoo(GetFooRequest $getFooRequest): GetFooResponse { $foo = $this->fooRepository->findById( new FooId($getFooRequest->id) ); // ä½•ã‚‰ã‹ã®å‡¦ç† } /** * @param UpdateFooRequest $updateFooRequest * @return UpdateFooResponse */ public function updateFoo(UpdateFooRequest $updateFooRequest): UpdateFooResponse { $foo = $this->fooRepository->update( new FooId($updateFooRequest->id), new Bar($updateFooRequest->bar), new Baz($updateFooRequest->baz) ); // ä½•ã‚‰ã‹ã®å‡¦ç† } /** * @param DeleteFooRequest $deleteFooRequest * @return DeleteFooResponse */ public function deleteFoo(DeleteFooRequest $deleteFooRequest): DeleteFooResponse { $foo = $this->fooRepository->delete( new FooId($deleteFooRequest->id) ); // ä½•ã‚‰ã‹ã®å‡¦ç† } } ã‚¤ãƒ³ãƒ—ãƒƒãƒˆãƒã‚¦ãƒ³ãƒ€ãƒª ãƒ»ã‚¤ãƒ³ãƒ—ãƒƒãƒˆãƒã‚¦ãƒ³ãƒ€ãƒªã¨ã¯ ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ©ã‚¯ã‚¿ãƒ¼ã®ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã®ã“ã¨ï¼ä¸Šä½ãƒ¬ã‚¤ãƒ¤ãƒ¼ã«ã‚ã‚‹ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ã¯ï¼Œã‚¤ãƒ³ã‚¿ãƒ¼ãƒ©ã‚¯ã‚¿ãƒ¼ã‚¤ãƒ³ã‚¿ãƒ•ã‚§ãƒ¼ã‚¹ã«ä¾å­˜ã™ã‚‹ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š ã‚¢ã‚¦ãƒˆãƒ—ãƒƒãƒˆãƒã‚¦ãƒ³ãƒ€ãƒª ãƒ»ã‚¢ã‚¦ãƒˆãƒ—ãƒƒãƒˆãƒã‚¦ãƒ³ãƒ€ãƒªã¨ã¯ ä¸Šä½ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®ãƒ—ãƒ¬ã‚¼ãƒ³ã‚¿ãƒ¼ã®ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã®ã“ã¨ï¼ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ©ã‚¯ã‚¿ãƒ¼ã¯ï¼Œãƒ¬ã‚¹ãƒãƒ³ã‚¹ãƒ¢ãƒ‡ãƒ«ã§ã¯ãªãï¼ã‚¢ã‚¦ãƒˆãƒ—ãƒƒãƒˆãƒã‚¦ãƒ³ãƒ€ãƒªã‚’ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹å±¤ã«å‡ºåŠ›ã™ã‚‹ï¼ãŸã ã—ï¼Œã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’APIã¨ã—ã¦ç”¨ã„ã‚‹å ´åˆã¯ï¼Œãƒ—ãƒ¬ã‚¼ãƒ³ã‚¿ãƒ¼ã¨ã‚¢ã‚¦ãƒˆãƒ—ãƒƒãƒˆãƒã‚¦ãƒ³ãƒ€ãƒªãŒä¸è¦ã«ãªã‚Šï¼Œã“ã‚Œã«ä¼´ã„ï¼Œã‚¤ãƒ³ã‚¿ãƒ¼ãƒ©ã‚¯ã‚¿ãƒ¼ã¯ãƒ¬ã‚¹ãƒãƒ³ã‚¹ãƒ¢ãƒ‡ãƒ«ã‚’è¿”å´ã™ã‚‹ã‚ˆã†ã«ã™ã‚‹ï¼ ãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒ¢ãƒ‡ãƒ«ï¼ˆã‚¤ãƒ³ãƒ—ãƒƒãƒˆãƒ‡ãƒ¼ã‚¿ï¼‰ ãƒ»ãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒ¢ãƒ‡ãƒ«ã¨ã¯ ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹å±¤ã®ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ã‹ã‚‰å…¥åŠ›ã•ã‚Œã‚‹ãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹å±¤ã«å…¥åŠ›ã™ã‚‹æ™‚ã«ï¼Œãã®å…¥åŠ›æ§‹é€ ã‚’å®šç¾©ã™ã‚‹ï¼ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ©ã‚¯ã‚¿ãƒ¼ã®ãƒ¡ã‚½ãƒƒãƒ‰ã”ã¨ã«ãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒ¢ãƒ‡ãƒ«ã‚’ç”¨æ„ã™ã‚‹ã¨ã‚ˆã„ï¼ fooId = $fooId; $this->fooName = $fooName; } } ãƒ¬ã‚¹ãƒãƒ³ã‚¹ãƒ¢ãƒ‡ãƒ«ï¼ˆã‚¢ã‚¦ãƒˆãƒ—ãƒƒãƒˆãƒ‡ãƒ¼ã‚¿ï¼‰ ãƒ»ãƒ¬ã‚¹ãƒãƒ³ã‚¹ãƒ¢ãƒ‡ãƒ«ã¨ã¯ ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹å±¤ã®ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ©ã‚¯ã‚¿ãƒ¼ã‹ã‚‰å‡ºåŠ›ã•ã‚Œã‚‹ãƒ‰ãƒ¡ã‚¤ãƒ³ãƒ¢ãƒ‡ãƒ«ã‚’ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹å±¤ã«å‡ºåŠ›ã™ã‚‹æ™‚ã«ï¼Œãã®å‡ºåŠ›æ§‹é€ ã‚’å®šç¾©ã™ã‚‹ï¼ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ©ã‚¯ã‚¿ãƒ¼ã®ãƒ¡ã‚½ãƒƒãƒ‰ã”ã¨ã«ãƒ¬ã‚¹ãƒãƒ³ã‚¹ãƒ¢ãƒ‡ãƒ«ã‚’ç”¨æ„ã™ã‚‹ã¨ã‚ˆã„ï¼ã¾ãŸã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ã«ã¦ï¼Œãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ä¾å­˜ã®JSONãƒ¬ã‚¹ãƒãƒ³ã‚¹ãƒ¡ã‚½ãƒƒãƒ‰ã«ãƒ¬ã‚¹ãƒãƒ³ã‚¹ãƒ¢ãƒ‡ãƒ«ã‚’æ¸¡ã›ã‚‹ã‚ˆã†ï¼Œã‚¯ãƒ©ã‚¹è‡ªèº«ã®æ§‹é€ ã‚’å¤‰æ›ã™ã‚‹ãƒ¡ã‚½ãƒƒãƒ‰ã‚’æŒãŸã›ã‚‹ã¨ã‚ˆã„ï¼ã‚‚ã—ï¼Œã‚¯ãƒ©ã‚¹è‡ªèº«ã‚’æ¸¡ã—ã¦å•é¡Œãªã„JSONãƒ¬ã‚¹ãƒãƒ³ã‚¹ãƒ¡ã‚½ãƒƒãƒ‰ã§ã‚ã‚Œã°ï¼Œã“ã‚Œã¯ä¸è¦ã§ã‚ã‚‹ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹å±¤ã®indexãƒ¡ã‚½ãƒƒãƒ‰ã«å¯¾å¿œã™ã‚‹ãƒ¬ã‚¹ãƒãƒ³ã‚¹ãƒ¢ãƒ‡ãƒ«ï¼JSONãƒ¬ã‚¹ãƒãƒ³ã‚¹ãƒ¡ã‚½ãƒƒãƒ‰ãŒé…åˆ—æ§‹é€ ã‚’å¼•æ•°ã«å—ã‘ä»˜ã‘ã‚‹ãŸã‚ï¼Œã“ã‚Œã«æ¸¡ã›ã‚‹ã‚ˆã†ï¼Œè‡ªèº«ã‚’é…åˆ—æ§‹é€ ã«å¤‰æ›ã™ã‚‹ãƒ¡ã‚½ãƒƒãƒ‰ã‚’æŒãŸã›ã‚‹ï¼ foos = $foos; } /** * @return array */ public function toArray(): array { return [ \"foos\" => $this->foos ]; } } ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹å±¤ã®createãƒ¡ã‚½ãƒƒãƒ‰ã«å¯¾å¿œã™ã‚‹ãƒ¬ã‚¹ãƒãƒ³ã‚¹ãƒ¢ãƒ‡ãƒ«ï¼ fooId = $fooId; $this->fooName = $fooName; } /** * @return array */ public function toArray(): array { return [ \"id\" => $this->fooId, \"name\" => $this->fooName ]; } } ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚µãƒ¼ãƒ“ã‚¹ ãƒ»ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚µãƒ¼ãƒ“ã‚¹ã¨ã¯ ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹å±¤ã®ä¸­ã§ï¼Œãƒ‰ãƒ¡ã‚¤ãƒ³å±¤ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’ç”¨ã„ã‚‹æ±ç”¨çš„ãªãƒ­ã‚¸ãƒƒã‚¯ãŒåˆ‡ã‚Šåˆ†ã‘ã‚‰ã‚ŒãŸã‚‚ã®ï¼ãƒ‰ãƒ¡ã‚¤ãƒ³å±¤ã®ãƒ‰ãƒ¡ã‚¤ãƒ³ã‚µãƒ¼ãƒ“ã‚¹ã¨ã¯ç•°ãªã‚Šï¼Œã‚ãã¾ã§ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹å±¤ã®ãƒ­ã‚¸ãƒƒã‚¯ãŒåˆ‡ã‚Šåˆ†ã‘ã‚‰ã‚ŒãŸã‚‚ã®ã§ã‚ã‚‹ï¼ ãƒ»é€šçŸ¥å‡¦ç† ï¼Šå®Ÿè£…ä¾‹ï¼Š ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã¸ã®é€šçŸ¥å‡¦ç†ã‚’ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚µãƒ¼ãƒ“ã‚¹ã¨ã—ã¦åˆ‡ã‚Šåˆ†ã‘ã‚‹ï¼ message = $message; } public function notify() { // Slackã®APIã«ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’é€ä¿¡ã™ã‚‹å‡¦ç† } } ã“ã‚Œã‚’ï¼Œãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹å±¤ã§ã‚³ãƒ¼ãƒ«ã™ã‚‹ã‚ˆã†ã«ã™ã‚‹ï¼ notify(); } } 04. ãƒ‰ãƒ¡ã‚¤ãƒ³å±¤ï¼ˆé»„ï¼‰ ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ ãƒ»ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã¨ã¯ å¾Œè¿°ã®èª¬æ˜ã‚’å‚ç…§ã›ã‚ˆï¼ å€¤ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ ãƒ»å€¤ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã¨ã¯ å¾Œè¿°ã®èª¬æ˜ã‚’å‚ç…§ã›ã‚ˆï¼ ãƒ‰ãƒ¡ã‚¤ãƒ³ã‚¤ãƒ™ãƒ³ãƒˆ ãƒ»ãƒ‰ãƒ¡ã‚¤ãƒ³ã‚¤ãƒ™ãƒ³ãƒˆã¨ã¯ ãƒ‰ãƒ¡ã‚¤ãƒ³å±¤ã®ä¸­ã§ï¼Œãƒ“ã‚¸ãƒã‚¹çš„ãªã€å‡ºæ¥äº‹ã€ã‚’ãƒ¢ãƒ‡ãƒªãƒ³ã‚°ã—ãŸã‚‚ã®ï¼ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã‚„å€¤ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã¯ã€ç‰©ã€ã‚’ãƒ¢ãƒ‡ãƒªãƒ³ã‚°ã™ã‚‹ãŸã‚ï¼Œç€çœ¼ç‚¹ãŒç•°ãªã‚‹ï¼ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ãƒ‡ã‚¶ã‚¤ãƒ³ãƒ‘ã‚¿ãƒ¼ãƒ³ã®ä¸€ã¤ã§ã‚ã‚‹ã€Pubï¼Subãƒ‘ã‚¿ãƒ¼ãƒ³ã€ã®æ¦‚å¿µã‚’ç”¨ã„ã¦ï¼Œãƒ‰ãƒ¡ã‚¤ãƒ³ã‚¤ãƒ™ãƒ³ãƒˆã¨ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ï¼ˆã‚¤ãƒ™ãƒ³ãƒˆãƒãƒ³ãƒ‰ãƒ©ãƒ¼ï¼‰ã®é–¢é€£ã‚’è¡¨ç¾ã™ã‚‹ï¼ Type Codeï¼ˆæ¨™æº–å‹ï¼‰ ãƒ»Type Codeã¨ã¯ Type Codeã¯æ¦‚å¿µçš„ãªå‘¼ã³åã§ï¼Œå®Ÿéš›ã¯ï¼Œæ¨™æº–çš„ãªãƒ©ã‚¤ãƒ–ãƒ©ãƒªã¨ã—ã¦åˆ©ç”¨ã§ãã‚‹Enumã‚¯ãƒ©ã‚¹ã«ç›¸å½“ã™ã‚‹ï¼ä¸€æ„ã«è­˜åˆ¥ã™ã‚‹å¿…è¦ãŒãªã„ãƒ¦ãƒ“ã‚­ã‚¿ã‚¹è¨€èªã®ä¸­ã§ã‚‚ï¼Œç‰¹ã«ã€åŒºåˆ†ã€ã‚„ã€ç¨®é¡ã€ãªã©ã¯ï¼Œå€¤ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã¨ã—ã¦ã§ã¯ãªãï¼ŒEnumã‚¯ãƒ©ã‚¹ã¨ã—ã¦ãƒ¢ãƒ‡ãƒªãƒ³ã‚°ï¼å®Ÿè£…ã™ã‚‹ï¼ãŸã ã—ï¼Œé¡ä¼¼ã™ã‚‹ãƒ‘ã‚¿ãƒ¼ãƒ³ã¨ã—ã¦å€¤ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªå†…ã«é…ç½®ã—ã¦ã‚‚è‰¯ã„ï¼ ãƒ»è‰² ï¼Šå®Ÿè£…ä¾‹ï¼Š [\"name\" => \"ãƒ¬ãƒƒãƒ‰\"], self::BLUE => [\"name\" => \"ãƒ–ãƒ«ãƒ¼\"] ]; /** * å€¤ */ private $value; /** * è‰²å */ private $name; // ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹åŒ–ã®æ™‚ã«ï¼Œã€è‰²ã®åŒºåˆ†å€¤ã€ã‚’å—ã‘å–ã‚‹ï¼ public function __construct(string $value) { // $kbnValueã«å¿œã˜ã¦ï¼Œè‰²åã‚’nameãƒ‡ãƒ¼ã‚¿ã«ã‚»ãƒƒãƒˆã™ã‚‹ï¼ $this->value = $value; $this->name = static::$set[$value][\"name\"]; } /** * å€¤ã‚’è¿”å´ã—ã¾ã™ï¼ */ public function value(): int { return $this->value; } /** * è‰²åã‚’è¿”å´ã—ã¾ã™ï¼ */ public function name(): string { return $this->name; } } ãƒ»æ€§åˆ¥ ï¼Šå®Ÿè£…ä¾‹ï¼Š [\"name\" => \"ç”·æ€§\"], self::WOMAN => [\"name\" => \"å¥³æ€§\"], self::UNKNOWN => [\"name\" => \"ä¸æ˜\"], ]; /** * å€¤ */ private $value; /** * åå‰ */ private $name; public function __construct($value) { $this->value = $value; $this->name = static::$set[$value][\"name\"]; } /** * å€¤ã‚’è¿”å´ã—ã¾ã™ï¼ */ public function value(): int { return $this->value; } /** * åå‰ã‚’è¿”å´ã—ã¾ã™ï¼ */ public function name() { return $this->name; } } ãƒ»å¹´å· ï¼Šå®Ÿè£…ä¾‹ï¼Š [\"name\" => \"æ˜æ²»\"], self::TAISHO => [\"name\" => \"å¤§æ­£\"], self::SHOWA => [\"name\" => \"æ˜­å’Œ\"], self::HEISEI => [\"name\" => \"å¹³æˆ\"], self::REIWA => [\"name\" => \"ä»¤å’Œ\"], self::SEIREKI => [\"name\" => \"è¥¿æš¦\"], ]; private static $ymd = [ self::MEIJI => [ \"start\" => [ \"year\" => 1868, \"month\" => 1, \"day\" => 25, ], \"end\" => [ \"year\" => 1912, \"month\" => 7, \"day\" => 29, ], ], self::TAISHO => [ \"start\" => [ \"year\" => 1912, \"month\" => 7, \"day\" => 30, ], \"end\" => [ \"year\" => 1926, \"month\" => 12, \"day\" => 24, ], ], self::SHOWA => [ \"start\" => [ \"year\" => 1926, \"month\" => 12, \"day\" => 25, ], \"end\" => [ \"year\" => 1989, \"month\" => 1, \"day\" => 7, ], ], self::HEISEI => [ \"start\" => [ \"year\" => 1989, \"month\" => 1, \"day\" => 8, ], \"end\" => [ \"year\" => 2019, \"month\" => 4, \"day\" => 30, ], ], self::REIWA => [ \"start\" => [ \"year\" => 2019, \"month\" => 5, \"day\" => 1, ], \"end\" => [ \"year\" => 9999, \"month\" => 12, \"day\" => 31, ], ], ]; /** * å€¤ * * @var string */ private $value; /** * å¹´å·å * * @var string */ private $name; /** * å€¤ã‚’è¿”å´ã—ã¾ã™ * * @return string */ public function value(): string { return $this->value; } /** * @param $value */ public function __construct($value) { $this->value = $value; $this->name = static::$set[$value][\"name\"]; } /** * å¹´å·åã‚’è¿”å´ã—ã¾ã™ * * @return string */ public function name() { return $this->name; } } ãƒ‰ãƒ¡ã‚¤ãƒ³ã‚µãƒ¼ãƒ“ã‚¹ ãƒ»ãƒ‰ãƒ¡ã‚¤ãƒ³ã‚µãƒ¼ãƒ“ã‚¹ã¨ã¯ ãƒ‰ãƒ¡ã‚¤ãƒ³å±¤ã®ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã«æŒãŸã›ã‚‹ã¨ã‚„ã‚„ä¸è‡ªç„¶ã§ï¼Œå˜ä½“ï¼è¤‡æ•°ã®ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã‚’å¯¾è±¡ã¨ã—ã¦ä½•ã‹ã‚’å®Ÿè¡Œã™ã‚‹ã‚ˆã†ãªãƒ¡ã‚½ãƒƒãƒ‰ã‚’ãƒ‰ãƒ¡ã‚¤ãƒ³ã‚µãƒ¼ãƒ“ã‚¹ã¨ã—ã¦åˆ‡ã‚Šåˆ†ã‘ã‚‹ï¼å…¨ã¦ã®ãƒ¡ã‚½ãƒƒãƒ‰ã‚’ä¸€ã¤ã®ãƒ‰ãƒ¡ã‚¤ãƒ³ã‚µãƒ¼ãƒ“ã‚¹ã«ã¾ã¨ã‚ã¦ç®¡ç†ã™ã‚‹ã‚ˆã‚Šã‚‚ï¼Œå‹•ä½œã®ç¨®é¡ã”ã¨ã«åˆ†ã‘ã¦ç®¡ç†ã—ãŸæ–¹ãŒè‰¯ã„ï¼ã“ã®æ™‚ï¼Œã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã®ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ãŒãƒ‰ãƒ¡ã‚¤ãƒ³ã‚µãƒ¼ãƒ“ã‚¹ã«å®Ÿè£…ã•ã‚Œã™ããªã„ã‚ˆã†ã«æ³¨æ„ã™ã‚‹ï¼ã¡ãªã¿ã«ï¼Œãƒ‰ãƒ¡ã‚¤ãƒ³å±¤ã§ãƒªãƒã‚¸ãƒˆãƒªã‚’ç”¨ã„ã‚‹ã“ã¨ã‚’å«Œã£ã¦ï¼Œãƒ‰ãƒ¡ã‚¤ãƒ³ã‚µãƒ¼ãƒ“ã‚¹ã®å‡¦ç†ã‚’ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹å±¤ã®ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚µãƒ¼ãƒ“ã‚¹ã§å®šç¾©ã—ã¦ã‚‚å•é¡Œãªã„ï¼ å‚è€ƒï¼š https://github.com/little-hands/ddd-q-and-a/issues/159 https://www.amazon.co.jp/dp/B082WXZVPC https://codezine.jp/article/detail/10318 ãƒ»é‡è¤‡ç¢ºèª ãƒ‰ãƒ¡ã‚¤ãƒ³å±¤ã®ãƒªãƒã‚¸ãƒˆãƒªã‚’ç”¨ã„ã¦ï¼Œè©²å½“ã®åå‰ã®ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ãŒDBã«å­˜åœ¨ã™ã‚‹ã‹ã©ã†ã‹ã‚’æ¤œè¨¼ã™ã‚‹ï¼ãƒ‰ãƒ¡ã‚¤ãƒ³ã‚µãƒ¼ãƒ“ã‚¹ã§ã¯ãªãï¼Œã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚µãƒ¼ãƒ“ã‚¹ã¨ã—ã¦å®šç¾©ã—ã¦ã‚‚è‰¯ã„ï¼ å‚è€ƒï¼š https://stackoverflow.com/questions/45007667/cqrs-ddd-how-to-validate-products-existence-before-adding-them-to-order https://www.amazon.co.jp/dp/B082WXZVPC https://github.com/little-hands/ddd-q-and-a/issues/573 ï¼Šå®Ÿè£…ä¾‹ï¼Š fooRepositoy = $fooRepositoy; } /** * ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ãŒã™ã§ã«å­˜åœ¨ã—ã¦ã„ã‚‹ã‹ã©ã†ã‹ã‚’åˆ¤å®šã—ã¾ã™ï¼ * * @param Foo $foo * @return bool */ public function exists(Foo $foo): bool { $foo = $this->fooRepository ->findByName($foo->name()); return $foo !== null; } } ãƒ»èªå¯ ãƒ‰ãƒ¡ã‚¤ãƒ³å±¤ã®ãƒªãƒã‚¸ãƒˆãƒªã‚’ç”¨ã„ã¦ï¼Œè©²å½“ã®IDã®ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã«å¯¾ã—ã¦ã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½ã‹ã‚’æ¤œè¨¼ã™ã‚‹ï¼ãƒ‰ãƒ¡ã‚¤ãƒ³ã‚µãƒ¼ãƒ“ã‚¹ã§ã¯ãªãï¼Œã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚µãƒ¼ãƒ“ã‚¹ã¨ã—ã¦å®šç¾©ã—ã¦ã‚‚è‰¯ã„ï¼ å‚è€ƒï¼š https://lessthan12ms.com/authorization-and-authentication-in-clean-architecture.html https://medium.com/@martinezdelariva/authentication-and-authorization-in-ddd-671f7a5596ac https://github.com/lezhnev74/ema/blob/master/src/Domain/Note/Commands/ModifyNote/ModifyNoteAuthorizer.php https://github.com/little-hands/ddd-q-and-a/issues/121 ï¼Šå®Ÿè£…ä¾‹ï¼Š fooRepositoy = $fooRepositoy; } /** * æ›´æ–°å‡¦ç†ã‚’å®Ÿè¡Œå¯èƒ½ã‹ã‚’æ¤œè¨¼ã—ã¾ã™ï¼ * * @param FooId $fooId * @param UserId $userId * @return bool */ public function canUpdateById(FooId $fooId, UserId $userId): bool { return $this->fooRepository ->findById($fooId) ->userId ->equals($userId); } } ãƒ»ãƒ‰ãƒ¡ã‚¤ãƒ³ä¾‹å¤– ãƒ‰ãƒ¡ã‚¤ãƒ³å±¤ã®ä¾‹å¤–å‡¦ç†ã‚’ã¾ã¨ã‚ãŸä¾‹å¤–ã‚¯ãƒ©ã‚¹ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š Specificationãƒ‘ã‚¿ãƒ¼ãƒ³ ãƒ»Specificationãƒ‘ã‚¿ãƒ¼ãƒ³ã¨ã¯ ãƒ‡ã‚¶ã‚¤ãƒ³ãƒ‘ã‚¿ãƒ¼ãƒ³ã®ä¸€ã¤ï¼è²¬å‹™ã¨ã—ã¦ï¼Œãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ï¼Œæ¤œç´¢æ¡ä»¶å…¥åŠ›ãƒ‡ãƒ¼ã‚¿ã‚’æŒã¤ï¼ã“ã‚Œã‚‰ã‚’ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã‚„å€¤ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®ãƒ¡ã‚½ãƒƒãƒ‰å†…éƒ¨ã«æŒãŸã›ãŸå ´åˆï¼Œè‚¥å¤§åŒ–ã®åŸå› ã¨ãªã‚Šï¼Œã¾ãŸåŸ‹ã‚‚ã‚Œã¦ã—ã¾ã†ãŸã‚ï¼Œå¯èª­æ€§ã¨ä¿å®ˆæ€§ãŒæ‚ªã„ï¼ãã“ã§ï¼Œã“ã†ã„ã£ãŸãƒ“ã‚¸ãƒã‚¹ãƒ«ãƒ¼ãƒ«ã‚’Specificationã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã¨ã—ã¦åˆ‡ã‚Šåˆ†ã‘ã¦ãŠãï¼ ãƒ»ãƒ“ã‚¸ãƒã‚¹ãƒ«ãƒ¼ãƒ«ã®ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ çœŸå½å€¤ãƒ¡ã‚½ãƒƒãƒ‰ï¼ˆisFooãƒ¡ã‚½ãƒƒãƒ‰ï¼‰ã®ã‚ˆã†ã«ï¼Œã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®ãƒ‡ãƒ¼ã‚¿ã‚’æ¤œè¨¼ã—ã¦ã€ä»•æ§˜ã‚’è¦æ±‚ã‚’æº€ãŸã—ã¦ã„ã‚‹ã‹ã€ä½•ã‚‰ã‹ã®ç›®çš„ã®ãŸã‚ã®ç”¨æ„ãŒã§ãã¦ã„ã‚‹ã‹ã‚’èª¿ã¹ã‚‹å‡¦ç†ã™ã‚‹ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š isX) return false; if (!$entity->isY) return false; if (!$entity->isZ) return false; return true; } } ãƒ»æ¤œç´¢æ¡ä»¶å…¥åŠ›ãƒ‡ãƒ¼ã‚¿ ãƒªã‚¯ã‚¨ã‚¹ãƒˆã®ãƒ‘ã‚¹ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã¨ã‚¯ã‚¨ãƒªãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’å¼•æ•°ã¨ã—ã¦ï¼Œæ¤œç´¢æ¡ä»¶ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’ç”Ÿæˆã™ã‚‹ï¼ãƒ“ã‚¸ãƒã‚¹ãƒ«ãƒ¼ãƒ«ã®ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’è¡Œã†Specificationã‚¯ãƒ©ã‚¹ã¨åŒºåˆ¥ã™ã‚‹ãŸã‚ã«ï¼ŒCriteriaã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã¨ã„ã†åå‰ã¨ã—ã¦ã‚‚ç”¨ã„ã‚‰ã‚Œã‚‹ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š id = $array[\"id\"]; } if (isset($array[\"name\"])) { $criteria->id = $array[\"name\"]; } if (isset($array[\"email\"])) { $criteria->id = $array[\"email\"]; } return $criteria; } } 04-02. ãƒ‰ãƒ¡ã‚¤ãƒ³å±¤ã®ãƒ­ã‚¸ãƒƒã‚¯ã®æµå‡º ãƒ‰ãƒ¡ã‚¤ãƒ³è²§è¡€ç—‡ ãƒ»ãƒ‰ãƒ¡ã‚¤ãƒ³è²§è¡€ç—‡ã¨ã¯ ãƒ‰ãƒ¡ã‚¤ãƒ³å±¤ã®ãƒ‰ãƒ¡ã‚¤ãƒ³ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆãŒãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ã‚’ã»ã¨ã‚“ã©æŒãŸãªã„çŠ¶æ…‹ã«ãªã£ã¦ã„ã‚‹ã“ã¨ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š ãƒ‰ãƒ¡ã‚¤ãƒ³ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã§ã‚ã‚‹ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ãŒã‚²ãƒƒã‚¿ãƒ¼ã¨ã‚»ãƒƒã‚¿ãƒ¼ã—ã‹æŒã£ã¦ã„ãªã„ï¼ã“ã‚Œã¯ï¼Œãƒ‰ãƒ¡ã‚¤ãƒ³è²§è¡€ç—‡ã§ã‚ã‚‹ï¼ userId = $userId; $this->userName = $userName; } /** * @return UserId */ public function id() { return $this->userId; } /** * @return UserName */ public function userName() { return $this->userName; } } ãƒ‰ãƒ¡ã‚¤ãƒ³å±¤ã®ãƒ‰ãƒ¡ã‚¤ãƒ³ã‚µãƒ¼ãƒ“ã‚¹ã¸ã®æµå‡º ãƒ‰ãƒ¡ã‚¤ãƒ³å±¤ã®ãƒ­ã‚¸ãƒƒã‚¯ã‚’ãƒ‰ãƒ¡ã‚¤ãƒ³ã‚µãƒ¼ãƒ“ã‚¹ã«åˆ‡ã‚Šåˆ†ã‘ã™ãã‚‹ã¨ï¼ŒåŒã˜ããƒ‰ãƒ¡ã‚¤ãƒ³å±¤ã®ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã‚„å€¤ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã«å®Ÿè£…ã™ã‚‹ãƒ‰ãƒ¡ã‚¤ãƒ³ãƒ­ã‚¸ãƒƒã‚¯ãŒãªããªã£ã¦ã—ã¾ã„ï¼Œãƒ‰ãƒ¡ã‚¤ãƒ³è²§è¡€ç—‡ã«ãªã‚‹ï¼ãã®ãŸã‚ï¼Œãƒ‰ãƒ¡ã‚¤ãƒ³ã‚µãƒ¼ãƒ“ã‚¹å±¤ã®æ§‹ç¯‰ã¯æ§ãˆã‚ã«ã™ã‚‹ï¼ ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹å±¤ã®ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚µãƒ¼ãƒ“ã‚¹ã¸ã®æµå‡º ãƒ‰ãƒ¡ã‚¤ãƒ³å±¤ã®ãƒ­ã‚¸ãƒƒã‚¯ã‚’ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹å±¤ã®ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹å±¤ã«å®Ÿè£…ã—ã¦ã—ã¾ã†ã¨ï¼Œãƒ‰ãƒ¡ã‚¤ãƒ³å±¤ã®ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã‚„å€¤ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã«å®Ÿè£…ã™ã‚‹ãƒ‰ãƒ¡ã‚¤ãƒ³ãƒ­ã‚¸ãƒƒã‚¯ãŒãªããªã£ã¦ã—ã¾ã„ï¼Œãƒ‰ãƒ¡ã‚¤ãƒ³è²§è¡€ç—‡ã«ãªã‚‹ï¼ãƒ‰ãƒ¡ã‚¤ãƒ³å±¤ã¨ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹å±¤ã®ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚µãƒ¼ãƒ“ã‚¹ã®ã„ãšã‚Œã«å®Ÿè£…ã™ã‚‹ã¹ãã‹ã¯ï¼Œãƒ¢ãƒ‡ãƒªãƒ³ã‚°ã®å¯¾è±¡ãŒãƒ“ã‚¸ãƒã‚¹ãƒ«ãƒ¼ãƒ«ã«åŸºã¥ãã‚‚ã®ãªã®ã‹ï¼Œã‚·ã‚¹ãƒ†ãƒ åˆ©ç”¨è€…ã®ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹ã«åŸºã¥ãã‚‚ã®ãªã®ã‹ã§ã‚ã‚‹ï¼ å‚è€ƒï¼šhttps://www.amazon.co.jp/dp/B082WXZVPC 05-02. ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã¨ã¯ è²¬å‹™ã¨ã—ã¦ï¼Œãƒ“ã‚¸ãƒã‚¹ã®ãƒ«ãƒ¼ãƒ«ã‚„åˆ¶ç´„ã®å®šç¾©ã‚’æŒã¡ï¼Œå€¤ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã¨ã¯åŒºåˆ¥ã•ã‚Œã‚‹ï¼ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã®è²¬å‹™ã‚’ãƒ‡ã‚¶ã‚¤ãƒ³ãƒ‘ã‚¿ãƒ¼ãƒ³ã«åˆ‡ã‚Šåˆ†ã‘ã¦ã‚‚è‰¯ã„ï¼ è­˜åˆ¥å¯èƒ½ ãƒ»è­˜åˆ¥å¯èƒ½ã¨ã¯ ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆãŒè­˜åˆ¥å­ï¼ˆä¾‹ï¼šIDãªã©ï¼‰ã‚’æŒã¡ï¼Œä»–ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã¨åŒã˜å±æ€§ã‚’ã‚‚ã£ã¦ã„ã¦ã‚‚ï¼ŒåŒºåˆ¥ã•ã‚Œã‚‹ï¼ã“ã®è­˜åˆ¥å­ã¯ï¼Œãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®ãƒ—ãƒ©ã‚¤ãƒãƒªã‚­ãƒ¼ã«å¯¾å¿œã—ã¦ã„ã‚‹ï¼ type = $type; $this->name = $name; $this->number = $number; $this->priceVO = $priceVO; $this->colorVO = $colorVO; } /** * çŠ¬ç”¨ãŠã‚‚ã¡ã‚ƒåï¼ˆè‰²ï¼‰ã‚’è¿”å´ã—ã¾ã™ï¼ * * @return string */ public function nameWithColor() { return sprintf( \"%sï¼ˆ%sï¼‰\", $this->name->value(), $this->colorVO->name() ); } } è­˜åˆ¥å­ã«ã‚ˆã‚‹ç­‰ä¾¡æ€§æ¤œè¨¼ ãƒ»è­˜åˆ¥å­ã«ã‚ˆã‚‹ç­‰ä¾¡æ€§æ¤œè¨¼ã¨ã¯ ç­‰ä¾¡æ€§æ¤œè¨¼ç”¨ã®equalsãƒ¡ã‚½ãƒƒãƒ‰ã‚’æŒã¤ï¼ä¿æŒã™ã‚‹è­˜åˆ¥å­ãŒï¼Œå¯¾è±¡ã®ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã¨åŒã˜å ´åˆï¼ŒåŒä¸€ã®ã‚‚ã®ã¨è¦‹ãªã•ã‚Œã‚‹ï¼ ãƒ»ç­‰ä¾¡æ€§ã®æ¤œè¨¼æ–¹æ³• å…¨ã¦ã®ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã«ç­‰ä¾¡æ€§ã®æ¤œè¨¼ãƒ¡ã‚½ãƒƒãƒ‰ã‚’æŒãŸã›ã‚‹ã¨å¯èª­æ€§ãŒä½ã„ï¼ãã“ã§ï¼Œå…¨ã¦ã®ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã«ç­‰ä¾¡æ€§æ¤œè¨¼ç”¨ã®equalsãƒ¡ã‚½ãƒƒãƒ‰ã‚’æŒãŸã›ã‚‹ã“ã¨ã‚’ã‚„ã‚ï¼Œç¶™æ‰¿å…ƒã®æŠ½è±¡ã‚¯ãƒ©ã‚¹ã®ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã«ã“ã‚Œã‚’å®šç¾©ã™ã‚‹ã¨ã‚ˆã„ï¼ id->equals($entity->id()); // IDã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®ç­‰ä¾¡æ€§ } /** * IDã‚¯ãƒ©ã‚¹ã‚’è¿”å´ã—ã¾ã™ï¼ */ public function id(): Id { return $this->id; } } ãƒ»è¤‡åˆä¸»ã‚­ãƒ¼ã¸ã®å¯¾å¿œï¼ˆPHPã§ã¯ä¸è¦ï¼‰ ä»¥é™ã®èª¬æ˜ã¯Javaã«ã¤ã„ã¦é©ç”¨ã•ã‚Œã‚‹ãŸã‚ï¼ŒPHPã§ã¯ä¸è¦ã§ã‚ã‚‹ï¼è¤‡åˆä¸»ã‚­ãƒ¼ã‚’æŒã¤ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã«å¯¾å¿œã™ã‚‹ãŸã‚ã«ï¼Œä¸»ã‚­ãƒ¼ã¨ãªã‚‹æ–¹ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆå´ã«ï¼Œequalsãƒ¡ã‚½ãƒƒãƒ‰ã¨hashãƒ¡ã‚½ãƒƒãƒ‰ã‚’å®šç¾©ã™ã‚‹ï¼ã“ã‚Œã«ã‚ˆã‚Šï¼Œè¨€èªæ¨™æº–æ­è¼‰ã®equalsãƒ¡ã‚½ãƒƒãƒ‰ã¨hashãƒ¡ã‚½ãƒƒãƒ‰ã‚’ã‚ªãƒ¼ãƒãƒ¼ãƒ©ã‚¤ãƒ‰ã—ï¼Œç•°ãªã‚‹ã‚»ãƒƒã‚·ãƒ§ãƒ³ã«æ¸¡ã£ã¦ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’æ¯”è¼ƒã§ãã‚‹ã‚ˆã†ã«ã™ã‚‹ï¼ã“ã‚Œã‚‰ã‚’å®šç¾©ã—ãªã„ã¨ï¼Œã‚ªãƒ¼ãƒãƒ¼ãƒ©ã‚¤ãƒ‰ã•ã‚Œãšã«æ¨™æº–æ­è¼‰ã®ãƒ¡ã‚½ãƒƒãƒ‰ãŒç”¨ã„ã‚‰ã‚Œã‚‹ï¼æ¨™æº–æ­è¼‰ã®ãƒ¡ã‚½ãƒƒãƒ‰ã§ã¯ï¼Œç•°ãªã‚‹ã‚»ãƒƒã‚·ãƒ§ãƒ³ã«æ¸¡ã£ãŸã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®æ¯”è¼ƒã§ã¯ï¼Œå¿…ãšç•°ãªã‚‹ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã§ã‚ã‚‹ã¨åˆ¤å®šã—ã¦ã—ã¾ã†ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š PHPã§ã¯ä¸è¦ã§ã‚ã‚‹ãŒï¼Œå‚è€ƒã¾ã§ã«ï¼ŒPHPã§å®Ÿè£…ã—ãŸï¼ id = $id; } /** * ãƒãƒƒã‚·ãƒ¥å€¤ã‚’è¿”å´ã—ã¾ã™ï¼ * * NOTE: è¤‡åˆä¸»ã‚­ãƒ¼ã‚’æŒã¤ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®ç­‰ä¾¡æ€§ã‚’æ­£ã—ãæ¤œè¨¼ã™ã‚‹ãŸã‚ã«ï¼Œæ¨™æº–ã®é–¢æ•°ã‚’ã‚ªãƒ¼ãƒãƒ¼ãƒ©ã‚¤ãƒ‰ã—ã¾ã™ï¼ * * @return string */ public function hash(): string { return $this->id; } /** * ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®ç­‰ä¾¡æ€§ã‚’æ¤œè¨¼ã—ã¾ã™ï¼ * * NOTE: è¤‡åˆä¸»ã‚­ãƒ¼ã‚’æŒã¤ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®ç­‰ä¾¡æ€§ã‚’æ­£ã—ãæ¤œè¨¼ã™ã‚‹ãŸã‚ã«ï¼Œæ¨™æº–ã®é–¢æ•°ã‚’ã‚ªãƒ¼ãƒãƒ¼ãƒ©ã‚¤ãƒ‰ã—ã¾ã™ï¼ * * @param Id $id * @return bool */ public function equals(Id $id): bool { return ($id instanceof $this || $this instanceof $id) // IDã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®ãƒ‡ãƒ¼ã‚¿å‹ã®ç­‰ä¾¡æ€§ && $this->hash() == $id->hash(); // ãƒãƒƒã‚·ãƒ¥å€¤ã®ç­‰ä¾¡æ€§ } } ãƒ‡ãƒ¼ã‚¿ã®å¯å¤‰æ€§ï¼ä¸å¤‰æ€§ ãƒ»å¯å¤‰æ€§ï¼ä¸å¤‰æ€§ã®å®Ÿç¾æ–¹æ³•ï¼ˆMutableï¼Immutableï¼‰ ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã®ãƒ‡ãƒ¼ã‚¿ã¯å¯å¤‰ï¼ä¸å¤‰ãƒ‡ãƒ¼ã‚¿ã®ã„ãšã‚Œã§ã‚ã£ã¦ã‚‚ã‚ˆã„ï¼ãŸã ã—ï¼Œãã‚‚ãã‚‚ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã¯ä¸å¤‰ã§ã‚ã‚‹æ–¹ãŒæœ›ã¾ã—ã„ãŸã‚ï¼Œå¯å¤‰çš„ãªãƒ‡ãƒ¼ã‚¿ã¯æœ€å°é™ã«ã™ã‚‹ï¼å¤‰åŒ–ã•ã›ã¦ã‚‚å•é¡Œãªã„ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã«å¯¾ã—ã¦ã¯ã‚»ãƒƒã‚¿ãƒ¼ã‚’å®šç¾©ã—ï¼Œä¸å¤‰çš„ãªãƒ‡ãƒ¼ã‚¿ã«å¯¾ã—ã¦ã¯ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³ã®ã¿ã‚’è¨±å¯ã™ã‚‹ã‚ˆã†ã«ã™ã‚‹ï¼ã‚‚ã¡ã‚ã‚“ï¼Œã‚»ãƒƒã‚¿ãƒ¼å†…ã§ã¯ãƒ‰ãƒ¡ã‚¤ãƒ³ãƒ«ãƒ¼ãƒ«ã®ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’å®Ÿè¡Œã™ã‚‹ï¼ä¸å¤‰æ€§ã®å®Ÿç¾æ–¹æ³•ã«ã¤ã„ã¦ã¯ï¼Œå¾Œè¿°ã®èª¬æ˜ã‚’å‚è€ƒã«ã›ã‚ˆï¼ 05-03. å€¤ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ å€¤ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã¨ã¯ è²¬å‹™ã¨ã—ã¦ï¼Œãƒ“ã‚¸ãƒã‚¹ã®ãƒ«ãƒ¼ãƒ«ã‚„åˆ¶ç´„ã®å®šç¾©ã‚’æŒã¡ï¼Œã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã¨åŒºåˆ¥ã•ã‚Œã‚‹ï¼é‡‘é¡ï¼Œæ•°å­—ï¼Œé›»è©±ç•ªå·ï¼Œæ–‡å­—åˆ—ï¼Œæ—¥ä»˜ï¼Œæ°åï¼Œè‰²ãªã©ã®ãƒ¦ãƒ“ã‚­ã‚¿ã‚¹è¨€èªã«é–¢ã™ã‚‹ãƒ‡ãƒ¼ã‚¿ã¨ï¼Œä¸€æ„ã§è­˜åˆ¥ã§ãã‚‹ãƒ‡ãƒ¼ã‚¿ï¼ˆä¾‹ãˆã°ï¼Œ$idãƒ‡ãƒ¼ã‚¿ï¼‰ã‚’æŒã¤ï¼ è­˜åˆ¥ä¸å¯èƒ½ ãƒ»è­˜åˆ¥ä¸å¯èƒ½ã¨ã¯ ä¸€æ„ã«è­˜åˆ¥ã§ãã‚‹ãƒ‡ãƒ¼ã‚¿ã‚’ã‚‚ãŸãšï¼Œå¯¾è±¡ã®ãƒ¦ãƒ“ã‚­ã‚¿ã‚¹è¨€èªã«é–¢ã™ã‚‹ãƒ‡ãƒ¼ã‚¿ã‚’ãƒ¡ã‚½ãƒƒãƒ‰ã‚’æŒã¤ ãƒ»é‡‘é¡ é‡‘é¡ãƒ‡ãƒ¼ã‚¿ã®è¨ˆç®—ã‚’Interactorå†…å‡¦ç†ã‚„ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£å†…ãƒ¡ã‚½ãƒƒãƒ‰ã§è¡Œã†ã®ã§ã¯ãªãï¼Œé‡‘é¡è¨ˆç®—ã‚’è¡Œã†å€¤ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®ãƒ¡ã‚½ãƒƒãƒ‰ã¨ã—ã¦åˆ†å‰²ã™ã‚‹ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š amount = (float) $amount; } /** * é‡‘é¡ã‚’è¿”å´ã—ã¾ã™ * * @return float */ public function amount() { return $this->amount; } /** * å˜ä½ã‚’è¿”å´ã—ã¾ã™ * * @return string */ public function unit() { return \"å††\"; } /** * è¶³ã—ç®—ã®çµæœã‚’è¿”å´ã—ã¾ã™ * * @param Money $price * @return $this */ public function add(Money $price) { return new static($this->amount + $price->amount); } /** * å¼•ãç®—ã®çµæœã‚’è¿”å´ã—ã¾ã™ * * @param Money $price * @return $this */ public function substract(Money $price) { return new static($this->amount - $price->amount); } /** * æ›ã‘ç®—ã®çµæœã‚’è¿”å´ã—ã¾ã™ * * @param Money $price * @return $this */ public function multiply(Money $price) { return new static($this->amount * $price); } } ãƒ»æ‰€è¦æ™‚é–“ æ‰€è¦æ™‚é–“ãƒ‡ãƒ¼ã‚¿ã®è¨ˆç®—ã‚’Interactorã‚¯ãƒ©ã‚¹å†…å‡¦ç†ã‚„ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£å†…ãƒ¡ã‚½ãƒƒãƒ‰ã§è¡Œã†ã®ã§ã¯ãªãï¼Œæ‰€è¦æ™‚é–“è¨ˆç®—ã‚’è¡Œã†å€¤ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®ãƒ¡ã‚½ãƒƒãƒ‰ã¨ã—ã¦åˆ†å‰²ã™ã‚‹ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š distance = $distance; } /** * å¾’æ­©ã¾ãŸã¯è»Šã®ã©ã¡ã‚‰ã‚’ç”¨ã„ã‚‹ã‹ã‚’åˆ¤å®šã—ã¾ã™ * * @return bool */ public function isMinuteByWalking(): bool { if ($this->distance * 1000 / self::WALKING_SPEED_PER_MINUTE distance * 1000 / self::WALKING_SPEED_PER_MINUTE; return ceil($minute); } /** * è»Šã§ã®æ‰€ç”¨æ™‚é–“ã‚’è¨ˆç®—ã—ã¾ã™ * * @return float */ public function minuteByCar(): float { $minute = $this->distance * 1000 / self::CAR_SPEED_PER_MINUTE; return ceil($minute); } } ãƒ»ä½æ‰€ éƒµä¾¿ç•ªå·ãƒ‡ãƒ¼ã‚¿ã¨ãã®å‡¦ç†ã‚’å€¤ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã¨ã—ã¦åˆ†å‰²ã™ã‚‹ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š city = $city; $this->zip = $zip; $this->address = $address; } /** * éƒµä¾¿ç•ªå·ã‚’ç”Ÿæˆã—ï¼Œè¿”å´ã—ã¾ã™ * * @return string */ public function zip() { return sprintf( \"ã€’%s-%s\", substr($this->zip, 0, 3), substr($this->zip, 3) ); } /** * ä½æ‰€ã‚’ç”Ÿæˆã—ï¼Œè¿”å´ã—ã¾ã™ * * @return string */ public function address(): string { return sprintf( \"%s%s%s\", $this->city->prefecture->name ?? '', $this->city->name ?? '', $this->address ?? '' ); } } ãƒ»æ°å æ°åï¼Œæ€§åˆ¥ï¼Œãƒ‡ãƒ¼ã‚¿ã¨ãã®å‡¦ç†ã‚’å€¤ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã¨ã—ã¦åˆ†å‰²ã™ã‚‹ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š lastName = $lastName; $this->firstName = $firstName; $this->lastKanaName = $lastKanaName; $this->firstKanaName = $firstKanaName; } /** * æ°åã‚’ä½œæˆã—ã¾ã™ï¼ */ public function fullName(): string { return $this->lastName . $this->firstName; } /** * ã‚«ãƒŠæ°åã‚’ä½œæˆã—ã¾ã™ï¼ */ public function fullKanaName(): string { return $this->lastKanaName . $this->firstKanaName; } } ãƒ‡ãƒ¼ã‚¿ã®ä¸å¤‰æ€§ï¼ˆImmutableï¼‰ ãƒ»ä¸å¤‰æ€§ã®å®Ÿç¾æ–¹æ³• å€¤ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã¯ä¸å¤‰çš„ã§ã‚ã‚Šï¼Œã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã¨ã—ã¦ç”Ÿæˆã•ã‚Œã¦ä»¥é™ï¼Œãƒ‡ãƒ¼ã‚¿ã¯å¤‰æ›´ã•ã‚Œãªã„ï¼ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®ä¸å¤‰æ€§ã‚’å®Ÿç¾ã™ã‚‹ãŸã‚ã«ï¼Œã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã«ã‚»ãƒƒã‚¿ãƒ¼ã‚’å®šç¾©ã—ãªã„ã‚ˆã†ã«ã—ï¼Œãƒ‡ãƒ¼ã‚¿ã®è¨­å®šã«ã¯constructãƒ¡ã‚½ãƒƒãƒ‰ã ã‘ã‚’ç”¨ã„ã‚‹ã‚ˆã†ã«ã™ã‚‹ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š propertyA = $propertyA; $this->propertyB = $propertyB; $this->propertyC = $propertyC; } } ãƒ»ã‚»ãƒƒã‚¿ãƒ¼ã§ã¯ä¸å¤‰çš„ã«ãªã‚‰ãªã„ç†ç”± ï¼Šå®Ÿè£…ä¾‹ï¼Š Test01ã‚¯ãƒ©ã‚¹ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã®$property01ãƒ‡ãƒ¼ã‚¿ã«å€¤ã‚’è¨­å®šã™ã‚‹ãŸã‚ã«ã¯ï¼Œã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‹ã‚‰ã‚»ãƒƒã‚¿ãƒ¼ã‚’å‘¼ã³å‡ºã™ï¼ã‚»ãƒƒã‚¿ãƒ¼ã¯ä½•åº¦ã§ã‚‚å‘¼ã³å‡ºã›ï¼Œãã®åº¦ã«ãƒ‡ãƒ¼ã‚¿ã®å€¤ã‚’ä¸Šæ›¸ãã§ãã¦ã—ã¾ã†ï¼ setProperty01(\"ãƒ‡ãƒ¼ã‚¿01ã®å€¤\"); $test01->setProperty01(\"æ–°ã—ã„ãƒ‡ãƒ¼ã‚¿01ã®å€¤\"); Test02ã‚¯ãƒ©ã‚¹ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã®$property02ãƒ‡ãƒ¼ã‚¿ã«å€¤ã‚’è¨­å®šã™ã‚‹ãŸã‚ã«ã¯ï¼Œã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’ä½œã‚Šç›´ã•ãªã‘ã‚Œã°ãªã‚‰ãªã„ï¼ã¤ã¾ã‚Šï¼Œä»¥å‰ã«ä½œã£ãŸã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã®$property02ã®å€¤ã¯ä¸Šæ›¸ãã§ããªã„ï¼ã‚»ãƒƒã‚¿ãƒ¼ã‚’æŒãŸã›ãšã«ï¼Œconstructãƒ¡ã‚½ãƒƒãƒ‰ã ã‘ã‚’æŒãŸã›ã‚Œã°ï¼Œä¸å¤‰çš„ãªã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã¨ãªã‚‹ï¼ ãƒ»éå‰°ãªã‚²ãƒƒã‚¿ãƒ¼ã¸ã®å¯¾å‡¦æ³• ä¸å¤‰çš„ãªãƒ‡ãƒ¼ã‚¿ã¯ã‚²ãƒƒã‚¿ãƒ¼ã‚’ç”¨ã„ãªã‘ã‚Œã°ã‚¢ã‚¯ã‚»ã‚¹ã§ããªã„ï¼ãã®ãŸã‚ï¼Œå€¤ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã«ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£å€¤ã‚’è¿”å´ã™ã‚‹ã ã‘ã®ã‚²ãƒƒã‚¿ãƒ¼ãŒé‡ç”£ã•ã‚Œï¼Œãƒ•ã‚¡ã‚¤ãƒ«ã®è¦‹é€šã—ãŒæ‚ªããªã£ã¦ã—ã¾ã†ï¼ãã“ã§ï¼Œä¾‹ãˆã°PHPã§ã¯ï¼Œãƒã‚¸ãƒƒã‚¯ãƒ¡ã‚½ãƒƒãƒ‰ã®__getãƒ¡ã‚½ãƒƒãƒ‰ã‚’ç”¨ã„ã¦ï¼Œã‚²ãƒƒã‚¿ãƒ¼ã®å®Ÿè£…ã‚’çœç•¥ã§ãã‚‹ï¼å…¨ã¦ã®å€¤ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®åŸºåº•ã‚¯ãƒ©ã‚¹ã«ï¼Œã€ã‚³ãƒ¼ãƒ«ã•ã‚ŒãŸã‚²ãƒƒã‚¿ãƒ¼ãŒã‚¯ãƒ©ã‚¹å†…ã«å­˜åœ¨ã—ã¦ã„ãªã‘ã‚Œã°ï¼Œå‹•çš„ã«ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã«ã‚¢ã‚¯ã‚»ã‚¹ã—ã¦è¿”å´ã™ã‚‹ã€å‡¦ç†ã‚’æŒã£ãŸ__getãƒ¡ã‚½ãƒƒãƒ‰ã‚’å®šç¾©ã—ã¦ãŠãï¼ã™ã‚‹ã¨ï¼Œãƒã‚¸ãƒƒã‚¯ãƒ¡ã‚½ãƒƒãƒ‰ã®ã‚ªãƒ¼ãƒãƒ¼ãƒ©ã‚¤ãƒ‰æ©Ÿèƒ½ã«ã‚ˆã‚Šï¼Œè‡ªèº«ã§å®šç¾©ã—ãŸ__getãƒ¡ã‚½ãƒƒãƒ‰ãŒä»£ã‚ã‚Šã«ã‚³ãƒ¼ãƒ«ã•ã‚Œã‚‹ã‚ˆã†ã«ãªã‚Šï¼Œã‚²ãƒƒã‚¿ãƒ¼ã‚’å®šç¾©ã™ã‚‹å¿…è¦ãŒãªããªã‚‹ï¼ {$name}; } } class Foo { use ImmutableTrait; private $bar; public function __constructor($bar) { $this->bar = $bar } } $foo = new Foo() $foo->bar // __getãƒ¡ã‚½ãƒƒãƒ‰ãŒä»£ã‚ã‚Šã«ã‚³ãƒ¼ãƒ«ã•ã‚Œï¼Œãƒ—ãƒ­ãƒ‘ãƒ†ã‚£å€¤ãŒè¿”å´ã•ã‚Œã‚‹ï¼ æ¦‚å¿µçš„ãªçµ±ä¸€ä½“ äº¤æ›å¯èƒ½æ€§ ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆãŒæ–°ã—ãã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹åŒ–ã•ã‚ŒãŸå ´åˆï¼Œä»¥å‰ã«åŒä¸€ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‹ã‚‰ç”Ÿæˆã•ã‚ŒãŸã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‹ã‚‰æ–°ã—ãç½®ãæ›ãˆã‚‹å¿…è¦ãŒã‚ã‚‹ï¼ å±æ€§ã«ã‚ˆã‚‹ç­‰ä¾¡æ€§ ãƒ»å±æ€§ã«ã‚ˆã‚‹ç­‰ä¾¡æ€§æ¤œè¨¼ã¨ã¯ ç­‰ä¾¡æ€§ã‚’æ¤œè¨¼ã™ã‚‹ãƒ¡ã‚½ãƒƒãƒ‰ã‚’æŒã¤ï¼ä¿æŒã™ã‚‹å…¨ã¦ã®å±æ€§ãŒï¼Œå¯¾è±¡ã®å€¤ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã¨åŒã˜å ´åˆï¼ŒåŒä¸€ã®ã‚‚ã®ã¨è¦‹ãªã•ã‚Œã‚‹ï¼ ãƒ»ç­‰ä¾¡æ€§ã®æ¤œè¨¼æ–¹æ³• ï¼Šå®Ÿè£…ä¾‹ï¼Š å±æ€§ã‚’ä¸€ã¤ã ã‘ä¿æŒã™ã‚‹å ´åˆï¼Œä¸€ã¤ã®å±æ€§ã®ã¿ã‚’æ¤œè¨¼ã™ã‚Œã°è‰¯ã„ãŸã‚ï¼Œä»¥ä¸‹ã®é€šã‚Šã¨ãªã‚‹ï¼ value = $value; } /** * @return string */ public function value(): string { return $this->value; } /** * å€¤ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®ç­‰ä¾¡æ€§ã‚’æ¤œè¨¼ã—ã¾ã™ï¼ * * @param ValueObject $VO * @return bool */ public function equals(ValueObject $VO): bool { // å˜ä¸€ã®å±æ€§ã‚’å¯¾è±¡ã¨ã™ã‚‹ï¼ return $this->value() === $VO->value(); } } å±æ€§ã‚’è¤‡æ•°ä¿æŒã™ã‚‹å€¤ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®å ´åˆï¼Œå…¨ã¦ã®å±æ€§ã‚’æ¤œè¨¼ã™ã‚‹å¿…è¦ãŒã‚ã‚‹ãŸã‚ï¼Œä»¥ä¸‹ã®é€šã‚Šã¨ãªã‚‹ï¼ paymentType = $paymentType; $this->contactMail = $contactMail; $this->price = $price; } /** * å€¤ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®ç­‰ä¾¡æ€§ã‚’æ¤œè¨¼ã—ã¾ã™ï¼ * * @param ValueObject $VO * @return bool */ public function equals(ValueObject $VO): bool { // è¤‡æ•°ã®å±æ€§ã‚’å¯¾è±¡ã¨ã™ã‚‹ï¼ return $this->paymentType->value() === $VO->paymentType->value() && $this->contactMail->value() === $VO->contactMail->value() && $this->price->value() === $VO->price->value(); } } å…¨ã¦ã®å€¤ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã«ç­‰ä¾¡æ€§ã®æ¤œè¨¼ãƒ¡ã‚½ãƒƒãƒ‰ã‚’æŒãŸã›ã‚‹ã¨å¯èª­æ€§ãŒä½ã„ï¼ãã“ã§ï¼Œç¶™æ‰¿å…ƒã®æŠ½è±¡ã‚¯ãƒ©ã‚¹ã®å€¤ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã«å®šç¾©ã™ã‚‹ã¨ã‚ˆã„ï¼ãã®æ™‚ã¯ï¼Œä¿æŒã—ã¦ã„ã‚‹å±æ€§ã‚’åå¾©çš„ã«æ¤œè¨¼ã§ãã‚‹ã‚ˆã†ã«å®Ÿè£…ã™ã‚‹ã¨ã‚ˆã„ï¼ $value) { if ($this->__get($key) !== $VO->__get($key)) { return false; } } return true; } } 05-04. ãƒ«ãƒ¼ãƒˆã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã¨ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³ ãƒ«ãƒ¼ãƒˆã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ ãƒ»ãƒ«ãƒ¼ãƒˆã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã¨ã¯ ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã‚„å€¤ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‹ã‚‰ãªã‚‹é›†ç´„ã®ä¸­ã§ï¼Œæœ€çµ‚çš„ã«ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹å±¤ã¸ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã•ã‚Œã‚‹é›†ç´„ã‚’ï¼Œã€ãƒ«ãƒ¼ãƒˆã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã€ã¨ã„ã†ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š dogToy = $dogToy; $this->dogFood = $dogFood; } /** * çŠ¬ç”¨ãŠã‚‚ã¡ã‚ƒã‚’è¿”å´ã—ã¾ã™ï¼ * * @return DogToy */ public function getDogToy(): DogToy { return $this->dogToy; } /** * çŠ¬ãˆã•ã‚’è¿”å´ã—ã¾ã™ï¼ * * @return DogFood */ public function getDogFood(): DogFood { return $this->dogFood; } } ãƒ»é›†ç´„ã¨ã¯ ãƒ‡ãƒ¼ã‚¿ã‚’ã‚»ãƒƒãƒˆã§æ‰±ã†å¿…è¦ãŒã‚ã‚‹ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã®ã¾ã¨ã¾ã‚Šã®ã“ã¨ï¼ä¾å­˜é–¢ä¿‚ã®è¦³ç‚¹ã‹ã‚‰ã¿ãŸé›†ç´„ã«ã¤ã„ã¦ã¯ï¼Œä»¥ä¸‹ã‚’å‚è€ƒã«ã›ã‚ˆï¼ å‚è€ƒï¼šhttps://hiroki-it.github.io/tech-notebook-gitbook/public/software/software_application_backend_php_object_orientation_class.html ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³ã¨ã®é–¢ä¿‚æ€§ ã‚¤ãƒ³ãƒ•ãƒ©å±¤ã®ãƒªãƒã‚¸ãƒˆãƒªã§ã¯ï¼Œãƒ«ãƒ¼ãƒˆã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã®å˜ä½ã§ï¼Œãƒ‡ãƒ¼ã‚¿ã®æ›¸ãè¾¼ã¿ï¼èª­ã¿å‡ºã—ã®ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³å‡¦ç†ã‚’å®Ÿè¡Œã™ã‚‹ï¼ãƒ«ãƒ¼ãƒˆã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã‚’å®šç¾©ã¥ã‘ã‚‹æ™‚ã®æ³¨æ„ç‚¹ã¨ã—ã¦ï¼Œé›†ç´„ã®å˜ä½ãŒå¤§ãéãã‚‹ã¨ï¼Œä¸€éƒ¨åˆ†ã®ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã®ã¿ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³ã®å¯¾è±¡ã¨ã™ã‚Œã°è‰¯ã„å‡¦ç†ã§ã‚ã‚‹ã®ã«ã‚‚é–¢ã‚ã‚‰ãšï¼Œãƒ«ãƒ¼ãƒˆã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£å…¨ä½“ã¾ã§å¯¾è±¡ã¨ã—ãªã‘ã‚Œã°ãªã‚‰ãªããªã‚‹ï¼ãã®ãŸã‚ï¼Œãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ã¨ã—ã¦ã®ã¾ã¨ã¾ã‚Šã¨ï¼Œãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³ã¨ã—ã¦ã®ã¾ã¨ã¾ã‚Šã®ä¸¡æ–¹ã‹ã‚‰ï¼Œãƒ«ãƒ¼ãƒˆã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã®å˜ä½ã‚’å®šç¾©ã¥ã‘ã‚‹ã¨ã‚ˆã„ï¼ å‚è€ƒï¼šhttps://qiita.com/mikesorae/items/ff8192fb9cf106262dbf#%E5%AF%BE%E7%AD%96-1 06. ã‚¤ãƒ³ãƒ•ãƒ©å±¤ï¼ˆé’ï¼‰ ã‚¤ãƒ³ãƒ•ãƒ©å±¤ã®ä¾å­˜æ€§é€†è»¢ ãƒ»DIPï¼ˆä¾å­˜æ€§é€†è»¢ã®åŸå‰‡ï¼‰ã¨ã¯ å‚è€ƒï¼šhttps://hiroki-it.github.io/tech-notebook-gitbook/?q=%E4%BE%9D%E5%AD%98%E6%80%A7%E9%80%86%E8%BB%A2 ãƒ»ç™ºè¡¨ã‚¹ãƒ©ã‚¤ãƒ‰ ãƒªãƒã‚¸ãƒˆãƒª ãƒ»ãƒªãƒã‚¸ãƒˆãƒªãƒ‘ã‚¿ãƒ¼ãƒ³ã¨ã¯ ãƒ‡ã‚¶ã‚¤ãƒ³ãƒ‘ã‚¿ãƒ¼ãƒ³ã®ä¸€ã¤ï¼ä¸€ä¾‹ã¨ã—ã¦ï¼Œä»¥ä¸‹ã®ãƒ¡ã‚½ãƒƒãƒ‰ã‚’æŒã¤ï¼å…·ä½“çš„ãªå®Ÿè£…ã«ã¤ã„ã¦ã¯ï¼Œã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ãƒªãƒã‚¸ãƒˆãƒªã®å®Ÿè£…ã‚’å‚è€ƒã«ã›ã‚ˆï¼CREATEå‡¦ç†ã¨UPDATEå‡¦ç†ã‚’SAVEå‡¦ç†ã¨ã—ã¦ã¾ã¨ã‚ã¦ã‚‚ã‚ˆã„ï¼ å‚è€ƒï¼š https://codewithshadman.com/repository-pattern-csharp/ https://sf9v.github.io/posts/generating-the-repository-pattern-in-go/#introduction https://terasolunaorg.github.io/guideline/public_review/ImplementationAtEachLayer/DomainLayer.html#repository-interface-label ãƒ¡ã‚½ãƒƒãƒ‰å å¼•æ•°å‹ è¿”å´å€¤å‹ å‡¦ç†å†…å®¹ findById Idå‹ ãƒ‰ãƒ¡ã‚¤ãƒ³ãƒ¢ãƒ‡ãƒ«å‹ ãƒ«ãƒ¼ãƒˆã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã®ã®ãƒ‰ãƒ¡ã‚¤ãƒ³ãƒ¢ãƒ‡ãƒ«ã‚’å–å¾—ã™ã‚‹ï¼ findAll ãªã— ãƒ‰ãƒ¡ã‚¤ãƒ³ãƒ¢ãƒ‡ãƒ«å‹ã‚’æŒã¤é…åˆ— å…¨ã¦ã®ãƒ‰ãƒ¡ã‚¤ãƒ³ãƒ¢ãƒ‡ãƒ«ã‚’å–å¾—ã™ã‚‹ï¼ findAllByCriteria Criteriaå‹ ãƒ‰ãƒ¡ã‚¤ãƒ³ãƒ¢ãƒ‡ãƒ«å‹ã‚’æŒã¤é…åˆ— æ¡ä»¶ã«åˆè‡´ã—ãŸå…¨ã¦ã®ãƒ‰ãƒ¡ã‚¤ãƒ³ãƒ¢ãƒ‡ãƒ«ã‚’å–å¾—ã™ã‚‹ï¼ create ãƒ«ãƒ¼ãƒˆã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã®ãƒ‰ãƒ¡ã‚¤ãƒ³ãƒ¢ãƒ‡ãƒ«å‹ voidå‹ ãƒ«ãƒ¼ãƒˆã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã®ãƒ‰ãƒ¡ã‚¤ãƒ³ãƒ¢ãƒ‡ãƒ«ã‚’ä½œæˆã™ã‚‹ï¼ update ãƒ«ãƒ¼ãƒˆã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã®ãƒ‰ãƒ¡ã‚¤ãƒ³ãƒ¢ãƒ‡ãƒ«å‹ voidå‹ ãƒ«ãƒ¼ãƒˆã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã®ãƒ‰ãƒ¡ã‚¤ãƒ³ãƒ¢ãƒ‡ãƒ«ã‚’æ›´æ–°ã™ã‚‹ï¼ saveï¼ˆupsertï¼‰ ãƒ«ãƒ¼ãƒˆã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã®ãƒ‰ãƒ¡ã‚¤ãƒ³ãƒ¢ãƒ‡ãƒ«å‹ voidå‹ ãƒ«ãƒ¼ãƒˆã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã®ãƒ‰ãƒ¡ã‚¤ãƒ³ãƒ¢ãƒ‡ãƒ«ã‚’ä½œæˆï¼æ›´æ–°ã™ã‚‹ï¼SELECTæ–‡ã®INå¥ã‚’ç”¨ã„ã¦ï¼ŒåŒã˜è­˜åˆ¥å­ã®ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã‚’DBã‹ã‚‰å–å¾—ã§ãã‚‹ã‹ã©ã†ã‹ã‚’ç¢ºèªã™ã‚‹ï¼å–å¾—ã§ããªã„å ´åˆã¯ï¼Œæ›´æ–°å‡¦ç†ã‚’å®Ÿè¡Œã™ã‚‹ï¼å‚è€ƒï¼šãƒ»https://github.com/little-hands/ddd-q-and-a/issues/241ãƒ»https://github.com/little-hands/ddd-q-and-a/issues/129 delete Idå‹ voidå‹ ãƒ«ãƒ¼ãƒˆã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã®ãƒ‰ãƒ¡ã‚¤ãƒ³ãƒ¢ãƒ‡ãƒ«ã‚’å‰Šé™¤ã™ã‚‹ï¼ ãƒ»ä»–ã®é¡ä¼¼ã™ã‚‹ãƒ‡ã‚¶ã‚¤ãƒ³ãƒ‘ã‚¿ãƒ¼ãƒ³ã¨ã®æ¯”è¼ƒ ãƒ‡ã‚¶ã‚¤ãƒ³ãƒ‘ã‚¿ãƒ¼ãƒ³ é§†å‹•ã®ç¨®é¡ ãƒ‰ãƒ¡ã‚¤ãƒ³ãƒ¢ãƒ‡ãƒ«ã¨ãƒ†ãƒ¼ãƒ–ãƒ«ã®é–¢é€£åº¦åˆã„ æ¡ç”¨ãƒ©ã‚¤ãƒ–ãƒ©ãƒªä¾‹ é©æ‰€ è£œè¶³ Active Record ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹é§†å‹• ãƒ»éå¸¸ã«å¼·ã„ï¼ãƒ»æ‰‹é †ã¨ã—ã¦ãƒ†ãƒ¼ãƒ–ãƒ«è¨­è¨ˆãŒå…ˆã«ã‚ã‚Šï¼Œä¸€ã¤ã®ãƒ‰ãƒ¡ã‚¤ãƒ³ãƒ¢ãƒ‡ãƒ«ãŒä¸€ã¤ã®ãƒ†ãƒ¼ãƒ–ãƒ«ã«å¯¾å¿œã—ã¦ã„ã‚‹ï¼ãƒ»ãƒ†ãƒ¼ãƒ–ãƒ«é–“ã®ãƒªãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚·ãƒƒãƒ—ã«ã‚ˆã£ã¦ï¼Œãƒ‰ãƒ¡ã‚¤ãƒ³ãƒ¢ãƒ‡ãƒ«é–“ã®ä¾å­˜é–¢ä¿‚ãŒæ±ºã¾ã‚‹ï¼ ãƒ»Eloquentï¼ˆPHPï¼‰ãƒ»Active Recordï¼ˆRubyï¼‰ãƒ»Hibernateï¼ˆJavaï¼‰ ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ãŒè¤‡é›‘ã§ãªã„ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å‚è€ƒï¼šhttps://www.informit.com/articles/article.aspx?p=1398618&seqNum=3 DataMapperãƒ‘ã‚¿ãƒ¼ãƒ³ã¨åŒã˜ãï¼ŒORMã®å®Ÿè£…æ–¹æ³•ã®ä¸€ã¤ã§ã‚ã‚‹ï¼å‚è€ƒï¼šhttps://culttt.com/2014/06/18/whats-difference-active-record-data-mapper/ Data Mapper ãƒ‰ãƒ¡ã‚¤ãƒ³é§†å‹• ãƒ»å¼±ã„ãƒ»Entityãƒãƒãƒ¼ã‚¸ãƒ£ã‚’ç”¨ã„ã¦ï¼Œãƒ‰ãƒ¡ã‚¤ãƒ³ãƒ¢ãƒ‡ãƒ«ã‚’DBã«æ°¸ç¶šåŒ–ã™ã‚‹ï¼ Doctrine ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ãŒè¤‡é›‘ãªã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å‚è€ƒï¼šhttps://www.informit.com/articles/article.aspx?p=1398618&seqNum=3 ActiveRecordãƒ‘ã‚¿ãƒ¼ãƒ³ã¨åŒã˜ãï¼ŒORMã®å®Ÿè£…æ–¹æ³•ã®ä¸€ã¤ã§ã‚ã‚‹ï¼å‚è€ƒï¼šhttps://culttt.com/2014/06/18/whats-difference-active-record-data-mapper/ Repository ãƒ‰ãƒ¡ã‚¤ãƒ³é§†å‹• ãƒ»å¼±ã„ãƒ»æ‰‹é †ã¨ã—ã¦ãƒ‰ãƒ¡ã‚¤ãƒ³ãƒ¢ãƒ‡ãƒ«ã®ä¾å­˜é–¢ä¿‚ã®è¨­è¨ˆãŒå…ˆã«ã‚ã‚Šï¼Œãƒ†ãƒ¼ãƒ–ãƒ«é–“ã®é–¢ä¿‚æ€§ã¯è‡ªç”±ã§ã‚ã‚‹ï¼ä¸€ã¤ã®ãƒ‰ãƒ¡ã‚¤ãƒ³ãƒ¢ãƒ‡ãƒ«ãŒè¤‡æ•°ã®ãƒ†ãƒ¼ãƒ–ãƒ«ã‚’å‚ç…§ã—ã¦ã‚‚ã‚ˆã„ï¼ ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ãŒè¤‡é›‘ãªã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ DBï¼ŒRDMSï¼ŒNoSQLï¼Œãªã‚“ã§ã‚‚ã§ã‚‚ã‚ˆã„ï¼ ãªã— ãªã— éå¸¸ã«å¼±ã„ DBãƒ•ã‚¡ã‚µãƒ¼ãƒ‰ ãƒ»å®Ÿè£…ãƒªãƒã‚¸ãƒˆãƒª ãƒªãƒã‚¸ãƒˆãƒªãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’ç”¨ã„ã‚‹ï¼è²¬å‹™ã¨ã—ã¦ï¼ŒDBã«å¯¾ã—ã¦ãƒ‡ãƒ¼ã‚¿ã®æ›¸ãè¾¼ã¿ï¼èª­ã¿å‡ºã—ã®ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³å‡¦ç†ã‚’å®Ÿè¡Œã™ã‚‹ï¼ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³ã¯ãƒ«ãƒ¼ãƒˆã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã‚’å˜ä½ã¨ã—ã¦å®šç¾©ã™ã‚‹å¿…è¦ãŒã‚ã‚‹ãŸã‚ï¼Œãƒªãƒã‚¸ãƒˆãƒªã‚‚åŒã˜ããƒ«ãƒ¼ãƒˆã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã‚’å˜ä½ã¨ã—ã¦å®šç¾©ã¥ã‘ã‚‹ã“ã¨ã«ãªã‚‹ï¼ãã®ãŸã‚ï¼Œå¼•æ•°ã®å‹ã¯ãƒ«ãƒ¼ãƒˆã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã®ãƒ‰ãƒ¡ã‚¤ãƒ³ãƒ¢ãƒ‡ãƒ«å‹ã«ãªã‚‹ï¼ãƒªãƒã‚¸ãƒˆãƒªã§ã¯ãƒ«ãƒ¼ãƒˆã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã‚’æ„è­˜ã—ã¦å®Ÿè£…ã™ã‚‹å¿…è¦ãŒã‚ã‚‹ä¸€æ–¹ã§ï¼ŒDBã®ã©ã®ãƒ†ãƒ¼ãƒ–ãƒ«ã«ãƒ‡ãƒ¼ã‚¿ãŒå­˜åœ¨ã—ã¦ã„ã‚‹ã‹ã‚’å•ã‚ãªã„ï¼ã“ã‚Œã«ã‚ˆã‚Šï¼Œãƒ«ãƒ¼ãƒˆã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã¨DBãƒ†ãƒ¼ãƒ–ãƒ«ã‚’åˆ¥ã€…ã«è¨­è¨ˆã§ãã‚‹ï¼ãƒ«ãƒ¼ãƒˆã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã¨ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³ã®é–¢ä¿‚æ€§ã«ã¤ã„ã¦ã¯ï¼Œå‰è¿°ã®èª¬æ˜ã‚’å‚è€ƒã«ã›ã‚ˆï¼DBãƒ†ãƒ¼ãƒ–ãƒ«è¨­è¨ˆã«ã¤ã„ã¦ã¯ä»¥ä¸‹ã®ãƒªãƒ³ã‚¯ã‚’å‚è€ƒã«ã›ã‚ˆï¼ å‚è€ƒï¼šhttps://hiroki-it.github.io/tech-notebook-gitbook/public/backend_database_operation.html ãƒ»ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ãƒªãƒã‚¸ãƒˆãƒª ä¾å­˜æ€§é€†è»¢ã®åŸå‰‡ã‚’å°å…¥ã™ã‚‹å ´åˆã«ï¼Œãƒ‰ãƒ¡ã‚¤ãƒ³å±¤ã«ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ãƒªãƒã‚¸ãƒˆãƒªã‚’é…ç½®ã™ã‚‹ï¼ã‚¤ãƒ³ãƒ•ãƒ©å±¤ã®å®Ÿè£…ãƒªãƒã‚¸ãƒˆãƒªã‚¯ãƒ©ã‚¹ã¨å¯¾å¿œé–¢ä¿‚ã«ã‚ã‚‹ï¼å®Ÿè£…ãƒªãƒã‚¸ãƒˆãƒªã«ã¤ã„ã¦ã¯ï¼Œå¾Œè¿°ã®èª¬æ˜ã‚’å‚è€ƒã«ã›ã‚ˆï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š ãƒ»DBã«å¯¾ã™ã‚‹æ›¸ãè¾¼ã¿è²¬å‹™ï¼ˆCreateï¼ŒUpdateï¼ŒDeleteï¼‰ DBã«å¯¾ã™ã‚‹æ›¸ãè¾¼ã¿æ“ä½œã‚’è¡Œã†ï¼ GETï¼POSTã«ã‚ˆã£ã¦ï¼Œãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹å±¤ã‹ã‚‰å€¤ãŒé€ä¿¡ã•ã‚Œã‚‹ï¼ ãƒ•ã‚¡ã‚¯ãƒˆãƒªã«ã‚ˆã£ã¦ï¼Œé€ä¿¡ã•ã‚ŒãŸå€¤ã‹ã‚‰ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã‚„å€¤ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½œæˆã™ã‚‹ï¼ã•ã‚‰ã«ï¼Œãã‚Œã‚‰ã‹ã‚‰ãƒ«ãƒ¼ãƒˆã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã‚’ä½œæˆã™ã‚‹ï¼ ãƒªãƒã‚¸ãƒˆãƒªã«ãƒ«ãƒ¼ãƒˆã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã‚’æ¸¡ã™ï¼ ãƒ«ãƒ¼ãƒˆã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã‚’ãƒ¬ã‚³ãƒ¼ãƒ‰ã¨ã—ã¦DBã«æŒ¿å…¥ã™ã‚‹ï¼ å‚è€ƒï¼š https://www.doctrine-project.org/projects/doctrine-orm/en/2.8/reference/query-builder.htm https://github.com/doctrine/dbal/blob/2.12.x/lib/Doctrine/DBAL/Query/QueryBuilder.php ï¼Šå®Ÿè£…ä¾‹ï¼Š CREATEå‡¦ç†ã®ãŸã‚ï¼ŒDoctrineã®QueryBuilderã‚¯ãƒ©ã‚¹ã®insertãƒ¡ã‚½ãƒƒãƒ‰ã‚’å®Ÿè¡Œã™ã‚‹ï¼ createQueryBuilder(); // SQLã‚’å®šç¾©ã™ã‚‹ï¼ $query->insert(\"dog_toy_table\") ->values([ // ãƒ«ãƒ¼ãƒˆã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã®è¦ç´ ã‚’ã‚«ãƒ©ãƒ å€¤ã¨ã—ã¦è¨­å®šã™ã‚‹ï¼ï¼ˆIDã¯AutoIncrementï¼‰ \"name\" => $dogToy->getName()->value(), \"type\" => $dogToy->getType()->value(), \"price\" => $dogToy->getPriceVO()->value(), \"color\" => $dogToy->getColorVO()->value(), ]); } } UPDATEå‡¦ç†ã®ãŸã‚ï¼ŒDoctrineã®QueryBuilderã‚¯ãƒ©ã‚¹ã®updateãƒ¡ã‚½ãƒƒãƒ‰ã‚’å®Ÿè¡Œã™ã‚‹ï¼ createQueryBuilder(); // SQLã‚’å®šç¾©ã™ã‚‹ï¼ $query->update(\"dog_toy_table\", \"dog_toy\") // ãƒ«ãƒ¼ãƒˆã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã®è¦ç´ ã‚’ã‚«ãƒ©ãƒ å€¤ã¨ã—ã¦è¨­å®šã™ã‚‹ï¼ ->set(\"dog_toy.name\", $dogToy->getName()->value()) ->set(\"dog_toy.type\", $dogToy->getType()->value()) ->set(\"dog_toy.price\", $dogToy->getPriceVO()->value()) ->set(\"dog_toy.color\", $dogToy->getColorVO()->value()) ->where(\"dog_toy.id\", $dogToy->getId()->value(); return $query->getResult(); } } DELETEå‡¦ç†ï¼ˆè«–ç†å‰Šé™¤ï¼‰ã®ãŸã‚ï¼ŒDoctrineã®QueryBuilderã‚¯ãƒ©ã‚¹ã®updateãƒ¡ã‚½ãƒƒãƒ‰ã‚’å®Ÿè¡Œã™ã‚‹ï¼ createQueryBuilder(); // SQLã‚’å®šç¾©ã™ã‚‹ï¼ $query->update(\"dog_toy_table\", \"dog_toy\") // è«–ç†å‰Šé™¤ ->set(\"dog_toy.is_deleted\", FlagConstant::IS_ON) ->where(\"dog_toy.id\", $dogToy->getId()->value(); return $query->getResult(); } } ãƒ»DBã«å¯¾ã™ã‚‹èª­ã¿å‡ºã—è²¬å‹™ï¼ˆReadï¼‰ DBã«å¯¾ã™ã‚‹æ›¸ãè¾¼ã¿æ“ä½œã‚’è¡Œã†ï¼ ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹å±¤ã‹ã‚‰é›†ç´„ãŒãƒªã‚¯ã‚¨ã‚¹ãƒˆã•ã‚Œã‚‹ï¼ DBã‹ã‚‰ãƒ¬ã‚³ãƒ¼ãƒ‰ã‚’å–å¾—ã™ã‚‹ï¼ ãƒ•ã‚¡ã‚¯ãƒˆãƒªã«ã‚ˆã£ã¦ï¼Œãƒ¬ã‚³ãƒ¼ãƒ‰ã‹ã‚‰ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã‚„å€¤ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½œæˆã™ã‚‹ï¼ ãƒªãƒã‚¸ãƒˆãƒªã‹ã‚‰ãƒ«ãƒ¼ãƒˆã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã‚’è¿”å´ã—ï¼Œãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹å±¤ã«æ¸¡ã™ï¼ å‚è€ƒï¼š https://www.doctrine-project.org/projects/doctrine-orm/en/2.8/reference/query-builder.htm https://github.com/doctrine/dbal/blob/2.12.x/lib/Doctrine/DBAL/Query/QueryBuilder.php ï¼Šå®Ÿè£…ä¾‹ï¼Š READå‡¦ç†ã®ãŸã‚ï¼ŒDoctrineã®QueryBuilderã‚¯ãƒ©ã‚¹ã®selectãƒ¡ã‚½ãƒƒãƒ‰ã‚’å®Ÿè¡Œã™ã‚‹ï¼ createQueryBuilder(); // SQLã‚’è¨­å®šã™ã‚‹ï¼ $query->select( \"dog_toy.id AS dog_toy_id\", \"dog_toy.name AS dog_toy_name\", \"dog_toy.type AS dog_toy_type\", \"dog_toy.price AS dog_toy_price\", \"dog_toy.color AS dog_toy_color\" ) ->from(\"dog_toy_table\", \"dog_toy\") // è«–ç†å‰Šé™¤ã•ã‚Œã¦ã„ãªã„ã‚‚ã®ã®ã¿ ->where(\"dog_toy.is_deleted\", FlagConstant::IS_OFF) ->getQuery(); // SQLã‚’å®Ÿè¡Œã™ã‚‹ï¼ $entities = $query->getResult(); $dogToys = []; foreach($entities as $entity){ // å–å¾—ã—ãŸã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã‚’ãƒ‰ãƒ¡ã‚¤ãƒ³ãƒ¢ãƒ‡ãƒ«ã«å¤‰æ›ã™ã‚‹ï¼ $dogToys[] = $this->toDogToy($entity); } return $dogToys; } /** * ãƒ‰ãƒ¡ã‚¤ãƒ³ãƒ¢ãƒ‡ãƒ«ã«å¤‰æ›ã—ã¾ã™ï¼ */ private function toDogToy(array $entity): DogToy { $dogToy = new DogToy( new DogId($entity[\"dog_toy_id\"]), new DogName($entity[\"dog_toy_name\"]), new DogToyType($entity[\"dog_toy_type\"]), new PriceVO($entity[\"dog_toy_price\"], new ColorVO($entity[\"dog_toy_color\"] ); return $dogToy; } } ãƒ•ã‚¡ã‚¯ãƒˆãƒª ãƒ»ãƒ•ã‚¡ã‚¯ãƒˆãƒªã¨ã¯ è²¬å‹™ã¨ã—ã¦ï¼Œæ–°ãŸãªé›†ç´„ã®ä½œæˆã‚„ï¼Œæ—¢å­˜ã®é›†ç´„ã®å†ä½œæˆã‚’å®Ÿè¡Œã™ã‚‹ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š ãƒ«ãƒ¼ã‚¿ ãƒ»ãƒ«ãƒ¼ã‚¿ã¨ã¯ ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ã«ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã™ã‚‹ï¼ ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢ ãƒ»ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢ã¨ã¯ ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°å¾Œã«ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¡ã‚½ãƒƒãƒ‰ã®å‰ã«ã‚³ãƒ¼ãƒ«ã•ã‚Œã‚‹BeforeMiddleã¨ï¼Œãƒ¬ã‚¹ãƒãƒ³ã‚¹ã®å®Ÿè¡Œæ™‚ã«ã‚³ãƒ¼ãƒ«ã•ã‚Œã‚‹AfterMiddlewareãŒã‚ã‚‹ï¼æœ€è¿‘ã®ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã§ã‚‚æ­è¼‰ã•ã‚Œã¦ã„ã‚‹ï¼ ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ï¼ˆã‚¤ãƒ™ãƒ³ãƒˆãƒãƒ³ãƒ‰ãƒ©ãƒ¼ï¼‰ ãƒ»ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ã¨ã¯ ãƒ‰ãƒ¡ã‚¤ãƒ³ã‚¤ãƒ™ãƒ³ãƒˆãŒç™ºç”Ÿã—ãŸå ´åˆã«ï¼Œãã‚Œã«ç´ä»˜ãå‡¦ç†ã‚’å®Ÿè¡Œã™ã‚‹ï¼ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã®æ©Ÿèƒ½ã«ä¾å­˜ã™ã‚‹ã“ã¨ã«ãªã‚‹ãŸã‚ï¼Œå®Ÿè£…ã®è©³ç´°ã‚’ã‚¤ãƒ³ãƒ•ãƒ©å±¤ã«ãŠãï¼ å‚è€ƒï¼š https://stackoverflow.com/questions/67148194/domain-driven-design-ddd-domain-event-handlers-where-to-place-them https://zenn.dev/fuuuuumin65/articles/2c96e8f0b29c01 ãƒ»å‘½åè¦å‰‡ ã‚¤ãƒ™ãƒ³ãƒˆã§ãƒªã‚¹ãƒŠãƒ¼ã‚’ä½¿ã„å›ã•ãšã«ï¼Œå„ã‚¤ãƒ™ãƒ³ãƒˆã”ã¨ã«ãƒªã‚¹ãƒŠãƒ¼ã‚’ä½œæˆã™ã‚‹ï¼ãã®ãŸã‚ï¼Œåå‰ã¯ã€ã‚¤ãƒ™ãƒ³ãƒˆåã€ï¼‹Listenerï¼ˆHandlerï¼‰ã¨ãªã‚‹ï¼ å‚è€ƒï¼šhttps://docs.microsoft.com/ja-jp/dynamicsax-2012/developer/naming-conventions-delegates-and-event-handlers#event-handler-naming-conventions ã‚¤ãƒ³ãƒ•ãƒ©ã‚¹ãƒˆãƒ©ã‚¯ãƒãƒ£ã‚µãƒ¼ãƒ“ã‚¹ ãƒ»ã‚¤ãƒ³ãƒ•ãƒ©ã‚¹ãƒˆãƒ©ã‚¯ãƒãƒ£ã‚µãƒ¼ãƒ“ã‚¹ã¨ã¯ ã‚¤ãƒ³ãƒ•ãƒ©å±¤ã®ä¸­ã§ï¼Œæ±ç”¨çš„ãªãƒ­ã‚¸ãƒƒã‚¯ãŒåˆ‡ã‚Šåˆ†ã‘ã‚‰ã‚ŒãŸã‚‚ã®ï¼å®Ÿè£…ãƒªãƒã‚¸ãƒˆãƒªã¨åŒæ§˜ã«ã—ã¦ï¼Œãƒ‰ãƒ¡ã‚¤ãƒ³å±¤ã«ã‚¹ãƒˆãƒ©ã‚¯ãƒãƒ£ã‚µãƒ¼ãƒ“ã‚¹ã®ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã‚’è¨­ã‘ï¼Œä¾å­˜æ€§é€†è»¢ã®åŸå‰‡ã‚’æº€ãŸã›ã‚‹ã‚ˆã†ã«ã™ã‚‹ï¼ ãƒ»ãƒ­ã‚®ãƒ³ã‚° ãƒ»ãƒ•ã‚¡ã‚¤ãƒ«å‡ºåŠ› ãƒ»ãƒãƒƒã‚·ãƒ¥åŒ– ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã®ãƒãƒƒã‚·ãƒ¥åŒ–ï¼ å‚è€ƒï¼šhttps://dev.to/stevensunflash/using-domain-driven-design-ddd-in-golang-3ee5 07. ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã«ãŠã‘ã‚‹ãƒ¬ã‚¤ãƒ¤ãƒ¼åˆ¥ã®ä¾‹å¤–ã‚¹ãƒ­ãƒ¼ ã‚¹ãƒ­ãƒ¼ã•ã‚ŒãŸä¾‹å¤–ã®æ‰±ã„ å„ãƒ¬ã‚¤ãƒ¤ãƒ¼ã§ã¯ä¾‹å¤–ã‚’ã‚¹ãƒ­ãƒ¼ã™ã‚‹ã ã‘ã«ç•™ã¾ã‚Šï¼Œã‚¹ãƒ­ãƒ¼ã•ã‚ŒãŸä¾‹å¤–ã‚’å¯¾å‡¦ã™ã‚‹è²¬å‹™ã¯ï¼Œã‚ˆã‚Šä¸Šä½ãƒ¬ã‚¤ãƒ¤ãƒ¼ã«æŒãŸã›ã‚‹ï¼ã‚ˆã‚Šä¸Šä½ãƒ¬ã‚¤ãƒ¤ãƒ¼ã§ã¯ï¼Œãã®ãƒ¬ã‚¤ãƒ¤ãƒ¼ã«åˆã£ãŸä¾‹å¤–ã«è©°ã‚æ›¿ãˆã¦ï¼Œã“ã‚Œã‚’ã‚¹ãƒ­ãƒ¼ã™ã‚‹ï¼æœ€çµ‚çš„ã«ã¯ï¼Œãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹å±¤ã¾ã§æŒã¡ä¸Šã’ï¼Œç”»é¢ä¸Šã®ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ã§è­¦å‘Šæ–‡ã¨ã—ã¦ã“ã‚Œã‚’è¡¨ç¤ºã™ã‚‹ï¼ä¾‹å¤–ã‚¹ãƒ­ãƒ¼ã®æ„ç¾©ã«ã¤ã„ã¦ã¯ï¼Œä»¥ä¸‹ã‚’å‚è€ƒã«ã›ã‚ˆï¼ å‚è€ƒï¼šhttps://hiroki-it.github.io/tech-notebook-gitbook/public/software/software_application_backend_php_logic_error_and_error_handling.html ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹å±¤ ãƒ»ä¾‹å¤– final class PresentationException extends Exception { } ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹å±¤ ãƒ»ä¾‹å¤– final class InteractorException extends Exception { } ãƒ‰ãƒ¡ã‚¤ãƒ³å±¤ ãƒ»ä¾‹å¤– final class DomainException extends Exception { } ã‚¤ãƒ³ãƒ•ãƒ©å±¤ ãƒ»ä¾‹å¤– final class InfrastructureException extends Exception { } "},"public/software/software_application_architecture_backend_cqrs.html":{"url":"public/software/software_application_architecture_backend_cqrs.html","title":"ğŸ“– ï¸CQRS","keywords":"","body":"CQRSï¼šCommand Query Responsibility Segregation ã¯ã˜ã‚ã« æœ¬ã‚µã‚¤ãƒˆã«ã¤ãã¾ã—ã¦ï¼Œä»¥ä¸‹ã‚’ã”èªè­˜ã®ã»ã©å®œã—ããŠé¡˜ã„ã„ãŸã—ã¾ã™ï¼ å‚è€ƒï¼šhttps://hiroki-it.github.io/tech-notebook-gitbook/ 01. CQRS CQRSã¨ã¯ ã€Command Query Responsibility Segregationï¼ˆã‚³ãƒãƒ³ãƒ‰ã‚¯ã‚¨ãƒªè²¬å‹™åˆ†é›¢ï¼‰ã€ã®ç•¥ï¼ãƒªãƒã‚¸ãƒˆãƒªãƒ‘ã‚¿ãƒ¼ãƒ³ã«ãŠã‘ã‚‹æ›´æ–°ç³»ã¨å‚ç…§ç³»ã®å‡¦ç†ã‚’åˆ†é›¢ã™ã‚‹è¨­è¨ˆã®ã“ã¨ï¼æ›´æ–°ç³»ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã¯ãã®ã¾ã¾ãƒªãƒã‚¸ãƒˆãƒªã¨ã—ã¦ã‚¤ãƒ³ãƒ•ãƒ©å±¤ã«ç½®ãï¼ä¸€æ–¹ã§å‚ç…§ç³»ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã¯ï¼Œå‚ç…§ã®ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹ã«å¿œã˜ã¦ã€QueryServiceã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã€ã¨ã—ã¦è¨­è¨ˆã—ï¼Œãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹å±¤ã«ç½®ãï¼ˆã“ã‚Œé‡è¦ï¼‰ï¼ã‚·ã‚¹ãƒ†ãƒ ã«éƒ¨åˆ†çš„ã«çµ„ã¿è¾¼ã‚€ã“ã¨ãŒã§ãã‚‹ï¼N+1å•é¡Œã«ã‚‚å¯¾å‡¦ã§ãã‚‹ï¼ å‚è€ƒï¼š https://vaadin.com/learn/tutorials/ddd/tactical_domain_driven_design https://little-hands.hatenablog.com/entry/2019/12/02/cqrs ãƒ¡ãƒªãƒƒãƒˆ ä¸€è¦§ç”»é¢ã«è¡¨ç¤ºã™ã‚‹ãƒ‡ãƒ¼ã‚¿ã¯è¤‡æ•°ã®é›†ç´„ã‹ã‚‰ãªã‚‹ãŸã‚ï¼Œãã‚Œãã‚Œã®é›†ç´„ã«å¯¾å¿œã™ã‚‹ãƒªãƒã‚¸ãƒˆãƒªã®å‚ç…§ç³»å‡¦ç†ã‚’é †ã€…ã«ã‚³ãƒ¼ãƒ«ã—ï¼Œå–å¾—ã—ãŸãƒ‡ãƒ¼ã‚¿ã‚’çµ„ã¿åˆã‚ã›ã‚‹å¿…è¦ãŒã‚ã‚‹ï¼ãã®ãŸã‚ï¼Œä¸€è¦§è¡¨ç¤ºã®åº¦ã«è¤‡æ•°ã®ãƒªãƒã‚¸ãƒˆãƒªã‚’ã‚³ãƒ¼ãƒ«ã™ã‚‹ã“ã¨ã¨ãªã‚Šï¼Œã‚·ã‚¹ãƒ†ãƒ ã®ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã«æ‚ªå½±éŸ¿ãŒå‡ºã‚‹å¯èƒ½æ€§ãŒã‚ã‚‹ï¼ã¾ãŸï¼Œç•°ãªã‚‹ãƒªãƒã‚¸ãƒˆãƒªã‚’ã¾ãŸã„ã§WHEREå¥ã‚’ç”¨ã„ã‚‹ã“ã¨ã¯ã§ããªã„ãŸã‚ï¼Œè¤‡æ•°ã®é›†ç´„ã«æ¸¡ã‚‹çµã‚Šè¾¼ã¿æ¤œç´¢ã‚’å®Ÿè£…ã§ããªã„ï¼ã—ã‹ã—CQRSã‚’ç”¨ã„ã‚‹ã¨ï¼Œæ›´æ–°ç³»ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã¯ãƒªãƒã‚¸ãƒˆãƒªï¼Œä¸€æ–¹ã§å‚ç…§ç³»ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã¯ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹ã«å¿œã˜ãŸQueryServiceã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã¨ã—ã¦è¨­è¨ˆã™ã‚‹ã“ã¨ã«ãªã‚‹ï¼ãã®ãŸã‚ï¼Œæ›´æ–°ç³»ã§ã¯é›†ç´„ã®å˜ä½ã‚’ãã®ã¾ã¾ã«ã—ã¦ï¼Œé›†ç´„ã¨ã¯ç„¡é–¢ä¿‚ãªå‚ç…§ç³»å‡¦ç†ã‚’è¨­è¨ˆã§ãã‚‹ï¼ å‚è€ƒï¼šhttps://little-hands.hatenablog.com/entry/2019/12/02/cqrs 01-02. å‡¦ç†ç³»ã®ç¨®é¡ Commandï¼ˆæ›´æ–°ç³»ï¼‰ ãƒ»Commandã¨ã¯ CREATEï¼ŒUPDATEï¼ŒDELETEå‡¦ç†ã‚’å®Ÿè¡Œã™ã‚‹å‡¦ç†ãƒ•ãƒ­ãƒ¼ã®ã“ã¨ï¼ä»Šå›ï¼Œã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã‚’å‰æã¨ã—ã¦CQRSã‚’èª¬æ˜ã™ã‚‹ï¼æ¦‚å¿µã‚„å®Ÿè£…æ–¹æ³•ã¯ä»¥ä¸‹ã®ãƒªãƒ³ã‚¯ã‚’å‚è€ƒã«ã›ã‚ˆï¼ å‚è€ƒï¼š https://hiroki-it.github.io/tech-notebook-gitbook/public/software/software_application_architecture_backend_domain_driven_design_clean_architecture.html https://github.com/hiroki-it/ddd-api-with-laravel#ddd-api-with-laravel ãƒ»å‡¦ç†é †åº ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹å±¤ã®ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ã«ã¦ï¼Œãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‹ã‚‰ãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒ¢ãƒ‡ãƒ«ã‚’ä½œæˆã™ã‚‹ï¼ ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹å±¤ã®ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ©ã‚¯ã‚¿ãƒ¼ã«ã¦ï¼Œãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒ¢ãƒ‡ãƒ«ã‹ã‚‰ãƒ‡ãƒ¼ã‚¿ã‚’å–ã‚Šå‡ºã—ï¼Œãƒ‰ãƒ¡ã‚¤ãƒ³ãƒ¢ãƒ‡ãƒ«ã‚’ä½œæˆã™ã‚‹ï¼ã“ã‚Œã‚’ã‚¤ãƒ³ãƒ•ãƒ©å±¤ã®ãƒªãƒã‚¸ãƒˆãƒªã«æ¸¡ã™ï¼ ã‚¤ãƒ³ãƒ•ãƒ©å±¤ã®æ›¸ãè¾¼ã¿ï¼èª­ã¿å‡ºã—ãƒªãƒã‚¸ãƒˆãƒªã«ã¦ï¼ŒIDãƒ¢ãƒ‡ãƒ«ã®ãƒ‡ãƒ¼ã‚¿ã‚’ç”¨ã„ã¦ï¼Œèª­ã¿å‡ºã—ï¼æ›¸ãè¾¼ã¿ãƒªãƒã‚¸ãƒˆãƒªã§SELECTæ–‡ã‚’å®Ÿè¡Œã—ï¼ŒDBã‹ã‚‰ãƒ¬ã‚³ãƒ¼ãƒ‰ã‚’é…åˆ—ã¨ã—ã¦å–å¾—ã™ã‚‹ï¼ç¶šã‘ã¦ï¼Œãƒ‰ãƒ¡ã‚¤ãƒ³ãƒ¢ãƒ‡ãƒ«ã‹ã‚‰ãƒ‡ãƒ¼ã‚¿ã‚’å–ã‚Šå‡ºã—ï¼Œé…åˆ—ã®å€¤ã‚’ä¸Šæ›¸ãã™ã‚‹ï¼ã“ã®é…åˆ—ã§INSERTï¼UPDATEæ–‡ã‚’å®Ÿè¡Œã™ã‚‹ï¼ã‚¤ãƒ³ãƒ•ãƒ©å±¤ã®å®Ÿè£…ã¯ï¼Œå…¨ã¦ã‚’è‡ªå‰ã§å®Ÿè£…ã›ãšã«ORMã§ä»£ç”¨ã§ãã‚‹ï¼voidå‹ã‚’ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹å±¤ã®ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ©ã‚¯ã‚¿ãƒ¼ã«æ¸¡ã™ï¼ ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹å±¤ã®ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ©ã‚¯ã‚¿ãƒ¼ã«ã¦ï¼Œãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒ¢ãƒ‡ãƒ«ã‹ã‚‰ä½œæˆã—ãŸæ™‚ã«ç”¨ã„ãŸãƒ‰ãƒ¡ã‚¤ãƒ³ãƒ¢ãƒ‡ãƒ«ã‚’ç”¨ã„ã¦ï¼Œãƒ¬ã‚¹ãƒãƒ³ã‚¹ãƒ¢ãƒ‡ãƒ«ã‚’ä½œæˆã™ã‚‹ï¼ãƒ¬ã‚¹ãƒãƒ³ã‚¹ãƒ¢ãƒ‡ãƒ«ã‚’ã‚¤ãƒ³ã‚¿ãƒ•ã‚§ãƒ¼ã‚¹å±¤ã®ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ã«æ¸¡ã™ï¼ ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹å±¤ã®ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ã«ã¦ï¼Œãƒ¬ã‚¹ãƒãƒ³ã‚¹ãƒ¢ãƒ‡ãƒ«ã‚’JSONã«å¤‰æ›ã—ï¼Œãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’è¿”ä¿¡ã™ã‚‹ï¼ Queryï¼ˆå‚ç…§ç³»ï¼‰ ãƒ»Queryã¨ã¯ READå‡¦ç†ã‚’å®Ÿè¡Œã™ã‚‹ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®ã“ã¨ï¼ä»Šå›ï¼Œã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã‚’å‰æã¨ã—ã¦CQRSã‚’èª¬æ˜ã™ã‚‹ï¼Queryã§ã¯æ¦‚å¿µã‚„å®Ÿè£…æ–¹æ³•ã¯ä»¥ä¸‹ã®ãƒªãƒ³ã‚¯ã‚’å‚è€ƒã«ã›ã‚ˆï¼ å‚è€ƒï¼š https://hiroki-it.github.io/tech-notebook-gitbook/public/software/software_application_architecture_backend_domain_driven_design_clean_architecture.html https://github.com/hiroki-it/ddd-api-with-laravel#ddd-api-with-laravel ãƒ»å‡¦ç†é †åº ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹å±¤ã®ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ã«ã¦ï¼Œãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‹ã‚‰ãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒ¢ãƒ‡ãƒ«ã‚’ä½œæˆã™ã‚‹ï¼ ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹å±¤ã®ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ©ã‚¯ã‚¿ãƒ¼ã«ã¦ï¼Œãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒ¢ãƒ‡ãƒ«ã‹ã‚‰ãƒ‡ãƒ¼ã‚¿ã‚’å–ã‚Šå‡ºã—ï¼ŒQueryCriteriaã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆï¼ˆå‚ç…§ç³»æ¤œç´¢æ¡ä»¶ï¼‰ã‚’ä½œæˆã™ã‚‹ï¼ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹ã«å¿œã˜ãŸQueryServiceã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã«ãŠã„ã¦ï¼ŒQueryCriteriaã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’ç”¨ã„ã¦ï¼ŒDBã‹ã‚‰ãƒ¬ã‚³ãƒ¼ãƒ‰ã‚’é…åˆ—ã¨ã—ã¦å–å¾—ã™ã‚‹ï¼ã“ã®é…åˆ—ã‹ã‚‰ãã®ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹ã«å¯¾å¿œã™ã‚‹DTOã‚’ä½œæˆã™ã‚‹ï¼DTOã‚’ãƒ¬ã‚¹ãƒãƒ³ã‚¹ãƒ¢ãƒ‡ãƒ«ã¨è¦‹ãªã—ï¼Œãã®ã¾ã¾ã‚¤ãƒ³ã‚¿ãƒ•ã‚§ãƒ¼ã‚¹å±¤ã®ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ã«æ¸¡ã™ï¼ å‚è€ƒï¼š https://stackoverflow.com/questions/19620404/entity-vs-dto-in-cqrs https://softwareengineering.stackexchange.com/questions/378909/in-what-layer-are-the-dtos-stored-with-cqrs ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹å±¤ã®ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ã«ã¦ï¼ŒDTOã‚’JSONã«å¤‰æ›ã—ï¼Œãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’è¿”ä¿¡ã™ã‚‹ï¼ 02. CQRSã«åŸºã¥ãã‚¤ãƒ™ãƒ³ãƒˆé§†å‹•ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ CQRSã¨ã‚¤ãƒ™ãƒ³ãƒˆã‚½ãƒ¼ã‚·ãƒ³ã‚°ã®é–¢ä¿‚ ã‚¤ãƒ™ãƒ³ãƒˆã‚½ãƒ¼ã‚·ãƒ³ã‚°ã®å®Ÿè£…æ–¹æ³•ã¯æ§˜ã€…ã‚ã‚‹ï¼ã‚¤ãƒ™ãƒ³ãƒˆã‚½ãƒ¼ã‚·ãƒ³ã‚°ã§ã¯DBã‚¢ã‚¯ã‚»ã‚¹ã®å‡¦ç†ã‚’æ›´æ–°ç³»ã¨å‚ç…§ç³»ã«åˆ†é›¢ã™ã‚‹ã“ã¨ã«ãªã‚‹ãŸã‚ï¼ŒCQRSã®æ–¹æ³•è«–ã¨ç›¸æ€§ãŒè‰¯ã„ï¼ å‚è€ƒï¼š https://little-hands.hatenablog.com/entry/2019/12/02/cqrs https://postd.cc/using-cqrs-with-event-sourcing/ "},"public/software/software_application_architecture_frontend.html":{"url":"public/software/software_application_architecture_frontend.html","title":"ğŸ“– ï¸ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£","keywords":"","body":"ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ ã¯ã˜ã‚ã« æœ¬ã‚µã‚¤ãƒˆã«ã¤ãã¾ã—ã¦ï¼Œä»¥ä¸‹ã‚’ã”èªè­˜ã®ã»ã©å®œã—ããŠé¡˜ã„ã„ãŸã—ã¾ã™ï¼ å‚è€ƒï¼šhttps://hiroki-it.github.io/tech-notebook-gitbook/ 01. SPAï¼šSingle Page Application SPAã¨ã¯ ãƒ–ãƒ©ã‚¦ã‚¶ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã®ã‚¹ãƒ†ãƒƒãƒ— å®Ÿè¡Œè€… Loading ãƒ–ãƒ©ã‚¦ã‚¶ Scripting ãƒ–ãƒ©ã‚¦ã‚¶ Rendering ãƒ–ãƒ©ã‚¦ã‚¶ Paiting ãƒ–ãƒ©ã‚¦ã‚¶ 1ã¤ã®Webãƒšãƒ¼ã‚¸ã®ä¸­ã§ï¼Œã‚µãƒ¼ãƒã¨ãƒ‡ãƒ¼ã‚¿ã‚’éåŒæœŸé€šä¿¡ã—ï¼Œãƒ–ãƒ©ã‚¦ã‚¶å´ã§éƒ¨åˆ†çš„ã«é™çš„ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç”Ÿæˆã™ã‚‹æ–¹æ³•ã®ã“ã¨ï¼ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå´ã§ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã‚’è¡Œã†ãŸã‚ï¼ŒSSRã¨æ¯”è¼ƒã—ã¦CSRï¼šClient Server side Renderingã¨ã‚‚ã„ã†ï¼éåŒæœŸé€šä¿¡ã¯ï¼ŒAjaxã®æ‰‹æ³•ã‚’ç”¨ã„ã¦å®Ÿç¾ã•ã‚Œã‚‹ï¼ã¾ãŸï¼Œé™çš„ãƒ•ã‚¡ã‚¤ãƒ«ã®éƒ¨åˆ†çš„ãªç”Ÿæˆã¯ï¼ŒMVVMã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã«ã‚ˆã£ã¦å®Ÿç¾ã™ã‚‹ï¼SPAã§ã¯ï¼Œãƒšãƒ¼ã‚¸å…¨ä½“ã®é™çš„ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒªã‚¯ã‚¨ã‚¹ãƒˆã™ã‚‹ã®ã¯æœ€åˆã®ã¿ã§ï¼Œãã‚Œä»¥é™ã¯ãƒšãƒ¼ã‚¸å…¨ä½“ã‚’ãƒªã‚¯ã‚¨ã‚¹ãƒˆã™ã‚‹ã“ã¨ã¯ãªã„ï¼ï¼’å›ç›®ä»¥é™ã¯ï¼Œãƒšãƒ¼ã‚¸éƒ¨åˆ†çš„ã«ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’è¡Œã„ï¼Œã‚µãƒ¼ãƒå´ã‹ã‚‰JSONã‚’å—ã‘å–ã£ã¦ã„ãï¼ å‚è€ƒï¼šhttps://developers.google.com/analytics/devguides/collection/analyticsjs/single-page-applications?hl=ja SPAã®å®Ÿè£…æ–¹æ³• ãƒ»MVVMã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ Viewå±¤ã¨Modelå±¤ã®é–“ã«ViewModelå±¤ã‚’ç½®ãï¼ŒViewå±¤ã¨ViewModelå±¤ã®é–“ã§åŒæ–¹å‘ã«ãƒ‡ãƒ¼ã‚¿ã‚’ã‚„ã‚Šå–ã‚Šï¼ˆåŒæ–¹å‘ãƒ‡ãƒ¼ã‚¿ãƒã‚¤ãƒ³ãƒ‡ã‚£ãƒ³ã‚°ï¼‰ã™ã‚‹ã“ã¨ã«ã‚ˆã£ã¦ï¼ŒViewå±¤ã¨Modelå±¤ã®é–“ã‚’ç–çµåˆã«ã™ã‚‹ãŸã‚ã®è¨­è¨ˆæ‰‹æ³•ã®ä¸€ã¤ï¼Vue.jsã§ã¯ï¼Œæ„è­˜ã›ãšã«MVVMã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã§å®Ÿè£…ã§ãã‚‹ã‚ˆã†ã«ãªã£ã¦ã„ã‚‹ï¼è©³ã—ãã¯ï¼Œä»¥ä¸‹ã®ãƒªãƒ³ã‚¯ã‚’å‚è€ƒã«ã›ã‚ˆï¼ å‚è€ƒï¼šhttps://hiroki-it.github.io/tech-notebook-gitbook/public/software/software_application_frontend_js_framework_vuejs.html SPAã¨å¾“æ¥MPAã®æ¯”è¼ƒ ãƒ»å‡¦ç†é€Ÿåº¦ MPAã¨æ¯”è¼ƒã—ã¦ï¼Œãƒ‡ãƒ¼ã‚¿ã‚’éåŒæœŸçš„ã«é€šä¿¡ã§ãã‚‹ãŸã‚ï¼Œ1ã¤ã®Webãƒšãƒ¼ã‚¸ã®ä¸­ã§å¿…è¦ãªãƒ‡ãƒ¼ã‚¿ã ã‘ã‚’é€šä¿¡ã™ã‚Œã°ã‚ˆãï¼Œãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ãŒé€Ÿã„ï¼ 02. SSRï¼šServer Side Rendering åºƒç¾©ã®SSRã¨ã¯ ãƒ–ãƒ©ã‚¦ã‚¶å´ã§ã¯ãªãã‚µãƒ¼ãƒå´ã§JavaScriptã‚’å®Ÿè¡Œã—ï¼Œé™çš„ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç”Ÿæˆã™ã‚‹æ–¹æ³•ã®ã“ã¨ï¼ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã®ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚¨ãƒ³ã‚¸ãƒ³ã‚„CGIã‚’ç”¨ã„ã¦ï¼Œã‚µãƒ¼ãƒå´ã§é™çš„ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç”Ÿæˆã™ã‚‹ã“ã¨ï¼Œã‚‚å«ã¾ã‚Œã‚‹ï¼ å‚è€ƒï¼š https://tadtadya.com/summary-of-the-web-site-display-process-flow/#index-list-8 https://ja.nuxtjs.org/docs/2.x/concepts/server-side-rendering ãƒ–ãƒ©ã‚¦ã‚¶ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã®ã‚¹ãƒ†ãƒƒãƒ— å®Ÿè¡Œè€… Loading ã‚µãƒ¼ãƒ Scripting ã‚µãƒ¼ãƒ Rendering ã‚µãƒ¼ãƒ Paiting ãƒ–ãƒ©ã‚¦ã‚¶ ç‹­ç¾©ã®SSRã¨ã¯ åºƒç¾©ã®SSRã«SPAã‚’å–ã‚Šå…¥ã‚ŒãŸæ–¹æ³•ã®ã“ã¨ï¼ãƒ–ãƒ©ã‚¦ã‚¶å´ã§ã¯ãªãã‚µãƒ¼ãƒå´ã§JavaScriptã‚’å®Ÿè¡Œã—ï¼Œé™çš„ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç”Ÿæˆã™ã‚‹ï¼ãƒ–ãƒ©ã‚¦ã‚¶å´ã«ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã•ã‚ŒãŸå¾Œï¼Œã‚¢ã‚¤ã‚½ãƒ¢ãƒ¼ãƒ•ã‚£ãƒƒã‚¯JavaScriptã¨ã„ã†ä»•çµ„ã¿ã§SPAã¨ã—ã¦å‹•ä½œã™ã‚‹ï¼ å‚è€ƒï¼š https://qiita.com/rita0222/items/66fec6e7be5987bace3c https://qiita.com/kyrieleison/items/4ac5bcc331aee6394440#%E3%82%AF%E3%83%A9%E3%82%A4%E3%82%A2%E3%83%B3%E3%83%88%E3%82%B5%E3%82%A4%E3%83%89%E3%81%A8%E3%82%B5%E3%83%BC%E3%83%90%E3%82%B5%E3%82%A4%E3%83%89%E3%81%AE%E3%82%B3%E3%83%BC%E3%83%89%E5%85%B1%E6%9C%89 03. SSGï¼šStatic Site Generation SSGã¨ã¯ äº‹å‰ã«ãƒ“ãƒ«ãƒ‰ã‚’è¡Œã£ã¦é™çš„ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç”Ÿæˆã—ã¦ãŠãï¼ãã—ã¦ï¼Œã“ã‚Œã‚’ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã—ï¼Œé™çš„ã‚µã‚¤ãƒˆã¨ã—ã¦ç¨¼åƒã•ã›ã‚‹ï¼å‹•çš„ãªè¦ç´ ï¼ˆä¾‹ï¼šãƒ©ãƒ³ãƒ€ãƒ è¡¨ç¤ºï¼‰ã‚’å«ã‚€é™çš„ãƒ•ã‚¡ã‚¤ãƒ«ã«ã¤ã„ã¦ã¯ï¼Œè©²å½“ã®éƒ¨åˆ†ã§Ajaxã‚’ä½¿ç”¨ã§ãã‚‹ã‚ˆã†ã«ã—ã¦ãŠãï¼ 04. ISRï¼šIncremental Static Regeneration ISRã¨ã¯ SSGã®ç™ºå±•å‹ï¼SSGã¨ã¯ç•°ãªã‚Šï¼Œäº‹å‰ã«ãƒ“ãƒ«ãƒ‰ã›ãšï¼Œé™çš„ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç”Ÿæˆã—ãªã„ï¼ãã®ä»£ã‚ã‚Šï¼Œã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‹ã‚‰ãƒªã‚¯ã‚¨ã‚¹ãƒˆãŒã‚ã£ã¦åˆã‚ã¦ï¼Œãã®ãƒšãƒ¼ã‚¸ã®ã¿ãƒ“ãƒ«ãƒ‰ãŒå®Ÿè¡Œã•ã‚Œï¼Œãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã•ã‚Œã‚‹ï¼ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‹ã‚‰ä¸€å›ã§ã‚‚ãƒªã‚¯ã‚¨ã‚¹ãƒˆãŒã‚ã£ãŸãƒšãƒ¼ã‚¸ã§ã¯ï¼Œåˆå›æ™‚ã«ãƒ“ãƒ«ãƒ‰ã•ã‚ŒãŸé™çš„ãƒ•ã‚¡ã‚¤ãƒ«ãŒãã®éƒ½åº¦ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã•ã‚Œã‚‹ï¼ å‚è€ƒï¼šhttps://nextjs.org/docs/basic-features/data-fetching#incremental-static-regeneration 05. ãƒã‚¤ã‚¯ãƒ­ã‚µãƒ¼ãƒ“ã‚¹ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã«ãŠã‘ã‚‹ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ UIéƒ¨å“åˆæˆ ãƒ»UIéƒ¨å“åˆæˆã¨ã¯ ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’ï¼Œå„ã‚µãƒ¼ãƒ“ã‚¹ã«å¯¾å¿œã™ã‚‹ã‚ˆã†ã«åˆ†å‰²ã™ã‚‹è¨­è¨ˆæ–¹æ³•ï¼ BFFãƒ‘ã‚¿ãƒ¼ãƒ³ï¼šBackends For Frontends ãƒ»BFFãƒ‘ã‚¿ãƒ¼ãƒ³ã¨ã¯ ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã®ç¨®é¡ï¼ˆãƒ¢ãƒã‚¤ãƒ«ï¼ŒWebï¼Œãƒ‡ã‚¹ã‚¯ãƒˆãƒƒãƒ—ï¼‰ã«å¿œã˜ãŸAPIã‚’æ§‹ç¯‰ã—ï¼Œã“ã®APIã‹ã‚‰å„ã‚µãƒ¼ãƒ“ã‚¹ã«ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã™ã‚‹è¨­è¨ˆæ–¹æ³•ï¼BFFãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’å®Ÿè£…ã¯å¯èƒ½ã§ã‚ã‚‹ãŒï¼ŒAWSã§ã„ã†API Gatewayã§ä»£ç”¨ã™ã‚‹ã¨ã‚ˆã‚Šç°¡å˜ã«å®Ÿç¾ã§ãã‚‹ï¼ "},"public/software/software_application_collaboration_json.html":{"url":"public/software/software_application_collaboration_json.html","title":"ğŸ“– ï¸JSON","keywords":"","body":"JSON ã¯ã˜ã‚ã« æœ¬ã‚µã‚¤ãƒˆã«ã¤ãã¾ã—ã¦ï¼Œä»¥ä¸‹ã‚’ã”èªè­˜ã®ã»ã©å®œã—ããŠé¡˜ã„ã„ãŸã—ã¾ã™ï¼ å‚è€ƒï¼šhttps://hiroki-it.github.io/tech-notebook-gitbook/ 01. ãƒ‡ãƒ¼ã‚¿è¨˜è¿°è¨€èª ãƒ‡ãƒ¼ã‚¿è¨˜è¿°è¨€èªã®ç¨®é¡ ãƒ»JSONï¼šJavaScript Object Notation ä¸€ç•ªå¤–å´ã‚’æ³¢æ‹¬å¼§ã§å›²ã†ï¼ { \"account\": 200, \"fruit\": [ \"banana\", \"apple\" ] } ãƒ»YAMLï¼šYAML Ain\"t a Markup Language account: 200 fruit: - \"banana\" - \"apple\" ãƒ»ãƒãƒ¼ã‚¯ã‚¢ãƒƒãƒ—è¨€èª è©³ã—ãã¯ä»¥ä¸‹ã®ãƒãƒ¼ãƒˆã‚’å‚è€ƒã«ã›ã‚ˆï¼ å‚è€ƒï¼šhttps://hiroki-it.github.io/tech-notebook-gitbook/public/frontend_browser_rendering.html ãƒ»CSVï¼šComma Separated Vector ãƒ‡ãƒ¼ã‚¿è§£æã®å…¥åŠ›ãƒ•ã‚¡ã‚¤ãƒ«ã¨ã—ã¦ã‚ˆãä½¿ã†ã‚„ã¤ï¼ 02-01. JSå‹ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆï¼ŒJSONï¼ŒPHPå‹ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ JSå‹ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ ãƒ»å®šç¾©æ–¹æ³• ã‚­ãƒ¼ã¯ã‚¯ã‚ªãƒ¼ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ã§å›²ã†å¿…è¦ãŒç„¡ã„ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š const object = { \"account\": 200, \"fruit\": [ \"banana\", \"apple\" ] }; class Foo { constructor(fruit, account) { this.fruit = fruit; this.account = account; } } JSON ãƒ»å®šç¾©æ–¹æ³• ã‚­ãƒ¼ã‚’ï¼Œã‚·ãƒ³ã‚°ãƒ«ã‚¯ã‚ªãƒ¼ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ã§ã¯ãªãï¼Œã‚¯ã‚ªãƒ¼ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ã§å›²ã†å¿…è¦ãŒã‚ã‚‹ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š const json = { \"account\": 200, \"fruit\": [ \"banana\", \"apple\" ] }; ãƒ»ã‚­ãƒ¼ã¨å€¤ã®å¤‰æ›´æ–¹æ³• ï¼Šå®Ÿè£…ä¾‹ï¼Š // ã©ã‚“ãªãƒ‡ãƒ¼ã‚¿ã‚’å«ã‚€JSONãªã®ã‹ã‚ã‹ã‚Šã‚„ã™ã„æ–¹æ³• const json = { \"age\": null, \"name\": null, \"tel\": null } json.age = 30; json.name = \"taro\"; json.tel = \"090-0123-4567\"; ï¼Šå®Ÿè£…ä¾‹ï¼Š const json = {} // areaã¨ã„ã†ã‚­ãƒ¼ã®å€¤ã‚’è¿½åŠ  json.prefecture = \"Tokyo\"; // ã‚‚ã—ãã¯ï¼Œ json[\"prefecture\"] = \"Tokyo\"; // ä»¥ä¸‹ã¯ï¼undefined ã«ãªã‚‹ï¼äºŒæ®µéšã®å®šç¾©ã¯ã§ããªã„ï¼ //// json.prefecture.area = \"Shibuya\"; ï¼Šå®Ÿè£…ä¾‹ï¼Š const json = { \"age\": 30, \"name\": \"taro\", \"tel\": \"090-0123-4567\" } // areaã¨ã„ã†ã‚­ãƒ¼ã®å€¤ã‚’è¿½åŠ  json.prefecture = \"Tokyo\"; // ã‚‚ã—ãã¯ï¼Œ json[\"prefecture\"] = \"Tokyo\"; ãƒ»ã‚­ãƒ¼ã®ä¸¦ã³é † ã‚­ãƒ¼ã¯ã‚¢ãƒ«ãƒ•ã‚¡ãƒ™ãƒƒãƒˆé †ã«ä¸¦ã¹ã‚‹ã¨è‰¯ã„ï¼ä»¥ä¸‹ã®ã‚µã‚¤ãƒˆã§ä¸¦ã³æ›¿ãˆã‚‰ã‚Œã‚‹ï¼ å‚è€ƒï¼šhttps://r37r0m0d3l.github.io/json_sort/ PHPå‹ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ ãƒ»å®šç¾©æ–¹æ³• ï¼Šå®Ÿè£…ä¾‹ï¼Š fruit = $fruit; $this->account = $account; } } 02-02. ç›¸äº’ãƒ‘ãƒ¼ã‚¹ï¼ˆã‚·ãƒªã‚¢ãƒ©ã‚¤ã‚ºï¼‹ãƒ‡ã‚·ãƒªã‚¢ãƒ©ã‚¤ã‚ºï¼‰ ã‚·ãƒªã‚¢ãƒ©ã‚¤ã‚ºï¼Œãƒ‡ã‚·ãƒªã‚¢ãƒ©ã‚¤ã‚ºã¨ã¯ ãƒ»ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã¨ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰é–“ ãƒ‡ãƒ¼ã‚¿é€ä¿¡ã®ãŸã‚ã«ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆï¼ˆJSå‹ï¼ŒPHPå‹ï¼‰ã‚’JSONã«å¤‰æ›ã™ã‚‹å‡¦ç†ã¯ã‚·ãƒªã‚¢ãƒ©ã‚¤ã‚ºã§ã‚ã‚‹ï¼ä¸€æ–¹ã§ï¼Œé€ä¿¡ã®ãŸã‚ã«JSONã‚’ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆï¼ˆJSå‹ï¼ŒPHPå‹ï¼‰ã«å¤‰æ›ã™ã‚‹å‡¦ç†ã¯ãƒ‡ã‚·ãƒªã‚¢ãƒ©ã‚¤ã‚ºã§ã‚ã‚‹ï¼ ãƒ»ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã¨ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹é–“ ãƒ‡ãƒ¼ã‚¿é€ä¿¡ã®ãŸã‚ã«ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆï¼ˆPHPå‹ï¼‰ã‚’JSONã«å¤‰æ›ã™ã‚‹å‡¦ç†ã¯ã‚·ãƒªã‚¢ãƒ©ã‚¤ã‚ºã§ã‚ã‚‹ï¼ä¸€æ–¹ã§ï¼Œé€ä¿¡ã®ãŸã‚ã«JSONã‚’ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆï¼ˆPHPå‹ï¼‰ã«å¤‰æ›ã™ã‚‹å‡¦ç†ã¯ãƒ‡ã‚·ãƒªã‚¢ãƒ©ã‚¤ã‚ºã§ã‚ã‚‹ï¼ ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ ãƒ»ã‚·ãƒªã‚¢ãƒ©ã‚¤ã‚ºï¼šJSå‹ã‹ã‚‰JSON JSå‹ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‹ã‚‰JSONã¸ã®å¤‰æ›ã«ã¯ï¼ŒJSON.stringfyãƒ¡ã‚½ãƒƒãƒ‰ã‚’ä½¿ç”¨ã™ã‚‹ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š const object = { fruit: [\"banana\", \"apple\"], account: 200 }; // ã‚·ãƒªã‚¢ãƒ©ã‚¤ã‚º const json = JSON.stringify(object); console.log(json); // {\"fruit\":[\"banana\",\"apple\"],\"account\":200} ãƒ»ãƒ‡ã‚·ãƒªã‚¢ãƒ©ã‚¤ã‚ºï¼šJSONã‹ã‚‰JSå‹ JSONã‹ã‚‰JSå‹ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã¸ã®å¤‰æ›ã«ã¯ï¼ŒJSON.parseãƒ¡ã‚½ãƒƒãƒ‰ã‚’ä½¿ç”¨ã™ã‚‹ï¼ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã•ã‚ŒãŸJSONã¯ã‚¨ã‚¹ã‚±ãƒ¼ãƒ—ã•ã‚Œã¦ã„ã‚‹ã“ã¨ã«æ³¨æ„ã™ã‚‹ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š const escapedJson = \"{\\\"fruit\\\":[\\\"banana\\\",\\\"apple\\\"],\\\"account\\\":200}\" console.log(escapedJson); // {\"fruit\":[\"banana\",\"apple\"],\"account\":200} // ãƒ‡ã‚·ãƒªã‚¢ãƒ©ã‚¤ã‚º const object = JSON.parse(escapedJson); console.log(object); // { fruit: [ 'banana', 'apple' ], account: 200 } ãƒ»ç›¸äº’ãƒ‘ãƒ¼ã‚¹ãƒ¡ã‚½ãƒƒãƒ‰ã‚’æŒã¤ã‚¯ãƒ©ã‚¹ ï¼Šå®Ÿè£…ä¾‹ï¼Š ä»¥ä¸‹ã§ã‚·ãƒªã‚¢ãƒ©ã‚¤ã‚ºã¨ãƒ‡ã‚·ãƒªã‚¢ãƒ©ã‚¤ã‚ºã‚’è¡Œã†ã‚¯ãƒ©ã‚¹ã‚’ç¤ºã™ï¼ class StaffParser { // ãƒ‡ã‚·ãƒªã‚¢ãƒ©ã‚¤ã‚ºã«ã‚ˆã‚‹JSå‹ãƒ‡ãƒ¼ã‚¿ã‚’è‡ªèº«ã«è¨­å®š constructor(properties) { this.id = properties.id; this.name = properties.name; } //-- ãƒ‡ã‚·ãƒªã‚¢ãƒ©ã‚¤ã‚ºï¼ˆJSONã‹ã‚‰JavaScriptã¸ï¼‰ --// static deserializeStaff(json) { // JSå‹ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®å®šç¾©æ–¹æ³• return new StaffParser({ id: json.id, name: json.name }); } //-- ã‚·ãƒªã‚¢ãƒ©ã‚¤ã‚ºï¼ˆJavaScriptã‹ã‚‰JSONã¸ï¼‰ --// static serializeCriteria(criteria) { // JSONã®å®šç¾© const json = { \"id\" : null, \"name\" : null } // ID if (criteria.id) { // JSONãŒç”Ÿæˆã•ã‚Œã‚‹ï¼ json.id = _.trim(criteria.id); } // æ°å if (criteria.name) { json.name = _.trim(criteria.name); } } } ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ ãƒ»ãƒ‡ã‚·ãƒªã‚¢ãƒ©ã‚¤ã‚ºï¼šJSONã‹ã‚‰PHPå‹ JSONã‹ã‚‰PHPå‹ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®å¤‰æ›ã«ã¯ï¼json_decodeãƒ¡ã‚½ãƒƒãƒ‰ã‚’ä½¿ç”¨ã™ã‚‹ï¼ç¬¬äºŒå¼•æ•°ãŒfalseã®å ´åˆï¼Œobjectå½¢å¼ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã«å¤‰æ›ã™ã‚‹ï¼ãƒªã‚¯ã‚¨ã‚¹ãƒˆã§é€ä¿¡ã™ã‚‹JSONã¯ã‚¨ã‚¹ã‚±ãƒ¼ãƒ—ã™ã‚‹å¿…è¦ãŒã‚ã‚‹ã“ã¨ã«æ³¨æ„ã™ã‚‹ï¼ // array(2) { // [0]=> // string(9) \"banana\" // [1]=> // string(9) \"apple\" // } // [\"account\"]=> // int(200) // } ç¬¬äºŒå¼•æ•°ãŒtrueã®å ´åˆï¼Œé€£æƒ³é…åˆ—å½¢å¼ã«å¤‰æ›ã™ã‚‹ï¼ // array(2) { // [0]=> // string(9) \"banana\" // [1]=> // string(9) \"apple\" // } // [\"account\"]=> // int(200) // } ãƒ»ã‚·ãƒªã‚¢ãƒ©ã‚¤ã‚ºï¼šPHPå‹ã‹ã‚‰JSON 03. JSONã®ã‚¯ã‚¨ãƒªè¨€èª ã‚¯ã‚¨ãƒªè¨€èªã®ç¨®é¡ ãƒ»JMESPath ï¼Šå®Ÿè£…ä¾‹ï¼Š // ã“ã“ã«å®Ÿè£…ä¾‹ "},"public/software/software_application_collaboration_communication.html":{"url":"public/software/software_application_collaboration_communication.html","title":"ğŸ“– ï¸ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³é–“é€šä¿¡","keywords":"","body":"ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³é–“é€šä¿¡ 01. åŒæœŸé€šä¿¡ 02. éåŒæœŸé€šä¿¡ éåŒæœŸé€šä¿¡ã¨ã¯ éåŒæœŸå‡¦ç†ã®ä¸€ç¨®ã§ã‚ã‚‹ï¼ãã®ãŸã‚ï¼Œé€šä¿¡ã®å®Œäº†ã‚’å¾…ãŸãšã«å¾Œç¶šã®å‡¦ç†ãŒå§‹ã¾ã‚‹ï¼å¾Œç¶šã®å…¨å‡¦ç†ãŒéåŒæœŸé€šä¿¡ã¨ç„¡é–¢ä¿‚ã§ã‚ã‚Œã°ï¼Œãã®ã¾ã¾ã§å•é¡Œã¯èµ·ã“ã‚‰ãªã„ï¼ã—ã‹ã—ï¼Œå¾Œç¶šã®å‡¦ç†ã«éåŒæœŸé€šä¿¡ã®çµæœã‚’ä½¿ç”¨ã™ã‚‹ã‚‚ã®ãŒå«ã¾ã‚Œã¦ã„ã‚‹å ´åˆï¼Œã“ã®å‡¦ç†ã ã‘ã¯éåŒæœŸé€šä¿¡ã®å¾Œã«å®Ÿè¡Œã•ã‚Œã‚‹ã‚ˆã†ã«å®šç¾©ã™ã‚‹å¿…è¦ãŒã‚ã‚‹ï¼ç‰¹å®šã®å‡¦ç†ãŒéåŒæœŸé€šä¿¡ã®å¾Œã«å®Ÿè¡Œã•ã‚Œã‚‹ã‚ˆã†ã«å®šç¾©ã™ã‚‹æ–¹æ³•ã«ã¤ã„ã¦ã¯ï¼Œä»¥ä¸‹ã®ãƒªãƒ³ã‚¯ã‚’å‚è€ƒã«ã›ã‚ˆï¼ å‚è€ƒï¼šhttps://hiroki-it.github.io/tech-notebook-gitbook/public/software/software_application_frontend_js_logic_asynchronous_process.html 03. JavaScriptã«ãŠã‘ã‚‹éåŒæœŸé€šä¿¡ Ajaxï¼šAsynchronous JavaScript + XML ãƒ»Ajaxã¨ã¯ JavaScriptã§éåŒæœŸé€šä¿¡ã‚’å®Ÿç¾ã™ã‚‹æ‰‹æ³•ã®ã“ã¨ï¼JavaScriptï¼ŒHTMLï¼ŒXHTMLï¼ŒCSSï¼ŒDOMï¼ŒXMLï¼ŒXSLTï¼Œã‚’çµ„ã¿åˆã‚ã›ã‚‹ï¼ ãƒ»Ajaxã®ä»•çµ„ã¿ urlã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ã“ã¨ã«ã‚ˆã‚Šï¼Œã‚µãƒ¼ãƒã‹ã‚‰ãƒ‡ãƒ¼ã‚¿ãŒãƒ¬ã‚¹ãƒãƒ³ã‚¹ã•ã‚Œã‚‹ï¼ DOMã®ãƒãƒ¼ã‚¯ã‚¢ãƒƒãƒ—è¨€èªã®è§£æã«ã‚ˆã‚Šï¼ŒWebãƒšãƒ¼ã‚¸ãŒæ§‹æˆã•ã‚Œã‚‹ï¼ ãƒšãƒ¼ã‚¸ä¸Šã§ä»»æ„ã®ã‚¤ãƒ™ãƒ³ãƒˆï¼ˆãƒšãƒ¼ã‚¸ãƒ³ã‚°æ“ä½œï¼Œãƒ•ã‚©ãƒ¼ãƒ å…¥åŠ›ãªã©ï¼‰ãŒç™ºç«ã—ï¼Œç´ä»˜ããƒãƒ³ãƒ‰ãƒ©é–¢æ•°ãŒå®Ÿè¡Œã•ã‚Œã‚‹ï¼ JavaScriptå‹ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆãŒJSONã«å¤‰æ›ã•ã‚Œã‚‹ï¼ éåŒæœŸé€šä¿¡ã«ã‚ˆã‚Šï¼Œãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã«ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é€ä¿¡ã™ã‚‹ï¼ ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ã¯ï¼ŒJSONå‹ãƒ‡ãƒ¼ã‚¿ã‚’å—ä¿¡ã—ï¼Œã¾ãŸãã‚Œã‚’å…ƒã«DBã‹ã‚‰ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’Readã™ã‚‹ï¼ ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ã¯ï¼ŒPHPå‹ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’JSONã«å¤‰æ›ã—ï¼Œãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’è¿”ä¿¡ã™ã‚‹ï¼ éåŒæœŸé€šä¿¡ãƒ¡ã‚½ãƒƒãƒ‰ãŒãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã‹ã‚‰ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’å—ä¿¡ã™ã‚‹ï¼ JSONãŒJavaScriptå‹ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã«å¤‰æ›ã•ã‚Œã‚‹ï¼ ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆãŒãƒãƒ¼ã‚¯ã‚¢ãƒƒãƒ—è¨€èªã«å‡ºåŠ›ã•ã‚Œã‚‹ï¼ DOMã‚’ç”¨ã„ã¦ï¼ŒWebãƒšãƒ¼ã‚¸ã‚’å†ã³æ§‹æˆã™ã‚‹ï¼ ãƒ»å®Ÿè£…æ–¹æ³•ã®ç¨®é¡ æ­´å²çš„ã«ï¼ŒAjaxã‚’å®Ÿè£…ã™ã‚‹ãŸã‚ã®æ–¹æ³•ãŒã„ãã¤ã‹ã‚ã‚‹ï¼ ç¨®é¡ æä¾› èª¬æ˜ è£œè¶³ xhrã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ ãƒ“ãƒ«ãƒˆã‚¤ãƒ³ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ ä»Šã§ã¯ä½¿ã†ã“ã¨ã¯å°‘ãªã„ãŒï¼ŒAjaxãŒç™»å ´ã—ãŸåˆæœŸã®é ƒã«ã‚ˆãä½¿ã‚ã‚ŒãŸï¼ å‚è€ƒï¼šhttps://developer.mozilla.org/ja/docs/Web/API/XMLHttpRequest/Using_XMLHttpRequest fetchãƒ¡ã‚½ãƒƒãƒ‰ ãƒ“ãƒ«ãƒˆã‚¤ãƒ³é–¢æ•° å‚è€ƒï¼šhttps://developer.mozilla.org/ja/docs/Web/API/Fetch_API/Using_Fetch JQueryã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ JQueryãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ å‚è€ƒï¼šãƒ»https://api.jquery.com/category/ajax/shorthand-methods/ãƒ»https://api.jquery.com/jquery.ajax axiosã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ Axiosãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ å‚è€ƒï¼šhttps://github.com/axios/axios#request-method-aliases 03-02. å®Ÿè£… xhrã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®å ´åˆ ãƒ»GETé€ä¿¡ å‚è€ƒï¼šhttps://blog.capilano-fw.com/?p=6920#Ajax ï¼Šå®Ÿè£…ä¾‹ï¼Š // URL const url = 'https://example.co.jp/'; const xhr = new XMLHttpRequest(); // HTTPãƒ¡ã‚½ãƒƒãƒ‰ã‚’æŒ‡å®š xhr.open('GET', url); // ãƒ¬ã‚¹ãƒãƒ³ã‚¹å—ä¿¡å¾Œã®å‡¦ç† xhr.onload = () => { if(xhr.status === 200) { const data = JSON.parse(xhr.responseText); console.log(data); } }; // æœ€å¾Œã«é€ä¿¡ã‚’å®Ÿè¡Œ xhr.send(); ãƒ»POSTé€ä¿¡ å‚è€ƒï¼šhttps://blog.capilano-fw.com/?p=6920#Ajax ï¼Šå®Ÿè£…ä¾‹ï¼Š // URL const url = 'https://example.co.jp/'; // ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãƒœãƒ‡ã‚£ const body = { name: 'Hiroki', email: 'example@gmail.com', password: 'password' }; const queries = []; for(const key in body) { const query = key +'='+ encodeURIComponent(params[key]); queries.push(query); } const queryString = queries.join('&'); const xhr = new XMLHttpRequest(); // HTTPãƒ¡ã‚½ãƒƒãƒ‰ã‚’æŒ‡å®š xhr.open('POST', url); // é€ä¿¡ã™ã‚‹ãƒ‡ãƒ¼ã‚¿å‹ xhr.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded'); // ãƒ¬ã‚¹ãƒãƒ³ã‚¹å—ä¿¡å¾Œã®å‡¦ç† xhr.onload = () => { if(xhr.status === 200) { const data = JSON.parse(xhr.responseText); console.log(data); } }; // æœ€å¾Œã«é€ä¿¡ã‚’å®Ÿè¡Œ xhr.send(queryString); JQueryã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®å ´åˆ ãƒ»GETé€ä¿¡ ï¼Šå®Ÿè£…ä¾‹ï¼Š const url = 'https://example.co.jp/'; $.get(url); ãƒ»POSTé€ä¿¡ ï¼Šå®Ÿè£…ä¾‹ï¼Š const url = 'https://example.co.jp/'; const body = { name: 'Hiroki', email: 'example@gmail.com', password: 'password' }; $.post(url, params); ãƒ»ä»»æ„ã®HTTPãƒ¡ã‚½ãƒƒãƒ‰ ä»»æ„ã®HTTPãƒ¡ã‚½ãƒƒãƒ‰ï¼ŒURLï¼Œãƒ˜ãƒƒãƒ€ãƒ¼ï¼Œãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãƒœãƒ‡ã‚£ãªã©ã‚’è¨­å®šã—ï¼ŒéåŒæœŸçš„ã«ãƒ‡ãƒ¼ã‚¿ã‚’é€å—ä¿¡ã™ã‚‹ï¼Promiseã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’è¿”å´ã™ã‚‹ï¼ å‚è€ƒï¼šhttps://api.jquery.com/jquery.ajax ï¼Šå®Ÿè£…ä¾‹ï¼Š const id = 1; $.ajax({ // ################### // ãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ // ################### // HTTPãƒ¡ã‚½ãƒƒãƒ‰ type: 'POST', // URL url: '/xxx/xxx/' + id + '/', // é€ä¿¡ã™ã‚‹ãƒ‡ãƒ¼ã‚¿å‹ contentType: 'application/json', // ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãƒœãƒ‡ã‚£ data: { name: 'Hiroki', email: 'example@gmail.com', password: 'password' }, // ################### // ãƒ¬ã‚¹ãƒãƒ³ã‚¹ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ // ################### // å—ä¿¡ã™ã‚‹ãƒ‡ãƒ¼ã‚¿å‹ dataType: 'json', }) Axiosã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®å ´åˆ ãƒ»GETé€ä¿¡ ï¼Šå®Ÿè£…ä¾‹ï¼Š const url = 'https://example.co.jp/'; axios.get(url); ãƒ»POSTé€ä¿¡ ï¼Šå®Ÿè£…ä¾‹ï¼Š const url = 'https://example.co.jp/'; const body = { name: 'Hiroki', email: 'example@gmail.com', password: 'password' }; axios.post(url, params); "},"public/software/software_application_collaboration_authentication_authorization.html":{"url":"public/software/software_application_collaboration_authentication_authorization.html","title":"ğŸ“– ï¸èªè¨¼ï¼èªå¯","keywords":"","body":"Authenticateï¼ˆèªè¨¼ï¼‰ï¼Authorizationï¼ˆèªå¯ï¼‰ ã¯ã˜ã‚ã« æœ¬ã‚µã‚¤ãƒˆã«ã¤ãã¾ã—ã¦ï¼Œä»¥ä¸‹ã‚’ã”èªè­˜ã®ã»ã©å®œã—ããŠé¡˜ã„ã„ãŸã—ã¾ã™ï¼ å‚è€ƒï¼šhttps://hiroki-it.github.io/tech-notebook-gitbook/ 01. HTTPèªè¨¼ HTTPèªè¨¼ã¨ã¯ èªè¨¼æ™‚ã«HTTPé€šä¿¡ã®ä¸­ã§èªè¨¼ã‚’è¡Œã†ã“ã¨ï¼ãƒªã‚¯ã‚¨ã‚¹ãƒˆã®authorizationãƒ˜ãƒƒãƒ€ãƒ¼ã¨ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã®WWW-Authenticateãƒ˜ãƒƒãƒ€ãƒ¼ã§èªè¨¼ã‚¹ã‚­ãƒ¼ãƒ ã‚’æŒ‡å®šã™ã‚‹ï¼èªè¨¼ã‚¹ã‚­ãƒ¼ãƒ ã®ç¨®é¡ã«ã¯ï¼Œã€Basicèªè¨¼ã€ï¼Œã€Digestèªè¨¼ã€ï¼Œã€Bearerèªè¨¼ã€ãªã©ãŒã‚ã‚‹ï¼èªè¨¼æƒ…å ±ã®ä¸€æ™‚çš„ãªä¿å­˜ã¯ï¼Œãƒ–ãƒ©ã‚¦ã‚¶ã®WebStoregeã§è¡Œã†ãŸã‚ï¼Œèªè¨¼è§£é™¤ï¼ˆãƒ­ã‚°ã‚¢ã‚¦ãƒˆï¼‰ã‚’ã‚µãƒ¼ãƒå´ã§å®Œå…¨ã«åˆ¶å¾¡ã§ããªã„ï¼ å‚è€ƒï¼š https://www.iana.org/assignments/http-authschemes/http-authschemes.xhtml https://architecting.hateblo.jp/entry/2020/03/27/130535 https://developer.mozilla.org/ja/docs/Web/HTTP/Authentication#authentication_schemes Basicèªè¨¼ ãƒ»Basicèªè¨¼ã®ä»•çµ„ã¿ å½¹å‰² èª¬æ˜ ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ ãƒªã‚¯ã‚¨ã‚¹ãƒˆé€ä¿¡å…ƒã®ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ã“ã¨ï¼æ–‡è„ˆã«ã‚ˆã£ã¦ã¯ï¼Œãƒ–ãƒ©ã‚¦ã‚¶ãŒã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã§ã‚ã‚‹å ´åˆã¨ãã†ã§ãªã„å ´åˆï¼ˆä¾‹ï¼šOAuthèªè¨¼ï¼‰ãŒã‚ã‚‹ï¼ ãƒ¦ãƒ¼ã‚¶ ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚’ä½¿ç”¨ã—ã¦ã„ã‚‹äººç‰©ã®ã“ã¨ï¼ ã‚µãƒ¼ãƒ ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‹ã‚‰ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’å—ä¿¡ã—ï¼Œãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’é€ä¿¡ã™ã‚‹ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ã“ã¨ï¼ æœ€åˆï¼Œã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã¯ï¼Œèªè¨¼å¾Œã«ã‚¢ã‚¯ã‚»ã‚¹ã§ãã‚‹ãƒšãƒ¼ã‚¸ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’ã‚µãƒ¼ãƒã«é€ä¿¡ã™ã‚‹ï¼ GET https://example.co.jp/foo-form HTTP/2 ã‚µãƒ¼ãƒã¯ï¼Œã“ã‚Œæ‹’å¦ã—ï¼Œ401ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã§èªè¨¼é ˜åŸŸã‚’è¨­å®šã—ï¼Œãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’é€ä¿¡ã™ã‚‹ï¼ã“ã‚Œã«ã‚ˆã‚Šï¼Œèªè¨¼é ˜åŸŸã®å€¤ã‚’ãƒ¦ãƒ¼ã‚¶ã«ç¤ºã—ã¦ï¼Œãƒ¦ãƒ¼ã‚¶åã¨ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã®å…¥åŠ›ã‚’æ±‚ã‚ã‚‹ã“ã¨ãŒã§ãã‚‹ï¼ãƒ¦ãƒ¼ã‚¶ã«è¡¨ç¤ºã™ã‚‹ãŸã‚ã®èªè¨¼é ˜åŸŸã«ã¯ï¼Œä»»æ„ã®å€¤ã‚’æŒãŸã›ã‚‹ã“ã¨ãŒã§ãï¼Œã‚µã‚¤ãƒˆåãŒè¨­å®šã•ã‚Œã‚‹ã“ã¨ãŒå¤šã„ï¼ 401 Unauthorized WWW-Authenticate: Basic realm=\"\", charaset=\"UTF-8\" ã€:ã€ã‚’Base64ã§ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ã—ãŸå€¤ã‚’authorizationãƒ˜ãƒƒãƒ€ãƒ¼ã«å‰²ã‚Šå½“ã¦ï¼Œãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é€ä¿¡ã™ã‚‹ï¼ POST https://example.co.jp/foo-form HTTP/2 authorization: Basic bG9naW46cGFzc3dvcmQ= ã‚µãƒ¼ãƒã¯ï¼Œãƒ¦ãƒ¼ã‚¶åã¨ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’ç…§åˆã—ï¼Œåˆè‡´ã—ã¦ã„ã‚Œã°ï¼Œèªè¨¼å¾Œãƒšãƒ¼ã‚¸ã®ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’é€ä¿¡ã™ã‚‹ï¼ã¾ãŸï¼Œèªè¨¼æƒ…å ±ã‚’ãƒ–ãƒ©ã‚¦ã‚¶ã®Webã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã«ä¿å­˜ã™ã‚‹ï¼ 200 OK WWW-Authenticate: Basic realm=\"\" èªè¨¼ã®è§£é™¤æ™‚ã¯ï¼Œèª¤ã£ãŸèªè¨¼æƒ…å ±ã‚’ãƒ–ãƒ©ã‚¦ã‚¶ã«æ„å›³çš„ã«é€ä¿¡ã•ã›ã¦èªè¨¼ã‚’å¤±æ•—ã•ã›ã‚‹ã‚ˆã†ã«ã™ã‚‹ï¼ å‚è€ƒï¼šhttps://stackoverflow.com/questions/4163122/http-basic-authentication-log-out POST https://example.co.jp/foo-form/logout HTTP/2 authorization: Basic ã‚µãƒ¼ãƒã¯ï¼Œ401ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã§ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’è¿”ä¿¡ã—ï¼Œèªè¨¼ãŒè§£é™¤ã•ã‚Œã‚‹ï¼ 401 Unauthorized WWW-Authenticate: Basic realm=\"\", charaset=\"UTF-8\" Digestèªè¨¼ ãƒ»Digestèªè¨¼ã®ä»•çµ„ã¿ 200 OK WWW-Authenticate: Basic realm=\"\", charaset=\"UTF-8\" POST https://example.co.jp/foo-form HTTP/2 authorization: Digest realm=\"\" nonce=\"\" algorithm=\"\" qoq=\"auth\" Bearerèªè¨¼ ãƒ»Bearerèªè¨¼ã¨ã¯ èªè¨¼æ™‚ã«Bearerãƒˆãƒ¼ã‚¯ãƒ³ã‚’ä½¿ç”¨ã™ã‚‹èªè¨¼ã‚¹ã‚­ãƒ¼ãƒ ã®ã“ã¨ï¼ ãƒ»Bearerãƒˆãƒ¼ã‚¯ãƒ³ï¼ˆç½²åãªã—ãƒˆãƒ¼ã‚¯ãƒ³ï¼‰ã¨ã¯ å˜ãªã‚‹æ–‡å­—åˆ—ã§å®šç¾©ã•ã‚ŒãŸã‚¢ã‚¯ã‚»ã‚¹ãƒˆãƒ¼ã‚¯ãƒ³ï¼Bearerèªè¨¼ã«ã¦ï¼Œãƒˆãƒ¼ã‚¯ãƒ³ã¨ã—ã¦ä½¿ç”¨ã™ã‚‹ï¼ç½²åãªã—ãƒˆãƒ¼ã‚¯ãƒ³ã¨ã‚‚å‘¼ã°ã‚Œï¼Œå®Ÿéš›ã«èªè¨¼ã•ã‚ŒãŸæœ¬äººã‹ã©ã†ã‹ã‚’åˆ¤å®šã™ã‚‹æ©Ÿèƒ½ã¯ç„¡ãï¼Œãƒˆãƒ¼ã‚¯ãƒ³ã‚’æŒã£ã¦ã„ã‚Œã°ãã‚Œã‚’æœ¬äººã¨ã—ã¦èªå¯ã™ã‚‹ï¼ãã®ãŸã‚ï¼Œãƒˆãƒ¼ã‚¯ãƒ³ã®æ–‡å­—åˆ—ãŒæµå‡ºã—ã¦ã—ã¾ã‚ãªã„ã‚ˆã†ï¼Œå³é‡ã«ç®¡ç†ã™ã‚‹å¿…è¦ãŒã‚ã‚‹ï¼Bearerãƒˆãƒ¼ã‚¯ãƒ³ã‚’ä½¿ç”¨ã™ã‚‹Bearerèªè¨¼ã«ã¤ã„ã¦ã¯ï¼Œåˆ¥é …ç›®ã®èª¬æ˜ã‚’å‚è€ƒã«ã›ã‚ˆï¼ å‚è€ƒï¼šhttps://openid-foundation-japan.github.io/rfc6750.ja.html#anchor3 ãƒ»Bearerèªè¨¼ã®ä»•çµ„ã¿ æŒ‡å®šã•ã‚ŒãŸã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã«å¯¾ã—ã¦ï¼ŒPOSTãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é€ä¿¡ã™ã‚‹ï¼ã“ã®æ™‚ï¼ŒContent-Typeãƒ˜ãƒƒãƒ€ãƒ¼ã‚’application/x-www-form-urlencodedã¨ã™ã‚‹ï¼å¿…è¦ãªãƒœãƒ‡ã‚£ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã¯APIã®æä¾›å…ƒã«ã‚ˆã£ã¦ç•°ãªã‚‹ï¼ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆIDï¼Œä»˜ä¸ã‚¿ã‚¤ãƒ—ï¼Œãªã©ãŒå¿…è¦ãªã“ã¨ãŒå¤šã„ï¼ å‚è€ƒï¼š https://developer.amazon.com/ja/docs/adm/request-access-token.html#request-format https://ja.developer.box.com/reference/post-oauth2-token/#request POST https://example.co.jp/foo HTTP/2 Content-Type: application/x-www-form-urlencoded # ãƒœãƒ‡ã‚£ client_id=*****&grant_type=client_credentials&scope=messaging:push ãƒ¬ã‚¹ãƒãƒ³ã‚¹ãƒœãƒ‡ã‚£ã«Bearerãƒˆãƒ¼ã‚¯ãƒ³ã‚’å«ã‚€ãƒ¬ã‚¹ãƒãƒ³ã‚¹ãŒè¿”ä¿¡ã•ã‚Œã‚‹ï¼ä»–ã«ï¼Œæœ‰åŠ¹æœŸé™ï¼Œæ¨©é™ã®ã‚¹ã‚³ãƒ¼ãƒ—ï¼ŒæŒ‡å®šå¯èƒ½ãªèªè¨¼ã‚¹ã‚­ãƒ¼ãƒï¼Œãªã©ãŒæä¾›ã•ã‚Œã‚‹ã“ã¨ãŒå¤šã„ï¼ å‚è€ƒï¼š https://developer.amazon.com/ja/docs/adm/request-access-token.html#request-format https://ja.developer.box.com/reference/resources/access-token/ 200 OK X-Amzn-RequestId: d917ceac-2245-11e2-a270-0bc161cb589d Content-Type: application/json { \"access_token\":\"*****\", \"expires_in\":3600, \"scope\":\"messaging:push\", \"token_type\":\"Bearer\" } ç™ºè¡Œã•ã‚ŒãŸBearerãƒˆãƒ¼ã‚¯ãƒ³ã‚’æŒ‡å®šã•ã‚ŒãŸèªè¨¼ã‚¹ã‚­ãƒ¼ãƒã§Authorizationãƒ˜ãƒƒãƒ€ãƒ¼ã«å‰²ã‚Šå½“ã¦ï¼Œãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é€ä¿¡ã™ã‚‹ï¼ã“ã“ã§ã¯è©³ã—ãè¨€åŠã—ãªã„ãŒï¼ŒBearerãƒˆãƒ¼ã‚¯ãƒ³ã‚’Formèªè¨¼ã®ã‚ˆã†ã«Cookieãƒ˜ãƒƒãƒ€ãƒ¼ã«å‰²ã‚Šå½“ã¦ã‚‹ã“ã¨ã‚‚ã‚ã‚‹ï¼ å‚è€ƒï¼š https://stackoverflow.com/questions/34817617/should-jwt-be-stored-in-localstorage-or-cookie https://ja.developer.box.com/reference/post-oauth2-token/#response POST https://example.co.jp/foo HTTP/2 authorization: Bearer ã‚µãƒ¼ãƒã¯ï¼ŒBearerãƒˆãƒ¼ã‚¯ãƒ³ã‚’ç…§åˆã—ï¼Œåˆè‡´ã—ã¦ã„ã‚Œã°ï¼Œèªè¨¼å¾Œãƒšãƒ¼ã‚¸ã®ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’é€ä¿¡ã™ã‚‹ï¼ç„¡åŠ¹ãªBearerãƒˆãƒ¼ã‚¯ãƒ³ã‚’ãƒ–ãƒ©ãƒƒã‚¯ãƒªã‚¹ãƒˆã¨ã—ã¦Redisï¼DBã§ç®¡ç†ã—ã¦ãŠãï¼DBã§ãƒ–ãƒ©ãƒƒã‚¯ãƒªã‚¹ãƒˆã‚’ç®¡ç†ã™ã‚‹ã¨ï¼Œãƒªã‚¯ã‚¨ã‚¹ãƒˆã®åº¦ã«DBã‚¢ã‚¯ã‚»ã‚¹å‡¦ç†ãŒå®Ÿè¡Œã•ã‚Œã‚‹ã“ã¨ãªã£ã¦ã—ã¾ã†ãŸã‚ï¼ŒRedisã§ã“ã‚Œã‚’ç®¡ç†ã—ãŸæ–¹ãŒè‰¯ã„ï¼ 200 OK WWW-Authenticate: Bearer realm=\"\" èªè¨¼ã®è§£é™¤æ™‚ã¯ï¼ŒRedisï¼DBã§Bearerãƒˆãƒ¼ã‚¯ãƒ³ã®çŠ¶æ…‹ã‚’ç„¡åŠ¹åŒ–ã™ã‚‹ï¼ã¾ãŸã‚µãƒ¼ãƒã¯ï¼Œ401ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã§ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’è¿”ä¿¡ã—ï¼Œèªè¨¼ãŒè§£é™¤ã•ã‚Œã‚‹ï¼ å‚è€ƒï¼š https://stackoverflow.com/questions/21978658/invalidating-json-web-tokens https://medium.com/devgorilla/how-to-log-out-when-using-jwt-a8c7823e8a6 401 Unauthorized WWW-Authenticate: Basic realm=\"\", charaset=\"UTF-8\" ãƒ»æ­£å¸¸ç³»ï¼ç•°å¸¸ç³»ãƒ¬ã‚¹ãƒãƒ³ã‚¹ å‚è€ƒï¼šhttps://qiita.com/h_tyokinuhata/items/ab8e0337085997be04b1 æˆåŠŸã®å ´åˆã¯ï¼Œrealmå±æ€§ã‚’ç©ºã«ã—ãŸãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’è¿”ä¿¡ã™ã‚‹ï¼ 200 OK WWW-Authenticate: Bearer realm=\"\" å¤±æ•—ã®å ´åˆã¯ï¼Œerrorå±æ€§ã«ã‚¨ãƒ©ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å‰²ã‚Šå½“ã¦ãŸãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’è¿”ä¿¡ã™ã‚‹ï¼ 400 Bad Request WWW-Authenticate: Bearer error=\"invalid_request\" 401 Unauthorized WWW-Authenticate: Bearer realm=\"token_required\" 403 Forbidden WWW-Authenticate: Bearer error=\"insufficient_scope\" ãƒ»Authorizationãƒ˜ãƒƒãƒ€ãƒ¼ã®ãƒˆãƒ¼ã‚¯ãƒ³ã®ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆä¿æŒ ä¸ä¾¿ã§ã¯ã‚ã‚‹ãŒï¼ŒAuthorizationãƒ˜ãƒƒãƒ€ãƒ¼ã¯Cookieãƒ˜ãƒƒãƒ€ãƒ¼ã¨ã¯ç•°ãªã‚Šï¼Œãƒ­ãƒ¼ã‚«ãƒ«PCã«ä¿å­˜ã§ããªã„ï¼ãã®ä»£ã‚ã‚Šï¼Œãƒ–ãƒ©ã‚¦ã‚¶ã®è¨­å®šã«ã‚ˆã£ã¦ï¼Œãƒ–ãƒ©ã‚¦ã‚¶ã®WebStorageã§ã‚‚ä¿æŒã§ãã‚‹ï¼Chromeã§ã¯ï¼ŒLocalStorageï¼SessionStorageã«ä¿æŒã•ã‚Œã‚‹ï¼LocalStorageã¯SessionStorageã¨æ¯”ã¹ã¦ä¿å­˜æœŸé–“ãŒé•·ã„ãŸã‚ï¼ŒXSSã®å±é™ºæ€§ãŒã‚ˆã‚Šé«˜ã„ï¼ã“ã‚Œã‚‰ã®ç¢ºèªæ–¹æ³•ã«ã¤ã„ã¦ã¯ï¼Œä»¥ä¸‹ã®ãƒªãƒ³ã‚¯ã‚’å‚è€ƒã«ã›ã‚ˆ å‚è€ƒï¼š https://developer.chrome.com/docs/devtools/storage/localstorage/ https://developer.chrome.com/docs/devtools/storage/sessionstorage/ https://stackoverflow.com/questions/5523140/html5-local-storage-vs-session-storage OAuthèªè¨¼ ãƒ»OAuthèªè¨¼ã¨ã¯ OAuthã®é …ç›®ã‚’å‚è€ƒã«ã›ã‚ˆï¼ 01-02. HTTPèªè¨¼ä»¥å¤–ã®èªè¨¼æ–¹æ³• Formèªè¨¼ï¼ˆCookieãƒ™ãƒ¼ã‚¹ã®èªè¨¼ï¼‰ ãƒ»Formèªè¨¼ã¨ã¯ èªè¨¼æ™‚ã«Cookieãƒ˜ãƒƒãƒ€ãƒ¼ã®å€¤ã‚’ä½¿ç”¨ã™ã‚‹æ–¹æ³•ã®ã“ã¨ï¼ã€`Cookieãƒ™ãƒ¼ã‚¹ã®èªè¨¼ã€ã¨ã‚‚ã„ã†ï¼StatefulåŒ–ã‚’è¡Œã†ãŸã‚ï¼ŒHTTPèªè¨¼ã«ã¯å±ã—ã¦ã„ãªã„ï¼èªè¨¼æƒ…å ±ã®ä¸€æ™‚çš„ãªä¿å­˜ã¯ï¼Œã‚µãƒ¼ãƒã®ã‚»ãƒƒã‚·ãƒ§ãƒ³ãƒ•ã‚¡ã‚¤ãƒ«ã§è¡Œã†ãŸã‚ï¼Œèªè¨¼è§£é™¤ï¼ˆãƒ­ã‚°ã‚¢ã‚¦ãƒˆï¼‰ã‚’ã‚µãƒ¼ãƒå´ã§åˆ¶å¾¡ã§ãã‚‹ï¼Cookieãƒ˜ãƒƒãƒ€ãƒ¼ã«ã‚ˆã‚‹é€å—ä¿¡ã§ã¯ï¼ŒCSRFã®å±é™ºæ€§ãŒã‚ã‚‹ï¼ å‚è€ƒï¼š https://h50146.www5.hpe.com/products/software/security/icewall/iwsoftware/report/certification.html https://auth0.com/docs/sessions/cookies#cookie-based-authentication ãƒ»ã‚»ãƒƒã‚·ãƒ§ãƒ³IDã‚’ç”¨ã„ãŸFormèªè¨¼ã®å ´åˆï¼ˆã‚»ãƒƒã‚·ãƒ§ãƒ³ãƒ™ãƒ¼ã‚¹ï¼‰ ã‚»ãƒƒã‚·ãƒ§ãƒ³IDã‚’Cookieãƒ˜ãƒƒãƒ€ãƒ¼ã«å‰²ã‚Šå½“ã¦ï¼Œãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é€ä¿¡ã™ã‚‹ï¼ æœ€åˆï¼Œãƒ¦ãƒ¼ã‚¶ä½œæˆã®æ®µéšã§ï¼Œã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆãŒèªè¨¼æƒ…å ±ã‚’ã‚µãƒ¼ãƒã«é€ä¿¡ã™ã‚‹ï¼ã‚µãƒ¼ãƒã¯ï¼Œèªè¨¼æƒ…å ±ã‚’ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã«ä¿å­˜ã™ã‚‹ï¼ POST https://example.co.jp/users HTTP/2 { \"email_address\": \"foo@gmail.com\", \"password\": \"foo\" } æ¬¡å›ã®èªè¨¼æ™‚ã«ï¼Œå†ã³ãƒ¦ãƒ¼ã‚¶ãŒèªè¨¼æƒ…å ±ã‚’é€ä¿¡ã™ã‚‹ï¼ POST https://example.co.jp/foo-form HTTP/2 { \"email_address\": \"foo@gmail.com\", \"password\": \"foo\" } ã‚µãƒ¼ãƒã¯ï¼Œãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®èªè¨¼æƒ…å ±ã‚’ç…§åˆã—ï¼Œãƒ­ã‚°ã‚¤ãƒ³ã‚’è¨±å¯ã™ã‚‹ï¼ã‚µãƒ¼ãƒã¯ï¼Œã‚»ãƒƒã‚·ãƒ§ãƒ³IDã‚’ç”Ÿæˆã—ï¼Œã‚»ãƒƒã‚·ãƒ§ãƒ³ãƒ•ã‚¡ã‚¤ãƒ«ã«æ›¸ãè¾¼ã‚€ï¼ # ã‚»ãƒƒã‚·ãƒ§ãƒ³ãƒ•ã‚¡ã‚¤ãƒ« { sessionid: ***** } ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã®Set-Cookieãƒ˜ãƒƒãƒ€ãƒ¼ã‚’ä½¿ç”¨ã—ã¦ï¼Œã‚»ãƒƒã‚·ãƒ§ãƒ³IDã‚’ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã«é€ä¿¡ã™ã‚‹ï¼ 200 OK Set-Cookie: sessionid= ã‚µãƒ¼ãƒã¯ï¼Œã‚»ãƒƒã‚·ãƒ§ãƒ³IDã¨ãƒ¦ãƒ¼ã‚¶IDã‚’ç´ä»˜ã‘ã¦ã‚µãƒ¼ãƒå†…ã«ä¿å­˜ã™ã‚‹ï¼ã•ã‚‰ã«æ¬¡å›ã®ãƒ­ã‚°ã‚¤ãƒ³æ™‚ï¼Œã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã¯ï¼Œãƒªã‚¯ã‚¨ã‚¹ãƒˆã®Cookieãƒ˜ãƒƒãƒ€ãƒ¼ã‚’ä½¿ç”¨ã—ã¦ï¼Œã‚»ãƒƒã‚·ãƒ§ãƒ³IDã‚’ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã«é€ä¿¡ã™ã‚‹ï¼ã‚µãƒ¼ãƒã¯ï¼Œä¿å­˜ã•ã‚ŒãŸã‚»ãƒƒã‚·ãƒ§ãƒ³IDã«ç´ä»˜ããƒ¦ãƒ¼ã‚¶IDã‹ã‚‰ï¼Œãƒ¦ãƒ¼ã‚¶ã‚’ç‰¹å®šã—ï¼Œãƒ­ã‚°ã‚¤ãƒ³ã‚’è¨±å¯ã™ã‚‹ï¼ã“ã‚Œã«ã‚ˆã‚Šï¼Œæ”¹ã‚ã¦èªè¨¼æƒ…å ±ã‚’é€ä¿¡ã›ãšã«ï¼Œç´ æ—©ããƒ­ã‚°ã‚¤ãƒ³ã§ãã‚‹ã‚ˆã†ã«ãªã‚‹ï¼ POST https://example.co.jp/foo-form HTTP/2 cookie: sessionid= èªè¨¼è§£é™¤æ™‚ï¼Œã‚µãƒ¼ãƒã§ã‚»ãƒƒã‚·ãƒ§ãƒ³ãƒ•ã‚¡ã‚¤ãƒ«ã‚’å‰Šé™¤ã™ã‚‹ï¼ å‚è€ƒï¼šhttps://blog.tokumaru.org/2013/02/purpose-and-implementation-of-the-logout-function.html ãƒ»ãƒˆãƒ¼ã‚¯ãƒ³ã‚’ç”¨ã„ãŸFormèªè¨¼ã®å ´åˆï¼ˆãƒˆãƒ¼ã‚¯ãƒ³ãƒ™ãƒ¼ã‚¹ï¼‰ ãƒˆãƒ¼ã‚¯ãƒ³ã‚’Cookieãƒ˜ãƒƒãƒ€ãƒ¼ã«å‰²ã‚Šå½“ã¦ï¼Œãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é€ä¿¡ã™ã‚‹ï¼ã“ã®æ™‚ã®ãƒˆãƒ¼ã‚¯ãƒ³ã®é¸æŠè‚¢ã¨ã—ã¦ï¼Œå˜ãªã‚‹ãƒ©ãƒ³ãƒ€ãƒ ãªæ–‡å­—åˆ—ã‚„JWTãŒã‚ã‚‹ï¼ å‚è€ƒï¼šhttps://scrapbox.io/fendo181/JWT(JSON_Web_Token)%E3%82%92%E7%90%86%E8%A7%A3%E3%81%99%E3%82%8B%E3%80%82 ãƒ»Cookieãƒ˜ãƒƒãƒ€ãƒ¼ã®å€¤ã®ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆä¿æŒ å†åˆ©ç”¨ã®ãŸã‚ï¼ŒCookieãƒ˜ãƒƒãƒ€ãƒ¼ã«å‰²ã‚Šå½“ã¦ã‚‹ãŸã‚ã®å€¤ï¼ˆã‚»ãƒƒã‚·ãƒ§ãƒ³IDï¼Œãƒˆãƒ¼ã‚¯ãƒ³ï¼‰ã¯ï¼Œãƒ–ãƒ©ã‚¦ã‚¶ã‚’é€šã—ã¦ï¼Œãƒ­ãƒ¼ã‚«ãƒ«PCã«æœ‰åŠ¹æœŸé™ã«å¿œã˜ãŸé–“ã ã‘ä¿æŒã§ãã‚‹ï¼ã¾ãŸã¯ãƒ–ãƒ©ã‚¦ã‚¶ã®è¨­å®šã«ã‚ˆã£ã¦ï¼Œãƒ–ãƒ©ã‚¦ã‚¶ã®Webã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã§ã‚‚ä¿æŒã§ãã‚‹ï¼Chromeã®å ´åˆã¯ï¼ŒCookieã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã«ä¿æŒã•ã‚Œã‚‹ï¼ç¢ºèªæ–¹æ³•ã«ã¤ã„ã¦ã¯ï¼Œä»¥ä¸‹ã®ãƒªãƒ³ã‚¯ã‚’å‚è€ƒã«ã›ã‚ˆï¼ å‚è€ƒï¼š https://developer.chrome.com/docs/devtools/storage/cookies/ https://qiita.com/cobachan/items/05fa537a4ffcb189d001 APIã‚­ãƒ¼èªè¨¼ ãƒ»APIã‚­ãƒ¼èªè¨¼ã¨ã¯ äº‹å‰ã«APIã‚­ãƒ¼ã¨ãªã‚‹æ–‡å­—åˆ—ã‚’é…å¸ƒã—ï¼Œèªè¨¼ãƒ•ã‚§ãƒ¼ã‚¹ã¯è¡Œã‚ãšã«èªå¯ãƒ•ã‚§ãƒ¼ã‚ºã®ã¿ã§ãƒ¦ãƒ¼ã‚¶ã‚’ç…§åˆã™ã‚‹æ–¹æ³•ã®ã“ã¨ï¼API Gatewayã«ãŠã‘ã‚‹APIã‚­ãƒ¼èªè¨¼ã«ã¤ã„ã¦ã¯ï¼Œä»¥ä¸‹ã‚’å‚è€ƒã«ã›ã‚ˆï¼ å‚è€ƒï¼šhttps://hiroki-it.github.io/tech-notebook-gitbook/public/cloud_computing/cloud_computing_aws.html ãƒ»ç…§åˆæƒ…å ±ã®é€ä¿¡æ–¹æ³• ç‹¬è‡ªãƒ˜ãƒƒãƒ€ãƒ¼ã¨ã—ã¦ï¼Œx-api-keyãƒ˜ãƒƒãƒ€ãƒ¼ã‚’å®šç¾©ã™ã‚‹ï¼ã“ã‚Œã«APIã‚­ãƒ¼ã‚’å‰²ã‚Šå½“ã¦ï¼Œãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é€ä¿¡ã™ã‚‹ï¼ãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒ˜ãƒƒãƒ€ã¸ã®ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã®å‰²ã‚Šå½“ã¦ã«ã¤ã„ã¦ã¯ï¼Œä»¥ä¸‹ã‚’å‚è€ƒã«ã›ã‚ˆï¼ å‚è€ƒï¼šhttps://hiroki-it.github.io/tech-notebook-gitbook/public/software/software_application_collaboration_api_restful.html GET https://example.co.jp/bar.php HTTP/2 x-api-key: Personal Access Tokenã«ã‚ˆã‚‹èªè¨¼ï¼šPAT ãƒ»PATã«ã‚ˆã‚‹èªè¨¼ ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆãŒPersonal Access Tokenï¼ˆå€‹äººç”¨ã‚¢ã‚¯ã‚»ã‚¹ãƒˆãƒ¼ã‚¯ãƒ³ï¼‰ã®ä»˜ä¸ã‚’ãƒªã‚¯ã‚¨ã‚¹ãƒˆã—ï¼Œèªè¨¼ãƒ•ã‚§ãƒ¼ã‚¹ã¯è¡Œã‚ãšã«èªå¯ãƒ•ã‚§ãƒ¼ã‚ºã®ã¿ã§ãƒ¦ãƒ¼ã‚¶ã‚’ç…§åˆã™ã‚‹æ–¹æ³•ã®ã“ã¨ï¼Authorizationãƒ˜ãƒƒãƒ€ãƒ¼ã«PATã‚’å‰²ã‚Šã‚ã¦ã¦ï¼Œãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é€ä¿¡ã™ã‚‹ï¼ä½œæˆæ™‚ä»¥é™ï¼Œã‚¢ã‚¯ã‚»ã‚¹ãƒˆãƒ¼ã‚¯ãƒ³ã‚’ç¢ºèªã§ããªããªã‚‹ãŸã‚ï¼Œã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆãŒã‚¢ã‚¯ã‚»ã‚¹ãƒˆãƒ¼ã‚¯ãƒ³ã‚’ç®¡ç†ã™ã‚‹å¿…è¦ãŒã‚ã‚‹ï¼ å‚è€ƒï¼šhttps://www.contentful.com/help/personal-access-tokens/ GET https://example.co.jp/bar.php HTTP/2 authorization: ã‚µãƒ¼ãƒ“ã‚¹ä¾‹ ãƒˆãƒ¼ã‚¯ãƒ³å èª¬æ˜ GitHub Personal access Token HTTPSã‚’ä½¿ç”¨ã—ã¦ï¼Œãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆãƒªãƒã‚¸ãƒˆãƒªã«ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é€ä¿¡ã™ã‚‹ãŸã‚ã«å¿…è¦ï¼HTTPSã‚’ä½¿ç”¨ã™ã‚‹å ´é¢ã¨ã—ã¦ï¼Œã‚¢ãƒ—ãƒªã®æ‹¡å¼µæ©Ÿèƒ½ã®GitHubé€£æºï¼Œãƒªãƒã‚¸ãƒˆãƒªã®ãƒ©ã‚¤ãƒ–ãƒ©ãƒªåŒ–ï¼Œãªã©ãŒã‚ã‚‹ï¼å‚è€ƒï¼šhttps://docs.github.com/ja/github/authenticating-to-github/creating-a-personal-access-token 01-03. è¤‡æ•°ã®èªè¨¼ã®çµ„ã¿åˆã‚ã› Two Step Verificationï¼ˆäºŒæ®µéšèªè¨¼ï¼‰ ãƒ»Two Step Verificationã¨ã¯ èªè¨¼æ™‚ã«æ®µéšçš„ã«äºŒã¤ã®æ–¹æ³•ã‚’è¨­å®šã—ï¼Œã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚’ç…§åˆã™ã‚‹æ–¹æ³•ã®ã“ã¨ï¼ ä¸€æ®µéšç›®ã®èªè¨¼ä¾‹ äºŒæ®µéšç›®ã®èªè¨¼ä¾‹ èª¬æ˜ å‚™è€ƒ IDã¨ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ IDã¨ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ IDã¨ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã«ã‚ˆã‚‹æ–¹æ³•ã®å¾Œï¼Œåˆ¥ã®IDã¨ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã«ã‚ˆã‚‹æ–¹æ³•ã‚’è¨­å®šã™ã‚‹ï¼ ç§˜å¯†ã®è³ªå• IDã¨ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã«ã‚ˆã‚‹æ–¹æ³•ã®å¾Œï¼Œè³ªå•ã«å¯¾ã—ã¦ã‚ã‚‰ã‹ã˜ã‚è¨­å®šã—ãŸå›ç­”ã«ã‚ˆã‚‹æ–¹æ³•ã‚’è¨­å®šã™ã‚‹ï¼ SMS IDã¨ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã«ã‚ˆã‚‹æ–¹æ³•ã®å¾Œï¼ŒSMSå®›ã«é€ä¿¡ã—ãŸèªè¨¼ã‚³ãƒ¼ãƒ‰ã«ã‚ˆã‚‹æ–¹æ³•ã‚’è¨­å®šã™ã‚‹ï¼ ç•°ãªã‚‹è¦ç´ ã®ãŸã‚ï¼Œã“ã‚Œã¯äºŒè¦ç´ èªè¨¼ã§ã‚‚ã‚ã‚‹ï¼ æŒ‡ç´‹ IDã¨ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã«ã‚ˆã‚‹æ–¹æ³•ã®å¾Œï¼ŒæŒ‡ç´‹ã®è§£æçµæœã«ã‚ˆã‚‹æ–¹æ³•ã‚’è¨­å®šã™ã‚‹ï¼ ç•°ãªã‚‹è¦ç´ ã®ãŸã‚ï¼Œã“ã‚Œã¯äºŒè¦ç´ èªè¨¼ã§ã‚‚ã‚ã‚‹ï¼ Two Factor Authorizationï¼ˆäºŒè¦ç´ èªè¨¼ï¼‰ ãƒ»Two Factor Authorizationã¨ã¯ äºŒæ®µéšèªè¨¼ã®ã†ã¡ã§ç‰¹ã«ï¼Œèªè¨¼æ™‚ã«ç•°ãªã‚‹è¦ç´ ã®æ–¹æ³•ã‚’ä½¿ç”¨ã—ã¦ï¼Œæ®µéšçš„ã«ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚’ç…§åˆã™ã‚‹ã“ã¨æ–¹æ³•ã®ã“ã¨ï¼å¾Œè¿°ã™ã‚‹OAuthèªè¨¼ã‚’çµ„ã¿è¾¼ã‚“ã§ã‚‚è‰¯ã„ï¼ ä¸€è¦ç´ ç›®ã®èªè¨¼ä¾‹ äºŒè¦ç´ ç›®ã®èªè¨¼ä¾‹ IDã¨ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ï¼ˆçŸ¥è­˜ï¼‰ äº‹å‰ç™»éŒ²ã•ã‚ŒãŸé›»è©±ç•ªå·ã®SMSã§å—ä¿¡ã—ãŸãƒ¯ãƒ³ã‚¿ã‚¤ãƒ ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ï¼ˆæ‰€æŒï¼‰ äº‹å‰ç™»éŒ²ã•ã‚ŒãŸé›»è©±ç•ªå·ã®SMSã§å—ä¿¡ã—ãŸèªè¨¼ã‚³ãƒ¼ãƒ‰ï¼ˆæ‰€æŒï¼‰ OAuthèªè¨¼ï¼ˆæ‰€æŒï¼‰ æŒ‡ç´‹ï¼ˆç”Ÿä½“ï¼‰ æš—è¨¼ç•ªå·ï¼ˆçŸ¥è­˜ï¼‰ ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚«ãƒ¼ãƒ‰ï¼ˆæ‰€æŒï¼‰ 02. èªå¯ãƒ•ã‚§ãƒ¼ã‚º èªè¨¼ãƒ•ã‚§ãƒ¼ã‚ºã¨èªå¯ãƒ•ã‚§ãƒ¼ã‚º ãƒ»å‡¦ç†ã®é•ã„ èªè¨¼ãƒ•ã‚§ãƒ¼ã‚ºã¨èªå¯ãƒ•ã‚§ãƒ¼ã‚ºã§ã¯ï¼Œä»•çµ„ã¿ã®ä¸­ã«ï¼Œï¼“ã¤ã®å½¹å‰²ãŒå®šç¾©ã•ã‚Œã¦ã„ã‚‹ï¼ ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆãŒï¼ŒHTTPãƒªã‚¯ã‚¨ã‚¹ãƒˆã«IDã¨ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’è¨­å®šã—ã¦ãƒªã‚¯ã‚¨ã‚¹ãƒˆï¼ IdPï¼šIdentity ProviderãŒï¼ŒIDã‚’ã€èªè¨¼ã€ã—ï¼Œã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå´ã«ã‚¢ã‚¯ã‚»ã‚¹ãƒˆãƒ¼ã‚¯ãƒ³ã‚’ç™ºè¡Œï¼ ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆãŒï¼ŒHTTPãƒªã‚¯ã‚¨ã‚¹ãƒˆã®ãƒ˜ãƒƒãƒ€ãƒ¼ã«ã‚¢ã‚¯ã‚»ã‚¹ãƒˆãƒ¼ã‚¯ãƒ³ã‚’è¨­å®šã—ã¦ãƒªã‚¯ã‚¨ã‚¹ãƒˆï¼ ã‚¢ã‚¯ã‚»ã‚¹ãƒˆãƒ¼ã‚¯ãƒ³ãŒã€èªå¯ã€ã•ã‚Œã‚Œã°ï¼ŒAPIå´ãŒãƒ‡ãƒ¼ã‚¿ã‚’ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã™ã‚‹ï¼ å½¹å‰² èª¬æ˜ ä¾‹ APIã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ APIã«å¯¾ã—ã¦ï¼Œãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é€ä¿¡ã—ãŸã„ã‚µãƒ¼ãƒã®ã“ã¨ï¼ Ouathèªè¨¼ã®ä»•çµ„ã¿ã«ãŠã‘ã‚‹ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆï¼ Identity Provider ãƒˆãƒ¼ã‚¯ãƒ³ã‚’ç”Ÿæˆã™ã‚‹ã‚µãƒ¼ãƒã®ã“ã¨ï¼ Ouathèªè¨¼ã®ä»•çµ„ã¿ã«ãŠã‘ã‚‹èªå¯ã‚µãƒ¼ãƒï¼ APIã‚µãƒ¼ãƒ ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã«å¯¾ã—ã¦ï¼Œãƒªã‚½ãƒ¼ã‚¹ã®ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’é€ä¿¡ã™ã‚‹ã‚µãƒ¼ãƒã®ã“ã¨ï¼ Ouathèªè¨¼ã®ä»•çµ„ã¿ã«ãŠã‘ã‚‹ãƒªã‚½ãƒ¼ã‚¹ã‚µãƒ¼ãƒï¼ ãƒ»ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚³ãƒ¼ãƒ‰ã®é•ã„ èªè¨¼ãƒ•ã‚§ãƒ¼ã‚ºã«ã¦ï¼Œèª¤ã£ãŸãƒˆãƒ¼ã‚¯ãƒ³ãŒç™ºè¡Œã•ã‚ŒãŸã“ã¨ã‚’è¡¨ç¾ã—ãŸã„å ´åˆï¼Œ401ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚’ä½¿ç”¨ã™ã‚‹ï¼èªå¯ãƒ•ã‚§ãƒ¼ã‚ºã«ã¦ï¼Œæ­£ã—ã„ãƒˆãƒ¼ã‚¯ãƒ³ãŒç™ºè¡Œã•ã‚ŒãŸãŒï¼Œãƒˆãƒ¼ã‚¯ãƒ³ã®æ‰€æœ‰è€…ã«é–²è¦§æ¨©é™ãŒãªã„ã“ã¨ã‚’è¡¨ç¾ã—ãŸã„å ´åˆï¼Œ403ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚’ä½¿ç”¨ã™ã‚‹ï¼ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚³ãƒ¼ãƒ‰ã«ã¤ã„ã¦ã¯ï¼Œä»¥ä¸‹ã®ãƒªãƒ³ã‚¯ã‚’å‚è€ƒã«ã›ã‚ˆï¼ å‚è€ƒï¼šhttps://hiroki-it.github.io/tech-notebook-gitbook/public/software/software_application_collaboration_api_restful.html OAuthãƒ—ãƒ­ãƒˆã‚³ãƒ«ï¼ŒOAuthèªè¨¼ ãƒ»OAuthãƒ—ãƒ­ãƒˆã‚³ãƒ«ï¼ŒOAuthèªè¨¼ã¨ã¯ èªè¨¼èªå¯ãƒ•ã‚§ãƒ¼ã‚ºå…¨ä½“ã®ä¸­ã§ï¼Œèªå¯ãƒ•ã‚§ãƒ¼ã‚ºã«OAuthãƒ—ãƒ­ãƒˆã‚³ãƒ«ã‚’ç”¨ã„ãŸã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã®ç…§åˆæ–¹æ³•ã‚’ã€OAuthèªè¨¼ã€ã¨å‘¼ã¶ï¼èªè¨¼ãƒ•ã‚§ãƒ¼ã‚ºã¨èªå¯ãƒ•ã‚§ãƒ¼ã‚ºã§ã¯ï¼Œï¼“ã¤ã®å½¹å‰²ãŒå®šç¾©ã•ã‚Œã¦ã„ã‚‹ã“ã¨ã‚’èª¬æ˜ã—ãŸãŒï¼ŒOAuthãƒ—ãƒ­ãƒˆã‚³ãƒ«2.0ã§ã¯ï¼Œã‚ˆã‚Šå…·ä½“çš„ã«ï¼”ã¤ã®å½¹å‰²ãŒå®šç¾©ã•ã‚Œã¦ã„ã‚‹ï¼ å½¹å‰² åç§° èª¬æ˜ è£œè¶³ APIã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚¢ãƒ—ãƒª ãƒªã‚½ãƒ¼ã‚¹ã‚ªãƒ¼ãƒŠã«å¯¾ã™ã‚‹ã‚¢ã‚¯ã‚·ãƒ§ãƒ³æ©Ÿèƒ½ã‚’æŒã¤ã‚µãƒ¼ãƒã®ã“ã¨ï¼ OAuthã®æ–‡è„ˆã§ã¯ï¼Œãƒ–ãƒ©ã‚¦ã‚¶ãŒã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã¨å‘¼ã°ã‚Œãªã„ã“ã¨ã«æ³¨æ„ã™ã‚‹ï¼ã¾ãŸï¼Œã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚¢ãƒ—ãƒªã¨ãƒªã‚½ãƒ¼ã‚¹é–“ã®ãƒ‡ãƒ¼ã‚¿é€šä¿¡ã¯ï¼Œãƒ–ãƒ©ã‚¦ã‚¶ã‚’ä»‹ã—ãŸãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆã«ã‚ˆã£ã¦å®Ÿç¾ã™ã‚‹ã“ã¨ã«æ³¨æ„ã™ã‚‹ï¼ ãƒªã‚½ãƒ¼ã‚¹ã‚ªãƒ¼ãƒŠãƒ¼ ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚’ä½¿ç”¨ã—ã¦ã„ã‚‹ãƒ¦ãƒ¼ã‚¶ã®ã“ã¨ï¼ Identity Provider èªå¯ã‚µãƒ¼ãƒ ãƒªã‚½ãƒ¼ã‚¹ã‚µãƒ¼ãƒãŒãƒªã‚½ãƒ¼ã‚¹ã‚ªãƒ¼ãƒŠãƒ¼ã«ã‚¢ã‚¯ã‚»ã‚¹ã§ãã‚‹ãƒˆãƒ¼ã‚¯ãƒ³ã‚’ç”Ÿæˆã™ã‚‹ã‚µãƒ¼ãƒã®ã“ã¨ï¼ èªå¯ã‚µãƒ¼ãƒãŒãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆå…ˆã®ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚¢ãƒ—ãƒªã®URLã‚’ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã«å‰²ã‚Šå½“ã¦ã‚‰ã‚Œã‚‹ã‚ˆã†ã«ï¼Œã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚¢ãƒ—ãƒªã®é–‹ç™ºè€…ãŒURLã‚’äº‹å‰ç™»éŒ²ã—ã¦ãŠãå¿…è¦ãŒã‚ã‚‹ï¼èªå¯ã‚µãƒ¼ãƒã‚’åˆ©ç”¨ã™ã‚‹é–‹ç™ºè€…ç”¨ã«ï¼Œã‚³ãƒ³ã‚½ãƒ¼ãƒ«ç”»é¢ãŒç”¨æ„ã•ã‚Œã¦ã„ã‚‹ã“ã¨ãŒå¤šã„ï¼å‚è€ƒï¼šhttps://qiita.com/TakahikoKawasaki/items/8567c80528da43c7e844 APIã‚µãƒ¼ãƒ ãƒªã‚½ãƒ¼ã‚¹ã‚µãƒ¼ãƒ ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã®ã‚¢ã‚«ã‚¦ãƒ³ãƒˆæƒ…å ±ã‚’æŒã£ã¦ã„ã‚‹ã‚µãƒ¼ãƒã®ã“ã¨ï¼ ãƒ¦ãƒ¼ã‚¶ã¯ï¼ŒFacebookã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’ä½¿ç”¨ã—ã¦Instagramã«ãƒ­ã‚°ã‚¤ãƒ³ã—ã‚ˆã†ã¨ã—ï¼Œãƒ–ãƒ©ã‚¦ã‚¶ã¯Facebookã«ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é€ä¿¡ã™ã‚‹ï¼Facebookã¯Instagramã«ã‚¢ã‚«ã‚¦ãƒ³ãƒˆé€£æºã®æ‰¿èªãƒœã‚¿ãƒ³ã‚’ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã¨ã—ã¦è¿”ä¿¡ã™ã‚‹ï¼ ãƒ¦ãƒ¼ã‚¶ãŒè¡¨ç¤ºã•ã‚ŒãŸæ‰¿èªãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ï¼Œãƒ–ãƒ©ã‚¦ã‚¶ã¯Facebookã«ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é€ä¿¡ã™ã‚‹ï¼ ã‚¢ã‚¯ã‚»ã‚¹ãƒˆãƒ¼ã‚¯ãƒ³ã‚’ç™ºè¡Œã—ã¦ã‚‚ã‚‰ã†ãŸã‚ï¼Œãƒ–ãƒ©ã‚¦ã‚¶ã¯Instagramèªå¯ã‚µãƒ¼ãƒã«ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é€ä¿¡ã™ã‚‹ï¼Instagramã¯ï¼Œã‚¢ã‚¯ã‚»ã‚¹ãƒˆãƒ¼ã‚¯ãƒ³ã‚’ç™ºè¡Œã™ã‚‹ï¼ã¾ãŸï¼ŒFacebookã«ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆã§ãã‚‹ã‚ˆã†ã«ï¼ŒLocationãƒ˜ãƒƒãƒ€ãƒ¼ã«URLã¨èªå¯ãƒ¬ã‚¹ãƒãƒ³ã‚¹ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’å‰²ã‚Šå½“ã¦ï¼Œãƒ–ãƒ©ã‚¦ã‚¶ã«ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’è¿”ä¿¡ã™ã‚‹ï¼ãƒ–ãƒ©ã‚¦ã‚¶ã¯Facebookã«ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’å†é€ä¿¡ã—ï¼ŒFacebookã¯èªå¯ãƒ¬ã‚¹ãƒãƒ³ã‚¹ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’å—ã‘å–ã‚‹ï¼ 302 Found Location: https://example.com/foo.php?code=123&state=abc Facebookã¯ï¼Œã‚¢ã‚¯ã‚»ã‚¹ãƒˆãƒ¼ã‚¯ãƒ³ã‚’å‰²ã‚Šå½“ã¦ãŸãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’Instagramã®ã‚µãƒ¼ãƒã«é€ä¿¡ã™ã‚‹ï¼ Instagramã¯ï¼Œã‚¢ã‚¯ã‚»ã‚¹ãƒˆãƒ¼ã‚¯ãƒ³ã‚’èªè¨¼ã—ï¼Œãƒ‡ãƒ¼ã‚¿ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹ã‚’è¨±å¯ã™ã‚‹ï¼ã¾ãŸï¼ŒFacebookã«ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆã§ãã‚‹ã‚ˆã†ã«ï¼ŒLocationãƒ˜ãƒƒãƒ€ãƒ¼ã«URLã‚’å‰²ã‚Šå½“ã¦ï¼Œãƒ–ãƒ©ã‚¦ã‚¶ã«ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’è¿”ä¿¡ã™ã‚‹ï¼ãƒ–ãƒ©ã‚¦ã‚¶ã‹ã‚‰Facebookã«ãƒ¬ã‚¹ãƒãƒ³ã‚¹ãŒãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆã•ã‚Œã‚‹ï¼ãƒ–ãƒ©ã‚¦ã‚¶ã¯Facebookã«ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’å†é€ä¿¡ã™ã‚‹ï¼ å‚è€ƒï¼š https://boxil.jp/mag/a3207/ https://qiita.com/TakahikoKawasaki/items/8567c80528da43c7e844 ãƒ»ä½¿ç”¨ã•ã‚Œã‚‹èªè¨¼ã‚¹ã‚­ãƒ¼ãƒ  OAuthèªè¨¼ã§ã¯ï¼Œèªè¨¼ã‚¹ã‚­ãƒ¼ãƒã¨ã—ã¦Bearerèªè¨¼ãŒé¸ã°ã‚Œã‚‹ã“ã¨ãŒå¤šãï¼ŒAWSã‚„GitHubã¯ï¼Œç‹¬è‡ªã®èªè¨¼ã‚¹ã‚­ãƒ¼ãƒ ã‚’ä½¿ç”¨ã—ã¦ã„ã‚‹ï¼ãªãŠï¼Œèªå¯ã‚µãƒ¼ãƒã«ã‚ˆã£ã¦ç™ºè¡Œã•ã‚ŒãŸBearerãƒˆãƒ¼ã‚¯ãƒ³ã¯ï¼ŒAuthorizationãƒ˜ãƒƒãƒ€ãƒ¼ï¼Œãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒœãƒ‡ã‚£ï¼Œã‚¯ã‚¨ãƒªãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã®ã„ãšã‚Œã‹ã«å‰²ã‚Šå½“ã¦ã¦é€ä¿¡ã§ãã‚‹ï¼ ãƒ»ä»˜ä¸ã‚¿ã‚¤ãƒ— OAuthèªè¨¼ã®ãƒˆãƒ¼ã‚¯ãƒ³ã®ä»˜ä¸æ–¹æ³•ã«ã¯ç¨®é¡ãŒã‚ã‚‹ï¼ å‚è€ƒï¼šhttps://oauth.net/2/grant-types/ ä»˜ä¸ã‚¿ã‚¤ãƒ—å èª¬æ˜ ä½¿ç”¨ä¾‹ Authorization Code Grant ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãŒä»–ã®APIã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹å ´åˆã«ä½¿ç”¨ã™ã‚‹ï¼æ¨å¥¨ã•ã‚Œã¦ã„ã‚‹ï¼å‚è€ƒï¼šhttps://oauth.net/2/grant-types/authorization-code/ ä»–ã®SNSã‚¢ãƒ—ãƒªã¨ã®ã‚¢ã‚«ã‚¦ãƒ³ãƒˆé€£æº Client Credentials Grant æ¨å¥¨ã•ã‚Œã¦ã„ã‚‹ï¼å‚è€ƒï¼šhttps://oauth.net/2/grant-types/client-credentials/ Device Code æ¨å¥¨ã•ã‚Œã¦ã„ã‚‹ï¼å‚è€ƒï¼šhttps://oauth.net/2/grant-types/device-code/ Implicit Grant éæ¨å¥¨ã•ã‚Œã¦ã„ã‚‹ï¼å‚è€ƒï¼šhttps://oauth.net/2/grant-types/implicit/ Password Grant ãƒ¦ãƒ¼ã‚¶åã¨ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å…ƒã«ï¼Œãƒˆãƒ¼ã‚¯ãƒ³ã‚’ä»˜ä¸ã™ã‚‹ï¼éæ¨å¥¨ã•ã‚Œã¦ã„ã‚‹ï¼å‚è€ƒï¼šãƒ»https://oauth.net/2/grant-types/password/ãƒ»https://developer.okta.com/blog/2018/06/29/what-is-the-oauth2-password-grant#the-oauth-20-password-grant OpenID Connect ãƒ»OpenID Connectã¨ã¯ è¦å‹‰å¼·ï¼ ãƒ»ä½¿ç”¨ã•ã‚Œã‚‹èªè¨¼ã‚¹ã‚­ãƒ¼ãƒ  è¦å‹‰å¼· 03. JWTï¼šJSON Web Token JWTã¨ã¯ ã€ãƒ˜ãƒƒãƒ€ãƒ¼ã€ã€ãƒšã‚¤ãƒ­ãƒ¼ãƒ‰ã€ã€ç½²åã€ã®ãã‚Œãã‚Œã®JSONãƒ‡ãƒ¼ã‚¿ã‚’Base64urlã«ã‚ˆã£ã¦ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ã—ï¼Œãƒ‰ãƒƒãƒˆã§ã¤ãªã„ã ãƒˆãƒ¼ã‚¯ãƒ³ï¼Bearèªè¨¼ã‚„Oauthèªè¨¼ã®ãƒˆãƒ¼ã‚¯ãƒ³ã¨ã—ã¦ä½¿ç”¨ã§ãã‚‹ï¼ãƒ©ãƒ³ãƒ€ãƒ ãªæ–‡å­—åˆ—ã‚’ã“ã‚Œã‚‰èªè¨¼ã®ãƒˆãƒ¼ã‚¯ãƒ³ã¨ã™ã‚‹ã‚ˆã‚Šï¼ŒJWTã‚’ç”¨ã„ãŸæ–¹ãŒã‚ˆã‚Šå®‰å…¨ã§ã‚ã‚‹ï¼ GET https://example.co.jp/bar.php HTTP/2 authorization: Bearer .. JWTã‚’Bearerãƒˆãƒ¼ã‚¯ãƒ³ã¨ã—ã¦ä½¿ç”¨ã™ã‚‹Bearerèªè¨¼ã«ã¤ã„ã¦ã¯ï¼Œåˆ¥é …ç›®ã®èª¬æ˜ã‚’å‚è€ƒã«ã›ã‚ˆï¼ å‚è€ƒï¼š https://meetup-jp.toast.com/3511 https://dev.classmethod.jp/articles/json-signing-jws-jwt-usecase/ JWTã®ç”Ÿæˆ ãƒ»JWTç”Ÿæˆã®å…¨ä½“åƒ JWTã¯ä»¥ä¸‹ã®ã‚µã‚¤ãƒˆã‹ã‚‰å–å¾—ã§ãã‚‹ï¼ å‚è€ƒï¼šhttps://jwt.io/ JWTã®ç”Ÿæˆæ™‚ã«ï¼Œä¾‹ãˆã°JavaScriptã§ã‚ã‚Œã°ï¼Œä»¥ä¸‹ã®ã‚ˆã†ãªå‡¦ç†ãŒå®Ÿè¡Œã•ã‚Œã¦ã„ã‚‹ï¼ // .. const token = base64urlEncoding(header) + \".\" + base64urlEncoding(payload) + \".\" + base64urlEncoding(signature) ãƒ»ãƒ˜ãƒƒãƒ€ãƒ¼ã®JSONãƒ‡ãƒ¼ã‚¿ã®ç”Ÿæˆ ãƒ˜ãƒƒãƒ€ãƒ¼ã¯ä»¥ä¸‹ã®JSONãƒ‡ãƒ¼ã‚¿ã§å®šç¾©ã•ã‚Œã‚‹ï¼ç½²åã®ãŸã‚ã®æš—å·åŒ–ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã¯ï¼Œã€HS256ã€ã€RS256ã€ã€ES256ã€ã€noneã€ã‹ã‚‰é¸æŠã§ãã‚‹ï¼ const header = { \"typ\" : \"JWT\" // JWTã®ä½¿ç”¨ \"alg\" : \"HS256\", // ç½²åã®ãŸã‚ã®æš—å·åŒ–ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ  } ãƒ»ãƒšã‚¤ãƒ­ãƒ¼ãƒ‰ã®JSONãƒ‡ãƒ¼ã‚¿ã®ç”Ÿæˆ ãƒšã‚¤ãƒ­ãƒ¼ãƒ‰ã¯ä»¥ä¸‹ã®JSONãƒ‡ãƒ¼ã‚¿ã§å®šç¾©ã•ã‚Œã‚‹ï¼ãƒšã‚¤ãƒ­ãƒ¼ãƒ‰ã«ã¯ï¼Œå®Ÿéš›ã«é€ä¿¡ã—ãŸã„JSONã‚’è¨­å®šã™ã‚‹ã‚ˆã†ã«ã™ã‚‹ï¼å¿…ãšè¨­å®šã—ãªã‘ã‚Œã°ãªã‚‰ãªã„ã€äºˆç´„æ¸ˆã¿ã‚¯ãƒ¬ãƒ¼ãƒ ã€ã¨ï¼Œãƒ¦ãƒ¼ã‚¶å´ãŒè‡ªç”±ã«å®šç¾©ã§ãã‚‹ã€ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆã‚¯ãƒ¬ãƒ¼ãƒ ã€ãŒã‚ã‚‹ï¼ äºˆç´„æ¸ˆã¿ã‚¯ãƒ¬ãƒ¼ãƒ å å½¹å‰² ä¾‹ subï¼šSubject ä¸€æ„ãªè­˜åˆ¥å­ã‚’è¨­å®šã™ã‚‹ï¼ ãƒ¦ãƒ¼ã‚¶ID issï¼šIssuer audï¼šAudience expï¼šExpiration Time JWTã®æœ‰åŠ¹æœŸé™ã‚’è¨­å®šã™ã‚‹ï¼ jtiï¼šJWT ID const payload = { \"sub\": \"foo\", \"aud\": \"foo\", \"iss\": \"https://example.com\", \"exp\": 1452565628, \"iat\": 1452565568 } ãƒ»ç½²åã®JSONãƒ‡ãƒ¼ã‚¿ã®ç”Ÿæˆ ä¾‹ãˆã°JavaScriptã§ã‚ã‚Œã°ï¼Œä»¥ä¸‹ã®ã‚ˆã†ãªå‡¦ç†ãŒå®Ÿè¡Œã•ã‚Œã¦ã„ã‚‹ï¼ const signature = HMACSHA256( base64urlEncoding(header) + \".\" + base64urlEncoding(payload), secret ) JWTã®ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆä¿æŒ ãƒ» ä¿æŒæ–¹æ³•ã¨å®‰å…¨åº¦ã®æ¯”è¼ƒ å‚è€ƒï¼šhttps://qiita.com/Hiro-mi/items/18e00060a0f8654f49d6#%E6%97%A9%E8%A6%8B%E8%A1%A8 ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆä¿æŒæ–¹æ³• çµ„ã¿åˆã‚ã› ãŠã™ã™ã‚åº¦ ã‚³ãƒ¡ãƒ³ãƒˆ localStorage â–³ã€œÃ— XSSã§JWTãŒç›—ã¾ã‚Œã‚‹å¯èƒ½æ€§ãŒã‚ã‚‹ï¼ Cookieãƒ˜ãƒƒãƒ€ãƒ¼ ãƒ—ãƒªãƒ•ãƒ©ã‚¤ãƒˆãƒªã‚¯ã‚¨ã‚¹ãƒˆ â–³ Access-Control-Max-Ageã®æœŸé–“å†…ã ã¨CSRFã§JWTãŒç›—ã¾ã‚Œã‚‹å¯èƒ½æ€§ãŒã‚ã‚‹ï¼ Cookieãƒ˜ãƒƒãƒ€ãƒ¼ CSRFãƒˆãƒ¼ã‚¯ãƒ³ â—¯ SameSiteCookie â—¯ SPAã¨APIãŒåŒä¸€ã‚ªãƒªã‚¸ãƒ³ã®å¿…è¦ãŒã‚ã‚‹ï¼ "},"public/software/software_application_collaboration_api_restful.html":{"url":"public/software/software_application_collaboration_api_restful.html","title":"ğŸ“– ï¸RESTful-API","keywords":"","body":"RESTful-API ã¯ã˜ã‚ã« æœ¬ã‚µã‚¤ãƒˆã«ã¤ãã¾ã—ã¦ï¼Œä»¥ä¸‹ã‚’ã”èªè­˜ã®ã»ã©å®œã—ããŠé¡˜ã„ã„ãŸã—ã¾ã™ï¼ https://hiroki-it.github.io/tech-notebook-gitbook/ 01. RESTã¨RESTfulã¨ã¯ REST ãƒ»RESTã¨ã¯ åˆ†æ•£å‹ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’æ§‹ç¯‰ã™ã‚‹æ™‚ã«ï¼Œãã‚Œãã‚Œã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’é€£æºã•ã›ã‚‹ã®ã«é©ã—ãŸã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã‚¹ã‚¿ã‚¤ãƒ«ã‚’RESTã¨ã„ã†ï¼ã¾ãŸï¼Œã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã‚¹ã‚¿ã‚¤ãƒ«ã«ã¤ã„ã¦ã¯ï¼Œã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆæŒ‡å‘ã«é–¢ã™ã‚‹ãƒãƒ¼ãƒˆã‚’å‚ç…§ã›ã‚ˆï¼RESTã¯ï¼Œä»¥ä¸‹ã®ç‰¹å¾´ã‚’æŒã¤ï¼ ãƒ»RESTfulã¨RESTful APIã¨ã¯ RESTã«åŸºã¥ã„ãŸè¨­è¨ˆã‚’RESTfulã¨ã„ã†ï¼RESTfulè¨­è¨ˆãŒç”¨ã„ã‚‰ã‚ŒãŸWebAPIã‚’RESTful APIã¨ã„ã†ï¼ä¾‹ãˆã°ï¼ŒRESTful APIã®å ´åˆï¼ŒDBã«ãŠã‘ã‚‹UserInfoã®CRUDã«å¯¾ã—ã¦ï¼Œä¸€ã¤ã®ã€/UserInfoã€ã¨ã„ã†URIã‚’å¯¾å¿œã¥ã‘ã¦ã„ã‚‹ï¼ RESTã®ï¼”åŸå‰‡ ãƒ»Stateless ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã«å¯¾ã—ã¦ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’è¿”ä¿¡ã—ãŸå¾Œã«ï¼Œã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã®æƒ…å ±ã‚’ä¿æŒã›ãšã«ç ´æ£„ã™ã‚‹ä»•çµ„ã¿ã®ã“ã¨ï¼æ“¬ä¼¼çš„ã«Statefulãªé€šä¿¡ã‚’è¡Œã†æ™‚ã¯ï¼Œã‚­ãƒ£ãƒƒã‚·ãƒ¥ï¼ŒCookieï¼Œã‚»ãƒƒã‚·ãƒ§ãƒ³IDã‚’ç”¨ã„ã¦ï¼Œã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã®æƒ…å ±ã‚’ä¿æŒã™ã‚‹ï¼ Statelessãƒ—ãƒ­ãƒˆã‚³ãƒ« Statefulãƒ—ãƒ­ãƒˆã‚³ãƒ« HTTP SSH HTTPS TLS/SSL - SFTP ãƒ»Connectability ãƒ»Uniform Interface HTTPãƒ—ãƒ­ãƒˆã‚³ãƒ«ã‚’ä½¿ç”¨ã—ãŸãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’ï¼Œã€ãƒªã‚½ãƒ¼ã‚¹ã«å¯¾ã™ã‚‹æ“ä½œã€ã¨ã‚‰ãˆï¼Œãƒªã‚¯ã‚¨ã‚¹ãƒˆã«HTTPãƒ¡ã‚½ãƒƒãƒ‰ã‚’å¯¾å¿œã¥ã‘ã‚‹ã‚ˆã†ã«ã™ã‚‹ï¼ ãƒ»Addressability ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã«ã‚ˆã£ã¦ï¼Œç‰¹å®šã®ãƒªã‚½ãƒ¼ã‚¹ã‚’æ“ä½œã§ãã‚‹ã“ã¨ï¼ 02. ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã¨ã¯ ç‰¹å®šã®ãƒªã‚½ãƒ¼ã‚¹ã‚’æ“ä½œã™ã‚‹ãŸã‚ã®å›ºæœ‰ã®URIã®ã“ã¨ï¼ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ ã¯ï¼Œãƒªã‚½ãƒ¼ã‚¹1ã¤ã”ã¨ï¼Œã‚ã‚‹ã„ã¯ã¾ã¨ã¾ã‚Šã”ã¨ã«å‰²ã‚ŠæŒ¯ã‚‰ã‚Œã‚‹ï¼ HTTPãƒ¡ã‚½ãƒƒãƒ‰ï¼Œã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆï¼Œãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹ã®é–¢ä¿‚ RESTfulAPIã§ã¯ï¼Œå…¨ã¦ã®HTTPãƒ¡ã‚½ãƒƒãƒ‰ã®å†…ï¼Œä¸»ã«ä»¥ä¸‹ã®4ã¤ã‚’ä½¿ç”¨ã—ã¦ï¼Œãƒ‡ãƒ¼ã‚¿å‡¦ç†ã®æ–¹æ³•ã‚’ãƒªã‚¯ã‚¨ã‚¹ãƒˆã™ã‚‹ï¼ãã‚Œãã‚ŒãŒï¼ŒAPIã®ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹ã«å¯¾å¿œã™ã‚‹ï¼ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹ã”ã¨ã®ãƒ¡ã‚½ãƒƒãƒ‰åã«ã¤ã„ã¦ã¯ï¼ŒLaravelã‚’å‚è€ƒã«ã™ã‚‹ï¼ å‚è€ƒï¼šhttps://noumenon-th.net/programming/2020/01/30/laravel-crud/ HTTPãƒ¡ã‚½ãƒƒãƒ‰ ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹ ãƒ¡ã‚½ãƒƒãƒ‰åã®ä¾‹ GET https://example.co.jp/users ãƒ»å…¨ãƒ‡ãƒ¼ã‚¿ã®ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹å–å¾—ãƒ»æ¡ä»¶ã«åŸºã¥ããƒ‡ãƒ¼ã‚¿ã®å–å¾— index https://example.co.jp/users/{id} IDã«åŸºã¥ããƒ‡ãƒ¼ã‚¿ã®å–å¾— show POST https://example.co.jp/users ãƒ»ãƒ‡ãƒ¼ã‚¿ã®ä½œæˆãƒ»PDFã®ä½œæˆãƒ»ãƒ•ã‚¡ã‚¤ãƒ«ãƒ‡ãƒ¼ã‚¿ã®é€ä¿¡ãƒ»ãƒ­ã‚°ã‚¤ãƒ³ï¼ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ createï¼Œstore PUT` https://example.co.jp/users/{id} ãƒ‡ãƒ¼ã‚¿ã®æ›´æ–°ï¼ˆç½®æ›ï¼‰ update DELETE https://example.co.jp/users/{id} ãƒ‡ãƒ¼ã‚¿ã®å‰Šé™¤ deleteï¼Œdestroy POSTé€ä¿¡ã¨PUTé€ä¿¡ã®é‡è¦ãªé•ã„ã«ã¤ã„ã¦ã¾ã¨ã‚ã‚‹ï¼ãƒ‡ãƒ¼ã‚¿ã‚’ä½œæˆã™ã‚‹ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹ã®æ™‚ã¯POSTé€ä¿¡ï¼Œã¾ãŸã¯æ›´æ–°ã™ã‚‹æ™‚ã¯PUTé€ä¿¡ã‚’ä½¿ç”¨ã™ã‚‹ï¼ãŸã ã—ã‚‚ã£ã¨æ­£ç¢ºã«ã¯ï¼Œãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹ãŒã€ä½œæˆã€orã€æ›´æ–°ã€ã§ã¯ãªãï¼Œã€éå†ªç­‰ã€orã€å†ªç­‰ã€ã§åˆ¤æ–­ã—ãŸã»ã†ãŒè‰¯ã„ï¼ å‚è€ƒï¼š https://stackoverflow.com/a/2691891/12771072 https://restfulapi.net/rest-put-vs-post/ POSTé€ä¿¡ PUTé€ä¿¡ ãƒ‡ãƒ¼ã‚¿ä½œæˆã®å†ªç­‰æ€§ ãƒªã‚¯ã‚¨ã‚¹ãƒˆ1ã¤ã«ã¤ãï¼Œ1ã¤ã®ãƒ‡ãƒ¼ã‚¿ã‚’ä½œæˆï¼ˆéå†ªç­‰çš„ï¼‰ ãƒªã‚¯ã‚¨ã‚¹ãƒˆæ•°ã«é™ã‚‰ãšï¼Œ1ã¤ã®ãƒ‡ãƒ¼ã‚¿ã‚’ä½œæˆã™ã‚‹ï¼ˆå†ªç­‰çš„ï¼‰ï¼å¤ã„ãƒ‡ãƒ¼ã‚¿ã‚’æ–°ã—ã„ãƒ‡ãƒ¼ã‚¿ã«ç½®æ›ã™ã‚‹è¡Œç‚ºã«è¿‘ã„ï¼ ãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã®å ´æ‰€ ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãƒœãƒ‡ã‚£ã«JSONãƒ‡ãƒ¼ã‚¿ãªã©ã‚’å‰²ã‚Šå½“ã¦ã‚‹ï¼ ãƒ‘ã‚¹ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã«idãªã©ï¼Œã¾ãŸãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãƒœãƒ‡ã‚£ã«JSONãƒ‡ãƒ¼ã‚¿ãªã©ã‚’å‰²ã‚Šå½“ã¦ã‚‹ï¼ ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã®å‘½å ãƒ»å‹•è©ã‚’ä½¿ç”¨ã—ãªã„ã“ã¨ ã™ã§ã«HTTPãƒ¡ã‚½ãƒƒãƒ‰è‡ªä½“ã«å‹•è©ã®æ„å‘³åˆã„ãŒå«ã¾ã‚Œã‚‹ãŸã‚ï¼Œã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã«å‹•è©ã‚’å«ã‚ãªã„ã‚ˆã†ã«ã™ã‚‹ï¼ã“ã®æ™‚ï¼Œã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ãƒªã‚½ãƒ¼ã‚¹åãŒã‚ã‹ã‚Šã‚„ã™ã„ã‚ˆã†ãªåè©ã‚’ä½¿ç”¨ã™ã‚‹ï¼ å‚è€ƒï¼š https://cloud.google.com/blog/products/api-management/restful-api-design-nouns-are-good-verbs-are-bad https://stackoverflow.blog/2020/03/02/best-practices-for-rest-api-design/#h-use-nouns-instead-of-verbs-in-endpoint-paths ãŸã ã—æ…£ä¾‹ã¨ã—ã¦ï¼Œèªè¨¼ã®ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆãŒå‹•è©ï¼ˆloginï¼Œlogoutï¼Œregisterï¼‰ã«ãªã‚‹ã“ã¨ã¯è¨±å®¹ã•ã‚Œã¦ã„ã‚‹ï¼ å‚è€ƒï¼š https://stackoverflow.com/questions/7140074/restfully-design-login-or-register-resources https://www.developer.com/web-services/best-practices-restful-api ï¼Šæ‚ªã„å®Ÿè£…ä¾‹ï¼Š GET https://example.co.jp/show-user/12345 ï¼Šè‰¯ã„å®Ÿè£…ä¾‹ï¼Š GET https://example.co.jp/users/12345 GET https://example.co.jp/users/hiroki_hasegawa ï¼Šèªè¨¼ã®å ´åˆï¼Š å‹•è©ã‚’è¨±å®¹ã™ã‚‹ã®ã§ã‚ã‚Œã°loginã‚„logoutã¨ã—ï¼Œåè©ã‚’æ¡ç”¨ã™ã‚‹ã®ã§ã‚ã‚Œã°sessionã¨ã™ã‚‹ï¼ GET https://example.co.jp/login GET https://example.co.jp/session ãƒ»çŸ­ãã™ã‚‹ã“ã¨ ï¼Šæ‚ªã„å®Ÿè£…ä¾‹ï¼Š ã“ã“ã§ï¼Œserviceï¼Œapiï¼Œã¨ã„ã£ãŸã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã¯ï¼Œãªãã¦ã‚‚å•é¡Œãªã„ï¼ GET https://example.co.jp/service/api/users/12345 ï¼Šè‰¯ã„å®Ÿè£…ä¾‹ï¼Š GET https://example.co.jp/users/12345 ãƒ»ç•¥ç§°ã‚’ä½¿ã‚ãªã„ã“ã¨ ï¼Šæ‚ªã„å®Ÿè£…ä¾‹ï¼Š ã“ã“ã§ï¼ŒUsersã‚’æ„å‘³ã™ã‚‹ã€uã€ã¨ã„ã£ãŸç•¥ç§°ã¯ï¼Œå½“æ™‚ã®è¨­è¨ˆè€…ã—ã‹ã‚ã‹ã‚‰ãªã„ãŸã‚ï¼Œä¸è¦ã§ã‚ã‚‹ï¼ GET https://example.co.jp/u/12345 ï¼Šè‰¯ã„å®Ÿè£…ä¾‹ï¼Š ç•¥ç§°ã‚’ä½¿ã‚ãšã«ï¼Œã€usersã€ã¨ã™ã‚‹ï¼ GET https://example.co.jp/users/12345 ãƒ»å°æ–‡å­—ã‚’ä½¿ã†ã“ã¨ ï¼Šæ‚ªã„å®Ÿè£…ä¾‹ï¼Š GET https://example.co.jp/Users/12345 ï¼Šè‰¯ã„å®Ÿè£…ä¾‹ï¼Š GET https://example.co.jp/users/12345 ãƒ»ã‚±ãƒãƒ–ã‚±ãƒ¼ã‚¹ã‚’ä½¿ã†ã“ã¨ ï¼Šæ‚ªã„å®Ÿè£…ä¾‹ï¼Š GET https://example.co.jp/users_id/12345 ï¼Šè‰¯ã„å®Ÿè£…ä¾‹ï¼Š ã‚¹ãƒãƒ¼ã‚¯ã‚±ãƒ¼ã‚¹ã‚„ã‚­ãƒ£ãƒ¡ã‚±ãƒ¼ã‚¹ã‚’ä½¿ã‚ãšã«ï¼Œã‚±ãƒãƒ–ã‚±ãƒ¼ã‚¹ã‚’ä½¿ç”¨ã™ã‚‹ï¼ GET https://example.co.jp/users-id/12345 ãŸã ï¼Œãã‚‚ãã‚‚ã‚±ãƒãƒ–æ–¹å¼ã‚‚åˆ©ç”¨ã›ãšã«ï¼Œã‚¹ãƒ©ãƒƒã‚·ãƒ¥ã§åŒºåˆ‡ã£ã¦ã—ã¾ã†ã®ã‚‚æ‰‹ã§ã‚ã‚‹ GET https://example.co.jp/users/id/12345 ãƒ»è¤‡æ•°å½¢ã‚’ä½¿ç”¨ã™ã‚‹ã“ã¨ ï¼Šæ‚ªã„å®Ÿè£…ä¾‹ï¼Š Usersã¨ã„ã†é›†åˆã®ä¸­ã«ï¼ŒIdãŒå­˜åœ¨ã—ã¦ã„ã‚‹ãŸã‚ï¼Œå˜æ•°å½¢ã¯ä½¿ã‚ãªã„ï¼ GET https://example.co.jp/user/12345 ï¼Šè‰¯ã„å®Ÿè£…ä¾‹ï¼Š GET https://example.co.jp/users/12345 ãƒ»ã‚·ã‚¹ãƒ†ãƒ ã®è¨­è¨ˆæ–¹æ³•ãŒãƒãƒ¬ãªã„URIã«ã™ã‚‹ã“ã¨ ï¼Šæ‚ªã„å®Ÿè£…ä¾‹ï¼Š æ‚ªæ„ã®ã‚ã‚‹ãƒ¦ãƒ¼ã‚¶ã«ï¼Œè„†å¼±æ€§ã‚’ç‹™ã‚ã‚Œã‚‹å¯èƒ½æ€§ãŒã‚ã‚‹ãŸã‚ï¼Œã‚·ã‚¹ãƒ†ãƒ ã®è¨­è¨ˆæ–¹æ³•ãŒã°ã‚Œãªã„ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã«ã™ã‚‹ã“ã¨ï¼ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢ã«CGIãƒ—ãƒ­ã‚°ãƒ©ãƒ ãŒä½¿ç”¨ã•ã‚Œã¦ã„ã‚‹ã“ã¨ã‚„ï¼Œphpã‚’ä½¿ç”¨ã—ã¦ã„ã‚‹ã“ã¨ãŒã°ã‚Œã¦ã—ã¾ã†ï¼ GET https://example.co.jp/cgi-bin/get_users.php ï¼Šè‰¯ã„å®Ÿè£…ä¾‹ï¼Š GET https://example.co.jp/users/12345 ãƒ»HTTPãƒ¡ã‚½ãƒƒãƒ‰ã®åå‰ã‚’ä½¿ç”¨ã—ãªã„ã“ã¨ ï¼Šæ‚ªã„å®Ÿè£…ä¾‹ï¼Š ãƒ¡ã‚½ãƒƒãƒ‰ã‹ã‚‰ï¼Œå‡¦ç†ã®ç›®çš„ã¯ã‚ã‹ã‚‹ã®ã§ï¼ŒURIã«å¯¾å¿œã™ã‚‹å‹•è©åã‚’å®Ÿè£…ã™ã‚‹å¿…è¦ã¯ãªã„ï¼ GET https://example.co.jp/users/get/12345 POST https://example.co.jp/users/create/12345 PUT https://example.co.jp/users/update/12345 DELETE https://example.co.jp/users/delete/12345 ï¼Šè‰¯ã„å®Ÿè£…ä¾‹ï¼Š GET https://example.co.jp/users/{id} POST https://example.co.jp/users PUT https://example.co.jp/users/{id} DELETE https://example.co.jp/users/{id} ãƒ»æ•°å­—ï¼Œãƒãƒ¼ã‚¸ãƒ§ãƒ³ç•ªå·ã‚’å¯èƒ½ãªé™ã‚Šä½¿ç”¨ã—ãªã„ã“ã¨ ï¼Šæ‚ªã„å®Ÿè£…ä¾‹ï¼Š ã“ã“ã§ï¼Œalphaï¼Œv2ï¼Œã¨ã„ã£ãŸã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã¯ï¼Œå½“æ™‚ã®è¨­è¨ˆè€…ã—ã‹ã‚ã‹ã‚‰ãªã„ãŸã‚ï¼Œã‚ã¾ã‚Šè‰¯ããªã„ï¼ãŸã ã—ï¼Œåˆ©ä¾¿ä¸Šï¼Œä½¿ã†å ´åˆã‚‚ã‚ã‚‹ï¼ GET https://example.co.jp/v2/users/12345 ï¼Šè‰¯ã„å®Ÿè£…ä¾‹ï¼Š GET https://example.co.jp/users/12345 URLã«ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’è¡¨è¨˜ã—ãªã„ä»£ã‚ã‚Šã«ï¼Œãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒ˜ãƒƒãƒ€ãƒ¼ã®X-api-Versionã«ãƒãƒ¼ã‚¸ãƒ§ãƒ³æƒ…å ±ã‚’æ ¼ç´ã™ã‚‹æ–¹æ³•ãŒã‚ˆã‚Šè‰¯ã„ï¼ X-Api-Version: 1 ãƒ»ç•°ãªã‚‹HTTPãƒ¡ã‚½ãƒƒãƒ‰ã®é–“ã§ãƒ«ãƒ¼ãƒ«ã‚’çµ±ä¸€ã™ã‚‹ã“ã¨ ï¼Šæ‚ªã„å®Ÿè£…ä¾‹ï¼Š GETé€ä¿¡ã¨POSTé€ä¿¡ã®é–“ã§ï¼ŒIDãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã®HTTPãƒ¡ã‚½ãƒƒãƒ‰ãŒçµ±ä¸€ã•ã‚Œã¦ã„ãªã„ï¼ GET https://example.co.jp/users/?id=12345 POST https://example.co.jp/users/12345/messages ï¼Šè‰¯ã„å®Ÿè£…ä¾‹ï¼Š ä»¥ä¸‹ã®ã‚ˆã†ã«ï¼Œç•°ãªã‚‹HTTPãƒ¡ã‚½ãƒƒãƒ‰ã®é–“ã§ã‚‚çµ±ä¸€ã™ã‚‹ï¼ GET https://example.co.jp/users/12345 POST https://example.co.jp/users/12345/messages ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã®ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ ãƒ»ãƒ‘ã‚¹ï¼Œã‚¯ã‚¨ãƒªã‚¹ãƒˆãƒªãƒ³ã‚°ã¸ã®å‰²ã‚Šå½“ã¦ URIã®æ§‹é€ ã®ã†ã¡ï¼Œãƒ‘ã‚¹ã¾ãŸã¯ã‚¯ã‚¨ãƒªã‚¹ãƒˆãƒªãƒ³ã‚°ã«ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’å‰²ã‚Šå½“ã¦ã¦é€ä¿¡ã™ã‚‹ï¼ãã‚Œãã‚Œï¼Œãƒ‘ã‚¹ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã¾ãŸã¯ã‚¯ã‚¨ãƒªãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã¨ã„ã†ï¼ GET https://example.co.jp:80/users/777?text1=a&text2=b å®Œå…¨ä¿®é£¾ãƒ‰ãƒ¡ã‚¤ãƒ³å é€ä¿¡å…ˆã®ãƒãƒ¼ãƒˆç•ªå·ï¼ˆ80ã®å ´åˆã¯çœç•¥å¯ï¼‰ ãƒ«ãƒ¼ãƒˆ ãƒ‘ã‚¹ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ ï¼Ÿ ã‚¯ã‚¨ãƒªãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ï¼ˆGETé€ä¿¡æ™‚ã®ã¿ï¼‰ https://example.co.jp 80 users {id} ? text1=a&text2=b ãƒ»ä½¿ã„åˆ†ã‘ï¼ˆå†æ²ï¼‰ ãƒ‡ãƒ¼ã‚¿ã®é€ä¿¡å¯¾è±¡ ãƒ‘ã‚¹ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ ã‚¯ã‚¨ãƒªãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ å˜ä¸€æ¡ä»¶ã§æ±ºã¾ã‚‹æ¤œç´¢å‡¦ç† â—¯ â–³ è¤‡æ•°æ¡ä»¶ã§æ±ºã¾ã‚‹æ¤œç´¢å‡¦ç† âœ• â—¯ ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°å‡¦ç† âœ• â—¯ ã‚½ãƒ¼ãƒ†ã‚£ãƒ³ã‚°å‡¦ç† âœ• â—¯ ãƒ»ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãƒœãƒ‡ã‚£ã¸ã®å‰²ã‚Šå½“ã¦ JSONå‹ãƒ‡ãƒ¼ã‚¿å†…ã«å®šç¾©ã—ï¼Œãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãƒœãƒ‡ã‚£ã«ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’å‰²ã‚Šå½“ã¦ã¦é€ä¿¡ã™ã‚‹ï¼ POST https://example.co.jp HTTP/2 # ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãƒœãƒ‡ã‚£ { \"id\": 1, \"name\": \"foo\", } ãƒ»ãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒ˜ãƒƒãƒ€ãƒ¼ã¸ã®å‰²ã‚Šå½“ã¦ ãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒ˜ãƒƒãƒ€ãƒ¼ã«ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’å‰²ã‚Šå½“ã¦ã¦é€ä¿¡ã™ã‚‹ï¼é€ä¿¡æ™‚ã®ãƒ˜ãƒƒãƒ€ãƒ¼åã¯å¤§æ–‡å­—ã§ã‚‚å°æ–‡å­—ã§ã‚‚ã„ãšã‚Œã§ã‚‚å•é¡Œãªã„ãŒï¼Œå†…éƒ¨çš„ã«å°æ–‡å­—ã«å¤‰æ›ã•ã‚Œã‚‹ãŸã‚ï¼Œå°æ–‡å­—ãŒæ¨å¥¨ã§ã‚ã‚‹ï¼APIã‚­ãƒ¼ã®ãƒ˜ãƒƒãƒ€ãƒ¼åã®é ­æ–‡å­—ã«ã€Xã€ã‚’ä»˜ã‘ã‚‹ã®ã¯ï¼Œç‹¬è‡ªãƒ˜ãƒƒãƒ€ãƒ¼ã®é ­æ–‡å­—ã«ã€Xã€ã‚’ä»˜ã‘ã‚‹æ…£ç¿’ãŒã‚ã£ãŸãŸã‚ã§ã‚ã‚‹ï¼ãŸã ã—ï¼Œç¾åœ¨ã¯éæ¨å¥¨ã§ã‚ã‚‹ï¼ å‚è€ƒï¼šhttps://developer.mozilla.org/ja/docs/Web/HTTP/Headers POST https://example.co.jp HTTP/2 # Authorizationãƒ˜ãƒƒãƒ€ãƒ¼ authorization: Bearer ${Token} # APIã‚­ãƒ¼ãƒ˜ãƒƒãƒ€ãƒ¼ x-api-key: ***** ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã®ãƒ¬ã‚¹ãƒãƒ³ã‚¹å½¢å¼ ãƒ»ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚³ãƒ¼ãƒ‰ å‚è€ƒï¼šhttps://qiita.com/unsoluble_sugar/items/b080a16701946fcfce70 ã‚³ãƒ¼ãƒ‰ æ¦‚è¦ èª¬æ˜ 200 æˆåŠŸ æ­£ã—ã„ãƒªã‚¯ã‚¨ã‚¹ãƒˆã§ã‚ã‚‹ï¼ 401 èªè¨¼ã‚¨ãƒ©ãƒ¼ èª¤ã£ãŸãƒªã‚¯ã‚¨ã‚¹ãƒˆã§ã‚ã‚‹ï¼èªè¨¼ãƒ—ãƒ­ã‚»ã‚¹ã§æ­£ã—ã„ãƒˆãƒ¼ã‚¯ãƒ³ãŒç™ºè¡Œã•ã‚Œãšï¼Œèªå¯ãƒ—ãƒ­ã‚»ã‚¹ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆã§ã“ã®èª¤ã£ãŸãƒˆãƒ¼ã‚¯ãƒ³ã‚’é€ä¿¡ã—ãŸã“ã¨ã‚’è¡¨ã—ã¦ã„ã‚‹ï¼èªå¯ã®å¤±æ•—ã§ã¯ãªãï¼Œèªè¨¼ã®å¤±æ•—ã§ã‚ã‚‹ã“ã¨ã«æ³¨æ„ã™ã‚‹ï¼ 403 èªå¯ã‚¨ãƒ©ãƒ¼ã«ã‚ˆã‚‹ãƒˆãƒ¼ã‚¯ãƒ³æ‰€æœ‰è€…ã®èªå¯ã‚¹ã‚³ãƒ¼ãƒ—å¤– èª¤ã£ãŸãƒªã‚¯ã‚¨ã‚¹ãƒˆã§ã‚ã‚‹ï¼APIã«èªè¨¼ãƒ—ãƒ­ã‚»ã‚¹ãŒå­˜åœ¨ã—ï¼Œãƒˆãƒ¼ã‚¯ãƒ³ã®ç™ºè¡ŒãŒå¿…è¦ã ã¨ã™ã‚‹ï¼èªè¨¼ãƒ—ãƒ­ã‚»ã‚¹ã«ã¦æ­£ã—ã„ãƒˆãƒ¼ã‚¯ãƒ³ãŒç™ºè¡Œã•ã‚ŒãŸãŒï¼Œèªå¯ãƒ—ãƒ­ã‚»ã‚¹ã«ã¦ãƒˆãƒ¼ã‚¯ãƒ³ã®æ‰€æœ‰è€…ã®èªå¯ã‚¹ã‚³ãƒ¼ãƒ—å¤–ã¨åˆ¤å®šã•ã‚ŒãŸã“ã¨ã‚’è¡¨ã—ã¦ã„ã‚‹ï¼ é€ä¿¡å…ƒIPã‚¢ãƒ‰ãƒ¬ã‚¹ã®é–²è¦§ç¦æ­¢ èª¤ã£ãŸãƒªã‚¯ã‚¨ã‚¹ãƒˆã§ã‚ã‚‹ï¼APIã«èªè¨¼èªå¯ãƒ—ãƒ­ã‚»ã‚¹ãŒå­˜åœ¨ã›ãšï¼Œãƒˆãƒ¼ã‚¯ãƒ³ç™ºè¡Œã¨é–²è¦§æ¨©é™æ¤œè¨¼ãŒä¸è¦ã ã¨ã™ã‚‹ï¼é€ä¿¡å…ƒIPã‚¢ãƒ‰ãƒ¬ã‚¹ã«é–²è¦§æ¨©é™ãŒãªã„ã¨åˆ¤å®šã•ã‚Œã¦ã“ã¨ã‚’è¡¨ã—ã¦ã„ã‚‹ï¼ 404 ãƒšãƒ¼ã‚¸ãŒè¦‹ã¤ã‹ã‚‰ãªã„ èª¤ã£ãŸãƒªã‚¯ã‚¨ã‚¹ãƒˆã§ã‚ã‚‹ï¼å­˜åœ¨ã—ãªã„ãƒ‡ãƒ¼ã‚¿ã‚’ãƒªã‚¯ã‚¨ã‚¹ãƒˆã—ã¦ã„ã‚‹ã“ã¨ã‚’è¡¨ã—ã¦ã„ã‚‹ï¼ 409 ç«¶åˆã‚¨ãƒ©ãƒ¼ èª¤ã£ãŸãƒªã‚¯ã‚¨ã‚¹ãƒˆã§ã‚ã‚‹ï¼CREATEå‡¦ç†ã‚„UPDATEå‡¦ç†ã«ã‚ˆã£ã¦ï¼Œæ–°ã—ã„ãƒ‡ãƒ¼ã‚¿ã¨ç¾åœ¨ã®DBã®ãƒ‡ãƒ¼ã‚¿ã®é–“ã§ç«¶åˆãŒèµ·ã“ã£ã¦ã„ã‚‹ã“ã¨ã‚’è¡¨ã—ã¦ã„ã‚‹ï¼ä¸€æ„ãªè­˜åˆ¥å­ã¨ã—ã¦ç”¨ã„ã¦ã„ã‚‹ãƒ‡ãƒ¼ã‚¿ã®é‡è¤‡ã‚„ï¼Œæ¥½è¦³çš„ãƒ­ãƒƒã‚¯ã«ã‚ˆã‚‹æ’ä»–åˆ¶å¾¡ãŒèµ·ã“ã‚‹å ´åˆã«ä½¿ç”¨ã™ã‚‹ï¼å‚è€ƒï¼šhttps://hiroki-it.github.io/tech-notebook-gitbook/public/backend_database_operation.html 412 ãƒªã‚½ãƒ¼ã‚¹ã‚¢ã‚¯ã‚»ã‚¹ã‚¨ãƒ©ãƒ¼ èª¤ã£ãŸãƒªã‚¯ã‚¨ã‚¹ãƒˆã§ã‚ã‚‹ï¼ãƒªã‚½ãƒ¼ã‚¹ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹ã«å¤±æ•—ã—ãŸã“ã¨ã‚’è¡¨ã—ã¦ã„ã‚‹ï¼ 422 ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚¨ãƒ©ãƒ¼ èª¤ã£ãŸãƒªã‚¯ã‚¨ã‚¹ãƒˆã§ã‚ã‚‹ï¼é€ä¿¡ã•ã‚ŒãŸãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãŒèª¤ã£ã¦ã„ã‚‹ã“ã¨ã‚’ç¤ºã—ã¦ã„ã‚‹ï¼ 500 ã‚µãƒ¼ãƒã‚¨ãƒ©ãƒ¼ ã‚µãƒ¼ãƒãƒ¼ã®å‡¦ç†ã§ãƒ©ãƒ³ã‚¿ã‚¤ãƒ ã‚¨ãƒ©ãƒ¼ãŒèµ·ã“ã£ã¦ã„ã‚‹ï¼ã‚¨ãƒ©ãƒ¼ã®ç¨®é¡ã«ã¤ã„ã¦ã¯ï¼Œä»¥ä¸‹ã®ãƒªãƒ³ã‚¯ã‚’å‚è€ƒã«ã›ã‚ˆï¼å‚è€ƒï¼šhttps://hiroki-it.github.io/tech-notebook-gitbook/public/software/software_application_collaboration_authentication_authorization.html 503 ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ã‚¨ãƒ©ãƒ¼ ã‚¨ãƒ©ãƒ¼ã¯èµ·ã“ã‚‰ãªã„ãŒï¼Œãƒ“ã‚¸ãƒã‚¹ä¸Šã‚ã‚Šãˆãªã„ãƒ‡ãƒ¼ã‚¿ã‚’ãƒªã‚¯ã‚¨ã‚¹ãƒˆã—ã¦ã„ã‚‹ã“ã¨ã‚’è¡¨ã™ï¼ ãƒ»ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆã¨ãƒªãƒ©ã‚¤ãƒˆã®é•ã„ ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆã§ã¯ï¼Œãƒªã‚¯ã‚¨ã‚¹ãƒˆã•ã‚ŒãŸURLã‚’ã‚µãƒ¼ãƒå´ã§æ–°ã—ã„URLã«æ›¸ãæ›ãˆã¦ãƒ–ãƒ©ã‚¦ã‚¶ã«è¿”ä¿¡ã—ï¼Œãƒ–ãƒ©ã‚¦ã‚¶ãŒãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’å†é€ä¿¡ã™ã‚‹ï¼ãã®ãŸã‚ï¼Œã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå´ã¯æ–°ã—ã„URLã§æ”¹ã‚ã¦ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é€ä¿¡ã™ã‚‹ã“ã¨ã«ãªã‚‹ï¼ä¸€æ–¹ã§ï¼Œãƒªãƒ©ã‚¤ãƒˆã§ã¯ï¼Œãƒªã‚¯ã‚¨ã‚¹ãƒˆã•ã‚ŒãŸURLã‚’ã‚µãƒ¼ãƒå´ã§ç•°ãªã‚‹URLã«æ›¸ãæ›ãˆï¼Œã‚µãƒ¼ãƒãŒãã®ã¾ã¾ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é€ä¿¡ã™ã‚‹ï¼ãã®ãŸã‚ï¼Œã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå´ã¯å¤ã„URLã®ã¾ã¾ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é€ä¿¡ã™ã‚‹ã“ã¨ã«ãªã‚‹ï¼ãã®ä»–ã®é•ã„ã«ã¤ã„ã¦ã¯ï¼Œä»¥ä¸‹ã‚’å‚è€ƒã«ã›ã‚ˆï¼ å‚è€ƒï¼šhttps://blogs.iis.net/owscott/url-rewrite-vs-redirect-what-s-the-difference ãƒ»ãƒªãƒ©ã‚¤ãƒˆã¨ãƒ•ã‚©ãƒ¯ãƒ¼ãƒ‰ã®é•ã„ ãƒªãƒ©ã‚¤ãƒˆã§ã¯ç•°ãªã‚‹ã‚µãƒ¼ãƒã«ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é€ä¿¡ã§ãã‚‹ãŒï¼Œãƒ•ã‚©ãƒ¯ãƒ¼ãƒ‰ã§ã¯åŒä¸€ã‚µãƒ¼ãƒå†…ã®ç•°ãªã‚‹ãƒ•ã‚¡ã‚¤ãƒ«ã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ã“ã¨ã—ã‹ã§ããªã„ï¼ 03. ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã¨ã¯ ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å±¤ã§ç”Ÿæˆã•ã‚Œã‚‹ãƒ‡ãƒ¼ã‚¿ã‚’ï¼Œãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã¨ã„ã†ï¼ãƒªã‚¯ã‚¨ã‚¹ãƒˆæ™‚ã«ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå´ã§ç”Ÿæˆã•ã‚Œã‚‹ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’ãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ï¼Œãƒ¬ã‚¹ãƒãƒ³ã‚¹æ™‚ã«ã‚µãƒ¼ãƒå´ã§ç”Ÿæˆã•ã‚Œã‚‹ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’ãƒ¬ã‚¹ãƒãƒ³ã‚¹ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã¨ã„ã†ï¼ HTTPã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆ ãƒ»HTTPã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆ ç‰¹å®šã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ï¼ãƒ¬ã‚¹ãƒãƒ³ã‚¹ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã«é–¢ã™ã‚‹ã‚ã‚‰ã‚†ã‚‹æƒ…å ±ï¼ˆãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ï¼Œã‚»ãƒƒã‚·ãƒ§ãƒ³ï¼Œãã®ä»–ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯å›ºæœ‰ã®æƒ…å ±ãªã©ï¼‰ã‚’æ‰±ã†ãŸã‚ã®ä»•çµ„ã¿ã®ã“ã¨ï¼ç‰¹ã«ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã‚„ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã«ãŠã„ã¦ã‚ˆãä½¿ã‚ã‚Œã‚‹ç”¨èªã§ã‚ã‚‹ï¼ ãƒ».NET Frameworkã®å ´åˆ .NETã®ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ï¼ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã‚¯ãƒ©ã‚¹ãŒç”¨æ„ã•ã‚Œã¦ã„ã‚‹ï¼ å‚è€ƒï¼šhttps://docs.microsoft.com/en-us/dotnet/api/system.web.routing.requestcontext?view=netframework-4.8 ãƒ»Ginã®å ´åˆ Goã®ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ï¼ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆæ§‹é€ ä½“ãŒç”¨æ„ã•ã‚Œã¦ã„ã‚‹ï¼ å‚è€ƒï¼šhttps://pkg.go.dev/github.com/gin-gonic/gin#Context ãƒ»Nuxt.jsã®å ´åˆ JavaScriptã®ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ï¼ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆãŒç”¨æ„ã•ã‚Œã¦ã„ã‚‹ï¼ å‚è€ƒï¼šhttps://nuxtjs.org/ja/docs/internals-glossary/context/ ãƒ»Lambdaã®å ´åˆ ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã§ãªã¯ã„ãŒï¼ŒLambdaã®å ´åˆã«ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã¨ã—ã¦contextã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆãŒç”¨æ„ã•ã‚Œã¦ã„ã‚‹ï¼ 03-02. ãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ æ§‹é€  ãƒ»GETé€ä¿¡ã®å ´åˆ ã‚¯ã‚¨ãƒªãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã«é€ä¿¡ã™ã‚‹ãƒ‡ãƒ¼ã‚¿ã‚’è¨˜è¿°ã™ã‚‹æ–¹æ³•ï¼ãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã¯ï¼Œä»¥ä¸‹ã®è¦ç´ ã«åˆ†é¡ã§ãã‚‹ï¼ä»¥ä¸‹ã§ã¯ï¼ŒWeb APIã®ã†ã¡ï¼Œç‰¹ã«RESTfulAPIã«å¯¾ã—ã¦é€ä¿¡ã™ã‚‹ãŸã‚ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®æ§‹é€ ã‚’èª¬æ˜ã™ã‚‹ï¼ GET https://example.co.jp/bar-form.php?text1=a&text2=b HTTP/2 # ãƒªã‚¯ã‚¨ã‚¹ãƒˆã•ã‚ŒãŸãƒ‰ãƒ¡ã‚¤ãƒ³å Host: example.co.jp Connection: keep-alive Upgrade-Insecure-Requests: 1 # ãƒ–ãƒ©ã‚¦ã‚¶ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã®æœ€å¤§æœ‰åŠ¹æœŸé™ï¼ˆãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒ˜ãƒƒãƒ€ãƒ¼ã¨ãƒ¬ã‚¹ãƒãƒ³ã‚¹ãƒ˜ãƒƒãƒ€ãƒ¼ã®ä¸¡æ–¹ã§å®šç¾©å¯èƒ½ï¼‰ Cache-Control: max-age=31536000 # ãƒ–ãƒ©ã‚¦ã‚¶ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³æƒ…å ±ç­‰ User-Agent: Mozzila/5.0 (Windows NT 10.0; Win64; x64) Ch # ãƒ¬ã‚¹ãƒãƒ³ã‚¹è¿”ä¿¡ã—ã¦ã»ã—ã„MIMEã‚¿ã‚¤ãƒ— Accept: text/html, application/xhtml+xml, application/xml; q=0 # ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã§è¿”ä¿¡ã—ã¦ã»ã—ã„ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°å½¢å¼ Accept-Encondig: gzip, deflate, br # ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã§è¿”ä¿¡ã—ã¦ã»ã—ã„è¨€èª Accept-Language: ja, en-US; q=0.9, en; q=0.8 # é·ç§»å…ƒã®ãƒšãƒ¼ã‚¸ Referer: https://foo.co.jp/ # é€ä¿¡å…ƒIPã‚¢ãƒ‰ãƒ¬ã‚¹ # â€»ãƒ—ãƒ­ã‚­ã‚·ã‚µãƒ¼ãƒï¼ˆALBã‚„CloudFrontãªã©ã‚‚å«ã‚€ï¼‰ã‚’çµŒç”±ã—ã¦ã„ã‚‹å ´åˆã«ï¼Œãã‚Œã‚‰å…¨ã¦ã®IPã‚¢ãƒ‰ãƒ¬ã‚¹ã‚‚é †ã«è¨­å®šã•ã‚Œã‚‹ X-Forwarded-For: , , ãƒ»POSTé€ä¿¡ã®å ´åˆ ã‚¯ã‚¨ãƒªãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’ï¼ŒURLã«è¨˜è¿°ã›ãšï¼Œãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãƒœãƒ‡ã‚£ã«è¨˜è¿°ã—ã¦ãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’é€ã‚‹æ–¹æ³•ï¼ä»¥ä¸‹ã§ã¯ï¼ŒWeb APIã®ã†ã¡ï¼Œç‰¹ã«RESTfulAPIã«å¯¾ã—ã¦é€ä¿¡ã™ã‚‹ãŸã‚ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®æ§‹é€ ã‚’èª¬æ˜ã™ã‚‹ï¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãƒœãƒ‡ã‚£ã«æƒ…å ±ãŒè¨˜è¿°ã•ã‚Œã‚‹ãŸã‚ï¼Œå±¥æ­´ã§ã¯ç¢ºèªã§ããªã„ï¼ã¾ãŸï¼ŒSSLã«ã‚ˆã£ã¦æš—å·åŒ–ã•ã‚Œã‚‹ãŸã‚ï¼Œå‚å—ã§ããªã„ï¼ãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã¯ï¼Œä»¥ä¸‹ã®è¦ç´ ã«åˆ†é¡ã§ãã‚‹ï¼ POST https://example.co.jp/bar-form.php HTTP/2 # ãƒªã‚¯ã‚¨ã‚¹ãƒˆã•ã‚ŒãŸãƒ‰ãƒ¡ã‚¤ãƒ³å Host: example.co.jp Connection: keep-alive Content-Length: 15 # ãƒ–ãƒ©ã‚¦ã‚¶ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã®æœ€å¤§æœ‰åŠ¹æœŸé™ï¼ˆãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒ˜ãƒƒãƒ€ãƒ¼ã¨ãƒ¬ã‚¹ãƒãƒ³ã‚¹ãƒ˜ãƒƒãƒ€ãƒ¼ã®ä¸¡æ–¹ã§å®šç¾©å¯èƒ½ï¼‰ Cache-Control: no-store # ã‚ªãƒªã‚¸ãƒ³ï¼ˆãƒ—ãƒ­ãƒˆã‚³ãƒ«ï¼‹ãƒ‰ãƒ¡ã‚¤ãƒ³ï¼‹ãƒãƒ¼ãƒˆç•ªå·ï¼‰ Origin: https://example.co.jp Upgrade-Insecure-Requests: 1 # ãƒªã‚¯ã‚¨ã‚¹ãƒˆã§é€ä¿¡ã™ã‚‹MIMEã‚¿ã‚¤ãƒ— Content-Type: application/x-www-firm-urlencoded # ãƒ–ãƒ©ã‚¦ã‚¶ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³æƒ…å ±ç­‰ User-Agent: Mozzila/5.0 (Windows NT 10.0; Win64; x64) Ap # ãƒ¬ã‚¹ãƒãƒ³ã‚¹è¿”ä¿¡ã—ã¦ã»ã—ã„MIMEã‚¿ã‚¤ãƒ— Accept: text/html, application/xhtml+xml, application/xml; q=0 # ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã§è¿”ä¿¡ã—ã¦ã»ã—ã„ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°å½¢å¼ Accept-Encondig: gzip, deflate, br # ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã§è¿”ä¿¡ã—ã¦ã»ã—ã„è¨€èª Accept-Language: ja, en-US; q=0.9, en; q=0.8 # é·ç§»å…ƒã®ãƒšãƒ¼ã‚¸ Referer: https://foo.co.jp/ # å„Cookieã®å€¤ï¼ˆäºŒå›ç›®ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆæ™‚ã«è¨­å®šã•ã‚Œã‚‹ï¼‰ Cookie: sessionid=; csrftoken=; _gat=1 # é€ä¿¡å…ƒIPã‚¢ãƒ‰ãƒ¬ã‚¹ # â€»ãƒ—ãƒ­ã‚­ã‚·ã‚µãƒ¼ãƒï¼ˆALBã‚„CloudFrontãªã©ã‚‚å«ã‚€ï¼‰ã‚’çµŒç”±ã—ã¦ã„ã‚‹å ´åˆã«ï¼Œãã‚Œã‚‰å…¨ã¦ã®IPã‚¢ãƒ‰ãƒ¬ã‚¹ã‚‚é †ã«è¨­å®šã•ã‚Œã‚‹ X-Forwarded-For: , , # ãƒœãƒ‡ã‚£ï¼ï¼ˆSSLã«ã‚ˆã£ã¦æš—å·åŒ–ã•ã‚Œã‚‹ãŸã‚é–²è¦§ä¸å¯ï¼‰ text=a&text2=b ãƒ»ä¾‹å¤–ã¨ã—ã¦ï¼Œãƒœãƒ‡ã‚£ã‚’æŒã¤GETé€ä¿¡ã®å ´åˆ GETé€ä¿¡ã§ã¯ã‚ã‚‹ãŒï¼Œãƒœãƒ‡ã‚£ã«ã‚¯ã‚¨ãƒªãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’è¨˜è¿°ã—ã¦é€ä¿¡ã™ã‚‹æ–¹æ³•ãŒã‚ã‚‹ï¼ POSTMANã§ï¼ŒGETé€ä¿¡ã«ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãƒœãƒ‡ã‚£ã‚’å«ã‚ã‚‹ã“ã¨ã«ã¤ã„ã¦ï¼š https://github.com/postmanlabs/postman-app-support/issues/131 é€ä¿¡ä¾‹ ãƒ»PHPã®å ´åˆ URL, // HTTPãƒ¡ã‚½ãƒƒãƒ‰ CURLOPT_CUSTOMREQUEST => \"GET\", // SSLè¨¼æ˜æ›¸ã®æ¤œè¨¼ CURLOPT_SSL_VERIFYPEER => false, // æ–‡å­—åˆ—å‹ã§å—ä¿¡ CURLOPT_RETURNTRANSFER => true ] ); // ãƒªã‚¯ã‚¨ã‚¹ãƒˆã®å®Ÿè¡Œ $messageBody = (curl_exec($curl)) ? curl_exec($curl) : []; // curlã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚’é–‰ã˜ã‚‹ curl_close($curl); 03-03. ãƒ¬ã‚¹ãƒãƒ³ã‚¹ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ æ§‹é€  ï¼Šä¾‹ï¼Š 200 OK # ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã§é€ä¿¡ã™ã‚‹MIMEã‚¿ã‚¤ãƒ— Content-Type: text/html;charset=UTF-8 Transfer-Encoding: chunked Connection: close # Webã‚µãƒ¼ãƒï¼ˆnginxï¼Œapacheï¼ŒAmazonS3ãªã©ãŒè¡¨ç¤ºã•ã‚Œã‚‹ï¼‰ Server: nginx Date: Sat, 26 Sep 2020 04:25:08 GMT # ãƒªãƒ•ã‚¡ãƒ©ãƒãƒªã‚·ãƒ¼ï¼ˆnginxï¼Œapacheï¼Œãªã©ã§å®Ÿè£…å¯èƒ½ï¼‰ Referrer-Policy: no-referrer-when-downgrade x-amz-rid: ***** # ã‚»ãƒƒã‚·ãƒ§ãƒ³IDã‚’å«ã‚€Cookieæƒ…å ± Set-Cookie: session-id=*****; Domain=.amazon.co.jp; Expires=Sun, 26-Sep-2021 04:25:08 GMT; Path=/ Set-Cookie: session-id-time=*****; Domain=.amazon.co.jp; Expires=Sun, 26-Sep-2021 04:25:08 GMT; Path=/ Set-Cookie: i18n-prefs=JPY; Domain=.amazon.co.jp; Expires=Sun, 26-Sep-2021 04:25:08 GMT; Path=/ Set-Cookie: skin=noskin; path=/; domain=.amazon.co.jp Accept-CH: ect,rtt,downlink Accept-CH-Lifetime: 86400 X-UA-Compatible: IE=edge Content-Language: ja-JP # ãƒ–ãƒ©ã‚¦ã‚¶ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã®æœ€å¤§æœ‰åŠ¹æœŸé™ï¼ˆãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒ˜ãƒƒãƒ€ãƒ¼ã¨ãƒ¬ã‚¹ãƒãƒ³ã‚¹ãƒ˜ãƒƒãƒ€ãƒ¼ã®ä¸¡æ–¹ã§å®šç¾©å¯èƒ½ï¼‰ Cache-Control: no-cache # ãƒ–ãƒ©ã‚¦ã‚¶ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã®æœ€å¤§æœ‰åŠ¹æœŸé™ï¼ˆãƒ¬ã‚¹ãƒãƒ³ã‚¹ãƒ˜ãƒƒãƒ€ãƒ¼ã®ã¿ã§å®šç¾©å¯èƒ½ï¼‰ Expires: Wed, 21 Oct 2015 07:28:00 GMT Pragma: no-cache X-XSS-Protection: 1; X-Content-Type-Options: nosniff Vary: Accept-Encoding,User-Agent,Content-Type,Accept-Encoding,X-Amzn-CDN-Cache,X-Amzn-AX-Treatment,User-Agent Strict-Transport-Security: max-age=*****; includeSubDomains; preload X-Frame-Options: SAMEORIGIN # CloudFrontã®ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã«ãƒ’ãƒƒãƒˆã—ãŸã‹ã©ã†ã‹ X-Cache: Miss from cloudfront Via: 1.1 *****.cloudfront.net (CloudFront) X-Amz-Cf-Pop: SEA19-C2 X-Amz-Cf-Id: *****== # è¨€èªã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ï¼ˆâ€» php.ini ã«ã¦ï¼Œexpose_php = Off ã¨è¨­å®šã™ã‚‹ã“ã¨ã§éè¡¨ç¤ºã«ã§ãã‚‹ï¼‰ X-Powered-By: PHP/7.3.22 # ãƒœãƒ‡ã‚£ ã“ã“ã«ã‚µã‚¤ãƒˆã®HTMLã®ã‚³ãƒ¼ãƒ‰ 04. ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆãƒ‡ãƒ¼ã‚¿ ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆãƒ‡ãƒ¼ã‚¿ ãƒ»ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆãƒ‡ãƒ¼ã‚¿ã¨ã¯ ãƒªã‚¯ã‚¨ã‚¹ãƒˆï¼ˆPOSTï¼‰ï¼ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã«ã¦ï¼Œãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãƒœãƒ‡ã‚£ã«å‰²ã‚Šå½“ã¦ã¦é€ä¿¡ï¼è¿”ä¿¡ã™ã‚‹ãƒ‡ãƒ¼ã‚¿ã®ã“ã¨ï¼ ãƒ»MIME typeï¼ˆContent typeï¼‰ POSTï¼PUTé€ä¿¡ã«ãŠã„ã¦ï¼Œãƒœãƒ‡ã‚£ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã®ãƒ‡ãƒ¼ã‚¿å½¢å¼ã‚’è¡¨ç¾ã™ã‚‹è­˜åˆ¥å­ã®ã“ã¨ï¼ãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒ˜ãƒƒãƒ€ãƒ¼ï¼ãƒ¬ã‚¹ãƒãƒ³ã‚¹ãƒ˜ãƒƒãƒ€ãƒ¼ã®Content-Typeãƒ˜ãƒƒãƒ€ãƒ¼ã«å‰²ã‚Šå½“ã¦ã‚‹ã¨ï¼Œã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆãƒ‡ãƒ¼ã‚¿ã®ãƒ‡ãƒ¼ã‚¿å‹ã‚’å®šç¾©ã§ãã‚‹ï¼GETé€ä¿¡ã«ã¯ä¸è¦ã§ã‚ã‚‹ï¼ å‚è€ƒï¼šhttps://stackoverflow.com/questions/5661596/do-i-need-a-content-type-header-for-http-get-requests ãƒˆãƒƒãƒ—ãƒ¬ãƒ™ãƒ«ã‚¿ã‚¤ãƒ— ã‚µãƒ–ãƒ¬ãƒ™ãƒ«ã‚¿ã‚¤ãƒ— æ„å‘³ application octet-stream ä»»æ„ã®MIME typeï¼ˆæŒ‡å®šãªã—ï¼‰ã‚’ç¤ºã™ï¼ javascript json x-www-form-urlencoded POSTé€ä¿¡ã®ãƒ‡ãƒ¼ã‚¿ zip text html HTMLãƒ†ã‚­ã‚¹ãƒˆ css CSSãƒ†ã‚­ã‚¹ãƒˆ plane ãƒ—ãƒ¬ãƒ¼ãƒ³ãƒ†ã‚­ã‚¹ãƒˆ image png jpeg gif ãƒ»ãƒ‡ãƒ¼ã‚¿å‹ã®æŒ‡å®šæ–¹æ³• æœ€ã‚‚è‰¯ã„æ–¹æ³•ã¯ï¼Œãƒªã‚¯ã‚¨ã‚¹ãƒˆã®Content-Typeãƒ˜ãƒƒãƒ€ãƒ¼ã«ï¼Œã€application/jsonã€ã‚’è¨­å®šã™ã‚‹ã“ã¨ã§ã‚ã‚‹ï¼ POST https://example.co.jp/users/12345 # ãƒ˜ãƒƒãƒ€ãƒ¼ Content-Type: application/json ä»–ã«ï¼ŒURIã§ãƒ‡ãƒ¼ã‚¿å‹ã‚’è¨˜è¿°ã™ã‚‹æ–¹æ³•ãŒã‚ã‚‹ï¼ POST https://example.co.jp/users/12345?format=json ãƒªã‚¯ã‚¨ã‚¹ãƒˆï¼ˆPOSTï¼ŒPUTï¼‰ æ­£å¸¸ç³»ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã§è¿”ä¿¡ã™ã‚‹ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆãƒ‡ãƒ¼ã‚¿ã¨åŒã˜ï¼ æ­£å¸¸ç³»ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã®å ´åˆ ãƒ»POSTï¼PUTã§ã¯å‡¦ç†å¾Œãƒ‡ãƒ¼ã‚¿ã‚’ãƒ¬ã‚¹ãƒãƒ³ã‚¹ POSTï¼PUTãƒ¡ã‚½ãƒƒãƒ‰ã§ã¯ï¼Œå‡¦ç†å¾Œã®ãƒ‡ãƒ¼ã‚¿ã‚’200ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã¨ã—ã¦è¿”ä¿¡ã™ã‚‹ï¼ã‚‚ã—å‡¦ç†å¾Œã®ãƒ‡ãƒ¼ã‚¿ã‚’è¿”ä¿¡ã—ãªã„å ´åˆï¼Œæ”¹ã‚ã¦GETãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é€ä¿¡ã™ã‚‹å¿…è¦ãŒã‚ã‚Šï¼Œä½™åˆ†ãªAPIã‚³ãƒ¼ãƒ«ãŒå¿…è¦ã«ãªã£ã¦ã—ã¾ã†ï¼ å‚è€ƒï¼š https://developer.ntt.com/ja/blog/741a176b-372f-4666-b649-b677dd23e3f3 https://qiita.com/wim/items/dbb6def4e207f6048735 ãƒ»DELETEã§ã¯ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®ã¿ã‚’ãƒ¬ã‚¹ãƒãƒ³ã‚¹ DELETEãƒ¡ã‚½ãƒƒãƒ‰ã§ã¯ï¼Œãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®ã¿ã‚’200ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã¨ã—ã¦è¿”ä¿¡ã™ã‚‹ï¼ç©ºãƒœãƒ‡ã‚£204ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã¨ã—ã¦è¿”ä¿¡ã—ã¦ã‚‚ã‚ˆã„ï¼ å‚è€ƒï¼š https://stackoverflow.com/questions/25970523/restful-what-should-a-delete-response-body-contain/50792918 https://qiita.com/fukuma_biz/items/a9e8d18467fe3e04068e#4-delete---%E3%83%AA%E3%82%BD%E3%83%BC%E3%82%B9%E3%81%AE%E5%89%8A%E9%99%A4 ãƒ»ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚³ãƒ¼ãƒ‰ã¯ä¸è¦ æ­£å¸¸ç³»ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã®å ´åˆï¼Œã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆãƒ‡ãƒ¼ã‚¿ã¸ã®ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚³ãƒ¼ãƒ‰ã®å‰²ã‚Šå½“ã¦ã¯ä¸è¦ã§ã‚ã‚‹ï¼ { \"name\": \"Taro Yamada\" } ãƒ»ãƒ•ãƒ©ãƒƒãƒˆãªãƒ‡ãƒ¼ã‚¿æ§‹é€ ã«ã™ã‚‹ã“ã¨ JSONã®å ´åˆï¼Œéšå±¤æ§‹é€ ã«ã™ã‚‹ã¨ï¼Œãƒ‡ãƒ¼ã‚¿å®¹é‡ãŒå¢—ãˆã¦ã—ã¾ã†ï¼ ï¼Šä¾‹ï¼Š { \"name\": \"Taro Yamada\", \"age\": 10, \"interest\": { \"sports\":[\"soccer\", \"baseball\"], \"subjects\": \"math\" } } ãã“ã§ï¼Œã§ãã‚‹ã ã‘ãƒ‡ãƒ¼ã‚¿æ§‹é€ ã‚’ãƒ•ãƒ©ãƒƒãƒˆã«ã™ã‚‹ï¼ãŸã ã—ï¼Œè¦‹ã‚„ã™ã•ã«ã‚ˆã£ã¦ã¯éšå±¤æ§‹é€ ã‚‚è¨±å®¹ã•ã‚Œã‚‹ï¼ å‚è€ƒï¼šhttps://www.amazon.co.jp/Web-API-The-Good-Parts/dp/4873116864 ï¼Šä¾‹ï¼Š { \"name\": \"Taro Yamada\", \"age\": 10, \"sports\":[\"soccer\", \"baseball\"], \"subjects\": \"math\" } ã‚ã‚‹ã„ã¯ï¼ŒContent-Typeãƒ˜ãƒƒãƒ€ãƒ¼ã«ã€application/hal+jsonã€ã€application/vnd.api+jsonã€ã€application/vnd.collection+jsonã€ã¨ã„ã£ãŸã‚ˆã‚ŠJSONãƒ™ãƒ¼ã‚¹ã®å¼·ã„åˆ¶ç´„ã®ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã‚’åˆ©ç”¨ã™ã‚‹ï¼ ãƒ»æ—¥ä»˜ãƒ‡ãƒ¼ã‚¿ã®å½¢å¼ã«æ°—ã‚’ã¤ã‘ã‚‹ã“ã¨ RFC3339ï¼ˆW3C-DTFï¼‰å½¢å¼ã§ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆãƒ‡ãƒ¼ã‚¿ã«å«ã‚ã¦é€å—ä¿¡ã™ã‚‹ã“ã¨ï¼ ï¼Šä¾‹ï¼Š 2020-07-07T12:00:00+09:00 ãŸã ã—ï¼Œæ—¥ä»˜ã‚’ãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã§é€å—ä¿¡ã™ã‚‹æ™‚ï¼ŒRFC3339ï¼ˆW3C-DTFï¼‰å½¢å¼ã‚’æ­£è¦è¡¨ç¾ã§è¨­å®šã™ã‚‹å¿…è¦ãŒã‚ã‚‹ã®ã§æ³¨æ„ï¼ ï¼Šä¾‹ï¼Š GET https://example.co.jp/users/12345?date=2020-07-07T12:00:00%2B09:00 ç•°å¸¸ç³»ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã®å ´åˆ { \"code\": 400 \"errors\": [ \"ã€‡ã€‡ã¯å¿…ãšå…¥åŠ›ã—ã¦ãã ã•ã„ï¼\", \"â–¡â–¡ã¯å¿…ãšå…¥åŠ›ã—ã¦ãã ã•ã„ï¼\" ] \"url\" : \"https://example-api-doc.co.jp\" } å‚è€ƒï¼šhttps://qiita.com/suin/items/f7ac4de914e9f3f35884#%E3%82%A8%E3%83%A9%E3%83%BC%E3%83%AC%E3%82%B9%E3%83%9D%E3%83%B3%E3%82%B9%E3%81%A7%E8%80%83%E6%85%AE%E3%81%97%E3%81%9F%E3%81%84%E3%81%93%E3%81%A8 ç¨®é¡ å¿…è¦æ€§ ãƒ‡ãƒ¼ã‚¿å‹ èª¬æ˜ ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ å¿…é ˆ æ–‡å­—åˆ—å‹ è¤‡æ•°ã®ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¿”ä¿¡ã§ãã‚‹ã‚ˆã†ã«ï¼Œé…åˆ—ã¨ã—ã¦å®šç¾©ã™ã‚‹ï¼ ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚³ãƒ¼ãƒ‰ ä»»æ„ æ•´æ•°å‹ ã‚¨ãƒ©ãƒ¼ã®ç¨®é¡ãŒã‚ã‹ã‚‹ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚³ãƒ¼ãƒ‰ã‚’å‰²ã‚Šå½“ã¦ã‚‹ï¼ ã‚¨ãƒ©ãƒ¼ã‚³ãƒ¼ãƒ‰ï¼ˆä¾‹å¤–ã‚³ãƒ¼ãƒ‰ï¼‰ ä»»æ„ æ–‡å­—åˆ—å‹ APIãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã®ã‚¨ãƒ©ãƒ¼ã®è­˜åˆ¥å­ã¨ã—ã¦ï¼Œã‚¨ãƒ©ã‚³ãƒ¼ãƒ‰ï¼ˆä¾‹å¤–ã‚³ãƒ¼ãƒ‰ï¼‰ã‚’å‰²ã‚Šå½“ã¦ã‚‹ï¼ APIãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã®URL ä»»æ„ æ–‡å­—åˆ—å‹ å¤–éƒ¨ã«å…¬é–‹ã™ã‚‹APIã®å ´åˆã«ï¼Œã‚¨ãƒ©ãƒ¼ã®è§£æ±ºç­–ãŒã‚ã‹ã‚‹APIãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã®URLã‚’å‰²ã‚Šå½“ã¦ã‚‹ï¼ 05. Statelessãƒ—ãƒ­ãƒˆã‚³ãƒ«ã«ãŠã‘ã‚‹æ“¬ä¼¼StatefulåŒ– Cookieï¼ŒCookieæƒ…å ±ï¼ˆã‚­ãƒ¼åï¼å€¤ï¼‰ ãƒ»Cookieï¼ŒCookieæƒ…å ±ã¨ã¯ ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‹ã‚‰ã®æ¬¡å›ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆæ™‚ã§ã‚‚ï¼ŒCookieæƒ…å ±ï¼ˆã‚­ãƒ¼åï¼å€¤ã®ã‚»ãƒƒãƒˆï¼‰ã‚’ç”¨ã„ã¦ï¼ŒåŒä¸€ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã¨èªè­˜ã§ãã‚‹ä»•çµ„ã¿ã‚’Cookieã¨ã„ã†ï¼HTTPã¯Statelessãƒ—ãƒ­ãƒˆã‚³ãƒ«ã§ã‚ã‚‹ãŒï¼ŒCookieæƒ…å ±ã«ã‚ˆã‚Šæ“¬ä¼¼çš„ã«Statefulãªé€šä¿¡ã‚’è¡Œãˆã‚‹ï¼ ãƒ»Cookieæƒ…å ±ã«é–¢ã‚ã‚‹ãƒ˜ãƒƒãƒ€ãƒ¼ æœ€åˆï¼Œã‚µãƒ¼ãƒã‹ã‚‰ã®ãƒ¬ã‚¹ãƒãƒ³ã‚¹æ™‚ï¼ŒSet-Cookieãƒ˜ãƒƒãƒ€ãƒ¼ã‚’ç”¨ã„ã¦é€ä¿¡ã•ã‚Œã‚‹ï¼åå¯¾ã«ï¼Œã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‹ã‚‰ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆæ™‚ï¼ŒCookieæƒ…å ±ã¯ï¼ŒCookieãƒ˜ãƒƒãƒ€ãƒ¼ã‚’ç”¨ã„ã¦é€ä¿¡ã•ã‚Œã‚‹ï¼ HTTPãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®ç¨®é¡ ãƒ˜ãƒƒãƒ€ãƒ¼å å±æ€§ å†…å®¹ ãƒ¬ã‚¹ãƒãƒ³ã‚¹ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ Set-Cookie Name Cookieåã¨å€¤ Expires Cookieã®æœ‰åŠ¹æœŸé™ï¼ˆæ—¥æ•°ï¼‰ Max-Age Cookieã®æœ‰åŠ¹æœŸé™ï¼ˆç§’æ•°ï¼‰ Domain ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆãŒãƒªã‚¯ã‚¨ã‚¹ãƒˆã™ã‚‹æ™‚ã®Cookieé€ä¿¡å…ˆãƒ‰ãƒ¡ã‚¤ãƒ³åï¼ Path ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆãŒãƒªã‚¯ã‚¨ã‚¹ãƒˆã™ã‚‹æ™‚ã®Cookieé€ä¿¡å…ˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª Secure ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‹ã‚‰ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆã§SSLãƒ—ãƒ­ãƒˆã‚³ãƒ«ãŒä½¿ç”¨ã•ã‚Œã¦ã„ã‚‹æ™‚ã®ã¿ï¼Œãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é€ä¿¡ã§ãã‚‹ã‚ˆã†ã«ã™ã‚‹ï¼ HttpOnly ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå´ã§ï¼ŒJavaScriptãŒCookieã‚’ä½¿ç”¨ã§ããªã„ã‚ˆã†ã«ã™ã‚‹ï¼XSSæ”»æ’ƒã®å¯¾ç­–ã«ãªã‚‹ï¼ ãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ Cookie ã‚»ãƒƒã‚·ãƒ§ãƒ³IDãªã©ã®Cookieæƒ…å ± ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‹ã‚‰é€ä¿¡ã•ã‚Œã¦ããŸãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®Cookieãƒ˜ãƒƒãƒ€ãƒ¼ã®å†…å®¹ã¯ï¼Œã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°ã«æ ¼ç´ã•ã‚Œã¦ã„ã‚‹ï¼ \"å€¤\"] ãƒ»ä»•çµ„ã¿ æœ€åˆï¼Œãƒ–ãƒ©ã‚¦ã‚¶ã¯ãƒªã‚¯ã‚¨ã‚¹ãƒˆã§ãƒ‡ãƒ¼ã‚¿ã‚’é€ä¿¡ã™ã‚‹ï¼ ã‚µãƒ¼ãƒã¯ï¼Œãƒ¬ã‚¹ãƒãƒ³ã‚¹ãƒ˜ãƒƒãƒ€ãƒ¼ã®Set-Cookieãƒ˜ãƒƒãƒ€ãƒ¼ã«Cookieæƒ…å ±ã‚’åŸ‹ã‚è¾¼ã‚“ã§é€ä¿¡ã™ã‚‹ï¼ ãƒ–ãƒ©ã‚¦ã‚¶ã¯ï¼Œãã®Cookieæƒ…å ±ã‚’ä¿å­˜ã™ã‚‹ï¼ 2å›ç›®ä»¥é™ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆã§ã¯ï¼Œãƒ–ãƒ©ã‚¦ã‚¶ã¯ï¼Œãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒ˜ãƒƒãƒ€ãƒ¼ã®Cookieãƒ˜ãƒƒãƒ€ãƒ¼ã«Cookieæƒ…å ±ã‚’åŸ‹ã‚è¾¼ã‚“ã§ã‚µãƒ¼ãƒã«é€ä¿¡ã™ã‚‹ï¼ã‚µãƒ¼ãƒã¯ï¼ŒCookieæƒ…å ±ã«ç´ä»˜ãã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã®ãƒ‡ãƒ¼ã‚¿ã‚’Readã™ã‚‹ï¼ ã‚»ãƒƒã‚·ãƒ§ãƒ³ ãƒ»ã‚»ãƒƒã‚·ãƒ§ãƒ³ï¼Œã‚»ãƒƒã‚·ãƒ§ãƒ³IDã¨ã¯ ç‰¹å®šã®ã‚µã‚¤ãƒˆã‚’è¨ªå•ã—ã¦ã‹ã‚‰ï¼Œé›¢è„±ã™ã‚‹ã¾ã§ã®ä¸€é€£ã®ãƒ¦ãƒ¼ã‚¶æ“ä½œã‚’ã€ã‚»ãƒƒã‚·ãƒ§ãƒ³ã€ã¨ã„ã†ï¼ã“ã®æ™‚ï¼Œã‚»ãƒƒã‚·ãƒ§ãƒ³IDã‚’ç”¨ã„ã‚‹ã¨ï¼Œã‚»ãƒƒã‚·ãƒ§ãƒ³ã®å„ãƒªã‚¯ã‚¨ã‚¹ãƒˆã®é€ä¿¡å…ƒã‚’åŒä¸€ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã¨ã—ã¦è­˜åˆ¥ã§ãã‚‹ï¼HTTPã¯Statelessãƒ—ãƒ­ãƒˆã‚³ãƒ«ã§ã‚ã‚‹ãŒï¼Œã‚»ãƒƒã‚·ãƒ§ãƒ³IDã«ã‚ˆã‚Šæ“¬ä¼¼çš„ã«Statefulãªé€šä¿¡ã‚’è¡Œãˆã‚‹ï¼ä¾‹ãˆã°ã‚»ãƒƒã‚·ãƒ§ãƒ³IDã«ã‚ˆã‚Šï¼Œãƒ­ã‚°ã‚¤ãƒ³å¾Œã«ãƒšãƒ¼ã‚¸é·ç§»ã‚’è¡Œã£ã¦ã‚‚ï¼Œãƒ­ã‚°ã‚¤ãƒ³æƒ…å ±ã‚’ä¿æŒã§ãï¼ŒåŒä¸€ãƒ¦ãƒ¼ã‚¶ã‹ã‚‰ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆã¨ã—ã¦èªè­˜ã§ãã‚‹ï¼ã‚»ãƒƒã‚·ãƒ§ãƒ³IDã¯ï¼ŒCookieæƒ…å ±ã®ä¸€ã¤ã¨ã—ã¦ï¼ŒCookieãƒ˜ãƒƒãƒ€ãƒ¼ã¨Set-Cookieãƒ˜ãƒƒãƒ€ãƒ¼ã‚’ä½¿ç”¨ã—ã¦é€å—ä¿¡ã•ã‚Œã‚‹ï¼ # ãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒ˜ãƒƒãƒ€ãƒ¼ã®å ´åˆ Cookie: sessionid=; csrftoken=u32t4o3tb3gg43; _gat=1 # ãƒ¬ã‚¹ãƒãƒ³ã‚¹ãƒ˜ãƒƒãƒ€ãƒ¼ã®å ´åˆ Set-Cookie: sessionId= ã‚»ãƒƒã‚·ãƒ§ãƒ³æ•°ã¯Googleã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã§ç¢ºèªã§ãã‚‹ï¼GoogleConsoleã«ãŠã‘ã‚‹ã‚»ãƒƒã‚·ãƒ§ãƒ³ã«ã¤ã„ã¦ã¯ï¼Œä»¥ä¸‹ã®ãƒªãƒ³ã‚¯ã‚’å‚è€ƒã«ã›ã‚ˆï¼ å‚è€ƒï¼šhttps://support.google.com/analytics/answer/6086069?hl=ja ãƒ»ã‚»ãƒƒã‚·ãƒ§ãƒ³IDã®ç™ºè¡Œï¼Œã‚»ãƒƒã‚·ãƒ§ãƒ³ãƒ•ã‚¡ã‚¤ãƒ«ã®ç”Ÿæˆ ã‚»ãƒƒã‚·ãƒ§ãƒ³ã¯ï¼Œsession_startãƒ¡ã‚½ãƒƒãƒ‰ã‚’ç”¨ã„ã‚‹ã“ã¨ã§é–‹å§‹ã•ã‚Œã‚‹ï¼ã¾ãŸåŒæ™‚ã«ï¼Œã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã«ã‚»ãƒƒã‚·ãƒ§ãƒ³IDã‚’ç™ºè¡Œã™ã‚‹ï¼ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°ã«ã‚»ãƒƒã‚·ãƒ§ãƒ³IDã‚’ä»£å…¥ã™ã‚‹ã“ã¨ã«ã‚ˆã£ã¦ï¼Œã‚»ãƒƒã‚·ãƒ§ãƒ³IDã®è¨˜è¼‰ã•ã‚ŒãŸã‚»ãƒƒã‚·ãƒ§ãƒ³ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã™ã‚‹ï¼ã‚»ãƒƒã‚·ãƒ§ãƒ³IDã«ç´ä»˜ããã®ä»–ã®ãƒ‡ãƒ¼ã‚¿ã¯ã“ã®ã‚»ãƒƒã‚·ãƒ§ãƒ³ãƒ•ã‚¡ã‚¤ãƒ«ã«æ›¸ãè¾¼ã¾ã‚Œã¦ã„ãï¼ã‚»ãƒƒã‚·ãƒ§ãƒ³ãƒ•ã‚¡ã‚¤ãƒ«ã®åå‰ã¯ï¼Œsess_*****ãƒ•ã‚¡ã‚¤ãƒ«ã¨ãªã£ã¦ãŠã‚Šï¼Œã‚»ãƒƒã‚·ãƒ§ãƒ³ãƒ•ã‚¡ã‚¤ãƒ«åã‚’å…ƒã«ã—ã¦ã‚»ãƒƒã‚·ãƒ§ãƒ³IDã«ç´ä»˜ããƒ‡ãƒ¼ã‚¿ã‚’å‚ç…§ã™ã‚‹ï¼ã‚‚ã—ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã«æ—¢ã«ã‚»ãƒƒã‚·ãƒ§ãƒ³IDãŒç™ºè¡Œã•ã‚Œã¦ã„ã‚‹å ´åˆï¼Œã‚»ãƒƒã‚·ãƒ§ãƒ³ãƒ•ã‚¡ã‚¤ãƒ«ã‚’å‚ç…§ã™ã‚‹ã‚ˆã†ã«ãªã‚‹ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š ãƒ»ã‚»ãƒƒã‚·ãƒ§ãƒ³ãƒ•ã‚¡ã‚¤ãƒ«ã®ä¿å­˜å ´æ‰€ ã‚»ãƒƒã‚·ãƒ§ãƒ³ãƒ•ã‚¡ã‚¤ãƒ«ã®ä¿å­˜å ´æ‰€ã¯/etc/php.iniãƒ•ã‚¡ã‚¤ãƒ«ã§å®šç¾©ã§ãã‚‹ï¼ # /etc/php.ini ### ãƒ•ã‚¡ã‚¤ãƒ«å½¢å¼ session.save_handler = files ### ä¿å­˜å ´æ‰€ session.save_path = \"/tmp\" ã‚»ãƒƒã‚·ãƒ§ãƒ³ãƒ•ã‚¡ã‚¤ãƒ«ã¯ï¼Œã‚µãƒ¼ãƒå¤–ï¼ˆPHP Redisï¼ŒElastiCache Redisãªã©ï¼‰ã«ä¿å­˜ã™ã‚‹ã“ã¨ã‚‚ã§ãã‚‹ï¼/etc/php-fpm.d/www.confãƒ•ã‚¡ã‚¤ãƒ«ã§ã¯ãªãï¼Œ/etc/php.iniãƒ•ã‚¡ã‚¤ãƒ«ã«ã¦ä¿å­˜å…ˆã®æŒ‡å®šãŒå¿…è¦ã§ã‚ã‚‹ï¼ElastiCache Redisã«ã¤ã„ã¦ã¯ï¼Œä»¥ä¸‹ã®ãƒªãƒ³ã‚¯ã‚’å‚è€ƒã«ã›ã‚ˆï¼ å‚è€ƒï¼šhttps://hiroki-it.github.io/tech-notebook-gitbook/public/cloud_computing/cloud_computing_aws.html # /etc/php.ini ## Rediså½¢å¼ session.save_handler = redis ## Amazon Redisã®Origin session.save_path = \"tcp://foo-redis.*****.ng.0001.apne1.cache.amazonaws.com:6379\" ãªãŠï¼ŒPHP-FPMã‚’ä½¿ç”¨ã—ã¦ã„ã‚‹å ´åˆã¯ï¼Œ/etc/php-fpm.d/www.confãƒ•ã‚¡ã‚¤ãƒ«ã«ã¦ï¼Œã‚»ãƒƒã‚·ãƒ§ãƒ³ãƒ•ã‚¡ã‚¤ãƒ«ã®ä¿å­˜å…ˆã‚’æŒ‡å®šã™ã‚‹å¿…è¦ãŒã‚ã‚‹ï¼ # /etc/php-fpm.d/www.conf ## Rediså½¢å¼ php_value[session.save_handler] = redis ## Amazon Redisã®Origin php_value[session.save_path] = \"tcp://foo-redis.*****.ng.0001.apne1.cache.amazonaws.com:6379\" ãƒ»ã‚»ãƒƒã‚·ãƒ§ãƒ³ã®æœ‰åŠ¹æœŸé™ã¨åˆæœŸåŒ–ç¢ºç‡ ã‚»ãƒƒã‚·ãƒ§ãƒ³ã®æœ‰åŠ¹æœŸé™ã‚’è¨­å®šã§ãã‚‹ï¼ã“ã‚Œã«ã‚ˆã‚Šï¼Œç”»é¢é·ç§»æ™‚ã«ãƒ­ã‚°ã‚¤ãƒ³æƒ…å ±ã‚’ä¿æŒã§ãã‚‹ç§’æ•°ã‚’å®šç¾©ã§ãã‚‹ï¼ # 24æ™‚é–“ session.gc_maxlifetime = 86400 ãŸã ã—ï¼Œæœ‰åŠ¹æœŸé™ãŒåˆ‡ã‚ŒãŸå¾Œã«ã‚»ãƒƒã‚·ãƒ§ãƒ³ãƒ•ã‚¡ã‚¤ãƒ«ã‚’åˆæœŸåŒ–ã™ã‚‹ã‹ã©ã†ã‹ã¯ç¢ºç‡ã«ã‚ˆã£ã¦å®šã‚ã‚‰ã‚Œã¦ã„ã‚‹ï¼ç¢ºç‡ã¯ï¼Œ ã€gc_probabilityÃ·gc_divisorã€ ã§è¨ˆç®—ã•ã‚Œã‚‹ï¼ å‚è€ƒï¼šhttps://www.php.net/manual/ja/session.configuration.php#ini.session.gc-divisor # æœ‰åŠ¹æœŸé™å¾Œã«100%åˆæœŸåŒ–ã•ã‚Œã‚‹ã‚ˆã†ã«ã™ã‚‹ï¼ session.gc_probability = 1 session.gc_divisor = 1 ãƒ»ä»•çµ„ã¿ æœ€åˆï¼Œãƒ–ãƒ©ã‚¦ã‚¶ã¯ãƒªã‚¯ã‚¨ã‚¹ãƒˆã§ãƒ‡ãƒ¼ã‚¿ã‚’é€ä¿¡ã™ã‚‹ï¼ã‚»ãƒƒã‚·ãƒ§ãƒ³IDã‚’ç™ºè¡Œã—ï¼Œã‚»ãƒƒã‚·ãƒ§ãƒ³IDã”ã¨ã«sess_*****ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç”Ÿæˆï¼ ã‚µãƒ¼ãƒã¯ï¼Œãƒ¬ã‚¹ãƒãƒ³ã‚¹ãƒ˜ãƒƒãƒ€æƒ…å ±ã®Cookieãƒ˜ãƒƒãƒ€ãƒ¼ã‚’ä½¿ç”¨ã—ã¦ï¼Œã‚»ãƒƒã‚·ãƒ§ãƒ³IDã‚’é€ä¿¡ã™ã‚‹ï¼ ãƒ–ãƒ©ã‚¦ã‚¶ã¯ï¼Œãã®ã‚»ãƒƒã‚·ãƒ§ãƒ³IDã‚’ä¿å­˜ã™ã‚‹ï¼ 2å›ç›®ä»¥é™ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆã§ã¯ï¼Œãƒ–ãƒ©ã‚¦ã‚¶ã¯ï¼Œãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒ˜ãƒƒãƒ€æƒ…å ±ã®Cookieãƒ˜ãƒƒãƒ€ãƒ¼ã‚’ä½¿ç”¨ã—ã¦ï¼Œã‚»ãƒƒã‚·ãƒ§ãƒ³IDã‚’ã‚µãƒ¼ãƒã«é€ä¿¡ã™ã‚‹ï¼ã‚µãƒ¼ãƒã¯ï¼Œã‚»ãƒƒã‚·ãƒ§ãƒ³IDã«ç´ä»˜ãã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã®ãƒ‡ãƒ¼ã‚¿ã‚’Readã™ã‚‹ï¼ "},"public/software/software_application_collaboration_api_restful_api_specification.html":{"url":"public/software/software_application_collaboration_api_restful_api_specification.html","title":"ğŸ“– ï¸APIä»•æ§˜æ›¸","keywords":"","body":"APIä»•æ§˜æ›¸ 01. OpenAPIä»•æ§˜ OpenAPIä»•æ§˜ã¨ã¯ RESTful APIã®ä»•æ§˜ã‚’å®Ÿè£…ã«ã‚ˆã‚Šèª¬æ˜ã™ã‚‹ãŸã‚ã®ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã®ã“ã¨ï¼JSONå‹ã¾ãŸã¯YAMLå‹ã§å®Ÿè£…ã§ãã‚‹ï¼ã„ãã¤ã‹ã®ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‹ã‚‰æ§‹æˆã•ã‚Œã¦ã„ã‚‹ï¼ å‚è€ƒï¼šhttps://spec.openapis.org/oas/v3.1.0#fixed-fields openapi: # openapiãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ info: # infoãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ servers: # serversãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ paths: # pathsãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ webhooks: # webhooksãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ components: # componentsãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ security: # securityãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ tags: # tagsãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ externalDocs: # externalDocsãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ API Gatewayã«ã‚ˆã‚‹ã‚¤ãƒ³ãƒãƒ¼ãƒˆ API Gatewayã«ã‚ˆã‚‹OpenAPIä»•æ§˜ã®ã‚¤ãƒ³ãƒãƒ¼ãƒˆã«ã¤ã„ã¦ã¯ï¼Œä»¥ä¸‹ã‚’å‚è€ƒã«ã›ã‚ˆï¼ å‚è€ƒï¼šhttps://hiroki-it.github.io/tech-notebook-gitbook/public/infrastructure_cloud_computing_aws_apigateway_import.html ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ ãƒ»openapiãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ï¼ˆå¿…é ˆï¼‰ OpenAPIä»•æ§˜ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’å®šç¾©ã™ã‚‹ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š openapi: 3.0.0 ãƒ»infoãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ï¼ˆå¿…é ˆï¼‰ APIåï¼Œä½œæˆè€…åï¼Œãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ï¼Œãƒ©ã‚¤ã‚»ãƒ³ã‚¹ï¼Œãªã©ã‚’å®šç¾©ã™ã‚‹ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š info: title: Foo API # APIå description: The API for Foo. # APIã®èª¬æ˜ termsOfService: https://www.foo.com/terms/ # åˆ©ç”¨è¦ç´„ contact: name: API support # é€£çµ¡å…ˆå url: https://www.foo.com/support # é€£çµ¡å…ˆã«é–¢ã™ã‚‹URL email: support@foo.com # ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ license: name: Apache 2.0 # ãƒ©ã‚¤ã‚»ãƒ³ã‚¹ url: https://www.apache.org/licenses/LICENSE-2.0.html # URL version: 1.0.0 # APIãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ ãƒ»serversãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ APIè‡ªä½“ã®URLï¼Œãªã©ã‚’å®šç¾©ã™ã‚‹ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š servers: - url: https://{env}.foo.com/api/v1 description: | variables: env: default: stg description: API environment enum: - stg - www ãƒ»pathsãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ï¼ˆå¿…é ˆï¼‰ APIã®ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆï¼ŒHTTPãƒ¡ã‚½ãƒƒãƒ‰ï¼Œã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚³ãƒ¼ãƒ‰ï¼Œãªã©ã‚’å®šç¾©ã™ã‚‹ï¼ paths: #=========================== # pathsã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ #=========================== /users: #=========================== # path itemã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ #=========================== get: # GETãƒ¡ã‚½ãƒƒãƒ‰ã‚’æŒ‡å®šã™ã‚‹ï¼ tags: - ãƒ¦ãƒ¼ã‚¶æƒ…å ±å–å¾—ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ summary: ãƒ¦ãƒ¼ã‚¶æƒ…å ±å–å¾— description: å…¨ãƒ¦ãƒ¼ã‚¶æƒ…å ±ã‚’å–å¾—ã™ã‚‹ï¼ #=========================== # ãƒªã‚¯ã‚¨ã‚¹ãƒˆ #=========================== parameters: [] #=========================== # ãƒ¬ã‚¹ãƒãƒ³ã‚¹ #=========================== responses: '200': description: OK ãƒ¬ã‚¹ãƒãƒ³ã‚¹ content: application/json: # MIME type foo: # ãƒ¬ã‚¹ãƒãƒ³ã‚¹ãƒœãƒ‡ã‚£ä¾‹ Users: User: userId: 1 name: Hiroki schema: $ref: \"#/components/schemas/user\" # Userãƒ¢ãƒ‡ãƒ«ã‚’å‚ç…§ã™ã‚‹ï¼ '400': description: Bad Request ãƒ¬ã‚¹ãƒãƒ³ã‚¹ content: application/json: # MIME type foo: # ãƒ¬ã‚¹ãƒãƒ³ã‚¹ãƒœãƒ‡ã‚£ä¾‹ status: 400 title: Bad Request errors: messages: [ \"ä¸æ­£ãªãƒªã‚¯ã‚¨ã‚¹ãƒˆã§ã™ï¼\" ] schema: $ref: \"#/components/schemas/error\" # ç•°å¸¸ç³»ãƒ¢ãƒ‡ãƒ«ã‚’å‚ç…§ã™ã‚‹ï¼ '401': $ref: \"#/components/responses/unauthorized\" # èªè¨¼ã‚¨ãƒ©ãƒ¼ã‚’å‚ç…§ã™ã‚‹ï¼ #=========================== # path itemã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ #=========================== post: # POSTãƒ¡ã‚½ãƒƒãƒ‰ã‚’æŒ‡å®šã™ã‚‹ï¼ tags: - ãƒ¦ãƒ¼ã‚¶æƒ…å ±ä½œæˆã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ summary: ãƒ¦ãƒ¼ã‚¶æƒ…å ±ä½œæˆ description: ãƒ¦ãƒ¼ã‚¶æƒ…å ±ã‚’ä½œæˆã™ã‚‹ï¼ #=========================== # ãƒªã‚¯ã‚¨ã‚¹ãƒˆ #=========================== parameters: [] requestBody: # ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãƒœãƒ‡ã‚£ã«ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’å‰²ã‚Šå½“ã¦ã‚‹ï¼ description: ãƒ¦ãƒ¼ã‚¶ID content: application/json: # MIME type foo: # ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãƒœãƒ‡ã‚£ä¾‹ userId: 1 schema: # ã‚¹ã‚­ãƒ¼ãƒ $ref: \"#/components/schemas/user\" # Userãƒ¢ãƒ‡ãƒ«ã‚’å‚ç…§ã™ã‚‹ï¼ #=========================== # ãƒ¬ã‚¹ãƒãƒ³ã‚¹ #=========================== responses: '200': description: OK ãƒ¬ã‚¹ãƒãƒ³ã‚¹ content: application/json: # MIME type foo: # ãƒ¬ã‚¹ãƒãƒ³ã‚¹ãƒœãƒ‡ã‚£ä¾‹ userId: 1 schema: $ref: \"#/components/schemas/normal\" # ã‚¹ã‚­ãƒ¼ãƒã¨ã—ã¦ï¼Œæ­£å¸¸ç³»ãƒ¢ãƒ‡ãƒ«ã‚’å‚ç…§ã™ã‚‹ï¼ '400': description: Bad Request ãƒ¬ã‚¹ãƒãƒ³ã‚¹ content: application/json: # MIME type foo: # ãƒ¬ã‚¹ãƒãƒ³ã‚¹ãƒœãƒ‡ã‚£ä¾‹ status: 400 title: Bad Request errors: messages: [ \"ãƒ¦ãƒ¼ã‚¶IDã¯å¿…ãšæŒ‡å®šã—ã¦ãã ã•ã„ï¼\" ] schema: $ref: \"#/components/schemas/error\" # ã‚¹ã‚­ãƒ¼ãƒã¨ã—ã¦ï¼Œç•°å¸¸ç³»ãƒ¢ãƒ‡ãƒ«ã‚’å‚ç…§ã™ã‚‹ï¼ '401': $ref: \"#/components/responses/unauthorized\" # èªè¨¼ã‚¨ãƒ©ãƒ¼ã‚’å‚ç…§ã™ã‚‹ï¼ #=========================== # pathsã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ #=========================== /users/{userId}: #=========================== # path itemã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ #=========================== get: tags: - ãƒ¦ãƒ¼ã‚¶æƒ…å ±å–å¾—ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ summary: æŒ‡å®šãƒ¦ãƒ¼ã‚¶æƒ…å ±å–å¾— description: æŒ‡å®šã—ãŸãƒ¦ãƒ¼ã‚¶æƒ…å ±ã‚’å–å¾—ã™ã‚‹ï¼ #=========================== # ãƒªã‚¯ã‚¨ã‚¹ãƒˆ #=========================== parameters: - in: path # ãƒ‘ã‚¹ã«ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’å‰²ã‚Šå½“ã¦ã‚‹ï¼ name: userId required: true description: ãƒ¦ãƒ¼ã‚¶ID schema: type: string foo: # ãƒ‘ã‚¹ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ä¾‹ userId=1 #=========================== # ãƒ¬ã‚¹ãƒãƒ³ã‚¹ #=========================== responses: '200': description: OK ãƒ¬ã‚¹ãƒãƒ³ã‚¹ content: application/json: # MIME type foo: # ãƒœãƒ‡ã‚£ä¾‹ userId: 1 name: Hiroki schema: # ã‚¹ã‚­ãƒ¼ãƒ $ref: \"#/components/schemas/user\" # Userãƒ¢ãƒ‡ãƒ«ã‚’å‚ç…§ã™ã‚‹ï¼ '400': description: Bad Request ãƒ¬ã‚¹ãƒãƒ³ã‚¹ content: application/json: # MIME type foo: # ãƒœãƒ‡ã‚£ä¾‹ status: 400 title: Bad Request errors: messages: [ \"ãƒ¦ãƒ¼ã‚¶IDã¯å¿…ãšæŒ‡å®šã—ã¦ãã ã•ã„ï¼\" ] schema: $ref: \"#/components/schemas/error\" # ç•°å¸¸ç³»ãƒ¢ãƒ‡ãƒ«ã‚’å‚ç…§ã™ã‚‹ï¼ '401': $ref: \"#/components/responses/unauthorized\" # èªè¨¼ã‚¨ãƒ©ãƒ¼ã‚’å‚ç…§ã™ã‚‹ï¼ '404': description: Not Found ãƒ¬ã‚¹ãƒãƒ³ã‚¹ content: application/json: # MIME type foo: # ãƒœãƒ‡ã‚£ä¾‹ status: 404 title: Not Found errors: messages: [ \"å¯¾è±¡ã®ãƒ¦ãƒ¼ã‚¶ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸï¼\" ] schema: $ref: \"#/components/schemas/error\" # ç•°å¸¸ç³»ãƒ¢ãƒ‡ãƒ«ã‚’å‚ç…§ã™ã‚‹ï¼ #=========================== # path itemã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ #=========================== put: tags: - ãƒ¦ãƒ¼ã‚¶æƒ…å ±æ›´æ–°ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ summary: æŒ‡å®šãƒ¦ãƒ¼ã‚¶æ›´æ–° description: æŒ‡å®šã—ãŸãƒ¦ãƒ¼ã‚¶æƒ…å ±ã‚’æ›´æ–°ã™ã‚‹ï¼ #=========================== # ãƒªã‚¯ã‚¨ã‚¹ãƒˆ #=========================== parameters: - in: path # ãƒ‘ã‚¹ã«ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’å‰²ã‚Šå½“ã¦ã‚‹ï¼ name: userId required: true description: ãƒ¦ãƒ¼ã‚¶ID schema: type: string foo: # ãƒ‘ã‚¹ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ä¾‹ userId=1 #=========================== # ãƒ¬ã‚¹ãƒãƒ³ã‚¹ #=========================== responses: '200': description: OK ãƒ¬ã‚¹ãƒãƒ³ã‚¹ content: application/json: # Content-Type foo: # ãƒœãƒ‡ã‚£ä¾‹ userId: 1 name: Hiroki schema: # ã‚¹ã‚­ãƒ¼ãƒ $ref: \"#/components/schemas/user\" # Userãƒ¢ãƒ‡ãƒ«ã‚’å‚ç…§ã™ã‚‹ï¼ '400': description: Bad Request ãƒ¬ã‚¹ãƒãƒ³ã‚¹ content: application/json: # Content-Type foo: # ãƒœãƒ‡ã‚£ä¾‹ status: 400 title: Bad Request errors: messages: [ \"ãƒ¦ãƒ¼ã‚¶IDã¯å¿…ãšæŒ‡å®šã—ã¦ãã ã•ã„ï¼\" ] schema: $ref: \"#/components/schemas/error\" # ç•°å¸¸ç³»ãƒ¢ãƒ‡ãƒ«ã‚’å‚ç…§ã™ã‚‹ï¼ '401': $ref: \"#/components/responses/unauthorized\" # èªè¨¼ã‚¨ãƒ©ãƒ¼ã‚’å‚ç…§ã™ã‚‹ï¼ '404': description: Not Found ãƒ¬ã‚¹ãƒãƒ³ã‚¹ content: application/json: # Content-Type foo: # ãƒœãƒ‡ã‚£ä¾‹ status: 404 title: Not Found errors: messages: [ \"å¯¾è±¡ã®ãƒ¦ãƒ¼ã‚¶ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸï¼\" ] schema: $ref: \"#/components/schemas/error\" # ç•°å¸¸ç³»ãƒ¢ãƒ‡ãƒ«ã‚’å‚ç…§ã™ã‚‹ï¼ ãƒ»componentsãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ï¼ˆå¿…é ˆï¼‰ ã‚¹ã‚­ãƒ¼ãƒãªã©ï¼Œä»–ã®é …ç›®ã§å…±é€šã—ã¦åˆ©ç”¨ã™ã‚‹ã‚‚ã®ã‚’å®šç¾©ã™ã‚‹ï¼ components: #=========================== # callbackã‚­ãƒ¼ã®å…±é€šåŒ– #=========================== callbacks: { } #=========================== # linkã‚­ãƒ¼ã®å…±é€šåŒ– #=========================== links: { } #=========================== # responseã‚­ãƒ¼ã®å…±é€šåŒ– #=========================== responses: unauthorized: description: Unauthorized ãƒ¬ã‚¹ãƒãƒ³ã‚¹ content: application/json: # MIME type foo: # ãƒœãƒ‡ã‚£ä¾‹ status: 401 title: Unauthorized errors: messages: [ \"APIã‚­ãƒ¼ã®èªå¯ã«å¤±æ•—ã—ã¾ã—ãŸï¼\" ] schema: $ref: \"#/components/schemas/error\" # ç•°å¸¸ç³»ãƒ¢ãƒ‡ãƒ«ã‚’å‚ç…§ã™ã‚‹ï¼ #=========================== # schemaã‚­ãƒ¼ã®å…±é€šåŒ– #=========================== schemas: # ãƒ¦ãƒ¼ã‚¶ user: type: object properties: userId: type: string name: type: string # æ­£å¸¸ç³» normal: type: object properties: userId: type: string # ç•°å¸¸ç³» error: type: object properties: messages: type: array items: type: string #=========================== # securityãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®å…±é€šåŒ– #=========================== securitySchemes: # Basicèªè¨¼ basicAuth: description: Basicèªè¨¼ type: http scheme: basic # Bearerèªè¨¼ bearerAuth: description: Bearerèªè¨¼ type: http scheme: bearer # APIã‚­ãƒ¼èªè¨¼ apiKeyAuth: description: APIã‚­ãƒ¼èªè¨¼ type: apiKey name: x-api-key # ãƒ˜ãƒƒãƒ€åã¯ã€x-api-keyã€ã¨ã™ã‚‹ï¼å°æ–‡å­—ãŒæ¨å¥¨ã§ã‚ã‚‹ï¼ in: header ï¼Šå®Ÿè£…ä¾‹ï¼Š ãƒ»securityãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ componentsãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã§å®šç¾©ã—ãŸèªè¨¼æ–¹æ³•ã‚’å®£è¨€ã™ã‚‹ï¼ãƒ«ãƒ¼ãƒˆã§å®£è¨€ã™ã‚‹ã¨ï¼Œå…¨ã¦ã®ãƒ‘ã‚¹ã«é©ç”¨ã§ãã‚‹ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š security: - apiKeyAuth: [] ãƒ»tagsãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ å„é …ç›®ã«ä»˜ã‘ã‚‹ã‚¿ã‚°ã‚’å®šç¾©ã™ã‚‹ï¼åŒåã®ã‚¿ã‚°ã‚’ã¤ã‘ã‚‹ã¨ï¼Œè‡ªå‹•çš„ã«ã¾ã¨ã‚ã‚‰ã‚Œã‚‹ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š tags: - name: ãƒ¦ãƒ¼ã‚¶æƒ…å ±å–å¾—ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ description: | ãƒ»externalDocsãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ APIã‚’èª¬æ˜ã™ã‚‹ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã®ãƒªãƒ³ã‚¯ã‚’å®šç¾©ã™ã‚‹ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š externalDocs: description: è£œè¶³æƒ…å ±ã¯ã“ã¡ã‚‰ url: https://foo.com ã‚¹ã‚­ãƒ¼ãƒ ãƒ»ã‚¹ã‚­ãƒ¼ãƒã¨ã¯ APIã«å¯¾ã—ã¦é€ä¿¡ã•ã‚Œã‚‹ãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®ãƒ‡ãƒ¼ã‚¿ï¼Œã¾ãŸã¯APIã‹ã‚‰è¿”ä¿¡ã•ã‚Œã‚‹ãƒ¬ã‚¹ãƒãƒ³ã‚¹ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®ãƒ‡ãƒ¼ã‚¿ã«ã¤ã„ã¦ï¼Œãƒ‡ãƒ¼ã‚¿å‹ã‚„å¿…é ˆãƒ‡ãƒ¼ã‚¿ã‚’ï¼ŒJSONå‹ã¾ãŸã¯YAMLå‹ã§å®Ÿè£…ã—ã¦ãŠã„ãŸã‚‚ã®ï¼ãƒªã‚¯ã‚¨ã‚¹ãƒˆï¼ãƒ¬ã‚¹ãƒãƒ³ã‚¹æ™‚ã®ãƒ‡ãƒ¼ã‚¿ã®ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã«ç”¨ã„ã‚‹ï¼ ãƒ»ã‚¹ã‚­ãƒ¼ãƒã«ã‚ˆã‚‹ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ ãƒ‡ãƒ¼ã‚¿å‹ã‚„å¿…é ˆãƒ‡ãƒ¼ã‚¿ã«ã‚ˆã‚Šï¼Œãƒªã‚¯ã‚¨ã‚¹ãƒˆï¼ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã®ãƒ‡ãƒ¼ã‚¿ã®ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’è¡Œã†ï¼ å‚è€ƒï¼šhttps://spec.openapis.org/oas/v3.1.0#data-types ï¼Šå®Ÿè£…ä¾‹ï¼Š ä¾‹ãˆã°ï¼ŒAPIãŒãƒ¬ã‚¹ãƒãƒ³ã‚¹æ™‚ã«ä»¥ä¸‹ã®ã‚ˆã†ãªJSONå‹ãƒ‡ãƒ¼ã‚¿ã‚’è¿”ä¿¡ã™ã‚‹ã¨ã™ã‚‹ï¼ { \"id\": 1, \"name\": \"Taro Yamada\", \"age\": 10, \"sports\":[\"soccer\", \"baseball\"], \"subjects\": \"math\" } ã“ã“ã§ï¼Œã‚¹ã‚­ãƒ¼ãƒã‚’ä»¥ä¸‹ã®ã‚ˆã†ã«å®šç¾©ã—ã¦ãŠãï¼ŒAPIã‹ã‚‰ãƒ‡ãƒ¼ã‚¿ã‚’ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã™ã‚‹æ™‚ã®ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’è¡Œã†ï¼ { \"$schema\": \"https://json-schema.org/draft-04/schema#\", \"type\": \"object\", \"properties\": { \"id\": { \"type\": \"integer\", \"minimum\": 1 }, \"name\": { \"type\": \"string\" }, \"age\": { \"type\": \"integer\", \"minimum\": 0 }, \"sports\": { \"type\": \"array\", \"items\": { \"type\": \"string\" } }, \"subjects\": { \"type\": \"string\" } }, \"required\": [\"id\"] } ãƒ»API Gatewayã«ãŠã‘ã‚‹ã‚¹ã‚­ãƒ¼ãƒè¨­å®š API Gatewayã«ã¦ï¼Œãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã®ãŸã‚ã«ã‚¹ã‚­ãƒ¼ãƒã‚’è¨­å®šã§ãã‚‹ï¼è©³ã—ãã¯ï¼Œä»¥ä¸‹ã®ãƒãƒ¼ãƒˆã‚’å‚è€ƒã«ã›ã‚ˆï¼ å‚è€ƒï¼šhttps://hiroki-it.github.io/tech-notebook-gitbook/public/cloud_computing/cloud_computing_aws.html "},"public/software/software_application_backend_php_command_and_configuration.html":{"url":"public/software/software_application_backend_php_command_and_configuration.html","title":"ğŸ“– PHPã‚³ãƒãƒ³ãƒ‰ã¨è¨­å®š","keywords":"","body":"PHPã‚³ãƒãƒ³ãƒ‰ã¨è¨­å®š ã¯ã˜ã‚ã« æœ¬ã‚µã‚¤ãƒˆã«ã¤ãã¾ã—ã¦ï¼Œä»¥ä¸‹ã‚’ã”èªè­˜ã®ã»ã©å®œã—ããŠé¡˜ã„ã„ãŸã—ã¾ã™ï¼ å‚è€ƒï¼šhttps://hiroki-it.github.io/tech-notebook-gitbook/ 01. ã‚³ãƒãƒ³ãƒ‰ -ini Configuration Fileã®é …ç›®ã§ï¼Œphp.iniãƒ•ã‚¡ã‚¤ãƒ«ã®ã‚ã‚‹ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’è¡¨ç¤ºã™ã‚‹ï¼ ï¼Šã‚³ãƒãƒ³ãƒ‰ä¾‹ï¼Š $ php --ini Configuration File (php.ini) Path: /usr/local/etc/php # iniãƒ•ã‚¡ã‚¤ãƒ«ã®ã‚ã‚‹ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª Loaded Configuration File: (none) Scan for additional .ini files in: /usr/local/etc/php/conf.d Additional .ini files parsed: /usr/local/etc/php/conf.d/docker-php-ext-bcmath.ini, /usr/local/etc/php/conf.d/docker-php-ext-pdo_mysql.ini, /usr/local/etc/php/conf.d/docker-php-ext-sodium.ini $ ls -la /usr/local/etc/php total 164 drwxr-xr-x 1 root root 4096 Sep 1 2020 . drwxr-xr-x 1 root root 4096 Sep 1 2020 .. drwxr-xr-x 1 root root 4096 Sep 25 12:22 conf.d -rw-r--r-- 1 root root 72278 Sep 1 2020 php.ini-development # é–‹ç™ºç’°å¢ƒç”¨iniãƒ•ã‚¡ã‚¤ãƒ« -rw-r--r-- 1 root root 72582 Sep 1 2020 php.ini-production # æœ¬ç•ªç’°å¢ƒç”¨iniãƒ•ã‚¡ã‚¤ãƒ« --ri æ‹¡å¼µãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã®è¨­å®šå€¤ã‚’è¡¨ç¤ºã™ã‚‹ï¼ ï¼Šã‚³ãƒãƒ³ãƒ‰ä¾‹ï¼Š $ php --ri= $ php --ri=Core Core PHP Version => 7.4.9 Directive => Local Value => Master Value highlight.comment => #FF8000 => #FF8000 highlight.default => #0000BB => #0000BB highlight.html => #000000 => #000000 highlight.keyword => #007700 => #007700 highlight.string => #DD0000 => #DD0000 display_errors => STDOUT => STDOUT display_startup_errors => Off => Off enable_dl => On => On ... zend.detect_unicode => On => On zend.signal_check => Off => Off zend.exception_ignore_args => Off => Off 02. è¨­å®š php.iniãƒ•ã‚¡ã‚¤ãƒ« ãƒ»php.iniãƒ•ã‚¡ã‚¤ãƒ«ã¨ã¯ PHPã®è¨­å®šã‚’è¡Œã†ï¼ å‚è€ƒï¼šhttps://www.php.net/manual/ja/configuration.file.php ãƒ»é–‹ç™ºç’°å¢ƒç”¨php.iniãƒ•ã‚¡ã‚¤ãƒ« ã‚ã‚‰ã‹ã˜ã‚ç”¨æ„ã•ã‚Œã¦ã„ã‚‹php.ini-developmentãƒ•ã‚¡ã‚¤ãƒ«ã‚’å‚è€ƒã«è¨­å®šã™ã‚‹ï¼å…ƒã€…ã®å€¤ã‚’ã‚³ãƒ¡ãƒ³ãƒˆã‚¢ã‚¦ãƒˆã§ç¤ºã™ï¼ å‚è€ƒï¼šhttps://qiita.com/ucan-lab/items/0d74378e1b9ba81699a9 # é–‹ç™ºç’°å¢ƒã§ã¯ï¼Œã‚¹ã‚¿ãƒƒã‚¯ãƒˆãƒ¬ãƒ¼ã‚¹ã‚’è¡¨ç¤º zend.exception_ignore_args = off # on expose_php = on max_execution_time = 30 max_input_vars = 1000 upload_max_filesize = 64M # 2M post_max_size = 128M # 8M memory_limit = 256M # 128M # é–‹ç™ºç’°å¢ƒã§ã¯ï¼Œå…¨ã¦ã®ãƒ­ã‚°ãƒ¬ãƒ™ãƒ«ã‚’å‡ºåŠ› error_reporting = E_ALL # NULL display_errors = on display_startup_errors = on # é–‹ç™ºç’°å¢ƒã§ã¯ï¼Œãƒ­ã‚°ã‚’error_logå€¤ã®å ´æ‰€ã«å‡ºåŠ› log_errors = on # 0(off) # é–‹ç™ºç’°å¢ƒã§ã¯ï¼Œã‚¨ãƒ©ãƒ¼ãƒ­ã‚°ã‚’ãƒ•ã‚¡ã‚¤ãƒ«ã«å‡ºåŠ› error_log = /var/log/php/php-error.log # NULL default_charset = UTF-8 [Date] date.timezone = Asia/Tokyo # GMT [mysqlnd] # é–‹ç™ºç’°å¢ƒã§ã¯ï¼Œãƒ¡ãƒ¢ãƒªã®ãƒ¡ãƒˆãƒªã‚¯ã‚¹ã‚’åé›† mysqlnd.collect_memory_statistics = on # off [Assertion] zend.assertions = 1 [mbstring] mbstring.language = Japanese ãƒ»æœ¬ç•ªç’°å¢ƒç”¨php.iniãƒ•ã‚¡ã‚¤ãƒ« ã‚ã‚‰ã‹ã˜ã‚ç”¨æ„ã•ã‚Œã¦ã„ã‚‹php.ini-productionãƒ•ã‚¡ã‚¤ãƒ«ã‚’å‚è€ƒã«è¨­å®šã™ã‚‹ï¼å…ƒã€…ã®å€¤ã‚’ã‚³ãƒ¡ãƒ³ãƒˆã‚¢ã‚¦ãƒˆã§ç¤ºã™ï¼ å‚è€ƒï¼šhttps://qiita.com/ucan-lab/items/0d74378e1b9ba81699a9 zend.exception_ignore_args = on # æœ¬ç•ªç’°å¢ƒã§ã¯ï¼ŒX-Powered-Byãƒ˜ãƒƒãƒ€ãƒ¼ã®PHPãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’éè¡¨ç¤º expose_php = off # on max_execution_time = 30 max_input_vars = 1000 upload_max_filesize = 64M post_max_size = 128M memory_limit = 256M # æœ¬ç•ªç’°å¢ƒã§ã¯ï¼Œç‰¹å®šã®ãƒ­ã‚°ãƒ¬ãƒ™ãƒ«ã‚’å‡ºåŠ› error_reporting = E_ALL & ~E_DEPRECATED & ~E_STRICT # NULL # æœ¬ç•ªç’°å¢ƒã§ã¯ï¼Œã‚¨ãƒ©ãƒ¼ã‚’ç”»é¢ã«éè¡¨ç¤º display_errors = off # on display_startup_errors = off # æœ¬ç•ªç’°å¢ƒã§ã¯ï¼Œã‚¨ãƒ©ãƒ¼ãƒ­ã‚°ã‚’error_logå€¤ã®å ´æ‰€ã«å‡ºåŠ› log_errors = on # 0(off) # æœ¬ç•ªç’°å¢ƒã§ã¯ï¼Œã‚¨ãƒ©ãƒ¼ãƒ­ã‚°ã‚’æ¨™æº–ã‚¨ãƒ©ãƒ¼å‡ºåŠ›ã«å‡ºåŠ› error_log = /dev/stderr # NULL default_charset = UTF-8 [Date] date.timezone = Asia/Tokyo [mysqlnd] mysqlnd.collect_memory_statistics = off [Assertion] zend.assertions = -1 [mbstring] mbstring.language = Japanese # æœ¬ç•ªç’°å¢ƒã§ã¯ï¼ŒOpcacheæ©Ÿèƒ½ã‚’æœ‰åŠ¹åŒ– [opcache] opcache.enable = 1 opcache.memory_consumption = 128 opcache.interned_strings_buffer = 8 opcache.max_accelerated_files = 4000 opcache.validate_timestamps = 0 opcache.huge_code_pages = 0 opcache.preload = /var/www/preload.php opcache.preload_user = www-data 03. å½¹ç«‹ã¤æ©Ÿèƒ½ OPcache ãƒ»OPcacheã¨ã¯ é€šå¸¸ï¼ŒPHPã®ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã¯å®Ÿè¡Œã®åº¦ã«ãƒã‚¤ãƒŠãƒªå½¢å¼ã®ã‚³ãƒ¼ãƒ‰ã«å¤‰æ›ã•ã‚Œã‚‹ï¼ãƒã‚¤ãƒŠãƒªå½¢å¼ã®ã‚³ãƒ¼ãƒ‰ã‚’ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã¨ã—ã¦ä¿å­˜ã—ã¦ãŠãï¼Œã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ãŒå¤‰æ›´ã•ã‚ŒãŸæ™‚ã ã‘å¤‰æ›ã™ã‚‹ã‚ˆã†ã«ã™ã‚‹ï¼ã“ã‚Œã«ã‚ˆã‚Šï¼ŒPHPã®ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã®å®Ÿè¡ŒãŒé«˜é€ŸåŒ–ã•ã‚Œã‚‹ï¼ å‚è€ƒï¼šhttps://weblabo.oscasierra.net/php-opcache/ "},"public/software/software_application_backend_php_object_orientation_analysis_design_programming.html":{"url":"public/software/software_application_backend_php_object_orientation_analysis_design_programming.html","title":"ğŸ“– ï¸ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆæŒ‡å‘åˆ†æï¼è¨­è¨ˆï¼ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°","keywords":"","body":"ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆæŒ‡å‘åˆ†æï¼è¨­è¨ˆï¼ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚° ã¯ã˜ã‚ã« æœ¬ã‚µã‚¤ãƒˆã«ã¤ãã¾ã—ã¦ï¼Œä»¥ä¸‹ã‚’ã”èªè­˜ã®ã»ã©å®œã—ããŠé¡˜ã„ã„ãŸã—ã¾ã™ï¼ å‚è€ƒï¼šhttps://hiroki-it.github.io/tech-notebook-gitbook/ 01. ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã‚¹ã‚¿ã‚¤ãƒ« ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã‚¹ã‚¿ã‚¤ãƒ«ã¨åˆ†æãƒ»è¨­è¨ˆæ‰‹æ³• ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã‚¹ã‚¿ã‚¤ãƒ« ã‚¹ã‚¿ã‚¤ãƒ«ã«åŸºã¥ãè¨­è¨ˆ ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ¡ãƒ³ãƒˆæ§‹æˆ ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆï¼ã‚µãƒ¼ãƒ ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚µã‚¤ãƒ‰ï¼ã‚µãƒ¼ãƒã‚µã‚¤ãƒ‰ ã‚·ã‚¹ãƒ†ãƒ æ§‹æˆ ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆæŒ‡å‘ ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆæŒ‡å‘åˆ†æãƒ»è¨­è¨ˆ Layeredã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ Layeredã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£è¨­è¨ˆ MVC MVCè¨­è¨ˆ ãƒ‡ãƒ¼ã‚¿é€šä¿¡é ˜åŸŸ REST RESTful ãƒ‰ãƒ¡ã‚¤ãƒ³é ˜åŸŸæ§‹æˆ ãƒ‰ãƒ¡ã‚¤ãƒ³é§†å‹• ãƒ‰ãƒ¡ã‚¤ãƒ³é§†å‹•è¨­è¨ˆ 01-02. ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆæŒ‡å‘åˆ†æãƒ»è¨­è¨ˆ ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆæŒ‡å‘åˆ†æãƒ»è¨­è¨ˆã‚’å–ã‚Šå·»ãæ­´å² 02. ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆæŒ‡å‘åˆ†æ ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆæŒ‡å‘åˆ†æ ãƒ»ãã‚‚ãã‚‚ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã¨ã¯ äº’ã„ã«å¯†æ¥ã«é–¢é€£ã™ã‚‹ãƒ‡ãƒ¼ã‚¿ã¨æ‰‹ç¶šãï¼ˆå‡¦ç†æ‰‹é †ï¼‰ã‚’ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã¨å‘¼ã°ã‚Œã‚‹ä¸€ã¤ã®ã¾ã¨ã¾ã‚Šã¨ã—ã¦å®šç¾©ã™ã‚‹æ‰‹æ³•ã®ã“ã¨ï¼ ãƒ»ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆæŒ‡å‘åˆ†æã¨ã¯ ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆæŒ‡å‘åˆ†æã§ã¯ï¼Œã‚·ã‚¹ãƒ†ãƒ åŒ–ã®å¯¾è±¡ã«ãªã‚‹é ˜åŸŸã«å­˜åœ¨ã™ã‚‹æ¦‚å¿µã‚’ï¼Œãƒ¢ãƒ‡ãƒªãƒ³ã‚°ã™ã‚‹ï¼ ãƒ»ãƒ¢ãƒ‡ãƒªãƒ³ã‚°ã®æ³¨æ„ç‚¹ ãƒ¢ãƒ‡ãƒªãƒ³ã‚°ã®æ–¹æ³•ã¨ã—ã¦ï¼Œå®Ÿä½“ã®ã€çŠ¶æ…‹ã€ã¨ã€å‹•ä½œã€ã‚’è€ƒãˆã‚‹ï¼ ã—ã‹ã—ï¼Œã“ã‚Œã¯å³å¯†ã§ã¯ãªã„ï¼ ãªãœãªã‚‰ï¼Œãƒ“ã‚¸ãƒã‚¹é ˜åŸŸã‚’å®Ÿè£…ã™ã‚‹æ™‚ã«ã¯ï¼Œã»ã¨ã‚“ã©ã®å ´åˆã§ï¼Œå‹•ä½œã‚’æŒãŸãªã„å®Ÿä½“ã‚’è¡¨ç¾ã™ã‚‹ã“ã¨ã«ãªã‚‹ã‹ã‚‰ã§ã‚ã‚‹ï¼ ã‚ˆã‚Šå³å¯†ã«ç†è§£ã™ã‚‹ãŸã‚ã«ï¼Œå®Ÿä½“ã®ã€çŠ¶æ…‹ã€ã¨ã€çŠ¶æ…‹ã®å¤‰æ›´ã¨è¡¨ç¤ºã€ã¨è€ƒãˆã‚‹ã¹ãï¼ ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆæŒ‡å‘åˆ†æï¼è¨­è¨ˆã§ç”¨ã„ã‚‹ãƒ€ã‚¤ã‚¢ã‚°ãƒ©ãƒ å›³ã®ç¨®é¡ ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆæŒ‡å‘åˆ†æã«ãŠã„ã¦ã¯ï¼Œãƒ€ã‚¤ã‚¢ã‚°ãƒ©ãƒ å›³ã‚’ç”¨ã„ã¦ï¼Œã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’è¡¨ç¾ã™ã‚‹ã“ã¨ãŒå¿…è¦ã«ãªã‚‹ï¼ ãƒ»æ©Ÿèƒ½ã®è¦–ç‚¹ã«ã‚ˆã‚‹åˆ†æï¼è¨­è¨ˆã¨ã¯ ã‚·ã‚¹ãƒ†ãƒ ã®æ©Ÿèƒ½ã¨å‡¦ç†ã®æµã‚Œã«æ³¨ç›®ã—ï¼Œåˆ†æï¼è¨­è¨ˆã™ã‚‹æ–¹æ³•ï¼è©³ã—ãã¯ï¼Œä»¥é™ã®èª¬æ˜ã‚’å‚ç…§ã›ã‚ˆï¼ ãƒ»æŒ¯èˆã®è¦–ç‚¹ã«ã‚ˆã‚‹åˆ†æï¼è¨­è¨ˆã¨ã¯ ã‚·ã‚¹ãƒ†ãƒ ã‚’å®Ÿè¡Œã™ã‚‹é †ç•ªã‚„ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã«æ³¨ç›®ã—ï¼Œåˆ†æï¼è¨­è¨ˆã™ã‚‹æ–¹æ³•ï¼è©³ã—ãã¯ï¼Œä»¥é™ã®èª¬æ˜ã‚’å‚ç…§ã›ã‚ˆï¼ã‚·ãƒ¼ã‚±ãƒ³ã‚¹å›³ã¯è¨­è¨ˆã®æ®µéšã§ä½¿ç”¨ã™ã‚‹ï¼ å‚è€ƒï¼š https://hiroki-it.github.io/tech-notebook-gitbook/public/software/software_application_backend_php_object_orientation_class.html https://hiroki-it.github.io/tech-notebook-gitbook/public/software/software_application_backend_php_object_orientation_method_data.html ãƒ»æ§‹é€ ã®è¦–ç‚¹ã«ã‚ˆã‚‹åˆ†æï¼è¨­è¨ˆã¨ã¯ ã‚·ã‚¹ãƒ†ãƒ ã®æ§‹æˆè¦ç´ ã¨ãã‚Œãã‚Œã®é–¢ä¿‚ã«æ³¨ç›®ã—ï¼Œåˆ†æï¼è¨­è¨ˆã™ã‚‹æ–¹æ³•ï¼è©³ã—ãã¯ï¼Œä»¥é™ã®èª¬æ˜ã‚’å‚ç…§ã›ã‚ˆï¼ã‚¯ãƒ©ã‚¹å›³ã¯è¨­è¨ˆã®æ®µéšã§ä½¿ç”¨ã™ã‚‹ï¼ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆæŒ‡å‘è¨­è¨ˆã«ã¤ã„ã¦ã¯ï¼Œä»¥ä¸‹ã®ãƒªãƒ³ã‚¯ã‚’å‚è€ƒã«ã›ã‚ˆï¼ å‚è€ƒï¼š https://hiroki-it.github.io/tech-notebook-gitbook/public/software/software_application_backend_php_object_orientation_class.html https://hiroki-it.github.io/tech-notebook-gitbook/public/software/software_application_backend_php_object_orientation_method_data.html UMLï¼šUnified Modeling Languageï¼ˆçµ±ä¸€ãƒ¢ãƒ‡ãƒªãƒ³ã‚°è¨€èªï¼‰ ãƒ»UMLã¨ã¯ ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆæŒ‡å‘åˆ†æãƒ»è¨­è¨ˆã«ç”¨ã„ã‚‰ã‚Œã‚‹ãƒ€ã‚¤ã‚¢ã‚°ãƒ©ãƒ å›³ï¼ãƒ€ã‚¤ã‚¢ã‚°ãƒ©ãƒ å›³ã®UMLã«ã¯ï¼Œæ§‹é€ å›³ï¼ŒæŒ¯èˆå›³ã«åˆ†é¡ã•ã‚Œã‚‹ï¼ ï¼ˆâ€»ã¡ãªã¿ï¼ŒUMLã¯ï¼Œã‚·ã‚¹ãƒ†ãƒ è¨­è¨ˆã ã‘ã§ãªãï¼Œãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹è¨­è¨ˆã«ã‚‚ä½¿ãˆã‚‹ï¼‰ ãƒ»åˆ†æã«ç”¨ã„ã‚‰ã‚Œã‚‹UMLãƒ€ã‚¤ã‚¢ã‚°ãƒ©ãƒ  02-02. æ©Ÿèƒ½ã®è¦–ç‚¹ DFDï¼šData Flow Diagramï¼ˆãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼å›³ï¼‰ ãƒ»ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼å›³ã¨ã¯ ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹å›³ ãƒ»ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹å›³ã¨ã¯ ãƒ¦ãƒ¼ã‚¶ã®è¦æ±‚ã«å¯¾ã™ã‚‹ã‚·ã‚¹ãƒ†ãƒ ã®æŒ¯èˆã®ã“ã¨ï¼ã€ã‚·ã‚¹ãƒ†ãƒ ãŒï¼Œã€‡ã€‡ã‚’â–³â–³ã™ã‚‹ï¼ã€ã¨è€ƒãˆã‚‹ã¨ã‚ˆã„ï¼ ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹é–“ã®é–¢ä¿‚ èª¬æ˜ è£œè¶³ A > B ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹Aã®å®Ÿè¡Œä¸­ã«ã€ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹BãŒå®Ÿè¡Œã•ã‚Œã‚‹ >ã¨åŒã˜ã§ã‚ã‚‹ï¼ A > B ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹AãŒå…ˆã«å®Ÿè¡Œå®Œäº†ã—ã¦ã‹ã‚‰ã€ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹BãŒå®Ÿè¡Œã•ã‚Œã‚‹ ï¼Šä¾‹ï¼Š ã‚ªãƒ³ãƒ©ã‚¤ãƒ³ã‚·ãƒ§ãƒƒãƒ”ãƒ³ã‚°ã«ãŠã‘ã‚‹ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹ ãƒ»æ³¨æ„ç‚¹ ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹å›³ã¯ã‚·ã‚¹ãƒ†ãƒ ã®è¤‡é›‘ã•ã‚’è¡¨ç¾ã§ããªã„ãŸã‚ï¼Œè¨­è¨ˆå›³ã¨ã—ã¦ã¯å½¹ã«ç«‹ãŸãªã„ï¼ãã®ãŸã‚ï¼Œãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹å›³ã¯ï¼Œè¨­è¨ˆå›³ã¨ã—ã¦ä½œã‚‹ã®ã§ã¯ãªãï¼Œå¼•ãç¶™ãæ™‚ã«æœ€åˆã«èª¬æ˜ã™ã‚‹ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚„éã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ã®ãŸã‚ã®è³‡æ–™ã¨ã—ã¦ä½œã‚‹ã‚ˆã†ã«ã™ã‚‹ï¼è¨­è¨ˆå›³ã¨ã—ã¦ã¯ï¼Œã‚¯ãƒ©ã‚¹å›³ã‚„ã‚·ã‚¹ãƒ†ãƒ ã‚·ãƒ¼ã‚±ãƒ³ã‚¹å›³ã®æ–¹ãŒé©ã—ã¦ã„ã‚‹ï¼ ã‚¢ã‚¯ãƒ†ã‚£ãƒ“ãƒ†ã‚£å›³ ãƒ»ã‚¢ã‚¯ãƒ†ã‚£ãƒ“ãƒ†ã‚£å›³ã¨ã¯ ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ã‚„æ¥­å‹™ãƒ•ãƒ­ãƒ¼ã‚’æ‰‹ç¶šãçš„ã«è¡¨è¨˜ã™ã‚‹æ–¹æ³•ï¼ ï¼Šä¾‹ï¼Š 02-03. æŒ¯èˆã®è¦–ç‚¹ ã‚·ã‚¹ãƒ†ãƒ ã‚·ãƒ¼ã‚±ãƒ³ã‚¹å›³ ãƒ»ã‚·ã‚¹ãƒ†ãƒ ã‚·ãƒ¼ã‚±ãƒ³ã‚¹å›³ã¨ã¯ ã‚¢ã‚¯ã‚¿ãƒ¼ã‹ã‚‰ã‚¢ã‚¯ã‚¿ãƒ¼ã¸ã®æŒ¯èˆã®æµã‚Œã‚’ï¼Œæ™‚é–“è»¸ã«æ²¿ã£ã¦è¡¨è¨˜ã™ã‚‹æ–¹æ³•ï¼ã‚·ãƒ¼ã‚±ãƒ³ã‚¹å›³ã¨ã¯ç•°ãªã‚‹ï¼ã‚·ãƒ¼ã‚±ãƒ³ã‚¹å›³ã«ã¤ã„ã¦ã¯ï¼Œä»¥ä¸‹ã®ãƒªãƒ³ã‚¯ã‚’å‚è€ƒã«ã›ã‚ˆï¼ å‚è€ƒï¼šhttps://hiroki-it.github.io/tech-notebook-gitbook/public/software/software_application_backend_php_object_orientation_class.html çŠ¶æ…‹é·ç§»å›³ ãƒ»çŠ¶æ…‹é·ç§»å›³ã¨ã¯ ã€çŠ¶æ…‹ã€ã‚’ä¸¸ï¼Œã€â é·ç§»ã€ã‚’çŸ¢å°ã§è¡¨ç¾ã—ãŸåˆ†æãƒ¢ãƒ‡ãƒ«ï¼çŸ¢å°ã®æ¨ªã®èª¬æ˜ã¯ï¼Œé·ç§»ã®ãã£ã‹ã‘ã¨ãªã‚‹ã€ã‚¤ãƒ™ãƒ³ãƒˆï¼ˆå…¥åŠ›ï¼‰â ï¼ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ï¼ˆå‡ºåŠ›ï¼‰â ã€ã‚’ç¤ºã™ï¼ ãƒ»çŠ¶æ…‹é·ç§»è¡¨ã¨ã¯ çŠ¶æ…‹é·ç§»å›³ã‹ã‚‰ä½œæˆã—ãŸè¡¨ï¼çŠ¶æ…‹é·ç§»è¡¨ã‚’ä½œæˆã—ã¦ã¿ã‚‹ã¨ï¼ŒçŠ¶æ…‹é·ç§»å›³ã§ã¯ï¼Œ9ã¤ã‚ã‚‹ã‚»ãƒ«ã®ã†ã¡4ã¤ã®ã‚»ãƒ«ã—ã‹è¡¨ç¾ã§ãã¦ãŠã‚‰ãšï¼Œæ®‹ã‚Š5ã¤ã®ã‚»ãƒ«ã¯è¡¨ç¾ã•ã‚Œã¦ã„ãªã„ã“ã¨ã«æ°—ã¥ãã“ã¨ãŒã§ãã‚‹ï¼ ï¼Šä¾‹é¡Œï¼Š 12.2 ã¨ã„ã†çŠ¶æ…‹ åˆæœŸã®çŠ¶æ…‹ã‚’ã€aã€ã¨ã—ã¦ï¼Œæœ€åˆãŒæ•°å­—ãªã®ã§ï¼Œaè¡Œã®ã€bã€ã¸ç§»å‹•ï¼ ç¾åœ¨ã®çŠ¶æ…‹ã€bã€ã‹ã‚‰ï¼Œæ¬¡ã¯æ•°å­—ãªã®ã§ï¼Œbè¡Œã®ã€bã€ã¸ç§»å‹•ï¼ ç¾åœ¨ã®çŠ¶æ…‹ã€bã€ã‹ã‚‰ï¼Œæ¬¡ã¯å°æ•°ç‚¹ãªã®ã§ï¼Œbè¡Œã®ã€dã€ã¸ç§»å‹•ï¼ ç¾åœ¨ã®çŠ¶æ…‹ã€dã€ã‹ã‚‰ï¼Œæ¬¡ã¯æ•°å­—ãªã®ã§ï¼Œbè¡Œã®ã€eã€ã¸ç§»å‹•ï¼ 02-04. æ§‹é€ ã®è¦–ç‚¹ ERå›³ï¼šEntity Relation Diagram ãƒ»ERå›³ï¼šEntity Relation Diagramã¨ã¯ ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®è¨­è¨ˆã«ç”¨ã„ã‚‰ã‚Œã‚‹ãƒ€ã‚¤ã‚¢ã‚°ãƒ©ãƒ å›³ï¼ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆãŒä¿æŒã™ã‚‹ãƒ‡ãƒ¼ã‚¿ã®é–¢ä¿‚æ€§ã‚’è¡¨ã™ï¼ã€IE è¨˜æ³•ã€ã¨ã€IDEF1X è¨˜æ³•ã€ãŒä¸€èˆ¬çš„ã«ç”¨ã„ã‚‰ã‚Œã‚‹ï¼ ãƒ»Entity ã¨ Attribute ãƒ»Relation ã¨ Cardinalityï¼ˆå¤šé‡åº¦ï¼‰ ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£é–“ã®é–¢ä¿‚ã‚’è¡¨ã™ï¼ ãƒ»1ï¼š1 ãƒ»1ï¼šå¤šï¼ˆRelation ãŒæ›–æ˜§ãªçŠ¶æ…‹ï¼‰ ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆæŒ‡å‘åˆ†æãŒé€²ã‚€ã«ã¤ã‚Œï¼Œã€1ï¼š0 ä»¥ä¸Šã®é–¢ä¿‚ã€ã€1ï¼š1 ä»¥ä¸Šã®é–¢ä¿‚ã€ã®ã‚ˆã†ã«å…·ä½“åŒ–ã—ãï¼ ãƒ»1ï¼š1 ä»¥ä¸Š 03. ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆæŒ‡å‘è¨­è¨ˆ ä»¥ä¸‹ã®ãƒªãƒ³ã‚¯ã‚’å‚è€ƒã«ã›ã‚ˆï¼ https://hiroki-it.github.io/tech-notebook-gitbook/public/software/software_application_backend_php_object_orientation_class.html https://hiroki-it.github.io/tech-notebook-gitbook/public/software/software_application_backend_php_object_orientation_method_data.html 04. ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆæŒ‡å‘ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚° ä»¥ä¸‹ã®ãƒªãƒ³ã‚¯ã‚’å‚è€ƒã«ã›ã‚ˆï¼ https://hiroki-it.github.io/tech-notebook-gitbook/public/software/software_application_backend_php_object_orientation_class.html https://hiroki-it.github.io/tech-notebook-gitbook/public/software/software_application_backend_php_object_orientation_method_data.html "},"public/software/software_application_backend_php_object_orientation_class.html":{"url":"public/software/software_application_backend_php_object_orientation_class.html","title":"ğŸ“– ï¸ã‚¯ãƒ©ã‚¹","keywords":"","body":"ã‚¯ãƒ©ã‚¹ ã¯ã˜ã‚ã« æœ¬ã‚µã‚¤ãƒˆã«ã¤ãã¾ã—ã¦ï¼Œä»¥ä¸‹ã‚’ã”èªè­˜ã®ã»ã©å®œã—ããŠé¡˜ã„ã„ãŸã—ã¾ã™ï¼ https://hiroki-it.github.io/tech-notebook-gitbook/ 01. ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆæŒ‡å‘è¨­è¨ˆ ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆæŒ‡å‘è¨­è¨ˆã«ç”¨ã„ã‚‰ã‚Œã‚‹UMLãƒ€ã‚¤ã‚¢ã‚°ãƒ©ãƒ  ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆæŒ‡å‘è¨­è¨ˆã§ã®ä½œæ¥­ä¾‹ 1. ã‚¯ãƒ©ã‚¹å›³ã«ã‚ˆã‚‹è¨­è¨ˆ ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®ã€æ§‹é€ ã€ã‚’è¨­è¨ˆã™ã‚‹ãŸã‚ã«ï¼Œã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆæŒ‡å‘åˆ†æã«ã‚ˆã‚‹ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹å›³ã‚’ã‚‚ã¨ã«ã‚¯ãƒ©ã‚¹å›³ã‚’ä½œã‚‹ï¼ãŸã ã—ï¼Œã‚¯ãƒ©ã‚¹å›³ã§ã¯ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®ã€æŒ¯èˆã€ã‚’è¨­è¨ˆã§ããªã„ãŸã‚ï¼Œã‚·ãƒ¼ã‚±ãƒ³ã‚¹å›³ã«ã“ã‚Œã‚’è¨—ã™ï¼ 2. ã‚·ãƒ¼ã‚±ãƒ³ã‚¹å›³ã«ã‚ˆã‚‹è¨­è¨ˆ ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®ã€æŒ¯èˆã€ã‚’è¨­è¨ˆã™ã‚‹ãŸã‚ã«ï¼Œã‚·ãƒ¼ã‚±ãƒ³ã‚¹å›³ã‚’ä½œæˆã™ã‚‹ï¼ã‚·ã‚¹ãƒ†ãƒ ã‚·ãƒ¼ã‚±ãƒ³ã‚¹å›³ã¨ã‚·ãƒ¼ã‚±ãƒ³ã‚¹å›³ã®é•ã„ã«ã¤ã„ã¦ï¼Œä»¥ä¸‹ã‚’å‚è€ƒã«ã›ã‚ˆï¼ å‚è€ƒï¼š https://stackoverflow.com/questions/16889028/difference-between-sequence-diagram-sd-and-a-system-sequence-diagram-ssd https://en.wikipedia.org/wiki/Sequence_diagram 3. è¨­è¨ˆã®ãƒ¬ãƒ“ãƒ¥ãƒ¼ æ§‹é€ ã‚’è¨­è¨ˆã™ã‚‹ã‚¯ãƒ©ã‚¹å›³ã¨ï¼ŒæŒ¯èˆã‚’è¨­è¨ˆã™ã‚‹ã‚·ãƒ¼ã‚±ãƒ³ã‚¹å›³ã®é–“ã®æ•´åˆæ€§ã‹ã‚‰ï¼Œè¨­è¨ˆã‚’å¦¥å½“æ€§ã‚’ãƒ¬ãƒ“ãƒ¥ãƒ¼ã™ã‚‹ï¼ å‚è€ƒï¼šhttps://www.sparxsystems.jp/bin/docs/ClassAndSeq.pdf 4. ãƒ‡ã‚¶ã‚¤ãƒ³ãƒ‘ã‚¿ãƒ¼ãƒ³ã®å°å…¥ ã‚¯ãƒ©ã‚¹å›³ã«ï¼Œãƒ‡ã‚¶ã‚¤ãƒ³ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’åŸºã«ã—ãŸã‚¯ãƒ©ã‚¹ã‚’å°å…¥ã™ã‚‹ï¼ 5. ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®å°å…¥ ã‚¯ãƒ©ã‚¹å›³ã«ï¼Œãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’å°å…¥ã™ã‚‹ï¼ 02. ã‚¯ãƒ©ã‚¹å›³ã«ã‚ˆã‚‹è¨­è¨ˆ ã‚¯ãƒ©ã‚¹å›³ ãƒ»ãƒ‡ãƒ¼ã‚¿ã¨ã—ã¦ä¿æŒã™ã‚‹é–¢ä¿‚æ€§ Associationï¼ˆé–¢é€£ï¼‰ï¼ŒAggregationï¼ˆé›†ç´„ï¼‰ï¼ŒCompositionï¼ˆåˆæˆï¼‰ãŒç”¨ã„ã‚‰ã‚Œã‚‹ï¼è©³ã—ãã¯ï¼Œå¾Œè¿°ã®èª¬æ˜ã‚’å‚ç…§ã›ã‚ˆï¼ ãƒ»è¦ªå­ã®é–¢ä¿‚æ€§ Generalizationï¼ˆæ±åŒ–ï¼‰ï¼ŒRealizationï¼ˆå®Ÿç¾ï¼‰ãŒç”¨ã„ã‚‰ã‚Œã‚‹ï¼è©³ã—ãã¯ï¼Œå¾Œè¿°ã®èª¬æ˜ã‚’å‚ç…§ã›ã‚ˆï¼ ãƒ»å¼•æ•°å‹ï¼è¿”å´å€¤å‹ã¨ä½¿ç”¨ã™ã‚‹é–¢ä¿‚æ€§ Dependencyï¼ˆä¾å­˜ï¼‰ãŒç”¨ã„ã‚‰ã‚Œã‚‹ï¼è©³ã—ãã¯ï¼Œå¾Œè¿°ã®èª¬æ˜ã‚’å‚ç…§ã›ã‚ˆï¼ ã‚¯ãƒ©ã‚¹ã®å¤šé‡åº¦ ãƒ»å¤šé‡åº¦ã¨ã¯ ã‚¯ãƒ©ã‚¹é–“ãŒï¼Œä½•å€‹ã¨ä½•å€‹ã§é–¢ä¿‚ã—ã¦ã„ã‚‹ã‹ã‚’è¡¨è¨˜ã™ã‚‹æ–¹æ³•ï¼ ï¼Šä¾‹ï¼Š ç¤¾å“¡ã¯ï¼‘ã¤ã®ä¼šç¤¾ã«ã—ã‹æ‰€å±ã§ããªã„å ´åˆ ã€ä¼šç¤¾ã‚¯ãƒ©ã‚¹ã€ã‹ã‚‰è¦‹ã¦ï¼Œå¯¾ã™ã‚‹ã€ç¤¾å“¡ã‚¯ãƒ©ã‚¹ã€ã®æ•°ã¯1ã¤ã§ã‚ã‚‹ï¼é€†ã«ï¼Œã€ç¤¾å“¡ã‚¯ãƒ©ã‚¹ã€ã‹ã‚‰è¦‹ã¦ï¼Œå¯¾ã™ã‚‹ã€ä¼šç¤¾ã‚¯ãƒ©ã‚¹ã€ã®æ•°ã¯0ä»¥ä¸Šã§ã‚ã‚‹ã¨ã„ã†è¡¨è¨˜ï¼ è¡¨è¨˜ å¯¾ã™ã‚‹ã‚¯ãƒ©ã‚¹ãŒã„ãã¤ã‚ã‚‹ã‹ 1 å¿…ãš1 0.. 1 0ä»¥ä¸Š1ä»¥ä¸‹ï¼ˆã¤ã¾ã‚Šã€0ã¾ãŸã¯1ï¼‰ 0.. n 0ä»¥ä¸Šnä»¥ä¸‹ m.. n mä»¥ä¸Šnä»¥ä¸‹ * 0ä»¥ä¸Šç„¡é™å¤§ä»¥ä¸‹ï¼ˆã¤ã¾ã‚Šã€0ä»¥ä¸Šï¼‰ 0.. * 0ä»¥ä¸Šç„¡é™å¤§ä»¥ä¸‹ï¼ˆã¤ã¾ã‚Šã€0ä»¥ä¸Šï¼‰ ï¼Šä¾‹ï¼Š ã€ å–¶æ¥­éƒ¨ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ ã€‘ è¦ªã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ãªã— ã¨ã„ã†ã‚¯ãƒ©ã‚¹ã®ç¶™æ‰¿é–¢ä¿‚ãŒã‚ã£ãŸæ™‚ï¼Œã“ã‚Œã‚’æŠ½è±¡çš„ã«ã¾ã¨ã‚ã‚‹ã¨ï¼Œ ã€ éƒ¨ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£(0.. *) ã€‘ éƒ¨ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã‹ã‚‰è¦‹ã¦ï¼Œå¯¾ã™ã‚‹èª²ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã¯0å€‹ä»¥ä¸Šã§ã‚ã‚‹ï¼ èª²ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã‹ã‚‰è¦‹ã¦ï¼Œå¯¾ã™ã‚‹éƒ¨ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã¯0ã¾ãŸã¯1å€‹ã§ã‚ã‚‹ï¼ 02-02. ã‚·ãƒ¼ã‚±ãƒ³ã‚¹å›³ã«ã‚ˆã‚‹è¨­è¨ˆ ã‚·ãƒ¼ã‚±ãƒ³ã‚¹å›³ ãƒ»è¨­è¨ˆä¾‹1 5ã¤ã®ãƒ©ã‚¤ãƒ•ãƒ©ã‚¤ãƒ³ï¼ˆåº—å“¡ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆï¼Œç®¡ç†ç”»é¢ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆï¼Œæ¤œç´¢ç”»é¢ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆï¼Œå•†å“DBã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆï¼Œå•†å“è©³ç´°ç”»é¢ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆï¼‰ã‚’è¨­å®šã™ã‚‹ï¼ å„ãƒ©ã‚¤ãƒ•ãƒ©ã‚¤ãƒ³ã§å®Ÿè¡Œã•ã‚Œã‚‹å®Ÿè¡Œä»•æ§˜é–“ã®å‘½ä»¤å†…å®¹ã‚’ï¼Œãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚„è¤‡åˆãƒ•ãƒ©ã‚°ãƒ¡ãƒ³ãƒˆã§ç¤ºã™ï¼ ãƒ»è¨­è¨ˆä¾‹2 3ã¤ã®ãƒ©ã‚¤ãƒ•ãƒ©ã‚¤ãƒ³ã‚’è¨­å®šã™ã‚‹ï¼ å„ãƒ©ã‚¤ãƒ•ãƒ©ã‚¤ãƒ³ã§å®Ÿè¡Œã•ã‚Œã‚‹å®Ÿè¡Œä»•æ§˜é–“ã®å‘½ä»¤å†…å®¹ã‚’ï¼Œãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚„è¤‡åˆãƒ•ãƒ©ã‚°ãƒ¡ãƒ³ãƒˆã§ç¤ºã™ï¼ 03. ãƒ‡ãƒ¼ã‚¿ã¨ã—ã¦ä¿æŒã™ã‚‹é–¢ä¿‚æ€§ ã€Association ï¼ Aggregation ï¼ Compositionã€ã®é †ã§ï¼Œä¾å­˜æ€§ãŒä½ããªã‚‹ï¼ Associationï¼ˆé–¢é€£ï¼‰ ãƒ»Associationã¨ã¯ ã‚¯ãƒ©ã‚¹ï¼¡ãŒã‚¯ãƒ©ã‚¹ï¼¢ã‚’ãƒ‡ãƒ¼ã‚¿ã¨ã—ã¦ä¿æŒã™ã‚‹é–¢ä¿‚æ€§ã®ã“ã¨ï¼å¼•æ•°å‹ï¼è¿”å´å€¤å‹ã¨ã—ã¦ä½¿ç”¨ã™ã‚‹ã€ä¾å­˜ã€ã¨ã¯åŒºåˆ¥ã™ã‚‹ï¼ ãƒ»Associationã®ç¨®é¡ ä¿æŒã•ã‚Œã‚‹å´ã®ã‚¯ãƒ©ã‚¹ã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ãŒï¼Œãƒ‡ãƒ¼ã‚¿ã¨ã—ã¦ä¿æŒã™ã‚‹å´ã®ã‚¯ãƒ©ã‚¹ã«ã‚ˆã£ã¦ç”Ÿæˆã•ã‚Œã‚‹ã‹å¦ã‹ã«ã‚ˆã£ã¦ï¼Œã€Aggregationã€ã¾ãŸã¯ã€Compositionã€ã«åˆ†é¡ã§ãã‚‹ï¼ Aggregationï¼ˆé›†ç´„ï¼‰ ãƒ»Aggregationã¨ã¯ ä¿æŒã•ã‚Œã‚‹å´ã®ã‚¯ãƒ©ã‚¹ã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ãŒï¼Œä¿æŒã™ã‚‹å´ã®ã‚¯ãƒ©ã‚¹ã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã«ã‚ˆã£ã¦ç”Ÿæˆã•ã‚Œãšã«å¤–å´ã‹ã‚‰æ¸¡ã•ã‚Œã‚‹æ™‚ï¼Œã‚¯ãƒ©ã‚¹é–“ãŒã€Aggregationã€ã®é–¢ä¿‚ã«ã‚ã‚‹ï¼ ãƒ»ä¾‹ Userã¯UserNameã‚’ãƒ‡ãƒ¼ã‚¿ã¨ã—ã¦ä¿æŒã™ã‚‹ï¼ name = $name; } } ã¾ãŸï¼ŒUserNameã‚¯ãƒ©ã‚¹ã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã¯ï¼ŒUserã‚¯ãƒ©ã‚¹ã«ã‚ˆã£ã¦ç”Ÿæˆã•ã‚Œãšã«å¤–å´ã‹ã‚‰æ¸¡ã•ã‚Œã‚‹ï¼ãã®ãŸã‚ï¼ŒUserã‚¯ãƒ©ã‚¹ã¨UserNameã‚¯ãƒ©ã‚¹ã¯ã€Aggregationã€ã®é–¢ä¿‚ã«ã‚ã‚‹ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š tire1 = $t1; $this->tire2 = $t2; $this->tire3 = $t3; $this->tire4 = $t4; } } ã¾ãŸï¼ŒTireã‚¯ãƒ©ã‚¹ã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã¯ï¼ŒCarã‚¯ãƒ©ã‚¹ã«ã‚ˆã£ã¦ç”Ÿæˆã•ã‚Œãšã«å¤–å´ã‹ã‚‰æ¸¡ã•ã‚Œã‚‹ï¼ãã®ãŸã‚ï¼ŒCarã‚¯ãƒ©ã‚¹ã¨Tireã‚¯ãƒ©ã‚¹ã¯ã€Aggregationã€ã®é–¢ä¿‚ã«ã‚ã‚‹ï¼ Compositionï¼ˆåˆæˆï¼‰ ãƒ»Compositionã¨ã¯ ä¿æŒã•ã‚Œã‚‹å´ã®ã‚¯ãƒ©ã‚¹ã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ãŒï¼Œä¿æŒã™ã‚‹å´ã®ã‚¯ãƒ©ã‚¹ã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã«ã‚ˆã£ã¦ç”Ÿæˆã•ã‚Œã‚‹æ™‚ï¼Œã‚¯ãƒ©ã‚¹é–“ãŒã€Compositionã€ã®é–¢ä¿‚ã«ã‚ã‚‹ï¼ ãƒ»ä¾‹ ï¼Šå®Ÿè£…ä¾‹ï¼Š Userã‚¯ãƒ©ã‚¹ã¯UserNameã‚¯ãƒ©ã‚¹ã‚’ãƒ‡ãƒ¼ã‚¿ã¨ã—ã¦ä¿æŒã™ã‚‹ï¼ getName(); } } ã¾ãŸï¼ŒUserNameã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã¯ï¼ŒUserã‚¯ãƒ©ã‚¹ã«ã‚ˆã£ã¦ç”Ÿæˆã•ã‚Œã‚‹ï¼ãã®ãŸã‚ï¼ŒUserã‚¯ãƒ©ã‚¹ã¨UserNameã‚¯ãƒ©ã‚¹ã¯ã€Compositionã€ã®é–¢ä¿‚ã«ã‚ã‚‹ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š Carã‚¯ãƒ©ã‚¹ã¯Lockã‚¯ãƒ©ã‚¹ã‚’ãƒ‡ãƒ¼ã‚¿ã¨ã—ã¦ä¿æŒã™ã‚‹ï¼ lock = new Lock(); } } ã¾ãŸï¼ŒLockã‚¯ãƒ©ã‚¹ã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã¯ï¼ŒCarã‚¯ãƒ©ã‚¹ã«ã‚ˆã£ã¦ç”Ÿæˆã•ã‚Œã‚‹ï¼ãã®ãŸã‚ï¼ŒCarã‚¯ãƒ©ã‚¹ã¨Lockã‚¯ãƒ©ã‚¹ã¯ã€Compositionã€ã®é–¢ä¿‚ã«ã‚ã‚‹ï¼ 04. è¦ªå­ã®é–¢ä¿‚æ€§ Generalizationï¼ˆæ±åŒ–ï¼‰ ãƒ»æ±åŒ–ã«ãŠã‘ã‚‹Override æ±åŒ–ã®æ™‚ï¼Œå­ã‚¯ãƒ©ã‚¹ã§ãƒ¡ã‚½ãƒƒãƒ‰ã®å‡¦ç†å†…å®¹ã‚’å†ã³å®Ÿè£…ã™ã‚‹ã¨ï¼Œå‡¦ç†å†…å®¹ã¯ä¸Šæ›¸ãã•ã‚Œã‚‹ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š name = $name; $this->price = $price; } // â˜…â˜…â˜…â˜…â˜…â˜…æ³¨ç›®â˜…â˜…â˜…â˜…â˜…â˜… // å•†å“åã¨ä¾¡æ ¼ã‚’è¡¨ç¤ºã™ã‚‹ãƒ¡ã‚½ãƒƒãƒ‰ public function printPrice(): void { print($this->name.\"ã®ä¾¡æ ¼: ï¿¥\".$this->price.\"\"); } // å•†å“åã®ã‚²ãƒƒã‚¿ãƒ¼ public function getName(): string { return $this->name; } // å•†å“ä¾¡æ ¼ã®ã‚²ãƒƒã‚¿ãƒ¼ public function getPrice(): int { return $this->price; } } getPrice() * 1.08); // ï¼ˆ1ï¼‰ print($this->getName().\"ã®ç¨è¾¼ã¿ä¾¡æ ¼: ï¿¥\".$priceWithTax.\"\"); // ï¼ˆ2ï¼‰ } } ãƒ»æŠ½è±¡ã‚¯ãƒ©ã‚¹ ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ã¨ã—ã¦ç”¨ã„ã‚‹ï¼å¤šé‡ç¶™æ‰¿ã§ããªã„ï¼ ï¼Šä¾‹ï¼Š ä»¥ä¸‹ã®æ¡ä»¶ã®ç¤¾å“¡ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’å®Ÿè£…ã—ãŸã„ã¨ã™ã‚‹ï¼ åˆå‰ï¼™æ™‚ã«å‡ºç¤¾ å–¶æ¥­éƒ¨ãƒ»é–‹ç™ºéƒ¨ãƒ»ç·å‹™éƒ¨ãŒã‚ã‚Šï¼Œãã‚Œãã‚ŒãŒç•°ãªã‚‹ä»•äº‹ã‚’è¡Œã† åˆå¾Œï¼–æ™‚ã«é€€ç¤¾ ã“ã®æ™‚ï¼Œã€åƒããƒ¡ã‚½ãƒƒãƒ‰ã€ã¯éƒ¨ç½²ã”ã¨ã«ç•°ãªã£ã¦ã—ã¾ã†ãŒï¼Œã©ã†å®Ÿè£…ã—ãŸã‚‰è‰¯ã„ã®ã‹â€¦ ã“ã‚Œã‚’è§£æ±ºã™ã‚‹ãŸã‚ã«ï¼Œä¾‹ãˆã°ï¼Œæ¬¡ã®ï¼’ã¤ãŒå®Ÿè£…æ–¹æ³•ãŒè€ƒãˆã‚‰ã‚Œã‚‹ï¼ å–¶æ¥­éƒ¨ç¤¾å“¡ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆï¼Œé–‹ç™ºéƒ¨ç¤¾å“¡ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆï¼Œç·å‹™éƒ¨ç¤¾å“¡ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’åˆ¥ã€…ã«å®Ÿè£… â‡’ãƒ¡ãƒªãƒƒãƒˆï¼šåŒã˜éƒ¨ç½²ã®ä»–ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã«å½±éŸ¿ã‚’ä¸ãˆã‚‰ã‚Œã‚‹ï¼ â‡’ãƒ‡ãƒ¡ãƒªãƒƒãƒˆï¼šå„ç¤¾å“¡ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã§å…±é€šã®å‡¦ç†ã‚’å€‹åˆ¥ã«å®Ÿè£…ã—ãªã‘ã‚Œã°ãªã‚‰ãªã„ï¼å…±é€šã®å‡¦ç†ãŒåŒã˜ã‚³ãƒ¼ãƒ‰ã§æ›¸ã‹ã‚Œã‚‹ä¿è¨¼ãŒãªã„ï¼ ä¸€ã¤ã®ç¤¾å“¡ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®ä¸­ã§ï¼Œåƒããƒ¡ã‚½ãƒƒãƒ‰ã«éƒ¨ç½²ã”ã¨ã§å¤‰åŒ–ã™ã‚‹å¼•æ•°ã‚’è¨­å®š â‡’ãƒ¡ãƒªãƒƒãƒˆï¼šå…¨éƒ¨ç½²ã®ç¤¾å“¡ã‚’ä¸€ã¤ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã§å‘¼ã³å‡ºã›ã‚‹ï¼ â‡’ãƒ‡ãƒ¡ãƒªãƒƒãƒˆï¼šä¸€ã¤ã®ä¿®æ­£ãŒï¼Œå…¨éƒ¨ç½²ã®ç¤¾å“¡ã®å‡¦ç†ã«å½±éŸ¿ã‚’ä¸ãˆã¦ã—ã¾ã†ï¼ æŠ½è±¡ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã¨æŠ½è±¡ãƒ¡ã‚½ãƒƒãƒ‰ã‚’ç”¨ã„ã‚‹ã¨ï¼Œ2ã¤ã®ãƒ¡ãƒªãƒƒãƒˆã‚’ç”Ÿã‹ã—ã¤ã¤ï¼Œãƒ‡ãƒ¡ãƒªãƒƒãƒˆã‚’è§£æ¶ˆå¯èƒ½ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š self::TIME_TO_ARRIVE){ return sprintf( \"%s ã®é…åˆ»ã§ã™ï¼\", date(\"Hæ™‚iåˆ†sç§’\", $nowTime - self::TIME_TO_ARRIVE) ); } return sprintf( \"%s ã«å‡ºå‹¤ã—ã¾ã—ãŸï¼\", date(\"Hæ™‚iåˆ†sç§’\", $nowTime) ); } // å…·è±¡ãƒ¡ã‚½ãƒƒãƒ‰ï¼é€€ç¤¾æ™‚é–“ã¨æ®‹æ¥­æ™‚é–“ã‚’è¡¨ç¤ºï¼ // å­ã‚¯ãƒ©ã‚¹ã¸ãã®ã¾ã¾ç¶™æ‰¿ã•ã‚Œã‚‹ï¼å­ã‚¯ãƒ©ã‚¹ã§ã‚ªãƒ¼ãƒãƒ¼ãƒ©ã‚¤ãƒ‰ã—ãªãã¦ã‚‚è‰¯ã„ï¼ public function toLeave() { $nowTime = strtotime( date(\"H:i:s\") ); return sprintf( \"%sã«é€€ç¤¾ã—ã¾ã—ãŸï¼%s ã®æ®‹æ¥­ã§ã™ï¼\", date(\"Hæ™‚iåˆ†sç§’\", $nowTime), date(\"Hæ™‚iåˆ†sç§’\", $nowTime - self::TIME_TO_LEAVE) ); } } ï¼Šä¾‹ï¼Š ãƒ—ãƒªã‚¦ã‚¹ã¨å„ä¸–ä»£ãƒ—ãƒªã‚¦ã‚¹ãŒï¼ŒæŠ½è±¡ã‚¯ãƒ©ã‚¹ã¨å­ã‚¯ãƒ©ã‚¹ã®é–¢ä¿‚ã«ã‚ã‚‹ï¼ Realizationï¼ˆå®Ÿç¾ï¼‰ ãƒ»Realizationã¨ã¯ å®Ÿè£…ã‚¯ãƒ©ã‚¹ãŒæ­£å¸¸ã«æ©Ÿèƒ½ã™ã‚‹ãŸã‚ã«æœ€ä½é™å¿…è¦ãªãƒ¡ã‚½ãƒƒãƒ‰ã®å®Ÿè£…ã‚’å¼·åˆ¶ã™ã‚‹ï¼ã“ã‚Œã«ã‚ˆã£ã¦ï¼Œå¿…ãšå®Ÿè£…ã‚¯ãƒ©ã‚¹ã‚’æ­£å¸¸ã«åƒã‹ã›ã‚‹ã“ã¨ãŒã§ãã‚‹ï¼ ï¼Šä¾‹ï¼Š ã‚ªãƒ¼ãƒ—ãƒ³ã‚½ãƒ¼ã‚¹ã®ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã¯ï¼Œãƒ¦ãƒ¼ã‚¶ãŒå®Ÿè£…ã‚¯ãƒ©ã‚¹ã‚’è‡ªèº«ã§è¿½åŠ å®Ÿè£…ã™ã‚‹ã“ã¨ã‚‚è€ƒæ…®ã—ã¦ï¼ŒRealizationãŒç”¨ã„ã‚‰ã‚Œã¦ã„ã‚‹ï¼ ï¼Šä¾‹ï¼Š å„è»Šã¯ï¼Œãƒ¢ãƒ¼ã‚¿ãƒ¼æ©Ÿèƒ½ã‚’å¿…ãšæŒã£ã¦ã„ãªã‘ã‚Œã°ï¼Œæ­£å¸¸ã«åƒãã“ã¨ãŒã§ããªã„ï¼ãã“ã§ï¼Œãƒ¢ãƒ¼ã‚¿æ©Ÿèƒ½ã«æœ€ä½é™å¿…è¦ãªãƒ¡ã‚½ãƒƒãƒ‰ã®å®Ÿè£…ã‚’å¼·åˆ¶ã™ã‚‹ï¼ å®Ÿè£…ã‚¯ãƒ©ã‚¹ã«å‡¦ç†å†…å®¹ã‚’è¨˜è¿°ã—ãªã‘ã‚Œã°ãªã‚‰ãªã„ï¼ã™ãªã‚ã¡ï¼ŒæŠ½è±¡ã‚¯ãƒ©ã‚¹ã«ãƒ¡ã‚½ãƒƒãƒ‰ã®å‹ã®ã¿å®šç¾©ã—ãŸå ´åˆã¨åŒã˜ã§ã‚ã‚‹ï¼å¤šé‡ç¶™æ‰¿ã§ãã‚‹ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š é€šå¸¸ã‚¯ãƒ©ã‚¹ï¼ŒæŠ½è±¡ã‚¯ãƒ©ã‚¹ï¼Œã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã®é•ã„ é€šå¸¸ã‚¯ãƒ©ã‚¹ æŠ½è±¡ã‚¯ãƒ©ã‚¹ ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ å½¹å‰² å°‚ç”¨å‡¦ç†ã®éƒ¨å“åŒ– é€šå¸¸ã‚¯ãƒ©ã‚¹ã®å…±é€šå‡¦ç†ã®éƒ¨å“åŒ– ãƒ»é€šå¸¸ã‚¯ãƒ©ã‚¹ã®ã‚¯ãƒ©ã‚¹å‹ã‚’å®šç¾©ã™ã‚‹ï¼ãƒ»å®Ÿè£…ã‚¯ãƒ©ã‚¹ãŒæ­£å¸¸ã«æ©Ÿèƒ½ã™ã‚‹ãŸã‚ã«æœ€ä½é™å¿…è¦ãªãƒ¡ã‚½ãƒƒãƒ‰ã®å®Ÿè£…ã‚’å¼·åˆ¶ã™ã‚‹ï¼ å­ã‚¯ãƒ©ã‚¹ã§ã®ç¶™æ‰¿å…ˆæ•° å˜ä¸€ç¶™æ‰¿ å˜ä¸€ç¶™æ‰¿ å˜ä¸€ç¶™æ‰¿ï½œå¤šé‡ç¶™æ‰¿ ãƒ¡ãƒ³ãƒå¤‰æ•°ã®ã‚³ãƒ¼ãƒ« è‡ªèº«ã¨ç¶™æ‰¿å…ˆ ç¶™æ‰¿å…ˆã®ã¿ å®Ÿè£…å…ˆã®ã¿ å®šæ•°ã®å®šç¾© ã€‡ ã€‡ ã€‡ æŠ½è±¡ãƒ¡ã‚½ãƒƒãƒ‰ã®å®šç¾© âœ• ã€‡ ã€‡ï¼ˆabstractã¯çœç•¥ï¼‰ å…·è±¡ãƒ¡ã‚½ãƒƒãƒ‰ã®å®šç¾© ã€‡ ã€‡ âœ• construct() ã®å®šç¾© ã€‡ ã€‡ âœ• ï¼Šä¾‹ï¼Š ç¨®ã€…ã®è»Šã‚¯ãƒ©ã‚¹ã®å…±é€šå‡¦ç†ã®ã‚’æŒã¤æŠ½è±¡ã‚¯ãƒ©ã‚¹ã¨ã—ã¦ï¼ŒCarã‚¯ãƒ©ã‚¹ã‚’ä½œæˆï¼ å„è»Šã¯ï¼Œã‚¨ãƒ³ã‚¸ãƒ³æ©Ÿèƒ½ã‚’å¿…ãšæŒã£ã¦ã„ãªã‘ã‚Œã°ï¼Œæ­£å¸¸ã«åƒãã“ã¨ãŒã§ããªã„ï¼ãã“ã§ï¼ŒæŠ½è±¡ãƒ¡ã‚½ãƒƒãƒ‰ã«ã‚ˆã£ã¦ï¼Œã‚¨ãƒ³ã‚¸ãƒ³æ©Ÿèƒ½ã«æœ€ä½é™å¿…è¦ãªãƒ¡ã‚½ãƒƒãƒ‰ã®å®Ÿè£…ã‚’å¼·åˆ¶ã™ã‚‹ï¼ 04-02. ç¶™æ‰¿ ç¶™æ‰¿ã«ã‚ˆã‚‹ã‚¯ãƒ©ã‚¹ãƒã‚§ãƒ¼ãƒ³ ãƒ»ã‚¯ãƒ©ã‚¹ãƒã‚§ãƒ¼ãƒ³ã¨ã¯ ã‚¯ãƒ©ã‚¹ã‹ã‚‰ãƒ‡ãƒ¼ã‚¿ã‚„ãƒ¡ã‚½ãƒƒãƒ‰ã‚’ã‚³ãƒ¼ãƒ«ã—ãŸæ™‚ï¼Œãã®ã‚¯ãƒ©ã‚¹ã«ã“ã‚Œã‚‰ãŒå­˜åœ¨ã—ãªã‘ã‚Œã°ï¼Œç¶™æ‰¿å…ƒã¾ã§å‚ç…§ã—ã«ã„ãä»•çµ„ã¿ã‚’ã€ã‚¯ãƒ©ã‚¹ãƒã‚§ãƒ¼ãƒ³ã€ã¨ã„ã†ï¼é¡ä¼¼ã™ã‚‹ã‚‚ã®ã¨ã—ã¦ï¼Œãƒ—ãƒ­ãƒˆã‚¿ã‚¤ãƒ—ãƒã‚§ãƒ¼ãƒ³ã¯ä»¥ä¸‹ã®ãƒãƒ¼ãƒˆã‚’å‚è€ƒã«ã›ã‚ˆï¼ å‚è€ƒï¼š https://hiroki-it.github.io/tech-notebook-gitbook/public/frontend_object_orientation_prototype.html https://hiroki-it.github.io/tech-notebook-gitbook/public/frontend_object_orientation_method_data.html ï¼Šå®Ÿè£…ä¾‹ï¼Š value1; } } subValue; } } getValue(); ç¶™æ‰¿å…ƒã®é™çš„ãƒ¡ã‚½ãƒƒãƒ‰ã‚’å‚ç…§ ï¼Šå®Ÿè£…ä¾‹ï¼Š Trait ãƒ»Traitã¨ã¯ å†åˆ©ç”¨ã—ãŸã„ãƒ¡ã‚½ãƒƒãƒ‰ã‚„ãƒ‡ãƒ¼ã‚¿ã‚’éƒ¨å“åŒ–ã—ï¼Œåˆ©ç”¨ã—ãŸã„æ™‚ã«ã‚¯ãƒ©ã‚¹ã«å–ã‚Šè¾¼ã‚€ï¼Traitã‚’ç”¨ã„ã‚‹ã¨ãã¯ï¼Œã‚¯ãƒ©ã‚¹å†…ã§Traitã‚’useå®£è¨€ã™ã‚‹ï¼Traitè‡ªä½“ã¯ä¸å®Œå…¨ãªã‚¯ãƒ©ã‚¹ã§ã‚ã‚Šï¼Œã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹åŒ–ã§ããªã„ï¼ã¾ãŸï¼Œè¦ªã‚¯ãƒ©ã‚¹ã§ãƒˆãƒ¬ã‚¤ãƒˆã‚’èª­ã¿è¾¼ã‚€ã¨ï¼Œå­ã‚¯ãƒ©ã‚¹ã§ã‚‚ãƒˆãƒ¬ã‚¤ãƒˆã®æ©Ÿèƒ½ã‚’ä½¿ç”¨ã§ãã‚‹ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š foo(); // Hello World class Bar extends Foo {} $bar = new Bar(); $bar->foo(); // Hello World ãƒ»ãƒã‚¸ãƒƒã‚¯ãƒ¡ã‚½ãƒƒãƒ‰ã‚’ç¦æ­¢ã™ã‚‹Trait ãƒã‚¸ãƒƒã‚¯ãƒ¡ã‚½ãƒƒãƒ‰ã‚’ä½¿ç”¨ã™ã‚‹ã¨ï¼Œå‡¦ç†ãŒå¤šããªã‚‹ãŸã‚ï¼Œãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãŒæ‚ªããªã‚‹ï¼ãã“ã§ï¼Œå„ã‚¯ãƒ©ã‚¹ã§traitã‚’ä½¿ç”¨ã—ï¼Œãƒã‚¸ãƒƒã‚¯ãƒ¡ã‚½ãƒƒãƒ‰ã‚’ã‚³ãƒ¼ãƒ«ã—ãŸæ™‚ã«ï¼Œé–‹ç™ºè€…å‘ã‘ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã•ã›ã‚‹ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š ãƒã‚¸ãƒƒã‚¯ã‚²ãƒƒã‚¿ãƒ¼ãƒ¡ã‚½ãƒƒãƒ‰ã¨ãƒã‚¸ãƒƒã‚¯ã‚»ãƒƒã‚¿ãƒ¼ãƒ¡ã‚½ãƒƒãƒ‰ãŒã‚³ãƒ¼ãƒ«ã•ã‚Œã‚‹ã“ã¨ã‚’ç¦æ­¢ã™ã‚‹ï¼ 04-03. å§”è­² å§”è­²ã«ã‚ˆã‚‹ãƒ¡ã‚½ãƒƒãƒ‰ã‚³ãƒ¼ãƒ« ãƒ»å§”è­²ã¨ã¯ å‡¦ç†ã®ä¸€éƒ¨ã¾ãŸã¯å…¨ã¦ã‚’ä»–ã®ã‚¯ãƒ©ã‚¹ã«è¨—ã™ã“ã¨ï¼PHPã§ã¯ï¼Œé›†ç´„ã‚„åˆæˆã®é–¢ä¿‚æ€§ã‚’ä½œã‚Šï¼Œå§”è­²å…ˆã‚¯ãƒ©ã‚¹ã®ãƒ¡ã‚½ãƒƒãƒ‰ã§ã¯å§”è­²å…ƒã®ã‚³ãƒ¼ãƒ«ã—ã¦ï¼Œå‡¦ç†ã‚’è¿½åŠ å®Ÿè£…ã™ã‚‹ã“ã¨ã«ç›¸å½“ã™ã‚‹ï¼ä»–ã«ï¼Œã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã«ã‚ˆã‚‹Realizationã®é–¢ä¿‚æ€§ã§ã‚‚å®Ÿç¾ã§ãã‚‹ï¼ ãƒ»ç¶™æ‰¿ã‚ˆã‚Šã‚‚å„ªã‚ŒãŸç‚¹ å‚è€ƒï¼šhttps://qiita.com/sonatard/items/2b4b70694fd680f6297c#3-%E3%81%9D%E3%82%82%E3%81%9D%E3%82%82%E4%BD%95%E6%95%85go%E3%81%AF%E7%B6%99%E6%89%BF%E3%82%92%E5%BB%83%E6%AD%A2%E3%81%97%E3%81%A6%E5%A7%94%E8%AD%B2%E3%82%92%E6%8E%A8%E5%A5%A8%E3%81%97%E3%81%A6%E3%81%84%E3%82%8B%E3%81%AE%E3%81%8B 04-04. å¤–éƒ¨ãƒ•ã‚¡ã‚¤ãƒ«ã®èª­ã¿è¾¼ã¿ require_onceãƒ¡ã‚½ãƒƒãƒ‰ã«ã‚ˆã‚‹ï¼Œã‚¯ãƒ©ã‚¹ï¼Œéã‚¯ãƒ©ã‚¹ã®ãƒ¡ã‚½ãƒƒãƒ‰ã®èª­ã¿è¾¼ã¿ ãƒ»require_onceãƒ¡ã‚½ãƒƒãƒ‰ã¨ã¯ å¤–éƒ¨ãƒ•ã‚¡ã‚¤ãƒ«ã¨ã—ã¦å®šç¾©ã•ã‚ŒãŸï¼Œã‚¯ãƒ©ã‚¹ï¼Œéã‚¯ãƒ©ã‚¹ã®ãƒ¡ã‚½ãƒƒãƒ‰ï¼Œã‚’ä¸€åº¦ã ã‘èª­ã¿è¾¼ã‚ã‚‹ï¼å‹•çš„ãªå€¤ã¯æŒãŸãšï¼Œé™çš„ã«èª­ã¿è¾¼ã‚€ã“ã¨ã«æ³¨æ„ï¼ãŸã ã—ï¼Œãƒãƒ¼ãƒ ã®å„ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ãŒå¥½ããªç‰©ã‚’èª­ã¿è¾¼ã‚“ã§ã„ãŸã‚‰ï¼Œã‚¹ãƒ‘ã‚²ãƒƒãƒ†ã‚£ã‚³ãƒ¼ãƒ‰ã«ãªã‚Šã‹ã­ãªã„ï¼ãã“ã§ï¼Œãƒãƒ¼ãƒ ã§ã®é–‹ç™ºã§ã¯ï¼Œè¨˜è¿°ãƒ«ãƒ¼ãƒ«ã‚’è¨­ã‘ã¦ï¼Œrequire_onceãƒ¡ã‚½ãƒƒãƒ‰ã§èª­ã¿è¾¼ã‚“ã§è‰¯ã„ã‚‚ã®ã‚’æ±ºã‚ã¦ãŠãã¨è‰¯ã„ï¼ ãƒ»ã‚¯ãƒ©ã‚¹ã‹ã‚‰ãƒ¡ã‚½ãƒƒãƒ‰ã‚’ã‚³ãƒ¼ãƒ« className(); } } ãƒ»ã‚¯ãƒ©ã‚¹ã‹ã‚‰å®šæ•°ã‚’ã‚³ãƒ¼ãƒ« ãƒ»éã‚¯ãƒ©ã‚¹ã‹ã‚‰ãƒ¡ã‚½ãƒƒãƒ‰ã‚’ã‚³ãƒ¼ãƒ« useã«ã‚ˆã‚‹ã‚¯ãƒ©ã‚¹ã®èª­ã¿è¾¼ã¿ ãƒ»useã¨ã¯ PHP5.3ä»¥é™ã§ã¯ï¼Œå¤–éƒ¨ãƒ•ã‚¡ã‚¤ãƒ«ã¨ã—ã¦å®šç¾©ã•ã‚ŒãŸã‚¯ãƒ©ã‚¹ã®namespaceã‚’ï¼Œuseã§æŒ‡å®šã™ã‚‹ã“ã¨ã«ã‚ˆã£ã¦ï¼Œãã®ã‚¯ãƒ©ã‚¹ã®ã¿ã‚’èª­ã¿è¾¼ã‚ã‚‹ï¼éã‚¯ãƒ©ã‚¹ã‚’èª­ã¿è¾¼ã‚€ã“ã¨ã¯ã§ããªã„ï¼å‹•çš„ãªå€¤ã¯æŒãŸãšï¼Œé™çš„ã«èª­ã¿è¾¼ã‚€ã“ã¨ã«æ³¨æ„ï¼ãŸã ã—ï¼Œãƒãƒ¼ãƒ ã®å„ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ãŒå¥½ããªç‰©ã‚’èª­ã¿è¾¼ã‚“ã§ã„ãŸã‚‰ï¼Œã‚¹ãƒ‘ã‚²ãƒƒãƒ†ã‚£ã‚³ãƒ¼ãƒ‰ã«ãªã‚Šã‹ã­ãªã„ï¼ãã“ã§ï¼Œãƒãƒ¼ãƒ ã§ã®é–‹ç™ºã§ã¯ï¼Œè¨˜è¿°ãƒ«ãƒ¼ãƒ«ã‚’è¨­ã‘ã¦ï¼Œuseã§èª­ã¿è¾¼ã‚“ã§è‰¯ã„ã‚‚ã®ã‚’æ±ºã‚ã¦ãŠãã¨è‰¯ã„ï¼ ãƒ»å¤–éƒ¨ãƒ•ã‚¡ã‚¤ãƒ«ã®ã‚¯ãƒ©ã‚¹ã‹ã‚‰ãƒ¡ã‚½ãƒƒãƒ‰ã‚’ã‚³ãƒ¼ãƒ« ã‚¯ãƒ©ã‚¹ã®namespaceã‚’useæ–‡ã§æŒ‡å®šã™ã‚‹ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š method1(); } } ãƒ»å¤–éƒ¨ãƒ•ã‚¡ã‚¤ãƒ«ã®ã‚¯ãƒ©ã‚¹ã‹ã‚‰å®šæ•°ã‚’ã‚³ãƒ¼ãƒ« ï¼Šå®Ÿè£…ä¾‹ï¼Š 05. å¼•æ•°å‹ï¼è¿”å´å€¤å‹ã¨ã—ã¦ä½¿ç”¨ã™ã‚‹é–¢ä¿‚æ€§ ç™ºè¡¨ã‚¹ãƒ©ã‚¤ãƒ‰ Dependencyï¼ˆä¾å­˜ï¼‰ ãƒ»Dependencyã¨ã¯ ã‚¯ãƒ©ã‚¹ï¼¡ãŒã‚¯ãƒ©ã‚¹ï¼¢ã‚’å¼•æ•°å‹ï¼è¿”å´å€¤å‹ã¨ã—ã¦ä½¿ç”¨ã™ã‚‹é–¢ä¿‚æ€§ã®ã“ã¨ï¼ å‚è€ƒï¼š https://stackoverflow.com/questions/1230889/difference-between-association-and-dependency https://stackoverflow.com/questions/41765798/difference-between-aggregation-and-dependency-injection ãƒ»ä¾‹ ï¼Šå®Ÿè£…ä¾‹ï¼Š Userã¯UserNameã‚’å¼•æ•°ã¨ã—ã¦ä½¿ç”¨ã™ã‚‹ï¼Userã¯UserNameã«ä¾å­˜ã—ã¦ã„ã‚‹ï¼ getName(); } } çµåˆåº¦ ãƒ»çµåˆåº¦ã¨ã¯ ä¾å­˜ã«ã¯ï¼Œå¼•æ•°ã®æ¸¡ã—æ–¹ã«ã‚ˆã£ã¦ï¼Œç¨‹åº¦ãŒã‚ã‚‹ï¼ãã‚Œã«ã‚ˆã£ã¦ï¼Œå‡¦ç†ã‚’ï¼Œã©ã®ã‚¯ãƒ©ã‚¹ã®ãƒ‡ãƒ¼ã‚¿ã¨æ“ä½œã«æŒ¯ã‚Šåˆ†ã‘ã¦ã„ãã‹ãŒæ±ºã¾ã‚‹ï¼çµåˆåº¦ã¯ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«é–“ã®ä¾å­˜åº¦åˆã„ã«ã¤ã„ã¦ç”¨ã„ã‚‰ã‚Œã‚‹ç”¨èªã§ã‚ã‚‹ãŒï¼Œã‚ˆã‚Šç†è§£ã—ã‚„ã™ãã™ã‚‹ãŸã‚ã«ï¼Œç‰¹ã«ã‚¯ãƒ©ã‚¹ã‚’ç”¨ã„ã¦èª¬æ˜ã™ã‚‹ï¼ ãƒ»ãƒ‡ãƒ¼ã‚¿çµåˆã¨ã¯ æœ€ã‚‚ç†æƒ³çš„ãªçµåˆï¼ã‚¹ã‚«ãƒ©å‹ã®ãƒ‡ãƒ¼ã‚¿ã‚’ã‚µãƒ—ãƒ©ã‚¤ãƒ¤ãƒ¼å´ã¨ã—ã¦ï¼Œã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå´ã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã®å¼•æ•°ã¨ã—ã¦æ¸¡ã™ã‚ˆã†ãªé–¢ä¿‚ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š ModuleAã¨ModuleBã¯ï¼Œãƒ‡ãƒ¼ã‚¿çµåˆã®é–¢ä¿‚ã«ã‚ã‚‹ï¼ methodA(1, 2, \"ã§ã™.\"); // ã‚¹ã‚«ãƒ©å‹ãƒ‡ãƒ¼ã‚¿ã‚’æ¸¡ã™ã ã‘ } } ï¼Šå®Ÿè£…ä¾‹ï¼Š ãƒ‡ã‚¶ã‚¤ãƒ³ãƒ‘ã‚¿ãƒ¼ãƒ³ã®Factoryã‚¯ãƒ©ã‚¹ã§ã¯ï¼Œã‚¹ã‚«ãƒ©å‹ãƒ‡ãƒ¼ã‚¿ã®å€¤ã«å¿œã˜ã¦ï¼Œã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’ä½œã‚Šåˆ†ã‘ã‚‹ï¼Factoryã‚¯ãƒ©ã‚¹ã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã¨ï¼Œã“ã‚Œã‚’ã‚³ãƒ¼ãƒ«ã™ã‚‹ä»–ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ ã¯ï¼Œãƒ‡ãƒ¼ã‚¿çµåˆã®é–¢ä¿‚ã«ã‚ã‚‹ï¼ needsWalking()) { return $walking; } return $car; } } ãƒ»ã‚¹ã‚¿ãƒ³ãƒ—çµåˆã¨ã¯ objectå‹ã®ãƒ‡ãƒ¼ã‚¿ã‚’ã‚µãƒ—ãƒ©ã‚¤ãƒ¤ãƒ¼å´ã¨ã—ã¦ï¼Œã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå´ã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã®å¼•æ•°ã¨ã—ã¦æ¸¡ã™é–¢ä¿‚ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š ModuleAã¨ModuleBã¯ï¼Œã‚¹ã‚¿ãƒ³ãƒ—çµåˆã®é–¢ä¿‚ã«ã‚ã‚‹ï¼ value = $value; } public function getValue() { return $this->value; } } methodB($common); // 1 } } getValue(); // 1 } } å‡é›†åº¦ ãƒ»å‡é›†åº¦ã¨ã¯ å‡é›†åº¦ã¯ï¼Œã€ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«å†…ã®è²¬å‹™ã®çµ±ä¸€åº¦åˆã„ã€ã«ã¤ã„ã¦ç”¨ã„ã‚‰ã‚Œã‚‹ç”¨èªã§ã‚ã‚‹ãŒï¼Œã‚ˆã‚Šç†è§£ã—ã‚„ã™ãã™ã‚‹ãŸã‚ã«ï¼Œç‰¹ã«ã‚¯ãƒ©ã‚¹ã‚’ç”¨ã„ã¦èª¬æ˜ã™ã‚‹ï¼ ãƒ»æ©Ÿèƒ½çš„å¼·åº¦ã¨ã¯ æœ€ã‚‚ç†æƒ³çš„ãªå‡é›†ï¼ã‚¯ãƒ©ã‚¹ã®è²¬å‹™ãŒæ©Ÿèƒ½å˜ä½ã«ãªã‚‹ã‚ˆã†ã«ï¼Œãƒ­ã‚¸ãƒƒã‚¯ã‚’æŒ¯ã‚Šåˆ†ã‘ã‚‹ï¼ ä½çµåˆã¨é«˜å‡é›† å„ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã¯ï¼Œçµåˆåº¦ãŒä½ãï¼Œå‡é›†åº¦ãŒé«˜ã„ã»ã©ã‚ˆã„ï¼ä¾‹ã¨ã—ã¦ï¼Œä»¥ä¸‹ã®ç”»åƒã§ã¯ï¼Œé“å…·ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’ï¼Œã‚­ãƒƒãƒãƒ³å¼•ãå‡ºã—ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã¨ã‚¬ãƒ¬ãƒ¼ã‚¸å·¥å…·ç®±ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã«åˆ†ã‘ï¼Œå„ã‚¯ãƒ©ã‚¹ã®çµåˆåº¦ã‚’ä½ãï¼Œå‡é›†åº¦ã‚’é«˜ãã™ã‚‹ã‚ˆã†ã«å¯¾å¿œã—ã¦ã„ã‚‹ãƒ» DIï¼šDependency Injectionï¼ˆä¾å­˜ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆæ³¨å…¥ï¼‰ ãƒ»DIã¨ã¯ ã‚µãƒ—ãƒ©ã‚¤ãƒ¤ãƒ¼å´ï¼ˆä¾å­˜å¯¾è±¡ï¼‰ã®ã€ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã€ã‚’ï¼Œã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå´ã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã®å¤–éƒ¨ã‹ã‚‰ã€å¼•æ•°ã¨ã—ã¦ã€æ³¨å…¥ã™ã‚‹å®Ÿè£…æ–¹æ³•ï¼ã€ä¾å­˜æ€§æ³¨å…¥ã€ã¨è¨³ã™ã®ã¯æ··ä¹±ã‚’æ‹›ããŸã‚ï¼Œã€ä¾å­˜ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆæ³¨å…¥ã€ã¨è¨³ã™ã‚ˆã†ã«ã™ã‚‹ï¼ å‚è€ƒï¼š https://en.wikipedia.org/wiki/Dependency_injection#Types_of_dependency_injection https://little-hands.hatenablog.com/entry/2018/05/27/dependency-injection ãƒ»Constructor Injectionã¨ã¯ ãƒ¡ã‚½ãƒƒãƒ‰ã®ç‰¹ã«ï¼Œconstructãƒ¡ã‚½ãƒƒãƒ‰ ã®å¼•æ•°ã¨ã—ã¦ï¼Œã‚µãƒ—ãƒ©ã‚¤ãƒ¤ãƒ¼å´ã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’æ³¨å…¥ã™ã‚‹æ–¹æ³•ï¼ã‚µãƒ—ãƒ©ã‚¤ãƒ¤ãƒ¼å´ã‚’ãƒ‡ãƒ¼ã‚¿ã¨ã—ã¦ä¿æŒã•ã›ï¼ŒAggregationã®é–¢ä¿‚æ€§ã‚’ä½œã‚‹ã“ã¨ãŒã§ãã‚‹ï¼Constructor Injectionã®ã¿ãŒï¼Œconstructãƒ¡ã‚½ãƒƒãƒ‰ ã«ã‚ˆã£ã¦ï¼Œã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ä½œæˆã®ãŸã‚ã«ä¾å­˜é–¢ä¿‚ã®è¦ä»¶ã‚’å¼·åˆ¶ã§ãã‚‹ï¼ã¾ãŸï¼Œã‚»ãƒƒã‚¿ãƒ¼ã‚’å®Œå…¨ã«ãªãã—ãŸå ´åˆã«ï¼Œã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ç”Ÿæˆå¾Œã«ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®çŠ¶æ…‹ã‚’å¤‰æ›´ä¸å¯èƒ½ã«ãªã‚‹ï¼ãã®ãŸã‚ï¼Œãƒ“ã‚¸ãƒã‚¹ä¸Šã‚ã‚Šãˆãªã„ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’ç”Ÿæˆã§ããªããªã‚Šï¼Œã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³ã®ä¸­ã§ï¼Œã‚·ã‚¹ãƒ†ãƒ ã®å®‰å…¨æ€§ã®ãŸã‚ã«æœ€ã‚‚å„ªã‚Œã¦ã„ã‚‹ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š ä¾å­˜å¯¾è±¡ã®Supplierã‚¯ãƒ©ã‚¹ã‚’ï¼Œconstructãƒ¡ã‚½ãƒƒãƒ‰ã®å¼•æ•°ã¨ã—ã¦ï¼ŒClientã‚¯ãƒ©ã‚¹ã«æ³¨å…¥ã™ã‚‹ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š ä¾å­˜å¯¾è±¡ã®UserNameã‚¯ãƒ©ã‚¹ã‚’ï¼Œconstructãƒ¡ã‚½ãƒƒãƒ‰ã®å¼•æ•°ã¨ã—ã¦ï¼ŒUserã‚¯ãƒ©ã‚¹ã«æ³¨å…¥ã™ã‚‹ï¼ name = $name; } } ãƒ»Setter Injectionã¨ã¯ ãƒ¡ã‚½ãƒƒãƒ‰ã®ç‰¹ã«ï¼Œã‚»ãƒƒã‚¿ãƒ¼ã®å¼•æ•°ã¨ã—ã¦ï¼Œã‚µãƒ—ãƒ©ã‚¤ãƒ¤ãƒ¼å´ã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’æ³¨å…¥ã™ã‚‹æ–¹æ³•ï¼ã‚µãƒ—ãƒ©ã‚¤ãƒ¤ãƒ¼å´ã‚’ãƒ‡ãƒ¼ã‚¿ã¨ã—ã¦ä¿æŒã•ã›ï¼ŒAggregationã®é–¢ä¿‚æ€§ã‚’ä½œã‚‹ã“ã¨ãŒã§ãã‚‹ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š ä¾å­˜å¯¾è±¡ã®Supplierã‚¯ãƒ©ã‚¹ã‚’ï¼Œã‚»ãƒƒã‚¿ãƒ¼ã®å¼•æ•°ã¨ã—ã¦ï¼ŒClientã‚¯ãƒ©ã‚¹ã«æ³¨å…¥ã™ã‚‹ï¼ setSupplier($supplier) ï¼Šå®Ÿè£…ä¾‹ï¼Š ä¾å­˜å¯¾è±¡ã®UserNameã‚¯ãƒ©ã‚¹ã‚’ï¼Œã‚»ãƒƒã‚¿ãƒ¼ã®å¼•æ•°ã¨ã—ã¦ï¼ŒUserã‚¯ãƒ©ã‚¹ã«æ³¨å…¥ã™ã‚‹ï¼ name = $name; } } setUserName($name); // ã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³ ãƒ»Method Injectionã¨ã¯ ä¸Šè¨˜äºŒã¤ä»¥å¤–ã®ãƒ¡ã‚½ãƒƒãƒ‰ã®å¼•æ•°ã¨ã—ã¦ï¼Œã‚µãƒ—ãƒ©ã‚¤ãƒ¤ãƒ¼å´ã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’æ³¨å…¥ã™ã‚‹æ–¹æ³•ï¼ã‚µãƒ—ãƒ©ã‚¤ãƒ¤ãƒ¼å´ã‚’ãƒ‡ãƒ¼ã‚¿ã¨ã—ã¦ä¿æŒã›ãšï¼Œèª­ã¿è¾¼ã‚“ã§ãƒ¡ã‚½ãƒƒãƒ‰ã‚’ä½¿ç”¨ã™ã‚‹ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š ä¾å­˜å¯¾è±¡ã®UserNameã‚¯ãƒ©ã‚¹ã‚’ï¼Œãƒ¡ã‚½ãƒƒãƒ‰ã®å¼•æ•°ã¨ã—ã¦ï¼ŒUserã‚¯ãƒ©ã‚¹ã«æ³¨å…¥ã™ã‚‹ï¼ getName(); // ä½•ã‚‰ã‹ã®å‡¦ç† } } method($name); // ã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³ DI Containerï¼ˆä¾å­˜ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆæ³¨å…¥ã‚³ãƒ³ãƒ†ãƒŠï¼‰ï¼ŒService Container ãƒ»DI Containerï¼ˆä¾å­˜ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆæ³¨å…¥ã‚³ãƒ³ãƒ†ãƒŠï¼‰ï¼ŒService Containerã¨ã¯ ä¾å­˜ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆæ³¨å…¥ã®è²¬å‹™ã«ç‰¹åŒ–ã—ãŸãƒ‡ã‚¶ã‚¤ãƒ³ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’ã€Service Containerã€ã¨ã„ã†ï¼ã‚ã‚‰ã‹ã˜ã‚ã‚¯ãƒ©ã‚¹ã‚’ç™»éŒ²ï¼ˆãƒã‚¤ãƒ³ãƒ‰ï¼‰ã—ã¦ãŠãï¼Œå¿…è¦ãªæ™‚ã«ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’ç”Ÿæˆï¼ˆãƒªã‚¾ãƒ«ãƒ–ï¼‰ã—ã¦ãã‚Œã‚‹ï¼ãªãŠï¼Œ ï¼Šå®Ÿè£…ä¾‹ï¼Š Pimpleãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’ä½¿ç”¨ã—ãŸå ´åˆ ãƒ»ã‚¢ãƒ³ãƒãƒ‘ã‚¿ãƒ¼ãƒ³ã®Service Locater Pattern ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã¸ã®ã‚³ãƒ³ãƒ†ãƒŠæ¸¡ã—ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’å®Ÿè£…ã›ãšï¼Œã‚³ãƒ³ãƒ†ãƒŠè‡ªä½“ã‚’æ³¨å…¥ã—ã¦ã„ã¾ã†èª¤ã£ãŸå®Ÿè£…æ–¹æ³•ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š logger = $container[\"foo.logger\"]; $this->notification = $container[\"bar.notification\"]; } } 05-02. Dependency Inversion Principleï¼ˆä¾å­˜æ€§é€†è»¢ã®åŸå‰‡ï¼‰ DIP ãƒ»DIPã¨ã¯ ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã«ä¾å­˜ã™ã‚‹ã‚ˆã†ã«å®Ÿè£…ã™ã‚‹æ–¹æ³•ï¼ã€é€†è»¢ã€ã¨ã¯ï¼Œã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã‚’ç”¨ã„ãŸå ´åˆã«ï¼Œã‚ˆã‚Šä¸‹ä½å±¤ã®å®Ÿè£…ã‚¯ãƒ©ã‚¹ãŒä¸Šä½å±¤ã®ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ã‚¤ã‚¹ã«ä¾å­˜ã—ã¦ã„ã‚‹ã“ã¨ã‚’æŒ‡ã—ã¦è¨€ã†ï¼äºŒã¤ã®åŸå‰‡ã‹ã‚‰ãªã‚‹ï¼ ãƒ»åŸå‰‡1 ä¸Šä½ãƒ¬ã‚¤ãƒ¤ãƒ¼ã¯ä¸‹ä½ãƒ¬ã‚¤ãƒ¤ãƒ¼ã«ä¾å­˜ã—ã¦ã¯ãªã‚‰ãªã„ï¼ã©ã¡ã‚‰ã®ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚‚ã€æŠ½è±¡ã€ã«ä¾å­˜ã™ã¹ãã§ã‚ã‚‹ï¼ ãƒ»åŸå‰‡2 ã€æŠ½è±¡ã€ã¯ã€å®Ÿè£…ã€ã«ä¾å­˜ã—ã¦ã¯ãªã‚‰ãªã„ï¼ã€å®Ÿè£…ã€ãŒã€æŠ½è±¡ã€ã«ä¾å­˜ã™ã¹ãã§ã‚ã‚‹ï¼ DIPã‚’æº€ãŸã™å®Ÿè£… ãƒ»DIPã‚’æº€ãŸã•ãªã„å®Ÿè£…ã®å ´åˆï¼ˆå¾“æ¥ï¼‰ ã‚ˆã‚Šä¸Šä½ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®ã‚³ãƒ¼ãƒ«å‡¦ç†ã‚’é…ç½®ã—ï¼Œã‚ˆã‚Šä¸‹ä½ãƒ¬ã‚¤ãƒ¤ãƒ¼ã§ã‚³ãƒ¼ãƒ«ã•ã‚Œã‚‹å´ã®å®šç¾©ã‚’è¡Œã†ï¼ã“ã‚Œã«ã‚ˆã£ã¦ï¼Œä¸Šä½ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®ã‚¯ãƒ©ã‚¹ãŒï¼Œä¸‹ä½ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®ã‚¯ãƒ©ã‚¹ã«ä¾å­˜ã™ã‚‹é–¢ä¿‚æ€§ã«ãªã‚‹ï¼ ãƒ»DIPã‚’æº€ãŸã™å®Ÿè£…ã®å ´åˆ ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ï¼ˆã¾ãŸã¯æŠ½è±¡ã‚¯ãƒ©ã‚¹ï¼‰ã§æŠ½è±¡ãƒ¡ã‚½ãƒƒãƒ‰ã‚’è¨˜è¿°ã™ã‚‹ã“ã¨ã«ã‚ˆã£ã¦ï¼Œå®Ÿè£…ã‚¯ãƒ©ã‚¹ã§ã®å®Ÿè£…ãŒå¼·åˆ¶ã•ã‚Œã‚‹ï¼ã¤ã¾ã‚Šï¼Œå®Ÿè£…ã‚¯ãƒ©ã‚¹ã¯æŠ½è±¡ã‚¯ãƒ©ã‚¹ã«ä¾å­˜ã—ã¦ã„ã‚‹ï¼ã‚ˆã‚Šä¸Šä½ãƒ¬ã‚¤ãƒ¤ãƒ¼ã«ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã‚’é…ç½®ã™ã‚‹ã“ã¨ã«ã‚ˆã£ã¦ï¼Œä¸‹ä½ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®ã‚¯ãƒ©ã‚¹ãŒä¸Šä½ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®ã‚¯ãƒ©ã‚¹ã«ä¾å­˜ã—ã¦ã„ã‚‹ã‚ˆã†ãªé€†è»¢é–¢ä¿‚ã‚’ä½œã‚‹ã“ã¨ãŒã§ãã‚‹ï¼ˆåŸå‰‡ï¼’ï¼‰ï¼åŸå‰‡ï¼’ã§ã„ã†ä¾å­˜ã¯ï¼Œå¼•æ•°å‹ï¼è¿”å´å€¤å‹ã¨ã—ã¦ä½¿ç”¨ã™ã‚‹é–¢ä¿‚æ€§ã®æ–‡è„ˆã§ã„ã†ã€ä¾å­˜ã€ã§ã¯ãªã„ã“ã¨ã«æ³¨æ„ã™ã‚‹ï¼ã¾ãŸï¼Œå®Ÿè£…ã‚¯ãƒ©ã‚¹ã‚’ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã‚’ã‚¨ã‚¤ãƒªã‚¢ã‚¹ã¨ã—ã¦ã‚³ãƒ¼ãƒ«ã§ããã‚‹ã‚ˆã†ã«ã™ã‚‹ã¨ï¼Œå®Ÿè£…ã‚¯ãƒ©ã‚¹ã«ä¾å­˜ã™ã‚‹ãƒ¬ã‚¤ãƒ¤ãƒ¼ã¯ä»£ã‚ã‚Šã«ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã«ä¾å­˜ã™ã‚‹ã“ã¨ã«ãªã‚‹ï¼ã‚ˆã£ã¦ï¼Œå…¨ã¦ã®ãƒ¬ã‚¤ãƒ¤ãƒ¼ãŒã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã«ä¾å­˜ã™ã‚‹ã‚ˆã†ã«ãªã‚‹ï¼ˆåŸå‰‡ï¼‘ï¼‰ï¼ å‚è€ƒï¼šhttps://speakerdeck.com/hiroki_hasegawa/domeinqu-dong-she-ji-falseakitekutiyabian-qian-toyi-cun-xing-ni-zhuan-falseyuan-ze ãƒ»DIPã«åŸºã¥ããƒ‰ãƒ¡ã‚¤ãƒ³é§†å‹•è¨­è¨ˆã®å ´åˆ Repositoryã‚¯ãƒ©ã‚¹ã«ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã¨å®Ÿè£…ã‚¯ãƒ©ã‚¹ã‚’ç”¨æ„ã™ã‚‹ï¼ã“ã‚Œã«ã‚ˆã‚Šï¼ŒåŸå‰‡ï¼’ã‚’æº€ãŸã™ï¼ Repositoryã®ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ï¼ˆæŠ½è±¡ã‚¯ãƒ©ã‚¹ï¼‰ã‚’ï¼Œã‚ˆã‚Šä¸Šä½ã®ãƒ‰ãƒ¡ã‚¤ãƒ³å±¤ã«é…ç½®ã™ã‚‹ï¼ã¾ãŸï¼ŒRepositoryã®å®Ÿè£…ã‚¯ãƒ©ã‚¹ã‚’ï¼Œã‚ˆã‚Šä¸‹ä½ã®ã‚¤ãƒ³ãƒ•ãƒ©ã‚¹ãƒˆãƒ©ã‚¯ãƒãƒ£å±¤ã«é…ç½®ã™ã‚‹ï¼ ä¸¡æ–¹ã®ã‚¯ãƒ©ã‚¹ã«å¯¾ã—ã¦ï¼Œãƒã‚¤ãƒ³ãƒ‡ã‚£ãƒ³ã‚°ï¼ˆç´ä»˜ã‘ï¼‰ã‚’è¡Œã„ï¼Œã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ï¼ˆæŠ½è±¡ã‚¯ãƒ©ã‚¹ï¼‰ã‚’ã‚³ãƒ¼ãƒ«ã—ãŸæ™‚ã«ï¼Œå®Ÿéš›ã«ã¯å®Ÿè£…ã‚¯ãƒ©ã‚¹ãŒã‚³ãƒ¼ãƒ«ã•ã‚Œã‚‹ã‚ˆã†ã«ã™ã‚‹ï¼ ï¼’ã¨ï¼“ã«ã‚ˆã‚Šï¼Œã‚¤ãƒ³ãƒ•ãƒ©ã‚¹ãƒˆãƒ©ã‚¯ãƒãƒ£å±¤ã¨ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹å±¤ã®ä¸¡æ–¹ãŒï¼Œãƒ‰ãƒ¡ã‚¤ãƒ³å±¤ã®ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ï¼ˆæŠ½è±¡ã‚¯ãƒ©ã‚¹ï¼‰ã«ä¾å­˜ã™ã‚‹ã“ã¨ã«ãªã‚‹ï¼ã“ã‚Œã¯ï¼ŒåŸå‰‡ï¼‘ã‚’æº€ãŸã™ï¼ DIPã®ãƒ¡ãƒªãƒƒãƒˆ ãƒ»å®Ÿè£…ãƒªãƒã‚¸ãƒˆãƒªã®å·®ã—æ›¿ãˆãŒç°¡å˜ å®Ÿè£…ãƒªãƒã‚¸ãƒˆãƒªã¯ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã«ä¾å­˜ã—ï¼Œç‰¹å®šã®ãƒ¡ã‚½ãƒƒãƒ‰ã®å®Ÿè£…ãŒå¼·åˆ¶ã•ã‚Œã¦ã„ã‚‹ï¼ã“ã“ã§å®Ÿè£…ãƒªãƒã‚¸ãƒˆãƒªã‚’ç•°ãªã‚‹ã‚‚ã®ã«å·®ã—æ›¿ãˆãŸã¨ã—ã¦ã‚‚ï¼Œã‚‚ã†ä¸€æ–¹ã§ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã«ä¾å­˜ã™ã‚‹ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹ã¯ï¼Œã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã®ãƒ¡ã‚½ãƒƒãƒ‰ã®ã‚³ãƒ¼ãƒ«æ–¹æ³•ã‚’å¤‰ãˆã‚‹å¿…è¦ãŒãªã„ï¼ã¤ã¾ã‚Šï¼Œãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹å±¤ã«å½±éŸ¿ã‚’ä¸ãˆã‚‹ã“ã¨ãªãï¼Œå®Ÿè£…ãƒªãƒã‚¸ãƒˆãƒªã®ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°ã‚„æ–°ã—ã„å®Ÿè£…ãƒªãƒã‚¸ãƒˆãƒªã¸ã®ç§»è¡ŒãŒè¡Œãˆã‚‹ï¼ ãƒ»ãƒªãƒã‚¸ãƒˆãƒªãŒå¯¾è±¡ã¨ã™ã‚‹é›†ç´„ã®å˜ä½ãŒã‚ã‹ã‚Šã‚„ã™ã„ ãƒ‰ãƒ¡ã‚¤ãƒ³å±¤ã«ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ãƒªãƒã‚¸ãƒˆãƒªã‚’é…ç½®ã™ã‚‹ã¨ã™ã‚‹ï¼ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ãƒªãƒã‚¸ãƒˆãƒªã¯ï¼Œå®Ÿè£…ãƒªãƒã‚¸ãƒˆãƒªã‚ˆã‚Šã‚‚å®šç¾©ãŒç°¡æ½”ã§ã‚ã‚‹ï¼ãã®ãŸã‚ï¼Œå®Ÿè£…ãƒªãƒã‚¸ãƒˆãƒªã§ã¯ãªãã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ãƒªãƒã‚¸ãƒˆãƒªã‚’ç¢ºèªã™ã‚‹ã“ã¨ã§ï¼Œãã®ãƒªãƒã‚¸ãƒˆãƒªãŒã©ã®é›†ç´„ã«å¯¾ã—ã¦CRUDå‡¦ç†ã‚’è¡Œã†ã®ã‹ã‚’èªè­˜ã—ã‚„ã™ã„ï¼ "},"public/software/software_application_backend_php_object_orientation_method_data.html":{"url":"public/software/software_application_backend_php_object_orientation_method_data.html","title":"ğŸ“– ï¸ãƒ¡ã‚½ãƒƒãƒ‰ï¼ãƒ‡ãƒ¼ã‚¿","keywords":"","body":"ãƒ¡ã‚½ãƒƒãƒ‰ï¼ãƒ‡ãƒ¼ã‚¿ ã¯ã˜ã‚ã« æœ¬ã‚µã‚¤ãƒˆã«ã¤ãã¾ã—ã¦ï¼Œä»¥ä¸‹ã‚’ã”èªè­˜ã®ã»ã©å®œã—ããŠé¡˜ã„ã„ãŸã—ã¾ã™ï¼ å‚è€ƒï¼šhttps://hiroki-it.github.io/tech-notebook-gitbook/ 01. ãƒ¡ã‚½ãƒƒãƒ‰ï¼ãƒ‡ãƒ¼ã‚¿ï¼ˆãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ï¼‰ æœ¬è³‡æ–™ã®ä»¥é™ã§ã¯ï¼Œå¤§ããï¼Œæ“ä½œï¼ˆãƒ¡ã‚½ãƒƒãƒ‰ï¼‰ã¨ãƒ‡ãƒ¼ã‚¿ï¼ˆãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ï¼‰ã«åˆ†ã‘ã¦ï¼Œèª¬æ˜ã—ã¦ã„ãï¼ ãƒ¡ã‚½ãƒƒãƒ‰ ãƒ»ãƒ¡ã‚½ãƒƒãƒ‰ã¨ã¯ ã‚¯ãƒ©ã‚¹ã¯ï¼Œãƒ‡ãƒ¼ã‚¿ã‚’æ“ä½œã™ã‚‹ï¼ã“ã®æ“ä½œã™ã‚‹ãŸã‚ã®å‡¦ç†ã‚’ãƒ¡ã‚½ãƒƒãƒ‰ã¨ã„ã†ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š data; } } ãƒ‡ãƒ¼ã‚¿ï¼ˆãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ï¼‰ ãƒ» ãƒ‡ãƒ¼ã‚¿ï¼ˆãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ï¼‰ã¨ã¯ ã‚¯ãƒ©ã‚¹ã¯ï¼Œãƒ‡ãƒ¼ã‚¿ã‚’æŒã¤ï¼ã“ã®ãƒ‡ãƒ¼ã‚¿ã¯ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã¨ã‚‚å‘¼ã°ã‚Œã‚‹ï¼æœ¬ãƒãƒ¼ãƒˆã§ã¯ï¼Œãƒ‡ãƒ¼ã‚¿ã§ã‚ã‚‹ã“ã¨ã‚’æ„è­˜ã™ã‚‹ãŸã‚ã«ï¼Œãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã¨ã„ã†è¨€è‘‰ã‚’ä½¿ã‚ãªã„ã‚‚ã®ã¨ã™ã‚‹ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š data; } } 02. ãƒ¡ã‚½ãƒƒãƒ‰ã¨ãƒ‡ãƒ¼ã‚¿ã®ã‚«ãƒ—ã‚»ãƒ«åŒ– public ãƒ»publicã¨ã¯ ã©ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã§ã‚‚å‘¼ã³å‡ºã›ã‚‹ï¼ ãƒ»ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆæŒ‡å‘ã®å ´åˆ ï¼Šå®Ÿè£…ä¾‹ï¼Š data = $data; } public function data() { return $this->data; } } ãƒ»ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆæŒ‡å‘ã§ãªã„å ´åˆ ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®å…¨ã¦ã®ãƒ‡ãƒ¼ã‚¿ãŒpublicã§ã‚ã‚‹ãªã‚‰ï¼Œã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆæŒ‡å‘ã«ãŠã‘ã‚‹éš è”½ã®ãƒ¡ãƒªãƒƒãƒˆã¯ï¼Œç‰¹ã«ãªã„ã‹ã‚‚ã—ã‚Œãªã„ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š protected ãƒ»protectedã¨ã¯ åŒã˜ã‚¯ãƒ©ã‚¹å†…ã¨ï¼Œãã®å­ã‚¯ãƒ©ã‚¹ï¼Œãã®è¦ªã‚¯ãƒ©ã‚¹ã§ã®ã¿å‘¼ã³å‡ºã›ã‚‹ï¼ https://qiita.com/miyapei/items/6c43e8b38317afb5fdce ãƒ»ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆæŒ‡å‘ã®å ´åˆ è¦ªã‚¯ãƒ©ã‚¹æ¬¡ç¬¬ã§ã¯ã‚ã‚‹ãŒï¼Œå‡¦ç†ã«ãŠã„ã¦ï¼Œ$dataã®ä¸­èº«ã‚’éš è”½ã§ãã‚‹ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š data = $data; } public function foo() { // dataã¯è¦ªã§å®šç¾©ã•ã‚Œã¦ã„ã‚‹ return $this->data; } } ãƒ»ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆæŒ‡å‘ã§ãªã„å ´åˆ å‡¦ç†ã«ãŠã„ã¦ï¼Œ$dataã®ä¸­èº«ã‚’éš è”½ã§ããªã„ãŸã‚ï¼Œå±é™ºã§ã‚ã‚‹ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š private ãƒ»privateã¨ã¯ åŒã˜ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆå†…ã§ã®ã¿å‘¼ã³å‡ºã›ã‚‹ï¼ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆæŒ‡å‘ã®ãƒ¡ãƒªãƒƒãƒˆã‚’æœ€å¤§é™ã«å¾—ã‚‰ã‚Œã‚‹æ©Ÿèƒ½ã§ã‚ã‚‹ï¼ ãƒ»ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆæŒ‡å‘ã®å ´åˆ å‡¦ç†ã«ãŠã„ã¦ï¼Œ$dataã®ä¸­èº«ã‚’éš è”½ã§ãã‚‹ï¼ã‚«ãƒ—ã‚»ãƒ«åŒ–ã‚’å‚ç…§ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š data = $data; } public function foo() { return $this->data.$this->Desu(); } // ã‚¯ãƒ©ã‚¹å†…ã‹ã‚‰ã—ã‹ã‚¢ã‚¯ã‚»ã‚¹ã§ããªã„ private function Desu() { return \"ã§ã™ï¼\"; } } ãƒ»ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆæŒ‡å‘ã§ãªã„å ´åˆ å‡¦ç†ã«ãŠã„ã¦ï¼Œ$dataã®ä¸­èº«ã‚’éš è”½ã§ããªã„ãŸã‚ï¼Œå±é™ºã§ã‚ã‚‹ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š ãƒ»Encapsulationï¼ˆã‚«ãƒ—ã‚»ãƒ«åŒ–ï¼‰ ã‚«ãƒ—ã‚»ãƒ«åŒ–ã¨ã¯ï¼Œã‚·ã‚¹ãƒ†ãƒ ã®å®Ÿè£…æ–¹æ³•ã‚’å¤–éƒ¨ã‹ã‚‰éš ã™ã“ã¨ï¼ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆå†…ã®ãƒ‡ãƒ¼ã‚¿ã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ã«ã¯ï¼Œç›´æ¥ãƒ‡ãƒ¼ã‚¿ã‚’æ‰±ã†äº‹ã¯ã§ããšï¼Œã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆå†…ã®ãƒ¡ã‚½ãƒƒãƒ‰ã‚’ã‚³ãƒ¼ãƒ«ã—ï¼Œã‚¢ã‚¯ã‚»ã‚¹ã—ãªã‘ã‚Œã°ãªã‚‰ãªã„ï¼ static ãƒ»staticã¨ã¯ åˆ¥ãƒ•ã‚¡ã‚¤ãƒ«ã§ã®ãƒ¡ã‚½ãƒƒãƒ‰ã®å‘¼ã³å‡ºã—ã«ã¯ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹åŒ–ãŒå¿…è¦ã§ã‚ã‚‹ï¼ã—ã‹ã—ï¼Œstaticä¿®é£¾å­ã‚’ã¤ã‘ã‚‹ã“ã¨ã§ï¼Œã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹åŒ–ã—ãªãã¨ã‚‚ã‚³ãƒ¼ãƒ«ã§ãã‚‹ï¼ãƒ‡ãƒ¼ã‚¿å€¤ã¯ç”¨ã„ãšï¼ˆé™çš„ï¼‰ï¼Œå¼•æ•°ã®å€¤ã®ã¿ã‚’ç”¨ã„ã¦å‡¦ç†ã‚’è¡Œã†ãƒ¡ã‚½ãƒƒãƒ‰ã«å¯¾ã—ã¦ç”¨ã„ã‚‹ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š fooFee); } } ãƒ»self:: // ã“ã“ã«å®Ÿè£…ä¾‹ ãƒ»static:: // ã“ã“ã«å®Ÿè£…ä¾‹ 02-02. ãƒ¡ã‚½ãƒƒãƒ‰ ã¾ãšèª­ã‚€ã¹ãè¨˜äº‹ ãƒ»ã‚²ãƒƒã‚¿ãƒ¼ã¨ã‚»ãƒƒã‚¿ãƒ¼ã‚’ãƒ¡ã‚½ãƒƒãƒ‰åã®ãƒ—ãƒ¬ãƒ•ã‚£ãƒƒã‚¯ã‚¹ã¨ã™ã‚‹ã“ã¨ã¯æ‚ª å’Œè¨³ï¼šhttps://www.kaitoy.xyz/2015/07/22/getters-setters-evil/ åŸå…¸ï¼šhttps://www.yegor256.com/2014/09/16/getters-and-setters-are-evil.html ãƒ»ã‚»ãƒƒã‚¿ãƒ¼ã«ã‚ˆã‚‹ä¾å­˜æ€§æ³¨å…¥ã¯æ‚ª åŸå…¸ï¼šhttps://www.yegor256.com/2014/10/03/di-containers-are-evil.html å€¤ã‚’å–å¾—ã™ã‚‹ã‚¢ã‚¯ã‚»ã‚µãƒ¡ã‚½ãƒƒãƒ‰ã®å®Ÿè£… ãƒ»Getter Getterã§ã¯ï¼Œãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ã™ã‚‹ã ã‘ã§ã¯ãªãï¼Œä½•ã‹ã—ã‚‰ã®å‡¦ç†ã‚’åŠ ãˆãŸã†ãˆã§å–å¾—ã™ã‚‹ã“ã¨ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š property)){ throw new ErrorException(\"ãƒ‡ãƒ¼ã‚¿ã«å€¤ãŒã‚»ãƒƒãƒˆã•ã‚Œã¦ã„ã¾ã›ã‚“ï¼\"); } return $this->property; } } å€¤ã‚’è¨­å®šã™ã‚‹ã‚¢ã‚¯ã‚»ã‚µãƒ¡ã‚½ãƒƒãƒ‰ã®å®Ÿè£… ãƒ»Setter ã€Mutableã€ãªã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’å®Ÿç¾ã§ãã‚‹ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š property01 = $property01; } } ãƒ»ãƒã‚¸ãƒƒã‚¯ãƒ¡ã‚½ãƒƒãƒ‰ã®__constructãƒ¡ã‚½ãƒƒãƒ‰ ãƒã‚¸ãƒƒã‚¯ãƒ¡ã‚½ãƒƒãƒ‰ã®__constructãƒ¡ã‚½ãƒƒãƒ‰ã‚’æŒãŸã›ã‚‹ã“ã¨ã§ï¼Œã“ã®ãƒ‡ãƒ¼ã‚¿ã‚’æŒã£ã¦ã„ãªã‘ã‚Œã°ãªã‚‰ãªã„ã¨ã„åˆ¶ç´„ã‚’æ˜ç¤ºã™ã‚‹ã“ã¨ãŒã§ã§ãã‚‹ï¼Setterã‚’æŒãŸã›ãšã«ï¼Œ__constructãƒ¡ã‚½ãƒƒãƒ‰ã ã‘ã‚’æŒãŸã›ã‚Œã°ï¼ŒValueObjectã®ã‚ˆã†ãªï¼Œã€Immutableã€ãªã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’å®Ÿç¾ã§ãã‚‹ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š property02 = $property02; } } ãƒ»ã€Mutableã€ã¨ã€Immutableã€ã‚’å®Ÿç¾ã§ãã‚‹ç†ç”± Test01ã‚¯ãƒ©ã‚¹ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã®$property01ã«å€¤ã‚’è¨­å®šã™ã‚‹ãŸã‚ã«ã¯ï¼Œã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‹ã‚‰Setterã‚’ã‚³ãƒ¼ãƒ«ã™ã‚‹ï¼Setterã¯ä½•åº¦ã§ã‚‚å‘¼ã³å‡ºã›ï¼Œãã®åº¦ã«ãƒ‡ãƒ¼ã‚¿ã®å€¤ã‚’ä¸Šæ›¸ãã§ãã‚‹ï¼ setProperty01(\"ãƒ‡ãƒ¼ã‚¿01ã®å€¤\"); $test01->setProperty01(\"æ–°ã—ã„ãƒ‡ãƒ¼ã‚¿01ã®å€¤\"); ä¸€æ–¹ã§ï¼ŒTest02ã‚¯ãƒ©ã‚¹ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã®$property02ã«å€¤ã‚’è¨­å®šã™ã‚‹ãŸã‚ã«ã¯ï¼Œã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’ä½œã‚Šç›´ã•ãªã‘ã‚Œã°ãªã‚‰ãªã„ï¼ã¤ã¾ã‚Šï¼Œä»¥å‰ã«ä½œã£ãŸã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã®$property02ã®å€¤ã¯ä¸Šæ›¸ãã§ããªã„ï¼Setterã‚’æŒãŸã›ãšã«ï¼Œ__constructãƒ¡ã‚½ãƒƒãƒ‰ã ã‘ã‚’æŒãŸã›ã‚Œã°ï¼Œã€Immutableã€ãªã‚¯ãƒ©ã‚¹ã¨ãªã‚‹ï¼ Entityã¯ï¼ŒMutableã§ã‚ã‚‹ãŸã‚ï¼ŒSetterã¨__constructãƒ¡ã‚½ãƒƒãƒ‰ã®ä¸¡æ–¹ã‚’æŒã¦ã‚‹ï¼ValueObjectã¯ï¼ŒImmutableã®ãŸã‚ï¼Œ__constructãƒ¡ã‚½ãƒƒãƒ‰ã—ã‹æŒã¤ã“ã¨ãŒã§ããªã„ï¼ ãƒã‚¸ãƒƒã‚¯ãƒ¡ã‚½ãƒƒãƒ‰ï¼ˆGetterç³»ï¼‰ ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã«å¯¾ã—ã¦ç‰¹å®šã®æ“ä½œãŒè¡Œã‚ã‚ŒãŸæ™‚ã«è‡ªå‹•çš„ã«ã‚³ãƒ¼ãƒ«ã•ã‚Œã‚‹ç‰¹æ®Šãªãƒ¡ã‚½ãƒƒãƒ‰ã®ã“ã¨ï¼è‡ªå‹•çš„ã«å‘¼ã³å‡ºã•ã‚Œã‚‹ä»•çµ„ã¿ã¯è¬ï¼å…±é€šã®å‡¦ç†ã‚’è¡Œã†Getterï¼ˆä¾‹ãˆã°ï¼Œå€¤ã‚’å–å¾—ã™ã‚‹ã ã‘ã®Getterãªã©ï¼‰ã‚’ç„¡é—‡ã«å¢—ã‚„ã—ãŸããªã„å ´åˆã«ç”¨ã„ã‚‹ã“ã¨ã§ï¼Œã‚³ãƒ¼ãƒ‰é‡ã®è‚¥å¤§åŒ–ã‚’é˜²ã’ã‚‹ï¼PHPã«ã¯æœ€åˆã‹ã‚‰ãƒã‚¸ãƒƒã‚¯ãƒ¡ã‚½ãƒƒãƒ‰ã¯çµ„ã¿è¾¼ã¾ã‚Œã¦ã„ã‚‹ãŒï¼Œè‡ªèº«ã§å®Ÿè£…ã—ãŸå ´åˆï¼Œã‚ªãƒ¼ãƒãƒ¼ãƒ©ã‚¤ãƒ‰ã•ã‚Œã¦ã‚³ãƒ¼ãƒ«ã•ã‚Œã‚‹ï¼ ãƒ»__getãƒ¡ã‚½ãƒƒãƒ‰ å®šç¾©ã•ã‚Œã¦ã„ãªã„ãƒ‡ãƒ¼ã‚¿ã‚„ï¼Œã‚¢ã‚¯ã‚»ã‚¹æ¨©ã®ãªã„ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ã—ã‚ˆã†ã¨ã—ãŸæ™‚ã«ï¼Œä»£ã‚ã‚Šã«å‘¼ã³å‡ºã•ã‚Œã‚‹ï¼ãƒ¡ã‚½ãƒƒãƒ‰ã¯å®šç¾©ã—ã¦ã„ã‚‹ãŒï¼Œãƒ‡ãƒ¼ã‚¿ã¯å®šç¾©ã—ã¦ã„ãªã„ã‚ˆã†ãªçŠ¶æ³ã§ç”¨ã„ã‚‹ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š hoge; // çµæœ // hogeãƒ‡ãƒ¼ã‚¿ã¯å­˜åœ¨ã—ãªã„ãŸã‚ï¼Œå€¤ã‚’å‘¼ã³å‡ºã›ã¾ã›ã‚“ï¼ ãƒ»__callãƒ¡ã‚½ãƒƒãƒ‰ å®šç¾©ã•ã‚Œã¦ã„ãªã„ãƒ¡ã‚½ãƒƒãƒ‰ã‚„ï¼Œã‚¢ã‚¯ã‚»ã‚¹æ¨©ã®ãªã„ãƒ¡ã‚½ãƒƒãƒ‰ã‚’å–å¾—ã—ã‚ˆã†ã¨ã—ãŸæ™‚ã«ï¼Œä»£ã‚ã‚Šã«ã‚³ãƒ¼ãƒ«ã•ã‚Œã‚‹ï¼ãƒ‡ãƒ¼ã‚¿ã¯å®šç¾©ã—ã¦ã„ã‚‹ãŒï¼Œãƒ¡ã‚½ãƒƒãƒ‰ã¯å®šç¾©ã—ã¦ã„ãªã„ã‚ˆã†ãªçŠ¶æ³ã§ç”¨ã„ã‚‹ï¼ ãƒ»__callStaticãƒ¡ã‚½ãƒƒãƒ‰ ãƒã‚¸ãƒƒã‚¯ãƒ¡ã‚½ãƒƒãƒ‰ï¼ˆSetterç³»ï¼‰ å®šç¾©ã•ã‚Œã¦ã„ãªã„é™çš„ãƒ¡ã‚½ãƒƒãƒ‰ã‚„ï¼Œã‚¢ã‚¯ã‚»ã‚¹æ¨©ã®ãªã„é™çš„ãƒ¡ã‚½ãƒƒãƒ‰ã‚’å–å¾—ã—ã‚ˆã†ã¨ã—ãŸæ™‚ã«ï¼Œä»£ã‚ã‚Šã«å‘¼ã³å‡ºã•ã‚Œã‚‹ï¼è‡ªå‹•çš„ã«ã‚³ãƒ¼ãƒ«ã•ã‚Œã‚‹ä»•çµ„ã¿ã¯è¬ï¼å…±é€šã®å‡¦ç†ã‚’è¡Œã†Setterï¼ˆä¾‹ãˆã°ï¼Œå€¤ã‚’è¨­å®šã™ã‚‹ã ã‘ã®Setterãªã©ï¼‰ã‚’ç„¡é—‡ã«å¢—ã‚„ã—ãŸããªã„å ´åˆã«ç”¨ã„ã‚‹ã“ã¨ã§ï¼Œã‚³ãƒ¼ãƒ‰é‡ã®è‚¥å¤§åŒ–ã‚’é˜²ã’ã‚‹ï¼PHPã«ã¯æœ€åˆã‹ã‚‰ãƒã‚¸ãƒƒã‚¯ãƒ¡ã‚½ãƒƒãƒ‰ã¯çµ„ã¿è¾¼ã¾ã‚Œã¦ã„ã‚‹ãŒï¼Œè‡ªèº«ã§å®Ÿè£…ã—ãŸå ´åˆï¼Œã‚ªãƒ¼ãƒãƒ¼ãƒ©ã‚¤ãƒ‰ã•ã‚Œã¦å‘¼ã³å‡ºã•ã‚Œã‚‹ï¼ ãƒ»__setãƒ¡ã‚½ãƒƒãƒ‰ å®šç¾©ã•ã‚Œã¦ã„ãªã„ãƒ‡ãƒ¼ã‚¿ã‚„ï¼Œã‚¢ã‚¯ã‚»ã‚¹æ¨©ã®ãªã„ãƒ‡ãƒ¼ã‚¿ã«å€¤ã‚’è¨­å®šã—ã‚ˆã†ã¨ã—ãŸæ™‚ã«ï¼Œä»£ã‚ã‚Šã«ã‚³ãƒ¼ãƒ«ã•ã‚Œã‚‹ï¼ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®ä¸å¤‰æ€§ã‚’å®Ÿç¾ã™ã‚‹ãŸã‚ã«ä½¿ç”¨ã•ã‚Œã‚‹ï¼ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®ä¸å¤‰æ€§ã¯ï¼Œä»¥ä¸‹ã®ãƒãƒ¼ãƒˆã‚’å‚è€ƒã«ã›ã‚ˆï¼ å‚è€ƒï¼šhttps://hiroki-it.github.io/tech-notebook-gitbook/public/software/software_application_architecture_backend_domain_driven_design.html ï¼Šå®Ÿè£…ä¾‹ï¼Š class Foo { // ä¸­èº«ã¯çœç•¥ } // å­˜åœ¨ã—ãªã„ãƒ‡ãƒ¼ã‚¿ã«å€¤ã‚’ã‚»ãƒƒãƒˆï¼ $foo = new Foo(); $foo->hoge = \"HOGE\"; // çµæœ // hogeãƒ‡ãƒ¼ã‚¿ã¯å­˜åœ¨ã—ãªã„ãŸã‚ï¼ŒHOGEã‚’è¨­å®šã§ãã¾ã›ã‚“ï¼ ãƒ»ãƒã‚¸ãƒƒã‚¯ãƒ¡ã‚½ãƒƒãƒ‰ã®__constructãƒ¡ã‚½ãƒƒãƒ‰ ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹åŒ–æ™‚ã«è‡ªå‹•çš„ã«å‘¼ã³å‡ºã•ã‚Œã‚‹ãƒ¡ã‚½ãƒƒãƒ‰ï¼ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹åŒ–æ™‚ã«å®Ÿè¡Œã—ãŸã„å‡¦ç†ã‚’è¨˜è¿°ã§ãã‚‹ï¼Setterã‚’æŒãŸã›ãšã«ï¼Œ__constructãƒ¡ã‚½ãƒƒãƒ‰ã§ã®ã¿å€¤ã®è¨­å®šã‚’è¡Œãˆã°ï¼ŒValueObjectã®ã‚ˆã†ãªï¼Œã€Immutableã€ãªã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’å®Ÿç¾ã§ãã‚‹ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š property02 = $property02; } } ãƒ»ã€Mutableã€ã¨ã€Immutableã€ã‚’å®Ÿç¾ã§ãã‚‹ç†ç”±ã€‘ Test01ã‚¯ãƒ©ã‚¹ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã®$property01ã«å€¤ã‚’è¨­å®šã™ã‚‹ãŸã‚ã«ã¯ï¼Œã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‹ã‚‰Setterã‚’ã‚³ãƒ¼ãƒ«ã™ã‚‹ï¼Setterã¯ä½•åº¦ã§ã‚‚ã‚³ãƒ¼ãƒ«ã§ãï¼Œãã®åº¦ã«ãƒ‡ãƒ¼ã‚¿ã®å€¤ã‚’ä¸Šæ›¸ãã§ãã‚‹ï¼ setProperty01(\"ãƒ‡ãƒ¼ã‚¿01ã®å€¤\"); $test01->setProperty01(\"æ–°ã—ã„ãƒ‡ãƒ¼ã‚¿01ã®å€¤\"); ä¸€æ–¹ã§ï¼ŒTest02ã‚¯ãƒ©ã‚¹ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã®$property02ã«å€¤ã‚’è¨­å®šã™ã‚‹ãŸã‚ã«ã¯ï¼Œã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’ä½œã‚Šç›´ã•ãªã‘ã‚Œã°ãªã‚‰ãªã„ï¼ã¤ã¾ã‚Šï¼Œä»¥å‰ã«ä½œã£ãŸã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã®$property02ã®å€¤ã¯ä¸Šæ›¸ãã§ããªã„ï¼Setterã‚’æŒãŸã›ãšã«ï¼Œ__constructãƒ¡ã‚½ãƒƒãƒ‰ã ã‘ã‚’æŒãŸã›ã‚Œã°ï¼Œã€Immutableã€ãªã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã¨ãªã‚‹ï¼ ãƒã‚¸ãƒƒã‚¯ãƒ¡ã‚½ãƒƒãƒ‰ï¼ˆãã®ä»–ï¼‰ ãƒ»__invokeãƒ¡ã‚½ãƒƒãƒ‰ å®šç¾©ã•ã‚ŒãŸã‚¯ãƒ©ã‚¹ã‚’ï¼Œé–¢æ•°ã®ã‚ˆã†ã«æ‰±ã†ã“ã¨ãŒã§ãã‚‹ï¼__invokeãƒ¡ã‚½ãƒƒãƒ‰è‡ªä½“ã¯ç„¡åé–¢æ•°ã¨ã—ã¦æ‰±ã‚ã‚Œã‚‹ï¼ 1 // [1] => 2 // [2] => 3 // ) ãƒ»__cloneãƒ¡ã‚½ãƒƒãƒ‰ // ã“ã“ã«å®Ÿè£…ä¾‹ ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã®ç”Ÿæˆãƒ¡ã‚½ãƒƒãƒ‰ ãƒ»staticãƒ¡ã‚½ãƒƒãƒ‰ ã¨ selfãƒ¡ã‚½ãƒƒãƒ‰ã®é•ã„ ã©ã¡ã‚‰ã‚‚ï¼Œnewæ¼”ç®—å­ã¨çµ„ã¿åˆã‚ã›ã¦ï¼Œè‡ªèº«ã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’è¿”å´ã™ã‚‹ãƒ¡ã‚½ãƒƒãƒ‰ã§ã‚ã‚‹ãŒï¼Œç”Ÿæˆã®å¯¾è±¡ã«ãªã‚‹ã‚¯ãƒ©ã‚¹ãŒç•°ãªã‚‹ï¼ ä»¥ä¸‹ã®é€šã‚Šï¼Œselfãƒ¡ã‚½ãƒƒãƒ‰ã¯å®šç¾©ã•ã‚ŒãŸã‚¯ãƒ©ã‚¹ã‚’ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹åŒ–ã™ã‚‹ï¼ä¸€æ–¹ã§ï¼Œstaticãƒ¡ã‚½ãƒƒãƒ‰ã¯ã‚³ãƒ¼ãƒ«ã•ã‚ŒãŸã‚¯ãƒ©ã‚¹ã‚’ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹åŒ–ã™ã‚‹ï¼è‡ªèº«ã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹åŒ–å‡¦ç†ãŒç¶™æ‰¿ã•ã‚Œã‚‹å ´åˆã¯ï¼Œstaticãƒ¡ã‚½ãƒƒãƒ‰ã‚’ç”¨ã„ãŸæ–¹ãŒè‰¯ã„ï¼ ãƒ¡ã‚½ãƒƒãƒ‰ã®ã‚³ãƒ¼ãƒ« ãƒ»ãƒ¡ã‚½ãƒƒãƒ‰ãƒã‚§ãƒ¼ãƒ³ ä»¥ä¸‹ã®ã‚ˆã†ãªï¼Œã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆAã‚’æœ€å¤–å±¤ã¨ã—ãŸé–¢ä¿‚ãŒå­˜åœ¨ã—ã¦ã„ã‚‹ã¨ã™ã‚‹ï¼ ã€ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆAï¼ˆã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆBã‚’ãƒ‡ãƒ¼ã‚¿ã«æŒã¤ï¼‰ã€‘ objB; } } ã€ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆBï¼ˆã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆCã‚’ãƒ‡ãƒ¼ã‚¿ã«æŒã¤ï¼‰ã€‘ objC; } } ã€ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆCï¼ˆã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆDã‚’ãƒ‡ãƒ¼ã‚¿ã«æŒã¤ï¼‰ã€‘ objD; } } ä»¥ä¸‹ã®ã‚ˆã†ã«ï¼Œè¿”å´å€¤ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’ç”¨ã„ã¦ï¼Œã‚ˆã‚Šæ·±ã„å±¤ã«é€£ç¶šã—ã¦ã‚¢ã‚¯ã‚»ã‚¹ã—ã¦ã„ãå ´åˆâ€¦ objB(); $ObjC = $ObjB->objB(); $ObjD = $ObjC->objD(); ä»¥ä¸‹ã®ã‚ˆã†ã«ï¼Œãƒ¡ã‚½ãƒƒãƒ‰ãƒã‚§ãƒ¼ãƒ³ã¨ã„ã†æ›¸ãæ–¹ãŒå¯èƒ½ï¼ objC()->objC(); // $D ã«ã¯ ObjD ãŒæ ¼ç´ã•ã‚Œã¦ã„ã‚‹ï¼ ãƒ»Recursive callï¼šå†å¸°çš„ãƒ—ãƒ­ã‚°ãƒ©ãƒ  è‡ªãƒ—ãƒ­ã‚°ãƒ©ãƒ ã‹ã‚‰è‡ªèº«è‡ªèº«ã‚’ã‚³ãƒ¼ãƒ«ã—ï¼Œå®Ÿè¡Œã§ãã‚‹ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã®ã“ã¨ï¼ ï¼Šä¾‹ï¼Š ã‚ã‚‹é–¢æ•° fã®å®šç¾©ã®ä¸­ã« fè‡ªèº«ã‚’å‘¼ã³å‡ºã—ã¦ã„ã‚‹ç®‡æ‰€ãŒã‚ã‚‹ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š ä»¥ä¸‹ã®ãƒãƒ¼ãƒˆã‚‚å‚è€ƒã«ã›ã‚ˆï¼ å‚è€ƒï¼šhttps://hiroki-it.github.io/tech-notebook-gitbook/public/backend_logic_algorithm.html é©å½“ãªå€¤ã‚’åŸºæº–å€¤ï¼ˆPivotï¼‰ã¨ã™ã‚‹ ï¼ˆâ€»ã§ãã‚Œã°ä¸­å¤®å€¤ãŒæœ›ã¾ã—ã„ï¼‰ Pivotã‚ˆã‚Šå°ã•ã„æ•°ã‚’å‰æ–¹ï¼Œå¤§ãã„æ•°ã‚’å¾Œæ–¹ã«åˆ†å‰²ã™ã‚‹ï¼ äºŒåˆ†å‰²ã•ã‚ŒãŸå„ã€…ã®ãƒ‡ãƒ¼ã‚¿ã‚’ï¼Œãã‚Œãã‚Œã‚½ãƒ¼ãƒˆã™ã‚‹ï¼ ã‚½ãƒ¼ãƒˆã‚’ç¹°ã‚Šè¿”ã—å®Ÿè¡Œã™ã‚‹ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š å¼•æ•° ãƒ»ã‚ªãƒ—ã‚·ãƒ§ãƒ³å¼•æ•° å¼•æ•°ãŒä¸ãˆã‚‰ã‚Œãªã‘ã‚Œã°ï¼ŒæŒ‡å®šã®å€¤ã‚’æ¸¡ã™æ–¹æ³• // ã“ã“ã«å®Ÿè£…ä¾‹ å€¤ã‚’è¿”å´ã™ã‚‹å‰ã®é€”ä¸­çµ‚äº† ãƒ»return; ï¼Šå®Ÿè£…ä¾‹ï¼Š returnMethod(); // returnMethod()ã§ã™ã€‚ // å‡¦ç†ã¯ç¶šãï¼ ãƒ»exit; ï¼Šå®Ÿè£…ä¾‹ï¼Š exitMethod(); // exitMethod()ã§ã™ã€‚ // ã“ã“ã§ï¼Œã‚·ã‚¹ãƒ†ãƒ å…¨ä½“ã®å‡¦ç†ãŒçµ‚äº†ã™ã‚‹ï¼ å€¤ã®è¿”å´ ãƒ»return ãƒ¡ã‚½ãƒƒãƒ‰ãŒã‚³ãƒ¼ãƒ«ã•ã‚ŒãŸå ´æ‰€ã«å€¤ã‚’è¿”å´ã—ãŸå¾Œï¼Œãã®å‡¦ç†ãŒçµ‚ã‚ã‚‹ï¼ ãƒ»yield ãƒ¡ã‚½ãƒƒãƒ‰ãŒã‚³ãƒ¼ãƒ«ã•ã‚ŒãŸå ´æ‰€ã«å€¤ã‚’è¿”å´ã—ãŸå¾Œï¼Œãã“ã§çµ‚ã‚ã‚‰ãšï¼Œyieldã®æ¬¡ã®å‡¦ç†ãŒç¶šãï¼è¿”å´å€¤ã¯ï¼Œarrayå‹ã§ã‚ã‚‹ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š oneToThree(); foreach ($oneToThree as $value) { echo \"{$value}\\n\"; } // 1 // 2 // 3 Dispatcher ãƒ»Dispatcherã¨ã¯ ç‰¹å®šã®åå‰ã¨é–¢æ•°ã‚’ç´ä»˜ã‘ï¼Œåå‰ã‚’æ¸¡ã™ã“ã¨ã§é–¢æ•°ã‚’ã‚³ãƒ¼ãƒ«ã™ã‚‹ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’Dispatcherã¨ã„ã†ï¼ addListener($name, $listener); // æ–‡å­—åˆ—ã‹ã‚‰ãƒ¡ã‚½ãƒƒãƒ‰ã‚’ã‚³ãƒ¼ãƒ«ï¼ã¤ã„ã§ã«ï¼Œå¼•æ•°ã‚’æ¸¡ã™ï¼ $dispatcher->dispatch(\"foo\", \"test\"); ãƒ»ã‚¤ãƒ™ãƒ³ãƒˆåã¨é–¢æ•°ã®ç´ä»˜ã‘ åå‰ã¨ã—ã¦ã‚¤ãƒ™ãƒ³ãƒˆåã‚’å®šç¾©ã—ï¼Œã“ã‚Œã«é–¢æ•°ã‚’ç´ä»˜ã‘ã‚‹ï¼ç‰¹å®šã®ã‚¤ãƒ™ãƒ³ãƒˆåãŒæ¸¡ã•ã‚ŒãŸæ™‚ã«ï¼Œãã‚Œã«å¯¾å¿œã¥ã‘ã‚‰ã‚ŒãŸé–¢æ•°ã‚’ã‚³ãƒ¼ãƒ«ã™ã‚‹ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã®EventDispatcherã‚¯ãƒ©ã‚¹ãŒç°¡å˜ã§ã‚ã‚‹ï¼ä»¥ä¸‹ã®ãƒãƒ¼ãƒˆã‚’å‚è€ƒã«ã›ã‚ˆï¼ å‚è€ƒï¼šhttps://hiroki-it.github.io/tech-notebook-gitbook/public/backend_php_framework_symfony.html ãƒ»è¨ˆç®—å‡¦ç†ã®è¿”å´å€¤ã‚’ä¿æŒã™ã‚‹ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ å¤§é‡ã®ãƒ‡ãƒ¼ã‚¿ã‚’é›†è¨ˆã™ã‚‹ã¯ï¼Œãã®å‡¦ç†ã«æ™‚é–“ãŒã‹ã‹ã‚‹ï¼ãã“ã§ï¼Œãã®ã‚ˆã†ãªãƒ¡ã‚½ãƒƒãƒ‰ã§ã¯ï¼Œä¸€åº¦ã‚³ãƒ¼ãƒ«ã•ã‚Œã¦é›†è¨ˆã‚’è¡Œã£ãŸå¾Œï¼Œãƒ‡ãƒ¼ã‚¿ã«è¿”å´å€¤ã‚’ä¿æŒã—ã¦ãŠãï¼ãã—ã¦ï¼Œå†ã³ã‚³ãƒ¼ãƒ«ã•ã‚ŒãŸæ™‚ã«ã¯ï¼Œè¿”å´å€¤ã‚’ãƒ‡ãƒ¼ã‚¿ã‹ã‚‰å–ã‚Šå‡ºã™ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š funcCollection = $this->addListener(); } /** * é›†è¨ˆãƒ¡ã‚½ãƒƒãƒ‰ */ public function computeRevenue() { // æ™‚é–“ã®ã‹ã‹ã‚‹é›†è¨ˆå‡¦ç†; } /** * @param string $funcName * @return false|mixed */ public function funcNameListener(string $funcName) { // è¿”å´å€¤ãŒè¨­å®šã•ã‚Œã¦ã„ãªã‹ã£ãŸå ´åˆï¼Œå€¤ã‚’è¨­å®š. if (!isset($this->resultCollection[$funcName])) { // ãƒ¡ã‚½ãƒƒãƒ‰ã®è¿”å´å€¤ã‚’Collectionã«è¨­å®šï¼ $this->resultCollection[$funcName] = $this->dispatch($funcName); } // è¿”å´å€¤ãŒè¨­å®šã•ã‚Œã¦ã„ãŸå ´åˆ,ãã®ã¾ã¾ä½¿ã†ï¼ return $this->resultCollection[$funcName]; } /** * è¿”å´å€¤ã‚’ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã—ãŸã„ãƒ¡ã‚½ãƒƒãƒ‰åã‚’ç™»éŒ²ã—ã¦ãŠã * * @return array[] */ private function addListener() { return [ \"computeRevenue\" => [$this, \"computeRevenue\"] ]; } /** * @param string $funcName * @return false|mixed */ private function dispatch(string $funcName) { // call_user_funcã§ãƒ¡ã‚½ãƒƒãƒ‰ã‚’å®Ÿè¡Œ return call_user_func( // ç™»éŒ²ã•ã‚Œã¦ã„ã‚‹ãƒ¡ã‚½ãƒƒãƒ‰åã‹ã‚‰ï¼Œãƒ¡ã‚½ãƒƒãƒ‰ã‚’Dispatch. $this->funcCollection[$funcName] ); } } 02-03. Closureï¼ˆç„¡åé–¢æ•°ï¼‰ Closureï¼ˆç„¡åé–¢æ•°ï¼‰ã®å®šç¾©ï¼Œå¤‰æ•°æ ¼ç´å¾Œã®ã‚³ãƒ¼ãƒ« ãƒ»use()ã®ã¿ã«å¼•æ•°ã‚’æ¸¡ã™å ´åˆ ï¼Šå®Ÿè£…ä¾‹ï¼Š optionName(); }; // function()ã«ã¯å¼•æ•°ãŒè¨­å®šã•ã‚Œã¦ã„ãªã„ã®ã§ï¼Œã‚³ãƒ¼ãƒ«æ™‚ã«å¼•æ•°ã¯ä¸è¦ï¼ echo $optionName; // å‡ºåŠ›çµæœ // ã‚ªãƒ—ã‚·ãƒ§ãƒ³A ãƒ»function()ã¨use()ã«å¼•æ•°ã‚’æ¸¡ã™å ´åˆ ï¼Šå®Ÿè£…ä¾‹ï¼Š optionName() . $para; }; // ã‚³ãƒ¼ãƒ«æ™‚ã«ï¼Œ$paramã‚’function()ã«æ¸¡ã™ï¼ echo $optionName(\"BC\"); // å‡ºåŠ›çµæœ // ã‚ªãƒ—ã‚·ãƒ§ãƒ³ABC ãƒ»ãƒ‡ãƒ¼ã‚¿ã®å€¤ã¨ã—ã¦ï¼Œç„¡åé–¢æ•°ã‚’æ ¼ç´ã—ã¦ãŠãè£æŠ€ ï¼Šå®Ÿè£…ä¾‹ï¼Š name = function ($para) use ($item) { $item->optionName() . $para; }; // ã‚³ãƒ¼ãƒ«æ™‚ã«ï¼Œ$paramã‚’function()ã«æ¸¡ã™ï¼ echo $option->name(\"BC\"); // å‡ºåŠ›çµæœ // ã‚ªãƒ—ã‚·ãƒ§ãƒ³ABC Closureï¼ˆç„¡åé–¢æ•°ï¼‰ã®å®šç¾©ã¨å³ã‚³ãƒ¼ãƒ« å®šç¾©ã—ãŸãã®å ´ã§ã‚³ãƒ¼ãƒ«ã•ã‚Œã‚‹ç„¡åé–¢æ•°ã‚’ã€å³æ™‚é–¢æ•°ã€ã¨å‘¼ã¶ï¼ç„¡åé–¢æ•°ã‚’ã‚³ãƒ¼ãƒ«ã—ãŸã„æ™‚ã¯ï¼Œcall_user_funcãƒ¡ã‚½ãƒƒãƒ‰ã‚’ç”¨ã„ã‚‹ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š optionName() . $param; }); // $paramã¯ã™ã§ã«å³ã‚³ãƒ¼ãƒ«æ™‚ã«æ¸¡ã•ã‚Œã¦ã„ã‚‹ï¼ // ã“ã‚Œã¯ã‚³ãƒ¼ãƒ«ã§ã¯ãªãï¼Œå³ã‚³ãƒ¼ãƒ«æ™‚ã«æ ¼ç´ã•ã‚ŒãŸè¿”å´å€¤ã®å‡ºåŠ›ï¼ echo $optionName; // å‡ºåŠ›çµæœ // ã‚ªãƒ—ã‚·ãƒ§ãƒ³ABC é«˜éšé–¢æ•°ã¨Closureï¼ˆç„¡åé–¢æ•°ï¼‰ã®çµ„ã¿åˆã‚ã› é–¢æ•°ã‚’å¼•æ•°ã¨ã—ã¦å—ã‘å–ã£ãŸã‚Šï¼Œé–¢æ•°è‡ªä½“ã‚’è¿”ã—ãŸã‚Šã™ã‚‹é–¢æ•°ã‚’ã€é«˜éšé–¢æ•°ã€ã¨å‘¼ã¶ï¼ ãƒ»ç„¡åé–¢æ•°ã‚’ç”¨ã„ãªã„å ´åˆ ï¼Šå®Ÿè£…ä¾‹ï¼Š test(\"callbackMethod\"); // å‡ºåŠ›çµæœ // å‡ºåŠ›ã«æˆåŠŸã—ã¾ã—ãŸï¼ higherOrder(\"ç¬¬ä¸€å¼•æ•°\", \"callbackMethod\"); // å‡ºåŠ›çµæœ // ç¬¬ä¸€å¼•æ•°ã®å‡ºåŠ›ã«æˆåŠŸã—ã¾ã—ãŸï¼ ãƒ»ç„¡åé–¢æ•°ã‚’ç”¨ã„ã‚‹å ´åˆ ï¼Šå®Ÿè£…ä¾‹ï¼Š higherOrder($parentVar, function () use ($parentVar) { return $parentVar . \"ã®å‡ºåŠ›ã«æˆåŠŸã—ã¾ã—ãŸï¼\"; }); // å‡ºåŠ›çµæœ // è¦ªãƒ¡ã‚½ãƒƒãƒ‰ã®ã‚¹ã‚³ãƒ¼ãƒ—ã®å¤‰æ•°ã®å‡ºåŠ›ã«æˆåŠŸã—ã¾ã—ãŸï¼ é«˜éšé–¢æ•°ã‚’ä½¿ã„ã“ãªã™ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š properties as $property) { // å¼•æ•°ã®ç„¡åé–¢æ•°ã«ã‚ˆã£ã¦ï¼Œãƒ‡ãƒ¼ã‚¿ã«å¯¾ã™ã‚‹åŠ å·¥æ–¹æ³•ãŒç•°ãªã‚‹ï¼ // ä¾‹ãˆã°ï¼Œåˆ¤å®šã§trueã®ã‚‚ã®ã®ã¿ã‚’è¿”ã™ãƒ¡ã‚½ãƒƒãƒ‰ã‚’æ¸¡ã™ã¨ï¼Œè‡ªãƒ‡ãƒ¼ã‚¿ã‚’çµã‚Šè¾¼ã‚€ã‚ˆã†ãªå‡¦ç†ã‚’è¡Œãˆã‚‹ï¼ $returned = call_user_func($property, $callback); if ($returned) { // å†æ ¼ç´ï¼ $properties[] = $returned; } } // ä»–ã®ãƒ‡ãƒ¼ã‚¿ã¯é™çš„ã«æ‰±ã£ãŸã†ãˆã§ï¼Œè‡ªèº«ã‚’è¿”ã™ï¼ return new static($properties); } } 03. å®šæ•° å®šæ•°ãŒå½¹ã«ç«‹ã¤å ´é¢ ãƒ»ãƒ•ãƒ©ã‚°ON/OFF ãƒ»åŒºåˆ†å€¤ åŒºåˆ†å€¤ã‚’æ•´æ•°å‹ã®å®šæ•°ã¨ã—ã¦æ‰±ã†ï¼åŒºåˆ†å€¤ã‚’ãƒ‡ãƒ¼ã‚¿ã¨ã—ã¦æŒã¤ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã«ã¤ã„ã¦ã¯ï¼Œãƒ‰ãƒ¡ã‚¤ãƒ³é§†å‹•è¨­è¨ˆã®å€¤ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’å‚è€ƒã«ã›ã‚ˆï¼ å‚è€ƒï¼šhttps://hiroki-it.github.io/tech-notebook-gitbook/public/software/software_application_architecture_backend_domain_driven_design.html ãƒ»æ•°å€¤è¨ˆç®—ï¼Œæ•°å€¤æ¯”è¼ƒ è¨ˆç®—å‡¦ç†ã‚„æ•°å€¤æ¯”è¼ƒå‡¦ç†ã§ã¯ï¼Œå¯èª­æ€§ã®è¦³ç‚¹ã‹ã‚‰ï¼Œã§ãã‚‹ã ã‘æ•°å€¤ã‚’ç›´æ›¸ãã—ãªã„ï¼æ•°å€¤ã«æ„å‘³åˆã„ã‚’æŒãŸã›ï¼Œå®šæ•°ã¨ã—ã¦æ‰±ã†ã¨å¯èª­æ€§ãŒé«˜ããªã‚‹ï¼ãƒ‰ãƒ¡ã‚¤ãƒ³é§†å‹•è¨­è¨ˆã®å€¤ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’å‚è€ƒã«ã›ã‚ˆï¼ å‚è€ƒï¼šhttps://hiroki-it.github.io/tech-notebook-gitbook/public/software/software_application_architecture_backend_domain_driven_design.html ãƒ»URL URLã‚’æ–‡å­—åˆ—ã‚’å®šæ•°ã¨ã—ã¦æ‰±ã†ï¼ å ´é¢ã«å¿œã˜ãŸå‘½å æ„å‘³ã¥ã‘ åå‰ å‹ å€‹æ•°ï¼Œå›æ•° NUM_*** int æœ€å¤§æ•°ï¼Œæœ€å°æ•° MAX_NUM_*****ï¼ŒMIN_NUM_***** int URL URL_***** string ãƒã‚¸ã‚«ãƒ«å®šæ•° è‡ªå‹•çš„ã«å€¤ãŒæ ¼ç´ã•ã‚Œã¦ã„ã‚‹å®šæ•°ï¼ ãƒ»__DIR__ ã“ã®å®šæ•°ãŒã‚³ãƒ¼ãƒ«ã•ã‚ŒãŸãƒ•ã‚¡ã‚¤ãƒ«ãŒè¨­ç½®ã•ã‚ŒãŸãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã®ãƒ‘ã‚¹ãŒï¼Œãƒ«ãƒ¼ãƒˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªåŸºæº–ã§æ ¼ç´ã•ã‚Œã¦ã„ã‚‹ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š ä»¥ä¸‹ã®å®Ÿè£…ã‚’æŒã¤ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ï¼Œã€Œ/var/www/appã€ä¸‹ã«ç½®ã„ã¦ãŠãï¼Œã€Œ/vendor/autoload.phpã€ã¨çµåˆã—ã¦ãƒ‘ã‚¹ã‚’é€šã™ï¼ ãƒ»__FUNCTION__ ã“ã®å®šæ•°ãŒã‚³ãƒ¼ãƒ«ã•ã‚ŒãŸãƒ¡ã‚½ãƒƒãƒ‰åãŒæ ¼ç´ã•ã‚Œã¦ã„ã‚‹ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š foo(); // foo ãŒè¿”å´ã•ã‚Œã‚‹ï¼ ãƒ»__METHOD__ ã“ã®å®šæ•°ãŒã‚³ãƒ¼ãƒ«ã•ã‚ŒãŸã‚¯ãƒ©ã‚¹åã¨ãƒ¡ã‚½ãƒƒãƒ‰åãŒï¼Œ{ã‚¯ãƒ©ã‚¹å}::{ãƒ¡ã‚½ãƒƒãƒ‰å}ã®å½¢å¼ã§æ ¼ç´ã•ã‚Œã¦ã„ã‚‹ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š foo(); // Foo::foo ãŒè¿”å´ã•ã‚Œã‚‹ï¼ 04. å¤‰æ•° å¤‰æ•°å±•é–‹ æ–‡å­—åˆ—ã®ä¸­ã§ï¼Œå¤‰æ•°ã®ä¸­èº«ã‚’å–ã‚Šå‡ºã™ã“ã¨ã‚’ã€å¤‰æ•°å±•é–‹ã€ã¨å‘¼ã¶ï¼ â€»Paizaã§æ¤œè¨¼æ¸ˆã¿ï¼ ãƒ»ã‚·ãƒ³ã‚°ãƒ«ã‚¯ã‚ªãƒ¼ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ã«ã‚ˆã‚‹å¤‰æ•°å±•é–‹ ã‚·ãƒ³ã‚°ãƒ«ã‚¯ã‚ªãƒ¼ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ã®ä¸­èº«ã¯å…¨ã¦æ–‡å­—åˆ—ã¨ã—ã¦èªè­˜ã•ã‚Œï¼Œå¤‰æ•°ã¯å±•é–‹ã•ã‚Œãªã„ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š ãƒ»ã‚·ãƒ³ã‚°ãƒ«ã‚¯ã‚ªãƒ¼ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ã¨æ³¢æ‹¬å¼§ã«ã‚ˆã‚‹å¤‰æ•°å±•é–‹ ã‚·ãƒ³ã‚°ãƒ«ã‚¯ã‚ªãƒ¼ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ã®ä¸­èº«ã¯å…¨ã¦æ–‡å­—åˆ—ã¨ã—ã¦èªè­˜ã•ã‚Œï¼Œå¤‰æ•°ã¯å±•é–‹ã•ã‚Œãªã„ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š ãƒ»ãƒ€ãƒ–ãƒ«ã‚¯ã‚ªãƒ¼ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ã«ã‚ˆã‚‹å¤‰æ•°å±•é–‹ å¤‰æ•°ã®å‰å¾Œã«åŠè§’ã‚¹ãƒšãƒ¼ã‚¹ã‚’ç½®ã„ãŸå ´åˆã«ã®ã¿ï¼Œå¤‰æ•°ã¯å±•é–‹ã•ã‚Œã‚‹ï¼ï¼ˆâ€»åŠè§’ã‚¹ãƒšãƒ¼ã‚¹ãŒãªã„ã¨ã‚¨ãƒ©ãƒ¼ã«ãªã‚‹ï¼‰ ãƒ»ãƒ€ãƒ–ãƒ«ã‚¯ã‚ªãƒ¼ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ã¨æ³¢æ‹¬å¼§ã«ã‚ˆã‚‹å¤‰æ•°å±•é–‹ æ³¢æ‹¬å¼§ã‚’ç”¨ã„ã‚‹ã¨ï¼Œæ˜ç¤ºçš„ã«å¤‰æ•°ã¨ã—ã¦æ‰±ã†ã“ã¨ãŒã§ãã‚‹ï¼ã“ã‚Œã«ã‚ˆã£ã¦ï¼Œå¤‰æ•°ã®å‰å¾Œã«åŠè§’ã‚¹ãƒšãƒ¼ã‚¹ã‚’ç½®ã‹ãªãã¨ã‚‚ï¼Œå¤‰æ•°ã¯å±•é–‹ã•ã‚Œã‚‹ï¼ å‚ç…§æ¸¡ã—ã¨å€¤æ¸¡ã— ãƒ»å‚ç…§æ¸¡ã— ã€Œå‚ç…§æ¸¡ã—ã€ã¨ã¯ï¼Œå¤‰æ•°ã«ä»£å…¥ã—ãŸå€¤ã®å‚ç…§å…ˆï¼ˆãƒ¡ãƒ¢ãƒªã‚¢ãƒ‰ãƒ¬ã‚¹ï¼‰ã‚’æ¸¡ã™ã“ã¨ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š å¤‰æ•°ã®$bã«ã¯ï¼Œ$aã®å‚ç…§ã«ã‚ˆã£ã¦10ãŒæ ¼ç´ã•ã‚Œã‚‹ï¼ ãƒ»å€¤æ¸¡ã— ã€Œå€¤æ¸¡ã—ã€ã¨ã¯ï¼Œå¤‰æ•°ã«ä»£å…¥ã—ãŸå€¤ã®ã‚³ãƒ”ãƒ¼ã‚’æ¸¡ã™ã“ã¨ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š å¤‰æ•°ã®$bã«ã¯ï¼Œ$aã®ä¸€è¡Œç›®ã®æ ¼ç´ã«ã‚ˆã£ã¦2ãŒæ ¼ç´ã•ã‚Œã‚‹ï¼ 05. çµ„ã¿è¾¼ã¿ãƒ©ãƒƒãƒ‘ãƒ¼é–¢æ•° å…¥å‡ºåŠ›ã‚¹ãƒˆãƒªãƒ¼ãƒ ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹ ãƒ»å…¥å‡ºåŠ›ã‚¹ãƒˆãƒªãƒ¼ãƒ ã¨ã¯ ä¸€åº¦ã«å…¨ã¦ã®ãƒ‡ãƒ¼ã‚¿ã‚’å…¥å‡ºåŠ›ã™ã‚‹ã®ã§ã¯ãªãï¼Œå°‘ã—ãšã¤å…¥å‡ºåŠ›ã™ã‚‹å‡¦ç†ã®ã“ã¨ï¼ ãƒ»php://stdin stdinï¼šstandard inï¼ˆæ¨™æº–å…¥åŠ›ï¼‰ã‚’æ„å‘³ã™ã‚‹ï¼PHPã®ãƒ—ãƒ­ã‚»ã‚¹ãŒï¼Œæ¨™æº–å…¥åŠ›ã«å¯¾ã—ã¦ï¼Œèª­ã¿å‡ºã—å‡¦ç†ã‚’é€ä¿¡ã§ãã‚‹ã‚ˆã†ã«ãªã‚‹ï¼ ãƒ»php://stdout stdoutï¼šstandard outï¼ˆæ¨™æº–å‡ºåŠ›ï¼‰ã‚’æ„å‘³ã™ã‚‹ï¼PHPã®ãƒ—ãƒ­ã‚»ã‚¹ãŒï¼Œæ¨™æº–å‡ºåŠ›ã«å¯¾ã—ã¦ï¼Œæ›¸ãè¾¼ã¿å‡¦ç†ã‚’é€ä¿¡ã§ãã‚‹ã‚ˆã†ã«ãªã‚‹ï¼ ãƒ»php://stderr stderrï¼šstandard errorï¼ˆæ¨™æº–å‡ºåŠ›ã‚¨ãƒ©ãƒ¼ï¼‰ã‚’æ„å‘³ã™ã‚‹ï¼PHPã®ãƒ—ãƒ­ã‚»ã‚¹ãŒï¼Œæ¨™æº–ã‚¨ãƒ©ãƒ¼å‡ºåŠ›ã«å¯¾ã—ã¦ï¼Œæ›¸ãè¾¼ã¿å‡¦ç†ã‚’é€ä¿¡ã§ãã‚‹ã‚ˆã†ã«ãªã‚‹ï¼ 06. ãã®ä»–ã®é–¢æ•° ãƒ•ã‚¡ã‚¤ãƒ«ã‚·ã‚¹ãƒ†ãƒ é–¢æ•° ãƒ»file_put_contents ãƒ•ã‚¡ã‚¤ãƒ«ã«æ–‡å­—åˆ—ã‚’å‡ºåŠ›ã™ã‚‹ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š 07. æ­£è¦è¡¨ç¾ã¨ãƒ‘ã‚¿ãƒ¼ãƒ³æ¼”ç®—å­ æ­£è¦è¡¨ç¾ ãƒ»æ­£è¦è¡¨ç¾ã¨ã¯ æ•°å€¤ï¼Œè¨˜å·ï¼Œæ–‡å­—åˆ—ãªã©ã®ç¨®é¡ã‚’ç°¡å˜ã«è¡¨ç¾ã™ã‚‹æ–‡å­—åˆ—ã®ã“ã¨ï¼ preg_matché–¢æ•° ãƒ»æ•°å­— ï¼Šå®Ÿè£…ä¾‹ï¼Š ã€0ã‹ã‚‰9ã®ã„ãšã‚Œã‹ã€ã®æ•°å­—ã‚’æ„å‘³ã™ã‚‹ï¼ ãƒ»ã‚¢ãƒ«ãƒ•ã‚¡ãƒ™ãƒƒãƒˆ ï¼Šå®Ÿè£…ä¾‹ï¼Š ã€aã‹ã‚‰zã®ã„ãšã‚Œã‹ã€ã¾ãŸã¯ã€Aã‹ã‚‰Zã®ã„ãšã‚Œã‹ã€ã®ã‚¢ãƒ«ãƒ•ã‚¡ãƒ™ãƒƒãƒˆã‚’æ„å‘³ã™ã‚‹ï¼ ãƒ»ãƒ¡ã‚¿æ–‡å­— ã‚¨ã‚¹ã‚±ãƒ¼ãƒ—ã®ãŸã‚ã«ï¼Œå¿…ãšãƒãƒƒã‚¯ã‚¹ãƒ©ãƒƒã‚·ãƒ¥ã‚’ä»˜ã‘ã‚‹å¿…è¦ãŒã‚ã‚‹ï¼ å‚è€ƒï¼šhttps://www-creators.com/archives/3102 ï¼Šå®Ÿè£…ä¾‹ï¼Š ã€?ã€ã€.ã€ã€*ã€ã€$ã€ã®ã„ãšã‚Œã‹ã®ãƒ¡ã‚¿æ–‡å­—ã‚’æ„å‘³ã™ã‚‹ï¼ ãƒ»ãƒ¯ã‚¤ãƒ«ãƒ‰ã‚«ãƒ¼ãƒ‰ ãƒ¯ã‚¤ãƒ«ãƒ‰ã‚«ãƒ¼ãƒ‰ã¯ã€.*ã€ã§è¡¨ç¾ã™ã‚‹ï¼ å‚è€ƒï¼šhttps://qiita.com/whisky-shusuky/items/d719c92c566c133f51b1 ï¼Šå®Ÿè£…ä¾‹ï¼Š ãƒ»ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã¨ã—ã¦ã®ãƒ‘ã‚¿ãƒ¼ãƒ³æ¼”ç®—å­ ï¼Šå®Ÿè£…ä¾‹ï¼Š "},"public/software/software_application_backend_php_object_orientation_data_structure.html":{"url":"public/software/software_application_backend_php_object_orientation_data_structure.html","title":"ğŸ“– ï¸ãƒ‡ãƒ¼ã‚¿æ§‹é€ ","keywords":"","body":"ãƒ‡ãƒ¼ã‚¿æ§‹é€  ã¯ã˜ã‚ã« æœ¬ã‚µã‚¤ãƒˆã«ã¤ãã¾ã—ã¦ï¼Œä»¥ä¸‹ã‚’ã”èªè­˜ã®ã»ã©å®œã—ããŠé¡˜ã„ã„ãŸã—ã¾ã™ï¼ å‚è€ƒï¼šhttps://hiroki-it.github.io/tech-notebook-gitbook/ 01. ãƒ‡ãƒ¼ã‚¿æ§‹é€ ã®å®Ÿè£…æ–¹æ³• ãƒãƒ¼ãƒ‰ã‚¦ã‚§ã‚¢ãŒå‡¦ç†ã‚’è¡Œã†æ™‚ã«ï¼Œãƒ‡ãƒ¼ã‚¿ã®é›†åˆã‚’åŠ¹ç‡çš„ã«æ‰±ã†ãŸã‚ã®ãƒ‡ãƒ¼ã‚¿æ ¼ç´å½¢å¼ã‚’ãƒ‡ãƒ¼ã‚¿æ§‹é€ ã¨ã„ã†ï¼ãƒ‡ãƒ¼ã‚¿æ§‹é€ ã®PHPã«ã‚ˆã‚‹å®Ÿè£…æ–¹æ³•ã‚’ä»¥ä¸‹ã«ç¤ºã™ï¼ é…åˆ—å‹ åŒã˜ãƒ‡ãƒ¼ã‚¿å‹ã®ãƒ‡ãƒ¼ã‚¿ã‚’ä¸¦ã¹ãŸãƒ‡ãƒ¼ã‚¿æ ¼ç´æ§˜å¼ã®ã“ã¨ï¼ ãƒ»ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹é…åˆ— ç•ªå·ã‚­ãƒ¼ã”ã¨ã«å€¤ãŒæ ¼ç´ã•ã‚ŒãŸé…åˆ—å‹ã®ã“ã¨ï¼ Array ( [0] => A [1] => B [2] => C ) ãƒ»å¤šæ¬¡å…ƒé…åˆ— é…åˆ—ã®ä¸­ã«é…åˆ—ã‚’æŒã¤é…åˆ—å‹ã®ã“ã¨ï¼é…åˆ—ã®å…¥ã‚Œå­æ§‹é€ ãŒï¼’æ®µã®å ´åˆï¼Œã€äºŒæ¬¡å…ƒé…åˆ—ã€ã¨å‘¼ã¶ï¼ ( [0] => Array ( [0] => ãƒªãƒ³ã‚´ [1] => ã‚¤ãƒã‚´ [2] => ãƒˆãƒãƒˆ ) [1] => Array ( [0] => ãƒ¡ãƒ­ãƒ³ [1] => ã‚­ãƒ¥ã‚¦ãƒª [2] => ãƒ”ãƒ¼ãƒãƒ³ ) ) ãƒ»é€£æƒ³é…åˆ— ã‚­ãƒ¼åï¼ˆèµ¤ï¼Œç·‘ï¼Œé»„ï¼Œæœç‰©ï¼Œé‡èœï¼‰ã”ã¨ã«å€¤ãŒæ ¼ç´ã•ã‚ŒãŸé…åˆ—å‹ã®ã“ã¨ï¼ä¸‹ã®ä¾‹ã¯ï¼ŒäºŒæ¬¡å…ƒé…åˆ—ã‹ã¤é€£æƒ³é…åˆ—ã§ã‚ã‚‹ï¼ Array ( [èµ¤] => Array ( [æœç‰©] => ãƒªãƒ³ã‚´ [æœç‰©] => ã‚¤ãƒã‚´ [é‡èœ] => ãƒˆãƒãƒˆ ) [ç·‘] => Array ( [æœç‰©] => ãƒ¡ãƒ­ãƒ³ [é‡èœ] => ã‚­ãƒ¥ã‚¦ãƒª [é‡èœ] => ãƒ”ãƒ¼ãƒãƒ³ ) ) LinkedListå‹ PHPã§ç”¨ã„ã‚‹ã“ã¨ã¯ã‚ã¾ã‚Šãªã„ãƒ‡ãƒ¼ã‚¿æ ¼ç´æ§˜å¼ï¼è©³ã—ãã¯ï¼ŒJavaã«ãŠã‘ã‚‹LinkedListå‹ã‚’å‚ç…§ã›ã‚ˆï¼ ãƒ»PHPã®listãƒ¡ã‚½ãƒƒãƒ‰ã¨ã¯ä½•ãªã®ã‹ PHPã®listãƒ¡ã‚½ãƒƒãƒ‰ã¯ï¼ŒListå‹ã¨ã¯æ„å‘³åˆã„ãŒç•°ãªã‚‹ï¼é…åˆ—ã®è¦ç´ ä¸€ã¤ä¸€ã¤ã‚’å¤‰æ•°ã«æ ¼ç´ã—ãŸã„å ´åˆï¼ŒListå‹ã‚’ä½¿ã‚ãªã‘ã‚Œã°ï¼Œå†—é•·ã§ã¯ã‚ã‚‹ãŒï¼Œä»¥ä¸‹ã®ã‚ˆã†ã«å®Ÿè£…ã™ã‚‹å¿…è¦ãŒã‚ã‚‹ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š ã—ã‹ã—ï¼Œä»¥ä¸‹ã®æ§˜ã«ï¼Œlistãƒ¡ã‚½ãƒƒãƒ‰ã‚’ä½¿ã†ã“ã¨ã«ã‚ˆã£ã¦ï¼Œè¤‡æ•°ã®å¤‰æ•°ã¸ã®æ ¼ç´ã‚’ä¸€è¡Œã§å®Ÿè£…ã§ãã‚‹ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š Queueå‹ PHPã§ã¯ï¼Œarray_pushãƒ¡ã‚½ãƒƒãƒ‰ã¨array_shiftãƒ¡ã‚½ãƒƒãƒ‰ã‚’çµ„ã¿åˆã‚ã›ã‚‹ã“ã¨ã§å®Ÿè£…ã§ãã‚‹ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š Blue // [1] => Green // [2] => Red // ) // é…åˆ—ã®æœ€åˆã®è¦ç´ ã‚’å–ã‚Šå‡ºã™ï¼ $theFirst= array_shift($array); print_r($array); // å‡ºåŠ›çµæœ // Array // ( // [0] => Green // [1] => Red // ) // å–ã‚Šå‡ºã•ã‚ŒãŸå€¤ã®ç¢ºèª echo $theFirst; // Blue ãƒ»ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸Queue é€ä¿¡å´ã®å¥½ããªã‚¿ã‚¤ãƒŸãƒ³ã‚°ã§ãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ï¼‰ã‚’ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸Queueã«è¿½åŠ ã§ãã‚‹ï¼ã¾ãŸï¼Œå—ä¿¡å´ã®å¥½ããªã‚¿ã‚¤ãƒŸãƒ³ã‚°ã§ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å–ã‚Šå‡ºã™ã“ã¨ãŒã§ãã‚‹ï¼ Stackå‹ PHPã§ã¯ï¼Œarray_pushãƒ¡ã‚½ãƒƒãƒ‰ã¨array_popãƒ¡ã‚½ãƒƒãƒ‰ã§å®Ÿè£…å¯èƒ½ï¼ Treeå‹ ãƒ»äºŒåˆ†æ¢ç´¢æœ¨ å„ãƒãƒ¼ãƒ‰ã«ãƒ‡ãƒ¼ã‚¿ãŒæ ¼ç´ã•ã‚Œã¦ã„ã‚‹ï¼ ãƒ»ãƒ’ãƒ¼ãƒ— Priority Queueã‚’å®Ÿç¾ã™ã‚‹ã¨ãã«ç”¨ã„ã‚‰ã‚Œã‚‹ï¼å„ãƒãƒ¼ãƒ‰ã«ãƒ‡ãƒ¼ã‚¿ãŒæ ¼ç´ã•ã‚Œã¦ã„ã‚‹ï¼ 01-02. Javaã«ãŠã‘ã‚‹ãƒ‡ãƒ¼ã‚¿æ§‹é€ ã®å®Ÿè£…æ–¹æ³• ãƒ‡ãƒ¼ã‚¿æ§‹é€ ã®Javaã«ã‚ˆã‚‹å®Ÿè£…æ–¹æ³•ã‚’ä»¥ä¸‹ã«ç¤ºã™ï¼ é…åˆ—å‹ ãƒ»ArrayList ArrayListã‚¯ãƒ©ã‚¹ã«ã‚ˆã£ã¦å®Ÿè£…ã•ã‚Œã‚‹é…åˆ—å‹ï¼PHPã®ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹é…åˆ—ã«ç›¸å½“ã™ã‚‹ï¼ ãƒ»HashMap HashMapã‚¯ãƒ©ã‚¹ã«ã‚ˆã£ã¦å®Ÿè£…ã•ã‚Œã‚‹é…åˆ—å‹ï¼PHPã®é€£æƒ³é…åˆ—ã«ç›¸å½“ã™ã‚‹ï¼ LinkedListå‹ å€¤ã‚’ãƒã‚¤ãƒ³ã‚¿ã«ã‚ˆã£ã¦é †åºé€šã‚Šä¸¦ã¹ãŸãƒ‡ãƒ¼ã‚¿æ ¼ç´å½¢å¼ã®ã“ã¨ï¼ ãƒ»å˜æ–¹å‘List ãƒ»åŒæ–¹å‘List ãƒ»å¾ªç’°List Queueå‹ Stackå‹ Treeå‹ 02. ãƒ—ãƒªãƒŸãƒ†ã‚£ãƒ–ãƒ‡ãƒ¼ã‚¿å‹ ãƒ—ãƒªãƒŸãƒ†ã‚£ãƒ–å‹ ãƒ»ãƒ—ãƒªãƒŸãƒ†ã‚£ãƒ–å‹ã¨ã¯ ã‚¹ã‚«ãƒ©ãƒ¼å‹ï¼Œè¤‡åˆå‹ï¼Œãã®ä»–ï¼Œã«åˆ†é¡ã§ãã‚‹ï¼ä»¥ä¸‹ã®ãƒªãƒ³ã‚¯ã‚’å‚è€ƒã«ã›ã‚ˆï¼ å‚è€ƒï¼šhttps://www.php.net/manual/ja/language.types.intro.php ã‚¹ã‚«ãƒ©ãƒ¼å‹ ãƒ»bool Tï¼F ãƒ‡ãƒ¼ã‚¿ã®ç¨®é¡ èª¬æ˜ FALSE $var = ä½•ã‚‚æ ¼ç´ã•ã‚Œã¦ã„ãªã„å¤‰æ•° False æ–‡å­—ã¨ã—ã¦ã®False 0 æ•°å­—ã€æ–‡å­—åˆ— \"\" ç©ºæ–‡å­— array() è¦ç´ æ•°ãŒ0å€‹ã®é…åˆ— NULL NULLå€¤ TRUE ä¸Šè¨˜ä»¥å¤–ã®å€¤ ãƒ»float ãƒ»int ãƒ»string è¤‡åˆå‹ ãƒ»array ãƒ»callable ãƒ»iterable ãƒ»object name, \"Hello World!\" ); } } $a = new A; var_dump($a); // object(A)#1 (1) { // [\"name\":\"A\":private]=> // string(6) \"Hiroki\" //} print_r($a); // A Object // ( // [name:A:private] => Hiroki // ) ãã®ä»–ã®ãƒ‡ãƒ¼ã‚¿å‹ ãƒ»date å³å¯†ã«ã¯ãƒ‡ãƒ¼ã‚¿å‹ã§ã¯ãªã„ãŒï¼Œä¾¿å®œä¸Šï¼Œãƒ‡ãƒ¼ã‚¿å‹ã¨ã™ã‚‹ï¼ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—ã¨ã¯ï¼Œå”å®šä¸–ç•Œæ™‚(UTC)ã‚’åŸºæº–ã«ã—ãŸ1970å¹´1æœˆ1æ—¥ã®0æ™‚0åˆ†0ç§’ã‹ã‚‰ã®çµŒéç§’æ•°ã‚’è¡¨ã—ãŸã‚‚ã®ï¼ ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ å®Ÿè£…æ–¹æ³• å‚™è€ƒ æ—¥ä»˜ 2019-07-07 åŒºåˆ‡ã‚Šè¨˜å·ãªã—ã€ãƒ‰ãƒƒãƒˆã€ã‚¹ãƒ©ãƒƒã‚·ãƒ¥ãªã©ã‚‚å¯èƒ½ æ™‚é–“ 19:07:07 åŒºåˆ‡ã‚Šè¨˜å·ãªã—ã€ã‚‚å¯èƒ½ æ—¥ä»˜ã¨æ™‚é–“ 2019-07-07 19:07:07 åŒä¸Š ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—ï¼ˆç§’ï¼‰ 1562494027 1970å¹´1æœˆ1æ—¥ã®0æ™‚0åˆ†0ç§’ã‹ã‚‰2019-07-07 19:07:07 ã¾ã§ã®çµŒéç§’æ•° ãƒ»null ãƒ»resource 02-02. ãƒ‡ãƒ¼ã‚¿å‹ã®åˆ¤å®šï¼å¤‰æ› åˆ¤å®šé–¢æ•° ãƒ»is_scalar ã‚¹ã‚«ãƒ©ãƒ¼å‹ï¼ˆboolï¼Œfloatï¼Œintï¼Œstringï¼‰ã‚’åˆ¤å®šã™ã‚‹ï¼ ã‚­ãƒ£ã‚¹ãƒˆæ¼”ç®—å­ ãƒ»(string) ãƒ»(int) ãƒ»(bool) ãƒ»(float) ãƒ»(array) ãƒ»(object) "},"public/software/software_application_backend_php_logic_validation.html":{"url":"public/software/software_application_backend_php_logic_validation.html","title":"ğŸ“– ï¸æ¤œè¨¼ãƒ­ã‚¸ãƒƒã‚¯","keywords":"","body":"æ¤œè¨¼ãƒ­ã‚¸ãƒƒã‚¯ ã¯ã˜ã‚ã« æœ¬ã‚µã‚¤ãƒˆã«ã¤ãã¾ã—ã¦ï¼Œä»¥ä¸‹ã‚’ã”èªè­˜ã®ã»ã©å®œã—ããŠé¡˜ã„ã„ãŸã—ã¾ã™ï¼ å‚è€ƒï¼šhttps://hiroki-it.github.io/tech-notebook-gitbook/ 01. æ¤œè¨¼ æ¤œè¨¼ã®å¿…è¦æ€§ã®æœ‰ç„¡ ãƒ»ä¸è¦ãªå ´åˆ ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‹ã‚‰å–å¾—ã—ãŸå¾Œã«ç›´æ¥è¡¨ç¤ºã™ã‚‹å€¤ã®å ´åˆï¼Œãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã§Nullã«ãªã‚‰ãªã„ã‚ˆã†ã«åˆ¶ç´„ã‚’ã‹ã‘ã‚‰ã‚Œã‚‹ï¼ãã®ãŸã‚ï¼Œå€¤ãŒæƒ³å®šé€šã‚Šã®çŠ¶æ…‹ã«ãªã£ã¦ã„ã‚‹ã‹ã‚’æ”¹ã‚ã¦æ¤œè¨¼ã™ã‚‹å¿…è¦ã¯ãªã„ï¼ ãƒ»å¿…è¦ãªå ´åˆ ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‹ã‚‰ã®å€¤ã‚’ç›´æ¥è¡¨ç¤ºã™ã‚‹å ´åˆã¨ç•°ãªã‚Šï¼Œæ–°ã—ãä½œã‚‰ã‚Œã‚‹å€¤ã‚’ç”¨ã„ã‚‹å ´åˆï¼Œãã®å€¤ãŒæƒ³å®šå¤–ã®çŠ¶æ…‹ã«ãªã£ã¦ã„ã‚‹å¯èƒ½æ€§ãŒã‚ã‚‹ï¼ãã®ãŸã‚ï¼Œå€¤ãŒæƒ³å®šé€šã‚Šã®çŠ¶æ…‹ã«ãªã£ã¦ã„ã‚‹ã‹ã‚’æ¤œè¨¼ã™ã‚‹å¿…è¦ãŒã‚ã‚‹ï¼æ¤œè¨¼ãƒ‘ã‚¿ãƒ¼ãƒ³ã«ã¤ã„ã¦ã¯ï¼Œå¾Œè¿°ã®èª¬æ˜ã‚’å‚è€ƒã«ã›ã‚ˆï¼ æ¤œè¨¼ãƒ‘ã‚¿ãƒ¼ãƒ³ã¨æ¤œè¨¼ãƒ¡ã‚½ãƒƒãƒ‰ã®å¯¾å¿œ ã€‡ï¼šTRUE âœ•ï¼šFALSE ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã®æ¤œè¨¼ã«ã¤ã„ã¦ã¯ä»¥ä¸‹ã‚’å‚è€ƒã«ã›ã‚ˆï¼ å‚è€ƒï¼šhttps://hiroki-it.github.io/tech-notebook-gitbook/public/frontend_logic_validation.html æ¤œè¨¼ãƒ‘ã‚¿ãƒ¼ãƒ³ isset($var)ï¼Œ!is_null($var) if($var)ï¼Œ!empty($var) null âœ• âœ• 0 ã€‡ âœ• 1 ã€‡ ã€‡ \"\"ï¼ˆç©ºæ–‡å­—ï¼‰ ã€‡ âœ• \"ã‚\" ã€‡ ã€‡ array(0) ã€‡ âœ• array(1) ã€‡ ã€‡ ä½¿ã„ã©ã“ã‚ nullã ã‘ã‚’æ¤œè¨¼ã—ãŸã„å ´åˆ nullï¼Œ0ï¼Œ\"\"ï¼Œ[]ã‚’æ¤œè¨¼ã—ãŸã„å ´åˆ 02. æ¡ä»¶å¼ if-elseif-else ï¼Œswitch-case-break ï¼Šå®Ÿè£…ä¾‹ï¼Š æ›œæ—¥ã‚’æ¤œè¨¼ã—ï¼Œæ–‡å­—åˆ—ã‚’å‡ºåŠ›ã™ã‚‹ï¼ ãƒ»if-elseif-else ï¼Šå®Ÿè£…ä¾‹ï¼Š ãƒ»switch-case-break å®šæ•°ã”ã¨ã«å‡¦ç†ãŒå¤‰ã‚ã‚‹æ™‚ï¼Œã“ã¡ã‚‰ã®æ–¹ãŒå¯èª­æ€§ãŒé«˜ã„ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š if-elseã®å›é¿æ–¹æ³• ãƒ»if-elseã‚’ç”¨ã„ãŸå ´åˆ å¯èª­æ€§ãŒæ‚ªã„ãŸã‚ï¼Œé¿ã‘ã‚‹ã¹ãï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š routeEntity->options)) { foreach ($this->routeEntity->options as $option) { // ifæ–‡ã‚’é€šéã—ãŸå ´åˆï¼Œãƒ¡ã‚½ãƒƒãƒ‰ã®è¿”å´å€¤ãŒæ ¼ç´ã•ã‚Œã‚‹ï¼ // é€šéã—ãªã„å ´åˆï¼Œå®šæ•°ãŒæ ¼ç´ã•ã‚Œã‚‹ï¼ if ($option->isOptionItemA()) { $result[\"optionItemA\"] = $option->optionItemA(); } else { $result[\"optionItemA\"] = self::noOptionItem; } if ($option->isOptionItemB()) { $result[\"optionItemB\"] = $option->optionItemB(); } else { $result[\"optionItemB\"] = self::noOptionItem; } if ($option->isOptionItemC()) { $result[\"optionItemC\"] = $option->optionItemC(); } else { $result[\"optionItemC\"] = self::noOptionItem; } } } return $result; } } ãƒ»ä¸‰é …æ¼”ç®—å­ã‚’ç”¨ã„ãŸå ´åˆ ã‚ˆã‚Šã™ã£ãã‚Šã—ãŸæ›¸ãæ–¹ã«ãªã‚‹ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š routeEntity->options)) { foreach ($this->routeEntity->options as $option) { // ifæ–‡ã‚’é€šéã—ãŸå ´åˆï¼Œãƒ¡ã‚½ãƒƒãƒ‰ã®è¿”å´å€¤ãŒæ ¼ç´ã•ã‚Œã‚‹ï¼ // é€šéã—ãªã„å ´åˆï¼Œå®šæ•°ãŒæ ¼ç´ã•ã‚Œã‚‹ï¼ $result[\"optionItemA\"] = ($option->isOptionItemA()) ? $option->optionItemA() : self::noOptionItem; $result[\"optionItemB\"] = ($option->isOptionItemB()) ? $option->optionItemB() : self::noOptionItem; $result[\"optionItemC\"] = ($option->isOptionItemC()) ? $option->optionItemC() : self::noOptionItem; }; } return $result; } } ãƒ»åˆæœŸå€¤ã¨ä¸Šæ›¸ãã®ãƒ­ã‚¸ãƒƒã‚¯ã‚’ç”¨ã„ãŸå ´åˆ ã‚ˆã‚Šã™ã£ãã‚Šã—ãŸæ›¸ãæ–¹ã«ãªã‚‹ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š routeEntity->options)) { foreach ($this->routeEntity->options as $option) { // ifæ–‡ã‚’é€šéã—ãŸå ´åˆï¼Œãƒ¡ã‚½ãƒƒãƒ‰ã®è¿”å´å€¤ã«ã‚ˆã£ã¦åˆæœŸå€¤0ãŒä¸Šæ›¸ãã•ã‚Œã‚‹ï¼ // é€šéã—ãªã„å ´åˆï¼ŒåˆæœŸå€¤0ãŒç”¨ã„ã‚‰ã‚Œã‚‹ï¼ if ($option->isOptionItemA()) { $result[\"optionItemA\"] = $option->optionItemA(); } if ($option->isOptionItemB()) { $result[\"optionItemB\"] = $option->optionItemB(); } if ($option->isOptionItemC()) { $result[\"optionItemC\"] = $option->optionItemC(); } }; } return $result; } } if-elseif-elseã®å›é¿æ–¹æ³• ãƒ»æ±ºå®šè¡¨ã‚’ç”¨ã„ãŸæ¡ä»¶åˆ†å²ã®æ•´ç† ï¼Šå®Ÿè£…ä¾‹ï¼Š ã†ã‚‹ã†å¹´ã§ã‚ã‚‹ã‹ã‚’æ¤œè¨¼ã—ï¼Œæ–‡å­—åˆ—ã‚’å‡ºåŠ›ã™ã‚‹ï¼ä»¥ä¸‹ã®æ‰‹é †ã§è¨­è¨ˆã¨å®Ÿè£…ã‚’è¡Œã†ï¼ æ¡ä»¶åˆ†å²ã®å‡¦ç†é †åºã®æ¦‚è¦ã‚’æ—¥æœ¬ã§è¨˜è¿°ã™ã‚‹ï¼ è¨˜è¿°å†…å®¹ã‚’ï¼Œæ¡ä»¶éƒ¨ã¨å‹•ä½œéƒ¨ã«åˆ†è§£ã—ï¼Œæ±ºå®šè¡¨ã§è¡¨ã™ï¼ æ±ºå®šè¡¨ã‚’ï¼Œæµã‚Œå›³ã§è¡¨ã™ï¼ ãƒ»if-elseif-elseã¯ç”¨ã„ãªã„ å¯èª­æ€§ãŒæ‚ªã„ãŸã‚ï¼Œé¿ã‘ã‚‹ã¹ãï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š ãƒ»ifã¨returnã‚’ç”¨ã„ãŸæ—©æœŸãƒªã‚¿ãƒ¼ãƒ³ å„ifæ–‡ã§returnã‚’ç”¨ã„ã‚‹ã“ã¨ã§ï¼ŒifãŒå…¥ã‚Œå­çŠ¶ã«ãªã‚‹ã“ã¨ã‚’é˜²ã’ã‚‹ï¼ã“ã‚Œã‚’ï¼Œæ—©æœŸãƒªã‚¿ãƒ¼ãƒ³ã¨ã‚‚ã„ã†ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š ãƒ»switch-case-breakã‚’ç”¨ã„ãŸæ—©æœŸãƒªã‚¿ãƒ¼ãƒ³ ifæ–‡ã®ä»£ã‚ã‚Šã«ï¼Œswitch-case-breakã«ã‚ˆã£ã¦ï¼Œå®Ÿè£…ã«ï¼Œã€â—¯â—¯ã®å ´åˆã«åˆ‡ã‚Šæ›ãˆã‚‹ã€ã¨ã„ã†æ„å‘³åˆã„ã‚’æŒãŸã›ã‚‰ã‚Œã‚‹ï¼ã“ã“ã§ã¯ï¼Œãƒ¡ã‚½ãƒƒãƒ‰ã«å®Ÿè£…ã™ã‚‹ã“ã¨ã‚’æƒ³å®šã—ã¦ï¼Œbreakã§ã¯ãªãreturnã‚’ç”¨ã„ã¦ã„ã‚‹ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š ãƒ»ã‚¬ãƒ¼ãƒ‰ç¯€ã‚’ç”¨ã„ãŸæ—©æœŸãƒªã‚¿ãƒ¼ãƒ³ æ—©æœŸãƒªã‚¿ãƒ¼ãƒ³ã®ifæ–‡ã®æ³¢æ‹¬å¼§ã‚’çœç•¥ã—ãŸè¨˜æ³•ã‚’ï¼Œã‚¬ãƒ¼ãƒ‰ç¯€ã¨ã„ã†ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š 02-02. ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã®æ¤œè¨¼ ç­‰ä¾¡æ¼”ç®—å­ ãƒ»ã‚¤ã‚³ãƒ¼ãƒ«ãŒ2ã¤ã®å ´åˆ åŒã˜ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‹ã‚‰åˆ¥ã€…ã«ä½œã‚‰ã‚ŒãŸã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã§ã‚ã£ã¦ã‚‚ï¼Œã€åŒã˜ã‚‚ã®ã€ã¨ã—ã¦èªè­˜ã•ã‚Œã‚‹ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š ãƒ»ã‚¤ã‚³ãƒ¼ãƒ«ãŒ3ã¤ã®å ´åˆ åŒã˜ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‹ã‚‰åˆ¥ã€…ã«ä½œã‚‰ã‚ŒãŸã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã§ã‚ã£ã¦ã‚‚ï¼Œã€ç•°ãªã‚‹ã‚‚ã®ã€ã¨ã—ã¦èªè­˜ã•ã‚Œã‚‹ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š åŒä¸€ã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã®å ´åˆã®ã¿ï¼Œã€åŒã˜ã‚‚ã®ã€ã¨ã—ã¦èªè­˜ã•ã‚Œã‚‹ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š "},"public/software/software_application_backend_php_logic_error_and_error_handling.html":{"url":"public/software/software_application_backend_php_logic_error_and_error_handling.html","title":"ğŸ“– ï¸ã‚¨ãƒ©ãƒ¼ã¨ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°","keywords":"","body":"ã‚¨ãƒ©ãƒ¼ã¨ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚° ã¯ã˜ã‚ã« æœ¬ã‚µã‚¤ãƒˆã«ã¤ãã¾ã—ã¦ï¼Œä»¥ä¸‹ã‚’ã”èªè­˜ã®ã»ã©å®œã—ããŠé¡˜ã„ã„ãŸã—ã¾ã™ï¼ https://hiroki-it.github.io/tech-notebook-gitbook/ 01. ã‚¨ãƒ©ãƒ¼ã¨ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚° ã‚¨ãƒ©ãƒ¼ã¨ã¯ ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã®å®Ÿè¡ŒãŒå¼·åˆ¶åœæ­¢ã•ã‚Œã‚‹ãƒ©ãƒ³ã‚¿ã‚¤ãƒ ã‚¨ãƒ©ãƒ¼ï¼ˆå®Ÿè¡Œæ™‚ã‚¨ãƒ©ãƒ¼ï¼‰ï¼Œåœæ­¢ã›ãšã«ç¶šè¡Œã•ã‚Œã‚‹éãƒ©ãƒ³ã‚¿ã‚¤ãƒ ã‚¨ãƒ©ãƒ¼ï¼Œã«åˆ†é¡ã•ã‚Œã‚‹ï¼ ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã¨ã¯ ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã¯ä»¥ä¸‹ã®ï¼”ã‚¹ãƒ†ãƒƒãƒ—ã‹ã‚‰ãªã‚‹ï¼ ã‚¨ãƒ©ãƒ¼æ¤œå‡º ä¾‹å¤–ã‚¹ãƒ­ãƒ¼ ä¾‹å¤–ã‚­ãƒ£ãƒƒãƒ ãƒ­ã‚®ãƒ³ã‚° 01-02. ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã®æ„ç¾© ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã«ã¨ã£ã¦ ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ›´æ–°ç³»ã®å‡¦ç†ã®é€”ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã™ã‚‹ã¨ï¼Œãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãŒä¸­é€”åŠç«¯ãªæ›´æ–°çŠ¶æ…‹ã«ãªã£ã¦ã—ã¾ã†ï¼ãã®ãŸã‚ï¼Œãƒ¡ã‚½ãƒƒãƒ‰ã‚³ãƒ¼ãƒ«ã—ãŸã‚¯ãƒ©ã‚¹ã§ã‚¨ãƒ©ãƒ¼ã‚’æ¤œå‡ºã—ï¼Œã“ã‚Œã‚’ãã£ã‹ã‘ã«ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯å‡¦ç†ã‚’å®Ÿè¡Œã™ã‚‹å¿…è¦ãŒã‚ã‚‹ï¼ãªãŠï¼Œä¸‹å±¤ã‚¯ãƒ©ã‚¹ã®ã‚¨ãƒ©ãƒ¼ã®å†…å®¹è‡ªä½“ã¯æ¡ã‚Šã¤ã¶ã•ãšã«ï¼Œã‚¹ã‚¿ãƒƒã‚¯ãƒˆãƒ¬ãƒ¼ã‚¹ã¨ã—ã¦ãƒ¡ã‚½ãƒƒãƒ‰ã‚³ãƒ¼ãƒ«ã—ãŸã‚¯ãƒ©ã‚¹ã§ãƒ­ã‚®ãƒ³ã‚°ã—ã¦ãŠãï¼ ã‚·ã‚¹ãƒ†ãƒ é–‹ç™ºè€…ã«ã¨ã£ã¦ ã‚¨ãƒ©ãƒ¼ãŒç”»é¢ä¸Šã«è¿”å´ã•ã‚ŒãŸã¨ã—ã¦ã‚‚ï¼Œã“ã‚Œã¯ã‚·ã‚¹ãƒ†ãƒ é–‹ç™ºè€…ã«ã¨ã£ã¦ã‚ã‹ã‚Šã«ãã„ï¼ãã®ãŸã‚ï¼Œã‚¨ãƒ©ãƒ¼ã‚’ãƒ¡ã‚½ãƒƒãƒ‰ã‚³ãƒ¼ãƒ«ã—ãŸã‚¯ãƒ©ã‚¹ã§æ¤œå‡ºã—ï¼Œã‚·ã‚¹ãƒ†ãƒ é–‹ç™ºè€…ã«ã‚ã‹ã‚‹è¨€è‘‰ã«å¤‰æ›ã—ãŸä¾‹å¤–ã¨ã—ã¦ã‚¹ãƒ­ãƒ¼ã™ã‚‹å¿…è¦ãŒã‚ã‚‹ï¼ãªãŠï¼Œä¸‹å±¤ã‚¯ãƒ©ã‚¹ã®ã‚¨ãƒ©ãƒ¼è‡ªä½“ã¯æ¡ã‚Šã¤ã¶ã•ãšã«ï¼Œã‚¹ã‚¿ãƒƒã‚¯ãƒˆãƒ¬ãƒ¼ã‚¹ã¨ã—ã¦ãƒ¡ã‚½ãƒƒãƒ‰ã‚³ãƒ¼ãƒ«ã—ãŸã‚¯ãƒ©ã‚¹ã§ãƒ­ã‚®ãƒ³ã‚°ã—ã¦ãŠãï¼ ãƒ¦ãƒ¼ã‚¶ã«ã¨ã£ã¦ ã‚¨ãƒ©ãƒ¼ãŒç”»é¢ä¸Šã«è¿”å´ã•ã‚ŒãŸã¨ã—ã¦ã‚‚ï¼Œãƒ¦ãƒ¼ã‚¶ã«ã¨ã£ã¦ã¯ä½•ãŒèµ·ãã¦ã„ã‚‹ã®ã‹ã‚ã‹ã‚‰ãªã„ï¼ã¾ãŸï¼Œã‚¨ãƒ©ãƒ¼ã‚’ãƒ¡ã‚½ãƒƒãƒ‰ã‚³ãƒ¼ãƒ«ã—ãŸã‚¯ãƒ©ã‚¹ã§æ¤œå‡ºã—ï¼Œä¾‹å¤–ã¨ã—ã¦ã‚¹ãƒ­ãƒ¼ã—ãŸã¨ã—ã¦ã‚‚ï¼Œã‚·ã‚¹ãƒ†ãƒ é–‹ç™ºè€…ã«ã¨ã£ã¦ã¯ç†è§£ã§ãã‚‹ãŒï¼Œãƒ¦ãƒ¼ã‚¶ã«ã¨ã£ã¦ã¯ç†è§£ã§ããªã„ï¼ãã®ãŸã‚ï¼Œä¾‹å¤–ã‚¹ãƒ­ãƒ¼ã‚’åˆ¥ã®è­˜åˆ¥å­ï¼ˆä¾‹ãˆã°çœŸå½å€¤ï¼‰ã«å¤‰ãˆã¦ãƒ¡ã‚½ãƒƒãƒ‰ã‚³ãƒ¼ãƒ«ã—ãŸã‚¯ãƒ©ã‚¹ã«æŒã¡ä¸Šã’ï¼Œæœ€çµ‚çš„ã«ã¯ï¼Œã“ã‚Œã‚’ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ãªã©ã§ã‚ã‹ã‚Šã‚„ã™ãé€šçŸ¥ã™ã‚‹å¿…è¦ãŒã‚ã‚‹ï¼ã“ã‚Œã‚‰ã¯ï¼Œã‚µãƒ¼ãƒã‚µã‚¤ãƒ‰ã®try-catch-finallyæ–‡ã‚„ï¼Œãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã®ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—å‡¦ç†ã§å®Ÿç¾ã™ã‚‹ï¼ãªãŠï¼Œä¸‹æµã‚¯ãƒ©ã‚¹ã®ã‚¨ãƒ©ãƒ¼è‡ªä½“ã¯æ¡ã‚Šã¤ã¶ã•ãšã«ï¼Œã‚¹ã‚¿ãƒƒã‚¯ãƒˆãƒ¬ãƒ¼ã‚¹ã¨ã—ã¦ãƒ¡ã‚½ãƒƒãƒ‰ã‚³ãƒ¼ãƒ«ã—ãŸã‚¯ãƒ©ã‚¹ã§ãƒ­ã‚®ãƒ³ã‚°ã—ã¦ãŠãï¼ 01-03. ä¾‹å¤–ã®å®šç¾© æ¨™æº–ä¾‹å¤–ã‚¯ãƒ©ã‚¹ ã„ãšã‚Œã‚‚Throwableã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã‚’å®Ÿè£…ã—ã¦ã„ã‚‹ï¼ä»¥ä¸‹ãƒªãƒ³ã‚¯ã‚’å‚è€ƒã«ã›ã‚ˆï¼ å‚è€ƒï¼šhttps://www.php.net/manual/ja/reserved.exceptions.php ç‹¬è‡ªä¾‹å¤–ã‚¯ãƒ©ã‚¹ ãƒ»å®šç¾© ã‚¨ãƒ©ãƒ¼ã®ç¨®é¡ã«åˆã‚ã›ã¦ï¼ŒExceptionã‚¯ãƒ©ã‚¹ã‚’ç¶™æ‰¿ã—ãŸç‹¬è‡ªä¾‹å¤–ã‚¯ãƒ©ã‚¹ã‚’å®Ÿè£…ã—ï¼Œä½¿ã„åˆ†ã‘ã‚‹ã¨ã‚ˆã„ï¼__constructãƒ¡ã‚½ãƒƒãƒ‰ã«ï¼Œãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚„ã‚¨ãƒ©ãƒ¼ã‚³ãƒ¼ãƒ‰ï¼ˆä¾‹å¤–ã‚³ãƒ¼ãƒ‰ï¼‰ãªã©ã‚’æ¸¡ã›ã‚‹ï¼ã‚¨ãƒ©ãƒ¼ã‚³ãƒ¼ãƒ‰ã®æ¨™æº–å€¤ã¯ã‚¼ãƒ­ã§ã‚ã‚‹ï¼ å‚è€ƒï¼šhttps://www.php.net/manual/ja/exception.construct.php ã‚¨ãƒ©ãƒ¼ã‚³ãƒ¼ãƒ‰ã¯ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚³ãƒ¼ãƒ‰ã¨ç•°ãªã‚Šï¼Œä¾‹å¤–ã‚’è­˜åˆ¥ã™ã‚‹ãŸã‚ã®ã‚‚ã®ã§ã‚ã‚‹ï¼ç•°å¸¸ç³»ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã®ã‚¨ãƒ©ãƒ¼ã‚³ãƒ¼ãƒ‰ãƒ‡ãƒ¼ã‚¿ã¨ã—ã¦ä½¿ç”¨ã•ã‚Œã‚‹ï¼æ··ä¹±ã‚’é¿ã‘ã‚‹ãŸã‚ï¼Œä¾‹å¤–ã‚¯ãƒ©ã‚¹ã®ã‚¨ãƒ©ãƒ¼ã‚³ãƒ¼ãƒ‰å€¤ã«ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚³ãƒ¼ãƒ‰ã‚’å‰²ã‚Šå½“ã¦ãªã„ã‚ˆã†ã«ã™ã‚‹ï¼ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚³ãƒ¼ãƒ‰ã¯ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ã«ãŠã‘ã‚‹ãƒ¬ã‚¹ãƒãƒ³ã‚¹å‡¦ç†ã§å‰²ã‚Šå½“ã¦ã‚‹ï¼ å‚è€ƒï¼šhttps://hiroki-it.github.io/tech-notebook-gitbook/public/software/software_application_collaboration_api_restful.html ï¼Šå®Ÿè£…ä¾‹ï¼Š ã€Fooå¤‰æ•°ãŒè¦‹ã¤ã‹ã‚‰ãªã„ã€ã¨ã„ã†ã‚¨ãƒ©ãƒ¼ã«å¯¾å¿œã™ã‚‹ä¾‹å¤–ã‚¯ãƒ©ã‚¹ã‚’å®šç¾©ã™ã‚‹ï¼ ãƒ»å‘½åè¦å‰‡ ä½•ã®ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ãŸã‹ã‚’åˆ¤æ–­ã§ãã‚‹ã‚ˆã†ã«ï¼Œåå‰ã¯ã€Exceptionã€ã¨ã™ã‚‹ï¼ã¾ãŸï¼Œé–‹ç™ºè€…ã«ã¨ã£ã¦è©³ã—ãç†è§£ã§ãã‚‹ã‚ˆã†ã«ï¼Œã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ã®å¼•æ•°ã«ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’æ¸¡ã™ï¼ ï¼ˆä¾‹ï¼‰InvalidArgumentExceptionï¼Œ å‚è€ƒï¼šhttps://bartlomiej-kielbasa.medium.com/how-to-name-exceptions-its-not-so-obvious-df104014166a 02. ã‚¨ãƒ©ãƒ¼æ¤œå‡ºã¨ä¾‹å¤–ã‚¹ãƒ­ãƒ¼ ã‚¨ãƒ©ãƒ¼æ¤œå‡ºã¨ä¾‹å¤–ã‚¹ãƒ­ãƒ¼ã®ç¨®é¡ ãƒ»ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã®æ¨™æº–æ©Ÿèƒ½ å¤šãã®ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã§ã¯ï¼Œãƒ©ãƒ³ã‚¿ã‚¤ãƒ ã‚¨ãƒ©ãƒ¼ã‚„éãƒ©ãƒ³ã‚¿ã‚¤ãƒ ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã™ã‚‹ã¨ï¼Œãã‚Œã‚’æ¤œçŸ¥ã—ã¦ï¼Œä¾‹å¤–ã‚’ã‚¹ãƒ­ãƒ¼ã—ã¦ãã‚Œã‚‹ï¼ ãƒ»ç‹¬è‡ªå®šç¾© if-throwæ–‡ã‚’ä½¿ç”¨ã—ã¦ï¼Œã‚¨ãƒ©ãƒ¼æ¤œå‡ºã¨ä¾‹å¤–ã‚¹ãƒ­ãƒ¼ã‚’å®Ÿè¡Œã™ã‚‹ï¼ãƒ©ãƒ³ã‚¿ã‚¤ãƒ ã‚¨ãƒ©ãƒ¼ã¯æ¤œå‡ºã§ããªã„ã“ã¨ã«æ³¨æ„ã™ã‚‹ï¼ç‰¹å®šã®å‡¦ç†ã®ä¸­ã«ï¼Œæƒ³å®šã§ãã‚‹ä¾‹å¤–ãŒã‚ã‚Šï¼Œãã‚Œã‚’ä¾‹å¤–ã‚¯ãƒ©ã‚¹ã¨ã—ã¦ã™ã‚‹ãŸã‚ã«ç”¨ã„ã‚‹ï¼ã“ã“ã§ã¯ï¼Œå…¨ã¦ã®ä¾‹å¤–ã‚¯ãƒ©ã‚¹ã®è¦ªã‚¯ãƒ©ã‚¹ã§ã‚ã‚‹Exceptionã‚¯ãƒ©ã‚¹ã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’æŠ•ã’ã¦ã„ã‚‹ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š ãŸã ã—ï¼Œif-throwã§ã¯ï¼Œéƒ½åº¦ä¾‹å¤–ã‚’æ¤œè¨¼ã™ã‚‹ãŒã‚ã‚Šï¼Œæ§˜ã€…ãªå¯èƒ½æ€§ã‚’è€ƒæ…®ã—ãªã‘ã‚Œã°ã„ã‘ãªããªã‚‹ï¼ ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã«ãŠã‘ã‚‹å±¤åˆ¥ã®ä¾‹å¤–ã‚¹ãƒ­ãƒ¼ å±¤åˆ¥ã®ä¾‹å¤–ã«ã¤ã„ã¦ã¯ï¼Œä»¥ä¸‹ã‚’å‚è€ƒã«ã›ã‚ˆï¼ å‚è€ƒï¼šhttps://hiroki-it.github.io/tech-notebook-gitbook/public/software/software_application_architecture_backend_domain_driven_design.html 03. ä¾‹å¤–ã‚­ãƒ£ãƒƒãƒ ä¾‹å¤–ã‚­ãƒ£ãƒƒãƒã®æ–¹æ³• ãƒ»try-catch-finallyæ–‡ã¨ã¯ try-catch-finallyæ–‡ã§ã¯ï¼Œç‰¹å®šã®å‡¦ç†ã®ä¸­ã§èµ·ã“ã‚‹æƒ³å®šã§ããªã„ä¾‹å¤–ã‚’æ‰ãˆã‚‹ã“ã¨ãŒã§ãã‚‹ï¼å®šç¾©ã•ã‚ŒãŸã‚¨ãƒ©ãƒ¼æ–‡ã¯ï¼Œãƒ‡ãƒãƒƒã‚¯ç”»é¢ã«è¡¨ç¤ºã•ã‚Œã‚‹ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š finallyå¥ã¯ï¼Œtryå¥ã‚„catchå¥ã®è¿”å´å‡¦ç†ãŒè¡Œã‚ã‚Œã‚‹ç›´å‰ã«å®Ÿè¡Œã•ã‚Œã‚‹ãŸã‚ï¼Œfinallyå¥ã§ã¯ï¼Œreturnã‚„continueã‚’ä½¿ç”¨ã—ãªã„ã‚ˆã†ã«ã™ã‚‹ï¼ ï¼ˆï¼‘ï¼‰ï½ï¼ˆï¼”ï¼‰ã®ã„ãšã‚Œã‹ã§è¿”å´ã•ã‚Œã‚‹æ™‚ï¼Œè¿”å´ã®ç›´å‰ã«finallyå¥ãŒå®Ÿè¡Œã•ã‚Œã‚‹ã“ã¨ãŒã‚ã‹ã‚‹ï¼ // ï¼ˆï¼‘ï¼‰ã®å ´åˆ // Aã®ç›´å‰ã§ã™ï¼ // Eã§ã™ï¼ // Aã§ã™ï¼ // ï¼ˆï¼’ï¼‰ã®å ´åˆ // Bã®ç›´å‰ã§ã™ï¼ // Eã§ã™ï¼ // Bã§ã™ï¼ // ï¼ˆï¼“ï¼‰ã®å ´åˆ // Cã®ç›´å‰ã§ã™ï¼ // Eã§ã™ï¼ // Cã§ã™ï¼ // ï¼ˆï¼”ï¼‰ã®å ´åˆ // Dã®ç›´å‰ã§ã™ï¼ // Eã§ã™ï¼ // Dã§ã™ï¼ æ–°ãŸãªä¾‹å¤–ã®ã‚¹ãƒ­ãƒ¼ã—ç›´ã— ä¾‹å¤–ã‚’try-catchæ–‡ã§ã‚­ãƒ£ãƒƒãƒã—ãŸå¾Œï¼Œåˆ¥ã®æ–°ã—ã„ä¾‹å¤–ã‚’ã‚¹ãƒ­ãƒ¼ã—ã¦ã‚‚ã‚ˆã„ï¼ãã®å ´åˆã¯ï¼Œä¾‹å¤–ã®ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ã®ç¬¬ä¸‰å¼•æ•°ï¼ˆpreviousï¼‰ã‚’ä½¿ç”¨ã—ã¦ï¼Œå…ƒã€…ã‚­ãƒ£ãƒƒãƒã•ã‚Œã¦ã„ãŸä¾‹å¤–ã‚‚æ¤œçŸ¥ã§ãã‚‹ã‚ˆã†ã«ã™ã‚‹ï¼ã¡ãªã¿ã«ï¼Œã“ã®ä¾‹å¤–ã‚’ãƒ­ã‚®ãƒ³ã‚°ã™ã‚‹å ´åˆï¼Œã‚¹ã‚¿ãƒƒã‚¯ãƒˆãƒ¬ãƒ¼ã‚¹ãƒ­ã‚°ã¨ã—ã¦å‡ºåŠ›ã•ã‚Œã‚‹ï¼ å‚è€ƒï¼š http://blog.tojiru.net/article/455279557.html https://www.php.net/manual/ja/exception.construct.php ä¾‹å¤–ã‚­ãƒ£ãƒƒãƒã®ãƒ¬ã‚¤ãƒ¤ãƒ¼ ãƒ»ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ï¼ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢æ´¾ æƒ³å®šå¤–ã®ã‚¨ãƒ©ãƒ¼ã‚‚å«ã‚ã¦ï¼Œå…¨ã¦ã®ã‚¨ãƒ©ãƒ¼ã‚’æ¤œå‡ºã§ãã‚‹ã‚ˆã†ã«ï¼Œã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ã¾ãŸã¯ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢ã«try-catchæ–‡ã‚’å®Ÿè£…ã™ã‚‹ï¼ å‚è€ƒï¼š https://www.reddit.com/r/dotnet/comments/kyoe83/web_api_trycatch_in_controller_or_not/ https://softwareengineering.stackexchange.com/questions/393307/where-would-you-handle-exceptions-controller-service-repository ãƒ»ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹æ´¾ ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ã®å®Ÿè£…ã‚’ã‚ˆã‚Šå˜ç´”ã«ã™ã‚‹ã¹ãï¼Œã‚ˆã‚Šä¸‹ä½ã®ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹ã«try-catchæ–‡ã‚’å®Ÿè£…ã™ã‚‹ï¼ å‚è€ƒï¼šhttps://www.reddit.com/r/dotnet/comments/kyoe83/web_api_trycatch_in_controller_or_not/ 04. ãƒ­ã‚®ãƒ³ã‚° ãƒ­ã‚®ãƒ³ã‚°é–¢æ•° ãƒ»error_logé–¢æ•° å‚è€ƒï¼šhttps://www.php.net/manual/ja/function.error-log.php error_log( \"\", \"\", \"\" ) ï¼Šå®Ÿè£…ä¾‹ï¼Š getMessage(), $exception->getFile(), $exception->getLine() ), 3, __DIR__ . \"/error.log\" ); } } } ä»–ã«ï¼ŒLoggerã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã‚’ä½¿ç”¨ã™ã‚‹ã“ã¨ã‚‚å¤šã„ï¼ å‚è€ƒï¼šhttps://github.com/php-fig/log logger = $logger; } public function sendMessage() { try { // ä¸‹æµã‚¯ãƒ©ã‚¹ã«ã‚ˆã‚‹ä¾‹å¤–ã‚¹ãƒ­ãƒ¼ã‚’å«ã‚€å‡¦ç† } catch (\\exception $exception) { $this->logger->error(sprintf( \"ERROR: %s at %s line %s\", $exception->getMessage(), $exception->getFile(), $exception->getLine() )); } } } ãƒ­ã‚®ãƒ³ã‚°ã®ãƒ¬ã‚¤ãƒ¤ãƒ¼ try-catchæ–‡ã«ä¼´ã†ãƒ­ã‚®ãƒ³ã‚°ã®å ´åˆï¼Œcatchå¥ã®ä¸­ã§ã“ã‚Œã‚’å®Ÿè¡Œã™ã‚‹ï¼ãã®ãŸã‚ï¼Œãƒ­ã‚®ãƒ³ã‚°ã‚’å®Ÿè¡Œã™ã‚‹ãƒ¬ã‚¤ãƒ¤ãƒ¼ã¯tray-catchæ–‡ã®ãƒ¬ã‚¤ãƒ¤ãƒ¼ã¨åŒã˜ã«ãªã‚‹ï¼ ç¨®é¡åˆ¥ã®æŒ¯ã‚Šåˆ†ã‘ ãƒ»ä¾‹å¤–ã”ã¨ã®ãƒ­ã‚®ãƒ³ã‚° ä¾‹ãˆã°ï¼Œãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚¢ãƒ—ãƒªã®APIã«å¯¾ã—ã¦ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ç”Ÿæˆã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é€ä¿¡ã™ã‚‹æ™‚ï¼Œä¾‹å¤–ã®ç¨®é¡ã«åˆã‚ã›ã¦ï¼Œå¤–éƒ¨APIã¨ã®æ¥ç¶šå¤±æ•—ã«ã‚ˆã‚‹ã‚¨ãƒ©ãƒ¼ãƒ­ã‚°ã‚’ç”Ÿæˆã¨ï¼Œè‡ªç¤¾ã‚·ã‚¹ãƒ†ãƒ ãªã©ãã®ä»–åŸå› ã«ã‚ˆã‚‹ã‚¨ãƒ©ãƒ¼ãƒ­ã‚°ã‚’ç”Ÿæˆã‚’è¡Œã†å¿…è¦ãŒã‚ã‚‹ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š logger->error(sprintf( \"ERROR: %s at %s line %s\", $exception->getMessage(), $exception->getFile(), $exception->getLine() )); } catch (\\ExternalApiErrorException $exception) { // ä¸‹æµã‚¯ãƒ©ã‚¹ã«ã‚ˆã‚‹ä¾‹å¤–ã‚¹ãƒ­ãƒ¼ã‚’å«ã‚€å‡¦ç† // å¤–éƒ¨APIã®ã‚·ã‚¹ãƒ†ãƒ ã‚¨ãƒ©ãƒ¼ã‚’ãƒ­ã‚®ãƒ³ã‚° $this->logger->error(sprintf( \"ERROR: %s at %s line %s\", $exception->getMessage(), $exception->getFile(), $exception->getLine() )); } catch (\\Exception $exception) { // ä¸‹æµã‚¯ãƒ©ã‚¹ã«ã‚ˆã‚‹ä¾‹å¤–ã‚¹ãƒ­ãƒ¼ã‚’å«ã‚€å‡¦ç† // ãã®ä»–ï¼ˆè‡ªç¤¾ã‚·ã‚¹ãƒ†ãƒ ãªã©ï¼‰ã«ã‚ˆã‚‹ã‚¨ãƒ©ãƒ¼ã‚’ãƒ­ã‚®ãƒ³ã‚° $this->logger->error(sprintf( \"ERROR: %s at %s line %s\", $exception->getMessage(), $exception->getFile(), $exception->getLine() )); } // å•é¡Œãªã‘ã‚Œã°TRUEã‚’è¿”å´ï¼ return true; } } "},"public/software/software_application_backend_php_logic_iteration.html":{"url":"public/software/software_application_backend_php_logic_iteration.html","title":"ğŸ“– ï¸åå¾©ãƒ­ã‚¸ãƒƒã‚¯","keywords":"","body":"åå¾©ãƒ­ã‚¸ãƒƒã‚¯ ã¯ã˜ã‚ã« æœ¬ã‚µã‚¤ãƒˆã«ã¤ãã¾ã—ã¦ï¼Œä»¥ä¸‹ã‚’ã”èªè­˜ã®ã»ã©å®œã—ããŠé¡˜ã„ã„ãŸã—ã¾ã™ï¼ å‚è€ƒï¼šhttps://hiroki-it.github.io/tech-notebook-gitbook/ 01. åå¾©å¯¾è±¡ã®ãƒ‡ãƒ¼ã‚¿ é…åˆ— ãƒ»èµ°æŸ»ï¼ˆã‚¹ã‚­ãƒ£ãƒ³ï¼‰ é…åˆ—å†…ã®è¦ç´ ã‚’é †ã«èª¿ã¹ã¦ã„ãã“ã¨ã‚’ã€èµ°æŸ»ï¼ˆã‚¹ã‚­ãƒ£ãƒ³ï¼‰ã€ã¨ã„ã†ï¼ä¾‹ãˆã°ï¼Œforeachã¯ï¼Œé…åˆ—å†…ã®å…¨ã¦ã®è¦ç´ ã‚’èµ°æŸ»ã™ã‚‹å‡¦ç†ã§ã‚ã‚‹ï¼ä¸‹å›³ã§ã¯ï¼Œé€£æƒ³é…åˆ—ãŒè¡¨ç¾ã•ã‚Œã¦ã„ã‚‹ï¼ ãƒ»å†…éƒ¨ãƒã‚¤ãƒ³ã‚¿ã¨é…åˆ—ã®é–¢ä¿‚ ã€å†…éƒ¨ãƒã‚¤ãƒ³ã‚¿ã€ã¨ã¯ï¼ŒPHPã®é…åˆ—ã«ãŠã„ã¦ï¼Œå‚ç…§ã—ãŸã„è¦ç´ ã‚’ä½ç½®ã§æŒ‡å®šã™ã‚‹ãŸã‚ã®ã‚«ãƒ¼ã‚½ãƒ«ã®ã“ã¨ï¼Goã«ãŠã‘ã‚‹ãƒã‚¤ãƒ³ã‚¿ã¯ï¼Œä»¥ä¸‹ã‚’å‚è€ƒã«ã›ã‚ˆï¼ å‚è€ƒï¼šhttps://hiroki-it.github.io/tech-notebook-gitbook/public/software/software_application_backend_go_logic_method_data.html ï¼Šå®Ÿè£…ä¾‹ï¼Š 02. foreach æ–‡æ³• ãƒ»åŸºæœ¬ é…åˆ—ã‚’èµ°æŸ»ã™ã‚‹ï¼ ãƒ»åˆ¶å¾¡æ–‡ 0) { $sum += $x; } } ä¸€æ¬¡å…ƒé…åˆ—ã®èµ°æŸ» ãƒ»é…åˆ—é–¢æ•° è¤‡é›‘ãªèµ°æŸ»ã‚’è¡Œã†ãŸã‚ã«ï¼Œçµ„ã¿è¾¼ã¿é–¢æ•°ãŒç”¨æ„ã•ã‚Œã¦ã„ã‚‹ï¼ https://www.php.net/manual/ja/ref.array.php ãƒ»é…åˆ—ã®å€¤ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹ å˜ã«é…åˆ—ã‚’ä½œã‚‹ã ã‘ã§ãªãï¼Œè¦ç´ ã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ãŸã‚ã«ã‚‚ä½¿ã‚ã‚Œã‚‹ï¼ name() == 'ã‚ªãƒ—ã‚·ãƒ§ãƒ³A') { $result = 'ã‚ªãƒ—ã‚·ãƒ§ãƒ³AãŒè¨­å®šã•ã‚Œã¦ã„ã¾ã™ï¼'; } if ($option->name() == 'ã‚ªãƒ—ã‚·ãƒ§ãƒ³B') { $result = 'ã‚ªãƒ—ã‚·ãƒ§ãƒ³BãŒè¨­å®šã•ã‚Œã¦ã„ã¾ã™ï¼'; } if ($option->name() == 'ã‚ªãƒ—ã‚·ãƒ§ãƒ³C') { $result = 'ã‚ªãƒ—ã‚·ãƒ§ãƒ³CãŒè¨­å®šã•ã‚Œã¦ã„ã¾ã™ï¼'; } return $result; } return $result; } } ãƒ»é…åˆ—ã®å„å€¤ã‚’åŠ ç®—ä»£å…¥ = $K) { // åŠ ç®—ä»£å…¥ $topesNumber++; // é•·ã•ã‚’å…ƒã«æˆ»ã™ï¼ $currentLength = 0; } } } ãƒ»é…åˆ—ã®å€¤ã‚’å›ºå®š $value) { // vã‚’å›ºå®šã—ã¦ï¼Œä»¥é™ã®vã¨æ¯”è¼ƒã™ã‚‹ï¼ for ($i = $key; $i å¤šæ¬¡å…ƒé…åˆ—ã®èµ°æŸ» ãƒ»äºŒæ¬¡å…ƒé…åˆ—ã‚’ä¸€æ¬¡å…ƒé…åˆ—ã«å¤‰æ› ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯é–¢æ•°ã®ä½¿ç”¨ãŒå¿…è¦ã«ãªã‚‹ï¼call_user_func_arrayãƒ¡ã‚½ãƒƒãƒ‰ã®ç¬¬ä¸€å¼•æ•°ã«ï¼Œã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯é–¢æ•°ã®array_mergeãƒ¡ã‚½ãƒƒãƒ‰ã®æ–‡å­—åˆ—ã‚’æ¸¡ã—ï¼Œç¬¬äºŒå¼•æ•°ã«äºŒæ¬¡å…ƒé…åˆ—ã‚’æ¸¡ã™ï¼ãã®çµæœï¼Œå¹³å¦ã«ãªã£ã¦ä¸€æ¬¡å…ƒé…åˆ—ã«ãªã‚‹ï¼ä¾‹ãˆã°ï¼Œä¸è¦ãªã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ï¼ˆ0ï¼‰ã§å…¥ã‚Œå­ã«ãªã£ã¦ã„ã‚‹å ´åˆã«å½¹ã«ç«‹ã¤ï¼ '2015/11/1', 'score' => 100, 'color' => 'red', ], [ 'date' => '2015/11/2', 'score' => 75, 'color' => 'blue', ] ]; $oneDimension = call_user_func_array( 'array_merge', // äºŒæ¬¡å…ƒé…åˆ— $twoDimension ); ãƒ»å¤šæ¬¡å…ƒé…åˆ—ã§ã‚­ãƒ¼åã‹ã‚‰å€¤ã‚’å–å¾— ï¼Šå®Ÿè£…ä¾‹ï¼Š ä¾‹ãˆã°ï¼Œä»¥ä¸‹ã®ã‚ˆã†ãªå¤šæ¬¡å…ƒé…åˆ—ãŒã‚ã£ãŸã¨ã™ã‚‹ï¼é…åˆ—ã®scoreã‚­ãƒ¼ã‹ã‚‰å€¤ã‚’å–ã‚Šå‡ºã—ï¼Œä¸€æ¬¡å…ƒé…åˆ—ã‚’ç”Ÿæˆã™ã‚‹ï¼ '2015/11/1', 'score' => 100, 'color' => 'red', ], [ 'date' => '2015/11/2', 'score' => 75, 'color' => 'blue', ] ]; // ã“ã®é…åˆ—ã®scoreã‚­ãƒ¼ã‹ã‚‰å€¤ã‚’å–ã‚Šå‡ºã—ï¼Œä¸€æ¬¡å…ƒé…åˆ—ã‚’ç”Ÿæˆã™ã‚‹ï¼ $oneDimension = array_column($twoDimension, 'score'); // Array // ( // [0] => 100 // [1] => 75 // ) 03. while æ–‡æ³• ãƒ»åŸºæœ¬ é…åˆ—ã®èµ°æŸ»ã‚’å«ã‚€åå¾©å‡¦ç†ã‚’è¡Œã†ï¼ãŸã ã—ï¼Œé…åˆ—ã®èµ°æŸ»ã¯ï¼Œwhileã§ã¯ãªãforeachã‚’ç”¨ã„ã‚‹ã‚ˆã†ã«ã™ã‚‹ï¼ã¾ãŸï¼Œforã¨ã¯ç•°ãªã‚Šï¼Œåå¾©å›æ•°ãŒæ±ºã¾ã£ã¦ã„ãªã„å ´åˆã«ä½¿ç”¨ã™ã‚‹ï¼ ãƒ»åˆ¶å¾¡æ–‡ 0) { $sum += $x; } // ä»£å…¥åŠ ç®— $count ++; } ç„¡é™ãƒ«ãƒ¼ãƒ— ãƒ»ç„¡é™ãƒ«ãƒ¼ãƒ—ã¨ã¯ åå¾©å‡¦ç†ã§ã¯ï¼Œä½•ã‚‰ã‹ã®çŠ¶æ…‹ã«ãªã£ãŸæ™‚ã«åå¾©å‡¦ç†ã‚’çµ‚ãˆãªã‘ã‚Œã°ãªã‚‰ãªã„ï¼ã—ã‹ã—ï¼Œçµ‚ãˆã‚‹ã“ã¨ãŒã§ããªã„ã¨ï¼Œç„¡é™ãƒ«ãƒ¼ãƒ—ãŒç™ºç”Ÿã—ã¦ã—ã¾ã†ï¼ 04. for æ–‡æ³• ãƒ»åŸºæœ¬ é…åˆ—ã®èµ°æŸ»ã‚’å«ã‚€åå¾©å‡¦ç†ã‚’è¡Œã†ï¼ãŸã ã—ï¼Œé…åˆ—ã®èµ°æŸ»ã¯ï¼Œforã§ã¯ãªãforeachã‚’ç”¨ã„ã‚‹ã‚ˆã†ã«ã™ã‚‹ï¼ã¾ãŸï¼Œwhileã¨ã¯ç•°ãªã‚Šï¼Œåå¾©å›æ•°ãŒæ±ºã¾ã£ã¦ã„ã‚‹å ´åˆã«ä½¿ç”¨ã™ã‚‹ï¼ ãƒ»åˆ¶å¾¡æ–‡ 0) { $sum += $x; } } echo $sum; // 1 05. åå¾©å›æ•°ã®å¤‰æ›´ continue ãƒ»continueã¨ã¯ åå¾©å‡¦ç†ã®ç¾åœ¨ã®ãƒ«ãƒ¼ãƒ—ã‚’ã‚¹ã‚­ãƒƒãƒ—ã—ï¼Œæ¬¡ã®ãƒ«ãƒ¼ãƒ—ã‚’é–‹å§‹ã™ã‚‹ï¼ $value) { // ã‚­ãƒ¼ãŒå¶æ•°ã®çµ„ã‚’ã‚¹ã‚­ãƒƒãƒ—ã™ã‚‹ï¼ if (!($key % 2 == 0)) { continue; } echo $value . 'ã¯å¥‡æ•°ã§ã™' . \"\\n\"; } // 1ã¯å¥‡æ•°ã§ã™ // 3ã¯å¥‡æ•°ã§ã™ // 5ã¯å¥‡æ•°ã§ã™ ãƒ»array_walkã‚’ä½¿ç”¨ã—ãŸä»£æ›¿æ³• åå¾©å‡¦ç†ã®ãƒ«ãƒ¼ãƒ—ã‚’continueã§ã‚¹ã‚­ãƒƒãƒ—ã¨åŒã˜å‹•ä½œã‚’ï¼Œé…åˆ—ã‚’æ‰±ã†é–¢æ•°ã®ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯é–¢æ•°ã§æ—©æœŸãƒªã‚¿ãƒ¼ãƒ³ã§å®Ÿç¾ã§ãã‚‹ï¼continueã‚’ä½¿ç”¨ã™ã‚‹ã‚ˆã‚Šï¼Œã“ã¡ã‚‰ã®æ–¹ãŒè‰¯ã„ï¼ break ãƒ»breakã¨ã¯ åå¾©å‡¦ç†ã®ç¾åœ¨ã®ãƒ«ãƒ¼ãƒ—ã‚’åœæ­¢ã—ï¼Œä»¥é™ã®ãƒ«ãƒ¼ãƒ—ã‚‚å®Ÿè¡Œã—ãªã„ï¼ "},"public/software/software_application_backend_php_logic_algorithm.html":{"url":"public/software/software_application_backend_php_logic_algorithm.html","title":"ğŸ“– ï¸ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ","keywords":"","body":"ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ãƒ­ã‚¸ãƒƒã‚¯ ã¯ã˜ã‚ã« æœ¬ã‚µã‚¤ãƒˆã«ã¤ãã¾ã—ã¦ï¼Œä»¥ä¸‹ã‚’ã”èªè­˜ã®ã»ã©å®œã—ããŠé¡˜ã„ã„ãŸã—ã¾ã™ï¼ å‚è€ƒï¼šhttps://hiroki-it.github.io/tech-notebook-gitbook/ 01. ä¸¦ã³æ›¿ãˆã®ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ  ä¾‹ãˆã°ï¼Œæ¬¡ã®ã‚ˆã†ãªè¡¨ã§ã¯ï¼Œã©ã®ã‚ˆã†ãªä»•çµ„ã¿ã§ã€Œæ˜‡é †ã€ã€Œé™é †ã€ã¸ã®ä¸¦ã³æ›¿ãˆãŒè¡Œã‚ã‚Œã‚‹ã®ã ã‚ã†ã‹ï¼ åŸºæœ¬é¸æŠæ³•ï¼ˆé¸æŠã‚½ãƒ¼ãƒˆï¼‰ ãƒ»æœ€å°é¸æŠæ³• ï¼Šå®Ÿè£…ä¾‹ï¼Š æ¯”è¼ƒåŸºæº–å€¤ã‚’æ±ºã‚ã‚‹ï¼ æœ€åˆã®æ•°å€¤ã‚’æ¯”è¼ƒåŸºæº–å€¤ã¨ã—ï¼Œnå€‹ã®ä¸­ã‹ã‚‰æœ€ã‚‚å°ã•ã„æ•°å­—ã‚’æ¢ã—ï¼Œãã‚Œã¨å…¥ã‚Œæ›¿ãˆã‚‹ï¼ æ¬¡ã«ï¼Œæ®‹ã‚Šã®n-1å€‹ã®ä¸­ã‹ã‚‰æœ€ã‚‚å°ã•ã„æ•°å­—ã‚’æ¢ã—ï¼Œãã‚Œã‚’2ç•ªç›®ã®æ•°å­—ã¨å…¥ã‚Œæ›¿ãˆã‚‹ï¼ ã“ã®å‡¦ç†ã‚’n-1å›ç¹°ã‚Šè¿”ã™ï¼ $array[$j]){ $position = $j; $min = $array[$j]; } } // æ¯”è¼ƒåŸºæº–å€¤ã®ä½ç½®ãŒæ›´æ–°ã•ã‚Œã¦ã„ãªã‹ã£ãŸå ´åˆï¼Œè¦ªã®foræ–‡ã‹ã‚‰æŠœã‘ã‚‹ï¼ if($i == $position){ break; } // è¦ªã®foræ–‡ã®æœ€å°å€¤ã‚’æ›´æ–°ï¼ $array[$i] = $min; // æ¬¡ã«2ç•ªç›®ã‚’æ¯”è¼ƒåŸºæº–å€¤ã¨ã—ï¼ŒåŒã˜å‡¦ç†ã‚’ç¹°ã‚Šè¿”ã—ã¦ã„ãï¼ } return $array; } ï¼Šã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ è§£èª¬ï¼Š ãƒ‡ãƒ¼ã‚¿ä¸­ã®æœ€å°å€¤ã‚’æ±‚ã‚ï¼Œæ¬¡ã«ãã‚Œã‚’é™¤ã„ãŸéƒ¨åˆ†ã®ä¸­ã‹ã‚‰æœ€å°å€¤ã‚’æ±‚ã‚ã‚‹ï¼ã“ã®æ“ä½œã‚’ç¹°ã‚Šè¿”ã—ã¦ã„ãï¼ ã‚¯ã‚¤ãƒƒã‚¯ã‚½ãƒ¼ãƒˆ ï¼Šå®Ÿè£…ä¾‹ï¼Š é©å½“ãªå€¤ã‚’åŸºæº–å€¤ï¼ˆPivotï¼‰ã¨ã™ã‚‹ ï¼ˆâ€»ã§ãã‚Œã°ä¸­å¤®å€¤ãŒæœ›ã¾ã—ã„ï¼‰ Pivotã‚ˆã‚Šå°ã•ã„æ•°ã‚’å‰æ–¹ï¼Œå¤§ãã„æ•°ã‚’å¾Œæ–¹ã«åˆ†å‰²ã™ã‚‹ï¼ äºŒåˆ†å‰²ã•ã‚ŒãŸå„ã€…ã®ãƒ‡ãƒ¼ã‚¿ã‚’ï¼Œãã‚Œãã‚Œã‚½ãƒ¼ãƒˆã™ã‚‹ï¼ ã‚½ãƒ¼ãƒˆã‚’ç¹°ã‚Šè¿”ã—å®Ÿè¡Œã™ã‚‹ï¼ ï¼Šã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ è§£èª¬ï¼Š é©å½“ãªå€¤ã‚’åŸºæº–å€¤ï¼ˆPivotï¼‰ã¨ã—ï¼Œãã‚Œã‚ˆã‚Šå°ã•ãªå€¤ã®ã‚°ãƒ«ãƒ¼ãƒ—ã¨å¤§ããªå€¤ã®ã‚°ãƒ«ãƒ¼ãƒ—ã«åˆ†å‰²ã™ã‚‹ï¼åŒæ§˜ã«ã—ã¦ï¼Œä¸¡ã‚°ãƒ«ãƒ¼ãƒ—ã®ä¸­ã§Pivotã‚’é¸ã³ï¼ŒäºŒã¤ã®ã‚°ãƒ«ãƒ¼ãƒ—ã«åˆ†å‰²ã™ã‚‹ï¼ã‚°ãƒ«ãƒ¼ãƒ—å†…ã®å€¤ãŒä¸€ã¤ã«ãªã‚‹ã¾ã§ï¼Œã“ã®å‡¦ç†ã‚’ç¹°ã‚Šè¿”ã—ã¦ã„ãï¼ åŸºæœ¬äº¤æ›æ³•ï¼ˆãƒãƒ–ãƒ«ã‚½ãƒ¼ãƒˆï¼‰ éš£ã‚Šåˆã£ãŸãƒ‡ãƒ¼ã‚¿ã®æ¯”è¼ƒã¨å…¥æ›¿ãˆã‚’ç¹°ã‚Šè¿”ã™ã“ã¨ã«ã‚ˆã£ã¦ï¼Œå°ã•ãªå€¤ã®ãƒ‡ãƒ¼ã‚¿ã‚’æ¬¡ç¬¬ã«ç«¯ã®ã»ã†ã«ç§»ã—ã¦ã„ãæ–¹æ³•ï¼ åŸºæœ¬æŒ¿å…¥æ³•ï¼ˆæŒ¿å…¥ã‚½ãƒ¼ãƒˆï¼‰ æ—¢ã«æ•´åˆ—æ¸ˆã¿ã®ãƒ‡ãƒ¼ã‚¿åˆ—ã®æ­£ã—ã„ä½ç½®ã«ï¼Œãƒ‡ãƒ¼ã‚¿ã‚’è¿½åŠ ã™ã‚‹æ“ä½œã‚’ç¹°ã‚Šè¿”ã—ã¦ã„ãæ–¹æ³•ï¼ ãƒ’ãƒ¼ãƒ—ã‚½ãƒ¼ãƒˆ ã‚·ã‚§ãƒ«ã‚½ãƒ¼ãƒˆ 02. é…åˆ—å†…æ¢ç´¢ã®ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ  ç·šå½¢æ¢ç´¢æ³• ä»Šå›ã¯ï¼Œé…åˆ—å†…ã§ã€Œï¼–ã€ã‚’æ¢ã™ï¼ äºŒåˆ†æ¢ç´¢æ³• å‰æã¨ã—ã¦ï¼Œã‚½ãƒ¼ãƒˆã«ã‚ˆã£ã¦ï¼Œã™ã§ã«ãƒ‡ãƒ¼ã‚¿ãŒæ•´åˆ—ã•ã›ã‚‰ã‚Œã¦ã„ã‚‹ã¨ã™ã‚‹ï¼ä»Šå›ã¯ï¼Œé…åˆ—å†…ã§ã€Œï¼–ã€ã‚’æ¢ã™ï¼ 03. ã‚°ãƒ©ãƒ•æ¢ç´¢ã®ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ï¼ˆé›£ã—éãã§è¨˜å…¥é€”ä¸­ï¼‰ ãƒ€ã‚¤ã‚¯ã‚¹ãƒˆãƒ©æ³•ã«ã‚ˆã‚‹æœ€è‰¯å„ªå…ˆæ¢ç´¢ ï¼Šå®Ÿè£…ä¾‹ï¼Š åœ°ç‚¹é–“ã®è·é›¢ã‚’è¡¨ã§è¡¨ã™ï¼ãŸã ã—ï¼ŒåŒåœ°ç‚¹é–“ã®è·é›¢ã¯ã€0ã€ï¼Œéš£ã‚Šåˆã‚ãªã„åœ°ç‚¹é–“ã®è·é›¢ã¯ã€-1ã€ã¨ã™ã‚‹ï¼ array(0, 2, 8, 4, -1, -1, -1), \"P1\" => array(2, 0, -1, -1, 3, -1, -1), \"P2\" => array(8, -1, 0, -1, 2, 3, -1), \"P3\" => array(4, -1, -1, 0, -1, 8, -1), \"P4\" => array(-1, 3, 2, -1, 0, -1, 9), \"P5\" => array(-1, -1, 3, 8, -1, 0, 3), \"P6\" => array(-1, -1, -1, -1, 9, 3, 0) ); ï¼Šæœ€çŸ­çµŒè·¯æ¢ç´¢å‡¦ç†ã®è§£èª¬ï¼Š $startPoint = 0 $goalPoint = 6 ã¨ã—ãŸæ™‚ï¼Œå‡ºç™ºåœ°ç‚¹ï¼ˆ0ï¼‰ã‹ã‚‰1ã‚¹ãƒ†ãƒƒãƒ—è¡Œã‘ã‚‹åœ°ç‚¹ã¾ã§ã®è·é›¢ï¼ˆpDistï¼‰ã‚’å–å¾—ã—ï¼Œç¢ºå®šã•ã›ã‚‹ï¼ ï¼Šã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ è§£èª¬ï¼Š æ­£ã®ã‚³ã‚¹ãƒˆã®çµŒè·¯ã®ã¿ã®å ´åˆï¼Œç”¨ã„ã‚‹ã“ã¨ãŒã§ãã‚‹æ–¹æ³•ï¼ 04. èª¤ã‚Šæ¤œå‡ºã¨è¨‚æ­£ã®ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ  Check Digit Check ãƒãƒ¼ã‚³ãƒ¼ãƒ‰ã‚„ã‚¯ãƒ¬ã‚¸ãƒƒãƒˆã‚«ãƒ¼ãƒ‰ãªã©ã®èª­ã¿å–ã‚Šãƒã‚§ãƒƒã‚¯ã§ä½¿ã‚ã‚Œã¦ã„ã‚‹èª¤ã‚Šæ¤œå‡ºæ–¹æ³•ï¼ Check Digitã‚’ç®—å‡ºã™ã‚‹ï¼ ç®—å‡ºã•ã‚ŒãŸCheck DigitãŒæ­£ã—ã„ã‹ã‚’æ¤œè¨¼ã™ã‚‹ï¼ Parity Check CRCï¼šCyclic Redundancy Checkï¼ˆå·¡å›å†—é•·æ¤œæŸ»ï¼‰ "},"public/software/software_application_backend_php_framework_symfony.html":{"url":"public/software/software_application_backend_php_framework_symfony.html","title":"ğŸ“– ï¸Symfony","keywords":"","body":"Symfony ã¯ã˜ã‚ã« æœ¬ã‚µã‚¤ãƒˆã«ã¤ãã¾ã—ã¦ï¼Œä»¥ä¸‹ã‚’ã”èªè­˜ã®ã»ã©å®œã—ããŠé¡˜ã„ã„ãŸã—ã¾ã™ï¼ å‚è€ƒï¼šhttps://hiroki-it.github.io/tech-notebook-gitbook/ 01. å‚è€ƒã«ãªã‚‹ãƒªãƒ•ã‚¡ãƒ¬ãƒ³ã‚¹ å‚è€ƒï¼šhttps://symfony.com/doc/current/the-fast-track/ja/index.html 01-02. Symfonyã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹æˆ Symfony â”œâ”€â”€ configã€€# è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆã‚«ãƒ¼ãƒãƒ«ã®ãŸã‚ã®ãƒ«ãƒ¼ãƒˆå®šç¾©ãƒ•ã‚¡ã‚¤ãƒ«ç­‰ï¼‰ â”‚ â”œâ”€â”€ binã€€# ã‚³ãƒãƒ³ãƒ‰ãƒ©ã‚¤ãƒ³ãƒ„ãƒ¼ãƒ« â”‚ â”œâ”€â”€ console #bin/consoleã‚³ãƒãƒ³ãƒ‰ã®å®Ÿè¡Œãƒ•ã‚¡ã‚¤ãƒ« â”‚ â””â”€â”€ symfony_requirements â”‚ â”œâ”€â”€ public | â”œâ”€â”€ index.php # æœ¬ç•ªç’°å¢ƒã§ã€ã‚«ãƒ¼ãƒãƒ«ã¨ã—ã¦å‹•ã | â””â”€â”€ index_dev.php # é–‹ç™ºç’°å¢ƒã§ã€ã‚«ãƒ¼ãƒãƒ«ã¨ã—ã¦å‹•ã â”‚ â”œâ”€â”€ srcã€€# ä¸»è¦ãªPHPãƒ•ã‚¡ã‚¤ãƒ« â”‚ â”œâ”€â”€ AppBundle # ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ â”‚ â”‚ â”œâ”€â”€ Controllerã€€# UserCaseå±¤ â”‚ â”‚ â”œâ”€â”€ Entity # ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã€€â‡’ã€€Domainå±¤ â”‚ â”‚ â”œâ”€â”€ Repository # ãƒªãƒã‚¸ãƒˆãƒª â‡’ Infrastructureå±¤ â”‚ â”‚ â”œâ”€â”€ Form # ãƒ•ã‚©ãƒ¼ãƒ  â”‚ â”‚ â””â”€â”€ Resources â”‚ â”‚ â””â”€â”€ views # ç”»é¢ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆï¼ˆâ€»æœ¬æ›¸ã§ã¯æ‰±ã‚ãªã„ï¼‰ â”‚ â”‚ â”‚ â””â”€â”€ ãã®ä»–ã®Bundle # æ±ç”¨çš„ãªãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ï¼ˆâ€»æœ¬æ›¸ã§ã¯æ‰±ã‚ãªã„ï¼‰ | â”œâ”€â”€ templatesã€€# UserInterfaceå±¤ â”‚ â”œâ”€â”€ test # è‡ªå‹•ãƒ†ã‚¹ãƒˆï¼ˆUnit testsç­‰ï¼‰ â”‚ â”œâ”€â”€ var # è‡ªå‹•ç”Ÿæˆã•ã‚Œã‚‹ãƒ•ã‚¡ã‚¤ãƒ« â”‚ â”œâ”€â”€ cache # ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãƒ•ã‚¡ã‚¤ãƒ« â”‚ â”œâ”€â”€ logs # ãƒ­ã‚°ãƒ•ã‚¡ã‚¤ãƒ« â”‚ â””â”€â”€ sessions â”‚ â”œâ”€â”€ vendor # å¤–éƒ¨ãƒ©ã‚¤ãƒ–ãƒ©ãƒª â”‚ â”œâ”€â”€ doctrine # ãƒ©ã‚¤ãƒ–ãƒ©ãƒª â”‚ â”œâ”€â”€ league # ãƒ©ã‚¤ãƒ–ãƒ©ãƒª â”‚ â”œâ”€â”€ sensio â”‚ â”œâ”€â”€ swiftmailer # ãƒ©ã‚¤ãƒ–ãƒ©ãƒª â”‚ â”œâ”€â”€ symfonyã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ # ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ â”‚ â””â”€â”€ twig # ãƒ©ã‚¤ãƒ–ãƒ©ãƒª â”‚ â””â”€â”€ asset #ãƒ–ãƒ©ã‚¦ã‚¶ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã«å…¬é–‹ã•ã‚Œã‚‹ãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆcss, javascript, imageç­‰ï¼‰ â”œâ”€â”€ admin â”œâ”€â”€ bootstrap â”œâ”€â”€ css â”œâ”€â”€ fontawesome â”œâ”€â”€ img # ç”»åƒãƒ•ã‚¡ã‚¤ãƒ« â”œâ”€â”€ jquery # jqueryï¼ˆjavascriptãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ï¼‰ â””â”€â”€ js # javascriptãƒ•ã‚¡ã‚¤ãƒ« 02. ç‰¹ã«æ±ç”¨çš„ãªSymfonyã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ Console HttpFoundation HttpKernel Pimple Security EventDispatcher Routing Cache 03. Console CLIï¼šCommand Line Interface ãƒ»CLIã¨ã¯ ã‚·ã‚§ãƒ«ã‚¹ã‚¯ãƒªãƒ—ãƒˆï¼ˆ.shï¼‰ï¼Œã¾ãŸã¯ãƒãƒƒãƒãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆ.batï¼‰ã«ãŠã‘ã‚‹ã‚³ãƒãƒ³ãƒ‰ã®å‡¦ç†å†…å®¹ã‚’å®šç¾©ã§ãã‚‹ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š setName(\"create:example\"); // ã‚³ãƒãƒ³ãƒ‰åã®å¾Œã«è¿½åŠ ã—ãŸã„å¼•æ•°å $this->addArgument( \"year-month\", InputArgument::REQUIRED, \"å‡¦ç†å¹´æœˆã‚’è¨­å®šã—ã¦ãã ã•ã„ï¼\" ); } // ã‚³ãƒãƒ³ãƒ‰ã®å‡¦ç†å†…å®¹ protected function execute(InputeInterface $input, OutputInterface $output) { try { // æ—¥æ™‚ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã‹ã‚‰Carbonã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’ä½œæˆã™ã‚‹ï¼ $year_month = Carbon::createFromFormat( \"Y-m\", $input->getArgument(\"year-month\") ); } catch (\\Exception $e) { // ã‚¨ãƒ©ãƒ¼ãƒ­ã‚°ã®æ–‡ç« ã‚’ä½œæˆ } } } CLIã‚’ã‚³ãƒ¼ãƒ«ã™ã‚‹ãƒãƒƒãƒãƒ•ã‚¡ã‚¤ãƒ« ãƒ»for # txtãƒ•ã‚¡ã‚¤ãƒ«ã‚’å¤‰æ•°fã«ç¹°ã‚Šè¿”ã—æ ¼ç´ã—ï¼Œå‡¦ç†ã‚’è¡Œã†ï¼ for f in *txt do echo $f; done; ãƒ»Cronã«ã‚ˆã‚‹ã‚³ãƒãƒ³ãƒ‰ã®è‡ªå‹•å®Ÿè¡Œ ï¼Šä¾‹ï¼Š 10ç§’ã”ã¨ã«ï¼Œã‚³ãƒãƒ³ãƒ‰ã‚’è‡ªå‹•å®Ÿè¡Œã™ã‚‹ï¼ # 10ç§’ã”ã¨ã«ï¼Œã‚³ãƒãƒ³ãƒ‰å‡¦ç†ã‚’å®Ÿè¡Œï¼ for f in `seq 0 10 59`; do (sleep {$f}; create:example) & done; # 15æ™‚ã”ã¨ã«ï¼Œã‚³ãƒãƒ³ãƒ‰å‡¦ç†ã‚’å®Ÿè¡Œï¼ 0 15 * * * * create:example; 03-02. HttpFoundation AppKernel ãƒ»ã‚«ãƒ¼ãƒãƒ«ã«å¿…è¦ãªã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ Requestã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°ã‹ã‚‰åé›†ã—ãŸæƒ…å ±ã‚„HTTPãƒªã‚¯ã‚¨ã‚¹ãƒˆã®ãƒ˜ãƒƒãƒ€æƒ…å ±ã‚„ã‚³ãƒ³ãƒ†ãƒ³ãƒ„æƒ…å ±ã‚’ä¿æŒ ã‚«ãƒ¼ãƒãƒ«ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®handle() é€ã‚‰ã‚Œã¦ããŸURLã‚’åŸºã«ã—ãŸã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ï¼ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã¸ã®ãƒ«ãƒ¼ãƒˆã®ç‰¹å®šï¼Œç‰¹å®šã•ã‚ŒãŸã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ï¼ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã®å®Ÿè¡Œï¼Œãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã®ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚° Responseã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ HTTPãƒ¬ã‚¹ãƒãƒ³ã‚¹ã®ãƒ˜ãƒƒãƒ€æƒ…å ±ã‚„ã‚³ãƒ³ãƒ†ãƒ³ãƒ„æƒ…å ±ãªã©ã®æƒ…å ±ã‚’ä¿æŒ ãƒ»ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‹ã‚‰å–ã‚Šå‡ºã•ã‚ŒãŸãƒ¡ã‚½ãƒƒãƒ‰ã®å½¹å‰² ã‚«ãƒ¼ãƒãƒ«ãŒï¼Œã‚¯ãƒ©ã‚¢ãƒ³ãƒˆã‹ã‚‰ã®HTTPãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã¨ã—ã¦å—ã‘å–ã‚‹ï¼ ã‚«ãƒ¼ãƒãƒ«ãŒï¼Œé€ã‚‰ã‚Œã¦ããŸURLã¨ãƒ«ãƒ¼ãƒˆå®šç¾©ã‚’åŸºã«ï¼Œãƒªã‚¯ã‚¨ã‚¹ãƒˆã«å¯¾å¿œã™ã‚‹ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚’æ¢ã—ï¼Œå®Ÿè¡Œã•ã›ã‚‹ï¼ãã®å¾Œï¼Œãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆãŒURLã‚’ç”Ÿæˆï¼ ã‚«ãƒ¼ãƒãƒ«ãŒï¼Œãã®çµæœã‚’ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã¨ã—ã¦ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã«è¿”ã™ï¼ ã“ã®ã‚«ãƒ¼ãƒãƒ«ã‚’ï¼Œç‰¹åˆ¥ã«ã€HTTPã‚«ãƒ¼ãƒãƒ«ã€ã¨å‘¼ã¶ï¼ ã€app.phpã®å®Ÿè£…ä¾‹ã€‘ loadClassCache(); } $request = Request::createFromGlobals(); //ï¼ˆï¼‘ï¼‰ // ä»¥ä¸‹ã®å®Ÿè£…ãƒ•ã‚¡ã‚¤ãƒ«ã‚‚å‚ç…§ã›ã‚ˆï¼ $response = $kernel->handle($request); //ï¼ˆï¼’ï¼‰ $response->send(); //ï¼ˆï¼“ï¼‰ $kernel->terminate($request, $response); ä¸Šè¨˜ã®handle()ãŒå®šç¾©ã•ã‚Œã¦ã„ã‚‹ãƒ•ã‚¡ã‚¤ãƒ«ï¼ã“ã“ã§å®šç¾©ã•ã‚ŒãŸhandle()ãŒï¼ŒC/Aã¸ã®ãƒ«ãƒ¼ãƒˆã®ç‰¹å®šï¼Œç‰¹å®šã•ã‚ŒãŸC/Aã®å®Ÿè¡Œï¼Œãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã®ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã‚’è¡Œã†ï¼ boot(); ++$this->requestStackSize; $this->resetServices = true; try { return $this->getHttpKernel()->handle($request, $type, $catch); } finally { --$this->requestStackSize; } } Requestï¼ŒResponse ãƒ»ãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‹ã‚‰ã®ãƒ‡ãƒ¼ã‚¿å–å¾—ï¼ŒJSONå‹ãƒ‡ãƒ¼ã‚¿ã®ãƒ¬ã‚¹ãƒãƒ³ã‚¹ Ajaxã«ã‚ˆã‚‹ãƒªã‚¯ã‚¨ã‚¹ãƒˆã®å ´åˆï¼ŒJSONå‹ãƒ‡ãƒ¼ã‚¿ã‚’ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã—ï¼Œã‹ã¤ãƒšãƒ¼ã‚¸ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ï¼ Ajaxã«ã‚ˆã‚‹ãƒªã‚¯ã‚¨ã‚¹ãƒˆã§ãªã„å ´åˆï¼Œãƒšãƒ¼ã‚¸ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã®ã¿ headers->get(\"content-type\") === \"application/json\") { $xxxRepository = new XxxRepository; $entityObject = $xxxRepository->getEntity(); //-- entityã‚’Objectå‹ã‹ã‚‰Arrayå‹ã«å¤‰æ›ã™ã‚‹ä½•ã‚‰ã‹ã®å‡¦ç†ï¼--// // Ajaxã«ãƒ¬ãƒ³ã‚¹ãƒãƒ³ã‚¹ï¼ return new JsonResponse([ \"value\" => $entityArray ]); } return $this->render(\".../xxx.twig\")->setStatusCode(200); } } ãƒ»ãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒ˜ãƒƒãƒ€ãƒ¼ã®å–å¾— query->get('hoge'); // $_POST['hoge'] $request->request->get('hoge'); // ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ / ex) @Route('/{hoge}') $request->attributes->get('hoge'); // $_COOKIE['hoge'] $request->cookies->get('hoge'); // $_FILES['hoge'] $request->files->get('hoge'); // $_SERVER['SCRIPT_FILENAME'] $request->server->get('SCRIPT_FILENAME'); // $_SERVER['HTTP_USER_AGENT'] $request->headers->get('User-Agent'); // query > attribute > request ã®é †ã§æ¤œç´¢ $request->get('hoge'); 03-03. HttpKernel HttpKernelã«ã‚ˆã‚‹ãƒªã‚¯ã‚¨ã‚¹ãƒˆã¨ãƒ¬ã‚¹ãƒãƒ³ã‚¹ 03-04. Pimple Service Container Symfonyã‹ã‚‰æä¾›ã•ã‚Œã‚‹DIã‚³ãƒ³ãƒ†ãƒŠã®ã“ã¨ï¼ 03-05. Routing RoutingConfigurator ãƒ»RoutingConfiguratorã¨ã¯ ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ã¸ã®ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã‚’è¨­å®šã™ã‚‹ï¼ add(\"api_post_show\", \"/api/posts/{id}\") ->controller([BlogApiController::class, \"show\"]) ->methods([\"GET\", \"HEAD\"]) ; $routes->add(\"api_post_edit\", \"/api/posts/{id}\") ->controller([BlogApiController::class, \"edit\"]) ->methods([\"PUT\"]) ; }; 03-06. Cache FilesystemAdapter ãƒ»FilesystemAdapterã¨ã¯ ãƒ‡ãƒ¼ã‚¿ã‚’ã‚­ãƒ£ãƒƒã‚·ãƒ³ã‚°ã§ãã‚‹ï¼ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã§ï¼Œåå‰ç©ºé–“ï¼Œã‚­ãƒ£ãƒƒã‚·ãƒ¥å­˜ç¶šæ™‚é–“ï¼Œã‚­ãƒ£ãƒƒã‚·ãƒ¥ãƒ«ãƒ¼ãƒˆãƒ‘ã‚¹ã‚’æŒ‡å®šã§ãã‚‹ï¼ getItem(\"stats.products_count\"); // ã‚­ãƒ£ãƒƒã‚·ãƒ¥IDã«ç´ä»˜ãã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚¢ã‚¤ãƒ†ãƒ ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã«ï¼Œãƒ‡ãƒ¼ã‚¿ãŒè¨­å®šã•ã‚Œã¦ã„ãªã„å ´åˆ if (!$cacheItemObj->isHit()) { // ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚¢ã‚¤ãƒ†ãƒ ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã«ï¼Œãƒ‡ãƒ¼ã‚¿ã‚’è¨­å®š $cacheItemObj->set(777); // ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚¢ã‚¤ãƒ†ãƒ ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’ç´ä»˜ã‘ã‚‹ï¼ $cache->save($cacheItemObj); } // ã‚­ãƒ£ãƒƒã‚·ãƒ¥IDã«ç´ä»˜ããƒ‡ãƒ¼ã‚¿ãŒã‚ã£ãŸå ´åˆï¼Œã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚¢ã‚¤ãƒ†ãƒ ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’å–å¾—ï¼ $cacheItemObj = $cache->get(); "},"public/software/software_application_backend_php_framework_laravel.html":{"url":"public/software/software_application_backend_php_framework_laravel.html","title":"ğŸ“– ï¸Laravel","keywords":"","body":"Laravel ã¯ã˜ã‚ã« æœ¬ã‚µã‚¤ãƒˆã«ã¤ãã¾ã—ã¦ï¼Œä»¥ä¸‹ã‚’ã”èªè­˜ã®ã»ã©å®œã—ããŠé¡˜ã„ã„ãŸã—ã¾ã™ï¼ å‚è€ƒï¼šhttps://hiroki-it.github.io/tech-notebook-gitbook/ 01. Laravelã®å…¨ä½“åƒ ãƒ©ã‚¤ãƒ•ã‚µã‚¤ã‚¯ãƒ« å¤§ã¾ã‹ãªå‡¦ç†ãƒ•ãƒ­ãƒ¼ã¯ä»¥ä¸‹ã®é€šã‚Šã§ã‚ã‚‹ï¼ å‚è€ƒï¼šhttps://blog.albert-chen.com/the-integration-of-laravel-with-swoole-part-1/ ç”¨èª èª¬æ˜ 1 ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’å—ä¿¡ã™ã‚‹ï¼ 2 index.phpãƒ•ã‚¡ã‚¤ãƒ« ã‚¨ãƒ³ãƒˆãƒªãƒã‚¤ãƒ³ãƒˆã‹ã‚‰å‡¦ç†ãŒå§‹ã¾ã‚‹ï¼ 3 Autoload autoload.phpãƒ•ã‚¡ã‚¤ãƒ«ã«ã¦ï¼Œãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’è‡ªå‹•ã§ãƒ­ãƒ¼ãƒ‰ã™ã‚‹ï¼ 4 Load App bootstrap/app.phpãƒ•ã‚¡ã‚¤ãƒ«ã«ã¦ï¼ŒServiceContainerï¼ˆIlluminate\\Foundation\\Application.phpï¼‰ã‚’å®Ÿè¡Œã™ã‚‹ï¼ 5 Http Kernel Kernelã‚’å®Ÿè¡Œã™ã‚‹ï¼ 6 ãƒ»Register ServiceProvidersãƒ»Boot Service Providers ServiceProviderã®registerãƒ¡ã‚½ãƒƒãƒ‰ã‚„bootãƒ¡ã‚½ãƒƒãƒ‰ã‚’å®Ÿè¡Œã™ã‚‹ï¼ã“ã‚Œã«ã‚ˆã‚Šï¼ŒServiceContainerã«ã‚¯ãƒ©ã‚¹ãŒãƒã‚¤ãƒ³ãƒ‰ã•ã‚Œã‚‹ï¼ 7 Middleware BeforeMiddlewareã‚’å®Ÿè¡Œã™ã‚‹ï¼ 8 ãƒ»Dispatch by Routerãƒ»Routes Match web.phpãƒ•ã‚¡ã‚¤ãƒ«ï¼Œapp.phpãƒ•ã‚¡ã‚¤ãƒ«ãªã©ã®ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°å®šç¾©ã‚’å…ƒã«ï¼ŒRouterãŒå®Ÿè¡Œã™ã‚‹ï¼ 9 FormRequest ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’å®Ÿè¡Œã™ã‚‹ï¼ 10 Controller Controllerã‚’åŸºç‚¹ã¨ã—ã¦ï¼Œãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã«ã¾ã§å‡¦ç†ãŒèµ°ã‚‹ï¼ 11 Resource ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‹ã‚‰å–å¾—ã—ãŸã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³å‹ãƒ‡ãƒ¼ã‚¿ã‚’é…åˆ—å‹ãƒ‡ãƒ¼ã‚¿ã«å¤‰æ›ã™ã‚‹ï¼ 12 Response Responseã‚’å®Ÿè¡Œã™ã‚‹ï¼é…åˆ—å‹ãƒ‡ãƒ¼ã‚¿ã‚’JSONãƒ‡ãƒ¼ã‚¿ã«å¤‰æ›ã™ã‚‹ï¼ 13 Terminate Middleware AfterMiddlewareãŒå®Ÿè¡Œã•ã‚Œã‚‹ï¼ 14 View bladeãƒ•ã‚¡ã‚¤ãƒ«ã«åŸºã¥ã„ã¦é™çš„ãƒ•ã‚¡ã‚¤ãƒ«ãŒæ§‹ç¯‰ã•ã‚Œã‚‹ï¼ 15 ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’è¿”ä¿¡ã™ã‚‹ï¼ ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ Laravelã®å„ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã«ã¯ï¼Œä¼¼ãŸã‚ˆã†ãªåå‰ã®ãƒ¡ã‚½ãƒƒãƒ‰ãŒå¤šãå†…è”µã•ã‚Œã¦ã„ã‚‹ï¼ãã®ãŸã‚ï¼ŒåŒæ§˜ã®æ©Ÿèƒ½ã‚’å®Ÿç¾ã™ã‚‹ãŸã‚ã«ï¼Œå„ã€…ãŒç•°ãªã‚‹ãƒ¡ã‚½ãƒƒãƒ‰ã‚’ä½¿ç”¨ã—ãŒã¡ã«ãªã‚‹ï¼ãã®æ™‚ï¼Œå„ãƒ¡ã‚½ãƒƒãƒ‰ãŒãƒ–ãƒ©ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ã«ãªã‚‰ãªã„ã‚ˆã†ã«ï¼Œå‡¦ç†ã®é•ã„ã‚’ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã‹ã‚‰ç¢ºèªã™ã‚‹å¿…è¦ãŒã‚ã‚‹ï¼ å‚è€ƒï¼šhttps://laravel.com/api/8.x/Illuminate.html 02. Application App ãƒ»è¨­å®šæ–¹æ³• APP_NAME= APP_ENV= APP_KEY= APP_DEBUG= APP_URL= ãƒ»app.phpãƒ•ã‚¡ã‚¤ãƒ«ã®åŸºæœ¬è¨­å®š env(\"APP_NAME\", \"Laravel\"), // å®Ÿè¡Œç’°å¢ƒå \"env\" => env(\"APP_ENV\", \"production\"), // ã‚¨ãƒ©ãƒ¼æ™‚ã®ãƒ‡ãƒãƒƒã‚°ç”»é¢ã®æœ‰åŠ¹åŒ– \"debug\" => (bool)env(\"APP_DEBUG\", false), // ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®URL \"url\" => env(\"APP_URL\", \"http://localhost\"), // assetãƒ˜ãƒ«ãƒ‘ãƒ¼ã§ä»˜ä¸ã™ã‚‹URL \"asset_url\" => env(\"ASSET_URL\", null), // ã‚¿ã‚¤ãƒ ã‚¾ãƒ¼ãƒ³ \"timezone\" => \"UTC\", // è¨€èªè¨­å®š \"locale\" => \"ja\", \"fallback_locale\" => \"en\", \"faker_locale\" => \"ja_JP\", // ã‚»ãƒƒã‚·ãƒ§ãƒ³ã®ä½œæˆã‚„ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã®æš—å·åŒ–ã«ä½¿ã†èªè¨¼ã‚­ãƒ¼ \"key\" => env(\"APP_KEY\"), // æš—å·åŒ–ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ  \"cipher\" => \"AES-256-CBC\", // ã‚µãƒ¼ãƒ“ã‚¹ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼ \"providers\" => [ ], // ã‚¯ãƒ©ã‚¹åã®ã‚¨ã‚¤ãƒªã‚¢ã‚¹ \"aliases\" => [ ], ]; 03. Console Command artisanã‚³ãƒãƒ³ãƒ‰ã§å®Ÿè¡Œå¯èƒ½ãªã‚³ãƒãƒ³ãƒ‰å‡¦ç†ã‚’å®šç¾©ã™ã‚‹ï¼ å‚è€ƒï¼šhttps://readouble.com/laravel/8.x/ja/artisan.html#writing-commands argument('bar'); // ä½•ã‚‰ã‹ã®ã‚³ãƒãƒ³ãƒ‰å‡¦ç† Log::info('END: artisan do-foo'); } } å®šç¾©ã—ãŸCommandã‚¯ãƒ©ã‚¹ã¯ï¼Œä»¥ä¸‹ã®ã‚ˆã†ã«å®Ÿè¡Œã§ãã‚‹ï¼ $ php artisan command:do-foo 04. Database ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ¥ç¶š ãƒ»è¨­å®šæ–¹æ³• ç’°å¢ƒå¤‰æ•°ã‚’.envãƒ•ã‚¡ã‚¤ãƒ«ã«å®Ÿè£…ã™ã‚‹ï¼database.phpãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰ï¼ŒæŒ‡å®šã•ã‚ŒãŸè¨­å®šãŒé¸æŠã•ã‚Œã‚‹ï¼ DB_CONNECTION= DB_HOST= DB_PORT= DB_DATABASE= DB_USERNAME= DB_PASSWORD= ãƒ»RDBã¨Redisã®é¸æŠ env(\"DB_CONNECTION\", \"mysql\"), \"connections\" => [ // ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ¥ç¶šæƒ…å ±ï¼ˆSQLiteï¼‰ \"sqlite\" => [ ], // ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ¥ç¶šæƒ…å ±ï¼ˆMySQLï¼‰ \"mysql\" => [ ], // ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ¥ç¶šæƒ…å ±ï¼ˆpgSQLï¼‰ \"pgsql\" => [ ], // ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ¥ç¶šæƒ…å ±ï¼ˆSQLSRVï¼‰ \"sqlsrv\" => [ ], ], // ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãƒ•ã‚¡ã‚¤ãƒ«ã®ã‚ã‚‹ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª \"migrations\" => \"migrations\", // Redisæ¥ç¶šæƒ…å ± \"redis\" => [ ], ]; Redis ãƒ»ã‚¯ã‚¨ãƒªCacheç®¡ç† ç’°å¢ƒå¤‰æ•°ã‚’.envãƒ•ã‚¡ã‚¤ãƒ«ã«å®Ÿè£…ã™ã‚‹å¿…è¦ãŒã‚ã‚‹ï¼ CACHE_DRIVER=redis REDIS_HOST= REDIS_PASSWORD= REDIS_PORT= 05. Eloquentãƒ¢ãƒ‡ãƒ« artisanã‚³ãƒãƒ³ãƒ‰ã«ã‚ˆã‚‹æ“ä½œ ãƒ»ã‚¯ãƒ©ã‚¹ã®è‡ªå‹•ç”Ÿæˆ $ php artisan make:model Active Recordãƒ‘ã‚¿ãƒ¼ãƒ³ ãƒ»Active Recordãƒ‘ã‚¿ãƒ¼ãƒ³ã¨ã¯ ãƒ†ãƒ¼ãƒ–ãƒ«ã¨ãƒ¢ãƒ‡ãƒ«ãŒä¸€å¯¾ä¸€ã®é–¢ä¿‚ã«ãªã‚‹ãƒ‡ã‚¶ã‚¤ãƒ³ãƒ‘ã‚¿ãƒ¼ãƒ³ã®ã“ã¨ï¼ã•ã‚‰ã«ï¼Œãƒ†ãƒ¼ãƒ–ãƒ«é–“ã®ãƒªãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚·ãƒƒãƒ—ãŒãã®ã¾ã¾ãƒ¢ãƒ‡ãƒ«é–“ã®ä¾å­˜é–¢ä¿‚ã«ã‚‚åæ˜ ã•ã‚Œã‚‹ï¼ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ãŒè¤‡é›‘ã§ãªã„ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®é–‹ç™ºã«é©ã—ã¦ã„ã‚‹ï¼ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆé–“ã®ä¾å­˜é–¢ä¿‚ã«ã¤ã„ã¦ã¯ï¼Œä»¥ä¸‹ã®ãƒªãƒ³ã‚¯ã‚’å‚è€ƒã›ã‚ˆï¼ å‚è€ƒï¼šhttps://hiroki-it.github.io/tech-notebook-gitbook/public/software/software_application_backend_php_object_orientation_class.html ãƒ»ãƒ¡ãƒªãƒƒãƒˆï¼ãƒ‡ãƒ¡ãƒªãƒƒãƒˆ é …ç›® ãƒ¡ãƒªãƒƒãƒˆ ãƒ‡ãƒ¡ãƒªãƒƒãƒˆ ä¿å®ˆæ€§ ãƒ†ãƒ¼ãƒ–ãƒ«é–“ã®ãƒªãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãŒï¼Œãã®ã¾ã¾ãƒ¢ãƒ‡ãƒ«é–“ã®ä¾å­˜é–¢ä¿‚ã«ãªã‚‹ãŸã‚ï¼Œãƒ¢ãƒ‡ãƒ«é–“ã®ä¾å­˜é–¢ä¿‚ã‚’è€ƒãˆã‚‹å¿…è¦ãŒãªãï¼Œé–‹ç™ºãŒæ—©ã„ï¼ãã®ãŸã‚ï¼Œãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ãŒè¤‡é›‘ã§ãªã„ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®é–‹ç™ºã«é©ã—ã¦ã„ã‚‹ï¼ ãƒ»åå¯¾ã«ï¼Œãƒ¢ãƒ‡ãƒ«é–“ã®ä¾å­˜é–¢ä¿‚ã«ã‚ˆã£ã¦ãƒ†ãƒ¼ãƒ–ãƒ«é–“ã®ãƒªãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãŒæ±ºã¾ã‚‹ï¼ãã®ãŸã‚ï¼Œè¤‡é›‘ãªæ¥­å‹™ãƒ­ã‚¸ãƒƒã‚¯ã§ãƒ¢ãƒ‡ãƒ«é–“ãŒè¤‡é›‘ãªä¾å­˜é–¢ä¿‚ã‚’æŒã¤ã¨ï¼Œãƒ†ãƒ¼ãƒ–ãƒ«é–“ã®ãƒªãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚‚è¤‡é›‘ã«ãªã£ã¦ã„ã£ã¦ã—ã¾ã†ï¼ãƒ»ãƒ¢ãƒ‡ãƒ«ã«å¯¾å¿œã™ã‚‹ãƒ†ãƒ¼ãƒ–ãƒ«ã«é–¢ã—ã¦ï¼Œå¿…è¦ãªã‚«ãƒ©ãƒ ã ã‘ã§ãªãï¼Œå…¨ã¦ã®ã‚«ãƒ©ãƒ ã‹ã‚‰å–å¾—ã™ã‚‹ãŸã‚ï¼Œã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã«ä½™åˆ†ãªè² è·ãŒã‹ã‹ã‚‹ï¼ æ‹¡å¼µæ€§ ãƒ†ãƒ¼ãƒ–ãƒ«é–“ã®ãƒªãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãŒãƒ¢ãƒ‡ãƒ«é–“ã®ä¾å­˜é–¢ä¿‚ã«ã‚ˆã£ã¦å®šç¾©ã•ã‚Œã¦ãŠã‚Šï¼ŒJOINå¥ã‚’ä½¿ç”¨ã›ãšã«ï¼Œå„ãƒ†ãƒ¼ãƒ–ãƒ«ã‹ã‚‰å¿…è¦ãªãƒ¬ã‚³ãƒ¼ãƒ‰ã‚’å–å¾—ã§ãã‚‹ï¼ãã®ãŸã‚ï¼Œãƒ†ãƒ¼ãƒ–ãƒ«ã‚’å¢—ã‚„ã™ã‚„ã™ã„ï¼ å¯èª­æ€§ ãƒ»ãƒ¢ãƒ‡ãƒ«ã¨ã“ã‚Œã®ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ãŒãã®ã¾ã¾ãƒ†ãƒ¼ãƒ–ãƒ«ã«ãªã‚‹ãŸã‚ï¼Œãƒ¢ãƒ‡ãƒ«ã‚’ä½œæˆã™ã‚‹ãŸã‚ã«ã©ã®ãƒ†ãƒ¼ãƒ–ãƒ«ã‹ã‚‰ãƒ¬ã‚³ãƒ¼ãƒ‰ã‚’å–å¾—ã™ã‚‹ã®ã‹ã‚’æ¨æ¸¬ã—ã‚„ã™ã„ï¼ï¼ˆUserãƒ¢ãƒ‡ãƒ« â‡„ usersãƒ†ãƒ¼ãƒ–ãƒ«ï¼‰ãƒ»ãƒªãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ç†è§£ã™ã‚‹å¿…è¦ãŒã‚ã¾ã‚Šãªãï¼Œè¤‡æ•°ã®ãƒ†ãƒ¼ãƒ–ãƒ«ã«å¯¾ã—ã¦ç„¡ç§©åºã«SQLã‚’ç™ºè¡Œã™ã‚‹ã‚ˆã†ãªè¨­è¨ˆå®Ÿè£…ã«ãªã‚Šã«ãã„ï¼ ãƒ†ãƒ¼ãƒ–ãƒ«è¨­è¨ˆã‚’å…ƒã«ã—ãŸEloquentãƒ¢ãƒ‡ãƒ« ãƒ»Eloquentãƒ¢ãƒ‡ãƒ«ã®ç¶™æ‰¿ Eloquentãƒ¢ãƒ‡ãƒ«ã‚’ç¶™æ‰¿ã—ãŸã‚¯ãƒ©ã‚¹ã¯ï¼ŒINSERTæ–‡ã‚„UPDATEæ–‡ãªã©ã®ãƒ‡ãƒ¼ã‚¿ã‚¢ã‚¯ã‚»ã‚¹ãƒ­ã‚¸ãƒƒã‚¯ã‚’ä½¿ç”¨ã§ãã‚‹ã‚ˆã†ã«ãªã‚‹ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š ãƒ»ãƒ†ãƒ¼ãƒ–ãƒ«ã®å®šç¾© ãƒ†ãƒ¼ãƒ–ãƒ«ã‚’å®šç¾©ã™ã‚‹ãŸã‚ï¼Œtableãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã«ãƒ†ãƒ¼ãƒ–ãƒ«åã‚’å‰²ã‚Šå½“ã¦ã‚‹ï¼ãŸã ã—ï¼Œtableãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã«ãƒ†ãƒ¼ãƒ–ãƒ«åã‚’ä»£å…¥ã™ã‚‹å¿…è¦ã¯ãªã„ï¼EloquentãŒã‚¯ãƒ©ã‚¹åã®è¤‡æ•°å½¢ã‚’ãƒ†ãƒ¼ãƒ–ãƒ«åã¨è¦‹ãªã—ï¼Œã“ã‚Œã‚’ã‚¹ãƒãƒ¼ã‚¯ã‚±ãƒ¼ã‚¹ã«ã—ãŸæ–‡å­—åˆ—ã‚’tableãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã«è‡ªå‹•çš„ã«ä»£å…¥ã™ã‚‹ï¼ã¾ãŸï¼Œãƒ†ãƒ¼ãƒ–ãƒ«åã‚’ç‹¬è‡ªã§å‘½åã—ãŸã„å ´åˆã¯ï¼Œä»£å…¥ã«ã‚ˆã‚‹Overrideã‚’è¡Œã£ã¦ã‚‚è‰¯ã„ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š ãƒ»ãƒ†ãƒ¼ãƒ–ãƒ«é–“ãƒªãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚·ãƒƒãƒ—ã®å®šç¾© ERå›³ã«ãŠã‘ã‚‹å„ãƒ†ãƒ¼ãƒ–ãƒ«ã®ãƒªãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚·ãƒƒãƒ—ã‚’å…ƒã«ï¼Œãƒ¢ãƒ‡ãƒ«é–“ã®é–¢é€£æ€§ã‚’å®šç¾©ã™ã‚‹ï¼hasOneãƒ¡ã‚½ãƒƒãƒ‰ï¼ŒhasManyãƒ¡ã‚½ãƒƒãƒ‰ï¼ŒbelongsToãƒ¡ã‚½ãƒƒãƒ‰ã‚’ç”¨ã„ã¦è¡¨ç¾ã™ã‚‹ï¼ å‚è€ƒï¼š https://readouble.com/laravel/8.x/ja/eloquent-relationships.html#one-to-one https://readouble.com/laravel/8.x/ja/eloquent-relationships.html#one-to-many https://readouble.com/laravel/8.x/ja/eloquent-relationships.html#one-to-many-inverse ERå›³ã«ã¤ã„ã¦ã¯ï¼Œä»¥ä¸‹ã‚’å‚è€ƒã«ã›ã‚ˆï¼ å‚è€ƒï¼šhttps://hiroki-it.github.io/tech-notebook-gitbook/public/software/software_application_backend_php_object_orientation_analysis_design_programming.html ï¼Šå®Ÿè£…ä¾‹ï¼Š Departmentãƒ¢ãƒ‡ãƒ«ã«ãŠã„ã¦ï¼ŒhasManyãƒ¡ã‚½ãƒƒãƒ‰ã‚’ç”¨ã„ã¦ï¼ŒDepartmentãƒ¢ãƒ‡ãƒ«ï¼ˆè¦ªï¼‰ã¨Employeesãƒ¢ãƒ‡ãƒ«ï¼ˆå­ï¼‰ã®ãƒ†ãƒ¼ãƒ–ãƒ«é–¢ä¿‚ã‚’å®šç¾©ã™ã‚‹ï¼ hasMany(Employee::class); } } ã¾ãŸï¼ŒEmployeesãƒ¢ãƒ‡ãƒ«ã«ãŠã„ã¦ã¯ï¼ŒbelongsToãƒ¡ã‚½ãƒƒãƒ‰ã‚’ç”¨ã„ã¦ï¼ŒDepartmentãƒ¢ãƒ‡ãƒ«ï¼ˆè¦ªï¼‰ã¨Employeesãƒ¢ãƒ‡ãƒ«ï¼ˆå­ï¼‰ã®ãƒ†ãƒ¼ãƒ–ãƒ«é–¢ä¿‚ã‚’å®šç¾©ã™ã‚‹ï¼ belongsTo(Department::class); } } ãƒªãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã«åŸºã¥ã„ã¦JOINå¥ã®SQLã‚’ç™ºè¡Œã™ã‚‹ãŸã‚ã«ï¼ŒDepartmentãƒ¢ãƒ‡ãƒ«ï¼ˆè¦ªï¼‰ã®hasManyãƒ¡ã‚½ãƒƒãƒ‰ã‚’å®Ÿè¡Œã™ã‚‹ï¼ã“ã‚Œã«ã‚ˆã‚Šï¼ŒDepartmentãƒ¢ãƒ‡ãƒ«ã®IDã«ç´ä»˜ãEmployeesãƒ¢ãƒ‡ãƒ«ï¼ˆå­ï¼‰ã‚’é…åˆ—ã§å‚ç…§ã§ãã‚‹ï¼ employees() ãƒ»ä¸»ã‚­ãƒ¼ã‚«ãƒ©ãƒ ã®å®šç¾© Eloquentã¯ï¼ŒprimaryKeyãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã®å€¤ã‚’ä¸»ã‚­ãƒ¼ã®ã‚«ãƒ©ãƒ åã¨è¦‹ãªã™ï¼keyTypeãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã§ä¸»ã‚­ãƒ¼ã®ãƒ‡ãƒ¼ã‚¿å‹ï¼Œã¾ãŸincrementingãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã§ä¸»ã‚­ãƒ¼ã®AutoIncrementã‚’æœ‰åŠ¹åŒ–ã™ã‚‹ã‹å¦ã‹ï¼Œã‚’è¨­å®šã§ãã‚‹ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š ãƒ»TIMESTAMPå‹ã‚«ãƒ©ãƒ ã®å®šç¾© Eloquentã¯ï¼Œtimestampsãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã®å€¤ãŒtrueã®æ™‚ã«ï¼ŒEloquentãƒ¢ãƒ‡ãƒ«ã«ç´ä»˜ããƒ†ãƒ¼ãƒ–ãƒ«ã®created_atã‚«ãƒ©ãƒ ã¨updated_atã‚«ãƒ©ãƒ ã‚’è‡ªå‹•çš„ã«æ›´æ–°ã™ã‚‹ï¼ã¾ãŸï¼ŒTIMESTAMPå‹ã‚«ãƒ©ãƒ åã‚’ç‹¬è‡ªã§å‘½åã—ãŸã„å ´åˆã¯ï¼Œä»£å…¥ã«ã‚ˆã‚‹Overideã‚’è¡Œã£ã¦ã‚‚è‰¯ã„ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š ãƒ»TIMESTAMPå‹ã‚«ãƒ©ãƒ èª­ã¿å‡ºã—æ™‚ã®ãƒ‡ãƒ¼ã‚¿å‹å¤‰æ› ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‹ã‚‰ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—å‹ã‚«ãƒ©ãƒ ã‚’èª­ã¿å‡ºã™ã¨åŒæ™‚ã«ï¼ŒCarbonã®DateTimeã‚¯ãƒ©ã‚¹ã«å¤‰æ›ã—ãŸã„å ´åˆï¼Œdataãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã«ã¦ï¼Œã‚«ãƒ©ãƒ åã‚’è¨­å®šã™ã‚‹ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š ãƒ»ã‚«ãƒ©ãƒ ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã®å®šç¾© ç‰¹å®šã®ã‚«ãƒ©ãƒ ã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã‚’è¨­å®šã—ãŸã„å ´åˆï¼Œattributesãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã«ã¦ï¼Œã‚«ãƒ©ãƒ åã¨å€¤ã‚’å®šç¾©ã™ã‚‹ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š false, ]; } ãƒ»å¤‰æ›´å¯èƒ½ï¼ä¸å¯èƒ½ãªã‚«ãƒ©ãƒ ã®å®šç¾© å¤‰æ›´å¯èƒ½ãªã‚«ãƒ©ãƒ åã‚’fillableãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã‚’ç”¨ã„ã¦å®šç¾©ã™ã‚‹ï¼ã‚«ãƒ©ãƒ ãŒå¢—ãˆã‚‹ãŸã³ã«ï¼Œå®Ÿè£…ã™ã‚‹å¿…è¦ãŒã‚ã‚‹ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š ã‚‚ã—ãã¯ï¼Œå¤‰æ›´ä¸å¯èƒ½ãªã‚«ãƒ©ãƒ åã‚’guardedãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã§å®šç¾©ã™ã‚‹ï¼ã“ã‚Œã‚‰ã®ã„ãšã‚Œã‹ã®è¨­å®šã¯ï¼ŒEloquentãƒ¢ãƒ‡ãƒ«ã«ãŠã„ã¦å¿…é ˆã§ã‚ã‚‹ï¼ ä½¿ç”¨ã«æ³¨æ„ã™ã‚‹æ©Ÿèƒ½ ãƒ»ã‚»ãƒƒã‚¿ãƒ¼ Laravelã§ã¯ï¼Œãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã‚’å®šç¾©ã—ãªãã¦ã‚‚ï¼ŒEloquentãƒ¢ãƒ‡ãƒ«ã‹ã‚‰ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã‚’ã‚³ãƒ¼ãƒ«ã™ã‚Œã°ï¼Œå‡¦ç†ã®åº¦ã«å‹•çš„ã«ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã‚’å®šç¾©ã§ãã‚‹ï¼ã—ã‹ã—ï¼Œã“ã®æ©Ÿèƒ½ã¯ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ãŒpublicã‚¢ã‚¯ã‚»ã‚¹ã§ã‚ã‚‹å¿…è¦ãŒã‚ã‚‹ãŸã‚ï¼Œã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆæ©Ÿèƒ½ã®ãƒ¡ãƒªãƒƒãƒˆã‚’äº«å—ã§ããªã„ï¼ãã®ãŸã‚ï¼Œã“ã®æ©Ÿèƒ½ã‚’ä½¿ç”¨ã›ãšã«ï¼Œconstructorãƒ¡ã‚½ãƒƒãƒ‰ã‚’ä½¿ç”¨ã—ãŸã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³ï¼Œã¾ãŸã¯ã‚»ãƒƒã‚¿ãƒ¼ã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³ã‚’ä½¿ç”¨ã™ã‚‹ã‚ˆã†ã«ã™ã‚‹ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š fooName = $fooName; } } ãƒ»ã‚²ãƒƒã‚¿ãƒ¼ Laravelã§ã¯ï¼ŒgetXxxxYyyyAttributeã¨ã„ã†åå‰ã®ãƒ¡ã‚½ãƒƒãƒ‰ã‚’ï¼Œxxx_yyyã¨ã„ã†åå‰ã§ã‚³ãƒ¼ãƒ«ã§ãã‚‹ï¼ä¸€è¦‹ï¼Œãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã‚’ã‚³ãƒ¼ãƒ«ã—ã¦ã„ã‚‹ã‚ˆã†ã«è¦‹ãˆã‚‹ãŸã‚ï¼Œæ³¨æ„ãŒå¿…è¦ã§ã‚ã‚‹ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š fooName . \"ã§ã™ï¼\"; } } name; ãƒ‡ãƒ¼ã‚¿å‹å¤‰æ› ãƒ»ã‚·ãƒªã‚¢ãƒ©ã‚¤ã‚º ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã¨ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰é–“ï¼Œã¾ãŸãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã¨ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹é–“ã®ãƒ‡ãƒ¼ã‚¿é€ä¿¡ã®ãŸã‚ã«ï¼Œé…åˆ—å‹ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’JSONã«å¤‰æ›ã™ã‚‹å‡¦ç†ã¯ã‚·ãƒªã‚¢ãƒ©ã‚¤ã‚ºã§ã‚ã‚‹ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š 1, \"name\" => \"ä½è—¤å¤ªéƒ\", ], [ \"user_id\" => 2, \"name\" => \"å±±ç”°æ¬¡éƒ\", ], ]); // Arrayå‹ã«å¤‰æ›ã™ã‚‹ $collection->toArray(); toArray(); ãƒ»ãƒ‡ã‚·ãƒªã‚¢ãƒ©ã‚¤ã‚º ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã¨ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰é–“ï¼Œã¾ãŸãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã¨ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹é–“ã®ãƒ‡ãƒ¼ã‚¿é€ä¿¡ã®ãŸã‚ã«ï¼ŒJSONã‚’é…åˆ—å‹ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã«å¤‰æ›ã™ã‚‹å‡¦ç†ã¯ãƒ‡ã‚·ãƒªã‚¢ãƒ©ã‚¤ã‚ºã§ã‚ã‚‹ï¼ ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚° ãƒ»filterãƒ¡ã‚½ãƒƒãƒ‰ ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯é–¢æ•°ã®è¿”å´å€¤ãŒtrueã§ã‚ã£ãŸè¦ç´ ã‚’å…¨ã¦æŠ½å‡ºã™ã‚‹ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š $collection = collect([1, 2, 3, 4]); // trueã‚’è¿”å´ã—ãŸè¦ç´ ã‚’å…¨ã¦æŠ½å‡ºã™ã‚‹ $filtered = $collection->filter(function ($value, $key) { return $value > 2; }); $filtered->all(); // [3, 4] ã¡ãªã¿ã«ï¼Œè¤‡æ•°ã®æ¡ä»¶ã‚’è¨­å®šã—ãŸã„ã¨ãã¯ï¼Œæ—©æœŸãƒªã‚¿ãƒ¼ãƒ³ã‚’ä½¿ç”¨ã™ã‚‹å¿…è¦ãŒã‚ã‚‹ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š $collection = collect([1, 2, 3, 4, \"yes\"]); // è¤‡æ•°ã®æ¡ä»¶ã§æŠ½å‡ºã™ã‚‹ï¼ $filtered = $collection->filter(function ($value, $key) { // ã¾ãšã¯yesã‚’æ¤œè¨¼ã™ã‚‹ï¼ if($value == \"yes\") { return true; } return $value > 2; }); $filtered->all(); // [3, 4, \"yes\"] ãƒ»firstãƒ¡ã‚½ãƒƒãƒ‰ ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯é–¢æ•°ã®è¿”å´å€¤ãŒtrueã§ã‚ã£ãŸæœ€åˆã®è¦ç´ ã®ã¿ã‚’æŠ½å‡ºã™ã‚‹ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š $collection = collect([1, 2, 3, 4]); // trueã‚’è¿”å´ã—ãŸè¦ç´ ã®ã¿æŠ½å‡ºã™ã‚‹ $filtered = $collection->first(function ($value, $key) { return $value > 2; }); // 3 05-02. Eloquentãƒ¢ãƒ‡ãƒ«ï¼ãƒ“ãƒ«ãƒ€ãƒ¼ã«ã‚ˆã‚‹CRUD CRUDãƒ¡ã‚½ãƒƒãƒ‰ã®è¿”å´å€¤å‹ã¨è¿”å´å€¤ ãƒ»CRUDãƒ¡ã‚½ãƒƒãƒ‰ã‚’æŒã¤ã‚¯ãƒ©ã‚¹ Eloquentãƒ¢ãƒ‡ãƒ«ã‚’ç¶™æ‰¿ã™ã‚‹ã¨ï¼Œä»¥ä¸‹ã®ã‚¯ãƒ©ã‚¹ã‹ã‚‰ãƒ¡ã‚½ãƒƒãƒ‰ã‚’ã‚³ãƒ¼ãƒ«ã§ãã‚‹ã‚ˆã†ã«ãªã‚‹ï¼Eloquentãƒ¢ãƒ‡ãƒ«ã«ã¯ã‚ˆã‚Šä¸Šä½ã®ãƒ¡ã‚½ãƒƒãƒ‰ãŒå®šç¾©ã•ã‚Œã¦ã„ãªã„ã“ã¨ãŒã‚ã‚Šï¼Œã‚‚ã—å®šç¾©ã•ã‚Œã¦ã„ãªã„ã‚‚ã®ãŒã‚³ãƒ¼ãƒ«ã•ã‚ŒãŸå ´åˆï¼Œ__callStaticãƒ¡ã‚½ãƒƒãƒ‰ï¼ˆé™çš„ã‚³ãƒ¼ãƒ«ã«ã‚ˆã‚‹ï¼‰ã‚„__callãƒ¡ã‚½ãƒƒãƒ‰ï¼ˆéé™çš„ã‚³ãƒ¼ãƒ«ã«ã‚ˆã‚‹ï¼‰ãŒä»£ã‚ã‚Šã«ã‚³ãƒ¼ãƒ«ã•ã‚Œï¼Œã‚ˆã‚Šä¸Šä½ã‚¯ãƒ©ã‚¹ã®ãƒ¡ã‚½ãƒƒãƒ‰ã‚’ã‚³ãƒ¼ãƒ«ã§ãã‚‹ï¼ã©ã¡ã‚‰ã®æ–¹æ³•ã§ã‚³ãƒ¼ãƒ«ã—ã¦ã‚‚åŒã˜ã§ã‚ã‚‹ï¼ å‚è€ƒï¼š https://www.php.net/manual/ja/language.oop5.overloading.php#object.call https://qiita.com/mpyw/items/7c7e8dc665584122a275 ã‚¯ãƒ©ã‚¹ åå‰ç©ºé–“ __callãƒ¡ã‚½ãƒƒãƒ‰ã‚’çµŒç”±ã—ã¦ã‚³ãƒ¼ãƒ«ã§ãã‚‹ã‚¯ãƒ©ã‚¹ Queryãƒ“ãƒ«ãƒ€ãƒ¼ Illuminate\\Database\\Query\\Builder ãªã— Eloquentãƒ“ãƒ«ãƒ€ãƒ¼ Illuminate\\Database\\Eloquent\\Builder Queryãƒ“ãƒ«ãƒ€ãƒ¼ï¼Œ Eloquentãƒªãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ Illuminate\\Database\\Eloquent\\Relations\\Relation Queryãƒ“ãƒ«ãƒ€ãƒ¼ï¼ŒEloquentãƒ“ãƒ«ãƒ€ãƒ¼ï¼Œ Eloquentãƒ¢ãƒ‡ãƒ« Illuminate\\Database\\Eloquent\\Model Queryãƒ“ãƒ«ãƒ€ãƒ¼ï¼ŒEloquentãƒ“ãƒ«ãƒ€ãƒ¼ï¼ŒEloquentãƒªãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ ãƒ»Eloquentãƒ“ãƒ«ãƒ€ãƒ¼ Eloquentãƒ“ãƒ«ãƒ€ãƒ¼ãŒæŒã¤crudã‚’å®Ÿè¡Œã™ã‚‹ãƒ¡ã‚½ãƒƒãƒ‰ã®è¿”å´å€¤å‹ã¨è¿”å´å€¤ã¯ä»¥ä¸‹ã®é€šã‚Šã§ã‚ã‚‹ï¼ãã®ä»–ã®ãƒ¡ã‚½ãƒƒãƒ‰ã«ã¤ã„ã¦ã¯ï¼Œä»¥ä¸‹ã®ãƒªãƒ³ã‚¯ã‚’å‚è€ƒã«ã›ã‚ˆï¼ å‚è€ƒï¼šhttps://laravel.com/api/8.x/Illuminate/Database/Eloquent/Builder.html CRUDãƒ¡ã‚½ãƒƒãƒ‰ã®ç¨®é¡ è¿”å´å€¤å‹ è¿”å´å€¤ è¿”å´å€¤ã®èª¬æ˜ create collectionï¼$this {id:1, name: ãƒ†ã‚¹ãƒˆ} ä½œæˆã—ãŸã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ find collectionï¼Builderï¼Model {id:1, name:ãƒ†ã‚¹ãƒˆ} å–å¾—ã—ãŸã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ update mixed 0ï¼Œ1ï¼Œ2ï¼Œ3 å¤‰æ›´ã—ãŸãƒ¬ã‚³ãƒ¼ãƒ‰æ•° delete mixed 0ï¼Œ1ï¼Œ2ï¼Œ3 å¤‰æ›´ã—ãŸãƒ¬ã‚³ãƒ¼ãƒ‰æ•° ãƒ»Eloquentãƒ¢ãƒ‡ãƒ« Eloquentãƒ¢ãƒ‡ãƒ«ãŒæŒã¤crudã‚’å®Ÿè¡Œã™ã‚‹ãƒ¡ã‚½ãƒƒãƒ‰ã®è¿”å´å€¤å‹ã¨è¿”å´å€¤ã¯ä»¥ä¸‹ã®é€šã‚Šã§ã‚ã‚‹ï¼ãã®ä»–ã®ãƒ¡ã‚½ãƒƒãƒ‰ã«ã¤ã„ã¦ã¯ï¼Œä»¥ä¸‹ã®ãƒªãƒ³ã‚¯ã‚’å‚è€ƒã«ã›ã‚ˆï¼ å‚è€ƒï¼šhttps://laravel.com/api/8.x/Illuminate/Database/Eloquent/Model.html CRUDãƒ¡ã‚½ãƒƒãƒ‰ã®ç¨®é¡ è¿”å´å€¤å‹ è¿”å´å€¤ è¿”å´å€¤ã®èª¬æ˜ update bool trueï¼Œfalse çµæœã®çœŸå½å€¤ save bool trueï¼Œfalse çµæœã®çœŸå½å€¤ delete bool trueï¼Œfalse çµæœã®çœŸå½å€¤ CREATE ãƒ»createãƒ¡ã‚½ãƒƒãƒ‰ INSERTæ–‡ã‚’å®Ÿè¡Œã™ã‚‹ï¼Eloquentãƒ¢ãƒ‡ãƒ«ã«ã¯createãƒ¡ã‚½ãƒƒãƒ‰ãŒãªã„ãŸã‚ï¼Œä»£ã‚ã‚Šã«Eloquentãƒ“ãƒ«ãƒ€ãƒ¼ãŒæŒã¤createãƒ¡ã‚½ãƒƒãƒ‰ãŒã‚³ãƒ¼ãƒ«ã•ã‚Œã‚‹ï¼createãƒ¡ã‚½ãƒƒãƒ‰ã«æŒ¿å…¥å¯¾è±¡ã®ã‚«ãƒ©ãƒ ã¨å€¤ã‚’æ¸¡ã—ï¼Œã“ã‚Œã‚’å®Ÿè¡Œã™ã‚‹ï¼åˆ¥ã®æ–¹æ³•ã¨ã—ã¦ï¼ŒEloquentãƒ“ãƒ«ãƒ€ãƒ¼ã®fillãƒ¡ã‚½ãƒƒãƒ‰ã§æŒ¿å…¥å¯¾è±¡ã®ã‚«ãƒ©ãƒ ã¨å€¤ã‚’è¨­å®šã—ï¼Œsaveãƒ¡ã‚½ãƒƒãƒ‰ã‚’å®Ÿè¡Œã—ã¦ã‚‚ã‚ˆã„ï¼saveãƒ¡ã‚½ãƒƒãƒ‰ã¯UPDATEå‡¦ç†ã‚‚å®Ÿè¡Œã§ãã‚‹ãŒï¼Œfillãƒ¡ã‚½ãƒƒãƒ‰ã§IDå€¤ã‚’å‰²ã‚Šå½“ã¦ãªã„å ´åˆã¯ï¼ŒCREATEå‡¦ç†ãŒå®Ÿè¡Œã•ã‚Œã‚‹ï¼createãƒ¡ã‚½ãƒƒãƒ‰ã¾ãŸã¯saveãƒ¡ã‚½ãƒƒãƒ‰ã«ã‚ˆã‚‹CREATEå‡¦ç†ã§ã¯ï¼Œãƒ¬ã‚³ãƒ¼ãƒ‰ã®æŒ¿å…¥å¾Œã«ï¼ŒlastInsertIdãƒ¡ã‚½ãƒƒãƒ‰ã«ç›¸å½“ã™ã‚‹å‡¦ç†ãŒå®Ÿè¡Œã•ã‚Œã‚‹ï¼ã“ã‚Œã«ã‚ˆã‚Šï¼ŒæŒ¿å…¥ã•ã‚ŒãŸãƒ¬ã‚³ãƒ¼ãƒ‰ã®ãƒ—ãƒ©ã‚¤ãƒãƒªã‚­ãƒ¼ãŒå–å¾—ã•ã‚Œï¼ŒEloquentãƒ¢ãƒ‡ãƒ«ã®IDå€¤ã®ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã«ä¿æŒã•ã‚Œã‚‹ï¼ å‚è€ƒï¼š https://codelikes.com/laravel-eloquent-basic/#toc9 https://qiita.com/henriquebremenkanp/items/cd13944b0281297217a9 ï¼Šå®Ÿè£…ä¾‹ï¼Š create($request->all()); // ä»¥ä¸‹ã®å®Ÿè£…ã§ã‚‚ã‚ˆã„ // $foo->fill($request->all())->save(); // å‡¦ç†å¾Œã«ã¯Eloquentãƒ¢ãƒ‡ãƒ«ã«IDå€¤ãŒä¿æŒã•ã‚Œã¦ã„ã‚‹ï¼ $foo->id(); // ç¶šãã®å‡¦ç† } } Eloquentãƒ¢ãƒ‡ãƒ«ã«ã¯fillableãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã‚’è¨­å®šã—ã¦ãŠãï¼ READ ãƒ»allãƒ¡ã‚½ãƒƒãƒ‰ ãƒ¬ã‚³ãƒ¼ãƒ‰ã‚’å…¨ã¦å–å¾—ã™ã‚‹SELECTå¥ã‚’ç™ºè¡Œã™ã‚‹ï¼MySQLã‚’å«ã‚€DBã‚¨ãƒ³ã‚¸ãƒ³ã§ã¯ï¼Œå–å¾—çµæœã«æ¨™æº–ã®ä¸¦ã³é †ãŒå­˜åœ¨ã—ãªã„ãŸã‚ï¼Œãƒ—ãƒ©ã‚¤ãƒãƒªã‚­ãƒ¼ã®æ˜‡é †ã§å–å¾—ã—ãŸã„å ´åˆã¯ï¼ŒorderByãƒ¡ã‚½ãƒƒãƒ‰ã‚’ä½¿ç”¨ã—ã¦ï¼Œæ˜ç¤ºçš„ã«ä¸¦ã³æ›¿ãˆã‚‹ã‚ˆã†ã«ã™ã‚‹ï¼Eloquentãƒ¢ãƒ‡ãƒ«ã«ã¯allãƒ¡ã‚½ãƒƒãƒ‰ãŒãªã„ãŸã‚ï¼Œä»£ã‚ã‚Šã«Eloquentãƒ“ãƒ«ãƒ€ãƒ¼ãŒæŒã¤allãƒ¡ã‚½ãƒƒãƒ‰ãŒã‚³ãƒ¼ãƒ«ã•ã‚Œã‚‹ï¼å…¨ã¦ã®ãƒ—ãƒ©ã‚¤ãƒãƒªã‚­ãƒ¼ã®Collectionå‹ã‚’é…åˆ—å‹ã¨ã—ã¦è¿”å´ã™ã‚‹ï¼toArrayãƒ¡ã‚½ãƒƒãƒ‰ã§é…åˆ—å‹ã«å†å¸°çš„ã«å¤‰æ›ã§ãã‚‹ï¼ å‚è€ƒï¼š https://stackoverflow.com/questions/54526479/what-is-the-dafault-ordering-in-laravel-eloquent-modelall-function https://laravel.com/api/8.x/Illuminate/Support/Collection.html#method_all https://readouble.com/laravel/8.x/ja/eloquent.html#retrieving-models ï¼Šå®Ÿè£…ä¾‹ï¼Š all(); } } ãƒ»firstãƒ¡ã‚½ãƒƒãƒ‰ å–å¾—ã•ã‚ŒãŸã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³å‹ãƒ‡ãƒ¼ã‚¿ã®ä¸€ã¤ç›®ã®è¦ç´ ã®å€¤ã‚’å–å¾—ã™ã‚‹ï¼ãƒ¦ãƒ‹ãƒ¼ã‚¯åˆ¶ç´„ã®èª²ã›ã‚‰ã‚ŒãŸã‚«ãƒ©ãƒ ã‚’whereãƒ¡ã‚½ãƒƒãƒ‰ã®å¯¾è±¡ã¨ã™ã‚‹å ´åˆï¼Œã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã¨ã—ã¦å–å¾—ã•ã‚Œã‚‹ãŒï¼Œã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ãŒæŒã¤Eloquentãƒ¢ãƒ‡ãƒ«ã¯ä¸€ã¤ã§ã‚ã‚‹ï¼foreachã‚’ç”¨ã„ã¦ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã‹ã‚‰Eloquentãƒ¢ãƒ‡ãƒ«ã‚’å–ã‚Šå‡ºã—ã¦ã‚‚ã‚ˆã„ãŒï¼Œç„¡é§„ãŒå¤šã„ï¼ãã“ã§ï¼Œfirstãƒ¡ã‚½ãƒƒãƒ‰ã‚’ä½¿ç”¨ã—ã¦ï¼ŒEloquentãƒ¢ãƒ‡ãƒ«ã‚’ç›´æ¥å–å¾—ã™ã‚‹ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š where('foo_email', $emailAddress)->first(); } } ãƒ»findãƒ¡ã‚½ãƒƒãƒ‰ ãƒ¬ã‚³ãƒ¼ãƒ‰ã‚’ä¸€ã¤å–å¾—ã™ã‚‹SELECTå¥ã‚’ç™ºè¡Œã™ã‚‹ï¼Eloquentãƒ¢ãƒ‡ãƒ«ã«ã¯findãƒ¡ã‚½ãƒƒãƒ‰ãŒãªã„ãŸã‚ï¼Œä»£ã‚ã‚Šã«Eloquentãƒ“ãƒ«ãƒ€ãƒ¼ãŒæŒã¤findãƒ¡ã‚½ãƒƒãƒ‰ãŒã‚³ãƒ¼ãƒ«ã•ã‚Œã‚‹ï¼å¼•æ•°ã¨ã—ã¦ãƒ—ãƒ©ã‚¤ãƒãƒªã‚­ãƒ¼ã‚’æ¸¡ã—ãŸå ´åˆï¼ŒæŒ‡å®šã—ãŸãƒ—ãƒ©ã‚¤ãƒãƒªã‚­ãƒ¼ã‚’æŒã¤Eloquentãƒ¢ãƒ‡ãƒ«ã‚’è¿”å´ã™ã‚‹ï¼toArrayãƒ¡ã‚½ãƒƒãƒ‰ã§é…åˆ—å‹ã«å¤‰æ›ã§ãã‚‹ï¼ å‚è€ƒï¼š https://laravel.com/api/8.x/Illuminate/Database/Query/Builder.html#method_find https://readouble.com/laravel/8.x/ja/eloquent.html#retrieving-single-models ï¼Šå®Ÿè£…ä¾‹ï¼Š find($id); } } ãƒ»limitãƒ¡ã‚½ãƒƒãƒ‰ï¼Œoffsetãƒ¡ã‚½ãƒƒãƒ‰ é–‹å§‹åœ°ç‚¹ã‹ã‚‰æŒ‡å®šã—ãŸä»¶æ•°ã®ãƒ¬ã‚³ãƒ¼ãƒ‰ã‚’å…¨ã¦å–å¾—ã™ã‚‹SELECTå¥ã‚’ç™ºè¡Œã™ã‚‹ï¼ã“ã‚Œã«ã‚ˆã‚Šï¼Œãƒšãƒ¼ã‚¸ãƒãƒ¼ã‚·ãƒ§ãƒ³ã«ãŠã„ã¦ï¼Œï¼‘ãƒšãƒ¼ã‚¸å½“ãŸã‚Šã®ãƒ¬ã‚³ãƒ¼ãƒ‰æ•°ï¼ˆlimitï¼‰ã¨ï¼Œæ¬¡ã®ãƒšãƒ¼ã‚¸ã®é–‹å§‹ãƒ¬ã‚³ãƒ¼ãƒ‰ï¼ˆoffsetï¼‰ã‚’å®šç¾©ã§ãã‚‹ï¼ã“ã‚Œã‚‰ã®ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã¯ã‚¯ã‚¨ãƒªãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã¨ã—ã¦æ¸¡ã™ã¨ã‚ˆã„ï¼ å‚è€ƒï¼šhttps://readouble.com/laravel/8.x/ja/queries.html#ordering-grouping-limit-and-offset ï¼Šå®Ÿè£…ä¾‹ï¼Š offset($request->offset) ->limit($request->limit) ->get(); } } ãƒ»orderByãƒ¡ã‚½ãƒƒãƒ‰ æŒ‡å®šã—ãŸã‚«ãƒ©ãƒ ã®æ˜‡é †ï¼é™é †ã§ãƒ¬ã‚³ãƒ¼ãƒ‰ã‚’ä¸¦ã³æ›¿ãˆã‚‹SELECTå¥ã‚’ç™ºè¡Œã™ã‚‹ï¼ï¼ä¸¦ã³æ›¿ãˆãŸçµæœã‚’å–å¾—ã™ã‚‹ãŸã‚ã«ã¯ï¼Œgetãƒ¡ã‚½ãƒƒãƒ‰ã‚’ä½¿ç”¨ã™ã‚‹ï¼ãƒ—ãƒ©ã‚¤ãƒãƒªã‚­ãƒ¼ã®æ˜‡é †ã§å–å¾—ã™ã‚‹å ´åˆï¼Œallãƒ¡ã‚½ãƒƒãƒ‰ã§ã¯ãªãï¼ŒorderByãƒ¡ã‚½ãƒƒãƒ‰ã‚’ä½¿ç”¨ã—ã¦ï¼Œãƒ—ãƒ©ã‚¤ãƒãƒªã‚­ãƒ¼ã®æ˜‡é †ã‚’æ˜ç¤ºçš„ã«æŒ‡å®šã™ã‚‹ï¼ å‚è€ƒï¼šhttps://readouble.com/laravel/8.x/ja/queries.html#ordering-grouping-limit-and-offset ï¼Šå®Ÿè£…ä¾‹ï¼Š orderBy('foo_id', 'asc')->get(); } /** * @return Collection */ public function findAllByDesc(): Collection { $foo = new Foo(); // é™é † return $foo->orderBy('foo_id', 'desc')->get(); } } ãƒ»sortByãƒ¡ã‚½ãƒƒãƒ‰ æŒ‡å®šã—ãŸã‚«ãƒ©ãƒ ã®æ˜‡é †ã§ãƒ¬ã‚³ãƒ¼ãƒ‰ã‚’ä¸¦ã³æ›¿ãˆã‚‹SELECTå¥ã‚’ç™ºè¡Œã™ã‚‹ï¼ å‚è€ƒï¼šhttps://readouble.com/laravel/8.x/ja/collections.html#method-sortby ï¼Šå®Ÿè£…ä¾‹ï¼Š all()->sortBy('foo_id'); } } ãƒ»sortByDescãƒ¡ã‚½ãƒƒãƒ‰ æŒ‡å®šã—ãŸã‚«ãƒ©ãƒ ã®é™é †ã§ãƒ¬ã‚³ãƒ¼ãƒ‰ã‚’ä¸¦ã³æ›¿ãˆã‚‹SELECTå¥ã‚’ç™ºè¡Œã™ã‚‹ï¼ å‚è€ƒï¼šhttps://readouble.com/laravel/8.x/ja/collections.html#method-sortbydesc all()->sortByDesc('foo_id'); } } ãƒ»withãƒ¡ã‚½ãƒƒãƒ‰ è¦ªãƒ†ãƒ¼ãƒ–ãƒ«ã«ã‚¢ã‚¯ã‚»ã‚¹ã—ã¦å…¨ã¦ã®ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ã—ï¼Œè¦ªãƒ†ãƒ¼ãƒ–ãƒ«ã®Eloquentãƒ¢ãƒ‡ãƒ«ã®ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã«å­ãƒ†ãƒ¼ãƒ–ãƒ«ã®ãƒ¬ã‚³ãƒ¼ãƒ‰ã‚’ä¿æŒã™ã‚‹ï¼ã“ã®ä»•çµ„ã¿ã‚’Eagerãƒ­ãƒ¼ãƒ‰ã¨ã„ã†ï¼Eloquentãƒ¢ãƒ‡ãƒ«ã«ã¯withãƒ¡ã‚½ãƒƒãƒ‰ãŒãªã„ãŸã‚ï¼Œä»£ã‚ã‚Šã«Eloquentãƒ“ãƒ«ãƒ€ãƒ¼ãŒæŒã¤withãƒ¡ã‚½ãƒƒãƒ‰ãŒã‚³ãƒ¼ãƒ«ã•ã‚Œã‚‹ï¼ãƒ†ãƒ¼ãƒ–ãƒ«é–“ã«ä¸€å¯¾å¤šï¼ˆè¦ªå­ï¼‰ã®ãƒªãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚·ãƒƒãƒ—ãŒã‚ã‚‹å ´åˆã«ä½¿ç”¨ã™ã‚‹ï¼N+1å•é¡Œã‚’é˜²ã’ã‚‹ï¼ å‚è€ƒï¼šhttps://readouble.com/laravel/8.x/ja/eloquent-relationships.html#eager-loading ãŸã ã—ï¼Œwithãƒ¡ã‚½ãƒƒãƒ‰ã«ä»–ã®ãƒ¡ã‚½ãƒƒãƒ‰ã‚’ãƒã‚§ãƒ¼ãƒ³ã—ã¦ã—ã¾ã†ã¨ï¼ŒEagerãƒ­ãƒ¼ãƒ‰ã®å¾Œã«SQLã‚’ç™ºè¡Œã•ã‚Œã¦ã—ã¾ã†ãŸã‚ï¼ŒEagerãƒ­ãƒ¼ãƒ‰ã®æ©æµã‚’å¾—ã‚‰ã‚Œãªããªã‚‹ã“ã¨ã«æ³¨æ„ã™ã‚‹ï¼ å‚è€ƒï¼šhttps://qiita.com/shosho/items/abf6423283f761703d01#%E3%83%AA%E3%83%AC%E3%83%BC%E3%82%B7%E3%83%A7%E3%83%B3%E3%83%A1%E3%82%BD%E3%83%89%E3%82%92%E4%BD%BF%E3%81%A3%E3%81%A6%E3%81%97%E3%81%BE%E3%81%86%E3%81%A8-eager-loading-%E3%81%AB%E3%81%97%E3%81%A6%E3%81%A6%E3%82%82%E6%84%8F%E5%91%B3%E3%81%8C%E3%81%AA%E3%81%84%E3%81%AE%E3%81%A7%E6%B3%A8%E6%84%8F ï¼Šå®Ÿè£…ä¾‹ï¼Š ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ã«ã¦ï¼ŒDepartmentï¼ˆè¦ªï¼‰ã¨ï¼Œã“ã‚Œã«ç´ä»˜ãEmployeeï¼ˆå­ï¼‰ã‚’èª­ã¿å‡ºã™ï¼ã“ã‚Œã‚‰ã®ãƒ¢ãƒ‡ãƒ«ã®é–“ã§ã¯ï¼ŒhasManyãƒ¡ã‚½ãƒƒãƒ‰ã¨belongsToãƒ¡ã‚½ãƒƒãƒ‰ã‚’ä½¿ç”¨ã—ã¦ï¼Œãƒ†ãƒ¼ãƒ–ãƒ«ã«ãŠã‘ã‚‹ä¸€å¯¾å¤šã®ãƒªãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚’å®šç¾©ã—ã¦ãŠãï¼ with(\"employees\")->get(); foreach ($employees as $employee) { // ã“ã“ã§ã¯DBã‚¢ã‚¯ã‚»ã‚¹ã¯ã›ãšã«ï¼Œãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã«ä¿æŒã•ã‚ŒãŸå€¤ã‚’å–å¾—ã™ã‚‹ã ã‘ï¼ $name = $employee->name; } // ç¶šãã®å‡¦ç† } } Departmentï¼ˆè¦ªï¼‰ã«ï¼Œdepartmentsãƒ†ãƒ¼ãƒ–ãƒ«ã¨employeesãƒ†ãƒ¼ãƒ–ãƒ«ã®é–“ã«ï¼Œä¸€å¯¾å¤šã®é–¢ä¿‚ã‚’å®šç¾©ã™ã‚‹ï¼ hasMany(Employee::class); } } ã¾ãŸï¼ŒEmployeeï¼ˆå­ï¼‰ã«ï¼Œåå¯¾ã®å¤šå¯¾ä¸€ã®é–¢ä¿‚ã‚’å®šç¾©ã™ã‚‹ï¼ belongsTo(Department::class); } } UPDATE ãƒ»saveãƒ¡ã‚½ãƒƒãƒ‰ UPDATEæ–‡ã‚’å®Ÿè¡Œã™ã‚‹ï¼Eloquentãƒ“ãƒ«ãƒ€ãƒ¼ã®fillãƒ¡ã‚½ãƒƒãƒ‰ã§æŒ¿å…¥å¯¾è±¡ã®ã‚«ãƒ©ãƒ ã¨å€¤ã‚’è¨­å®šã—ï¼Œsaveãƒ¡ã‚½ãƒƒãƒ‰ã‚’å®Ÿè¡Œã™ã‚‹ï¼saveãƒ¡ã‚½ãƒƒãƒ‰ã¯CREATEå‡¦ç†ã‚‚å®Ÿè¡Œã§ãã‚‹ãŒï¼Œfillãƒ¡ã‚½ãƒƒãƒ‰ã§IDå€¤ã‚’å‰²ã‚Šå½“ã¦ãŸå ´åˆã¯ï¼ŒUPDATEå‡¦ç†ãŒå®Ÿè¡Œã•ã‚Œã‚‹ï¼ å‚è€ƒï¼š https://codelikes.com/laravel-eloquent-basic/#toc9 https://qiita.com/henriquebremenkanp/items/cd13944b0281297217a9 ï¼Šå®Ÿè£…ä¾‹ï¼Š fill($request->all())->save(); // ç¶šãã®å‡¦ç† } } Eloquentãƒ¢ãƒ‡ãƒ«ã«ã¯fillableãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã‚’è¨­å®šã—ã¦ãŠãï¼ DELETE ãƒ»destroyï¼deleteãƒ¡ã‚½ãƒƒãƒ‰ï¼ˆç‰©ç†å‰Šé™¤ï¼‰ DELETEæ–‡ã‚’å®Ÿè¡Œã™ã‚‹ï¼Eloquentãƒ¢ãƒ‡ãƒ«ã®destroyï¼deleteãƒ¡ã‚½ãƒƒãƒ‰ã‚’ä½¿ç”¨ã™ã‚‹ï¼æ‰‹é †ã¨ã—ã¦ï¼ŒEloquentãƒ“ãƒ«ãƒ€ãƒ¼ã®findãƒ¡ã‚½ãƒƒãƒ‰ã§å‰Šé™¤å¯¾è±¡ã®Modelã‚’æ¤œç´¢ã™ã‚‹ï¼è¿”å´ã•ã‚ŒãŸEloquentãƒ“ãƒ«ãƒ€ãƒ¼ã®destroyï¼deleteãƒ¡ã‚½ãƒƒãƒ‰ã‚’ã‚³ãƒ¼ãƒ«ã—ï¼Œè‡ªèº«ã‚’å‰Šé™¤ã™ã‚‹ï¼ ãƒ»SoftDeletesã®æœ‰åŠ¹åŒ–ï¼ˆè«–ç†å‰Šé™¤ï¼‰ å‰Šé™¤ãƒ•ãƒ©ã‚°ã‚’æ›´æ–°ã™ã‚‹UPDATEæ–‡ã‚’å®Ÿè¡Œã™ã‚‹ï¼Eloquentãƒ¢ãƒ‡ãƒ«ã®destroyï¼deleteãƒ¡ã‚½ãƒƒãƒ‰ã‚’ä½¿ç”¨ã™ã‚‹ï¼æ‰‹é †ã¨ã—ã¦ï¼Œãƒ†ãƒ¼ãƒ–ãƒ«ã«å¯¾å¿œã™ã‚‹Modelã«ã¦ï¼ŒSoftDeletesã®Traitã‚’èª­ã¿è¾¼ã‚€ï¼ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³æ™‚ã«è¿½åŠ ã•ã‚Œã‚‹delete_atã‚«ãƒ©ãƒ ã‚’SQLã§å–å¾—ã™ã‚‹æ™‚ã«ï¼ŒDataTimeã‚¯ãƒ©ã‚¹ã«å¤‰æ›ã§ãã‚‹ã‚ˆã†ã«ã—ã¦ãŠãï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãƒ•ã‚¡ã‚¤ãƒ«ã«ã¦softDeletesãƒ¡ã‚½ãƒƒãƒ‰ã‚’ä½¿ç”¨ã™ã‚‹ã¨ï¼Œå‰Šé™¤ãƒ•ãƒ©ã‚°ã¨ã—ã¦deleted_atã‚«ãƒ©ãƒ ãŒè¿½åŠ ã•ã‚Œã‚‹ã‚ˆã†ã«ãªã‚‹ï¼deleted_atã‚«ãƒ©ãƒ ã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã¯NULLã§ã‚ã‚‹ï¼ softDeletes(); // ï½ ä¸­ç•¥ ï½ }); } /** * ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯ * * @return void */ public function down() { Schema::drop(\"foo\"); } } ä¸Šè¨˜ã®çŠ¶æ…‹ã§ï¼ŒåŒæ§˜ã«destroyï¼deleteãƒ¡ã‚½ãƒƒãƒ‰ã‚’ä½¿ç”¨ã—ã¦ï¼Œè‡ªèº«ã‚’å‰Šé™¤ã™ã‚‹ï¼ç‰©ç†å‰Šé™¤ã§ã¯ãªãï¼Œdeleled_atã‚«ãƒ©ãƒ ãŒæ›´æ–°ã•ã‚Œã‚‹ã‚ˆã†ã«ãªã‚‹ï¼findãƒ¡ã‚½ãƒƒãƒ‰ã¯ï¼Œdeleled_atã‚«ãƒ©ãƒ ãŒNULLã§ãªã„ãƒ¬ã‚³ãƒ¼ãƒ‰ã‚’èª­ã¿å‡ºã•ãªã„ãŸã‚ï¼Œè«–ç†å‰Šé™¤ã‚’å®Ÿç¾ã§ãã‚‹ï¼ N+1å•é¡Œã®è§£æ±º ãƒ»N+1å•é¡Œã¨ã¯ è¦ªãƒ†ãƒ¼ãƒ–ãƒ«ã‚’çµŒç”±ã—ã¦å­ãƒ†ãƒ¼ãƒ–ãƒ«ã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹æ™‚ã«ï¼Œè¦ªãƒ†ãƒ¼ãƒ–ãƒ«ã®ãƒ¬ã‚³ãƒ¼ãƒ‰æ•°åˆ†ã®SQLã‚’ç™ºè¡Œã—ã¦ã—ã¾ã†ã‚¢ãƒ³ãƒãƒ‘ã‚¿ãƒ¼ãƒ³ã®ã“ã¨ï¼ ãƒ»å•é¡ŒãŒèµ·ã“ã‚‹å®Ÿè£… åå¾©å‡¦ç†ã®ä¸­ã§å­ãƒ†ãƒ¼ãƒ–ãƒ«ã®ãƒ¬ã‚³ãƒ¼ãƒ‰ã«ã‚¢ã‚¯ã‚»ã‚¹ã—ã¦ã—ã¾ã†å ´åˆï¼ŒN+1å•é¡ŒãŒèµ·ã“ã‚‹ï¼å†…éƒ¨çš„ã«ã¯ï¼Œè¦ªãƒ†ãƒ¼ãƒ–ãƒ«ã¸ã®SQLã¨ï¼ŒWhereå¥ã‚’æŒã¤SQLãŒè¦ªãƒ†ãƒ¼ãƒ–ãƒ«ã®ãƒ¬ã‚³ãƒ¼ãƒ‰æ•°åˆ†ã ã‘ç™ºè¡Œã•ã‚Œã‚‹ï¼ employees; // è¦ªãƒ†ãƒ¼ãƒ–ãƒ«ã®ãƒ¬ã‚³ãƒ¼ãƒ‰æ•°åˆ†ã®Whereå¥SQLãŒç™ºè¡Œã•ã‚Œã‚‹ï¼ˆNå›ï¼‰ } # 1å› select * from `departments` # Nå› select * from `employees` where `department_id` = 1 select * from `employees` where `department_id` = 2 select * from `employees` where `department_id` = 3 ... ãƒ»è§£æ±ºæ–¹æ³• åå¾©å‡¦ç†ã®å‰ã«å°ãƒ†ãƒ¼ãƒ–ãƒ«ã«ã‚¢ã‚¯ã‚»ã‚¹ã—ã¦ãŠãï¼ãƒ‡ãƒ¼ã‚¿ã‚¢ã‚¯ã‚»ã‚¹æ™‚ã«withãƒ¡ã‚½ãƒƒãƒ‰ã‚’ä½¿ã†ã¨ï¼Œè¦ªãƒ†ãƒ¼ãƒ–ãƒ«ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹ã«åŠ ãˆã¦ï¼Œè¦ªãƒ†ãƒ¼ãƒ–ãƒ«ã®Eloquentãƒ¢ãƒ‡ãƒ«ã®ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã«å­ãƒ†ãƒ¼ãƒ–ãƒ«ã®ãƒ¬ã‚³ãƒ¼ãƒ‰ã‚’ä¿æŒã™ã‚‹ã‚ˆã†ã«å‡¦ç†ã™ã‚‹ï¼ãã®ãŸã‚ï¼Œåå¾©å‡¦ç†ã§ã¯ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã‹ã‚‰ãƒ‡ãƒ¼ã‚¿ã‚’å–ã‚Šå‡ºã™ã ã‘ã«ãªã‚‹ï¼å†…éƒ¨çš„ã«ã¯ï¼Œè¦ªãƒ†ãƒ¼ãƒ–ãƒ«ã¸ã®SQLã¨ï¼ŒInå¥ã‚’ç”¨ã„ãŸSQLãŒç™ºè¡Œã•ã‚Œã‚‹ï¼ get(); // SQLç™ºè¡Œï¼ˆ2å›ï¼‰ foreach($departments as $department) { $department->employees; // ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’ä½¿ã†ã®ã§SQLã®ç™ºè¡Œã¯ã•ã‚Œãªã„ï¼ˆ0å›ï¼‰ } # 2å› select * from `departments` select * from `employees` where `department_id` in (1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11 ... 100) 05-03. Laravelã¸ã®ãƒªãƒã‚¸ãƒˆãƒªãƒ‘ã‚¿ãƒ¼ãƒ³å°å…¥ èƒŒæ™¯ Laravelã¯Active Recordãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’æ¡ç”¨ã—ã¦ãŠã‚Šï¼Œã“ã‚Œã¯ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ãŒè¤‡é›‘ã§ãªã„ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã«é©ã—ã¦ã„ã‚‹ï¼ãŸã ï¼Œãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ãŒè¤‡é›‘ãªã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã«å¯¾ã—ã¦ã‚‚ï¼ŒLaravelã‚’ä½¿ç”¨ã—ãŸã„å ´é¢ãŒã‚ã‚‹ï¼ãã®å ´åˆï¼ŒLaravelã«ãƒªãƒã‚¸ãƒˆãƒªãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’å°å…¥ã™ã‚‹ã“ã¨ãŒé¸æŠè‚¢ã®ä¸€ã¤ã«ãªã‚‹ï¼ãƒªãƒã‚¸ãƒˆãƒªãƒ‘ã‚¿ãƒ¼ãƒ³ã«ã¤ã„ã¦ã¯ï¼Œä»¥ä¸‹ã®ãƒªãƒ³ã‚¯ã‚’å‚è€ƒã«ã›ã‚ˆï¼ å‚è€ƒï¼šhttps://hiroki-it.github.io/tech-notebook-gitbook/public/software/software_application_architecture_backend_domain_driven_design_clean_architecture.html å·¥å¤« ãƒ»DTOã‚¯ãƒ©ã‚¹ã®å°å…¥ ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ç”¨ãƒ‰ãƒ¡ã‚¤ãƒ³ãƒ¢ãƒ‡ãƒ«ã¨ï¼ŒEloquentãƒ¢ãƒ‡ãƒ«ã‚’ç¶™æ‰¿ã—ãŸè©°ã‚æ›¿ãˆãƒ¢ãƒ‡ãƒ«ï¼ˆä¾‹ï¼šDTOã‚¯ãƒ©ã‚¹ï¼‰ã‚’ç”¨æ„ã™ã‚‹ï¼è©°ã‚æ›¿ãˆãƒ¢ãƒ‡ãƒ«ã‚’ãƒ‰ãƒ¡ã‚¤ãƒ³ãƒ¢ãƒ‡ãƒ«ã«å¤‰æ›ã™ã‚‹å‡¦ç†ã‚’ãƒ¡ã‚½ãƒƒãƒ‰ã¨ã—ã¦åˆ‡ã‚Šåˆ†ã‘ã¦ãŠãã¨ä¾¿åˆ©ã§ã‚ã‚‹ï¼ãƒ‰ãƒ¡ã‚¤ãƒ³ãƒ¢ãƒ‡ãƒ«ã¨DTOã‚¯ãƒ©ã‚¹ã®é–“ã§ãƒ‡ãƒ¼ã‚¿ã‚’è©°ã‚æ›¿ãˆã‚‹ã‚ˆã†ã«ã™ã‚‹ã¨ï¼ŒDTOã‚¯ãƒ©ã‚¹ãŒãƒ‰ãƒ¡ã‚¤ãƒ³ãƒ¢ãƒ‡ãƒ«ã¨ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®é–“ã§ãƒ¬ã‚³ãƒ¼ãƒ‰ã®ã‚„ã‚Šå–ã‚Šã‚’ä»²ä»‹ã—ï¼Œã“ã‚Œã‚‰ã‚’ç–çµåˆã«ã—ã¦ãã‚Œã‚‹ï¼ãã®ãŸã‚ï¼ŒRepositoryãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’å®Ÿç¾ã§ãã‚‹ï¼ id), new FooName($this->name), new FooAge($this->age), ); } } CREATE ãƒ»createãƒ¡ã‚½ãƒƒãƒ‰ ï¼Šå®Ÿè£…ä¾‹ï¼Š fooDTO = $fooDTO; } /** * @param Foo $foo * @return void */ public function create(Foo $foo): void { $this->fooDTO // INSERTæ–‡ã‚’å®Ÿè¡Œã™ã‚‹ï¼ ->create([ // ãƒ‰ãƒ¡ã‚¤ãƒ³ãƒ¢ãƒ‡ãƒ«ã®ãƒ‡ãƒ¼ã‚¿ã‚’DTOã«è©°ã‚æ›¿ãˆã‚‹ï¼ \"name\" => $foo->name(), \"age\" => $foo->age(), ]); // ä»¥ä¸‹ã®å®Ÿè£…ã§ã‚‚ã‚ˆã„ï¼ // $this->fooDTO // ->fill([ // \"name\" => $foo->name(), // \"age\" => $foo->age(), // ]) // ->save(); } } READ ãƒ»findãƒ¡ã‚½ãƒƒãƒ‰ ï¼Šå®Ÿè£…ä¾‹ï¼Š fooDTO = $fooDTO; } /** * @param FooId $fooId * @return Foo */ public function findById(FooId $fooId): Foo { $fooDTO = $this->fooDTO ->find($fooId->id()); // DBã‚¢ã‚¯ã‚»ã‚¹å‡¦ç†å¾Œã®DTOã‚’ãƒ‰ãƒ¡ã‚¤ãƒ³ãƒ¢ãƒ‡ãƒ«ã«å¤‰æ›ã™ã‚‹ï¼ return new Foo( $fooDTO->id(), $fooDTO->name(), $fooDTO->age(), $fooDTO->email() ); } } ãƒ»allãƒ¡ã‚½ãƒƒãƒ‰ ï¼Šå®Ÿè£…ä¾‹ï¼Š fooDTO = $fooDTO; } /** * @return array */ public function findAll(): array { $fooDTOs = $this->fooDTO ->all(); $foos = []; foreach ($fooDTOs as $fooDTO) // DBã‚¢ã‚¯ã‚»ã‚¹å¾Œã®DTOã‚’ãƒ‰ãƒ¡ã‚¤ãƒ³ãƒ¢ãƒ‡ãƒ«ã«å¤‰æ›ã™ã‚‹ï¼ $foos = new Foo( $fooDTO->id(), $fooDTO->name(), $fooDTO->age(), $fooDTO->email(), ); return $foos; } } ãƒ»withãƒ¡ã‚½ãƒƒãƒ‰ UPDATE ãƒ»saveãƒ¡ã‚½ãƒƒãƒ‰ ï¼Šå®Ÿè£…ä¾‹ï¼Š fooDTO = $fooDTO; } /** * @param Foo $foo * @return void */ public function save(Foo $foo): void { $this->fooDTO // ãƒ‰ãƒ¡ã‚¤ãƒ³ãƒ¢ãƒ‡ãƒ«ã®ãƒ‡ãƒ¼ã‚¿ã‚’DTOã«è©°ã‚æ›¿ãˆã‚‹ï¼ ->fill([ \"name\" => $foo->name(), \"age\" => $foo->age(), ]) // UPDATEæ–‡ã‚’å®Ÿè¡Œã™ã‚‹ï¼ ->save(); } } DELETE ãƒ»destroyï¼deleteãƒ¡ã‚½ãƒƒãƒ‰ ï¼Šå®Ÿè£…ä¾‹ï¼Š fooDTO = $fooDTO; } /** * @param FooId $fooId * @return void */ public function delete(FooId $fooId): void { // destroyãƒ¡ã‚½ãƒƒãƒ‰ã§ãƒ¬ã‚³ãƒ¼ãƒ‰ã‚’å‰Šé™¤ã™ã‚‹ï¼ $this->fooDTO->destroy($fooId->id()); // deleteãƒ¡ã‚½ãƒƒãƒ‰ã‚’ä½¿ç”¨ã—ã¦ã‚‚è‰¯ã„ï¼ // $this->fooDTO->find($fooId->id())->delete(); } } fooRepository = $fooRepository; } /** * @param FooId $fooId * @return mixed */ public function delete(FooId $fooId) { $this->fooRepository ->delete($fooId); return response()->view(\"foo\") ->setStatusCode(200); } } 06. Eventï¼Listener Event ãƒ»Eventã¨ã¯ ãƒ“ã‚¸ãƒã‚¹ã®å‡ºæ¥äº‹ãŒãƒ¢ãƒ‡ãƒªãƒ³ã‚°ã•ã‚ŒãŸã‚¤ãƒ™ãƒ³ãƒˆã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã¨ã—ã¦æ©Ÿèƒ½ã™ã‚‹ï¼ ãƒ»æ§‹æˆ ã‚¤ãƒ™ãƒ³ãƒˆã«é–¢ã™ã‚‹ãƒ‡ãƒ¼ã‚¿ã‚’ä¿æŒã™ã‚‹ã ã‘ã§ï¼Œãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ã‚’æŒãŸãªã„æ§‹æˆã¨ãªã‚‹ï¼ å‚è€ƒï¼šhttps://readouble.com/laravel/8.x/ja/events.html#defining-events ï¼Šå®Ÿè£…ä¾‹ï¼Š user = $user; } } ä»»æ„ã®å ´æ‰€ã§ã‚¤ãƒ™ãƒ³ãƒˆã‚’ç™ºè¡Œã§ãã‚‹ï¼ ãƒ»Eloquentãƒ¢ãƒ‡ãƒ«ã®CRUDã‚¤ãƒ™ãƒ³ãƒˆ Eloquentãƒ¢ãƒ‡ãƒ«ã§ã¯ï¼ŒDBã‚¢ã‚¯ã‚»ã‚¹ã«é–¢ã™ã‚‹ãƒ¡ã‚½ãƒƒãƒ‰ã®å®Ÿè¡Œé–‹å§‹ã‚„çµ‚äº†ã®å‡¦ç†ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã‚’ã‚¤ãƒ™ãƒ³ãƒˆã‚¯ãƒ©ã‚¹ã«ç´ä»˜ã‘ã‚‰ã‚Œã‚‹ï¼ç´ä»˜ã‘ã‚‹ãŸã‚ã«ï¼Œãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã§å®šç¾©ã™ã‚‹ã‹ï¼Œã‚ã‚‹ã„ã¯å„ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã§å®Ÿè¡Œã•ã‚Œã‚‹ã‚¯ãƒ­ãƒ¼ã‚¸ãƒ£ãƒ¼ã§ã‚¤ãƒ™ãƒ³ãƒˆã‚’ç™ºç”Ÿã•ã›ã‚‹å¿…è¦ãŒã‚ã‚‹ï¼ å‚è€ƒï¼šhttps://readouble.com/laravel/8.x/ja/eloquent.html#events ï¼Šå®Ÿè£…ä¾‹ï¼Š ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã«ã¦ï¼ŒCREATEå‡¦ç†ã¨DELETEå‡¦ç†ã«ç‹¬è‡ªã‚¤ãƒ™ãƒ³ãƒˆã‚¯ãƒ©ã‚¹ã«ç´ä»˜ã‘ã‚‹ï¼ UserSaved::class, 'deleted' => UserDeleted::class, ]; } ï¼Šå®Ÿè£…ä¾‹ï¼Š ã‚¯ãƒ­ãƒ¼ã‚¸ãƒ£ãƒ¼ã«ã¦ï¼ŒCREATEå‡¦ç†ã«ç‹¬è‡ªã‚¤ãƒ™ãƒ³ãƒˆã‚¯ãƒ©ã‚¹ã«ç´ä»˜ã‘ã‚‹ï¼ Listener ãƒ»Listenerã¨ã¯ ã‚¤ãƒ™ãƒ³ãƒˆãŒç™ºç”Ÿã—ãŸæ™‚ã«ï¼Œã“ã‚Œã«ç´ä»˜ã„ã¦ã‚³ãƒ¼ãƒ«ã•ã‚Œã‚‹ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®ã“ã¨ï¼ ãƒ»æ§‹æˆ Listenerã‚¯ãƒ©ã‚¹ãŒã‚³ãƒ¼ãƒ«ã•ã‚ŒãŸæ™‚ã«å®Ÿè¡Œã™ã‚‹å‡¦ç†ã‚’handleé–¢æ•°ã«å®šç¾©ã™ã‚‹ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š ãƒ¦ãƒ¼ã‚¶ãŒä½œæˆã•ã‚ŒãŸæ™‚ã«ï¼Œãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã«ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’é€ä¿¡ã™ã‚‹ï¼ user->userEmailAddress->emailAddress) ->notify(new UserCreatedEventNotification($userEvent->user)); } } ä»»æ„ã®å ´æ‰€ã§ã‚¤ãƒ™ãƒ³ãƒˆã‚’ç™ºè¡Œã™ã‚‹ã¨ï¼Œãƒªã‚¹ãƒŠãƒ¼ãŒè‡ªå‹•ã§ã‚³ãƒ¼ãƒ«ã•ã‚Œã‚‹ï¼ ãƒ»ã‚¤ãƒ™ãƒ³ãƒˆã¨ãƒªã‚¹ãƒŠãƒ¼ã®ç´ä»˜ã‘ EventServiceProviderã‚¯ãƒ©ã‚¹ã«ã¦ï¼ŒEventã‚¯ãƒ©ã‚¹ã«ç´ä»˜ã‘ã‚‹ä¸€ã¤ä»¥ä¸Šã®Listenerã‚¯ãƒ©ã‚¹ã‚’è¨­å®šã™ã‚‹ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š [ UserCreatedEventListener::class, ], ]; /** * @return void */ public function boot() { parent::boot(); // } } ãƒ»ä»»æ„ã®Eloquentãƒ¢ãƒ‡ãƒ«CRUDã‚¤ãƒ™ãƒ³ãƒˆã®æ¤œçŸ¥ Laravelã®å¤šãã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã«ï¼Œbootãƒ¡ã‚½ãƒƒãƒ‰ãŒå®šç¾©ã•ã‚Œã¦ã„ã‚‹ï¼Eloquentãƒ¢ãƒ‡ãƒ«ã§ã¯ï¼Œã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ç”Ÿæˆæ™‚ã«bootãƒ¡ã‚½ãƒƒãƒ‰ãŒã‚³ãƒ¼ãƒ«ã•ã‚Œï¼Œã“ã‚Œã«ã‚ˆã‚Šã«bootTraitsãƒ¡ã‚½ãƒƒãƒ‰ãŒå®Ÿè¡Œã•ã‚Œã‚‹ï¼Traitã«boot+ã¨ã„ã†åå‰ã®é™çš„ãƒ¡ã‚½ãƒƒãƒ‰ãŒå®šç¾©ã•ã‚Œã¦ã„ã‚‹ã¨ï¼ŒbootTraitsãƒ¡ã‚½ãƒƒãƒ‰ã¯ã“ã‚Œã‚’ã‚³ãƒ¼ãƒ«ã™ã‚‹ï¼bootTraitsãƒ¡ã‚½ãƒƒãƒ‰ã®ä¸­ã§Eloquentãƒ¢ãƒ‡ãƒ«ã®ã‚¤ãƒ™ãƒ³ãƒˆã‚’ç™ºç”Ÿã•ã›ã‚‹ã“ã¨ã«ã‚ˆã‚Šï¼Œå…¨ã¦ã®Eloquentãƒ¢ãƒ‡ãƒ«ã®ã‚¤ãƒ™ãƒ³ãƒˆã‚’ä¸€æ‹¬ã§ç™ºç«ã•ã›ã‚‰ã‚Œã‚‹ï¼ å‚è€ƒï¼šhttps://github.com/laravel/framework/blob/9362a29ce298428591369be8d101d51876406fc8/src/Illuminate/Database/Eloquent/Model.php#L255-L285 ï¼Šå®Ÿè£…ä¾‹ï¼Š ã‚ã‚‰ã‹ã˜ã‚Traitã‚’å®šç¾©ã™ã‚‹ï¼savedãƒ¡ã‚½ãƒƒãƒ‰ã«Eloquentãƒ¢ãƒ‡ãƒ«ã®æ›´æ–°ã‚¤ãƒ™ãƒ³ãƒˆã‚’ç™»éŒ²ã§ãã‚‹ã‚ˆã†ã«ã™ã‚‹ï¼ save($options); }); } } ã‚¤ãƒ™ãƒ³ãƒˆã‚’å®šç¾©ã™ã‚‹ï¼ $updatedModel = $updatedModel; } } Modelæ›´æ–°ã‚¤ãƒ™ãƒ³ãƒˆãŒç™ºç«ã—ã¦ã‚³ãƒ¼ãƒ«ã•ã‚Œã‚‹ãƒªã‚¹ãƒŠãƒ¼ã‚’å®šç¾©ã™ã‚‹ï¼create_byã‚«ãƒ©ãƒ ã¾ãŸã¯updated_byã‚«ãƒ©ãƒ ã‚’æŒ‡å®šã—ãŸæ›´æ–°è€…åã«æ›´æ–°ã§ãã‚‹ã‚ˆã†ã«ã™ã‚‹ï¼ãªãŠï¼Œã‚¤ãƒ™ãƒ³ãƒˆã¨ãƒªã‚¹ãƒŠãƒ¼ã®å¯¾å¿œé–¢ä¿‚ã¯ï¼ŒEventServiceProviderã§ç™»éŒ²ã™ã‚‹ï¼ getModelUpdater(); // create_byãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã«å€¤ãŒè¨­å®šã•ã‚Œã¦ã„ã‚‹ã‹ã‚’åˆ¤å®šï¼ if (is_null($updatedModelEvent->updatedModel->created_by)) { $updatedModelEvent->updatedModel->created_by = $by; } $updatedModelEvent->updatedModel->updated_by = $by; $updatedModelEvent->updatedModel->saveWithoutEvents(); } /** * æ›´æ–°å‡¦ç†ã®å®Ÿè¡Œè€…ã‚’å–å¾—ã—ã¾ã™ï¼ * * @return string */ private function getModelUpdater(): string { // ã‚³ãƒ³ã‚½ãƒ¼ãƒ«çµŒç”±ã§å®Ÿè¡Œã•ã‚ŒãŸã‹ã‚’åˆ¤å®šï¼ if (app()->runningInConsole()) { return ExecutorConstant::ARTISAN_COMMAND; } // APIèªè¨¼ã«æˆåŠŸã—ãŸã‹ã‚’åˆ¤å®šï¼ if (auth()->check()) { return ExecutorConstant::STAFF . \":\" . auth()->id(); } return ExecutorConstant::GUEST; } } å®Ÿè¡Œè€…åã¯ï¼Œå®šæ•°ã¨ã—ã¦ç®¡ç†ã—ã¦ãŠãã¨ã‚ˆã„ï¼ 07. Exception Laravelã«ãŠã‘ã‚‹ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚° ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã¯ï¼”ã¤ã®ã‚¹ãƒ†ãƒƒãƒ—ã‹ã‚‰ãªã‚‹ï¼Laravelã§ã¯æ¨™æº–ã§Handlerã‚¯ãƒ©ã‚¹ãŒå…¨ã¦ã®ã‚¹ãƒ†ãƒƒãƒ—ã‚’ã‚«ãƒãƒ¼ã—ã¦ã„ã‚‹ï¼ã¾ãŸåŠ ãˆã¦ï¼Œç•°å¸¸ç³»ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’è‡ªå‹•ã§è¿”ä¿¡ã—ã¦ãã‚Œã‚‹ï¼ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã®ã‚¹ãƒ†ãƒƒãƒ—ã®ã†ã¡ï¼Œã‚¨ãƒ©ãƒ¼æ¤œå‡ºã«ã¤ã„ã¦ã¯è¨€åŠã—ãªã„ã“ã¨ã¨ã™ã‚‹ï¼ å‚è€ƒï¼šhttps://hiroki-it.github.io/tech-notebook-gitbook/public/software/software_application_backend_php_logic_error_and_error_handling.html ä¾‹å¤–ã‚¹ãƒ­ãƒ¼ ãƒ»ä¾‹å¤– ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã¨ã—ã¦ã¾ã¨ã‚ã‚‰ã‚Œã¦ã„ãªã„ãŒï¼Œæ¨™æº–ã§æ§˜ã€…ãªä¾‹å¤–ãŒå‚™ã‚ã£ã¦ã„ã‚‹ï¼ å‚è€ƒï¼šhttps://laravel.com/api/8.x/search.html?search=exception ãƒ»ã‚¹ã‚¿ãƒƒã‚¯ãƒˆãƒ¬ãƒ¼ã‚¹ Laravelã¯ã‚¹ãƒ­ãƒ¼ã•ã‚Œã‚‹ä¾‹å¤–ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’ã‚¹ã‚¿ãƒƒã‚¯ãƒˆãƒ¬ãƒ¼ã‚¹ã§ç”Ÿæˆã™ã‚‹ï¼ã¾ãŸï¼ŒLaravelå†…éƒ¨ã§ä¾‹å¤–ã‚­ãƒ£ãƒƒãƒã¨æ–°ãŸãªä¾‹å¤–ã®æŠ•ã’ç›´ã—ãŒè¡Œã‚ã‚Œã‚‹ãŸã‚ï¼Œ[previous exception]ã«ã‚ˆã£ã¦ä¾‹å¤–ãŒçµåˆã•ã‚Œã‚‹ï¼ã‚¹ã‚¿ãƒƒã‚¯ãƒˆãƒ¬ãƒ¼ã‚¹ã«ã¯æ©Ÿå¯†æ€§ã®é«˜ã„æƒ…å ±ãŒå«ã¾ã‚Œã‚‹ãŸã‚ï¼Œã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã¸ã®ç•°å¸¸ç³»ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã®ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã«ã¯å‰²ã‚Šå½“ã¦ãšã«ï¼Œãƒ­ã‚®ãƒ³ã‚°ã ã‘ã—ã¦ãŠãï¼ã‚¨ãƒ©ãƒ¼ãŒè¤‡æ•°è¡Œã«ã¾ãŸãŒã‚‹ãŸã‚ï¼ŒCloudWatchã‚„FluentBitãªã©ã®ãƒ­ã‚°åé›†ãƒ„ãƒ¼ãƒ«ã§ã¯ï¼Œå„è¡Œã‚’ç¹‹ã’ã¦æ‰±ãˆã‚‹ã‚ˆã†ã«è¨­å®šãŒå¿…è¦ã§ã‚ã‚‹ï¼ã¡ãªã¿ã«ï¼Œãƒ­ã‚°ã®è©³ç´°åº¦ã¯APP_DEBUGç’°å¢ƒå¤‰æ•°ã§åˆ¶å¾¡ã§ãã‚‹ï¼ å‚è€ƒï¼šhttps://readouble.com/laravel/8.x/ja/errors.html#configuration [2021-09-00 00:00:00] local.ERROR: *****ï¼ˆã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ï¼‰ [stacktrace] #0 /var/www/foo-app/framework/src/Illuminate/Database/Connection.php(652): Illuminate\\\\Database\\\\Connection->runQueryCallback('insert into `us...', Array, Object(Closure)) #1 /var/www/foo-app/framework/src/Illuminate/Database/Connection.php(486): Illuminate\\\\Database\\\\Connection->run('insert into `us...', Array, Object(Closure)) #2 /var/www/foo-app/framework/src/Illuminate/Database/Connection.php(438): Illuminate\\\\Database\\\\Connection->statement('insert into `us...', Array) ... #60 /var/www/foo-app/framework/src/Illuminate/Foundation/Http/Kernel.php(141): Illuminate\\\\Pipeline\\\\Pipeline->then(Object(Closure)) #61 /var/www/foo-app/framework/src/Illuminate/Foundation/Http/Kernel.php(110): Illuminate\\\\Foundation\\\\Http\\\\Kernel->sendRequestThroughRouter(Object(Illuminate\\\\Http\\\\Request)) #62 /var/www/foo-app/public/index.php(55): Illuminate\\\\Foundation\\\\Http\\\\Kernel->handle(Object(Illuminate\\\\Http\\\\Request)) #63 {main} [previous exception] [object] *****ï¼ˆã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ï¼‰ [stacktrace] #0 /var/www/foo-app/vendor/doctrine/dbal/lib/Doctrine/DBAL/Driver/PDOStatement.php(114): Doctrine\\\\DBAL\\\\Driver\\\\PDO\\\\Exception::new(Object(PDOException)) #1 /var/www/foo-app/framework/src/Illuminate/Database/Connection.php(485): Doctrine\\\\DBAL\\\\Driver\\\\PDOStatement->execute() #2 /var/www/foo-app/framework/src/Illuminate/Database/Connection.php(685): Illuminate\\\\Database\\\\Connection->Illuminate\\\\Database\\\\{closure}('insert into `us...', Array) ... #63 /var/www/foo-app/framework/src/Illuminate/Foundation/Http/Kernel.php(141): Illuminate\\\\Pipeline\\\\Pipeline->then(Object(Closure)) #64 /var/www/foo-app/framework/src/Illuminate/Foundation/Http/Kernel.php(110): Illuminate\\\\Foundation\\\\Http\\\\Kernel->sendRequestThroughRouter(Object(Illuminate\\\\Http\\\\Request)) #65 /var/www/foo-app/public/index.php(55): Illuminate\\\\Foundation\\\\Http\\\\Kernel->handle(Object(Illuminate\\\\Http\\\\Request)) #66 {main} [previous exception] [object] *****ï¼ˆã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ï¼‰ [stacktrace] #0 /var/www/foo-app/vendor/doctrine/dbal/lib/Doctrine/DBAL/Driver/PDOStatement.php(112): PDOStatement->execute(NULL) #1 /var/www/foo-app/framework/src/Illuminate/Database/Connection.php(485): Doctrine\\\\DBAL\\\\Driver\\\\PDOStatement->execute() #2 /var/www/foo-app/framework/src/Illuminate/Database/Connection.php(685): Illuminate\\\\Database\\\\Connection->Illuminate\\\\Database\\\\{closure}('insert into `us...', Array) ... #63 /var/www/foo-app/framework/src/Illuminate/Foundation/Http/Kernel.php(141): Illuminate\\\\Pipeline\\\\Pipeline->then(Object(Closure)) #64 /var/www/foo-app/framework/src/Illuminate/Foundation/Http/Kernel.php(110): Illuminate\\\\Foundation\\\\Http\\\\Kernel->sendRequestThroughRouter(Object(Illuminate\\\\Http\\\\Request)) #65 /var/www/foo-app/public/index.php(55): Illuminate\\\\Foundation\\\\Http\\\\Kernel->handle(Object(Illuminate\\\\Http\\\\Request)) #66 {main} \"} ãƒ­ã‚®ãƒ³ã‚° ãƒ»reportãƒ¡ã‚½ãƒƒãƒ‰ Laravelå†…éƒ¨ã§ã‚­ãƒ£ãƒƒãƒã•ã‚ŒãŸä¾‹å¤–ã«åŸºã¥ã„ã¦ï¼Œãƒ­ã‚®ãƒ³ã‚°ã‚’å®Ÿè¡Œã™ã‚‹ï¼ å‚è€ƒï¼šhttps://cpoint-lab.co.jp/article/201905/9841/ ç•°å¸¸ç³»ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã®è¿”ä¿¡ ãƒ»renderãƒ¡ã‚½ãƒƒãƒ‰ Laravelå†…éƒ¨ã§ã‚­ãƒ£ãƒƒãƒã•ã‚ŒãŸä¾‹å¤–ã«åŸºã¥ã„ã¦ï¼Œç•°å¸¸ç³»ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’è‡ªå‹•ã§è¿”ä¿¡ã™ã‚‹ï¼ç•°å¸¸ç³»ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã®è¿”ä¿¡å‡¦ç†ã‚’ã“ã‚Œã«è¿½åŠ ã™ã‚‹ã“ã¨ã‚‚å¯èƒ½ã§ã‚ã‚‹ãŒï¼Œç•°å¸¸ç³»ãƒ¬ã‚¹ãƒãƒ³ã‚¹é–“ãŒå¯†çµåˆã«ãªã‚‹ãŸã‚ï¼Œã§ãã‚‹ã ã‘ã„ã˜ã‚‰ãªã„ï¼ãã®ä»£ã‚ã‚Šã«ï¼Œå„ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ã«try-catchã¨ç•°å¸¸ç³»ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã®è¿”ä¿¡å‡¦ç†ã‚’å®Ÿè£…ã™ã‚‹ã‚ˆã†ã«ã™ã‚‹ï¼ å‚è€ƒï¼šhttps://cpoint-lab.co.jp/article/201905/9841/ 08. Facade Facade ãƒ»Facadeã¨ã¯ Facadeã«ç™»éŒ²ã•ã‚ŒãŸã‚¯ãƒ©ã‚¹ï¼ˆFacadeã‚¯ãƒ©ã‚¹ï¼‰ã¨ServiceContainerã‚’ç¹‹ãé™çš„ãƒ—ãƒ­ã‚­ã‚·ã¨ã—ã¦åƒãï¼ãƒ¡ã‚½ãƒƒãƒ‰ã‚’ã‚³ãƒ¼ãƒ«ã§ãã‚‹ã‚ˆã†ã«ãªã‚‹ï¼ ãƒ»Facadeã‚’ä½¿ç”¨ã—ãªã„å ´åˆ newæ¼”ç®—å­ã§ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’ä½œæˆã™ã‚‹ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š method(); ãƒ»Facadeã®é™çš„ãƒ—ãƒ­ã‚­ã‚·æ©Ÿèƒ½ã‚’ä½¿ç”¨ã™ã‚‹å ´åˆ é™çš„ãƒ¡ã‚½ãƒƒãƒ‰ã®è¨˜æ³•ã§ã‚³ãƒ¼ãƒ«ã§ãã‚‹ï¼ãŸã ã—ï¼Œè‡ªä½œã‚¯ãƒ©ã‚¹ã‚’Facadeã®æ©Ÿèƒ½ã‚’ä½¿ç”¨ã—ã¦ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹åŒ–ã™ã‚‹ã¨ï¼Œã‚¹ãƒ‘ã‚²ãƒƒãƒ†ã‚£ãªã€Compositionï¼ˆåˆæˆï¼‰ã€ã®ä¾å­˜é–¢ä¿‚ã‚’ç”Ÿã˜ã•ã›ã¦ã—ã¾ã†ï¼ä¾‹ãˆã°ï¼ŒFacadeã®ä¸­ã§ã‚‚ï¼ŒRouteã®ã‚ˆã†ãªï¼Œä»£æ›¿ã™ã‚‹ã‚ˆã‚Šã‚‚Facadeã‚’ä½¿ã£ãŸã»ã†ãŒæ–­ç„¶ä¾¿åˆ©ã§ã‚ã‚‹éƒ¨åˆ†ä»¥å¤–ã¯ï¼Œä½¿ç”¨ã—ãªã„ã»ã†ãŒã‚ˆã„ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š Facadeã¨ã—ã¦ä½¿ç”¨ã—ãŸã„ã‚¯ãƒ©ã‚¹ã‚’å®šç¾©ã™ã‚‹ï¼ ã‚¨ã‚¤ãƒªã‚¢ã‚¹åã¨ã‚¯ãƒ©ã‚¹ã®åå‰ç©ºé–“ã‚’config/app.phpãƒ•ã‚¡ã‚¤ãƒ«ã‚’aliasesã‚­ãƒ¼ã«ç™»éŒ²ã™ã‚‹ã¨ï¼Œãã®ã‚¨ã‚¤ãƒªã‚¢ã‚¹åã§ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹åŒ–ã¨ãƒ¡ã‚½ãƒƒãƒ‰ã‚³ãƒ¼ãƒ«ã‚’è¡Œãˆã‚‹ã‚ˆã†ã«ãªã‚‹ï¼ [ \"Foo\" => App\\Models\\Foo::class, ] ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹åŒ–ã¨ãƒ¡ã‚½ãƒƒãƒ‰ã‚³ãƒ¼ãƒ«ã‚’è¡Œã†ï¼ ãƒ»Facadeã‚’ä½¿ç”¨ã—ãŸæ–¹ãŒè‰¯ã„å ´åˆ FacadeãŒãƒˆãƒ¬ã‚¤ãƒˆã®ä»£ã‚ã‚Šã«ãªã‚‹å ´åˆï¼ŒFacadeã‚’ä½¿ç”¨ã™ã‚‹ã“ã¨ã«ã‚ˆã‚Šï¼Œè²¬å‹™ãŒãƒ‰ãƒ¡ã‚¤ãƒ³ãƒ¢ãƒ‡ãƒ«ã«é›†ä¸­ã›ãšã«ã™ã‚€ï¼ ï¼Šä¾‹ï¼Š Notifiableãƒˆãƒ¬ã‚¤ãƒˆã‚’Userã‚¯ãƒ©ã‚¹ã§ä½¿ç”¨ã›ãšã«ï¼ŒNotificationãƒ•ã‚¡ã‚µãƒ¼ãƒ‰ã«ã‚ˆã‚‹ã‚ªãƒ³ãƒ‡ãƒãƒ³ãƒ‰é€šçŸ¥ã‚’ä½¿ç”¨ã™ã‚‹ã“ã¨ã«ã‚ˆã‚Šï¼ŒUserã‚¯ãƒ©ã‚¹ãŒé€šçŸ¥å‡¦ç†ã®è²¬å‹™ã‚’æŒãŸãšã«æ¸ˆã‚€ï¼è©³ã—ãã¯ï¼Œã‚ªãƒ³ãƒ‡ãƒãƒ³ãƒ‰é€šçŸ¥ã®èª¬æ˜ã‚’å‚è€ƒã«ã›ã‚ˆï¼ ãƒ»æ¨™æº–ç™»éŒ²ã•ã‚ŒãŸFacadeã‚¯ãƒ©ã‚¹ã®ç¨®é¡ ä»¥ä¸‹ã®ã‚¯ãƒ©ã‚¹ã¯ï¼Œãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ç™»éŒ²ã•ã‚Œã¦ã„ã‚‹Facadeã§ã‚ã‚‹ï¼ ã‚¨ã‚¤ãƒªã‚¢ã‚¹å ã‚¯ãƒ©ã‚¹å ã‚µãƒ¼ãƒ“ã‚¹ã‚³ãƒ³ãƒ†ãƒŠçµåˆã‚­ãƒ¼ App Illuminate\\Foundation\\Application app Artisan Illuminate\\Contracts\\Console\\Kernel artisan Auth Illuminate\\Auth\\AuthManager auth Auth (Instance) Illuminate\\Contracts\\Auth\\Guard auth.driver Blade Illuminate\\View\\Compilers\\BladeCompiler blade.compiler Broadcast Illuminate\\Contracts\\Broadcasting\\Factory Broadcast (Instance) Illuminate\\Contracts\\Broadcasting\\Broadcaster Bus Illuminate\\Contracts\\Bus\\Dispatcher Cache Illuminate\\Cache\\CacheManager cache Cache (Instance) Illuminate\\Cache\\Repository cache.store Config Illuminate\\Config\\Repository config Cookie Illuminate\\Cookie\\CookieJar cookie Crypt Illuminate\\Encryption\\Encrypter encrypter DB Illuminate\\Database\\DatabaseManager db DB (Instance) Illuminate\\Database\\Connection db.connection Event Illuminate\\Events\\Dispatcher events File Illuminate\\Filesystem\\Filesystem files Gate Illuminate\\Contracts\\Auth\\Access\\Gate Hash Illuminate\\Contracts\\Hashing\\Hasher hash Lang Illuminate\\Translation\\Translator translator Log Illuminate\\Log\\LogManager log Mail Illuminate\\Mail\\Mailer mailer Notification Illuminate\\Notifications\\ChannelManager Password Illuminate\\Auth\\Passwords\\PasswordBrokerManager auth.password Password (Instance) Illuminate\\Auth\\Passwords\\PasswordBroker auth.password.broker Queue Illuminate\\Queue\\QueueManager queue Queue (Instance) Illuminate\\Contracts\\Queue\\Queue queue.connection Queue (Base Class) Illuminate\\Queue\\Queue Redirect Illuminate\\Routing\\Redirector redirect Redis Illuminate\\Redis\\RedisManager redis Redis (Instance) Illuminate\\Redis\\Connections\\Connection redis.connection Request Illuminate\\Http\\Request request Response Illuminate\\Contracts\\Routing\\ResponseFactory Response (Instance) Illuminate\\Http\\Response Route Illuminate\\Routing\\Router router Schema Illuminate\\Database\\Schema\\Builder Session Illuminate\\Session\\SessionManager session Session (Instance) Illuminate\\Session\\Store session.store Storage Illuminate\\Filesystem\\FilesystemManager filesystem Storage (Instance) Illuminate\\Contracts\\Filesystem\\Filesystem filesystem.disk URL Illuminate\\Routing\\UrlGenerator url Validator Illuminate\\Validation\\Factory validator Validator (Instance) Illuminate\\Validation\\Validator View Illuminate\\View\\Factory view View (Instance) Illuminate\\View\\View Authãƒ•ã‚¡ã‚µãƒ¼ãƒ‰ ãƒ»Authãƒ•ã‚¡ã‚µãƒ¼ãƒ‰ã¨ã¯ èªè¨¼ã«é–¢ã™ã‚‹å‡¦ç†ã‚’æä¾›ã™ã‚‹ï¼Laravelã‹ã‚‰ã‚ã‚‰ã‹ã˜ã‚æä¾›ã•ã‚Œã¦ã„ã‚‹èªè¨¼ã‚’ä½¿ç”¨ã—ãªã„å ´åˆï¼ŒAuthãƒ•ã‚¡ã‚µãƒ¼ãƒ‰ã‚’ä½¿ç”¨ã—ã¦ï¼Œèªè¨¼ãƒ­ã‚¸ãƒƒã‚¯ã‚’å®Ÿè£…ã§ãã‚‹ï¼ DBãƒ•ã‚¡ã‚µãƒ¼ãƒ‰ ãƒ»DBãƒ•ã‚¡ã‚µãƒ¼ãƒ‰ã¨ã¯ ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®æ“ä½œå‡¦ç†ã‚’æä¾›ã™ã‚‹ï¼Eloquentã®ä»£ã‚ã‚Šã«ï¼ŒDBãƒ•ã‚¡ã‚µãƒ¼ãƒ‰ã‚’ä½¿ç”¨ã—ã¦ã‚‚è‰¯ã„ï¼Active Recordã®ãƒ­ã‚¸ãƒƒã‚¯ã‚’æŒãŸãªã„ãŸã‚ï¼ŒRepositoryãƒ‘ã‚¿ãƒ¼ãƒ³ã®ãƒ­ã‚¸ãƒƒã‚¯ã¨ã—ã¦ä½¿ç”¨ã§ãã‚‹ï¼ ãƒ»transactionãƒ¡ã‚½ãƒƒãƒ‰ ä¸€é€£ã®ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³å‡¦ç†ã‚’å®Ÿè¡Œã™ã‚‹ï¼å¼•æ•°ã¨ã—ã¦æ¸¡ã—ãŸç„¡åé–¢æ•°ãŒä¾‹å¤–ã‚’è¿”å´ã—ãŸå ´åˆï¼Œãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯ã‚’è‡ªå‹•çš„ã«å®Ÿè¡Œã™ã‚‹ï¼ä¾‹å¤–ãŒç™ºç”Ÿã—ãªã‹ã£ãŸå ´åˆï¼Œç„¡åé–¢æ•°ã®è¿”å´å€¤ãŒï¼Œãã®ã¾ã¾transactionãƒ¡ã‚½ãƒƒãƒ‰ã®è¿”å´å€¤ã«ãªã‚‹ï¼ã•ã‚‰ã«transactionãƒ¡ã‚½ãƒƒãƒ‰ã®è¿”å´å€¤ã‚’è¿”å´ã™ã‚‹ã‚ˆã†ã«ã™ã‚Œã°ï¼Œç„¡åé–¢æ•°ã®è¿”å´å€¤ã‚’ãã®ã¾ã¾ä½¿ç”¨ã§ãã‚‹ï¼ã¡ãªã¿ã«ï¼Œãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³å‡¦ç†ã¯å¿…é ˆã§ã¯ãªãï¼Œä½¿ç”¨ã™ã‚‹ã¨ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãŒãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚’æ“ä½œã™ã‚‹ãŸã‚ã«è¦ã™ã‚‹æ™‚é–“ãŒå¢—ãˆã‚‹ãŸã‚ï¼Œä½¿ç”¨ã—ãªãã¦ã‚‚è‰¯ã„ï¼å‚è€ƒãƒªãƒ³ã‚¯ã«ã‚ˆã‚‹ã¨ï¼ŒMongoDBã«å¯¾ã—ã¦ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³å‡¦ç†ã‚’è¡Œã†ï¼è¡Œã‚ãªã„å ´åˆã‚’æ¯”è¼ƒã—ã¦ï¼Œå‡¦ç†æ™‚é–“ãŒ17%å¼±é•·ããªã£ãŸã¨ã®ã“ã¨ï¼ å‚è€ƒï¼šhttps://rightcode.co.jp/blog/information-technology/node-js-mongodb-transaction-function-use#i-5 ï¼Šå®Ÿè£…ä¾‹ï¼Š fooDTO = $fooDTO; } /** * @param Foo $foo * @throws Throwable */ public function save(Foo $foo): void { // ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³å‡¦ç†ã‚’é–‹å§‹ã™ã‚‹ï¼ DB::beginTransaction(); try { $this->fooDTO->fill([ \"name\" => $foo->name(), \"age\" => $foo->age(), ]) ->save(); // ã‚³ãƒŸãƒƒãƒˆãƒ¡ãƒ³ãƒˆã‚’å®Ÿè¡Œã™ã‚‹ï¼ DB::commit(); } catch (Exception $e) { // ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯ã‚’å®Ÿè¡Œã™ã‚‹ï¼ DB::rollback(); } } } ãƒ»beginTransactionãƒ¡ã‚½ãƒƒãƒ‰ï¼Œcommitãƒ¡ã‚½ãƒƒãƒ‰ï¼Œrollbackãƒ¡ã‚½ãƒƒãƒ‰ï¼Œ ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³å‡¦ç†ã®å„æ“ä½œã‚’åˆ†å‰²ã—ã¦å®Ÿè¡Œã™ã‚‹ï¼åŸºæœ¬çš„ã«ã¯ï¼Œtransactionãƒ¡ã‚½ãƒƒãƒ‰ã‚’ä½¿ç”¨ã—ã¦ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³å‡¦ç†ã‚’å®Ÿè¡Œã™ã‚Œã°è‰¯ã„ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š fooDTO = $fooDTO; } /** * Fooã‚’æ›´æ–°ã—ã¾ã™ï¼ * * @param Foo $foo */ public function save(Foo $foo) { // ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³å‡¦ç†ã‚’é–‹å§‹ã™ã‚‹ï¼ DB::beginTransaction(); try { $this->fooDTO // ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã«ãƒ‡ãƒ¼ã‚¿ã‚’è¨­å®šã™ã‚‹ï¼ ->fill([ \"name\" => $foo->name(), \"age\" => $foo->age(), \"email\" => $foo->email() ]) // updateæ–‡ã‚’å®Ÿè¡Œã™ã‚‹ï¼ ->save(); // ã‚³ãƒŸãƒƒãƒˆãƒ¡ãƒ³ãƒˆã‚’å®Ÿè¡Œã™ã‚‹ï¼ DB::commit(); } catch (\\Exception $e) { // ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯ã‚’å®Ÿè¡Œã™ã‚‹ï¼ DB::rollback(); } } } Routeãƒ•ã‚¡ã‚µãƒ¼ãƒ‰ ãƒ»Routeãƒ•ã‚¡ã‚µãƒ¼ãƒ‰ã¨ã¯ ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°å‡¦ç†ã‚’æä¾›ã™ã‚‹ï¼ ãƒ»ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯ã¸ã®å¯¾å¿œ ALBã‚„Global Acceleratorã‹ã‚‰ã€/healthcheckã€ã«å¯¾ã—ã¦ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯ã‚’è¨­å®šã—ãŸä¸Šã§ï¼Œ200ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã®ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’è¿”ä¿¡ã™ã‚‹ã‚ˆã†ã«ã™ã‚‹ï¼Nginxã§ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯ã‚’å®Ÿè£…ã™ã‚‹ã“ã¨ã‚‚ã§ãã‚‹ãŒï¼Œã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®æ­»æ´»ç®¡ç†ã¨ã—ã¦ã¯ï¼ŒLaravelã«å®Ÿè£…ã™ã‚‹æ–¹ãŒé©åˆ‡ã§ã‚ã‚‹ï¼RouteServiceProviderã‚‚å‚ç…§ã›ã‚ˆï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š ãƒ»middlewareãƒ¡ã‚½ãƒƒãƒ‰ ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ã¸ã®ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°æ™‚ã«å®Ÿè¡Œã™ã‚‹Middlewareã‚¯ãƒ©ã‚¹ã‚’è¨­å®šã™ã‚‹ï¼å¼•æ•°ã¨ã—ã¦ï¼ŒApp\\Http\\Kernel.phpãƒ•ã‚¡ã‚¤ãƒ«ã§å®šç¾©ã•ã‚ŒãŸMiddlewareã‚¯ãƒ©ã‚¹ã®ã‚¨ã‚¤ãƒªã‚¢ã‚¹åã‚’è¨­å®šã™ã‚‹ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š èªè¨¼æ–¹æ³•ã¨ã—ã¦Webã‚¬ãƒ¼ãƒ‰ã‚’ä½¿ç”¨ã™ã‚‹å ´åˆï¼Œauthã‚¨ã‚¤ãƒªã‚¢ã‚¹ã‚’è¨­å®šã™ã‚‹ï¼ group(function () { Route::get(\"/foos\", [FooController::class, \"getFoo\"]); Route::get(\"/foos/{fooId}\", [FooController::class, \"index\"]); Route::post(\"/foos\", [FooController::class, \"createFoo\"]); Route::put(\"/foos/{fooId}\", [FooController::class, \"updateFoo\"]); Route::delete(\"/foos/{fooId}\", [FooController::class, \"deleteFoo\"]); }); ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ã¯ï¼ŒApp\\Http\\Kernel.phpãƒ•ã‚¡ã‚¤ãƒ«ã«ã¦ï¼Œauthã‚¨ã‚¤ãƒªã‚¢ã‚¹ã«\\App\\Http\\Middleware\\Authenticateã‚¯ãƒ©ã‚¹ãŒç´ä»˜ã‘ã‚‰ã‚Œã¦ã„ã‚‹ï¼ \\App\\Http\\Middleware\\Authenticate::class, ]; // ï½ ä¸­ç•¥ ï½ } ä¸€æ–¹ã§ï¼Œèªè¨¼æ–¹æ³•ã¨ã—ã¦APIã‚¬ãƒ¼ãƒ‰ã‚’ä½¿ç”¨ã™ã‚‹å ´åˆï¼Œauth:apiã‚¨ã‚¤ãƒªã‚¢ã‚¹ã‚’è¨­å®šã™ã‚‹ï¼ group(function () { // ä½•ã‚‰ã®ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚° }); ãƒ»prefixãƒ¡ã‚½ãƒƒãƒ‰ ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆãŒå…±é€šã¨ã—ã¦æŒã¤æœ€åˆã®ãƒ‘ã‚¹ã‚’ï¼Œãƒ—ãƒ¬ãƒ•ã‚£ã‚¯ã‚¹ã¨ã—ã¦å®šç¾©ã™ã‚‹ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š å„ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã®æœ€åˆã®ã€foosã€ã‚’ãƒ—ãƒ¬ãƒ•ã‚£ã‚¯ã‚¹ã¨ã—ã¦å®šç¾©ã™ã‚‹ï¼ group(function () { Route::get(\"/\", [FooController::class, \"getFoo\"]); Route::get(\"/{fooId}\", [FooController::class, \"index\"]); Route::post(\"/\", [FooController::class, \"createFoo\"]); Route::put(\"/{fooId}\", [FooController::class, \"updateFoo\"]); Route::delete(\"/{fooId}\", [FooController::class, \"deleteFoo\"]); }); ãƒ»whereãƒ¡ã‚½ãƒƒãƒ‰ï¼Œpatternãƒ¡ã‚½ãƒƒãƒ‰ ãƒ‘ã‚¹ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã«å¯¾ã™ã‚‹ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ãƒ«ãƒ¼ãƒ«ã‚’æ­£è¦è¡¨ç¾ã§å®šç¾©ã—ï¼Œã¾ãŸå®Ÿè¡Œã™ã‚‹ï¼RouteServiceProviderã®bootãƒ¡ã‚½ãƒƒãƒ‰ã«ã¦ï¼Œpatternãƒ¡ã‚½ãƒƒãƒ‰ã§åˆ¶ç´„ã‚’è¨­å®šã™ã‚‹ã“ã¨ã«ã‚ˆã£ã¦ï¼Œãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°æ™‚ã«whereã‚’ä½¿ç”¨ã™ã‚‹å¿…è¦ãŒãªããªã‚‹ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š userIdã®å½¢å¼ã‚’ã€0ã€œ9ãŒä¸€ã¤ä»¥ä¸Šã€ã«è¨­å®šã—ã¦ã„ã‚‹ï¼ group(function () { Route::get(\"/\", [FooController::class, \"getFoo\"]); Route::get(\"/{fooId}\", [FooController::class, \"index\"]) // ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ãƒ«ãƒ¼ãƒ« ->where(\"fooId\", \"[0-9]+\"); Route::post(\"/\", [FooController::class, \"createFoo\"]); Route::put(\"/{fooId}\", [FooController::class, \"updateFoo\"]) ->where(\"fooId\", \"[0-9]+\"); Route::delete(\"/{fooId}\", [FooController::class, \"deleteFoo\"]) ->where(\"fooId\", \"[0-9]+\"); }); ã¾ãŸã¯ï¼ŒRouteServiceProviderã‚¯ãƒ©ã‚¹ã«patternãƒ¡ã‚½ãƒƒãƒ‰ã‚’å®šç¾©ã™ã‚‹ã¨ï¼Œå„ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã«å¯¾ã™ã‚‹æ­£è¦è¡¨ç¾ã‚’ä¸€æ‹¬ã§å®Ÿè¡Œã§ãã‚‹ï¼ å‚è€ƒï¼šhttps://readouble.com/laravel/8.x/ja/routing.html#parameters-global-constraints ï¼Šå®Ÿè£…ä¾‹ï¼Š ãƒ»groupãƒ¡ã‚½ãƒƒãƒ‰ è¤‡æ•°ã®ã‚°ãƒ«ãƒ¼ãƒ—ã‚’çµ„ã¿åˆã‚ã›ã‚‹å ´åˆï¼Œgroupãƒ¡ã‚½ãƒƒãƒ‰ã‚’ä½¿ç”¨ã™ã‚‹ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã®ãƒ—ãƒ¬ãƒ•ã‚£ã‚¯ã‚¹ã¨ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢ã®æŒ‡å®šã‚’å®šç¾©ã™ã‚‹ï¼ \"foo\" , \"middleware\" => \"auth\"], (function () { Route::get(\"/\", [FooController::class, \"getFoo\"]); Route::get(\"/{fooId}\", [FooController::class, \"index\"]); Route::post(\"/\", [FooController::class, \"createFoo\"]); Route::put(\"/{fooId}\", [FooController::class, \"updateFoo\"]); Route::delete(\"/{fooId}\", [FooController::class, \"deleteFoo\"]); }); Storageãƒ•ã‚¡ã‚µãƒ¼ãƒ‰ ãƒ»Storageãƒ•ã‚¡ã‚µãƒ¼ãƒ‰ã¨ã¯ ãƒ•ã‚¡ã‚¤ãƒ«ã®å…¥å‡ºåŠ›å‡¦ç†ã‚’æä¾›ã™ã‚‹ï¼ ãƒ»ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ï¼ˆéå…¬é–‹ï¼‰ã®å ´åˆ ãƒ•ã‚¡ã‚¤ãƒ«ã‚’/storage/appãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ä¿å­˜ã™ã‚‹ï¼ã“ã®ãƒ•ã‚¡ã‚¤ãƒ«ã¯éå…¬é–‹ã§ã‚ã‚Šï¼Œãƒªã‚¯ã‚¨ã‚¹ãƒˆã«ã‚ˆã£ã¦ã‚¢ã‚¯ã‚»ã‚¹ã§ããªã„ï¼äº‹å‰ã«ï¼Œã‚·ãƒ³ãƒœãƒªãƒƒã‚¯ãƒªãƒ³ã‚¯ã‚’ä½œæˆã™ã‚‹ï¼Œã¾ãŸï¼Œfilesystems.phpãƒ•ã‚¡ã‚¤ãƒ«ã«è¨­å®šãŒå¿…è¦ã§ã‚ã‚‹ï¼ $ php artisan storage:link return [ \"default\" => env(\"FILESYSTEM_DRIVER\", \"local\"), // ï½ ä¸­ç•¥ ï½ \"disks\" => [ \"local\" => [ \"driver\" => \"local\", \"root\" => storage_path(\"app\"), ], // ï½ ä¸­ç•¥ ï½ // ã‚·ãƒ³ãƒœãƒªãƒƒã‚¯ãƒªãƒ³ã‚¯ã®é–¢ä¿‚ã‚’å®šç¾© \"links\" => [ // ã€/var/www/project/public/storageã€ã‹ã‚‰ã€/var/www/project/storage/app/publicã€ã¸ã®ãƒªãƒ³ã‚¯ public_path(\"storage\") => storage_path(\"app/public\"), ], ]; ï¼Šå®Ÿè£…ä¾‹ï¼Š Storageãƒ•ã‚¡ã‚µãƒ¼ãƒ‰ã®diskãƒ¡ã‚½ãƒƒãƒ‰ã‚’ç”¨ã„ã¦localãƒ‡ã‚£ã‚¹ã‚¯ã‚’æŒ‡å®šã™ã‚‹ï¼file.txtãƒ•ã‚¡ã‚¤ãƒ«ã‚’storage/app/file.txtã¨ã—ã¦ä¿å­˜ã™ã‚‹ï¼ Storage::disk(\"local\")->put(\"file.txt\", \"file.txt\"); ãŸã ã—ï¼Œfilesytems.phpãƒ•ã‚¡ã‚¤ãƒ«ã§ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆãƒ‡ã‚£ã‚¹ã‚¯ã¯localã«ãªã£ã¦ã„ã‚‹ãŸã‚ï¼Œputãƒ¡ã‚½ãƒƒãƒ‰ã‚’ç›´æ¥ä½¿ç”¨ã§ãã‚‹ï¼ Storage::put(\"file.txt\", \"file.txt\"); ãƒ»ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ï¼ˆå…¬é–‹ï¼‰ã®å ´åˆ ãƒ•ã‚¡ã‚¤ãƒ«ã‚’storage/app/publicãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ä¿å­˜ã™ã‚‹ï¼ã“ã®ãƒ•ã‚¡ã‚¤ãƒ«ã¯å…¬é–‹ã§ã‚ã‚Šï¼Œãƒªã‚¯ã‚¨ã‚¹ãƒˆã«ã‚ˆã£ã¦ã‚¢ã‚¯ã‚»ã‚¹ã§ãã‚‹ï¼äº‹å‰ã«ï¼Œfilesystems.phpãƒ•ã‚¡ã‚¤ãƒ«ã«è¨­å®šãŒå¿…è¦ã§ã‚ã‚‹ï¼ return [ \"default\" => env(\"FILESYSTEM_DRIVER\", \"local\"), // ï½ ä¸­ç•¥ ï½ \"disks\" => [ // ï½ ä¸­ç•¥ ï½ \"public\" => [ \"driver\" => \"local\", \"root\" => storage_path(\"app/public\"), \"url\" => env(\"APP_URL\") . \"/storage\", \"visibility\" => \"public\", ], // ï½ ä¸­ç•¥ ï½ ], ]; ï¼Šå®Ÿè£…ä¾‹ï¼Š Storageãƒ•ã‚¡ã‚µãƒ¼ãƒ‰ã®diskãƒ¡ã‚½ãƒƒãƒ‰ã‚’ç”¨ã„ã¦publicãƒ‡ã‚£ã‚¹ã‚¯ã‚’æŒ‡å®šã™ã‚‹ï¼ã¾ãŸï¼Œfile.txtãƒ•ã‚¡ã‚¤ãƒ«ã‚’storage/app/public/file.txtã¨ã—ã¦ä¿å­˜ã™ã‚‹ï¼ Storage::disk(\"s3\")->put(\"file.txt\", \"file.txt\"); ãŸã ã—ï¼Œç’°å¢ƒå¤‰æ•°ã‚’ä½¿ç”¨ã—ã¦ï¼Œfilesytems.phpãƒ•ã‚¡ã‚¤ãƒ«ã§ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆãƒ‡ã‚£ã‚¹ã‚¯ã‚’s3ã«å¤‰æ›´ã™ã‚‹ã¨ï¼Œputãƒ¡ã‚½ãƒƒãƒ‰ã‚’ç›´æ¥ä½¿ç”¨ã§ãã‚‹ï¼ FILESYSTEM_DRIVER=s3 Storage::put(\"file.txt\", \"file.txt\"); ï¼Šå®Ÿè£…ä¾‹ï¼Š put($saved_file_path, $contents); } } ãƒ»ã‚¯ãƒ©ã‚¦ãƒ‰ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã®å ´åˆ ãƒ•ã‚¡ã‚¤ãƒ«ã‚’S3ãƒã‚±ãƒƒãƒˆå†…ã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ä¿å­˜ã™ã‚‹ï¼ç’°å¢ƒå¤‰æ•°ã‚’.envãƒ•ã‚¡ã‚¤ãƒ«ã«å®Ÿè£…ã™ã‚‹å¿…è¦ãŒã‚ã‚‹ï¼filesystems.phpãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰ï¼ŒæŒ‡å®šã•ã‚ŒãŸè¨­å®šãŒé¸æŠã•ã‚Œã‚‹ï¼AWSã‚¢ã‚«ã‚¦ãƒ³ãƒˆã®èªè¨¼æƒ…å ±ã‚’ç’°å¢ƒå¤‰æ•°ã¨ã—ã¦è¨­å®šã™ã‚‹ã‹ï¼Œã¾ãŸã¯S3ã‚¢ã‚¯ã‚»ã‚¹ãƒãƒªã‚·ãƒ¼ã‚’EC2ã‚„ECSã‚¿ã‚¹ã‚¯ã«ä»˜ä¸ã™ã‚‹ã“ã¨ã«ã‚ˆã‚Šï¼ŒS3ã«ã‚¢ã‚¯ã‚»ã‚¹ã§ãã‚‹ã‚ˆã†ã«ãªã‚‹ï¼äº‹å‰ã«ï¼Œfilesystems.phpãƒ•ã‚¡ã‚¤ãƒ«ã«è¨­å®šãŒå¿…è¦ã§ã‚ã‚‹ï¼ # S3ã‚¢ã‚¯ã‚»ã‚¹ãƒãƒªã‚·ãƒ¼ã‚’EC2ã‚„ECSã‚¿ã‚¹ã‚¯ã«ä»˜ä¸ã—ã¦ã‚‚ã‚ˆã„ AWS_ACCESS_KEY_ID= AWS_SECRET_ACCESS_KEY= AWS_DEFAULT_REGION= # å¿…é ˆ AWS_BUCKET= return [ \"default\" => env(\"FILESYSTEM_DRIVER\", \"local\"), // ï½ ä¸­ç•¥ ï½ \"disks\" => [ // ï½ ä¸­ç•¥ ï½ \"s3\" => [ \"driver\" => \"s3\", \"key\" => env(\"AWS_ACCESS_KEY_ID\"), \"secret\" => env(\"AWS_SECRET_ACCESS_KEY\"), \"region\" => env(\"AWS_DEFAULT_REGION\"), \"bucket\" => env(\"AWS_BUCKET\"), \"url\" => env(\"AWS_URL\"), \"endpoint\" => env(\"AWS_ENDPOINT\"), ], ], ]; ï¼Šå®Ÿè£…ä¾‹ï¼Š Storageãƒ•ã‚¡ã‚µãƒ¼ãƒ‰ã®diskãƒ¡ã‚½ãƒƒãƒ‰ã‚’ç”¨ã„ã¦s3ãƒ‡ã‚£ã‚¹ã‚¯ã‚’æŒ‡å®šã™ã‚‹ï¼ã¾ãŸï¼Œfile.txtãƒ•ã‚¡ã‚¤ãƒ«ã‚’S3ãƒã‚±ãƒƒãƒˆã®ãƒ«ãƒ¼ãƒˆã«file.txtã¨ã—ã¦ä¿å­˜ã™ã‚‹ï¼ Storage::disk(\"s3\")->put(\"file.txt\", \"file.txt\"); ä»–ã®å®Ÿè£…æ–¹æ³•ã¨ã—ã¦ï¼Œç’°å¢ƒå¤‰æ•°ã‚’ä½¿ç”¨ã—ã¦ï¼Œfilesytems.phpãƒ•ã‚¡ã‚¤ãƒ«ã§ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆãƒ‡ã‚£ã‚¹ã‚¯ã‚’s3ã«å¤‰æ›´ã™ã‚‹ã¨ï¼Œputãƒ¡ã‚½ãƒƒãƒ‰ã‚’ç›´æ¥ä½¿ç”¨ã§ãã‚‹ï¼ FILESYSTEM_DRIVER=s3 Storage::put(\"file.txt\", \"file.txt\"); Validatorãƒ•ã‚¡ã‚µãƒ¼ãƒ‰ ãƒ»Validatorãƒ•ã‚¡ã‚µãƒ¼ãƒ‰ã¨ã¯ ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³å‡¦ç†ã‚’æä¾›ã™ã‚‹ï¼FormRequestã‚¯ãƒ©ã‚¹ã®validatedãƒ¡ã‚½ãƒƒãƒ‰ã‚„validateãƒ¡ã‚½ãƒƒãƒ‰ã®ä»£ã‚ã‚Šã«ï¼ŒValidatorãƒ•ã‚¡ã‚µãƒ¼ãƒ‰ã‚’ä½¿ç”¨ã—ã¦ã‚‚è‰¯ã„ï¼ ãƒ»Validatorã‚¯ãƒ©ã‚¹ï¼Œfailsãƒ¡ã‚½ãƒƒãƒ‰ Validateãƒ•ã‚¡ã‚µãƒ¼ãƒ‰ã®makeãƒ¡ã‚½ãƒƒãƒ‰ã‚’ä½¿ç”¨ã—ã¦ï¼Œãƒ«ãƒ¼ãƒ«ã‚’å®šç¾©ã™ã‚‹ï¼ã“ã®æ™‚ï¼Œç¬¬ä¸€å¼•æ•°ã§ï¼Œãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’è¡Œã†ãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ã‚’æ¸¡ã™ï¼ãƒ«ãƒ¼ãƒ«ã«åã™ã‚‹ã¨ï¼Œä¸€ã¤ç›®ã®ãƒ«ãƒ¼ãƒ«åï¼ˆä¾‹ãˆã°requiredï¼‰ã«åŸºã¥ãï¼Œvalidation.phpãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰å¯¾å¿œã™ã‚‹ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è‡ªå‹•çš„ã«é¸æŠã™ã‚‹ï¼æ¬¡ã«ï¼Œfailsãƒ¡ã‚½ãƒƒãƒ‰ã‚’ä½¿ç”¨ã—ã¦ï¼Œãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã§ã‚¨ãƒ©ãƒ¼ãŒèµ·ã“ã£ãŸå ´åˆã®å‡¦ç†ã‚’å®šç¾©ã™ã‚‹ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š all(), [ \"title\" => \"required|unique:posts|max:255\", \"body\" => \"required\", ]); // ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³æ™‚ã«ã‚¨ãƒ©ãƒ¼ãŒèµ·ã“ã£ãŸå ´åˆ if ($validator->fails()) { // æŒ‡å®šã—ãŸãƒšãƒ¼ã‚¸ã«ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ // validatorã‚’æ¸¡ã™ã“ã¨ã§ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’Viewã«æ¸¡ã›ã‚‹ï¼ return redirect(\"error\")->withErrors($validator) ->withInput(); } // ç¶šãã®å‡¦ç† } } ãƒ»validateãƒ¡ã‚½ãƒƒãƒ‰ Validatorã‚¯ãƒ©ã‚¹ã®validateãƒ¡ã‚½ãƒƒãƒ‰ã‚’ä½¿ç”¨ã™ã‚‹ã¨ï¼ŒFormRequestã‚¯ãƒ©ã‚¹ã®validateãƒ¡ã‚½ãƒƒãƒ‰ã¨åŒæ§˜ã®å‡¦ç†ãŒå®Ÿè¡Œã•ã‚Œã‚‹ï¼ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã§ã‚¨ãƒ©ãƒ¼ãŒèµ·ã“ã£ãŸå ´åˆï¼ŒHandlerã‚¯ãƒ©ã‚¹ã®invalidãƒ¡ã‚½ãƒƒãƒ‰ãŒã‚³ãƒ¼ãƒ«ã•ã‚Œï¼Œå…ƒã€…ã®ãƒšãƒ¼ã‚¸ã«ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆã•ã‚Œã‚‹ï¼ all(), [ \"title\" => \"required|unique:posts|max:255\", \"body\" => \"required\", ])->validate(); // ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³æ™‚ã«ã‚¨ãƒ©ãƒ¼ãŒèµ·ã“ã£ãŸå ´åˆ if ($validator->fails()) { // æŒ‡å®šã—ãŸãƒšãƒ¼ã‚¸ã«ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ // validatorã‚’æ¸¡ã™ã“ã¨ã§ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’Viewã«æ¸¡ã›ã‚‹ï¼ return redirect(\"error\")->withErrors($validator) ->withInput(); } // ç¶šãã®å‡¦ç† } } 08-02. ã‚ˆãä½¿ã†ã‚°ãƒ­ãƒ¼ãƒãƒ«ãƒ˜ãƒ«ãƒ‘ãƒ¼é–¢æ•° ãƒ˜ãƒ«ãƒ‘ãƒ¼é–¢æ•° ãƒ»ãƒ˜ãƒ«ãƒ‘ãƒ¼é–¢æ•°ã¨ã¯ ã‚°ãƒ­ãƒ¼ãƒãƒ«ã«ã‚³ãƒ¼ãƒ«ã§ãã‚‹Laravelå°‚ç”¨ã®ãƒ¡ã‚½ãƒƒãƒ‰ã®ã“ã¨ï¼åŸºæœ¬çš„ã«ã¯ï¼Œãƒ˜ãƒ«ãƒ‘ãƒ¼é–¢æ•°ã§å®Ÿè¡Œã•ã‚Œã‚‹å‡¦ç†ã¯ï¼ŒFacadeã®å†…éƒ¨ã§å®Ÿè¡Œã•ã‚Œã‚‹ã‚‚ã®ã¨åŒã˜ã§ã‚ã‚‹ï¼ã©ã¡ã‚‰ã‚’ä½¿ç”¨ã™ã‚‹ã‹ã¯å¥½ã¿ã§ã‚ã‚‹ï¼ å‚è€ƒï¼šhttps://stackoverflow.com/questions/31324226/laravel-performance-of-facades-vs-helper-methods ãƒ»ä¸€è¦§ ä»¥ä¸‹ãƒªãƒ³ã‚¯ã‚’å‚ç…§ã›ã‚ˆï¼ https://readouble.com/laravel/8.x/ja/helpers.html#method-view authãƒ˜ãƒ«ãƒ‘ãƒ¼ ãƒ»AuthManagerã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã®è¿”å´ èªè¨¼å‡¦ç†ã‚’æŒã¤AuthManagerã‚¯ãƒ©ã‚¹ã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’è¿”å´ã™ã‚‹ï¼ å‚è€ƒï¼šhttps://laravel.com/api/8.x/Illuminate/Auth/AuthManager.html configãƒ˜ãƒ«ãƒ‘ãƒ¼ ãƒ»ç’°å¢ƒå¤‰æ•°ãƒ•ã‚¡ã‚¤ãƒ«ã®èª­ã¿è¾¼ã¿ ç’°å¢ƒå¤‰æ•°ãƒ•ã‚¡ã‚¤ãƒ«åã¨ã‚­ãƒ¼åã‚’ãƒ‰ãƒƒãƒˆã§æŒ‡å®šã—ï¼Œäº‹å‰ã«è¨­å®šã•ã‚ŒãŸå€¤ã‚’å‡ºåŠ›ã™ã‚‹ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š æ¨™æº–ã§æ­è¼‰ã•ã‚Œã¦ã„ã‚‹app.phpãƒ•ã‚¡ã‚¤ãƒ«ã®timezoneã‚­ãƒ¼ã®å€¤ã‚’å‡ºåŠ›ã™ã‚‹ï¼ ãƒ»ç‹¬è‡ªç’°å¢ƒå¤‰æ•°ãƒ•ã‚¡ã‚¤ãƒ«ã®ä½œæˆã¨èª­ã¿è¾¼ã¿ configãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ä»»æ„ã®åå‰ã®phpå½¢å¼ã‚’ä½œæˆã—ã¦ãŠãï¼ã“ã‚Œã¯ï¼Œconfigãƒ˜ãƒ«ãƒ‘ãƒ¼ã§èª­ã¿è¾¼ã‚€ã“ã¨ãŒã§ãã‚‹ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š [ \"endpoint_url\" => env(\"ENDPOINT_URL\", \"\"), \"api_key\" => env(\"API_KEY\"), ], \"bar\" => [ \"endpoint_url\" => env(\"ENDPOINT_URL\", \"\"), \"api_key\" => env(\"API_KEY\"), ] ]; bcryptãƒ˜ãƒ«ãƒ‘ãƒ¼ å‚è€ƒï¼šhttps://readouble.com/laravel/8.x/ja/helpers.html#method-bcrypt redirectãƒ˜ãƒ«ãƒ‘ãƒ¼ å‚è€ƒï¼šhttps://blog.capilano-fw.com/?p=566 responseãƒ˜ãƒ«ãƒ‘ãƒ¼ ãƒ»JSONãƒ‡ãƒ¼ã‚¿ã®ãƒ¬ã‚¹ãƒãƒ³ã‚¹ è¿”å´ã•ã‚Œã‚‹ResponseFactoryã‚¯ãƒ©ã‚¹ã®jsonãƒ¡ã‚½ãƒƒãƒ‰ã«ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã—ãŸã„JSONãƒ‡ãƒ¼ã‚¿ã‚’è¨­å®šã™ã‚‹ï¼responseãƒ˜ãƒ«ãƒ‘ãƒ¼ã¯åˆæœŸå€¤ã¨ã—ã¦200ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãŒè¨­å®šã•ã‚Œã¦ã„ã‚‹ãŒï¼Œviewãƒ¡ã‚½ãƒƒãƒ‰ã‚„setStatusCodeãƒ¡ã‚½ãƒƒãƒ‰ã‚’ä½¿ç”¨ã—ã¦ï¼Œæ˜ç¤ºçš„ã«è¨­å®šã—ã¦ã‚‚ã‚ˆã„ï¼ å‚è€ƒï¼šhttps://github.com/laravel/framework/blob/8.x/src/Illuminate/Contracts/Routing/ResponseFactory.php ï¼Šå®Ÿè£…ä¾‹ï¼Š json([ \"name\" => \"Abigail\", \"state\" => \"CA\" ], 200); } } ãƒ»Viewãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã®ãƒ¬ã‚¹ãƒãƒ³ã‚¹ è¿”å´ã•ã‚Œã‚‹ResponseFactoryã‚¯ãƒ©ã‚¹ã®viewãƒ¡ã‚½ãƒƒãƒ‰ã«ï¼Œãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã—ãŸã„ãƒ‡ãƒ¼ã‚¿ï¼ˆãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆï¼Œarrayå‹ãƒ‡ãƒ¼ã‚¿ï¼Œã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚³ãƒ¼ãƒ‰ãªã©ï¼‰ã‚’è¨­å®šã™ã‚‹ï¼ã¾ãŸï¼ŒViewã‚¯ãƒ©ã‚¹ã®headerãƒ¡ã‚½ãƒƒãƒ‰ã«HTTPãƒ˜ãƒƒãƒ€ãƒ¼ã®å€¤ã‚’è¨­å®šã™ã‚‹ï¼responseãƒ˜ãƒ«ãƒ‘ãƒ¼ã¯åˆæœŸå€¤ã¨ã—ã¦200ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãŒè¨­å®šã•ã‚Œã¦ã„ã‚‹ãŒï¼Œviewãƒ¡ã‚½ãƒƒãƒ‰ã‚„setStatusCodeãƒ¡ã‚½ãƒƒãƒ‰ã‚’ä½¿ç”¨ã—ã¦ï¼Œæ˜ç¤ºçš„ã«è¨­å®šã—ã¦ã‚‚ã‚ˆã„ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š view( \"foo\", $data, 200 )->header( \"Content-Type\", $type ); } } view(\"foo\") ->setStatusCode(200); } } routeãƒ˜ãƒ«ãƒ‘ãƒ¼ ãƒ»ãƒ«ãƒ¼ãƒˆã‚¨ã‚¤ãƒªã‚¢ã‚¹ã«åŸºã¥ã„ã¦URLç”Ÿæˆ ãƒ«ãƒ¼ãƒˆã«ã‚¨ã‚¤ãƒªã‚¢ã‚¹ãŒã¤ã„ã¦ã„ã‚‹å ´åˆï¼Œã‚¨ã‚¤ãƒªã‚¢ã‚¹ã«å¿œã˜ã¦URLã‚’ç”Ÿæˆã™ã‚‹ï¼ãƒ‰ãƒ¡ã‚¤ãƒ³ã¯è‡ªå‹•ã§è£œå®Œã•ã‚Œã‚‹ï¼ å‚è€ƒï¼šhttps://readouble.com/laravel/8.x/ja/helpers.html#method-route name('foos_index'); // https://example.co.jp/foos $url = route('foos_index'); pathç³»ãƒ˜ãƒ«ãƒ‘ãƒ¼ ãƒ»base_pathãƒ˜ãƒ«ãƒ‘ãƒ¼ å¼•æ•°ã‚’è¨­å®šã—ãªã„å ´åˆï¼Œprojectãƒ«ãƒ¼ãƒˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã®çµ¶å¯¾ãƒ‘ã‚¹ã‚’ç”Ÿæˆã™ã‚‹ï¼ã¾ãŸï¼Œprojectãƒ«ãƒ¼ãƒˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‹ã‚‰ã®ç›¸å¯¾ãƒ‘ã‚¹ã‚’å¼•æ•°ã¨ã—ã¦ï¼Œçµ¶å¯¾ãƒ‘ã‚¹ã‚’ç”Ÿæˆã™ã‚‹ï¼ ãƒ»public_pathãƒ˜ãƒ«ãƒ‘ãƒ¼ å¼•æ•°ã‚’è¨­å®šã—ãªã„å ´åˆï¼Œpublicãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã®çµ¶å¯¾ãƒ‘ã‚¹ã‚’ç”Ÿæˆã™ã‚‹ï¼ã¾ãŸï¼Œpublicãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‹ã‚‰ã®ç›¸å¯¾ãƒ‘ã‚¹ã‚’å¼•æ•°ã¨ã—ã¦ï¼Œçµ¶å¯¾ãƒ‘ã‚¹ã‚’ç”Ÿæˆã™ã‚‹ï¼ ãƒ»storage_pathãƒ˜ãƒ«ãƒ‘ãƒ¼ å¼•æ•°ã‚’è¨­å®šã—ãªã„å ´åˆï¼Œstorageãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã®çµ¶å¯¾ãƒ‘ã‚¹ã‚’ç”Ÿæˆã™ã‚‹ï¼ã¾ã‚ï¼Œstorageãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‹ã‚‰ã®ç›¸å¯¾ãƒ‘ã‚¹ã‚’å¼•æ•°ã¨ã—ã¦ï¼Œçµ¶å¯¾ãƒ‘ã‚¹ã‚’ç”Ÿæˆã™ã‚‹ï¼ urlãƒ˜ãƒ«ãƒ‘ãƒ¼ ãƒ»ãƒ‘ã‚¹ã«åŸºã¥ã„ã¦URLç”Ÿæˆ æŒ‡å®šã—ãŸãƒ‘ã‚¹ã«å¿œã˜ã¦URLã‚’ç”Ÿæˆã™ã‚‹ï¼ãƒ‰ãƒ¡ã‚¤ãƒ³ã¯è‡ªå‹•ã§è£œå®Œã•ã‚Œã‚‹ï¼ å‚è€ƒï¼šhttps://readouble.com/laravel/5.7/ja/urls.html 09. Factory artisanã‚³ãƒãƒ³ãƒ‰ã«ã‚ˆã‚‹æ“ä½œ ãƒ»Factoryã®ç”Ÿæˆ $ php artisan make:factory --model= åˆæœŸå€¤ãƒ¬ã‚³ãƒ¼ãƒ‰ã®å®šç¾© ãƒ»Fakerã«ã‚ˆã‚‹ãƒ©ãƒ³ãƒ€ãƒ å€¤ç”Ÿæˆ Fakerã¯ãƒ¬ã‚³ãƒ¼ãƒ‰ã®å€¤ã‚’ãƒ©ãƒ³ãƒ€ãƒ ã«ç”Ÿæˆã™ã‚‹ãŸã‚ã®ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã§ã‚ã‚‹ï¼Farkerã‚¯ãƒ©ã‚¹ã¯ï¼Œãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã«ãƒ©ãƒ³ãƒ€ãƒ ãªãƒ‡ãƒ¼ã‚¿ã‚’ä¿æŒã—ã¦ã„ã‚‹ï¼ã“ã®ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã‚’ç‰¹ã«ï¼ŒFormattersã¨ã„ã†ï¼ å‚è€ƒï¼šhttps://fwhy.github.io/faker-docs/ ãƒ»Factoryã«ã‚ˆã‚‹ãƒ¬ã‚³ãƒ¼ãƒ‰å®šç¾© ï¼Šå®Ÿè£…ä¾‹ï¼Š $this->faker->name, 'email_address' => $this->faker->unique()->safeEmail, 'password' => 'password', ]; } } ãƒ»HasFactoryãƒˆãƒ¬ã‚¤ãƒˆ Factoryã«å¯¾å¿œã™ã‚‹Eloquentãƒ¢ãƒ‡ãƒ«ã§ä½¿ç”¨ã™ã‚‹å¿…è¦ãŒã‚ã‚‹ï¼ å‚è€ƒï¼šhttps://readouble.com/laravel/8.x/ja/database-testing.html#creating-models-using-factories class Foo { use HasFactory; } åˆæœŸãƒ€ãƒŸãƒ¼ãƒ‡ãƒ¼ã‚¿ã®é‡ç”£ ãƒ»Seederã«ã‚ˆã‚‹ãƒ€ãƒŸãƒ¼ãƒ‡ãƒ¼ã‚¿é‡ç”£ Factoryã«ãŠã‘ã‚‹å®šç¾©ã‚’åŸºã«ã—ã¦ï¼ŒæŒ‡å®šã—ãŸæ•°ã ã‘ãƒ€ãƒŸãƒ¼ãƒ‡ãƒ¼ã‚¿ã‚’é‡ç”£ã™ã‚‹ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š FooSeederã‚’å®šç¾©ã—ï¼Œ50å€‹ã®ãƒ€ãƒŸãƒ¼ãƒ¦ãƒ¼ã‚¶ãƒ‡ãƒ¼ã‚¿ã‚’é‡ç”£ã™ã‚‹ï¼ count(self::NUM_TEST_DATA)->create(); } } ã¾ãŸï¼ŒBarSeederã‚’å®šç¾©ã—ï¼Œ50å€‹ã®ãƒ€ãƒŸãƒ¼ãƒ¦ãƒ¼ã‚¶ãƒ‡ãƒ¼ã‚¿ã‚’é‡ç”£ã™ã‚‹ï¼ count(self::NUM_TEST_DATA)->create(); } } DatabaseSeederã«ã¦ï¼Œå…¨ã¦ã®Seederã‚’ã¾ã¨ã‚ã¦å®Ÿè¡Œã™ã‚‹ï¼ environment(\"dev\")) { $this->call([ // ãƒ€ãƒŸãƒ¼ãƒ‡ãƒ¼ã‚¿ FooSeeder::class, BarSeeder::class ]); } // ã‚¹ãƒ†ãƒ¼ã‚¸ãƒ³ã‚°ç’°å¢ƒç”¨ã®åˆæœŸãƒ‡ãƒ¼ã‚¿ if (app()->environment(\"stg\")) { $this->call([ // ãƒªã‚¢ãƒ«ãƒ‡ãƒ¼ã‚¿ ]); } // æœ¬ç•ªç’°å¢ƒç”¨ã®åˆæœŸãƒ‡ãƒ¼ã‚¿ if (app()->environment(\"prd\")) { $this->call([ // ãƒªã‚¢ãƒ«ãƒ‡ãƒ¼ã‚¿ ]); } } } 10. HTTPï½œController artisanã‚³ãƒãƒ³ãƒ‰ã«ã‚ˆã‚‹æ“ä½œ ãƒ»ã‚¯ãƒ©ã‚¹ã®è‡ªå‹•ç”Ÿæˆ # ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ã‚¯ãƒ©ã‚¹ã‚’è‡ªå‹•ä½œæˆ $ php artisan make:controller ãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã®å–å¾— ãƒ»ã‚¯ã‚¨ãƒªãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ï¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãƒœãƒ‡ã‚£ ã‚¯ã‚¨ãƒªãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã¨ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãƒœãƒ‡ã‚£ã®ä¸¡æ–¹ã‚’å–å¾—ã™ã‚‹ï¼ å‚è€ƒï¼šhttps://readouble.com/laravel/8.x/ja/requests.html#retrieving-input ï¼Šå®Ÿè£…ä¾‹ï¼Š all(); // å…¨ã¦ã®ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’é€£æƒ³é…åˆ—ã§å–å¾—ã™ã‚‹ï¼ $foo = $request->input('foo'); // æŒ‡å®šã—ãŸãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã®å€¤ã‚’å–å¾—ã™ã‚‹ï¼ $qux = $request->input('foo.qux'); // ãƒã‚¹ãƒˆã•ã‚ŒãŸãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã®å€¤ã‚’å–å¾—ã™ã‚‹ï¼ $params = $request->only(['foo', 'bar']); // æŒ‡å®šã—ãŸãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’é€£æƒ³é…åˆ—ã§å–å¾—ã™ã‚‹ï¼ $params = $request->except(['baz']); // æŒ‡å®šã—ãŸãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ä»¥å¤–ã‚’é€£æƒ³é…åˆ—ã§å–å¾—ã™ã‚‹ï¼ $foo = $request->foo; // æŒ‡å®šã—ãŸãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã®å€¤ã‚’å–å¾—ã™ã‚‹ï¼ $foo = request('foo'); // æŒ‡å®šã—ãŸãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã®å€¤ã‚’å–å¾—ã™ã‚‹ï¼ } } ãƒ»ã‚¯ã‚¨ãƒªãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ ã‚¯ã‚¨ãƒªãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’å–å¾—ã™ã‚‹ï¼ å‚è€ƒï¼šhttps://readouble.com/laravel/8.x/ja/requests.html#retrieving-input ï¼Šå®Ÿè£…ä¾‹ï¼Š query(); // å…¨ã¦ã®ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’é€£æƒ³é…åˆ—ã§å–å¾—ã™ã‚‹ï¼ $foo = $request->query('foo'); // æŒ‡å®šã—ãŸãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã®å€¤ã‚’å–å¾—ã™ã‚‹ï¼ } } ãƒ»ãƒ‘ã‚¹ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ ãƒ‘ã‚¹ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’å–å¾—ã™ã‚‹ï¼ å‚è€ƒï¼š https://laravel.com/api/8.x/Illuminate/Http/Request.html#method_route https://laravel.com/api/8.x/Illuminate/Routing/Route.html#method_parameter ï¼Šå®Ÿè£…ä¾‹ï¼Š route(); // å…¨ã¦ã®ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’é€£æƒ³é…åˆ—ã§å–å¾—ã™ã‚‹ï¼ $fooId = $request->route('fooId'); // æŒ‡å®šã—ãŸãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã®å€¤ã‚’å–å¾—ã™ã‚‹ï¼ $fooId = $request->route->parameter('fooId'); // æŒ‡å®šã—ãŸãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã®å€¤ã‚’å–å¾—ã™ã‚‹ï¼ } } ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ã®ç¬¬äºŒå¼•æ•°ã«ãƒ‘ã‚¹ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿åã‚’è¨˜è¿°ã™ã‚‹ã“ã¨ã§ï¼Œãƒ‘ã‚¹ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã®å€¤ã‚’å–å¾—ã§ãã‚‹ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š 10-02. HTTPï½œMiddleware artisanã‚³ãƒãƒ³ãƒ‰ã«ã‚ˆã‚‹æ“ä½œ ãƒ»ã‚¯ãƒ©ã‚¹ã®è‡ªå‹•ç”Ÿæˆ Middlewareã‚¯ãƒ©ã‚¹ã‚’è‡ªå‹•ç”Ÿæˆã™ã‚‹ï¼ $ php artisan make:middleware Middlewareã®ä»•çµ„ã¿ ãƒ»Middlewareã®ç¨®é¡ ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°å¾Œã«ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¡ã‚½ãƒƒãƒ‰ã®å‰ã«ã‚³ãƒ¼ãƒ«ã•ã‚Œã‚‹BeforeMiddleã¨ï¼Œãƒ¬ã‚¹ãƒãƒ³ã‚¹ã®å®Ÿè¡Œæ™‚ã«ã‚³ãƒ¼ãƒ«ã•ã‚Œã‚‹AfterMiddlewareãŒã‚ã‚‹ ãƒ»BeforeMiddleware ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°æ™‚ã®ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¡ã‚½ãƒƒãƒ‰ã®ã‚³ãƒ¼ãƒ«å‰ã«å®Ÿè¡Œã™ã‚‹å‡¦ç†ã‚’è¨­å®šã§ãã‚‹ï¼ä¸€é€£ã®å‡¦ç†ã‚’çµ‚ãˆãŸå¾Œï¼ŒFormRequestã‚¯ãƒ©ã‚¹ã‚’ï¼Œæ¬¡ã®Middlewareã‚¯ãƒ©ã‚¹ã‚„Controllerã‚¯ãƒ©ã‚¹ã«æ¸¡ã™å¿…è¦ãŒã‚ã‚‹ï¼ã“ã‚Œã‚‰ã®ã‚¯ãƒ©ã‚¹ã¯Closureï¼ˆç„¡åé–¢æ•°ï¼‰ã¨ã—ã¦ï¼Œnextå¤‰æ•°ã«æ ¼ç´ã•ã‚Œã¦ã„ã‚‹ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š ãƒ»AfterMiddleware ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¡ã‚½ãƒƒãƒ‰ã®ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã®å®Ÿè¡Œå¾Œï¼ˆãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã®ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã‚’å«ã‚€ï¼‰ã«å®Ÿè¡Œã™ã‚‹å‡¦ç†ã‚’è¨­å®šã§ãã‚‹ï¼ã‚ã‚‰ã‹ã˜ã‚ï¼ŒFormRequestã‚¯ãƒ©ã‚¹ã‚’ï¼Œå‰ã®Middlewareã‚¯ãƒ©ã‚¹ã‚„Controllerã‚¯ãƒ©ã‚¹ã‹ã‚‰å—ã‘å–ã‚‹å¿…è¦ãŒã‚ã‚‹ï¼ã“ã‚Œã‚‰ã®ã‚¯ãƒ©ã‚¹ã¯Closureï¼ˆç„¡åé–¢æ•°ï¼‰ã¨ã—ã¦ï¼Œnextå¤‰æ•°ã«æ ¼ç´ã•ã‚Œã¦ã„ã‚‹ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š æ¨™æº–ã®Middleware ãƒ»EncryptCookies ãƒ¬ã‚¹ãƒãƒ³ã‚¹æ™‚ã«ï¼ŒCookieãƒ˜ãƒƒãƒ€ãƒ¼ã®å…¨ã¦ã®å€¤ã‚’æš—å·åŒ–ã™ã‚‹ï¼æš—å·åŒ–ã—ãŸããªã„å ´åˆã¯ï¼ŒCookieãƒ˜ãƒƒãƒ€ãƒ¼ã®ã‚­ãƒ¼åã‚’exceptãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã«è¨­å®šã™ã‚‹ï¼ å‚è€ƒï¼šhttps://reffect.co.jp/laravel/laravel-sessions-understand#cookie-2 ãƒ»StartSession ã‚»ãƒƒã‚·ãƒ§ãƒ³ã®é–‹å§‹ã®èµ·ç‚¹ã«ãªã‚‹ï¼ å‚è€ƒï¼šhttps://qiita.com/wim/items/b1db5202cce6b38bc47b ã¾ãŸï¼ŒåŒä¸€ã‚»ãƒƒã‚·ãƒ§ãƒ³ã§ä¸€æ„ãªCSRFãƒˆãƒ¼ã‚¯ãƒ³ã‚’ç”Ÿæˆã™ã‚‹ï¼CSRFãƒˆãƒ¼ã‚¯ãƒ³ã«ã‚ˆã‚‹CSRFã®é˜²å¾¡ã«ã¤ã„ã¦ã¯ï¼Œä»¥ä¸‹ã®ãƒªãƒ³ã‚¯ã‚’å‚è€ƒã«ã›ã‚ˆï¼ å‚è€ƒï¼šhttps://hiroki-it.github.io/tech-notebook-gitbook/public/infrastructure_network_cyber_attacks.html ãƒ»VerifyCsrfToken ã‚»ãƒƒã‚·ãƒ§ãƒ³ãƒ•ã‚¡ã‚¤ãƒ«ã«æ›¸ã‹ã‚ŒãŸCSRFãƒˆãƒ¼ã‚¯ãƒ³ã¨ï¼Œãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒœãƒ‡ã‚£ã«å‰²ã‚Šå½“ã¦ã‚‰ã‚ŒãŸãƒˆãƒ¼ã‚¯ãƒ³ã‚’æ¯”è¼ƒã™ã‚‹ï¼ã‚»ãƒƒã‚·ãƒ§ãƒ³ãƒ•ã‚¡ã‚¤ãƒ«ã¯storage/framework/sessionsãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«é…ç½®ã•ã‚Œã¦ã„ã‚‹ï¼ä¸€èˆ¬çš„ã«ï¼ŒCSRFãƒˆãƒ¼ã‚¯ãƒ³ã¯Cookieãƒ˜ãƒƒãƒ€ãƒ¼ã«å‰²ã‚Šå½“ã¦ã‚‹ã“ã¨ã‚‚ã§ãã‚‹ãŒï¼ŒLaravelã§ã¯ãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒœãƒ‡ã‚£ã‚’ä½¿ç”¨ã™ã‚‹å¿…è¦ãŒã‚ã‚‹ï¼ å‚è€ƒï¼šhttps://readouble.com/laravel/8.x/ja/csrf.html#preventing-csrf-requests ã‚³ãƒ¼ãƒ«æ–¹æ³•ã®ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚º ãƒ»Kernel Middlewareã‚¯ãƒ©ã‚¹ã‚’ã‚³ãƒ¼ãƒ«ã™ã‚‹æ™‚ã®æ–¹æ³•ã‚’ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºã§ãã‚‹ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š [ ], 'api' => [ 'throttle:60,1', \\Illuminate\\Routing\\Middleware\\SubstituteBindings::class, ], ]; /** * ã‚¨ã‚¤ãƒªã‚¢ã‚¹åã¨å€‹åˆ¥ã®ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢ã‚’å®šç¾©ã—ã¾ã™ï¼ * * @var array */ protected $routeMiddleware = [ 'auth' => \\App\\Http\\Middleware\\Auth\\Authenticate::class, 'auth.basic' => \\Illuminate\\Auth\\Middleware\\AuthenticateWithBasicAuth::class, 'bindings' => \\Illuminate\\Routing\\Middleware\\SubstituteBindings::class, 'cache.headers' => \\Illuminate\\Http\\Middleware\\SetCacheHeaders::class, 'can' => \\Illuminate\\Auth\\Middleware\\Authorize::class, 'guest' => \\App\\Http\\Middleware\\Auth\\RedirectIfAuthenticated::class, 'password.confirm' => \\Illuminate\\Auth\\Middleware\\RequirePassword::class, 'signed' => \\Illuminate\\Routing\\Middleware\\ValidateSignature::class, 'throttle' => \\Illuminate\\Routing\\Middleware\\ThrottleRequests::class, 'verified' => \\Illuminate\\Auth\\Middleware\\EnsureEmailIsVerified::class, // FooãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢ã‚¯ãƒ©ã‚¹ 'foo' => \\App\\Http\\Middleware\\Before\\FooMiddleware::class ]; /** * ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢ã‚’ã‚³ãƒ¼ãƒ«ã™ã‚‹é †ç•ªã‚’å®šç¾©ã—ã¾ã™ï¼ * * @var string[] */ protected $middlewarePriority = [ \\Illuminate\\Session\\Middleware\\StartSession::class, \\Illuminate\\View\\Middleware\\ShareErrorsFromSession::class, \\App\\Http\\Middleware\\Auth\\Authenticate::class, \\Illuminate\\Routing\\Middleware\\ThrottleRequests::class, \\Illuminate\\Session\\Middleware\\AuthenticateSession::class, \\Illuminate\\Routing\\Middleware\\SubstituteBindings::class, \\Illuminate\\Auth\\Middleware\\Authorize::class, ]; } 10-03. HTTPï½œFormRequest artisanã‚³ãƒãƒ³ãƒ‰ã«ã‚ˆã‚‹æ“ä½œ ãƒ»ã‚¯ãƒ©ã‚¹ã®è‡ªå‹•ç”Ÿæˆ FormRequestã‚¯ãƒ©ã‚¹ã‚’è‡ªå‹•ä½œæˆã™ã‚‹ï¼ $ php artisan make:request ã‚¯ã‚¨ãƒªãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ï¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãƒœãƒ‡ã‚£ã®ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ ãƒ»ãƒ«ãƒ¼ãƒ«å®šç¾© ï¼† ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³æ‰‹å‹•å®Ÿè¡Œ åŒã˜ãFormRequestã‚¯ãƒ©ã‚¹ã®validateãƒ¡ã‚½ãƒƒãƒ‰ã‚’ä½¿ç”¨ã—ã¦ï¼Œãƒ«ãƒ¼ãƒ«ã‚’å®šç¾©ã—ï¼Œã•ã‚‰ã«ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’å®Ÿè¡Œã™ã‚‹ï¼validatedãƒ¡ã‚½ãƒƒãƒ‰ã¨é–“é•ã‚ãªã„ã‚ˆã†ã«æ³¨æ„ã™ã‚‹ï¼ãƒ«ãƒ¼ãƒ«ã«åã™ã‚‹ã¨ï¼Œä¸€ã¤ç›®ã®ãƒ«ãƒ¼ãƒ«åï¼ˆä¾‹ãˆã°requiredï¼‰ã«åŸºã¥ãï¼Œvalidation.phpãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰å¯¾å¿œã™ã‚‹ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è‡ªå‹•çš„ã«é¸æŠã™ã‚‹ï¼ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã§ã‚¨ãƒ©ãƒ¼ãŒèµ·ã“ã£ãŸå ´åˆï¼ŒHandlerã‚¯ãƒ©ã‚¹ã®invalidãƒ¡ã‚½ãƒƒãƒ‰ãŒã‚³ãƒ¼ãƒ«ã•ã‚Œï¼Œå…ƒã€…ã®ãƒšãƒ¼ã‚¸ã«ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆã•ã‚Œã‚‹ï¼ å‚è€ƒï¼š https://readouble.com/laravel/7.x/ja/validation.html#creating-form-requests https://laravel.com/api/8.x/Illuminate/Http/Request.html#method_validate ï¼Šå®Ÿè£…ä¾‹ï¼Š validate([ \"limit\" => [\"required\", Rule::in([25, 50, 100])], \"order\" => [\"required\", Rule::in([\"ascend\", \"descend\"])], ]); // ç¶šãã®å‡¦ç† } /** * @param Request $request */ public function update(Request $request) { // ãƒ«ãƒ¼ãƒ«ã®å®šç¾©ï¼Œãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã®å®Ÿè¡Œ // ã‚¨ãƒ©ãƒ¼ãŒèµ·ã“ã£ãŸå ´åˆã¯å…ƒã€…ã®ãƒšãƒ¼ã‚¸ã«ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ $validated = $request->validate([ \"title\" => [\"required\", \"string\", \"max:255\"], \"body\" => [\"required\", \"string\", \"max:255\"], \"date\" => [\"required\", \"date\"], ]); // ç¶šãã®å‡¦ç† } } ãªãŠï¼Œãƒ«ãƒ¼ãƒ«ã«ã‚ˆã£ã¦ã¯ï¼Œé…åˆ—ã‚’ä½¿ç”¨ã›ãšã¨ã‚‚å®šç¾©ã§ãã‚‹ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š validate([ \"title\" => \"required|string|max:5255\", \"body\" => \"required|string|max:255\", \"date\" => \"required|date\", ]); // ç¶šãã®å‡¦ç† } } ãƒ»ãƒ«ãƒ¼ãƒ«å®šç¾© & ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³è‡ªå‹•å®Ÿè¡Œ Controllerã§ï¼ŒFormRequestã‚¯ãƒ©ã‚¹ã‚’å¼•æ•°ã«æŒ‡å®šã™ã‚‹ã¨ï¼Œã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ã®ãƒ¡ã‚½ãƒƒãƒ‰ã‚’ã‚³ãƒ¼ãƒ«ã™ã‚‹å‰ã«ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’è‡ªå‹•çš„ã«å®Ÿè¡Œã™ã‚‹ï¼ãã®ãŸã‚ï¼Œã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ã®ä¸­ã§ã¯ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’å®Ÿè¡Œã™ã‚‹å¿…è¦ã¯ãªã„ï¼ä»£ã‚ã‚Šã«ï¼Œãƒ«ãƒ¼ãƒ«ã‚’FormRequestã‚¯ãƒ©ã‚¹ã®ruleãƒ¡ã‚½ãƒƒãƒ‰ã«å®šç¾©ã™ã‚‹å¿…è¦ãŒã‚ã‚‹ï¼FormRequestã‚¯ãƒ©ã‚¹ã®validatedãƒ¡ã‚½ãƒƒãƒ‰ã‚’ä½¿ç”¨ã—ã¦ï¼Œãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³æ¸ˆã¿ã®ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ã§ãã‚‹ï¼ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã§ã‚¨ãƒ©ãƒ¼ãŒèµ·ã“ã£ãŸå ´åˆï¼ŒHandlerã‚¯ãƒ©ã‚¹ã®invalidãƒ¡ã‚½ãƒƒãƒ‰ãŒã‚³ãƒ¼ãƒ«ã•ã‚Œï¼Œå…ƒã€…ã®ãƒšãƒ¼ã‚¸ã«ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆã•ã‚Œã‚‹ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š validated(); // ç¶šãã®å‡¦ç† } /** * @param Request $request */ public function update(Request $request) { // ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãƒœãƒ‡ã‚£ã®ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’å®Ÿè¡Œã™ã‚‹ï¼ // ã‚¨ãƒ©ãƒ¼ãŒèµ·ã“ã£ãŸå ´åˆã¯å…ƒã€…ã®ãƒšãƒ¼ã‚¸ã«ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ $validated = $request->validated(); // ç¶šãã®å‡¦ç† } } FormRequestã‚¯ãƒ©ã‚¹ã®rulesãƒ¡ã‚½ãƒƒãƒ‰ã‚’ä½¿ç”¨ã—ã¦ï¼Œãƒ«ãƒ¼ãƒ«ã‚’å®šç¾©ã™ã‚‹ï¼ãƒ«ãƒ¼ãƒ«ã«åã™ã‚‹ã¨ï¼Œä¸€ã¤ç›®ã®ãƒ«ãƒ¼ãƒ«åï¼ˆä¾‹ãˆã°requiredï¼‰ã«åŸºã¥ãï¼Œvalidation.phpãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰å¯¾å¿œã™ã‚‹ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è‡ªå‹•çš„ã«é¸æŠã™ã‚‹ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š [\"required\", \"string\", \"max:255\"], \"body\" => [\"required\", \"string\", \"max:255\"], \"type\" => [\"required\", Rule::in([1, 2, 3])], \"author\" => [\"required\", \"string\", new UppercaseRule()], \"date\" => [\"required\", \"date\"], ]; } } ãƒ‘ã‚¹ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã®ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ ãƒ»ãƒ«ãƒ¼ãƒ«ã®å®šç¾© ï¼† ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³è‡ªå‹•å®Ÿè¡Œ Routeãƒ•ã‚¡ã‚µãƒ¼ãƒ‰ã®patternãƒ¡ã‚½ãƒƒãƒ‰ã¾ãŸã¯whereãƒ¡ã‚½ãƒƒãƒ‰ã§å®šç¾©ã™ã‚‹ï¼Routeãƒ•ã‚¡ã‚µãƒ¼ãƒ‰ã®èª¬æ˜ã‚’å‚è€ƒã«ã›ã‚ˆï¼ ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ ãƒ»æ¨™æº–ã®ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ æ¨™æº–ã®ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã¯ï¼Œresources/lang/ja/validation.phpãƒ•ã‚¡ã‚¤ãƒ«ã§å®šç¾©ã§ãã‚‹ï¼ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ãƒ«ãƒ¼ãƒ«ã®çµ„ã¿åˆã‚ã›ã«ã‚ˆã£ã¦ï¼Œvalidation.phpãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰è‡ªå‹•çš„ã«ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒé¸æŠã•ã‚Œã‚‹ï¼ä¾‹ãˆã°ãƒ«ãƒ¼ãƒ«ã¨ã—ã¦æœ€å¤§å€¤ã‚’è¨­å®šã—ãŸå ´åˆã¯ï¼Œãƒ‡ãƒ¼ã‚¿å‹ã«åˆã‚ã›ã¦ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒé¸æŠã•ã‚Œã‚‹ï¼æ—¥æœ¬èªç¿»è¨³validation.phpãƒ•ã‚¡ã‚¤ãƒ«ã«ã¤ã„ã¦ã¯ï¼Œä»¥ä¸‹ã®ãƒªãƒ³ã‚¯ã‚’å‚è€ƒã«ã›ã‚ˆï¼ å‚è€ƒï¼šhttps://readouble.com/laravel/8.x/ja/validation-php.html ':attributeã¯å¿…é ˆã§ã™', 'string' => ':attribute ã¯æ–‡å­—åˆ—ã®ã¿æœ‰åŠ¹ã§ã™', 'max' => [ 'numeric' => ':attributeã«ã¯ã€:maxä»¥ä¸‹ã®æ•°å­—ã‚’æŒ‡å®šã—ã¦ãã ã•ã„', 'file' => ':attributeã«ã¯ã€:max kBä»¥ä¸‹ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æŒ‡å®šã—ã¦ãã ã•ã„', 'string' => ':attributeã¯ã€:maxæ–‡å­—ä»¥ä¸‹ã§æŒ‡å®šã—ã¦ãã ã•ã„', 'array' => ':attributeã¯:maxå€‹ä»¥ä¸‹æŒ‡å®šã—ã¦ãã ã•ã„', ], 'date' => ':attribute ã‚’æœ‰åŠ¹ãªæ—¥ä»˜å½¢å¼ã«ã—ã¦ãã ã•ã„', 'attributes' => [ 'title' => 'ã‚¿ã‚¤ãƒˆãƒ«', 'body' => 'æœ¬æ–‡', 'date' => 'ä½œæˆæ—¥', ], # ã€œ ä¸­ç•¥ ã€œ ]; ãªãŠï¼Œè¨€èªè¨­å®šã‚’è¡Œã‚ãªã„å ´åˆï¼Œæ¨™æº–ã§ã¯/resources/lang/en/validation.phpãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã¨ã—ã¦å‚ç…§ã™ã‚‹ãŸã‚ï¼Œapp.phpãƒ•ã‚¡ã‚¤ãƒ«ã§è¨€èªã‚’å¤‰æ›´ã™ã‚‹ã“ã¨ã¨ï¼Œæ—¥æœ¬èªç¿»è¨³validation.phpãƒ•ã‚¡ã‚¤ãƒ«ãŒå¿…è¦ã§ã‚ã‚‹ï¼ 'ja' # ã€œ ä¸­ç•¥ ã€œ ]; ãƒ»ç”»é¢ä¸Šã§ã®ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å‡ºåŠ› ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã§ã‚¨ãƒ©ãƒ¼ãŒã‚ã£ãŸå ´åˆï¼ŒHandlerã‚¯ãƒ©ã‚¹ã®invalidãƒ¡ã‚½ãƒƒãƒ‰ãŒã‚³ãƒ¼ãƒ«ã•ã‚Œï¼ŒMessageBagã‚¯ãƒ©ã‚¹ãŒViewã«æ¸¡ã•ã‚Œã‚‹ï¼é¸æŠã•ã‚ŒãŸãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒé…åˆ—å‹ã§MessageBagã‚¯ãƒ©ã‚¹ã«æ ¼ç´ã•ã‚Œã¦ã„ã‚‹ï¼ å‚è€ƒï¼š https://laravel.com/api/8.x/Illuminate/Foundation/Exceptions/Handler.html#method_invalid https://laravel.com/api/8.x/Illuminate/Support/MessageBag.html ( [title] => Array ( [0] => ã‚¿ã‚¤ãƒˆãƒ«ã®å…¥åŠ›ã¯å¿…é ˆã§ã™ [1] => ã‚¿ã‚¤ãƒˆãƒ«ã¯ï¼Œæœ€å¤§255æ–‡å­—ä»¥ä¸‹ã§æŒ‡å®šã—ã¦ãã ã•ã„ ) [body] => Array ( [0] => æœ¬æ–‡ã®å…¥åŠ›ã¯å¿…é ˆã§ã™ [1] => æœ¬æ–‡ã¯ï¼Œæœ€å¤§255æ–‡å­—ä»¥ä¸‹ã§æŒ‡å®šã—ã¦ãã ã•ã„ ) [data] => Array ( [0] => ä½œæˆæ—¥ã®å…¥åŠ›ã¯å¿…é ˆã§ã™ [1] => ä½œæˆæ—¥ã‚’æœ‰åŠ¹ãªæ—¥ä»˜å½¢å¼ã«ã—ã¦ãã ã•ã„ ) ) Rule ãƒ»existsãƒ¡ã‚½ãƒƒãƒ‰ æŒ‡å®šã•ã‚ŒãŸãƒ†ãƒ¼ãƒ–ãƒ«ã®ã‚«ãƒ©ãƒ ã«å€¤ãŒå­˜åœ¨ã—ã¦ã„ã‚‹ã‹ã‚’æ¤œè¨¼ã™ã‚‹ï¼ å‚è€ƒï¼šhttps://laravel.com/api/8.x/Illuminate/Validation/Rule.html#method_exists [\"nullable\", \"integer\", Rule::exists(\"prefectures\", \"id\")], \"cityId\" => [\"nullable\", \"integer\", Rule::exists(\"cities\", \"id\")] ]; } } ãƒ†ãƒ¼ãƒ–ãƒ«ã«ã‚«ãƒ©ãƒ æ•°ãŒå¤šã„å ´åˆã¯ï¼ŒWhereå¥ã‚’ã¤ã‘ã‚‹ã“ã¨ã§ï¼Œç‰¹å®šã®ã‚«ãƒ©ãƒ ã®ã¿æ¤œè¨¼ã™ã‚‹ã“ã¨ã‚‚ã§ãã‚‹ï¼ [\"nullable\", \"integer\", Rule::exists(\"prefectures\", \"id\")], \"cityId\" => [\"nullable\", \"integer\", Rule::exists(\"cities\", \"id\")->whereNull(\"deleted_at\")], ]; } } ãƒ»inãƒ¡ã‚½ãƒƒãƒ‰ æ±ºã‚ã‚‰ã‚ŒãŸè¤‡æ•°ã®å€¤ã«åˆè‡´ã™ã‚‹å€¤ã§ã‚ã‚‹ã‹ã©ã†ã‹ã‚’æ¤œè¨¼ã™ã‚‹ï¼ å‚è€ƒï¼šhttps://laravel.com/api/8.x/Illuminate/Validation/Rule.html#method_in [\"required\", Rule::in([1, 2, 3])], ]; } } ãƒ»ç‹¬è‡ªãƒ«ãƒ¼ãƒ«ï¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ ç‹¬è‡ªãƒ«ãƒ¼ãƒ«ã‚’å®šç¾©ã™ã‚‹å ´åˆã¯ï¼ŒRuleã‚¯ãƒ©ã‚¹ã‚’ç¶™æ‰¿ã—ãŸã‚¯ãƒ©ã‚¹ã‚’ç”¨æ„ã—ï¼Œruleãƒ¡ã‚½ãƒƒãƒ‰ã®ä¸­ã§ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’ä½œæˆã™ã‚‹ï¼ç‹¬è‡ªRuleã‚¯ãƒ©ã‚¹ã§ã¯ï¼Œpassesãƒ¡ã‚½ãƒƒãƒ‰ã§ãƒ«ãƒ¼ãƒ«ã‚’å®šç¾©ã™ã‚‹ï¼ã¾ãŸï¼Œmessagesãƒ¡ã‚½ãƒƒãƒ‰ã§ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å®šç¾©ã™ã‚‹ï¼validation.phpãƒ•ã‚¡ã‚¤ãƒ«ã§ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å®šç¾©ã—ï¼Œã“ã‚Œã‚’å‚ç…§ã—ã¦ã‚‚è‰¯ã„ï¼ å‚è€ƒï¼šhttps://laravel.com/docs/8.x/validation#custom-validation-rules ï¼Šå®Ÿè£…ä¾‹ï¼Š [\"required\", \"string\", new UppercaseRule()] ]; } } ã‚»ãƒƒã‚·ãƒ§ãƒ³ ãƒ»ã‚»ãƒƒã‚·ãƒ§ãƒ³å¤‰æ•°ã®å–å¾— FormRequestã‚¯ãƒ©ã‚¹ã®sessionãƒ¡ã‚½ãƒƒãƒ‰ã‚’ä½¿ç”¨ã—ã¦ï¼Œã‚»ãƒƒã‚·ãƒ§ãƒ³å¤‰æ•°ã‚’å–å¾—ã™ã‚‹ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š session() ->get(\"key\"); } } å…¨ã¦ã®ã‚»ãƒƒã‚·ãƒ§ãƒ³å¤‰æ•°ã‚’å–å¾—ã™ã‚‹ã“ã¨ã‚‚ã§ãã‚‹ï¼ $session = $request->session()->all(); ãƒ»ãƒ•ãƒ©ãƒƒã‚·ãƒ¥ãƒ‡ãƒ¼ã‚¿ã®è¨­å®š ç¾åœ¨ã®ã‚»ãƒƒã‚·ãƒ§ãƒ³ã«ãŠã„ã¦ï¼Œä»Šå›ã¨æ¬¡å›ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆã ã‘ã§æœ‰åŠ¹ãªä¸€æ™‚ãƒ‡ãƒ¼ã‚¿ã‚’è¨­å®šã§ãã‚‹ï¼ $request->session() ->flash(\"status\", \"Task was successful!\"); Requestã®èªè¨¼ ãƒ»authorizeãƒ¡ã‚½ãƒƒãƒ‰ ãƒ¦ãƒ¼ã‚¶ãŒãƒªã‚½ãƒ¼ã‚¹ã«å¯¾ã—ã¦CRUDæ“ä½œã‚’è¡Œã†æ¨©é™ã‚’æŒã£ã¦ã„ã‚‹ã‹ã‚’ï¼Œã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ã®ãƒ¡ã‚½ãƒƒãƒ‰ã‚’å®Ÿè¡Œã™ã‚‹å‰ã«ï¼Œåˆ¤å®šã™ã‚‹ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š /** * ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒã“ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆã®æ¨©é™ã‚’æŒã£ã¦ã„ã‚‹ã‹ã‚’åˆ¤æ–­ã™ã‚‹ * * @return bool */ public function authorize() { $comment = Comment::find($this->route(\"comment\")); return $comment&& $this->user()->can(\"update\", $comment); } ãƒ»Authãƒ•ã‚¡ã‚µãƒ¼ãƒ‰ Authãƒ•ã‚¡ã‚µãƒ¼ãƒ‰ã®èª¬æ˜ã‚’å‚è€ƒã«ã›ã‚ˆï¼ 11. Logging ãƒ­ã‚°ã®å‡ºåŠ›å…ˆ ãƒ»è¨­å®šæ–¹æ³• ç’°å¢ƒå¤‰æ•°ã‚’.envãƒ•ã‚¡ã‚¤ãƒ«ã«å®Ÿè£…ã™ã‚‹ï¼logging.phpãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰ï¼ŒæŒ‡å®šã•ã‚ŒãŸè¨­å®šãŒé¸æŠã•ã‚Œã‚‹ï¼ å‚è€ƒï¼šhttps://readouble.com/laravel/8.x/ja/logging.html#available-channel-drivers LOG_CHANNEL= ãƒ»stackã‚­ãƒ¼ ä»–ã®å˜ä¸€ï¼è¤‡æ•°ã®ãƒãƒ£ãƒ³ãƒãƒ«ã‚’åˆ©ç”¨ã™ã‚‹ãƒãƒ£ãƒ³ãƒãƒ«ï¼ return [ // ï½ ä¸­ç•¥ ï½ \"default\" => env(\"LOG_CHANNEL\", \"stack\"), \"channels\" => [ \"stack\" => [ \"driver\" => \"stack\", // è¤‡æ•°ãƒãƒ£ãƒ³ãƒãƒ«ã‚’è¨­å®šå¯èƒ½ï¼ï¼ˆä¾‹ï¼‰[\"single\", \"stack\"] \"channels\" => [\"single\"], \"ignore_exceptions\" => false, ], // ï½ ä¸­ç•¥ ï½ ] ]; ãƒ»singleã‚­ãƒ¼ å…¨ã¦ã®ãƒ­ã‚°ã‚’/storage/logs/laravel.logãƒ•ã‚¡ã‚¤ãƒ«ã«å¯¾ã—ã¦å‡ºåŠ›ã™ã‚‹ï¼ return [ // ï½ ä¸­ç•¥ ï½ \"default\" => env(\"LOG_CHANNEL\", \"stack\"), \"channels\" => [ \"daily\" => [ \"driver\" => \"daily\", \"path\" => storage_path(\"logs/laravel.log\"), \"level\" => env(\"LOG_LEVEL\", \"debug\"), \"days\" => 14, ], // ï½ ä¸­ç•¥ ï½ ] ]; ãƒ»dailyã‚­ãƒ¼ å…¨ã¦ã®ãƒ­ã‚°ã‚’/storage/logs/laravel-.logãƒ•ã‚¡ã‚¤ãƒ«ã«å¯¾ã—ã¦å‡ºåŠ›ã™ã‚‹ï¼ return [ // ï½ ä¸­ç•¥ ï½ \"default\" => env(\"LOG_CHANNEL\", \"stack\"), \"channels\" => [ \"stderr\" => [ \"driver\" => \"monolog\", \"handler\" => StreamHandler::class, \"formatter\" => env(\"LOG_STDERR_FORMATTER\"), \"with\" => [ \"stream\" => \"php://stderr\", ], ], // ï½ ä¸­ç•¥ ï½ ] ]; ãƒ»stderrã‚­ãƒ¼ å…¨ã¦ã®ãƒ­ã‚°ã‚’æ¨™æº–ã‚¨ãƒ©ãƒ¼å‡ºåŠ›ã«å¯¾ã—ã¦å‡ºåŠ›ã™ã‚‹ï¼Dockerä¸Šã§Laravelã‚’ç¨¼åƒã•ã›ã‚‹å ´åˆã¯ï¼Œç”Ÿæˆã•ã‚Œã‚‹ãƒ­ã‚°ãƒ•ã‚¡ã‚¤ãƒ«ã§ã‚³ãƒ³ãƒ†ãƒŠã®å®¹é‡ãŒè‚¥å¤§åŒ–ã™ã‚‹ã“ã¨ã‚’é˜²ããŸã‚ã«ï¼Œã“ã‚Œã‚’é¸æŠã™ã‚‹ï¼ãªãŠï¼Œç‹¬è‡ªã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºã¨ã—ã¦ï¼Œstreamã‚­ãƒ¼ã‚’stdoutå¤‰æ›´ã™ã‚Œã°ï¼Œæ¨™æº–å‡ºåŠ›ã«ãƒ­ã‚°ã‚’å‡ºåŠ›ã™ã‚‹ã“ã¨ã‚‚ã§ãã‚‹ï¼ return [ // ï½ ä¸­ç•¥ ï½ \"default\" => env(\"LOG_CHANNEL\", \"stack\"), \"channels\" => [ \"stderr\" => [ \"driver\" => \"monolog\", \"handler\" => StreamHandler::class, \"formatter\" => env(\"LOG_STDERR_FORMATTER\"), \"with\" => [ \"stream\" => \"php://stderr\", ], ], // ï½ ä¸­ç•¥ ï½ ] ]; ãƒ­ã‚°ã®å‡ºåŠ› ãƒ»errorãƒ¡ã‚½ãƒƒãƒ‰ ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å®šç¾©ã™ã‚‹æ™‚ï¼Œsprintfãƒ¡ã‚½ãƒƒãƒ‰ã‚’ä½¿ç”¨ã™ã‚‹ã¨ä¾¿åˆ©ã§ã‚ã‚‹ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š å¤–éƒ¨ã®APIã«å¯¾ã—ã¦ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é€ä¿¡ã—ï¼Œãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ã™ã‚‹ï¼å–å¾—ã—ãŸJSONãƒ‡ãƒ¼ã‚¿ã‚’ï¼Œã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã«ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã™ã‚‹ï¼ã“ã®æ™‚ï¼Œãƒªã‚¯ã‚¨ã‚¹ãƒˆå‡¦ç†ã®ãŸã‚ã«ï¼ŒGuzzleãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’ä½¿ç”¨ã—ã¦ã„ã‚‹ï¼ request( \"GET\", $requestUrl, [ \"headers\" => [ \"Content-Type\" => \"application/json\", \"X-API-Key\" => \"api.foo.api_key\", ] ] ); // JSONã‚’ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã«ãƒ¬ã‚¹ãƒãƒ³ã‚¹ return $response->getBody() ->getContents(); } catch (GuzzleException $e) { Log::error(sprintf( \"%s : %s at %s line %s\", get_class($e), $e->getMessage(), $e->getFile(), $e->getLine()) ); return response()->json( [], $e->getCode() ); } } } [ \"endpoint_url\" => env(\"ENDPOINT_URL\", \"\"), \"api_key\" => env(\"API_KEY\"), ], \"bar\" => [ \"endpoint_url\" => env(\"ENDPOINT_URL\", \"\"), \"api_key\" => env(\"API_KEY\"), ] ]; ãƒ»infoãƒ¡ã‚½ãƒƒãƒ‰ 12. Migration artisanã‚³ãƒãƒ³ãƒ‰ã«ã‚ˆã‚‹æ“ä½œ ãƒ»ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆ $ php artisan make:migrate create__table ãƒ»ãƒ†ãƒ¼ãƒ–ãƒ«ä½œæˆ ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãƒ•ã‚¡ã‚¤ãƒ«ã‚’å…ƒã«ãƒ†ãƒ¼ãƒ–ãƒ«ã‚’ä½œæˆã™ã‚‹ï¼ $ php artisan migrate ã‚³ãƒãƒ³ãƒ‰å®Ÿè¡Œæ™‚ï¼Œä»¥ä¸‹ã®ã‚¨ãƒ©ãƒ¼ãŒå‡ºã‚‹ã“ã¨ãŒã‚ã‚‹ï¼ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãƒ•ã‚¡ã‚¤ãƒ«åã®ã‚¹ãƒãƒ¼ã‚¯ã‚±ãƒ¼ã‚¹ã§ï¼Œã“ã‚ŒãŒã‚¯ãƒ©ã‚¹åã®ã‚­ãƒ£ãƒ¡ãƒ«ã‚±ãƒ¼ã‚¹ã¨å¯¾å¿œã¥ã‘ã‚‰ã‚Œã¦ãŠã‚Šï¼Œãƒ•ã‚¡ã‚¤ãƒ«åã¨ã‚¯ãƒ©ã‚¹åã®é–¢ä¿‚ãŒæ­£ã—ããªã„ãŸã‚ã«èµ·ã“ã‚‹ã‚¨ãƒ©ãƒ¼ã§ã‚ã‚‹ï¼ Symfony\\Component\\Debug\\Exception\\FatalThrowableError : Class \"CreateXxxxxTable\" not found ãƒ»ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã®çµæœã‚’ç¢ºèª $ php artisan migrate:status ãƒ»æŒ‡å®šã—ãŸå±¥æ­´æ•°ã ã‘ãƒ†ãƒ¼ãƒ–ãƒ«ã‚’å…ƒã«æˆ»ã™ æŒ‡å®šã—ãŸå±¥æ­´æ•°ã ã‘ï¼Œãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯ã‚’è¡Œã†ï¼ å‚è€ƒï¼šhttps://readouble.com/laravel/8.x/ja/migrations.html#rolling-back-migrations $ php artisan migrate:rollback --step= å®Ÿéš›ã®ä½¿ç”¨å ´é¢ã¨ã—ã¦ï¼Œãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã«å¤±æ•—ã—ãŸå ´åˆã«ï¼Œä¸€ã¤å‰ã®çŠ¶æ…‹ã«ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯ã—ã¦ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä¿®æ­£ã—ãŸå¾Œï¼Œå†ã³ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚’è¡Œã†ï¼ # ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã«å¤±æ•—ã—ãŸã®ã§ï¼Œä¸€ã¤å‰ã®çŠ¶æ…‹ã«ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯ï¼ $ php artisan migrate:rollback --step=1 # ãƒ•ã‚¡ã‚¤ãƒ«ä¿®æ­£å¾Œã«ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚’å®Ÿè¡Œ $ php artisan migrate ãƒ»åˆæœŸã®çŠ¶æ…‹ã¾ã§ãƒ†ãƒ¼ãƒ–ãƒ«ã‚’å…ƒã«æˆ»ã™ åˆæœŸã®çŠ¶æ…‹ã¾ã§ï¼Œå…¨ã¦ã®ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯ã‚’å®Ÿè¡Œã™ã‚‹ï¼ å‚è€ƒï¼šhttps://readouble.com/laravel/8.x/ja/migrations.html#rolling-back-migrations $ php artisan migrate:reset ãƒ»ãƒ†ãƒ¼ãƒ–ãƒ«ã‚’å…ƒã«æˆ»ã—ã¦ã‹ã‚‰å†ä½œæˆ å…¨ã¦ã®ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯ï¼ˆmigrate:resetï¼‰ã‚’å®Ÿè¡Œã—ï¼Œæ¬¡ã„ã§migrateã‚’å®Ÿè¡Œã™ã‚‹ï¼ å‚è€ƒï¼šhttps://readouble.com/laravel/8.x/ja/migrations.html#roll-back-migrate-using-a-single-command $ php artisan migrate:refresh ãƒ»ãƒ†ãƒ¼ãƒ–ãƒ«ã‚’å‰Šé™¤ã—ã¦ã‹ã‚‰å†ä½œæˆ å…¨ã¦ã®ãƒ†ãƒ¼ãƒ–ãƒ«ã‚’å‰Šé™¤ã¨migrateã‚’å®Ÿè¡Œã™ã‚‹ï¼ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãƒ•ã‚¡ã‚¤ãƒ«ã®æ§‹æ–‡ãƒã‚§ãƒƒã‚¯ã‚’è¡Œã‚ãšã«ï¼Œå¼·åˆ¶çš„ã«å®Ÿè¡Œã•ã‚Œã‚‹ï¼ å‚è€ƒï¼šhttps://readouble.com/laravel/8.x/ja/migrations.html#drop-all-tables-migrate $ php artisan migrate:fresh ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³æ™‚ï¼Œãƒ†ãƒ¼ãƒ–ãƒ«ãŒã™ã§ã«å­˜åœ¨ã™ã‚‹ã‚¨ãƒ©ãƒ¼ãŒèµ·ã“ã‚‹ã“ã¨ãŒã‚ã‚‹ï¼ã“ã®å ´åˆï¼Œãƒ†ãƒ¼ãƒ–ãƒ«ãŒãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã•ã‚Œã‚‹å‰ã¾ã§ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯ã—ï¼Œãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚’å†å®Ÿè¡Œã™ã‚‹ã“ã¨ãŒæœ€é©ã§ã‚ã‚‹ï¼ã—ã‹ã—ãã‚ŒãŒé›£ã—ã‘ã‚Œã°ï¼Œã“ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã™ã‚‹å¿…è¦ãŒã‚ã‚‹ï¼ SQLSTATE[42S01]: table or view already exists ãƒ»ç¢ºèªç”»é¢ã®å…¥åŠ›ã‚’ã‚¹ã‚­ãƒƒãƒ— ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³æ™‚ï¼Œæœ¬å½“ã«å®Ÿè¡Œã—ã¦è‰¯ã„ã‹ç¢ºèªç”»é¢ï¼ˆYesï¼Noï¼‰ãŒè¡¨ç¤ºã•ã‚Œã‚‹ï¼CICDã«ãŠã„ã¦ï¼Œã“ã®ç¢ºèªç”»é¢ã§Yesï¼Noã‚’å…¥åŠ›ã™ã‚‹ã“ã¨ãŒã§ããªã„ãŸã‚ï¼Œç¢ºèªç”»é¢ã‚’ã‚¹ã‚­ãƒƒãƒ—ã§ãã‚‹ã‚ˆã†ã«ã™ã‚‹å¿…è¦ãŒã‚ã‚‹ï¼ å‚è€ƒï¼šhttps://readouble.com/laravel/8.x/ja/migrations.html#forcing-migrations-to-run-in-production $ php artisan migrate --force ãƒ†ãƒ¼ãƒ–ãƒ«ã®ä½œæˆï¼å‰Šé™¤ ãƒ»upãƒ¡ã‚½ãƒƒãƒ‰ï¼Œdownãƒ¡ã‚½ãƒƒãƒ‰ ã‚³ãƒãƒ³ãƒ‰ã«ã‚ˆã‚‹ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³æ™‚ã«ã‚³ãƒ¼ãƒ«ã•ã‚Œã‚‹ï¼upãƒ¡ã‚½ãƒƒãƒ‰ã§ãƒ†ãƒ¼ãƒ–ãƒ«ï¼Œã‚«ãƒ©ãƒ ï¼Œã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã®CREATEã‚’å®Ÿè¡Œã™ã‚‹ï¼downãƒ¡ã‚½ãƒƒãƒ‰ã§CREATEã®ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯ã‚’å®Ÿè¡Œã™ã‚‹ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š bigIncrements(\"foo_id\")->comment(\"ID\"); $table->string(\"name\")->comment(\"åå‰\"); // MigrationMacroServiceProviderã®ãƒ¡ã‚½ãƒƒãƒ‰ã‚’ä½¿ç”¨ã™ã‚‹ï¼ $table->systemColumns(); // deleted_atã‚«ãƒ©ãƒ ã‚’è¿½åŠ ã™ã‚‹ï¼ $table->softDeletes(); }); } /** * @return void */ public function down() { Schema::drop(\"foos\"); } } ã‚«ãƒ©ãƒ ã®è¿½åŠ ï¼å¤‰æ›´ï¼å‰Šé™¤ ãƒ»ãªã— æŒ‡å®šã—ãŸã‚«ãƒ©ãƒ ã‚’è¿½åŠ ã™ã‚‹ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š ã‚«ãƒ©ãƒ ã‚’è¿½åŠ ã™ã‚‹ãŸã‚ã ã‘ã«ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã™ã‚‹ï¼ $ php artisan make:migration add_column --table=foos è¿½åŠ ã—ãŸã„ã‚«ãƒ©ãƒ ã®ã¿ã‚’å®šç¾©ã™ã‚‹ï¼ string('foo_name'); }); } } ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚’å®Ÿè¡Œã™ã‚‹ã¨ï¼ŒæŒ‡å®šã—ãŸãƒ†ãƒ¼ãƒ–ãƒ«ã®ã‚«ãƒ©ãƒ ãŒè¿½åŠ ã•ã‚Œã‚‹ï¼å®Ÿè¡Œå¾Œã¯ï¼Œä½œæˆã—ãŸãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãƒ•ã‚¡ã‚¤ãƒ«ã‚’å‰Šé™¤ã™ã‚‹ï¼ $ php artisan migrate ãƒ»renameColumnãƒ¡ã‚½ãƒƒãƒ‰ æŒ‡å®šã—ãŸã‚«ãƒ©ãƒ ã®åå‰ã‚’å¤‰æ›´ã™ã‚‹ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š ã‚«ãƒ©ãƒ åã‚’å¤‰æ›´ã™ã‚‹ãŸã‚ã ã‘ã«ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã™ã‚‹ï¼ $ php artisan make:migration rename_column --table=foos ãƒ†ãƒ¼ãƒ–ãƒ«ã®ã‚«ãƒ©ãƒ åã‚’å®šç¾©ã—ï¼ŒrenameColumnãƒ¡ã‚½ãƒƒãƒ‰ã‚’ã‚³ãƒ¼ãƒ«ã™ã‚‹ï¼å¤‰æ›´å¾Œã§ã‚‚ï¼Œãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯ã§ãã‚‹ã‚ˆã†ã«ï¼Œdownãƒ¡ã‚½ãƒƒãƒ‰ã‚‚å®šç¾©ã—ã¦ãŠãï¼ renameColumn('id', 'foo_id'); }); } /** * @return void */ public function down() { // ãƒ‡ãƒ¼ã‚¿å‹ã®å¤‰æ›´å¾Œã§ã‚‚ï¼Œãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯ã§ãã‚‹ã‚ˆã†ã«ã—ã¦ãŠãï¼ Schema::table('foos', function (Blueprint $table) { $table->renameColumn('foo_id', 'foo_id'); }); } } ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚’å®Ÿè¡Œã™ã‚‹ã¨ï¼ŒæŒ‡å®šã—ãŸãƒ†ãƒ¼ãƒ–ãƒ«ã®ã‚«ãƒ©ãƒ åãŒå¤‰æ›´ã•ã‚Œã‚‹ï¼å®Ÿè¡Œå¾Œã¯ï¼Œä½œæˆã—ãŸãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãƒ•ã‚¡ã‚¤ãƒ«ã‚’å‰Šé™¤ã™ã‚‹ï¼ $ php artisan migrate ãƒ»changeãƒ¡ã‚½ãƒƒãƒ‰ æŒ‡å®šã—ãŸã‚«ãƒ©ãƒ ã®ãƒ‡ãƒ¼ã‚¿å‹ã‚’å¤‰æ›´ã™ã‚‹ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š ãƒ‡ãƒ¼ã‚¿å‹ã‚’å¤‰æ›´ã™ã‚‹ãŸã‚ã ã‘ã«ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã™ã‚‹ï¼ $ php artisan make:migration change_column_data_type --table=foos ãƒ†ãƒ¼ãƒ–ãƒ«ã®ã‚«ãƒ©ãƒ ã®ãƒ‡ãƒ¼ã‚¿å‹ã‚’å®šç¾©ã—ï¼Œchangeãƒ¡ã‚½ãƒƒãƒ‰ã‚’ã‚³ãƒ¼ãƒ«ã™ã‚‹ï¼å¤‰æ›´å¾Œã§ã‚‚ï¼Œãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯ã§ãã‚‹ã‚ˆã†ã«ï¼Œdownãƒ¡ã‚½ãƒƒãƒ‰ã‚‚å®šç¾©ã—ã¦ãŠãï¼ integer('bar')->change(); }); } /** * @return void */ public function down() { // ãƒ‡ãƒ¼ã‚¿å‹ã®å¤‰æ›´å¾Œã§ã‚‚ï¼Œãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯ã§ãã‚‹ã‚ˆã†ã«ã—ã¦ãŠãï¼ Schema::table('foos', function (Blueprint $table) { $table->string('bar')->change(); }); } } ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚’å®Ÿè¡Œã™ã‚‹ã¨ï¼ŒæŒ‡å®šã—ãŸãƒ†ãƒ¼ãƒ–ãƒ«ã®ã‚«ãƒ©ãƒ ã®ãƒ‡ãƒ¼ã‚¿å‹ãŒå¤‰æ›´ã•ã‚Œã‚‹ï¼å®Ÿè¡Œå¾Œã¯ï¼Œä½œæˆã—ãŸãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãƒ•ã‚¡ã‚¤ãƒ«ã‚’å‰Šé™¤ã™ã‚‹ï¼ $ php artisan migrate ãƒ»dropColumnãƒ¡ã‚½ãƒƒãƒ‰ æŒ‡å®šã—ãŸã‚«ãƒ©ãƒ ã‚’å‰Šé™¤ã™ã‚‹ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š ã‚«ãƒ©ãƒ ã‚’å‰Šé™¤ã™ã‚‹ãŸã‚ã ã‘ã«ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã™ã‚‹ï¼ $ php artisan make:migration drop_column --table=foos å‰Šé™¤ã™ã‚‹ã‚«ãƒ©ãƒ ã‚’dropColumnãƒ¡ã‚½ãƒƒãƒ‰ã§æŒ‡å®šã™ã‚‹ï¼å¤‰æ›´å¾Œã§ã‚‚ï¼Œãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯ã§ãã‚‹ã‚ˆã†ã«ï¼Œdownãƒ¡ã‚½ãƒƒãƒ‰ã‚‚å®šç¾©ã—ã¦ãŠãï¼ dropColumn('foo_name'); }); } /** * @return void */ public function down() { Schema::table('foos', function (Blueprint $table) { $table->string('foo_name'); }); } } ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚’å®Ÿè¡Œã™ã‚‹ã¨ï¼ŒæŒ‡å®šã—ãŸãƒ†ãƒ¼ãƒ–ãƒ«ã®ã‚«ãƒ©ãƒ ãŒè¿½åŠ ã•ã‚Œã‚‹ï¼å®Ÿè¡Œå¾Œã¯ï¼Œä½œæˆã—ãŸãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãƒ•ã‚¡ã‚¤ãƒ«ã‚’å‰Šé™¤ã™ã‚‹ï¼ $ php artisan migrate ã‚ˆãä½¿ã†ã‚«ãƒ©ãƒ ã‚¿ã‚¤ãƒ— ãƒ»bigIncrementsãƒ¡ã‚½ãƒƒãƒ‰ AutoIncrementã®INTå‹ã‚«ãƒ©ãƒ ã‚’ä½œæˆã™ã‚‹ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š Schema::create(\"foos\", function (Blueprint $table) { // ï½ ä¸­ç•¥ ï½ $table->bigIncrements(\"foo_id\"); // ï½ ä¸­ç•¥ ï½ }); ãƒ»stringãƒ¡ã‚½ãƒƒãƒ‰ VARCHARå‹ã‚«ãƒ©ãƒ ã‚’ä½œæˆã™ã‚‹ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š Schema::create(\"foos\", function (Blueprint $table) { // ï½ ä¸­ç•¥ ï½ $table->string(\"name\"); // ï½ ä¸­ç•¥ ï½ }); ãƒ»timestampãƒ¡ã‚½ãƒƒãƒ‰ TIMESTAMPå‹ã‚«ãƒ©ãƒ ã‚’ä½œæˆã™ã‚‹ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š Schema::create(\"foos\", function (Blueprint $table) { // ï½ ä¸­ç•¥ ï½ $table->timestamp(\"created_at\"); // ï½ ä¸­ç•¥ ï½ }); 13. Notification artisanã‚³ãƒãƒ³ãƒ‰ã«ã‚ˆã‚‹æ“ä½œ é€šçŸ¥å†…å®¹ ãƒ»Notification é€šçŸ¥å†…å®¹ã‚’å®šç¾©ã™ã‚‹ï¼viaãƒ¡ã‚½ãƒƒãƒ‰ã§å—ä¿¡ãƒãƒ£ãƒ³ãƒãƒ«ã‚’å®šç¾©ã™ã‚‹ï¼ã“ã®æ™‚ï¼ŒLaravelãŒæ¨™æº–ã§ç”¨æ„ã—ã¦ã„ã‚‹ãƒãƒ£ãƒ³ãƒãƒ«ï¼ˆMailï¼ŒSMSï¼ŒSlackãƒãƒ£ãƒ³ãƒãƒ«ï¼ŒDatabaseãƒãƒ£ãƒ³ãƒãƒ«ï¼‰ä»¥å¤–ã«é€ä¿¡ã—ãŸã„å ´åˆï¼ŒChannelã‚¯ãƒ©ã‚¹ã‚’å®šç¾©ã™ã‚‹å¿…è¦ãŒã‚ã‚‹ï¼è¤‡æ•°ã®å€¤ã‚’è¨­å®šã—ãŸå ´åˆã¯ï¼Œãã‚Œãã‚Œã«é€šä¿¡ãŒé€ä¿¡ã•ã‚Œã‚‹ï¼toMailãƒ¡ã‚½ãƒƒãƒ‰ï¼ŒtoSmsãƒ¡ã‚½ãƒƒãƒ‰ï¼ŒtoSlackãƒ¡ã‚½ãƒƒãƒ‰ï¼ŒtoArrayãƒ¡ã‚½ãƒƒãƒ‰ï¼Œã‚’ä½¿ç”¨ã—ã¦ï¼ŒLaravelã®æ¨™æº–ã®ãƒãƒ£ãƒ³ãƒãƒ«ã«æ¸¡ã™é€šçŸ¥å†…å®¹ã‚’å®šç¾©ã§ãã‚‹ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š ãƒ»Eãƒ¡ãƒ¼ãƒ«é€šçŸ¥å†…å®¹ã®å®šç¾© MailMessageã‚¯ãƒ©ã‚¹ã®ãƒ¡ã‚½ãƒƒãƒ‰ã‚’ä½¿ç”¨ã—ã¦ï¼ŒEãƒ¡ãƒ¼ãƒ«é€šçŸ¥ã®å†…å®¹ã‚’ç”Ÿæˆã™ã‚‹ï¼markdownãƒ¡ã‚½ãƒƒãƒ‰ã‚’ä½¿ç”¨ã™ã‚‹ã“ã¨ã§ï¼Œãƒãƒ¼ã‚¯ãƒ€ã‚¦ãƒ³å½¢å¼ã§å®šç¾©ã§ãã‚‹ï¼ å‚è€ƒï¼š https://readouble.com/laravel/8.x/ja/notifications.html#writing-the-message https://laravel.com/api/8.x/Illuminate/Notifications/Messages/MailMessage.html#method_markdown prefers_sms ? [AwsSnsChannel::class] : [EmailChannel::class], // SMSã§ãªã„å ´åˆã¯ï¼ŒEãƒ¡ãƒ¼ãƒ«é€šçŸ¥ã¨ã—ã¾ã™ï¼ 'database' ]; } /** * @param $notifiable * @return MailMessage */ public function toMail($notifiable) { // Emailã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å†…å®¹ã‚’è¿”å´ã—ã¾ã™ï¼ return (new MailMessage())->subject(\"ã‚³ãƒ¼ãƒ‰ã‚’é€ä¿¡ã„ãŸã—ã¾ã—ãŸï¼\") ->markdown(\"template.mail\", [ \"tfa_token\" => $notifiable->tfaToken() ]); } } @component(\"mail::message\") èªè¨¼ã‚³ãƒ¼ãƒ‰ã€{ $tfa_token }}ã€ã‚’å…¥åŠ›ã—ã¦ä¸‹ã•ã„ï¼ +++++++++++++++++++++++++++++++++++++ æœ¬ã‚¢ãƒ‰ãƒ¬ã‚¹ã¯é€ä¿¡å°‚ç”¨ã§ã™ï¼ã”è¿”ä¿¡é ‚ã„ã¦ã‚‚ãŠç­”ãˆã§ãã¾ã›ã‚“ã®ã§ã€ã”äº†æ‰¿ãã ã•ã„ï¼ @endcomponent ãƒ»SMSé€šçŸ¥å†…å®¹ã®å®šç¾© å‚è€ƒï¼šhttps://readouble.com/laravel/8.x/ja/notifications.html#formatting-sms-notifications prefers_sms ? [AwsSnsChannel::class] : [EmailChannel::class], // SMSã®å ´åˆã¯ï¼ŒAWS-SNSã‚’ä½¿ç”¨ã—ã¾ã™ï¼ 'database' ]; } /** * @param $notifiable * @return string */ public function toSms($notifiable) { // SMSã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å†…å®¹ã‚’è¿”å´ã—ã¾ã™ï¼ return view(\"template.sms\", [ \"subject\" => \"ã‚³ãƒ¼ãƒ‰ã‚’é€ä¿¡ã„ãŸã—ã¾ã—ãŸï¼\", \"tfa_token\" => $notifiable->tfaToken() ]); } } ãƒ»Slacké€šçŸ¥å†…å®¹ã®å®šç¾© å‚è€ƒï¼šhttps://readouble.com/laravel/8.x/ja/notifications.html#formatting-slack-notifications ãƒ»DBé€šçŸ¥å†…å®¹ã®å®šç¾© é…åˆ—ã§DBã«ä¿å­˜ã™ã‚‹å†…å®¹ã‚’å®šç¾©ã™ã‚‹ï¼ å‚è€ƒï¼šhttps://readouble.com/laravel/7.x/ja/notifications.html#database-notifications prefers_sms ? [AwsSnsChannel::class] : [EmailChannel::class], 'database' // DBå—ä¿¡ãƒãƒ£ãƒ³ãƒãƒ« ]; } /** * @param $notifiable * @return array */ public function toArray($notifiable) { // notificationsãƒ†ãƒ¼ãƒ–ãƒ«ã®dataã‚«ãƒ©ãƒ ã«ï¼ŒJSONã§ä¿å­˜ã•ã‚Œã¾ã™ï¼ return [ \"tfa_token\" => $notifiable->tfaToken(), ]; } } å—ä¿¡ãƒãƒ£ãƒ³ãƒãƒ«ï¼ˆé€šçŸ¥æ–¹æ³•ï¼‰ ãƒ»Channel LaravelãŒæ¨™æº–ã§ç”¨æ„ã—ã¦ã„ã‚‹ãƒãƒ£ãƒ³ãƒãƒ«ä»¥å¤–ã«é€ä¿¡ã—ãŸã„å ´åˆã«ï¼Œç‹¬è‡ªã®å—ä¿¡ãƒãƒ£ãƒ³ãƒãƒ«ã‚’å®šç¾©ã™ã‚‹ï¼ã“ã‚Œã¯ï¼ŒNotificationã‚¯ãƒ©ã‚¹ã®viaãƒ¡ã‚½ãƒƒãƒ‰ã§ä½¿ç”¨ã•ã‚Œã‚‹ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š AWS SNSã‚’å—ä¿¡ãƒãƒ£ãƒ³ãƒãƒ«ã¨ã™ã‚‹ï¼AWSã‹ã‚‰é…å¸ƒã•ã‚Œã¦ã„ã‚‹ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ãŒå¿…è¦ã§ã‚ã‚‹ï¼ $ composer require aws/aws-sdk-php-laravel awsSnsClient = $awsSnsClient; } /** * @param $notifiable * @param Notification $notification */ public function send($notifiable, Notification $notification) { try { $message = $notification->toSms($notifiable); // AWS SNSã«ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’é€ä¿¡ã—ã¾ã™ï¼ $this->awsSnsClient->publish([ \"Message\" => $message, \"PhoneNumber\" => $this->toE164nizeInJapan( $notifiable->phoneNumber() ), ]); } catch (AwsException $e) { Log::error(sprintf( \"%s : %s at %s line %s\", get_class($e), $e->getMessage(), $e->getFile(), $e->getLine()) ); throw new AwsException($e->getMessage()); } } /** * @param string * @return string */ private function toE164nizeInJapan(string $phoneNumeber): string { // E.164å½¢å¼ã®æ—¥æœ¬é›»è©±ç•ªå·ã‚’è¿”å´ã—ã¾ã™ï¼ return \"+81\" . substr($phoneNumeber, 1); } } é€šçŸ¥å¯¾è±¡ãƒ¢ãƒ‡ãƒ« ãƒ»Notifiableãƒˆãƒ¬ã‚¤ãƒˆã®notifyãƒ¡ã‚½ãƒƒãƒ‰ é€šçŸ¥å¯¾è±¡ã¨ãªã‚‹ãƒ¢ãƒ‡ãƒ«ã‚’å®šç¾©ã™ã‚‹ï¼Notifiableãƒˆãƒ¬ã‚¤ãƒˆã‚’ç¶™æ‰¿ã™ã‚‹ï¼ã“ã‚Œã«ã‚ˆã‚Šï¼Œnotifyãƒ¡ã‚½ãƒƒãƒ‰ã‚’ä½¿ç”¨ã§ãã‚‹ã‚ˆã†ã«ãªã‚‹ï¼ å‚è€ƒï¼šhttps://laravel.com/api/8.x/Illuminate/Notifications/Notifiable.html é€šçŸ¥å¯¾è±¡ã®ã‚¯ãƒ©ã‚¹ã‹ã‚‰notifyãƒ¡ã‚½ãƒƒãƒ‰ã‚’ã‚³ãƒ¼ãƒ«ã—ï¼Œä»»æ„ã®Notificationã‚¯ãƒ©ã‚¹ã‚’æ¸¡ã™ï¼ã“ã‚Œã«ã‚ˆã‚Šï¼Œé€šçŸ¥å‡¦ç†ãŒå®Ÿè¡Œã•ã‚Œã‚‹ï¼ å‚è€ƒï¼šhttps://laravel.com/api/8.x/Illuminate/Notifications/RoutesNotifications.html#method_notify notify(new FooNotification()); ãƒ»Notificationãƒ•ã‚¡ã‚µãƒ¼ãƒ‰ é€šçŸ¥å¯¾è±¡ã¨ãªã‚‹ãƒ¢ãƒ‡ãƒ«ã‚’å®šç¾©ã™ã‚‹ï¼Notifiableãƒˆãƒ¬ã‚¤ãƒˆã‚’ç¶™æ‰¿ã™ã‚‹ï¼ Notificationãƒ•ã‚¡ã‚µãƒ¼ãƒ‰ã«é€šçŸ¥å¯¾è±¡ã®ãƒ¢ãƒ‡ãƒ«ã¨é€šçŸ¥ã‚¯ãƒ©ã‚¹ã‚’æ¸¡ã™ï¼ ãƒ»ã‚ªãƒ³ãƒ‡ãƒãƒ³ãƒ‰é€šçŸ¥ ã‚ªãƒ³ãƒ‡ãƒãƒ³ãƒ‰é€šçŸ¥ã‚’ä½¿ç”¨ã™ã‚‹ã¨ï¼Œé€šçŸ¥å¯¾è±¡ã¨ãªã‚‹ãƒ¢ãƒ‡ãƒ«ãŒNotificableãƒˆãƒ¬ã‚¤ãƒˆã«ä¾å­˜ã›ãšã«é€šçŸ¥ã‚’å®Ÿè¡Œã§ãã‚‹ï¼ å‚è€ƒï¼š https://laracasts.com/discuss/channels/laravel/notifications-without-eloquent-user-model https://readouble.com/laravel/8.x/ja/notifications.html#on-demand-notifications email_address) ->route('nexmo', $user->phone_number) ->route('slack', $slackMessage->usl) ->notify(new FooMotification()); 14. Resource artisanã‚³ãƒãƒ³ãƒ‰ã«ã‚ˆã‚‹æ“ä½œ ãƒ»Resourceã®ç”Ÿæˆ Resourceã‚¯ãƒ©ã‚¹ã‚’è‡ªå‹•ç”Ÿæˆã™ã‚‹ï¼ $ php artisan make:resource ãƒ¬ã‚¹ãƒãƒ³ã‚¹ãƒ‡ãƒ¼ã‚¿ä½œæˆå‰ã®ãƒ‡ãƒ¼ã‚¿å‹å¤‰æ› ãƒ»ãƒ‡ãƒ¼ã‚¿å‹å¤‰æ›ã®å¿…è¦æ€§ Eloquentãƒ¢ãƒ‡ãƒ«ã‚’JSONãƒ‡ãƒ¼ã‚¿ã¨ã—ã¦ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã™ã‚‹æ™‚ã«ï¼Œä¸€æ—¦ï¼Œé…åˆ—ãƒ‡ãƒ¼ã‚¿ã«å¤‰æ›ã™ã‚‹å¿…è¦ãŒã‚ã‚‹ï¼ ãƒ»å˜ä¸€ã®Eloquentãƒ¢ãƒ‡ãƒ«ã®é…åˆ—åŒ– å˜ä¸€ã®Eloquentãƒ¢ãƒ‡ãƒ«ã‚’é…åˆ—ã«å¤‰æ›ã™ã‚‹ï¼Resourceã‚¯ãƒ©ã‚¹ã®toArrayãƒ¡ã‚½ãƒƒãƒ‰ã«ã¦ï¼Œthiså¤‰æ•°ã¯è‡ªèº«ã§ã¯ãªãï¼ŒResourceã‚¯ãƒ©ã‚¹åã«ã¤ãEloquentãƒ¢ãƒ‡ãƒ«åã«ãªã‚‹ï¼ã¾ãŸï¼Œthiså¤‰æ•°ã‹ã‚‰ã‚²ãƒƒã‚¿ãƒ¼ã‚’çµŒç”±ã›ãšã«ç›´æ¥ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã«ã‚¢ã‚¯ã‚»ã‚¹ã§ãã‚‹ï¼Controllerã«ã¦ï¼ŒResouceã‚¯ãƒ©ã‚¹ã«Eloquentãƒ¢ãƒ‡ãƒ«ã‚’æ¸¡ã™ã‚ˆã†ã«ã™ã‚‹ï¼Laravelã¯ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã®JSONãƒ‡ãƒ¼ã‚¿ã‚’ä½œæˆã™ã‚‹ãŸã‚ã«ï¼Œã¾ãštoArrayãƒ¡ã‚½ãƒƒãƒ‰ã«ã‚ˆã‚Šé…åˆ—åŒ–ã—ï¼Œã•ã‚‰ã«ã“ã‚Œã‚’JSONãƒ‡ãƒ¼ã‚¿ã«å¤‰æ›ã™ã‚‹ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š Fooã‚¯ãƒ©ã‚¹ã‹ã‚‰ãƒ‡ãƒ¼ã‚¿ã‚’å–ã‚Šå‡ºã—ï¼Œé…åˆ—åŒ–ã™ã‚‹ï¼ $this->id, \"name\" => $this->name, ]; } }ï¼ ãƒ»è¤‡æ•°ã®Eloquentãƒ¢ãƒ‡ãƒ«ï¼ˆCollectionå‹ï¼‰ã®é…åˆ—åŒ– è¤‡æ•°ã®Eloquentãƒ¢ãƒ‡ãƒ«ï¼ˆCollectionå‹ï¼‰ã‚’é…åˆ—ã«å¤‰æ›ã™ã‚‹ï¼ // ã“ã“ã«å®Ÿè£…ä¾‹ 15. Routing artisanã‚³ãƒãƒ³ãƒ‰ã«ã‚ˆã‚‹æ“ä½œ ãƒ»ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ä¸€è¦§ # ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã‚’ä¸€è¦§ã§è¡¨ç¤º $ php artisan route:list ãƒ»Cacheå‰Šé™¤ # ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã®Cacheã‚’å‰Šé™¤ $ php artisan route:clear # å…¨ã¦ã®Cacheã‚’å‰Šé™¤ $ php artisan optimize:clear api.phpãƒ•ã‚¡ã‚¤ãƒ« ãƒ»Middlewareã®é©ç”¨ APIã®ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã¨ã—ã¦åƒããƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°å‡¦ç†ã‚’å®Ÿè£…ã™ã‚‹ï¼å®Ÿè£…ã—ãŸãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°å‡¦ç†æ™‚ã«ã¯ï¼ŒKernelã‚¯ãƒ©ã‚¹ã®middlewareGroupsãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã®apiã‚­ãƒ¼ã§è¨­å®šã—ãŸãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢ãŒå®Ÿè¡Œã•ã‚Œã‚‹ï¼APIã®ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã¯å¤–éƒ¨å…¬é–‹ã™ã‚‹å¿…è¦ãŒã‚ã‚‹ãŸã‚ï¼Œwebã‚­ãƒ¼ã¨æ¯”è¼ƒã—ã¦ï¼Œã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã®ãŸã‚ã®ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢ãŒè¨­å®šã•ã‚Œã¦ã„ãªã„ï¼ [ \"throttle:60,1\", \\Illuminate\\Routing\\Middleware\\SubstituteBindings::class, ], ]; // ã€œ ä¸­ç•¥ ã€œ } web.phpãƒ•ã‚¡ã‚¤ãƒ« ãƒ»Middlewareã®é©ç”¨ APIä»¥å¤–ã®ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°å‡¦ç†ã‚’å®Ÿè£…ã™ã‚‹ï¼å®Ÿè£…ã—ãŸãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°å‡¦ç†æ™‚ã«ã¯ï¼ŒKernelã‚¯ãƒ©ã‚¹ã®middlewareGroupsãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã®webã‚­ãƒ¼ã§è¨­å®šã—ãŸãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢ãŒå®Ÿè¡Œã•ã‚Œã‚‹ï¼APIä»¥å¤–ã®ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã¯å¤–éƒ¨å…¬é–‹ã™ã‚‹å¿…è¦ãŒãªã„ãŸã‚ï¼Œapiã‚­ãƒ¼ã¨æ¯”è¼ƒã—ã¦ï¼Œã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã®ãŸã‚ã®ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢ãŒå¤šãè¨­å®šã•ã‚Œã¦ã„ã‚‹ï¼ä¾‹ãˆã°ï¼ŒCSRFå¯¾ç­–ã®ãŸã‚ã®VerifyCsrfTokenã‚¯ãƒ©ã‚¹ãŒã‚ã‚‹ï¼ [ \\App\\Http\\Middleware\\EncryptCookies::class, \\Illuminate\\Cookie\\Middleware\\AddQueuedCookiesToResponse::class, \\Illuminate\\Session\\Middleware\\StartSession::class, // \\Illuminate\\Session\\Middleware\\AuthenticateSession::class, \\Illuminate\\View\\Middleware\\ShareErrorsFromSession::class, \\App\\Http\\Middleware\\VerifyCsrfToken::class, \\Illuminate\\Routing\\Middleware\\SubstituteBindings::class, ], // ã€œ ä¸­ç•¥ ã€œ ]; // ã€œ ä¸­ç•¥ ã€œ } guest.phpãƒ•ã‚¡ã‚¤ãƒ« ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯ãªã©ï¼ŒAPIèªè¨¼ãŒä¸è¦ãªãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°å‡¦ç†ã‚’å®Ÿè£…ã™ã‚‹ï¼ æš—é»™ã®ãƒ¢ãƒ‡ãƒ«çµåˆ ãƒ»ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ä½¿ç”¨æ™‚ ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°æ™‚ã«ä½¿ç”¨ã™ã‚‹ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿åã¨ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ã®ãƒ¡ã‚½ãƒƒãƒ‰ã®å¼•æ•°å‹ã¨å¤‰æ•°åãŒåŒã˜ã§ã‚ã‚Šï¼Œã‹ã¤ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã«æ•°å€¤ãŒå‰²ã‚Šå½“ã¦ã‚‰ã‚ŒãŸå ´åˆã«ï¼Œãã®æ•°å€¤ã‚’IDã¨ã™ã‚‹Eloquentãƒ¢ãƒ‡ãƒ«ãŒè‡ªå‹•çš„ã«ã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³ã•ã‚Œã‚‹ï¼ å‚è€ƒï¼šhttps://readouble.com/laravel/8.x/ja/routing.html#implicit-binding ï¼Šå®Ÿè£…ä¾‹ï¼Š ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°æ™‚ã«ï¼Œãƒ‘ã‚¹ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿åã‚’userã¨ã—ã¦ãŠãï¼ ã‹ã¤ï¼Œã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ã®ãƒ¡ã‚½ãƒƒãƒ‰ã®å¼•æ•°å‹ï¼å¤‰æ•°åã‚’Userï¼$userã¨ã™ã‚‹ï¼ã¾ãŸã¯ï¼ã“ã®æ™‚ï¼Œã€/users/1ã€ã«å¯¾ã—ã¦ãƒªã‚¯ã‚¨ã‚¹ãƒˆãŒé€ä¿¡ã•ã‚Œã‚‹ã¨ï¼Œãƒ¦ãƒ¼ã‚¶IDãŒ1ã®ãƒ¦ãƒ¼ã‚¶ãŒDBã‹ã‚‰èª­ã¿å‡ºã•ã‚Œï¼Œã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ã«ã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³ã•ã‚Œã‚‹ï¼ id; // ãƒ‘ã‚¹ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã®idã«ç´ä»˜ããƒ¦ãƒ¼ã‚¶ãŒè‡ªå‹•çš„ã«æ¸¡ã•ã‚Œã¦ã„ã‚‹ï¼ } } 16. Seeder artisanã‚³ãƒãƒ³ãƒ‰ã«ã‚ˆã‚‹æ“ä½œ ãƒ»Seederã®ç”Ÿæˆ Seederã‚¯ãƒ©ã‚¹ã‚’è‡ªå‹•ç”Ÿæˆã™ã‚‹ï¼ $ php artisan make:seeder ãƒ»Seederã®å®Ÿè¡Œ Seederã‚’æ–°ã—ãä½œæˆã—ãŸæ™‚ã‚„Seederåã‚’å¤‰æ›´ã—ãŸæ™‚ï¼ŒComposerã®dump-autoloadã‚’å®Ÿè¡Œã™ã‚‹å¿…è¦ãŒã‚ã‚‹ï¼ $ composer dump-autoload # ç‰¹å®šã®Seederã‚’å®Ÿè¡Œ $ php artisan db:seed --class= # DatabaseSeederã‚’æŒ‡å®šã—ã¦ï¼Œå…¨ã¦ã®Seederã‚’å®Ÿè¡Œ $ php artisan db:seed --class= åˆæœŸãƒªã‚¢ãƒ«ãƒ‡ãƒ¼ã‚¿ã®å®šç¾© ãƒ»DBãƒ•ã‚¡ã‚µãƒ¼ãƒ‰ã«ã‚ˆã‚‹å®šç¾© insert([ \"product_name\" => \"ã‚·ãƒ£ãƒ¼ãƒ—ãƒšãƒ³ã‚·ãƒ«\", \"price\" => 300, \"product_type\" => 1, \"created_by\" => ExecutorConstant::ARTISAN_COMMAND, \"updated_by\" => ExecutorConstant::ARTISAN_COMMAND, \"created_at\" => NOW(), \"updated_at\" => NOW(), \"deleted_at\" => NULL ], [ \"product_name\" => \"ãƒãƒ¼ãƒˆ\", \"price\" => 200, \"product_type\" => 2, \"created_by\" => ExecutorConstant::ARTISAN_COMMAND, \"updated_by\" => ExecutorConstant::ARTISAN_COMMAND, \"created_at\" => NOW(), \"updated_at\" => NOW(), \"deleted_at\" => NULL ], [ \"product_name\" => \"æ¶ˆã—ã‚´ãƒ \", \"price\" => 100, \"product_type\" => 3, \"created_by\" => ExecutorConstant::ARTISAN_COMMAND, \"updated_by\" => ExecutorConstant::ARTISAN_COMMAND, \"created_at\" => NOW(), \"updated_at\" => NOW(), \"deleted_at\" => NULL ], // ï½ ä¸­ç•¥ ï½ ]); } } å®Ÿè¡Œè€…åã¯ï¼Œå®šæ•°ã¨ã—ã¦ç®¡ç†ã—ã¦ãŠãã¨ã‚ˆã„ï¼ ãƒ»CSVãƒ•ã‚¡ã‚¤ãƒ«ã«ã‚ˆã‚‹å®šç¾© // ã“ã“ã«å®Ÿè£…ä¾‹ Seederã®å®Ÿè¡Œ DatabaseSeederã«ã¦ï¼Œå…¨ã¦ã®Seederã‚’ã¾ã¨ã‚ã¦å®Ÿè¡Œã™ã‚‹ï¼ call([ // ãƒ€ãƒŸãƒ¼ãƒ‡ãƒ¼ã‚¿ ]); } // ã‚¹ãƒ†ãƒ¼ã‚¸ãƒ³ã‚°ç’°å¢ƒç”¨ã®åˆæœŸãƒ‡ãƒ¼ã‚¿ if (App::environment(\"staging\")) { $this->call([ // ãƒªã‚¢ãƒ«ãƒ‡ãƒ¼ã‚¿ ProductsSeeder::class ]); } // æœ¬ç•ªç’°å¢ƒç”¨ã®åˆæœŸãƒ‡ãƒ¼ã‚¿ if (App::environment(\"production\")) { $this->call([ // ãƒªã‚¢ãƒ«ãƒ‡ãƒ¼ã‚¿ ProductsSeeder::class ]); } } } 17. ServiceProvider artisanã‚³ãƒãƒ³ãƒ‰ã«ã‚ˆã‚‹æ“ä½œ ãƒ»ã‚¯ãƒ©ã‚¹ã®è‡ªå‹•ç”Ÿæˆ $ php artisan make:provider ServiceProvider ãƒ»ServiceProviderã®ç”¨é€” ç”¨é€”ã®ç¨®é¡ èª¬æ˜ AppServiceProvider ãƒ»ServiceContainerã¸ã®ã‚¯ãƒ©ã‚¹ã®ãƒã‚¤ãƒ³ãƒ‰ï¼ˆç™»éŒ²ï¼‰ãƒ»ServiceContainerã‹ã‚‰ã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã®ãƒªã‚¾ãƒ«ãƒ–ï¼ˆç”Ÿæˆï¼‰ MacroServiceProvider ServiceContainerã¸ã®ãƒ¡ã‚½ãƒƒãƒ‰ã®ãƒã‚¤ãƒ³ãƒ‰ï¼ˆç™»éŒ²ï¼‰ RouteServiceProviderï¼ˆapp.phpï¼Œweb.phpã‚‚ä½¿ç”¨ï¼‰ ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã¨ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ã®å¯¾å¿œé–¢ä¿‚ã®å®šç¾© EventServiceProvider EventListenerã¨Eventhandleré–¢æ•°ã®å¯¾å¿œé–¢ä¿‚ã®å®šç¾© ãƒ»ServiceProviderã®ã‚³ãƒ¼ãƒ« ã‚¯ãƒ©ã‚¹ã®åå‰ç©ºé–“ã‚’ï¼Œconfig/app.phpãƒ•ã‚¡ã‚¤ãƒ«ã®providersé…åˆ—ã«ç™»éŒ²ã™ã‚‹ã¨ï¼Œã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®èµ·å‹•æ™‚ã«ServiceProviderã‚’ã‚³ãƒ¼ãƒ«ã§ãã‚‹ãŸã‚ï¼ŒServiceContainerã¸ã®ã‚¯ãƒ©ã‚¹ã®ãƒã‚¤ãƒ³ãƒ‰ãŒè‡ªå‹•çš„ã«å®Œäº†ã™ã‚‹ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š [ // è¤‡æ•°ã®ServiceProviderãŒå®Ÿè£…ã•ã‚Œã¦ã„ã‚‹ App\\Providers\\ComposerServiceProvider::class, ], ServiceContainer ãƒ»ServiceContainerï¼Œãƒã‚¤ãƒ³ãƒ‰ï¼Œãƒªã‚¾ãƒ«ãƒ–ã¨ã¯ ServiceContainerï¼Œãƒã‚¤ãƒ³ãƒ‰ï¼Œãƒªã‚¾ãƒ«ãƒ–ã«ã¤ã„ã¦ã¯ï¼Œä»¥ä¸‹ã‚’å‚è€ƒã«ã›ã‚ˆï¼ å‚è€ƒï¼šhttps://hiroki-it.github.io/tech-notebook-gitbook/public/software/software_application_backend_php_object_orientation_class.html AppServiceProvider ãƒ»å˜ä¸€ã®ã‚¯ãƒ©ã‚¹ã‚’ãƒã‚¤ãƒ³ãƒ‰ï¼ãƒªã‚¾ãƒ«ãƒ– AppSeriveProviderã«ã¦ï¼ŒServiceContainerã«ã‚¯ãƒ©ã‚¹ã‚’ãƒã‚¤ãƒ³ãƒ‰ã™ã‚‹ã“ã¨ã«ã‚ˆã£ã¦ï¼ŒServiceContainerãŒã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’ãƒªã‚¾ãƒ«ãƒ–ã§ãã‚‹ã‚ˆã†ã«ãªã‚‹ï¼ã“ã‚Œã«ã‚ˆã‚Šï¼Œãƒ¡ã‚½ãƒƒãƒ‰ã®å¼•æ•°ã§ã‚¯ãƒ©ã‚¹ã‚’æŒ‡å®šã—ã•ãˆã™ã‚Œã°ï¼Œãã®ã‚¯ãƒ©ã‚¹ã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ãŒæ¸¡ã•ã‚Œã‚‹ãŸã‚ï¼Œè‡ªå‹•çš„ã«ä¾å­˜ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆæ³¨å…¥ãŒå®Ÿè¡Œã•ã‚ŒãŸã“ã¨ã«ãªã‚‹ï¼Laravelã§ã¯ï¼Œã‚¯ãƒ©ã‚¹ã¯ServiceContainerã«è‡ªå‹•çš„ã«ãƒã‚¤ãƒ³ãƒ‰ã•ã‚Œã¦ãŠã‚Šï¼Œå¼•æ•°ã§ã‚¯ãƒ©ã‚¹ã‚’æŒ‡å®šã™ã‚‹ã ã‘ã§ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ãŒç”Ÿæˆã•ã‚Œã‚‹ãŸã‚ï¼Œä»¥ä¸‹ã®å®Ÿè£…ã‚’å®Ÿè¡Œã™ã‚‹å¿…è¦ã¯ãªã„ï¼ãŸã ã—ï¼Œæ··åˆå‹ã®å ´åˆã¯å¼•æ•°ã®å‹ã‚’æŒ‡å®šã§ããªã„ãŸã‚ï¼Œãƒªã‚¾ãƒ«ãƒ–ã¯å®Ÿè¡Œã§ããªã„ï¼ å‚è€ƒï¼šhttps://readouble.com/laravel/8.x/ja/container.html#automatic-injection ï¼Šå®Ÿè£…ä¾‹ï¼Š ãƒã‚¤ãƒ³ãƒ‰ã™ã‚‹ï¼ãªãŠï¼ŒLaravelã§ã¯ä¸è¦ã§ã‚ã‚‹ï¼ app->bind(Foo::class, function ($app) { return new Foo(new Bar, new Baz); }); } } å¼•æ•°ã®å‹ã‚’å…ƒã«ï¼Œã‚¯ãƒ©ã‚¹ã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ãŒãƒªã‚¾ãƒ«ãƒ–ã•ã‚Œã‚‹ï¼ bar; $foo->baz; } } å¼•æ•°ã®å‹ã‚’æŒ‡å®šã—ãªã„å ´åˆã¯ï¼Œæ‰‹å‹•ã§æ¸¡ã™å¿…è¦ãŒã‚ã‚‹ï¼ bar; $foo->baz; } } $foo = new Foo(); $qux = new Qux($foo); // æ‰‹å‹•ã§æ¸¡ã™ æ··åˆå‹ã®å ´åˆã¯ï¼Œå¼•æ•°ã®å‹ã‚’æŒ‡å®šã§ããªã„ãŸã‚ï¼Œãƒªã‚¾ãƒ«ãƒ–ã‚’å®Ÿè¡Œã§ããªã„ï¼ bar; $mixed->baz; } } $foo1 = new Foo1(); $foo2 = new Foo2(); $foo3 = new Foo3(); $qux = new Qux($foo1); ãƒ»è¤‡æ•°ã®ã‚¯ãƒ©ã‚¹ã‚’ãƒã‚¤ãƒ³ãƒ‰ï¼ãƒªã‚¾ãƒ«ãƒ– ãƒ¡ã‚½ãƒƒãƒ‰ã®å¼•æ•°ã§ã‚¯ãƒ©ã‚¹ã‚’æŒ‡å®šã—ã•ãˆã™ã‚Œã°ï¼Œãã®ã‚¯ãƒ©ã‚¹ã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ãŒæ¸¡ã•ã‚Œã‚‹ãŸã‚ï¼Œè‡ªå‹•çš„ã«ä¾å­˜ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆæ³¨å…¥ãŒå®Ÿè¡Œã•ã‚ŒãŸã“ã¨ã«ãªã‚‹ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š registerFoo(); $this->registerBar(); $this->registerBaz(); } /** * ä¸€ã¤ç›®ã®ã‚¯ãƒ©ã‚¹ã‚’ãƒã‚¤ãƒ³ãƒ‰ */ private function registerFoo() { $this->app->bind(Foo::class, function ($app) { return new Foo(); }); } /** * äºŒã¤ç›®ã®ã‚¯ãƒ©ã‚¹ã‚’ãƒã‚¤ãƒ³ãƒ‰ */ private function registerBar() { $this->app->bind(Bar::class, function ($app) { return new Bar(); }); } /** * ä¸‰ã¤ç›®ã®ã‚¯ãƒ©ã‚¹ã‚’ãƒã‚¤ãƒ³ãƒ‰ */ private function registerBaz() { $this->app->bind(Baz::class, function ($app) { return new Baz(); }); } } ãƒ»ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã‚’ãƒã‚¤ãƒ³ãƒ‰ã—ï¼Œå®Ÿè£…ã‚¯ãƒ©ã‚¹ã‚’ãƒªã‚¾ãƒ«ãƒ– Laravelã«ãŠã„ã¦ã¯ã‚¯ãƒ©ã‚¹ãŒè‡ªå‹•çš„ã«ãƒã‚¤ãƒ³ãƒ‰ã•ã‚Œï¼Œã“ã‚Œã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ãŒãƒªã‚¾ãƒ«ãƒ–ã•ã‚Œã‚‹ï¼Œã—ã‹ã—ï¼Œãƒã‚¤ãƒ³ãƒ‰ã•ã‚ŒãŸã‚¯ãƒ©ã‚¹ã¨ã¯åˆ¥ã®ã‚¯ãƒ©ã‚¹ã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’ãƒªã‚¾ãƒ«ãƒ–ã—ãŸã„å ´åˆã¯ï¼ŒServiceProviderã«ãã‚Œã‚’å®šç¾©ã™ã‚Œã°ï¼Œè‡ªå‹•çš„ãªãƒã‚¤ãƒ³ãƒ‰ã‚’ä¸Šæ›¸ãã§ãã‚‹ï¼ã“ã‚Œã‚’åˆ©ç”¨ã—ã¦ï¼Œã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã‚’ãƒã‚¤ãƒ³ãƒ‰ã—ï¼Œå®Ÿè£…ã‚¯ãƒ©ã‚¹ã‚’ãƒªã‚¾ãƒ«ãƒ–ã§ãã‚‹ã‚ˆã†ã«ã™ã‚‹ï¼ã“ã®æ–¹æ³•ã¯ï¼Œä¸Šä½ãƒ¬ã‚¤ãƒ¤ãƒ¼ãŒæŠ½è±¡ã«ä¾å­˜ã™ã‚‹ã“ã¨ãŒå¿…è¦ãªå ´é¢ï¼ˆä¾‹ï¼šä¾å­˜æ€§é€†è»¢ã®åŸå‰‡ï¼‰ã§å½¹ç«‹ã¤ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š app->bind( \"App\\Domain\\Foo\\Repositories\\FooRepositoryInterface\", // ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ \"App\\Infrastructure\\Doo\\Repositories\\FooRepository\" // å®Ÿè£…ã‚¯ãƒ©ã‚¹ ); } } fooRepository = $fooRepository; } } ãƒ»makeãƒ¡ã‚½ãƒƒãƒ‰ å¼•æ•°ã®å‹ã§ãƒªã‚¾ãƒ«ãƒ–ã‚’å®Ÿè¡Œã™ã‚‹ä»¥å¤–ã«ï¼Œmakeãƒ¡ã‚½ãƒƒãƒ‰ã‚’ä½¿ç”¨ã™ã‚‹ã“ã¨ã‚‚å¯èƒ½ã§ã‚ã‚‹ï¼makeãƒ¡ã‚½ãƒƒãƒ‰ã®å¼•æ•°ã«ã‚¯ãƒ©ã‚¹ã®åå‰ç©ºé–“ã‚’æ¸¡ã™ã“ã¨ã§ï¼Œã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ãŒãƒªã‚¾ãƒ«ãƒ–ã•ã‚Œã‚‹ï¼ å‚è€ƒï¼šhttps://readouble.com/laravel/8.x/ja/container.html#the-make-method ï¼Šå®Ÿè£…ä¾‹ï¼Š make(Foo::class) ->method(); // Fooã‚¯ãƒ©ã‚¹ã‚’ãƒªã‚¾ãƒ«ãƒ– $foo = App::make(Foo::class); $result = $foo->method(); ãƒ»registerãƒ¡ã‚½ãƒƒãƒ‰ã¨bootãƒ¡ã‚½ãƒƒãƒ‰ã®é•ã„ Laravelã®ãƒ©ã‚¤ãƒ•ã‚µã‚¤ã‚¯ãƒ«ã«ãŠã„ã¦ï¼ŒServiceContainerã¸ã®ã‚¯ãƒ©ã‚¹ã®ãƒã‚¤ãƒ³ãƒ‰ã®æ™‚ã«ã¯ï¼Œã¾ãšServiceProviderã®registerãƒ¡ã‚½ãƒƒãƒ‰ãŒå®Ÿè¡Œã•ã‚Œï¼Œãã®å¾Œã«bootãƒ¡ã‚½ãƒƒãƒ‰ãŒå®Ÿè¡Œã•ã‚Œã‚‹ï¼ãã®ãŸã‚ï¼ŒServiceProviderãŒä»–ã®ServiceProviderã‚’ã‚³ãƒ¼ãƒ«ã™ã‚‹ã‚ˆã†ãªå‡¦ç†ã‚’å®Ÿè£…ã—ãŸã„ã¨ãï¼Œã“ã‚Œã¯bootãƒ¡ã‚½ãƒƒãƒ‰ã«å®Ÿè£…ã™ã‚‹ã“ã¨ãŒé©ã—ã¦ã„ã‚‹ï¼ MigrationMacroServiceProvider è¤‡æ•°ã®ãƒ†ãƒ¼ãƒ–ãƒ«ã«å…±é€šã®ã‚«ãƒ©ãƒ ã‚’æ§‹ç¯‰ã™ã‚‹ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å‡¦ç†ã‚’æä¾›ã™ã‚‹ï¼ string(\"created_by\") ->comment(\"ãƒ¬ã‚³ãƒ¼ãƒ‰ã®ä½œæˆè€…\") ->nullable(); $this->string(\"updated_by\") ->comment(\"ãƒ¬ã‚³ãƒ¼ãƒ‰ã®æœ€çµ‚æ›´æ–°è€…\") ->nullable(); $this->timestamp(\"created_at\") ->comment(\"ãƒ¬ã‚³ãƒ¼ãƒ‰ã®ä½œæˆæ—¥\") ->nullable(); $this->timestamp(\"updated_at\") ->comment(\"ãƒ¬ã‚³ãƒ¼ãƒ‰ã®æœ€çµ‚æ›´æ–°æ—¥\") ->nullable(); $this->timestamp(\"deleted_at\") ->comment(\"ãƒ¬ã‚³ãƒ¼ãƒ‰ã®å‰Šé™¤æ—¥\") ->nullable(); }); Blueprint::macro(\"dropSystemColumns\", function () { $this->dropColumn( \"created_by\", \"updated_by\", \"created_at\", \"updated_at\", \"deleted_at\" ); }); } } ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãƒ•ã‚¡ã‚¤ãƒ«ã«ã¦ï¼Œå®šç¾©ã—ãŸsystemColumnãƒ¡ã‚½ãƒƒãƒ‰ã‚’ã‚³ãƒ¼ãƒ«ã™ã‚‹ï¼softDeletesãƒ¡ã‚½ãƒƒãƒ‰ã«ã¤ã„ã¦ã¯ï¼Œä»¥é™ã®èª¬æ˜ã‚’å‚ç…§ã›ã‚ˆï¼ bigIncrements(\"foo_id\") ->comment(\"ID\"); $table->string(\"name\") ->comment(\"åå‰\"); // MigrationMacroServiceProviderã®ãƒ¡ã‚½ãƒƒãƒ‰ã‚’ä½¿ç”¨ã™ã‚‹ï¼ $table->systemColumns(); // deleted_atã‚«ãƒ©ãƒ ã‚’è¿½åŠ ã™ã‚‹ï¼ $table->softDeletes(); }); } /** * ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯ * * @return void */ public function down() { Schema::drop(\"foos\"); } } RouteServiceProvider ãƒ»å…¨ã¦ã®ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã¸ã®å‡¦ç† ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã®è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚³ãƒ¼ãƒ«ã™ã‚‹ï¼ã¾ãŸï¼Œå…¨ã¦ã®ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã«é©ç”¨ã™ã‚‹å‡¦ç†ã‚’å®šç¾©ã™ã‚‹ï¼ å‚è€ƒï¼šhttps://readouble.com/laravel/8.x/ja/routing.html#parameters-global-constraints ï¼Šå®Ÿè£…ä¾‹ï¼Š middleware('api') ->namespace($this->namespace) ->group(base_path('routes/healthcheck.php')); // API Route::prefix('api') ->middleware('api') ->namespace($this->namespace) ->group(base_path('routes/api.php')); } } ãƒ»ãƒªã‚¯ã‚¨ã‚¹ãƒˆæ•°åˆ¶é™ ä¸€åˆ†é–“å½“ãŸã‚Šã«è¨±å®¹ã™ã‚‹ãƒªã‚¯ã‚¨ã‚¹ãƒˆæ•°ã¨ãã®åˆ¶é™åã‚’configureRateLimitingãƒ¡ã‚½ãƒƒãƒ‰ã§å®šç¾©ã™ã‚‹ï¼ã•ã‚‰ã«ï¼ŒThrottleãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢ã«åˆ¶é™åã‚’æ¸¡ã—ï¼ŒæŒ‡å®šã—ãŸãƒ«ãƒ¼ãƒˆã«ãƒªã‚¯ã‚¨ã‚¹ãƒˆæ•°åˆ¶é™ã‚’é©ç”¨ã•ã›ã‚‹ï¼Œã‚‚ã—åˆ¶é™ã‚’è¶…ãˆãŸå ´åˆï¼ŒconfigureRateLimitingãƒ¡ã‚½ãƒƒãƒ‰ã«ã‚ˆã£ã¦ï¼Œ429ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã§ãƒ¬ã‚¹ãƒãƒ³ã‚¹ãŒè¿”ä¿¡ã•ã‚Œã‚‹ï¼ å‚è€ƒï¼šhttps://readouble.com/laravel/8.x/ja/routing.html#rate-limiting ï¼Šå®Ÿè£…ä¾‹ï¼Š [ ], 'api' => [ // throttleãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢ã‚’é©ç”¨ã™ã‚‹ï¼ 'throttle:limit_per_minute', \\Illuminate\\Routing\\Middleware\\SubstituteBindings::class, ], ]; /** * @return void */ public function configureRateLimiting() { RateLimiter::for('limit_per_minute', function (Request $request) { // ä¸€åˆ†é–“å½“ãŸã‚Š1000ãƒªã‚¯ã‚¨ã‚¹ãƒˆã¾ã§ã‚’è¨±å¯ã™ã‚‹ï¼ return Limit::perMinute(1000); }); } } EventServiceProvider ãƒ»Eventã¨Listenerã®ç™»éŒ² Eventã¨Listenerã®å¯¾å¿œé–¢ä¿‚ã‚’å®šç¾©ã™ã‚‹ï¼ãªãŠï¼ŒEventã‚’ç™ºç«ã•ã›ã¦Listenerã‚’å®Ÿè¡Œã™ã‚‹æ–¹æ³•ã¯ï¼ŒEventã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’å‚ç…§ã›ã‚ˆï¼ ãƒªã‚¹ãƒŠãƒ¼] * * @var array */ protected $listen = [ // Eloquentãƒ¢ãƒ‡ãƒ«æ›´æ–°ã‚¤ãƒ™ãƒ³ãƒˆ UpdatedModelEvent::class => [ UpdatedModelListener::class, ], ]; /** * @return void */ public function boot() { } } ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ ãƒ»CSRFå¯¾ç­– ã‚»ãƒƒã‚·ãƒ§ãƒ³é–‹å§‹æ™‚ã«CSRFãƒˆãƒ¼ã‚¯ãƒ³ãŒç”Ÿæˆã•ã‚Œã‚‹ï¼Bladeã‚’ä½¿ç”¨ã—ã¦ã‚µãƒ¼ãƒå´ã®CSRFãƒˆãƒ¼ã‚¯ãƒ³ã‚’å–ã‚Šå‡ºã—ï¼Œinputã‚¿ã‚°ã®hiddenå±æ€§ã«CSRFãƒˆãƒ¼ã‚¯ãƒ³ã‚’å‰²ã‚Šå½“ã¦é€ä¿¡ã™ã‚‹ï¼ å‚è€ƒï¼šhttps://readouble.com/laravel/8.x/ja/csrf.html @csrf ... Bladeã‚’ä½¿ç”¨ã—ãªã„å ´åˆï¼Œã‚»ãƒƒã‚·ãƒ§ãƒ³é–‹å§‹æ™‚ã®ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã®Set-Cookieã«CSRFãƒˆãƒ¼ã‚¯ãƒ³ãŒå‰²ã‚Šå½“ã¦ã‚‰ã‚Œã‚‹ãŸã‚ï¼Œã“ã‚Œã‚’å–ã‚Šå‡ºã—ã¦X-CSRF-TOKENãƒ˜ãƒƒãƒ€ãƒ¼ã‚„X-XSRF-TOKENãƒ˜ãƒƒãƒ€ãƒ¼ã«å‰²ã‚Šå½“ã¦ã‚‹ã‚ˆã†ã«ã™ã‚‹ï¼ãƒªã‚¯ã‚¨ã‚¹ãƒˆã®ãŸã³ã«ç•°ãªã‚‹CSRFãƒˆãƒ¼ã‚¯ãƒ³ãŒãƒ¬ã‚¹ãƒãƒ³ã‚¹ã•ã‚Œï¼Œã“ã‚Œã‚’æ¬¡ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆã§ä½¿ç”¨ã™ã‚‹å¿…è¦ãŒã‚ã‚‹ï¼ å‚è€ƒï¼š https://readouble.com/laravel/8.x/ja/csrf.html#csrf-x-csrf-token https://readouble.com/laravel/8.x/ja/csrf.html#csrf-x-xsrf-token https://stackoverflow.com/questions/42408177/what-is-the-difference-between-x-xsrf-token-and-x-csrf-token ã¡ãªã¿ã«ï¼ŒPostmanãªã©ã®HTTPã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆãƒ„ãƒ¼ãƒ«ã‚’ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã®ä»£ã‚ã‚Šã«ä½¿ç”¨ã™ã‚‹å ´åˆã¯ï¼Œãƒ¬ã‚¹ãƒãƒ³ã‚¹ã§è¿”ä¿¡ã•ã‚Œã‚‹CSRFãƒˆãƒ¼ã‚¯ã‚’æ‰±ãˆãªã„ï¼Œãã“ã§ï¼Œå„ãƒªã‚¯ã‚¨ã‚¹ãƒˆã§äº‹å‰ã«ãƒ«ãƒ¼ãƒˆãƒ‘ã‚¹ã®ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã‚’ã‚³ãƒ¼ãƒ«ã—ï¼ŒCSRFãƒˆãƒ¼ã‚¯ãƒ³ã‚’Postmanã®ç’°å¢ƒå¤‰æ•°ã«ä¿å­˜ã™ã‚‹ã‚ˆã†ãªã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’è¨­å®šã—ã¦ãŠãã¨è‰¯ã„ï¼ if (pm.request.method == 'GET') { return true; } return pm.sendRequest(\"http://127.0.0.1:8000\", (error, response, {cookies}) => { if (error) { console.error(error); return false; } const xsrfTokenHeader = cookies.one(\"XSRF-TOKEN\"); if (!xsrfTokenHeader) { console.log(\"ãƒˆãƒ¼ã‚¯ãƒ³ãŒã‚ã‚Šã¾ã›ã‚“\"); return false; } // laravelã«ã‚ˆã£ã¦ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ã•ã‚ŒãŸãƒˆãƒ¼ã‚¯ãƒ³ã‚’ãƒ‡ã‚³ãƒ¼ãƒ‰ã™ã‚‹ï¼ const xsrfToken = decodeURIComponent(xsrfTokenHeader['value']); // ç’°å¢ƒå¤‰æ•°ã‚’æŒ¿å…¥ã™ã‚‹ãŸã‚ã«ï¼Œè©²å½“ã™ã‚‹ç’°å¢ƒåã‚’Collectionå…¨ä½“ã«é©ç”¨ã—ã¦ãŠãå¿…è¦ãŒã‚ã‚‹ï¼ pm.environment.set('XSRF_TOKEN', xsrfToken); console.log(xsrfToken); return true; }); ãƒ»XSSå¯¾ç­– ãƒ»å¸¸æ™‚HTTPSåŒ– MySQL ãƒ»å˜ä¸€ã®ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®å ´åˆ å˜ä¸€ã®ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã«æ¥ç¶šã™ã‚‹å ´åˆï¼ŒDB_HOSTã‚’ä¸€ã¤ã ã‘è¨­å®šã™ã‚‹ï¼ env(\"DB_CONNECTION\", \"mysql\"), \"connections\" => [ // ï½ ä¸­ç•¥ ï½ \"mysql\" => [ \"driver\" => \"mysql\", \"url\" => env(\"DATABASE_URL\"), \"host\" => env(\"DB_HOST\", \"127.0.0.1\"), \"port\" => env(\"DB_PORT\", 3306), \"database\" => env(\"DB_DATABASE\", \"forge\"), \"username\" => env(\"DB_USERNAME\", \"forge\"), \"password\" => env(\"DB_PASSWORD\", \"\"), \"unix_socket\" => env(\"DB_SOCKET\", \"\"), \"charset\" => \"utf8mb4\", \"collation\" => \"utf8mb4_unicode_ci\", \"prefix\" => \"\", \"prefix_indexes\" => true, \"strict\" => true, \"engine\" => null, \"options\" => extension_loaded(\"pdo_mysql\") ? array_filter([ PDO::MYSQL_ATTR_SSL_CA => env(\"MYSQL_ATTR_SSL_CA\"), ]) : [], ], ], // ï½ ä¸­ç•¥ ï½ ]; ãƒ»RDSã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ã®å ´åˆ RDSã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ã«æ¥ç¶šã™ã‚‹å ´åˆï¼Œæ›¸ãè¾¼ã¿å‡¦ç†ã‚’ãƒ—ãƒ©ã‚¤ãƒãƒªã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã«å‘ã‘ï¼Œã¾ãŸèª­ã¿å‡ºã—å‡¦ç†ã‚’ãƒªãƒ¼ãƒ‰ãƒ¬ãƒ—ãƒªã‚«ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã«å‘ã‘ã‚‹ã“ã¨ã«ã‚ˆã‚Šï¼Œè² è·ã‚’åˆ†æ•£ã§ãã‚‹ï¼ã“ã®å ´åˆï¼Œç’°å¢ƒå¤‰æ•°ã«äºŒã¤ã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã®ãƒ›ã‚¹ãƒˆã‚’å®Ÿè£…ã™ã‚‹å¿…è¦ãŒã‚ã‚‹ï¼ å‚è€ƒï¼šhttps://readouble.com/laravel/8.x/ja/database.html#contentContainer:~:text=Read%EF%BC%8FWrite%E6%8E%A5%E7%B6%9A DB_HOST_PRIMARY= DB_HOST_READ= ãªãŠï¼Œstickyã‚­ãƒ¼ã‚’æœ‰åŠ¹åŒ–ã—ã¦ãŠãã¨ã‚ˆã„ï¼ãƒ—ãƒ©ã‚¤ãƒãƒªã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã«ãŠã‘ã‚‹ãƒ‡ãƒ¼ã‚¿æ›´æ–°ãŒãƒªãƒ¼ãƒ‰ãƒ¬ãƒ—ãƒªã‚«ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã«åŒæœŸã•ã‚Œã‚‹å‰ã«ï¼Œãƒªãƒ¼ãƒ‰ãƒ¬ãƒ—ãƒªã‚«ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã«å¯¾ã—ã¦èª­ã¿å‡ºã—å‡¦ç†ãŒèµ·ã“ã‚‹ã‚ˆã†ãªå ´åˆï¼Œã“ã‚Œã‚’é˜²ã’ã‚‹ï¼ env(\"DB_CONNECTION\", \"mysql\"), \"connections\" => [ // ï½ ä¸­ç•¥ ï½ \"mysql\" => [ \"driver\" => \"mysql\", \"url\" => env(\"DATABASE_URL\"), \"read\" => [ \"host\" => [ env(\"DB_HOST_PRIMARY\", \"127.0.0.1\"), ], ], \"write\" => [ \"host\" => [ env(\"DB_HOST_READ\", \"127.0.0.1\"), ], ], # stickyã‚­ãƒ¼ã¯æœ‰åŠ¹åŒ–ã—ã¦ãŠã„ãŸã»ã†ãŒã‚ˆã„ï¼ \"sticky\" => true, \"port\" => env(\"DB_PORT\", 3306), \"database\" => env(\"DB_DATABASE\", \"forge\"), \"username\" => env(\"DB_USERNAME\", \"forge\"), \"password\" => env(\"DB_PASSWORD\", \"\"), \"unix_socket\" => env(\"DB_SOCKET\", \"\"), \"charset\" => \"utf8mb4\", \"collation\" => \"utf8mb4_unicode_ci\", \"prefix\" => \"\", \"prefix_indexes\" => true, \"strict\" => true, \"engine\" => null, \"options\" => extension_loaded(\"pdo_mysql\") ? array_filter([ PDO::MYSQL_ATTR_SSL_CA => env(\"MYSQL_ATTR_SSL_CA\"), ]) : [], ], ], // ï½ ä¸­ç•¥ ï½ ]; 18. Session ã‚»ãƒƒã‚·ãƒ§ãƒ³ã®æ“ä½œ ãƒ»è¨­å®šãƒ•ã‚¡ã‚¤ãƒ« env('SESSION_DRIVER', 'file'), 'lifetime' => env('SESSION_LIFETIME', 120), 'expire_on_close' => false, 'encrypt' => false, 'files' => storage_path('framework/sessions'), 'connection' => env('SESSION_CONNECTION', null), 'table' => 'sessions', 'store' => env('SESSION_STORE', null), 'lottery' => [2, 100], 'cookie' => env( 'SESSION_COOKIE', Str::slug(env('APP_NAME', 'laravel'), '_') . '_session' ), 'path' => '/', // Set-Cookieãƒ˜ãƒƒãƒ€ãƒ¼ã®domainå±æ€§ã«å€¤ã‚’å‰²ã‚Šå½“ã¦ã‚‹ï¼ 'domain' => env('SESSION_DOMAIN', null), // Set-Cookieãƒ˜ãƒƒãƒ€ãƒ¼ã®secureå±æ€§ã‚’æœ‰åŠ¹åŒ–ã™ã‚‹ï¼ 'secure' => env('SESSION_SECURE_COOKIE', false), // Set-Cookieãƒ˜ãƒƒãƒ€ãƒ¼ã®HttpOnlyå±æ€§ã‚’æœ‰åŠ¹åŒ–ã™ã‚‹ï¼ 'http_only' => true, // Set-Cookieãƒ˜ãƒƒãƒ€ãƒ¼ã®sameSiteå±æ€§ã«å€¤ã‚’å‰²ã‚Šå½“ã¦ã‚‹ï¼nullã®å ´åˆï¼ŒLaxã¨ãªã‚‹ï¼ 'same_site' => null, ]; ãƒ»ã‚ˆãä½¿ã†æ“ä½œãƒ¡ã‚½ãƒƒãƒ‰ FormRequestã‚¯ãƒ©ã‚¹ã®sessionãƒ¡ã‚½ãƒƒãƒ‰ã¯Storeã‚¯ãƒ©ã‚¹ã‚’è¿”å´ã™ã‚‹ï¼ã“ã®ã‚¯ãƒ©ã‚¹ã®ãƒ¡ã‚½ãƒƒãƒ‰ã‚’ä½¿ç”¨ã—ã¦ï¼Œã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚’æ“ä½œã§ãã‚‹ï¼ ãƒ¡ã‚½ãƒƒãƒ‰å èª¬æ˜ get ã‚»ãƒƒã‚·ãƒ§ãƒ³ã®ã‚­ãƒ¼åã‚’æŒ‡å®šã—ã¦ï¼Œä¸€ã¤ã®å€¤ã‚’å–å¾—ã™ã‚‹ï¼ all ã‚»ãƒƒã‚·ãƒ§ãƒ³ã®å…¨ã¦ã®å€¤ã‚’å–å¾—ã™ã‚‹ï¼ forget ã‚»ãƒƒã‚·ãƒ§ãƒ³ã®ã‚­ãƒ¼åã‚’æŒ‡å®šã—ã¦ï¼Œå€¤ã‚’å–å¾—ã™ã‚‹ï¼ã‚­ãƒ¼åã‚’é…åˆ—ã§æ¸¡ã—ã¦ï¼Œè¤‡æ•°å€‹ã‚’å‰Šé™¤ã™ã‚‹ã“ã¨ã‚‚å¯èƒ½ï¼ flush ã‚»ãƒƒã‚·ãƒ§ãƒ³ã®å…¨ã¦ã®å€¤ã‚’å–å¾—ã™ã‚‹ï¼ pull ã‚»ãƒƒã‚·ãƒ§ãƒ³ã®ã‚­ãƒ¼åã‚’æŒ‡å®šã—ã¦ï¼Œä¸€ã¤ã®å€¤ã‚’å–å¾—ã—ï¼Œå–å¾—å¾Œã«å‰Šé™¤ã™ã‚‹ï¼ has ã‚»ãƒƒã‚·ãƒ§ãƒ³ã®ã‚­ãƒ¼åã‚’æŒ‡å®šã—ã¦ï¼Œå€¤ãŒå­˜åœ¨ã—ã¦ã„ã‚‹ã‹ã‚’æ¤œè¨¼ã™ã‚‹ï¼nullã¯falseã¨ã—ã¦åˆ¤å®šã™ã‚‹ï¼ å‚è€ƒï¼šhttps://laravel.com/api/8.x/Illuminate/Session/Store.html ï¼Šå®Ÿè£…ä¾‹ï¼Š session()->get(\"foo\"); // allãƒ¡ã‚½ãƒƒãƒ‰ $data = $request->session()->all(); // forgetãƒ¡ã‚½ãƒƒãƒ‰ $request->session()->forget(\"foo\"); $request->session()->forget([\"foo\", \"bar\"]); // flush $request->session()->flush(); // pullãƒ¡ã‚½ãƒƒãƒ‰ $data = $request->session()->pull(\"foo\"); // hasãƒ¡ã‚½ãƒƒãƒ‰ if ($request->session()->has(\"foo\")) { } } } ãƒ»ã‚»ãƒƒã‚·ãƒ§ãƒ³ãƒ•ã‚¡ã‚¤ãƒ«ãŒStoreã‚¯ãƒ©ã‚¹ã«è‡³ã‚‹ã¾ã§ å…¨ã¦ã‚’è¿½ã†ã“ã¨ã¯é›£ã—ã„ã®ã§ï¼ŒStartSessionã‚¯ãƒ©ã‚¹ã®handleãƒ¡ã‚½ãƒƒãƒ‰ãŒå®Ÿè¡Œã•ã‚Œã‚‹ã¨ã“ã‚ã‹ã‚‰å§‹ã‚ã‚‹ã‚‚ã®ã¨ã™ã‚‹ï¼ã“ã“ã§ï¼ŒhandleStatefulRequestãƒ¡ã‚½ãƒƒãƒ‰ã®ä¸­ã®startSessionãƒ¡ã‚½ãƒƒãƒ‰ãŒå®Ÿè¡Œã•ã‚Œã‚‹ï¼ã“ã‚Œã«ã‚ˆã‚Šï¼ŒStoreã‚¯ãƒ©ã‚¹ã®startãƒ¡ã‚½ãƒƒãƒ‰ï¼ŒloadSessionãƒ¡ã‚½ãƒƒãƒ‰ï¼ŒreadFromHandlerãƒ¡ã‚½ãƒƒãƒ‰ãŒå®Ÿè¡Œã•ã‚Œï¼ŒSessionHandlerInterfaceã®å®Ÿè£…ã‚¯ãƒ©ã‚¹ã®readãƒ¡ã‚½ãƒƒãƒ‰ãŒå®Ÿè¡Œã•ã‚Œã‚‹ï¼readãƒ¡ã‚½ãƒƒãƒ‰ã¯ï¼Œstorage/framework/sessionsã«ã‚ã‚‹ã‚»ãƒƒã‚·ãƒ§ãƒ³ãƒ•ã‚¡ã‚¤ãƒ«ã«æ›¸ãè¾¼ã¾ã‚ŒãŸã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚’èª­ã¿å‡ºã—ï¼Œattributeãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã«æ ¼ç´ã™ã‚‹ï¼Sessionã‚¯ãƒ©ã‚¹ã®ãƒ¡ã‚½ãƒƒãƒ‰ã¯ï¼Œattributeãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã‚’ä½¿ç”¨ã—ã¦ï¼Œã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚’æ“ä½œã™ã‚‹ï¼æœ€çµ‚çš„ã«,handleStatefulRequestã§ã¯ï¼ŒsaveSessionãƒ¡ã‚½ãƒƒãƒ‰ã®ä¸­ã®saveãƒ¡ã‚½ãƒƒãƒ‰ãŒå®Ÿè¡Œã•ã‚Œï¼Œã‚»ãƒƒã‚·ãƒ§ãƒ³ãƒ•ã‚¡ã‚¤ãƒ«ã«æ–°ã—ã„å€¤ãŒæ›¸ãè¾¼ã¾ã‚Œã‚‹ï¼ å‚è€ƒï¼š https://laravel.com/api/8.x/Illuminate/Session/Middleware/StartSession.html#method_handle https://laravel.com/api/8.x/Illuminate/Session/Middleware/StartSession.html#method_handleStatefulRequest https://laravel.com/api/8.x/Illuminate/Session/Middleware/StartSession.html#method_startSession https://laravel.com/api/8.x/Illuminate/Session/Store.html#method_start https://laravel.com/api/8.x/Illuminate/Session/Store.html#method_loadSession https://laravel.com/api/8.x/Illuminate/Session/Store.html#method_readFromHandler https://www.php.net/manual/ja/sessionhandlerinterface.read.php https://laravel.com/api/8.x/Illuminate/Session/Middleware/StartSession.html#method_saveSession https://laravel.com/api/8.x/Illuminate/Session/Store.html#method_save https://www.php.net/manual/ja/sessionhandlerinterface.write.php 19. Views arisanã«ã‚ˆã‚‹æ“ä½œ ãƒ»Cacheã®å‰Šé™¤ # ãƒ“ãƒ¥ãƒ¼ã®Cacheã‚’å‰Šé™¤ $ php artisan view:clear # å…¨ã¦ã®Cacheã‚’å‰Šé™¤ $ php artisan optimize:clear ãƒ‡ãƒ¼ã‚¿ã®å‡ºåŠ› ãƒ»ãƒ‡ãƒ¼ã‚¿ã®å‡ºåŠ› Controllerã‚¯ãƒ©ã‚¹ã‹ã‚‰è¿”å´ã•ã‚ŒãŸãƒ‡ãƒ¼ã‚¿ã¯ï¼Œ{{ å¤‰æ•°å }}ã§å–å¾—ã§ãã‚‹ï¼` ï¼Šå®Ÿè£…ä¾‹ï¼Š Hello!! {{ $data }} ãƒ»ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®å‡ºåŠ› ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã§ã‚¨ãƒ©ãƒ¼ãŒèµ·ã“ã£ãŸå ´åˆï¼Œãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã§ã‚¨ãƒ©ãƒ¼ãŒã‚ã£ãŸå ´åˆï¼ŒHandlerã‚¯ãƒ©ã‚¹ã®invalidãƒ¡ã‚½ãƒƒãƒ‰ãŒã‚³ãƒ¼ãƒ«ã•ã‚Œï¼ŒMessageBagã‚¯ãƒ©ã‚¹ãŒViewã«æ¸¡ã•ã‚Œã‚‹ï¼MessageBagã‚¯ãƒ©ã‚¹ã¯ï¼ŒBladeä¸Šã§errorså¤‰æ•°ã«æ ¼ç´ã•ã‚Œã¦ãŠã‚Šï¼Œå„ãƒ¡ã‚½ãƒƒãƒ‰ã‚’ã‚³ãƒ¼ãƒ«ã—ã¦ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å‡ºåŠ›ã§ãã‚‹ï¼ å‚è€ƒï¼šhttps://laravel.com/api/8.x/Illuminate/Support/MessageBag.html ï¼Šå®Ÿè£…ä¾‹ï¼Š MessageBagã‚¯ãƒ©ã‚¹ã®allãƒ¡ã‚½ãƒƒãƒ‰ã§ï¼Œå…¨ã¦ã®ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å‡ºåŠ›ã™ã‚‹ï¼ ãƒã‚¹ãƒˆä½œæˆ @if ($errors->any()) @foreach ($errors->all() as $error) {{ $error }} @endforeach @endif @isset ($status) ç™»éŒ²ãŒå®Œäº†ã—ã¾ã—ãŸï¼ @endisset .errors { /* ä½•ã‚‰ã‹ã®ãƒ‡ã‚¶ã‚¤ãƒ³ */ } .complete { /* ä½•ã‚‰ã‹ã®ãƒ‡ã‚¶ã‚¤ãƒ³ */ } è¦ç´ ã®å…±é€šåŒ– ãƒ»@includeï¼ˆã‚µãƒ–ãƒ“ãƒ¥ãƒ¼ï¼‰ èª­ã¿è¾¼ã‚“ã ãƒ•ã‚¡ã‚¤ãƒ«å…¨ä½“ã‚’å‡ºåŠ›ã™ã‚‹ï¼èª­ã¿è¾¼ã‚€ãƒ•ã‚¡ã‚¤ãƒ«ã«å¯¾ã—ã¦ï¼Œå¤‰æ•°ã‚’æ¸¡ã™ã“ã¨ã‚‚ã§ãã‚‹ï¼@extentdsã¨ã®ä½¿ã„åˆ†ã‘ã¨ã—ã¦ï¼Œè¦ªå­é–¢ä¿‚ã®ãªã„ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã®é–“ã§ä½¿ç”¨ã™ã‚‹ã®ãŒã‚ˆã„ï¼ä¸¡è€…ã¯ï¼ŒPHPã§ã„ã†extendsï¼ˆã‚¯ãƒ©ã‚¹ãƒã‚§ãƒ¼ãƒ³ï¼‰ã¨requireï¼ˆå˜ãªã‚‹èª­ã¿è¾¼ã¿ï¼‰ã®é–¢ä¿‚ã«è¿‘ã„ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š @include(\"shared.errors\") è¦ç´ ã®ç¶™æ‰¿ ãƒ»@yieldï¼Œ@extendsï¼Œ@sectionï¼Œ@endsection å­ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã®ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°æ™‚ã«ï¼Œå­ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã§æ–°ã—ãå®šç¾©ã—ãŸHTMLã®è¦ç´ ã‚’ï¼Œè¦ªãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã®æŒ‡å®šã—ãŸå ´æ‰€ã«å‡ºåŠ›ã™ã‚‹ï¼è¦ªãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã«ã¦ï¼Œ@yield(\"foo\")ã‚’å®šç¾©ã™ã‚‹ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ ã‚¿ã‚¤ãƒˆãƒ« @yield(\"content\") ã“ã‚Œã‚’å­ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã§@extendsã§ç¶™æ‰¿ã™ã‚‹ã¨ï¼Œãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°æ™‚ã«ï¼Œå­ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã®@section(\"foo\")-@endsectionã§å®šç¾©ã—ãŸè¦ç´ ãŒï¼Œè¦ªãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã®@yieid()éƒ¨åˆ†ã«å‡ºåŠ›ã•ã‚Œã‚‹ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š @extends(\"layouts.parent\") @section(\"content\") å­ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã®ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°æ™‚ã«ï¼Œyieldã«å‡ºåŠ›ã•ã‚Œã‚‹è¦ç´  @endsection ã¡ãªã¿ã«ï¼Œå­ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã¯ï¼Œãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°æ™‚ã«ä»¥ä¸‹ã®ã‚ˆã†ã«å‡ºåŠ›ã•ã‚Œã‚‹ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ ã‚¿ã‚¤ãƒˆãƒ« å­ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã®ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°æ™‚ã«ï¼Œyieldã«å‡ºåŠ›ã•ã‚Œã‚‹è¦ç´  ãƒ»@sectionï¼Œ@showï¼Œ@extendsï¼Œ@parent å­ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã®ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°æ™‚ã«ï¼Œè¦ªãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã¨å­ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆãã‚Œãã‚Œã§æ–°ã—ãå®šç¾©ã—ãŸHTMLã®è¦ç´ ã‚’ï¼Œè¦ªãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã®æŒ‡å®šã—ãŸå ´æ‰€ã«å‡ºåŠ›ã™ã‚‹ï¼è¦ªãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã«ã¦ï¼Œ@section-@showã§è¦ç´ ã‚’å®šç¾©ã™ã‚‹ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ ã‚¿ã‚¤ãƒˆãƒ« @section(\"sidebar\") è¦ªãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã®ã‚µã‚¤ãƒ‰ãƒãƒ¼ã¨ãªã‚‹è¦ç´  @show å­ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã®@sectionã«ã¦ï¼Œ@parentã‚’ä½¿ç”¨ã™ã‚‹ï¼è¦ªãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã¨å­ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆãã‚Œãã‚Œã®è¦ç´ ãŒå‡ºåŠ›ã•ã‚Œã‚‹ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š @extends(\"layouts.app\") @section(\"sidebar\") @parent å­ãƒ†ãƒ³ãƒ¬ãƒ—ãƒ¼ãƒˆã®ã‚µã‚¤ãƒ‰ãƒãƒ¼ã«è¿½åŠ ã•ã‚Œã‚‹è¦ç´  @endsection ã¡ãªã¿ã«ï¼Œå­ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã¯ï¼Œãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°æ™‚ã«ä»¥ä¸‹ã®ã‚ˆã†ã«å‡ºåŠ›ã•ã‚Œã‚‹ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ ã‚¿ã‚¤ãƒˆãƒ« è¦ªãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã®ã‚µã‚¤ãƒ‰ãƒãƒ¼ã¨ãªã‚‹è¦ç´  å­ãƒ†ãƒ³ãƒ¬ãƒ—ãƒ¼ãƒˆã®ã‚µã‚¤ãƒ‰ãƒãƒ¼ã«è¿½åŠ ã•ã‚Œã‚‹è¦ç´  ãƒ»@stackï¼Œ@push å­ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã®ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°æ™‚ã«ï¼ŒCSSã¨JavaScriptã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’å‹•çš„ã«å‡ºåŠ›ã™ã‚‹å ´åˆã«ä½¿ç”¨ã™ã‚‹ï¼è¦ªãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã«ã¦ï¼Œ@stack(\"foo\")ã‚’å®šç¾©ã™ã‚‹ï¼ã“ã‚Œã‚’ç¶™æ‰¿ã—ãŸå­ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã®ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°æ™‚ã«ï¼Œ@push(\"foo\")-@endpushã§å®šç¾©ã—ãŸè¦ç´ ãŒï¼Œ@stack()éƒ¨åˆ†ã«å‡ºåŠ›ã•ã‚Œã‚‹ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š @stack(\"scripts\") @push(\"scripts\") @endpush Twigã¨ã®äº’æ› ãƒ»Bladeã§å®Ÿè£…ã—ãŸå ´åˆ ï¼Šå®Ÿè£…ä¾‹ï¼Š @yield(\"title\") @section(\"sidebar\") è¦ªãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã®ã‚µã‚¤ãƒ‰ãƒãƒ¼ã¨ãªã‚‹è¦ç´  @show @yield(\"content\") @extends(\"layouts.master\") @section(\"title\", \"å­ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã®ã‚¿ã‚¤ãƒˆãƒ«ã«ãªã‚‹è¦ç´ \") @section(\"sidebar\") @parent å­ãƒ†ãƒ³ãƒ¬ãƒ—ãƒ¼ãƒˆã®ã‚µã‚¤ãƒ‰ãƒãƒ¼ã«è¿½åŠ ã•ã‚Œã‚‹è¦ç´  @endsection @section(\"content\") å­ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã®ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã«ãªã‚‹è¦ç´  @endsection ãƒ»Twigã§å®Ÿè£…ã—ãŸå ´åˆ ï¼Šå®Ÿè£…ä¾‹ï¼Š {% block title %}{% endblock %} {% block sidebar %} è¦ªãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã®ã‚µã‚¤ãƒ‰ãƒãƒ¼ã¨ãªã‚‹è¦ç´  {% endblock %} {% block content %} {% endblock %} {% extends \"layouts.master\" %} {% block title %} å­ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã®ã‚¿ã‚¤ãƒˆãƒ«ã«ãªã‚‹è¦ç´  {% endblock %} {% block sidebar %} {{ parent() }} å­ãƒ†ãƒ³ãƒ¬ãƒ—ãƒ¼ãƒˆã®ã‚µã‚¤ãƒ‰ãƒãƒ¼ã«è¿½åŠ ã•ã‚Œã‚‹è¦ç´  {% endblock %} {% block content %} å­ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã®ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã«ãªã‚‹è¦ç´  {% endblock %} 20. èªè¨¼ ã‚¬ãƒ¼ãƒ‰ ãƒ»ã‚¬ãƒ¼ãƒ‰ã¨ã¯ ãƒ‰ãƒ©ã‚¤ãƒãƒ¼ã¨ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼ã‚’å®šç¾©ã™ã‚‹ï¼ å‚è€ƒï¼šhttps://readouble.com/laravel/8.x/ja/authentication.html#introduction ã‚¬ãƒ¼ãƒ‰ã®ç¨®é¡ èª¬æ˜ Webã‚¬ãƒ¼ãƒ‰ ã‚»ãƒƒã‚·ãƒ§ãƒ³IDã‚’ç”¨ã„ãŸFormèªè¨¼ã®ãŸã‚ã«ä½¿ç”¨ã™ã‚‹ï¼ APIã‚¬ãƒ¼ãƒ‰ Bearerèªè¨¼ï¼ŒAPIã‚­ãƒ¼èªè¨¼ï¼ŒOAuthèªè¨¼ï¼Œãªã©ã®ãŸã‚ã«ä½¿ç”¨ã™ã‚‹ï¼ãã‚Œãã‚Œã®èªè¨¼æ–¹æ³•ã«é•ã„ã«ã¤ã„ã¦ã¯ï¼Œä»¥ä¸‹ã®ãƒªãƒ³ã‚¯ã‚’å‚è€ƒã«ã›ã‚ˆï¼å‚è€ƒï¼šhttps://hiroki-it.github.io/tech-notebook-gitbook/public/software/software_application_collaboration_authentication_authorization.html ãƒ»ã‚«ã‚¹ã‚¿ãƒ ã‚¬ãƒ¼ãƒ‰ LaravelãŒæ¨™æº–ã§æŒãŸãªã„ãƒ‰ãƒ©ã‚¤ãƒãƒ¼ã¨ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼ã‚’æŒã¤ã‚¬ãƒ¼ãƒ‰ã‚’å®šç¾©ã™ã‚‹ï¼ å‚è€ƒï¼šhttps://readouble.com/laravel/8.x/ja/authentication.html#adding-custom-guards APIã‚¬ãƒ¼ãƒ‰ã®èªè¨¼ã§ä½¿ç”¨ã™ã‚‹ãƒˆãƒ¼ã‚¯ãƒ³ã‚’JWTã«å¤‰æ›´ã—ãŸã„æ™‚ã«ã¯ï¼Œä»¥ä¸‹ã®ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ãŒãŠã™ã™ã‚ï¼ å‚è€ƒï¼šhttps://github.com/tymondesigns/jwt-auth ãƒ‰ãƒ©ã‚¤ãƒãƒ¼ ãƒ»ãƒ‰ãƒ©ã‚¤ãƒãƒ¼ã¨ã¯ ãƒ‰ãƒ©ã‚¤ãƒãƒ¼ã®ç¨®é¡ èªè¨¼ã®ç¨®é¡ å®Ÿè£…ã‚¯ãƒ©ã‚¹ å‚™è€ƒ sessionãƒ‰ãƒ©ã‚¤ãƒãƒ¼ ã‚»ãƒƒã‚·ãƒ§ãƒ³IDã‚’ç”¨ã„ãŸFormèªè¨¼ SessionGuardã‚¯ãƒ©ã‚¹ https://laravel.com/api/8.x/Illuminate/Auth/SessionGuard.html tokenãƒ‰ãƒ©ã‚¤ãƒãƒ¼ Bearerèªè¨¼ï¼ŒAPIã‚­ãƒ¼èªè¨¼ï¼ŒOAuthèªè¨¼ TokenGuardã‚¯ãƒ©ã‚¹ https://laravel.com/api/8.x/Illuminate/Auth/TokenGuard.html ãƒ‰ãƒ©ã‚¤ãƒãƒ¼ã®ç¨®é¡ã«å¿œã˜ã¦ï¼ŒAuthManagerã‚¯ãƒ©ã‚¹ãŒGuardã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã®å®Ÿè£…ã‚¯ãƒ©ã‚¹ã‚’è¿”å´ã™ã‚‹ï¼auth.phpãƒ•ã‚¡ã‚¤ãƒ«ã«ã¦ï¼Œä¾‹ãˆã°tokenãƒ‰ãƒ©ã‚¤ãƒãƒ¼ã‚’é¸ã‚“ã å ´åˆã¯ï¼ŒTokenGuardã‚¯ãƒ©ã‚¹ãŒè¿”å´ã•ã‚Œã‚‹ï¼ å‚è€ƒï¼š https://teratail.com/questions/171582 https://laravel.com/api/8.x/Illuminate/Auth/AuthManager.html https://laravel.com/api/8.x/Illuminate/Contracts/Auth/Guard.html#method_user https://laravel.com/api/8.x/Illuminate/Auth/TokenGuard.html#method_user [ 'web' => [ // ã‚»ãƒƒã‚·ãƒ§ãƒ³ãƒ‰ãƒ©ã‚¤ãƒãƒ¼ 'driver' => 'session', 'provider' => 'users', ], 'api' => [ // ãƒˆãƒ¼ã‚¯ãƒ³ãƒ‰ãƒ©ã‚¤ãƒ¼ 'driver' => 'token', 'provider' => 'users', 'hash' => false, ], ], ]; ãƒ»ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã®ä¿è­· BeforeMiddlwareã§èªè¨¼æ¸ˆã¿ã®ãƒ¦ãƒ¼ã‚¶ã‹ã©ã†ã‹ã‚’æ¤œè¨¼ã—ï¼Œã‚‚ã—æœªèªè¨¼ã®å ´åˆã¯ï¼Œãƒ­ã‚°ã‚¤ãƒ³ãƒšãƒ¼ã‚¸ã«ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆã•ã›ã‚‹ï¼ã“ã‚Œã«ã‚ˆã‚Šï¼Œæœªèªè¨¼ã®ãƒ¦ãƒ¼ã‚¶ãŒã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ã‚’å®Ÿè¡Œã™ã‚‹ã“ã¨ã‚’é˜²ãï¼ å‚è€ƒï¼šhttps://qiita.com/yamotuki/items/b96978f8e379e285ecb6 ãƒ—ãƒ­ãƒã‚¤ãƒ€ ãƒ»ãƒ—ãƒ­ãƒã‚¤ãƒ€ã¨ã¯ èªè¨¼ãƒ‡ãƒ¼ã‚¿ã‚’DBã‹ã‚‰å–å¾—ã™ã‚‹ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’å®šç¾©ã™ã‚‹ï¼ å‚è€ƒï¼šhttps://readouble.com/laravel/8.x/ja/authentication.html#introduction ã‚»ãƒƒã‚·ãƒ§ãƒ³IDã‚’ç”¨ã„ãŸFormèªè¨¼ ãƒ»sessionãƒ‰ãƒ©ã‚¤ãƒãƒ¼ sessionãƒ‰ãƒ©ã‚¤ãƒãƒ¼ã‚’é¸æŠã™ã‚‹ï¼ ãƒ»å…¨ã¦ã®ãƒ¦ãƒ¼ã‚¶ãŒåŒä¸€æ¨©é™ã‚’æŒã¤å ´åˆ SessionGuardã‚¯ãƒ©ã‚¹ã®attemptãƒ¡ã‚½ãƒƒãƒ‰ã‚’ã‚³ãƒ¼ãƒ«ã—ã¦ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’ãƒãƒƒã‚·ãƒ¥åŒ–ã—ï¼ŒDBã®ãƒãƒƒã‚·ãƒ¥å€¤ã¨ç…§åˆã™ã‚‹ï¼èªè¨¼ãŒæˆåŠŸã™ã‚‹ã¨ï¼Œèªè¨¼ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚’é–‹å§‹ã™ã‚‹ï¼redirectãƒ¡ã‚½ãƒƒãƒ‰ã§ï¼Œèªè¨¼å¾Œã®åˆæœŸãƒšãƒ¼ã‚¸ã«ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆã™ã‚‹ï¼ å‚è€ƒï¼šhttps://readouble.com/laravel/8.x/ja/authentication.html#authenticating-users validated(); if (Auth::attempt($validated)) { // ã‚»ãƒƒã‚·ãƒ§ãƒ³IDå›ºå®šåŒ–ã‚’é˜²ããŸã‚ã«ï¼Œèªè¨¼å¾Œã«ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚’å†ä½œæˆã—ã¾ã™ï¼ $authenticationRequest->session()->regenerate(); // èªè¨¼å¾Œãƒšãƒ¼ã‚¸ã«ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆã—ã¾ã™ï¼ return redirect(RouteServiceProvider::HOME); } // æœªèªè¨¼ãƒšãƒ¼ã‚¸ã«ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆã—ã¾ã™ï¼ return redirect(RouteServiceProvider::UNAUTHORIZED); } } èªè¨¼å¾Œã®ãƒšãƒ¼ã‚¸ã¯RouteServiceProviderã‚¯ãƒ©ã‚¹ã§å®šç¾©ã—ã¦ãŠãï¼ ãƒ»ä¸€éƒ¨ã®ãƒ¦ãƒ¼ã‚¶ãŒç•°ãªã‚‹æ¨©é™ã‚’æŒã¤å ´åˆ ãƒ¦ãƒ¼ã‚¶ã”ã¨ã«èªè¨¼æ–¹æ³•ã‚’åŒºåˆ¥ã—ã¤ã¤ï¼ŒåŒä¸€ã®èªè¨¼å¾Œãƒšãƒ¼ã‚¸ã«ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆã•ã›ã‚‹ã“ã¨ãŒã§ãã‚‹ï¼ å‚è€ƒï¼šhttps://blog.capilano-fw.com/?p=8159 ï¼Šå®Ÿè£…ä¾‹ï¼Š æ¨©é™ã®ç•°ãªã‚‹ãƒ¦ãƒ¼ã‚¶ã«å¿œã˜ãŸã‚¬ãƒ¼ãƒ‰ï¼Œã¾ãŸã‚¬ãƒ¼ãƒ‰ã«ç´ä»˜ã‘ã‚‹Eloquentãƒ¢ãƒ‡ãƒ«ã‚’ãƒ—ãƒ­ãƒã‚¤ãƒ€ã‚’å®šç¾©ã—ã¦ãŠãï¼ [ 'web' => [ 'driver' => 'session', 'provider' => 'users', ], 'api' => [ 'driver' => 'token', 'provider' => 'users', 'hash' => false, ], // ä¸€èˆ¬ãƒ¦ãƒ¼ã‚¶ 'users' => [ 'driver' => 'session', 'provider' => 'users', ], // ç®¡ç†è€… 'administrators' => [ 'driver' => 'session', 'provider' => 'administrators', ], ], // ãƒ—ãƒ­ãƒã‚¤ãƒ€ 'providers' => [ // ä¸€èˆ¬ãƒ¦ãƒ¼ã‚¶ 'users' => [ 'driver' => 'eloquent', 'model' => App\\Models\\User::class, ], // ç®¡ç†è€… 'administrators' => [ 'driver' => 'eloquent', 'model' => App\\Models\\Administrator::class, ] ], ]; Authãƒ•ã‚¡ã‚µãƒ¼ãƒ‰ã®guardãƒ¡ã‚½ãƒƒãƒ‰ã‚’ä½¿ç”¨ã—ã¦ï¼Œã‚¬ãƒ¼ãƒ‰ã«å¿œã˜ãŸèªè¨¼ã‚’å®Ÿè¡Œã™ã‚‹ï¼ã“ã‚Œã«ã‚ˆã‚Šï¼ŒåŒä¸€ã®èªè¨¼å¾Œãƒšãƒ¼ã‚¸ã«ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆã—ãŸå¾Œã«ï¼Œãƒ¦ãƒ¼ã‚¶ã®Eloquentãƒ¢ãƒ‡ãƒ«ã«å¿œã˜ãŸå‡¦ç†ã‚’å®Ÿè¡Œã§ãã‚‹ã‚ˆã†ã«ãªã‚‹ï¼ validated(); // guardã«å¿œã˜ãŸèªè¨¼ã‚’è¡Œã„ã¾ã™ï¼ if (Auth::guard($authenticationRequest->guard)->attempt($validated)) { // ã‚»ãƒƒã‚·ãƒ§ãƒ³IDå›ºå®šåŒ–ã‚’é˜²ããŸã‚ã«ï¼Œèªè¨¼å¾Œã«ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚’å†ä½œæˆã—ã¾ã™ï¼ $authenticationRequest->session()->regenerate(); // ãƒ¦ãƒ¼ã‚¶ç”¨èªè¨¼å¾Œãƒšãƒ¼ã‚¸ã«ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆã—ã¾ã™ï¼ return redirect(RouteServiceProvider::HOME); } // æœªèªè¨¼ãƒšãƒ¼ã‚¸ã«ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆã—ã¾ã™ï¼ return redirect(RouteServiceProvider::UNAUTHORIZED); } } èªè¨¼æ¸ˆã¿ã‹ã©ã†ã‹ã®åˆ¤å®š ãƒ»userãƒ¡ã‚½ãƒƒãƒ‰ ç¾åœ¨ã®ã‚»ãƒƒã‚·ãƒ§ãƒ³ã«ãŠã‘ã‚‹ãƒ¦ãƒ¼ã‚¶ãŒèªè¨¼æ¸ˆã¿ã§ã‚ã‚Œã°ï¼Œãƒ¦ãƒ¼ã‚¶ã®Eloquentãƒ¢ãƒ‡ãƒ«ã‚’å–å¾—ã™ã‚‹ï¼ user(); ãƒ»checkãƒ¡ã‚½ãƒƒãƒ‰ ç¾åœ¨ã®ã‚»ãƒƒã‚·ãƒ§ãƒ³ã«ãŠã‘ã‚‹ãƒ¦ãƒ¼ã‚¶ãŒèªè¨¼æ¸ˆã¿ã§ã‚ã‚Œã°ï¼Œtrueã‚’è¿”å´ã™ã‚‹ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š èªè¨¼æ¸ˆã¿ã®ãƒ¦ãƒ¼ã‚¶ãŒãƒ–ãƒ©ã‚¦ã‚¶ã‚’é–‰ã˜ãŸã¨ã—ã¦ã‚‚ï¼Œã‚»ãƒƒã‚·ãƒ§ãƒ³ãŒç¶šã„ã¦ã„ã‚‹ï¼ˆä¾‹ï¼šãƒ­ã‚°ã‚¢ã‚¦ãƒˆã—ãªã„ï¼‰é™ã‚Šï¼Œèªè¨¼å‡¦ç†ã‚’æ”¹ã‚ã¦å®Ÿè¡Œã™ã‚‹å¿…è¦ã¯ãªã„ï¼ãã®ãŸã‚ã«ï¼ŒBeforeMiddlewareã‚’ä½¿ç”¨ã—ã¦ï¼Œèªè¨¼æ¸ˆã¿ã®ãƒ¦ãƒ¼ã‚¶ã‹ã‚‰ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’èªè¨¼æ¸ˆã¿ãƒšãƒ¼ã‚¸ã«ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆã•ã›ã‚‹ï¼ guard($guard)->check()) { // ãƒ¦ãƒ¼ã‚¶ãŒèªè¨¼æ¸ˆã¿ã®å ´åˆã¯ï¼Œèªè¨¼å¾Œã®ãƒšãƒ¼ã‚¸ã«ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆã—ã¾ã™ï¼ return redirect(RouteServiceProvider::HOME); } } return $next($request); } } 20-02. èªå¯ ã‚²ãƒ¼ãƒˆ ãƒ»ã‚²ãƒ¼ãƒˆã¨ã¯ Eloquentãƒ¢ãƒ‡ãƒ«ãƒ¬ãƒ™ãƒ«ã®èªå¯ã‚¹ã‚³ãƒ¼ãƒ—ã‚’å®šç¾©ã™ã‚‹ï¼æŒ‡å®šã—ãŸEloquentãƒ¢ãƒ‡ãƒ«ã«ç´ä»˜ãå…¨ã¦ã®DBãƒ¬ã‚³ãƒ¼ãƒ‰ã«ã‚¢ã‚¯ã‚»ã‚¹ã§ããªããªã‚‹ï¼ ãƒãƒªã‚·ãƒ¼ ãƒ»ãƒãƒªã‚·ãƒ¼ã¨ã¯ DBãƒ¬ã‚³ãƒ¼ãƒ‰ãƒ¬ãƒ™ãƒ«ã®èªå¯ã‚¹ã‚³ãƒ¼ãƒ—ã‚’å®šç¾©ã™ã‚‹ï¼Eloquentãƒ¢ãƒ‡ãƒ«ã«ç´ä»˜ãç‰¹å®šã®ãƒ¬ã‚³ãƒ¼ãƒ‰ã«ã‚¢ã‚¯ã‚»ã‚¹ã§ããªããªã‚‹ï¼Policyã‚¯ãƒ©ã‚¹ã®ãƒ¡ã‚½ãƒƒãƒ‰ã«ã‚ˆã£ã¦ï¼Œãƒªã‚¯ã‚¨ã‚¹ãƒˆä¸­ã®èªè¨¼æ¸ˆã¿ãƒ¦ãƒ¼ã‚¶ãŒè‡ªå‹•çš„ã«ã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³ã•ã‚Œã‚‹ï¼Eloquentãƒ¢ãƒ‡ãƒ«ã¨Policyã‚¯ãƒ©ã‚¹ã®ç´ä»˜ã‘ã¯AuthServiceProviderã‚¯ãƒ©ã‚¹ã§å®šç¾©ã™ã‚‹ å‚è€ƒï¼šhttps://qiita.com/mpyw/items/8c5413b99b8e299f7002#%E7%AC%AC1%E5%BC%95%E6%95%B0%E3%81%AF%E5%BF%85%E3%81%9A-authenticatable-%E3%81%AB%E3%81%AA%E3%82%8B%E4%BD%86%E3%81%97 id; // èªè¨¼ä¸­ã®ãƒ¦ãƒ¼ã‚¶ } /** * @param User $user * @param Foo $foo * @param int $barId * @return bool */ public function show(User $user, Foo $foo, int $barId): bool { $id = $foo->id; // ãƒ«ãƒ¼ã‚¿ãƒ¼ã¾ãŸã¯ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ã‹ã‚‰æ¸¡ã•ã‚ŒãŸã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ } /** * @param User $user * @param Foo $foo * @param int $barId * @return bool */ public function update(User $user, Foo $foo, int $barId): bool { // } /** * @param User $user * @param Foo $foo * @param int $barId * @return bool */ public function delete(User $user, Foo $foo, int $barId): bool { // } } FooPolicy::class, ]; /** * @return void */ public function boot() { $this->registerPolicies(); } } ãƒ»AuthorizeMiddlewareã«ã‚ˆã‚‹èªå¯ ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°æ™‚ã«DBãƒ¬ã‚³ãƒ¼ãƒ‰ãƒ¬ãƒ™ãƒ«ã®èªå¯ã‚¹ã‚³ãƒ¼ãƒ—ã‚’å®šç¾©ã™ã‚‹ï¼AuthorizeMiddlewareã®ã‚¨ã‚¤ãƒªã‚¢ã‚¹åã¯æ¨™æº–ã§canã§ã‚ã‚Šï¼ŒKernelã‚¯ãƒ©ã‚¹ã«å®šç¾©ã•ã‚Œã¦ã„ã‚‹ï¼ç¬¬ä¸€å¼•æ•°ã«Policyã‚¯ãƒ©ã‚¹ã®ãƒ¡ã‚½ãƒƒãƒ‰åï¼Œç¬¬äºŒå¼•æ•°ã«é–¢é€£ã™ã‚‹Eloquentãƒ¢ãƒ‡ãƒ«ã®ã‚¯ãƒ©ã‚¹ã®åå‰ç©ºé–“ã¾ãŸã¯ãã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’æ¸¡ã™ï¼åå‰ç©ºé–“ã‚’æ¸¡ã™å ´åˆã¯ï¼Œã“ã‚Œã‚’ãƒãƒ¼ãƒ‰ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã›ãšï¼Œé–¢æ•°ã§åå‰ç©ºé–“ã‚’å–å¾—ã—ã¦æ–‡å­—åˆ—ã¨çµåˆã™ã‚‹ã‚ˆã†ã«ã™ã‚‹ï¼ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’æ¸¡ã™å ´åˆã¯ï¼Œæš—é»™ã®ãƒ¢ãƒ‡ãƒ«çµåˆã‚’ä½¿ç”¨ã™ã‚‹å¿…è¦ãŒã‚ã‚‹ï¼èªå¯ã«å¤±æ•—ã—ãŸå ´åˆï¼Œ403ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã®ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’è¿”ä¿¡ã™ã‚‹ï¼ å‚è€ƒï¼šhttps://readouble.com/laravel/8.x/ja/authorization.html#via-middleware ï¼Šå®Ÿè£…ä¾‹ï¼Š ['auth:web']], function () { Route::group(['prefix' => 'foos'], function () { Route::get('/{id}', [FooController::class, 'showFoo'])->middleware('can:show,'. Foo::class); Route::get('/', [FooController::class, 'indexFoo']); Route::post('/', [FooController::class, 'createFoo']); Route::put('/{id}', [FooController::class, 'updateFoo'])->middleware('can:update,'. Foo::class); Route::delete('/{id}', [FooController::class, 'deleteFoo'])->middleware('can:delete,'. Foo::class); }); }); ãƒ»authorizationãƒ¡ã‚½ãƒƒãƒ‰ã«ã‚ˆã‚‹èªå¯ ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©å®Ÿè¡Œæ™‚ã«DBãƒ¬ã‚³ãƒ¼ãƒ‰ãƒ¬ãƒ™ãƒ«ã®èªå¯ã‚¹ã‚³ãƒ¼ãƒ—ã‚’å®šç¾©ã™ã‚‹ï¼åŸºåº•ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ã‚’ç¶™æ‰¿ã—ãŸã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ã§ã¯authorizationãƒ¡ã‚½ãƒƒãƒ‰ã‚’ã‚³ãƒ¼ãƒ«ã§ãï¼Œç¾åœ¨èªè¨¼ã•ã‚Œã¦ã„ã‚‹ãƒ¦ãƒ¼ã‚¶ã®DBã‚¢ã‚¯ã‚»ã‚¹ãŒèªå¯ã‚¹ã‚³ãƒ¼ãƒ—ã®ç¯„å›²å†…ã‹ã©ã†ã‹ã‚’æ¤œè¨¼ã™ã‚‹ï¼ç¬¬äºŒå¼•æ•°ã«ï¼Œãƒãƒªã‚·ãƒ¼ã«ç´ä»˜ãã‚¯ãƒ©ã‚¹åå‰ç©ºé–“ã‚ã‚‹ã„ã¯ãã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’æ¸¡ã™ï¼èªå¯ã«å¤±æ•—ã—ãŸå ´åˆã«AuthorizationExceptionã‚’æŠ•ã’ã‚‹ãŸã‚ï¼Œãã®å¾Œã¯è‡ªå‰ã§403ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã®ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã™ã‚‹ã‚ˆã†ã«ã™ã‚‹ï¼ å‚è€ƒï¼š https://readouble.com/laravel/8.x/ja/authorization.html#via-controller-helpers https://readouble.com/laravel/8.x/ja/authorization.html#supplying-additional-context ï¼Šå®Ÿè£…ä¾‹ï¼Š ãƒ¦ãƒ¼ã‚¶ãŒè©²å½“IDã®Fooãƒ¢ãƒ‡ãƒ«ã‚’æ›´æ–°ã™ã‚‹æ¨©é™ãŒã‚ã‚‹ã‹ã©ã†ã‹ã‚’æ¤œè¨¼ã™ã‚‹ï¼ authorize('update', [$foo->find($id), $request->barId]); // Eloquentãƒ¢ãƒ‡ãƒ«ãŒä¸è¦ãªæ¤œè¨¼ã§ã‚ã‚Œã°åå‰ç©ºé–“ // $this->authorize('create', Foo::class); $foo->fill($request->all())->save(); } catch (Throwable $e) { // è‡ªå‰ã§403ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã®ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’è¿”ä¿¡ã™ã‚‹ï¼ return response()->json(['error' => $e->getMessage()], 403); } // ç¶šãã®å‡¦ç† } } ãƒ»canãƒ¡ã‚½ãƒƒãƒ‰ã«ã‚ˆã‚‹èªå¯ ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©å®Ÿè¡Œæ™‚ã«DBãƒ¬ã‚³ãƒ¼ãƒ‰ãƒ¬ãƒ™ãƒ«ã®èªå¯ã‚¹ã‚³ãƒ¼ãƒ—ã‚’å®šç¾©ã™ã‚‹ï¼ç¾åœ¨èªè¨¼ã•ã‚Œã¦ã„ã‚‹ãƒ¦ãƒ¼ã‚¶ã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‹ã‚‰canãƒ¡ã‚½ãƒƒãƒ‰ã‚’ã‚³ãƒ¼ãƒ«ã§ãã‚‹ï¼ç¬¬äºŒå¼•æ•°ã¨ã—ã¦ï¼Œãƒãƒªã‚·ãƒ¼ã«ç´ä»˜ãã‚¯ãƒ©ã‚¹åå‰ç©ºé–“ã¾ãŸã¯ãã®ã‚¯ãƒ©ã‚¹ã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’æ¸¡ã™ï¼DBã‚¢ã‚¯ã‚»ã‚¹ãŒï¼Œãã®ãƒ¦ãƒ¼ã‚¶ã®èªå¯ã‚¹ã‚³ãƒ¼ãƒ—ã®ç¯„å›²å†…ã‹ã©ã†ã‹ã‚’æ¤œè¨¼ã™ã‚‹ï¼èªå¯ã«å¤±æ•—ã—ãŸå ´åˆã«falseã‚’è¿”å´ã™ã‚‹ãŸã‚ï¼Œãã®å¾Œã¯è‡ªå‰ã§403ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã®ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã™ã‚‹ã‚ˆã†ã«ã™ã‚‹ï¼ å‚è€ƒï¼š https://readouble.com/laravel/8.x/ja/authorization.html#via-the-user-model https://readouble.com/laravel/8.x/ja/authorization.html#supplying-additional-context ï¼Šå®Ÿè£…ä¾‹ï¼Š ãƒ¦ãƒ¼ã‚¶ãŒFooãƒ¢ãƒ‡ãƒ«ã‚’ä½œæˆã™ã‚‹æ¨©é™ãŒã‚ã‚‹ã‹ã©ã†ã‹ã‚’æ¤œè¨¼ã™ã‚‹ï¼ user()->can('update', [$foo->find($id), $request->barId])) { // è‡ªå‰ã§403ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã®ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’è¿”ä¿¡ã™ã‚‹ï¼ return response()->json(['error' => 'èªå¯ã‚¨ãƒ©ãƒ¼'], 403); } // Eloquentãƒ¢ãƒ‡ãƒ«ãŒä¸è¦ãªæ¤œè¨¼ã§ã‚ã‚Œã°åå‰ç©ºé–“ // if (!auth()->user()->can('update', Foo::class) {} $foo->fill($request->all())->save(); } } 20-03. Passportãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ Passportãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã¨ã¯ Ouathèªè¨¼ã‚’å®Ÿè£…ã§ãã‚‹ï¼OAuthèªè¨¼ã«ã¤ã„ã¦ã¯ï¼Œä»¥ä¸‹ã®ãƒªãƒ³ã‚¯ã‚’å‚è€ƒã«ã›ã‚ˆï¼ å‚è€ƒï¼šhttps://hiroki-it.github.io/tech-notebook-gitbook/public/software/software_application_collaboration_authentication_authorization.html å°å…¥æ–¹æ³• ãƒ»ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ« composerã§ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹å¿…è¦ãŒã‚ã‚‹ï¼ å‚è€ƒï¼šhttps://readouble.com/laravel/8.x/ja/passport.html $ composer require laravel/passport ãƒ»OAuthèªè¨¼ã®ãƒˆãƒ¼ã‚¯ãƒ³ç®¡ç†ãƒ†ãƒ¼ãƒ–ãƒ«ã‚’ç”Ÿæˆ äº‹å‰ã«ï¼ŒPassportã®ç®¡ç†ãƒ†ãƒ¼ãƒ–ãƒ«ã‚’ç”Ÿæˆã™ã‚‹å¿…è¦ãŒã‚ã‚‹ãŸã‚ï¼Œãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚’å®Ÿè¡Œã™ã‚‹ï¼ $ php artisan migrate Migrating: 2014_10_12_000000_create_users_table Migrated: 2014_10_12_000000_create_users_table (0.02 seconds) Migrating: 2014_10_12_100000_create_password_resets_table Migrated: 2014_10_12_100000_create_password_resets_table (0 seconds) Migrating: 2016_06_01_000001_create_oauth_auth_codes_table Migrated: 2016_06_01_000001_create_oauth_auth_codes_table (0 seconds) Migrating: 2016_06_01_000002_create_oauth_access_tokens_table Migrated: 2016_06_01_000002_create_oauth_access_tokens_table (0 seconds) Migrating: 2016_06_01_000003_create_oauth_refresh_tokens_table Migrated: 2016_06_01_000003_create_oauth_refresh_tokens_table (0 seconds) Migrating: 2016_06_01_000004_create_oauth_clients_table Migrated: 2016_06_01_000004_create_oauth_clients_table (0 seconds) Migrating: 2016_06_01_000005_create_oauth_personal_access_clients_table Migrated: 2016_06_01_000005_create_oauth_personal_access_clients_table ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å¾Œï¼Œä»¥ä¸‹ã®ãƒ†ãƒ¼ãƒ–ãƒ«ãŒä½œæˆã•ã‚Œã‚‹ï¼ ãƒ†ãƒ¼ãƒ–ãƒ«å èª¬æ˜ oauth_access_tokens å…¨ã¦ã®ã‚¢ã‚¯ã‚»ã‚¹ãƒˆãƒ¼ã‚¯ãƒ³ã‚’ç®¡ç†ã™ã‚‹ï¼ oauth_auth_codes Authorization Code Grantã‚¿ã‚¤ãƒ—ã®æƒ…å ±ã‚’ç®¡ç†ã™ã‚‹ï¼ oauth_clients Passportã§ä½¿ç”¨ã—ã¦ã„ã‚‹ä»˜ä¸ã‚¿ã‚¤ãƒ—ã‚’ç®¡ç†ã™ã‚‹ï¼ oauth_personal_access_clients Personal Access Tokenã‚¿ã‚¤ãƒ—ã®æƒ…å ±ã‚’ç®¡ç†ã™ã‚‹ï¼ oauth_refresh_tokens ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥ãƒˆãƒ¼ã‚¯ãƒ³ã‚’ç®¡ç†ã™ã‚‹ï¼ã‚¢ã‚¯ã‚»ã‚¹ãƒˆãƒ¼ã‚¯ãƒ³ã®æœ‰åŠ¹æœŸé™ãŒåˆ‡ã‚ŒãŸæ™‚ã«ï¼Œå†ç”Ÿæˆã‚’ãƒªã‚¯ã‚¨ã‚¹ãƒˆã™ã‚‹ãŸã‚ã«ä½¿ç”¨ã™ã‚‹ï¼å‚è€ƒï¼šhttps://auth0.com/blog/jp-refresh-tokens-what-are-they-and-when-to-use-them/ ãƒ»ãƒˆãƒ¼ã‚¯ãƒ³ã‚’ç”Ÿæˆ ã‚³ãƒãƒ³ãƒ‰å®Ÿè¡Œã«ã‚ˆã‚Šï¼Œ/storage/oauthã‚­ãƒ¼ï¼ŒPersonal Access Clientï¼ŒPassword Grant Clientã‚’ç”Ÿæˆã™ã‚‹ï¼ $ php artisan passport:install Personal access client created successfully. Client ID: 3 Client secret: xxxxxxxxxxxx Password grant client created successfully. Client ID: 4 Client secret: xxxxxxxxxxxx ãŸã ã—ï¼Œç”Ÿæˆã‚³ãƒãƒ³ãƒ‰ã‚’å€‹åˆ¥ã«å®Ÿè¡Œã—ã¦ã‚‚ã‚ˆã„ï¼ # æš—å·ã‚­ãƒ¼ã‚’ç”Ÿæˆ $ php artisan passport:keys # ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚’ç”Ÿæˆ ## Persinal Access Tokenã®å ´åˆ $ php artisan passport:client --personal ## Password Grant Tokenã®å ´åˆ $ php artisan passport:client --password å®Ÿè£…å¯èƒ½ãªOAuthèªè¨¼ã®ç¨®é¡ ãƒ»OAuthèªè¨¼ OAuthèªè¨¼ã«é–¢ã—ã¦ï¼Œä»¥ä¸‹ã®ãƒˆãƒ¼ã‚¯ãƒ³ä»˜ä¸ã‚¿ã‚¤ãƒ—ã‚’å®Ÿè£…ã§ãã‚‹ï¼ ä»˜ä¸ã‚¿ã‚¤ãƒ— èª¬æ˜ Authorization Code Grant å‚è€ƒï¼šhttps://hiroki-it.github.io/tech-notebook-gitbook/public/software/software_application_collaboration_authentication_authorization.html Client Credentials Grant å‚è€ƒï¼šhttps://hiroki-it.github.io/tech-notebook-gitbook/public/software/software_application_collaboration_authentication_authorization.html Implicit Grant å‚è€ƒï¼šhttps://hiroki-it.github.io/tech-notebook-gitbook/public/software/software_application_collaboration_authentication_authorization.html Password Grant å‚è€ƒï¼šhttps://hiroki-it.github.io/tech-notebook-gitbook/public/software/software_application_collaboration_authentication_authorization.html ãƒ»ãã®ä»– èªè¨¼æ–¹æ³• èª¬æ˜ Personal Access Token å‚è€ƒï¼šhttps://hiroki-it.github.io/tech-notebook-gitbook/public/software/software_application_collaboration_authentication_authorization.html Password Grant ãƒ»ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰å´ã®å®Ÿè£… guardsã‚­ãƒ¼ã«ã¦ï¼Œèªè¨¼æ–¹å¼ã‚’è¨­å®šã™ã‚‹ï¼ã“ã“ã§ã¯ï¼Œapiã‚’è¨­å®šã™ã‚‹ï¼èªè¨¼æ–¹æ³•ã«ã¤ã„ã¦ã¯ï¼Œèªè¨¼ã¨èªå¯ã®ãƒãƒ¼ãƒˆã‚’å‚ç…§ã›ã‚ˆï¼ return [ // ï½ ä¸­ç•¥ ï½ \"defaults\" => [ \"guard\" => \"api\", \"passwords\" => \"users\", ], // ï½ ä¸­ç•¥ ï½ ]; OAuthèªè¨¼ï¼ˆèªè¨¼ãƒ•ã‚§ãƒ¼ã‚ºï¼‹èªå¯ãƒ•ã‚§ãƒ¼ã‚ºï¼‰ã‚’è¡Œã†ãŸã‚ã«ï¼Œauth.phpãƒ•ã‚¡ã‚¤ãƒ«ã§ï¼Œdriverã‚­ãƒ¼ã«passportãƒ‰ãƒ©ã‚¤ãƒã‚’è¨­å®šã™ã‚‹ï¼ã¾ãŸï¼Œproviderã‚­ãƒ¼ã§ï¼Œusersã‚’è¨­å®šã™ã‚‹ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š return [ // ï½ ä¸­ç•¥ ï½ \"guards\" => [ \"web\" => [ \"driver\" => \"session\", \"provider\" => \"users\", ], \"api\" => [ \"driver\" => \"passport\", \"provider\" => \"users\", \"hash\" => false, ], ], // ï½ ä¸­ç•¥ ï½ ]; auth.phpãƒ•ã‚¡ã‚¤ãƒ«ã«ã¦ï¼Œdriverã‚­ãƒ¼ã«eloquentãƒ‰ãƒ©ã‚¤ãƒã‚’è¨­å®šã™ã‚‹ï¼ã¾ãŸï¼Œmodelã‚­ãƒ¼ã§èªè¨¼æƒ…å ±ãƒ†ãƒ¼ãƒ–ãƒ«ã«å¯¾å¿œã™ã‚‹Eloquentã®Eloquentãƒ¢ãƒ‡ãƒ«ã‚’è¨­å®šã™ã‚‹ï¼ã“ã“ã§ã¯ï¼ŒUserã‚¯ãƒ©ã‚¹ã‚’è¨­å®šã™ã‚‹ï¼Laravelã§ã¯ï¼ŒEloquentãƒ¢ãƒ‡ãƒ«ã«å¯¾å¿œã™ã‚‹ãƒ†ãƒ¼ãƒ–ãƒ«åã¯ã‚¯ãƒ©ã‚¹åã®è¤‡æ•°å½¢ã«ãªã‚‹ãŸã‚ï¼Œusersãƒ†ãƒ¼ãƒ–ãƒ«ã«èªè¨¼æƒ…å ±ãŒæ ¼ç´ã•ã‚Œã‚‹ã“ã¨ã«ãªã‚‹ï¼ã‚‚ã—DBãƒ•ã‚¡ã‚µãƒ¼ãƒ‰ã®ã‚¯ã‚¨ãƒªãƒ“ãƒ«ãƒ€ã‚’ä½¿ç”¨ã—ãŸã„å ´åˆã¯ï¼Œdatabaseãƒ‰ãƒ©ã‚¤ãƒã‚’æŒ‡å®šã™ã‚‹ï¼ return [ // ï½ ä¸­ç•¥ ï½ \"providers\" => [ \"users\" => [ \"driver\" => \"eloquent\", // Eloquentãƒ¢ãƒ‡ãƒ«ã¯è‡ªç”±ã«æŒ‡å®šã§ãã‚‹ï¼ \"model\" => App\\Models\\User::class, ], // \"users\" => [ // \"driver\" => \"database\", // \"table\" => \"users\", // ], ], // ï½ ä¸­ç•¥ ï½ ]; Userã¸ã®ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°æ™‚ã«ï¼Œmiddlewareãƒ¡ã‚½ãƒƒãƒ‰ã«ã‚ˆã‚‹èªè¨¼ã‚¬ãƒ¼ãƒ‰ã‚’è¡Œã†ï¼ã“ã‚Œã«ã‚ˆã‚Šï¼ŒOAuthèªè¨¼ã«æˆåŠŸã—ãŸãƒ¦ãƒ¼ã‚¶ã®ã¿ãŒãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã‚’è¡Œãˆã‚‹ã‚ˆã†ã«ãªã‚‹ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š Route::get(\"user\", \"UserController@index\")->middleware(\"auth:api\"); èªè¨¼ã‚¬ãƒ¼ãƒ‰ã‚’è¡Œã£ãŸEloquentãƒ¢ãƒ‡ãƒ«ã«å¯¾ã—ã¦ï¼ŒHasAPITokenï¼ŒNotifiableã®Traitã‚’ã‚³ãƒ¼ãƒ«ã™ã‚‹ã‚ˆã†ã«ã™ã‚‹ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š Passportã®routesãƒ¡ã‚½ãƒƒãƒ‰ã‚’ã‚³ãƒ¼ãƒ«ã™ã‚‹ã‚ˆã†ã«ã™ã‚‹ï¼ã“ã‚Œã«ã‚ˆã‚Šï¼ŒPassportã®èªè¨¼ãƒ•ã‚§ãƒ¼ã‚ºã«é–¢ã‚ã‚‹å…¨ã¦ã®ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ï¼ˆ/oauth/xxxï¼‰ãŒæœ‰åŠ¹ã«ãªã‚‹ï¼ã¾ãŸï¼Œã‚¢ã‚¯ã‚»ã‚¹ãƒˆãƒ¼ã‚¯ãƒ³ã‚’ç™ºè¡Œã§ãã‚‹ã‚ˆã«ãªã‚‹ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š registerPolicies(); Passport::routes(); } } æš—å·ã‚­ãƒ¼ã¨ãƒ¦ãƒ¼ã‚¶ã‚’ä½œæˆã™ã‚‹ï¼ $ php artisan passport:keys $ php artisan passport:client --password ãƒ»ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚¢ãƒ—ãƒªå´ã®å®Ÿè£… ã€èªè¨¼ã€ã®ãŸã‚ã«ï¼Œã‚¢ã‚¯ã‚»ã‚¹ãƒˆãƒ¼ã‚¯ãƒ³ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é€ä¿¡ã™ã‚‹ï¼ãƒ¦ãƒ¼ã‚¶å´ã®ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã¯ï¼Œ/oauth/authorizeã¸ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é€ä¿¡ã™ã‚‹å¿…è¦ãŒã‚ã‚‹ï¼ã“ã“ã§ã¯ï¼Œãƒªã‚¯ã‚¨ã‚¹ãƒˆGuzzleãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’ä½¿ç”¨ã—ã¦ï¼Œãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é€ä¿¡ã™ã‚‹ã‚‚ã®ã¨ã™ã‚‹ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š post(\"http://your-app.com/oauth/token\", [ \"form_params\" => [ \"grant_type\" => \"password\", \"client_id\" => \"client-id\", \"client_secret\" => \"client-secret\", \"username\" => \"taylor@laravel.com\", \"password\" => \"my-password\", \"scope\" => \"\", ], ]); ã‚¢ã‚¯ã‚»ã‚¹ãƒˆãƒ¼ã‚¯ãƒ³ã‚’å«ã‚€JSONå‹ãƒ‡ãƒ¼ã‚¿ã‚’å—ä¿¡ã™ã‚‹ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š { \"token_type\":\"Bearer\", \"expires_in\":31536000, \"access_token\":\"xxxxx\" } ãƒ˜ãƒƒãƒ€ãƒ¼ã«ã‚¢ã‚¯ã‚»ã‚¹ãƒˆãƒ¼ã‚¯ãƒ³ã‚’å«ã‚ã¦ï¼Œèªè¨¼ã‚¬ãƒ¼ãƒ‰ã®è¨­å®šã•ã‚ŒãŸãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰å´ã®ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã«å¯¾ã—ã¦ï¼Œãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é€ä¿¡ã™ã‚‹ï¼ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãƒœãƒ‡ã‚£ã‹ã‚‰ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ã™ã‚‹ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š request(\"GET\", \"/api/user\", [ \"headers\" => [ \"Accept\" => \"application/json\", \"Authorization\" => \"Bearer xxxxx\", ] ]); return (string)$response->getBody(); ãƒ»APIã‚¬ãƒ¼ãƒ‰ç”¨ã®ãƒ†ãƒ¼ãƒ–ãƒ« ï¼Šå®Ÿè£…ä¾‹ï¼Š bigIncrements(\"user_id\")->comment(\"ãƒ¦ãƒ¼ã‚¶ID\"); $table->string(\"name\")->comment(\"ãƒ¦ãƒ¼ã‚¶å\"); $table->string(\"api_token\")->unique()->comment(\"APIãƒˆãƒ¼ã‚¯ãƒ³\"); // MigrationMacroServiceProviderã®ãƒ¡ã‚½ãƒƒãƒ‰ã‚’ä½¿ç”¨ã™ã‚‹ï¼ $table->systemColumns(); // deleted_atã‚«ãƒ©ãƒ ã‚’è¿½åŠ ã™ã‚‹ï¼ $table->softDeletes(); }); } /** * @return void */ public function down() { Schema::drop(\"users\"); } } Personal Access Token ãƒ»ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰å´ã®å®Ÿè£… æš—å·ã‚­ãƒ¼ã¨ãƒ¦ãƒ¼ã‚¶ã‚’ä½œæˆã™ã‚‹ï¼ $ php artisan passport:keys $ php artisan passport:client --personal ä½œæˆã—ãŸãƒ¦ãƒ¼ã‚¶ã«ï¼Œã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆIDã‚’ä»˜ä¸ã™ã‚‹ï¼ /** * å…¨èªè¨¼ï¼èªå¯ã®ç™»éŒ² * * @return void */ public function boot() { $this->registerPolicies(); Passport::routes(); Passport::personalAccessClientId(\"client-id\"); } ãƒ¦ãƒ¼ã‚¶ã‹ã‚‰ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆæ™‚ï¼Œã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆIDã‚’å…ƒã«ã€èªè¨¼ã€ã‚’è¡Œã„ï¼Œã‚¢ã‚¯ã‚»ã‚¹ãƒˆãƒ¼ã‚¯ãƒ³ã‚’ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã™ã‚‹ï¼ createToken(\"Token Name\")->accessToken; // ã‚¹ã‚³ãƒ¼ãƒ—ä»˜ãã®ãƒˆãƒ¼ã‚¯ãƒ³ã‚’ä½œæˆã™ã‚‹ $token = $user->createToken(\"My Token\", [\"place-orders\"])->accessToken; 20-04. Sanctumãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ Sanctumãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã¨ã¯ APIã‚­ãƒ¼èªè¨¼ã¨ã‚»ãƒƒã‚·ãƒ§ãƒ³IDã‚’ç”¨ã„ãŸFormèªè¨¼æ©Ÿèƒ½ã®èªè¨¼å‡¦ç†ã®ã¿ã‚’æä¾›ã™ã‚‹ï¼ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã¨DBã‚¢ã‚¯ã‚»ã‚¹ã«é–¢ã™ã‚‹å‡¦ç†ã¯æä¾›ã—ãªã„ï¼ å‚è€ƒï¼šhttps://readouble.com/laravel/8.x/ja/sanctum.html APIã‚­ãƒ¼èªè¨¼ã¨ã‚»ãƒƒã‚·ãƒ§ãƒ³IDã‚’ç”¨ã„ãŸFormèªè¨¼ã«ã¤ã„ã¦ã¯ï¼Œä»¥ä¸‹ã®ãƒªãƒ³ã‚¯ã‚’å‚è€ƒã«ã›ã‚ˆï¼ å‚è€ƒï¼šhttps://hiroki-it.github.io/tech-notebook-gitbook/public/software/software_application_collaboration_authentication_authorization.html å°å…¥æ–¹æ³• ãƒ»ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ« $ composer require laravel/sanctum APIãƒˆãƒ¼ã‚¯ãƒ³èªè¨¼ ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ï¼ˆå¤–éƒ¨ã®ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’å«ã‚€ï¼‰ã¯ä»»æ„ã¨ã—ï¼ŒAPIã®ã¿ã‚’å®Ÿè£…ã™ã‚‹å ´åˆã«ï¼Œä½¿ç”¨ãŒé©ã—ã¦ã„ã‚‹ï¼ å‚è€ƒï¼š https://readouble.com/laravel/8.x/ja/sanctum.html#api-token-authentication https://stackoverflow.com/questions/65550823/laravel-sanctum-api-token-security https://laracasts.com/discuss/channels/laravel/why-is-it-bad-to-use-sanctum-api-tokens-to-authenticate-your-own-first-party-spa SPAèªè¨¼ ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã«ãƒ•ã‚¡ãƒ¼ã‚¹ãƒˆãƒ‘ãƒ¼ãƒ†ã‚£ã®SPAï¼ˆè‡ªç¤¾ã®SPAï¼‰ã‚’ä½¿ç”¨ã—ï¼Œãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã®APIã‚’å®Ÿè£…ã™ã‚‹å ´åˆã«ï¼Œä½¿ç”¨ãŒé©ã—ã¦ã„ã‚‹ï¼ å‚è€ƒï¼š https://readouble.com/laravel/8.x/ja/sanctum.html#spa-authentication https://stackoverflow.com/questions/65550823/laravel-sanctum-api-token-security https://laracasts.com/discuss/channels/laravel/why-is-it-bad-to-use-sanctum-api-tokens-to-authenticate-your-own-first-party-spa 20-05. Fortifyãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ Fortifyãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã¨ã¯ LaravelãŒæŒã¤å…¨ã¦ã®èªè¨¼æ©Ÿèƒ½ã®ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰å‡¦ç†ã‚’æä¾›ã™ã‚‹ï¼ å‚è€ƒï¼š https://readouble.com/laravel/8.x/ja/fortify.html https://readouble.com/laravel/8.x/ja/fortify.html#laravel-fortify-and-laravel-sanctum 20-06. Breezeãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ Breezeãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã¨ã¯ LaravelãŒæŒã¤å…¨ã¦ã®èªè¨¼æ©Ÿèƒ½ã®ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ï¼ˆèªè¨¼ï¼‹ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ï¼‹DBã‚¢ã‚¯ã‚»ã‚¹ï¼‰å‡¦ç†ã¨ï¼Œã“ã‚Œã«å¯¾å¿œã™ã‚‹ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰å‡¦ç†ã‚’æä¾›ã™ã‚‹ï¼ å‚è€ƒï¼š https://readouble.com/laravel/8.x/ja/starter-kits.html#laravel-breeze https://readouble.com/laravel/8.x/ja/fortify.html#laravel-fortify-and-laravel-sanctum å°å…¥æ–¹æ³• å‚è€ƒï¼šhttps://github.com/laravel/breeze ãƒ»ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ« ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹ï¼ $ composer require laravel/breeze:^1.0 --dev ãƒ»èªè¨¼å‡¦ç†ãƒ•ã‚¡ã‚¤ãƒ«ã®è‡ªå‹•ç”Ÿæˆ èªè¨¼å‡¦ç†ã«é–¢é€£ã™ã‚‹ã‚¯ãƒ©ã‚¹ã‚’è‡ªå‹•ç”Ÿæˆã§ãã‚‹ï¼Bladeã«çµ„ã¿åˆã‚ã›ã‚‹JavaScriptã‚’é¸ã¹ã‚‹ï¼ $ php artisan breeze:install 20-07. UIãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ï¼ˆLaravel 7ç³»ä»¥å‰ï¼‰ UIãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã¨ã¯ LaravelãŒæŒã¤å…¨ã¦ã®èªè¨¼æ©Ÿèƒ½ã®ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ï¼ˆèªè¨¼ï¼‹ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ï¼‹DBã‚¢ã‚¯ã‚»ã‚¹ï¼‰å‡¦ç†ã¨ï¼Œã“ã‚Œã«å¯¾å¿œã™ã‚‹ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰å‡¦ç†ã‚’æä¾›ã™ã‚‹ï¼ å‚è€ƒï¼šhttps://readouble.com/laravel/7.x/ja/authentication.html å°å…¥æ–¹æ³• ãƒ»ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ« ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹ï¼ $ composer require laravel/ui:^1.0 --dev ãƒ»èªè¨¼å‡¦ç†ãƒ•ã‚¡ã‚¤ãƒ«ã®è‡ªå‹•ç”Ÿæˆ èªè¨¼å‡¦ç†ã«é–¢é€£ã™ã‚‹ã‚¯ãƒ©ã‚¹ã‚’è‡ªå‹•ç”Ÿæˆã§ãã‚‹ï¼Bladeã«çµ„ã¿åˆã‚ã›ã‚‹JavaScriptã‚’é¸ã¹ã‚‹ï¼ # Vuejsã‚’ä½¿ç”¨ã™ã‚‹å ´åˆï¼ $ php artisan ui vue --auth # Reactã‚’ä½¿ç”¨ã™ã‚‹å ´åˆ $ php artisan ui react --auth # Bootstrapã‚’ä½¿ç”¨ã™ã‚‹å ´åˆï¼ $ php artisan ui bootstrap --auth 21. Laravel Mixãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ Laravel Mixãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã¨ã¯ Webpackã‚’Laravelã‚’ä»‹ã—ã¦æ“ä½œã§ãã‚‹ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®ã“ã¨ï¼Breezeãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã«ã‚‚åŒæ¢±ã•ã‚Œã¦ã„ã‚‹ï¼ å‚è€ƒï¼šhttps://readouble.com/laravel/8.x/ja/mix.html Webpackã‚’æ“ä½œã™ã‚‹ã‚³ãƒãƒ³ãƒ‰ ãƒ»ã‚¢ã‚»ãƒƒãƒˆã®åˆæœŸã‚³ãƒ³ãƒ‘ã‚¤ãƒ« ã‚¢ã‚»ãƒƒãƒˆã®ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã‚’å®Ÿè¡Œã™ã‚‹ï¼ $ npm run dev ãƒ»ã‚¢ã‚»ãƒƒãƒˆã®è‡ªå‹•å†ã‚³ãƒ³ãƒ‘ã‚¤ãƒ« ã‚¢ã‚»ãƒƒãƒˆã®ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ãŒå¤‰æ›´ã•ã‚ŒãŸæ™‚ã«ï¼Œã“ã‚Œã¨æ¤œçŸ¥ã—ï¼Œè‡ªå‹•çš„ã«å†ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã‚’å®Ÿè¡Œã™ã‚‹ï¼ $ npm run watch 22. éå…¬å¼ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ laravel-enum ãƒ»ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ å‚è€ƒï¼šhttps://github.com/BenSampo/laravel-enum ãƒ»Enumã‚¯ãƒ©ã‚¹ã®å®šç¾© BenSampoã®Enumã‚¯ãƒ©ã‚¹ã‚’ç¶™æ‰¿ã—ï¼ŒåŒºåˆ†å€¤ã¨åˆ¤å®šãƒ¡ã‚½ãƒƒãƒ‰ã‚’å®Ÿè£…ã™ã‚‹ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š is(self::CALL_ROLE); } /** * é–‹ç™ºè·ã®åŒºåˆ†å€¤ã‚’æŒã¤ã‹ã‚’åˆ¤å®šã—ã¾ã™ï¼ */ public function isDevelopmentRole() { return $this->is(self::DEVELOPMENT_ROLE); } /** * çµŒç†è·ã®åŒºåˆ†å€¤ã‚’æŒã¤ã‹ã©ã†ã‹ã‚’åˆ¤å®šã—ã¾ã™ï¼ */ public function isFinanceRole() { return $this->is(self::FINANCE_ROLE); } /** * ä¼ç”»è·ã®åŒºåˆ†å€¤ã‚’æŒã¤ã‹ã©ã†ã‹ã‚’åˆ¤å®šã—ã¾ã™ï¼ */ public function isPlanRole() { return $this->is(self::PLAN_ROLE); } /** * å–¶æ¥­è·ã®åŒºåˆ†å€¤ã‚’æŒã¤ã‹ã©ã†ã‹ã‚’åˆ¤å®šã—ã¾ã™ï¼ */ public function isSalesRole() { return $this->is(self::SALES_ROLE); } } ãƒ»Enumã‚¯ãƒ©ã‚¹ã®ä½¿ã„æ–¹ ï¼Šå®Ÿè£…ä¾‹ï¼Š ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‹ã‚‰åŒºåˆ†å€¤ã‚’SELECTã—ãŸå¾Œï¼Œã“ã‚Œã‚’å…ƒã«Enumã‚¯ãƒ©ã‚¹ã‚’ä½œæˆã™ã‚‹ï¼ roleType = new RoleType($fetched[\"role_type\"]); // ä»¥ä¸‹ã®æ–¹æ³•ã§ã‚‚ã‚ˆã„ï¼ // $staff->roleType = RoleType::fromValue($fetched[\"role_type\"]); // StaffãŒã„ãšã‚Œã®RoleTypeã‚’æŒã¤ã‹ $staff->roleType->isDevelopmentRole(); // true $staff->roleType->isSalesRole(); // false ï¼Šå®Ÿè£…ä¾‹ï¼Š ãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‹ã‚‰ãƒ‡ãƒ¼ã‚¿ã‚’å–ã‚Šå‡ºã—ãŸå¾Œï¼Œã“ã‚Œã‚’å…ƒã«Enumã‚¯ãƒ©ã‚¹ã‚’ä½œæˆã™ã‚‹ï¼ laravel-ide-helper ãƒ»laravel-ide-helperã¨ã¯ PHPStromã§Laravelã‚’é–‹ç™ºã™ã‚‹å ´åˆã«ï¼Œæ‹¡å¼µæ©Ÿèƒ½ã‚’æä¾›ã™ã‚‹ï¼ å‚è€ƒï¼šhttps://github.com/barryvdh/laravel-ide-helper#phpstorm-meta-for-container-instances ãƒ»Facade $ php artisan ide-helper:generate ãƒ»ã‚¢ãƒãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ç”Ÿæˆ Laravelã®Eloquentãƒ¢ãƒ‡ãƒ«ã§ï¼Œã‚¢ãƒãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ã‚’è‡ªå‹•ç”Ÿæˆã™ã‚‹ï¼ $ php artisan ide-helper:models ãƒ»äºˆæ¸¬è¡¨ç¤º Laravelã®ãƒ¡ã‚½ãƒƒãƒ‰ã‚’äºˆæ¸¬è¡¨ç¤ºã™ã‚‹ãŸã‚ï¼Œphpstorm.meta.phpãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç”Ÿæˆã™ã‚‹ï¼ $ php artisan ide-helper:meta "},"public/software/software_application_backend_php_package_management.html":{"url":"public/software/software_application_backend_php_package_management.html","title":"ğŸ“– ï¸ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ç®¡ç†","keywords":"","body":"ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ç®¡ç† ã¯ã˜ã‚ã« æœ¬ã‚µã‚¤ãƒˆã«ã¤ãã¾ã—ã¦ï¼Œä»¥ä¸‹ã‚’ã”èªè­˜ã®ã»ã©å®œã—ããŠé¡˜ã„ã„ãŸã—ã¾ã™ï¼ å‚è€ƒï¼šhttps://hiroki-it.github.io/tech-notebook-gitbook/ 01. composerã«ã‚ˆã‚‹ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®ç®¡ç† composer.jsonãƒ•ã‚¡ã‚¤ãƒ«ã®å®Ÿè£… ãƒ»ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’å®šç¾© # å€‹äººçš„ã«ä¸€ç•ªãŠã™ã™ã‚ # ã‚­ãƒ£ãƒ¬ãƒƒãƒˆè¡¨è¨˜ { \"require\": { \"foo\": \"^1.1.1\", # >=1.1.1 and =1.1.0 and =0.0.1 and # ãƒãƒ«ãƒ€è¡¨è¨˜ { \"require\": { \"foo\": \"~1.1.1\", # >=1.1.1 and =1.1.0 and =1.1.0 and # ã‚¨ãƒƒã‚¯ã‚¹ï¼Œã‚¢ã‚¹ã‚¿ãƒªã‚¹ã‚¯è¡¨è¨˜ { \"require\": { \"foo\": \"*\", # ã©ã‚“ãªãƒãƒ¼ã‚¸ãƒ§ãƒ³ã§ã‚‚OK \"bar\": \"1.1.x\", # >=1.1.0 and =1.0.0 and ãƒ»åå‰ç©ºé–“ã®ãƒ¦ãƒ¼ã‚¶å®šç¾© åå‰ç©ºé–“ã¨ãƒ•ã‚¡ã‚¤ãƒ«ãƒ‘ã‚¹ã®å¯¾å¿œé–¢ä¿‚ã‚’è¨­å®šã™ã‚‹ï¼ { \"autoload\": { \"psr-4\": { # \"\": \"\", \"App\\\\\": \"app/\", \"Database\\\\Factories\\\\Infrastructure\\\\DTO\\\\\": \"database/factories/production\", \"Database\\\\Seeders\\\\\": \"database/seeds/production\" }, \"classmap\": [ \"database/seeds\", \"database/factories\" ] } } ãã®å¾Œï¼Œåå‰ç©ºé–“ã®èª­ã¿è¾¼ã¿ã‚’ç™»éŒ²ã™ã‚‹ï¼ $ composer dump-autoload require ãƒ»ã‚ªãƒ—ã‚·ãƒ§ãƒ³ãªã— ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸åã‚’composer.jsonãƒ•ã‚¡ã‚¤ãƒ«ã‚’æ›¸ãè¾¼ã‚€ï¼ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã¯è¡Œã‚ãªã„ï¼ã‚³ãƒãƒ³ãƒ‰ã‚’ä½¿ç”¨ã›ãšã«è‡ªåˆ†ã§å®Ÿè£…ã—ã¦ã‚‚è‰¯ã„ï¼ $ composer require :^x.x install ãƒ»ã‚ªãƒ—ã‚·ãƒ§ãƒ³ãªã— ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã«ã¦ï¼Œcomposer.lockãƒ•ã‚¡ã‚¤ãƒ«ã«å®Ÿè£…ã•ã‚ŒãŸãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’å…¨ã¦ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹ï¼composer.lockãƒ•ã‚¡ã‚¤ãƒ«ã®ãŠã‹ã’ã§ï¼Œãƒªãƒã‚¸ãƒˆãƒªã®åˆ©ç”¨è€…ãŒï¼Œcomposer installã®å®Ÿè¡Œæ™‚ã«ï¼Œå…±é€šã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã®ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã§ãã‚‹ï¼ $ composer install ãƒ»-vvv ã‚³ãƒãƒ³ãƒ‰å‡¦ç†ä¸­ã®ãƒ­ã‚°ã‚’è¡¨ç¤ºã™ã‚‹ $ composer install -vvv ãƒ»--no-dev require-devã‚¿ã‚°å†…ã®ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã¯é™¤ã„ã¦ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ« $ composer install --no-dev ãƒ»--prefer-dist Composerã®é…å¸ƒã‚µã‚¤ãƒˆã‹ã‚‰ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹ï¼prefer-sourceã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’ä½¿ç”¨ã™ã‚‹ã‚ˆã‚Šã‚‚é«˜é€Ÿã§ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã§ãã‚‹ï¼ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§distã‚’ä½¿ç”¨ã™ã‚‹ãŸã‚ï¼Œå®Ÿéš›ã¯å®£è¨€ã—ãªãã¦ã‚‚å•é¡Œãªã„ï¼ $ composer install --prefer-dist ãƒ»--prefer-source GitHubã®Composerãƒªãƒã‚¸ãƒˆãƒªã‹ã‚‰ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹ï¼Composerã®é–‹ç™ºè€…ç”¨ã§ã‚ã‚‹ï¼ $ composer install --prefer-source update ãƒ»ã‚ªãƒ—ã‚·ãƒ§ãƒ³ãªã— ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã«ã¦ï¼Œcomposer.jsonãƒ•ã‚¡ã‚¤ãƒ«ã«å®Ÿè£…ã•ã‚ŒãŸãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®ã†ã¡ã§ï¼Œã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¦ã„ãªã„ã‚‚ã®ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹ï¼ã¾ãŸï¼Œãƒãƒ¼ã‚¸ãƒ§ãƒ³ã®æŒ‡å®šã‚’ã‚‚ã¨ã«æ›´æ–°å¯èƒ½ãªãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’æ›´æ–°ã™ã‚‹ï¼composer.lockãƒ•ã‚¡ã‚¤ãƒ«ã«å…¨ã¦ã®ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸æƒ…å ±ã‚’æ›¸ãè¾¼ã‚€ï¼ãƒªãƒã‚¸ãƒˆãƒªã®åˆ©ç”¨è€…ãŒã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã«ã‚‚å½±éŸ¿ã‚’ä¸ãˆã‚‹ï¼ $ composer update ãƒ»-vvv ã‚³ãƒãƒ³ãƒ‰å‡¦ç†ä¸­ã®ãƒ­ã‚°ã‚’è¡¨ç¤ºã™ã‚‹ $ composer install -vvv ãƒ»COMPOSER_MEMORY_LIMIT=-1 phpã®ãƒ¡ãƒ¢ãƒªä¸Šé™ã‚’ç„¡ã—ã«ã—ã¦ï¼Œä»»æ„ã®composerã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã™ã‚‹ï¼phpãƒã‚¤ãƒŠãƒªãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½¿ç”¨ã™ã‚‹ï¼Dockerã‚³ãƒ³ãƒ†ãƒŠå†…ã§å®Ÿè¡Œã™ã‚‹å ´åˆï¼Œè¨­å®šç”»é¢ã‹ã‚‰ã‚³ãƒ³ãƒ†ãƒŠã®CPUã‚„ãƒ¡ãƒ¢ãƒªã‚’å¢—è¨­ã™ã‚‹ã“ã¨ã‚‚ã§ãã‚‹ï¼ $ COMPOSER_MEMORY_LIMIT=-1 composer update -vvv ãã®ä»–ã®ã‚³ãƒãƒ³ãƒ‰ ãƒ»clear-cache ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æ™‚ã«ç”Ÿæˆã•ã‚ŒãŸã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’å‰Šé™¤ã™ã‚‹ï¼ $ composer clear-cache ãƒ»ã‚¨ã‚¤ãƒªã‚¢ã‚¹å ãƒ¦ãƒ¼ã‚¶ãŒå®šç¾©ã—ãŸã‚¨ã‚¤ãƒªã‚¢ã‚¹åã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã™ã‚‹ï¼ $ composer ã‚ã‚‰ã‹ã˜ã‚ï¼Œä»»æ„ã®ã‚¨ã‚¤ãƒªã‚¢ã‚¹åã‚’scriptsã‚­ãƒ¼ä¸‹ã«å®šç¾©ã™ã‚‹ï¼ã‚¨ã‚¤ãƒªã‚¢ã‚¹ã®ä¸­ã§ï¼Œå®Ÿè¡Œã™ã‚‹ã‚³ãƒãƒ³ãƒ‰ã®ã‚»ãƒƒãƒˆã‚’å®šç¾©ã™ã‚‹ï¼ { \"scripts\": { # ã‚¨ã‚¤ãƒªã‚¢ã‚¹å \"post-autoload-dump\": [ # å®Ÿè¡Œã™ã‚‹ã‚³ãƒãƒ³ãƒ‰ \"Illuminate\\\\Foundation\\\\ComposerScripts::postAutoloadDump\", \"@php artisan package:discover --ansi\" ], \"post-root-package-install\": [ \"@php -r \\\"file_exists(\".env\") || copy(\".env.example\", \".env\");\\\"\" ], \"post-create-project-cmd\": [ \"@php artisan key:generate --ansi\" ] } } ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚¢ãƒƒãƒ—ã®æ‰‹é † ãƒ»äº‹å‰ç¢ºèªã®é‡è¦æ€§ ãƒãƒ¼ã‚¸ãƒ§ãƒ³æ›´æ–°ã«ã‚ˆã‚Šï¼Œã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚„ã“ã‚Œã«é–¢ä¿‚ã™ã‚‹ä»–ã®ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã«å½±éŸ¿ãŒèµ·ã“ã‚‹å¯èƒ½æ€§ãŒã‚ã‚‹ï¼ãã®ãŸã‚ï¼Œäºˆæƒ³å¤–ã®å½±éŸ¿ãŒèµ·ã“ã‚‰ãªã„ã‚ˆã†ã«ï¼Œãƒãƒ‹ãƒ¥ã‚¢ãƒ«ã‚„ãƒªãƒªãƒ¼ã‚¹ãƒãƒ¼ãƒˆã«ã¦ï¼Œãƒãƒ¼ã‚¸ãƒ§ãƒ³é–“ã®å·®ç•°ã‚’å…¨ã¦ç¢ºèªã—ã¦ãŠãå¿…è¦ãŒã‚ã‚‹ï¼ 1. ãƒãƒ¼ã‚¸ãƒ§ãƒ³é–“ã®äº’æ›æ€§ã‚’ç¢ºèª ç ´å£Šçš„å¤‰æ›´ã®ãŸã‚ã«ãƒãƒ¼ã‚¸ãƒ§ãƒ³é–“ã§äº’æ›æ€§ãŒå…¨ããªãï¼Œå¤ã„ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã¨æ–°ã—ã„ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã§ä½¿ç”¨æ–¹æ³•ã‚„ã‚ªãƒ—ã‚·ãƒ§ãƒ³ãŒç•°ãªã‚‹å¯èƒ½æ€§ãŒã‚ã‚‹ï¼ä¸€æ–¹ã§ï¼Œäº’æ›æ€§ãŒã‚ã‚‹ã‚‚ã®ã®ï¼Œå¤§ããªå¤‰æ›´ãŒãªã•ã‚Œã¦ã„ã‚‹å¯èƒ½æ€§ãŒã‚ã‚‹ï¼ 2. è¿½åŠ ï¼Œå»ƒæ­¢ï¼Œéæ¨å¥¨ã‚’ç¢ºèª ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚¢ãƒƒãƒ—ã«ã‚ˆã‚Šï¼Œæ–°ã—ã„æ©Ÿèƒ½ãŒè¿½åŠ ã•ã‚Œã¦ã„ã‚‹å¯èƒ½æ€§ãŒã‚ã‚‹ï¼ä¸€æ–¹ã§ï¼Œä»Šã¾ã§ã®æ–¹æ³•ãŒå»ƒæ­¢ã¾ãŸã¯éæ¨å¥¨ã«ç§»è¡Œã—ã¦ã„ã‚‹å¯èƒ½æ€§ãŒã‚ã‚‹ï¼ 3. äºˆç´„èªã‚„é–¢æ•°ã‚’ç¢ºèª ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚¢ãƒƒãƒ—ã«ã‚ˆã‚Šï¼Œäºˆç´„èªã‚„é–¢æ•°ãŒå¤‰æ›´ã•ã‚Œã¦ã„ã‚‹å¯èƒ½æ€§ãŒã‚ã‚‹ï¼äºˆç´„èªã‚’è‡ªèº«ãŒä½¿ç”¨ã—ã¦ã„ã‚‹ã¨ãƒãƒƒãƒ†ã‚£ãƒ³ã‚°ã—ã¦ã‚¨ãƒ©ãƒ¼ã«ãªã£ã¦ã—ã¾ã†ï¼ 4. ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ä¿®æ­£ä½œæ¥­ã®è€ƒæ…® ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚¢ãƒƒãƒ—ã«ä¼´ã£ã¦ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã®ä¿®æ­£ãŒå¿…è¦ãªã“ã¨ãŒã‚ã‹ã£ãŸå ´åˆï¼Œãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚¢ãƒƒãƒ—ã®æ‰‹é †è‡ªä½“ã«ä¿®æ­£ä½œæ¥­ã‚’çµ„ã¿è¾¼ã‚€å¿…è¦ãŒã‚ã‚‹ï¼ 5. ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ãƒšãƒ¼ã‚¸ã®è¡¨ç¤º ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚¢ãƒƒãƒ—ã«ã‚ˆã‚Šãƒ€ã‚¦ãƒ³ã‚¿ã‚¤ãƒ ãŒç™ºç”Ÿã™ã‚‹å ´åˆï¼Œãã®é–“ã¯ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ãƒšãƒ¼ã‚¸ã‚’è¡¨ç¤ºã™ã‚‹å¿…è¦ãŒã‚ã‚‹ï¼Œä¾‹ãˆã°ï¼ŒALBã«ã¯ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ãƒšãƒ¼ã‚¸ã‚’è¡¨ç¤ºã™ã‚‹ãŸã‚ã®æ©Ÿèƒ½ãŒã‚ã‚‹ï¼ 6. æ›´æ–°ä½œæ¥­ã‚’ãƒªãƒãƒ¼ã‚µãƒ« ãƒ†ã‚¹ãƒˆç’°å¢ƒã§æ›´æ–°ä½œæ¥­ã‚’ãƒªãƒãƒ¼ã‚µãƒ«ã—ï¼Œå•é¡Œãªãå®Œäº†ã™ã‚‹ã“ã¨ã‚’ç¢ºèªã™ã‚‹ï¼ 7. ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ãƒ†ã‚¹ãƒˆ ãƒ†ã‚¹ãƒˆç’°å¢ƒã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚¢ãƒƒãƒ—å¾Œã«ï¼Œã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ãƒ†ã‚¹ãƒˆã™ã‚‹å¿…è¦ãŒã‚ã‚‹ï¼ 8. ãƒªãƒ¼ãƒ‰ãƒ¬ãƒ—ãƒªã‚«ã‚’æœ€åˆã«ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆ 9. åˆ‡ã‚Šæˆ»ã—ä½œæ¥­ã®è€ƒæ…® æœ¬ç•ªç’°å¢ƒã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚¢ãƒƒãƒ—å¾Œã«æƒ³å®šå¤–ã®å•é¡ŒãŒèµ·ã“ã‚‹ã“ã¨ã‚‚è€ƒæ…®ã—ã¦ï¼Œãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚¢ãƒƒãƒ—ã®æ‰‹é †è‡ªä½“ã«åˆ‡ã‚Šæˆ»ã—ä½œæ¥­ã‚’çµ„ã¿è¾¼ã‚€å¿…è¦ãŒã‚ã‚‹ï¼ 02. ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã«ã‚ˆã‚‹ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®èª­ã¿è¾¼ã¿ ã‚¨ãƒ³ãƒˆãƒªãƒã‚¤ãƒ³ãƒˆã«ãŠã‘ã‚‹autoload.phpãƒ•ã‚¡ã‚¤ãƒ«ã®èª­ã¿è¾¼ã¿ ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ãŒï¼Œvendorãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªä¸‹ã«ä¿å­˜ã•ã‚Œã¦ã„ã‚‹ã¨ä»®å®šã™ã‚‹ï¼ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’ä½¿ç”¨ã™ã‚‹ãŸã³ã«ï¼Œå„ã‚¯ãƒ©ã‚¹ã§ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’èª­ã¿è¾¼ã‚€ã“ã¨ã¯æ‰‹é–“ãªã®ã§ï¼Œã‚¨ãƒ³ãƒˆãƒªãƒ¼ãƒã‚¤ãƒ³ãƒˆï¼ˆindex.phpï¼‰ã‚ã‚‹ã„ã¯bootstrap.phpã§ï¼Œæœ€åˆã«èª­ã¿è¾¼ã‚“ã§ãŠãï¼Œã‚¯ãƒ©ã‚¹ã§ã¯èª­ã¿è¾¼ã¾ãªãã¦è‰¯ã„ã‚ˆã†ã«ã™ã‚‹ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š "},"public/software/software_application_backend_php_package_mysql.html":{"url":"public/software/software_application_backend_php_package_mysql.html","title":"ğŸ“– ï¸MySQLãƒ‘ãƒƒã‚±ãƒ¼ã‚¸","keywords":"","body":"MySQLãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ ã¯ã˜ã‚ã« æœ¬ã‚µã‚¤ãƒˆã«ã¤ãã¾ã—ã¦ï¼Œä»¥ä¸‹ã‚’ã”èªè­˜ã®ã»ã©å®œã—ããŠé¡˜ã„ã„ãŸã—ã¾ã™ï¼ å‚è€ƒï¼šhttps://hiroki-it.github.io/tech-notebook-gitbook/ 01. èª­ã¿å‡ºã•ã‚ŒãŸãƒ¬ã‚³ãƒ¼ãƒ‰ã®å–å¾— ãƒ•ã‚§ãƒƒãƒ ãƒ»ãƒ•ã‚§ãƒƒãƒã¨ã¯ èª­ã¿å‡ºã—ãŸãƒ¬ã‚³ãƒ¼ãƒ‰ã‚’ã«ä¸€åº¦ã«å…¨ã¦å–å¾—ã—ã¦ã—ã¾ã†ã¨ï¼Œã‚µãƒ¼ãƒå´ã®ãƒ¡ãƒ¢ãƒªã‚’åœ§è¿«ã—ã¦ã—ã¾ã†ï¼ãã“ã§ï¼Œå°‘ã—ãšã¤å–å¾—ã™ã‚‹ï¼ ãƒ»ãƒ•ã‚§ãƒƒãƒã®ãƒ¡ã‚½ãƒƒãƒ‰åã«é–¢ã™ã‚‹æ³¨æ„ç‚¹ æ³¨æ„ç‚¹ã¨ã—ã¦ï¼ŒFETCHé–¢æ•°ã¯ï¼Œãƒ™ãƒ³ãƒ€ãƒ¼ã«ã‚ˆã£ã¦åå‰ãŒç•°ãªã£ã¦ã„ã‚‹ã“ã¨ãŒã‚ã‚‹ï¼ãã®ãŸã‚ï¼ŒåŒã˜åå‰ã§ã‚‚åŒã˜åˆ†ã ã‘ãƒ¬ã‚³ãƒ¼ãƒ‰ã‚’å–å¾—ã™ã‚‹ã¨ã¯é™ã‚‰ãªã„ï¼ 02. PDO èª­ã¿å‡ºã— ãƒ»prepareãƒ¡ã‚½ãƒƒãƒ‰ ãƒ—ãƒªãƒšã‚¢ãƒ¼ãƒ‰ã‚¹ãƒ†ãƒ¼ãƒˆãƒ¡ãƒ³ãƒˆã‚’ä½¿ç”¨ã—ã¦SQLã‚’å®šç¾©ã™ã‚‹ï¼ãƒ—ãƒªã‚¢ãƒ¼ãƒ‰ã‚¹ãƒ†ãƒ¼ãƒˆãƒ¡ãƒ³ãƒˆã«ã‚ˆã‚‹SQLã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³ã®é˜²å¾¡ã«ã¤ã„ã¦ã¯ï¼Œä»¥ä¸‹ã®ãƒªãƒ³ã‚¯ã‚’å‚è€ƒã«ã›ã‚ˆï¼ ãƒ»fetchãƒ¡ã‚½ãƒƒãƒ‰ èª­ã¿å‡ºã•ã‚ŒãŸå…¨ã¦ã®ãƒ¬ã‚³ãƒ¼ãƒ‰ã®ã†ã¡ï¼Œæœ€åˆã®ãƒ¬ã‚³ãƒ¼ãƒ‰ã®å…¨ã¦ã®ã‚«ãƒ©ãƒ ã‚’å–å¾—ã—ï¼Œä¸€æ¬¡å…ƒã®é€£æƒ³é…åˆ—ã§è¿”å´ã™ã‚‹ï¼ ãƒ»fetchAllãƒ¡ã‚½ãƒƒãƒ‰ èª­ã¿å‡ºã•ã‚ŒãŸå…¨ã¦ã®ãƒ¬ã‚³ãƒ¼ãƒ‰ã®ï¼Œå…¨ã¦ã®ã‚«ãƒ©ãƒ ã‚’å–å¾—ã—ï¼ŒäºŒæ¬¡å…ƒã®é€£æƒ³é…åˆ—ã§è¿”å´ã™ã‚‹ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š prepare($sql); // ãƒ—ãƒªãƒšã‚¢ãƒ¼ãƒ‰ã‚¹ãƒ†ãƒ¼ãƒˆãƒ¡ãƒ³ãƒˆã‚’å®šç¾©ï¼ $stmt->execute(); // å®Ÿè¡Œï¼ // å…¨ã¦ã®ãƒ¬ã‚³ãƒ¼ãƒ‰ã‚’å–å¾—ã™ã‚‹ï¼ $data = $stmt->fetchAll(); // å‡ºåŠ› print_r($data); // ã‚«ãƒ©ãƒ åã¨å€¤ã®é€£æƒ³é…åˆ—ã¨ã—ã¦å–å¾—ã§ãã‚‹ï¼ // Array // ( // [0] => Array // ( // [id] => 1 // [name] => ã®ã³å¤ª // [gender] => man // [type] => human // ) // [1] => Array // ( // [id] => 2 // [name] => ãƒ‰ãƒ©ãˆã‚‚ã‚“ // [gender] => man // [type] => robot // ) // ) ãƒ»fetchColumnãƒ¡ã‚½ãƒƒãƒ‰ èª­ã¿å‡ºã•ã‚ŒãŸå…¨ã¦ã®ãƒ¬ã‚³ãƒ¼ãƒ‰ã®ã†ã¡ï¼Œæœ€åˆã®ãƒ¬ã‚³ãƒ¼ãƒ‰ã®ä¸€ç•ªå·¦ã®ã‚«ãƒ©ãƒ ã®ã¿ã‚’å–å¾—ã—ï¼Œæ··åˆå‹ã§è¿”å´ã™ã‚‹ï¼ä¸»ã«ï¼ŒCOUNTé–¢æ•°ã®å ´åˆã«ç”¨ã„ã‚‹ ï¼Šå®Ÿè£…ä¾‹ï¼Š prepare($sql); // ãƒ—ãƒªãƒšã‚¢ãƒ¼ãƒ‰ã‚¹ãƒ†ãƒ¼ãƒˆãƒ¡ãƒ³ãƒˆã‚’å®šç¾©ï¼ $stmt->execute(); // å®Ÿè¡Œï¼ // ãƒ¬ã‚³ãƒ¼ãƒ‰ã‚’å–å¾—ã™ã‚‹ï¼ $data = $stmt->fetchColumn(); // å‡ºåŠ› print_r($data); // 10 (ä»¶) æ›¸ãè¾¼ã¿ ãƒ»INSERT ã€ãªã©ã®ç‰¹æ®Šæ–‡å­—ã‚’ã‚¨ã‚¹ã‚±ãƒ¼ãƒ—ï¼ˆç„¡å®³åŒ–ï¼‰ $staff_name = htmlspecialchars($staff_name, ENT_QUOTES, \"UTF-8\"); $staff_pass = htmlspecialchars($staff_pass, ENT_QUOTES, \"UTF-8\"); // ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã¨æ¥ç¶šï¼ˆã‚¤ã‚³ãƒ¼ãƒ«ã®é–“ã«ã‚¹ãƒšãƒ¼ã‚¹ã‚’å…¥ã‚Œã‚‹ã¨ã‚¨ãƒ©ãƒ¼ã«ãªã‚‹ï¼‰ $dsn = \"mysql:dbname=kizukeba_pronami_php; host=kizukebapronamiphp charaset=UTF-8\"; $user = \"root\"; $password = \"\"; $dbh = new PDO($dsn, $user, $password); $dbh->setAttribute(PDO::ATTR_ERRMODE,PDO::ERRMODE_EXCEPTION); // åˆ—åã¨å€¤ã‚’æŒ‡å®šã—ã¦INSERT $sql=\"INSERT INTO mst_staff (name,password) VALUES (?,?)\"; $stmt = $dbh->prepare($sql); // é…åˆ—ã«å€¤ã‚’æ ¼ç´ï¼ˆæ ¼ç´ã™ã‚‹å€¤ã®é †ç•ªã¨ï¼ŒSQLã§ã®å¼•æ•°ã®é †ç•ªã¯ï¼Œåˆã‚ã›ã‚‹å¿…è¦ãŒã‚ã‚‹ï¼‰ $data[] = $staff_name; $data[] = $staff_pass; // SQLã‚’å®Ÿè¡Œ $stmt->execute($data); // ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã¨ã®æ¥ç¶šã‚’åˆ‡æ–­ $dbh = null; ãƒ»UPDATE ãƒ»DELETE 03. Doctrineãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ Doctrineã¨ã¯ RDBã®èª­ã¿è¾¼ã¿ç³»ï¼æ›¸ãè¾¼ã¿ç³»ã®æ“ä½œã‚’è¡Œã†ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ï¼ä»–ã®åŒæ§˜ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã¨ã—ã¦ï¼ŒPDOãŒã‚ã‚‹ï¼PDOã«ã¤ã„ã¦ã¯ï¼Œä»¥ä¸‹ã®ãƒãƒ¼ãƒˆã‚’å‚è€ƒã«ã›ã‚ˆï¼ å‚è€ƒï¼šhttps://hiroki-it.github.io/tech-notebook-gitbook/public/backend_database_operation.html SQLã®å®šç¾© ãƒ»createQueryBuilderãƒ¡ã‚½ãƒƒãƒ‰ CRUDå‡¦ç†ã«å¿…è¦ãªSQLã‚’ä¿æŒã—ï¼Œãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³ã«ã‚ˆã£ã¦SQLã‚’å®Ÿè¡Œã™ã‚‹ï¼ å‚è€ƒï¼šhttps://www.doctrine-project.org/projects/doctrine-dbal/en/2.10/reference/query-builder.html ï¼Šå®Ÿè£…ä¾‹ï¼Š createQueryBuilder(); èª­ã¿å‡ºã— ãƒ»selectãƒ¡ã‚½ãƒƒãƒ‰ QueryBuilderã‚¯ãƒ©ã‚¹ã«ãŠã‘ã‚‹selectãƒ¡ã‚½ãƒƒãƒ‰ã«ï¼Œå€¤ã‚’è¨­å®šã™ã‚‹ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š select(\"id\", \"name\") ->from(\"mst_users\"); æ›¸ãè¾¼ã¿ ãƒ»insertãƒ¡ã‚½ãƒƒãƒ‰ QueryBuilderã‚¯ãƒ©ã‚¹ã«ãŠã‘ã‚‹insertãƒ¡ã‚½ãƒƒãƒ‰ã«ï¼Œå€¤ã‚’è¨­å®šã™ã‚‹ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š insert(\"mst_users\") ãƒ»updateãƒ¡ã‚½ãƒƒãƒ‰ QueryBuilderã‚¯ãƒ©ã‚¹ã«ãŠã‘ã‚‹updateãƒ¡ã‚½ãƒƒãƒ‰ã«ï¼Œå€¤ã‚’è¨­å®šã™ã‚‹ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š update(\"mst_users\"); ãƒ»deleteãƒ¡ã‚½ãƒƒãƒ‰ QueryBuilderã‚¯ãƒ©ã‚¹ã«ãŠã‘ã‚‹deleteãƒ¡ã‚½ãƒƒãƒ‰ã«ï¼Œå€¤ã‚’è¨­å®šã™ã‚‹ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š delete(\"mst_users\"); å®Ÿè¡Œ ãƒ» getConnectionãƒ¡ã‚½ãƒƒãƒ‰ï¼ŒexecuteQueryãƒ¡ã‚½ãƒƒãƒ‰ï¼ŒfetchAllãƒ¡ã‚½ãƒƒãƒ‰ ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã¸ã®æ¥ç¶šã—ï¼ŒSQLã®å®Ÿè¡Œã™ã‚‹ï¼ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ¥ç¶šã«é–¢ã‚ã‚‹getConnectionãƒ¡ã‚½ãƒƒãƒ‰ã‚’èµ·ç‚¹ã¨ã—ã¦ï¼Œè¿”ã‚Šå€¤ã‹ã‚‰ç¹°ã‚Šè¿”ã—ãƒ¡ã‚½ãƒƒãƒ‰ã‚’å–å¾—ã—ï¼ŒfetchAllãƒ¡ã‚½ãƒƒãƒ‰ã§ï¼Œãƒ†ãƒ¼ãƒ–ãƒ«ã®ã‚¯ã‚¨ãƒªåã‚’ã‚­ãƒ¼ã¨ã—ãŸé€£æƒ³é…åˆ—ãŒè¿”ã•ã‚Œã‚‹ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š getConnection() // SQLã‚’å®Ÿè¡Œã—ï¼Œãƒ¬ã‚³ãƒ¼ãƒ‰ã‚’èª­ã¿å‡ºã™ï¼ ->executeQuery($queryBuilder->getSQL(), $queryBuilder->getParameters() )->fetchAll(); èª­ã¿å‡ºã—ç³»ã®æ“ä½œ ãƒ»ãƒ—ãƒ¬ãƒ¼ã‚¹ãƒ›ãƒ«ãƒ€ãƒ¼ ãƒ—ãƒªãƒšã‚¢ãƒ¼ãƒ‰ã‚¹ãƒ†ãƒ¼ãƒˆãƒ¡ãƒ³ãƒˆã®SQLä¸­ã«ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’è¨­å®šã—ï¼Œå€¤ã‚’ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã«æ¸¡ã—ãŸä¸Šã§ï¼ŒSQLã¨ã—ã¦ç™ºè¡Œã™ã‚‹æ–¹æ³•ï¼å‡¦ç†é€Ÿåº¦ãŒé€Ÿã„ï¼ã¾ãŸï¼Œãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã«èª¤ã£ã¦SQLãŒæ¸¡ã•ã‚Œã¦ã‚‚ï¼Œã“ã‚Œã‚’å®Ÿè¡Œã§ããªããªã‚‹ãŸã‚ï¼ŒSQLã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³ã®å¯¾ç­–ã«ã‚‚ãªã‚‹ï¼SQLã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³ã«ã¤ã„ã¦ã¯ï¼Œä»¥ä¸‹ã®ãƒªãƒ³ã‚¯ã‚’å‚è€ƒã«ã›ã‚ˆï¼ å‚è€ƒï¼šhttps://hiroki-it.github.io/tech-notebook-gitbook/public/infrastructure_network_cyber_attacks.html ï¼Šå®Ÿè£…ä¾‹ï¼Š createQueryBuilder(); // ãƒ—ãƒªãƒšã‚¢ãƒ¼ãƒ‰ã‚¹ãƒ†ãƒ¼ãƒˆãƒ¡ãƒ³ãƒˆã®å®šç¾© $queryBuilder->select([ \"dog_toy.type AS dog_toy_type\", \"dog_toy.name AS dog_toy_name\", \"dog_toy.number AS number\", \"dog_toy.price AS dog_toy_price\", \"dog_toy.color_value AS color_value\" ]) // FROMã‚’è¨­å®šã™ã‚‹ï¼ ->from(\"mst_dog_toy\", \"dog_toy\") // WHEREã‚’è¨­å®šã™ã‚‹ï¼ã“ã®æ™‚ï¼Œå€¤ã¯ãƒ—ãƒ¬ãƒ¼ã‚¹ãƒ›ãƒ«ãƒ€ãƒ¼ã¨ã—ã¦ãŠãï¼ ->where(\"dog_toy.type = :type\") // ãƒ—ãƒ¬ãƒ¼ã‚¹ãƒ›ãƒ«ãƒ€ãƒ¼ã«å€¤ã‚’è¨­å®šã™ã‚‹ï¼ã“ã“ã§ã¯ï¼Œå¼•æ•°ã§æ¸¡ã™ã€$toyTypeã€ã¨ã™ã‚‹ï¼ ->setParameter(\"type\", $toyType); // ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã«æ¥ç¶šï¼ return $queryBuilder->getConnection() // SQLã‚’å®Ÿè¡Œã—ï¼Œãƒ¬ã‚³ãƒ¼ãƒ‰ã‚’èª­ã¿å‡ºã™ï¼ ->executeQuery($queryBuilder->getSQL(), $queryBuilder->getParameters() )->fetchAll(); } } ãƒ»ãƒ‡ãƒ¼ã‚¿ã®ã‚­ãƒ£ãƒƒã‚·ãƒ¥ èª­ã¿å‡ºã—ç³»ã§å–å¾—ã—ãŸãƒ‡ãƒ¼ã‚¿ã‚’ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã§ãã‚‹ï¼ createQueryBuilder(); // ä½•ã‚‰ã‹ã®SQLã‚’å®šç¾© $query = $queryBuilder->select()->from() // ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãŒã‚ã‚‹å ´åˆï¼ŒArrayStatementã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’æ ¼ç´ // ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãŒãªã„å ´åˆï¼ŒResultCacheStatementã‚’æ ¼ç´ $statement = $this->connection->executeQuery( $query->getSQL(), $query->getParameters(), $queryParameterTypes(), new QueryCacheProfile() ); $result = $statement->fetchAll(); $statement->closeCursor(); return $result; } } æ›¸ãè¾¼ã¿ç³»ã®æ“ä½œ ãƒ»ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³ï¼Œã‚³ãƒŸãƒƒãƒˆï¼Œãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯ RDBã®å‡¦ç†ç”¨èªã«ç›¸å½“ã™ã‚‹beginTransactionãƒ¡ã‚½ãƒƒãƒ‰ï¼Œcommitãƒ¡ã‚½ãƒƒãƒ‰ï¼ŒrollBackãƒ¡ã‚½ãƒƒãƒ‰ã‚’ç”¨ã„ã¦ï¼ŒRDBã‚’æ“ä½œã™ã‚‹ï¼ å‚ç…§ï¼šhttps://www.doctrine-project.org/projects/doctrine-dbal/en/2.10/reference/transactions.html ï¼Šå®Ÿè£…ä¾‹ï¼Š beginTransaction(); try{ // ã‚³ãƒŸãƒƒãƒˆ $conn->commit(); } catch (\\Exception $e) { // ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯ $conn->rollBack(); throw $e; } 04. ãã®ä»– ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ ãƒ»ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã¨ã¯ DBã«ä¿å­˜ã•ã‚Œã¦ã„ã‚‹ãƒ‡ãƒ¼ã‚¿ã‚’ä¿æŒã—ãŸã¾ã¾ï¼Œãƒ†ãƒ¼ãƒ–ãƒ«ã®ä½œæˆã‚„ã‚«ãƒ©ãƒ ã®å¤‰æ›´ãªã©ã‚’è¡Œã†ãŸã‚ã®æ©Ÿèƒ½ã®ã“ã¨ï¼ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãƒ•ã‚¡ã‚¤ãƒ«ã¨å‘¼ã°ã‚Œã‚‹ã‚¹ã‚¯ãƒªãƒ—ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã—ï¼Œãƒ†ãƒ¼ãƒ–ãƒ«ã®æ–°è¦ä½œæˆã‚„ã‚«ãƒ©ãƒ ã®è¿½åŠ ã¯ã“ã®ã‚¹ã‚¯ãƒªãƒ—ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã«è¨˜è¿°ã—ã¦ã„ãï¼ é‹ç”¨æ‰‹é † èª°ã‹ãŒä»¥ä¸‹ã®Migrationãƒ•ã‚¡ã‚¤ãƒ«ã‚’masteråˆ¥åã«Push Migrationãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ­ãƒ¼ã‚«ãƒ«ç’°å¢ƒã«Pull ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ›´æ–°ãƒãƒƒãƒã‚’å®Ÿè¡Œã—ï¼Œãƒ­ãƒ¼ã‚«ãƒ«ç’°å¢ƒã®ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚¹ã‚­ãƒ¼ãƒã¨ãƒ¬ã‚³ãƒ¼ãƒ‰ã‚’æ›´æ–° ï¼Šå®Ÿè£…ä¾‹ï¼Š "},"public/software/software_application_backend_php_package_others.html":{"url":"public/software/software_application_backend_php_package_others.html","title":"ğŸ“– ï¸ãã®ä»–ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸","keywords":"","body":"ãã®ä»–ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ ã¯ã˜ã‚ã« æœ¬ã‚µã‚¤ãƒˆã«ã¤ãã¾ã—ã¦ï¼Œä»¥ä¸‹ã‚’ã”èªè­˜ã®ã»ã©å®œã—ããŠé¡˜ã„ã„ãŸã—ã¾ã™ï¼ å‚è€ƒï¼šhttps://hiroki-it.github.io/tech-notebook-gitbook/ 01. Carbonãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ Dateå‹ å³å¯†ã«ã¯ãƒ‡ãƒ¼ã‚¿å‹ã§ã¯ãªã„ãŒï¼Œä¾¿å®œä¸Šï¼Œãƒ‡ãƒ¼ã‚¿å‹ã¨ã™ã‚‹ï¼ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—ã¨ã¯ï¼Œå”å®šä¸–ç•Œæ™‚(UTC)ã‚’åŸºæº–ã«ã—ãŸ1970å¹´1æœˆ1æ—¥ã®0æ™‚0åˆ†0ç§’ã‹ã‚‰ã®çµŒéç§’æ•°ã‚’è¡¨ã—ãŸã‚‚ã®ï¼ ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ å®Ÿè£…æ–¹æ³• å‚™è€ƒ æ—¥ä»˜ 2019-07-07 åŒºåˆ‡ã‚Šè¨˜å·ãªã—ã€ãƒ‰ãƒƒãƒˆã€ã‚¹ãƒ©ãƒƒã‚·ãƒ¥ãªã©ã‚‚å¯èƒ½ æ™‚é–“ 19:07:07 åŒºåˆ‡ã‚Šè¨˜å·ãªã—ã€ã‚‚å¯èƒ½ æ—¥æ™‚ 2019-07-07 19:07:07 åŒä¸Š ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—ï¼ˆç§’ï¼‰ 1562494027 1970å¹´1æœˆ1æ—¥ã®0æ™‚0åˆ†0ç§’ã‹ã‚‰2019-07-07 19:07:07 ã¾ã§ã®çµŒéç§’æ•° instanceãƒ¡ã‚½ãƒƒãƒ‰ DateTimeã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’å¼•æ•°ã¨ã—ã¦ï¼ŒCarbonã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’ä½œæˆã™ã‚‹ï¼ createãƒ¡ã‚½ãƒƒãƒ‰ æ—¥æ™‚ã®æ–‡å­—åˆ—ã‹ã‚‰Carbonã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’ä½œæˆã™ã‚‹ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š createFromXXXãƒ¡ã‚½ãƒƒãƒ‰ æŒ‡å®šã®æ–‡å­—åˆ—ã‹ã‚‰ï¼ŒCarbonã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’ä½œæˆã™ã‚‹ï¼ ãƒ»æ—¥æ™‚æ•°å­—ã‹ã‚‰ ï¼Šå®Ÿè£…ä¾‹ï¼Š ãƒ»æ™‚é–“æ•°å­—ã‹ã‚‰ ï¼Šå®Ÿè£…ä¾‹ï¼Š ãƒ»æ—¥ä»˜ï¼Œæ™‚é–“ï¼Œæ—¥æ™‚ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã‹ã‚‰ ç¬¬ä¸€å¼•æ•°ã§ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã‚’æŒ‡å®šã™ã‚‹å¿…è¦ãŒã‚ã‚‹ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š ãƒ»ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã‹ã‚‰ ï¼Šå®Ÿè£…ä¾‹ï¼Š parseãƒ¡ã‚½ãƒƒãƒ‰ æ—¥ä»˜ï¼Œæ™‚é–“ï¼Œæ—¥æ™‚ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã‹ã‚‰ï¼ŒCarbonã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’ä½œæˆã™ã‚‹ï¼createFromFormatãƒ¡ã‚½ãƒƒãƒ‰ã¨ã¯ç•°ãªã‚Šï¼Œãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã‚’æŒ‡å®šã™ã‚‹å¿…è¦ãŒãªã„ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š 02. Pinqãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ Pinqã¨ã¯ï¼šPhp Integrated Query é…åˆ—ãƒ‡ãƒ¼ã‚¿ã‚„ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆãƒ‡ãƒ¼ã‚¿ã«å¯¾ã—ã¦ï¼Œã‚¯ã‚¨ãƒªã‚’å®Ÿè¡Œã§ãã‚‹ã‚ˆã†ã«ãªã‚‹ï¼ä»–ã®åŒæ§˜ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã¨ã—ã¦ï¼ŒLinqãŒã‚ã‚‹ï¼ Traversable::fromãƒ¡ã‚½ãƒƒãƒ‰ SQLã®SELECTã‚„WHEREã¨ã„ã£ãŸå˜èªã‚’ç”¨ã„ã¦ï¼Œforeachã®ã‚ˆã†ã«ï¼Œé…åˆ—ãƒ‡ãƒ¼ã‚¿ã‚„ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆãƒ‡ãƒ¼ã‚¿ã®å„è¦ç´ ã«å¯¾ã—ã¦ï¼Œå‡¦ç†ã‚’è¡Œãˆã‚‹ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š Traversable::from($entities) // ä¸€ã¤ãšã¤è¦ç´ ã‚’å–ã‚Šå‡ºã—ï¼Œé–¢æ•°ã«æ¸¡ã™ï¼ ->select( function ($entity) { return $this->convertToArray($entity); }) // indexã‹ã‚‰ãªã‚‹é…åˆ—ã¨ã—ã¦è¿”å´ï¼ ->asArray(), ]; } } 03. Guzzleãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ Guzzleãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã¨ã¯ é€šå¸¸ï¼Œãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®é€å—ä¿¡ã¯ï¼Œã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‹ã‚‰ã‚µãƒ¼ãƒã«å¯¾ã—ã¦ï¼ŒPostmanã‚„curlé–¢æ•°ãªã©ã‚’ä½¿ç”¨ã—ã¦è¡Œã†ï¼ã—ã‹ã—ï¼ŒGuzzleãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®Clientã‚’ä½¿ãˆã°ï¼Œã‚µãƒ¼ãƒã‹ã‚‰ä»–ã‚µãƒ¼ãƒï¼ˆå¤–éƒ¨ã®APIãªã©ï¼‰ã«å¯¾ã—ã¦ï¼Œãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®é€å—ä¿¡ãŒã§ãã‚‹ï¼ ãƒªã‚¯ã‚¨ã‚¹ãƒˆ ãƒ»GETé€ä¿¡ å‚è€ƒï¼šhttps://docs.guzzlephp.org/en/stable/quickstart.html#query-string-parameters ï¼Šå®Ÿè£…ä¾‹ï¼Š request( \"GET\", \"https://xxxxxxxx\", [ \"query\" => [ \"id\" => 1 ] ] ); ãƒ»POSTé€ä¿¡ å‚è€ƒï¼šhttps://docs.guzzlephp.org/en/stable/quickstart.html#post-form-requests \"Hello World!\" ]); // POSTé€ä¿¡ $response = $client->request( \"POST\", \"https://xxxxxxxx\", [ \"headers\" => [ \"Authorization\" => $this->token, \"Content-Length\" => strlen($json), \"Content-Type\" => \"application/json\", ], \"form_params\" => [ \"body\" => $message ] ] ); ãƒ¬ã‚¹ãƒãƒ³ã‚¹ ãƒ»ãƒ¬ã‚¹ãƒãƒ³ã‚¹ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‹ã‚‰ãƒœãƒ‡ã‚£ã‚’å–å¾— ï¼Šå®Ÿè£…ä¾‹ï¼Š \"Hello World!\" ]); // POSTé€ä¿¡ $response = $client->request( \"POST\", \"https://xxxxxxxx\", [ \"headers\" => [ \"Authorization\" => $this->token, \"Content-Length\" => strlen($json), \"Content-Type\" => \"application/json\", ], \"form_params\" => [ \"body\" => $message ] ] ); $body = json_decode($response->getBody(), true); 04. Knp/Snappyãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ Knp/Snappyã¨ã¯ ãƒ­ãƒ¼ã‚«ãƒ«ã¾ãŸã¯æŒ‡å®šã—ãŸURLã®htmlãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰ï¼ŒPDFã‚„ç”»åƒã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç”Ÿæˆã™ã‚‹ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ï¼ ãƒ»generateFromHtmlãƒ¡ã‚½ãƒƒãƒ‰ htmlãƒ•ã‚¡ã‚¤ãƒ«ã‚’å…ƒã«ã—ã¦ï¼Œãƒ­ãƒ¼ã‚«ãƒ«ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«PDFãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã™ã‚‹ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š generateFromHtml(\"foo.html\", \".../foo.pdf\"); 05. Respect/Validationãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ Respect/Validationã¨ã¯ ãƒªã‚¯ã‚¨ã‚¹ãƒˆã•ã‚ŒãŸãƒ‡ãƒ¼ã‚¿ãŒæ­£ã—ã„ã‹ã‚’ï¼Œã‚µãƒ¼ãƒã‚µã‚¤ãƒ‰å´ã§æ¤œè¨¼ã™ã‚‹ï¼ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã‹ã‚‰ãƒªã‚¯ã‚¨ã‚¹ãƒˆã•ã‚Œã‚‹ãƒ‡ãƒ¼ã‚¿ã«é–¢ã—ã¦ã¯ï¼ŒJavaScriptã¨PHPã®ä¸¡æ–¹ã«ã‚ˆã‚‹ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ãŒå¿…è¦ã§ã‚ã‚‹ï¼ "},"public/software/software_application_backend_php_testing.html":{"url":"public/software/software_application_backend_php_testing.html","title":"ğŸ“– ï¸ãƒ†ã‚¹ãƒˆ","keywords":"","body":"ãƒ†ã‚¹ãƒˆ ã¯ã˜ã‚ã« æœ¬ã‚µã‚¤ãƒˆã«ã¤ãã¾ã—ã¦ï¼Œä»¥ä¸‹ã‚’ã”èªè­˜ã®ã»ã©å®œã—ããŠé¡˜ã„ã„ãŸã—ã¾ã™ï¼ å‚è€ƒï¼šhttps://hiroki-it.github.io/tech-notebook-gitbook/ 01. ã‚³ãƒ¼ãƒ‰ãƒ™ãƒ¼ã‚¹ã®ãƒ†ã‚¹ãƒˆ ãƒ†ã‚¹ãƒˆæ‰‹é † ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã‚’æ•´å½¢ã™ã‚‹ï¼ ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã®é™çš„è§£æã‚’è¡Œã†ï¼ ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆã¨æ©Ÿèƒ½ãƒ†ã‚¹ãƒˆã‚’è¡Œã†ï¼ æ•´å½¢ãƒ„ãƒ¼ãƒ« PhpStormï¼ŒPHP-CS-Fixer é™çš„è§£æãƒ„ãƒ¼ãƒ« PhpStormï¼ŒPHPStanï¼ŒLarastan ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆãƒ„ãƒ¼ãƒ«ï¼Œæ©Ÿèƒ½ãƒ†ã‚¹ãƒˆãƒ„ãƒ¼ãƒ« PHPUnit 02. ãƒ†ã‚¹ãƒˆä»•æ§˜æ›¸ãƒ™ãƒ¼ã‚¹ã®ãƒ†ã‚¹ãƒˆ ãƒ†ã‚¹ãƒˆæ‰‹é † ãƒ†ã‚¹ãƒˆä»•æ§˜æ›¸ã«åŸºã¥ãï¼Œãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆï¼ŒIntegrationãƒ†ã‚¹ãƒˆï¼ŒUser Acceptanceãƒ†ã‚¹ãƒˆã‚’è¡Œã†ï¼ ã‚°ãƒ©ãƒ•ã«ã‚ˆã‚‹ãƒ†ã‚¹ãƒˆã®å¯è¦–åŒ– "},"public/software/software_application_backend_php_testing_based_on_code.html":{"url":"public/software/software_application_backend_php_testing_based_on_code.html","title":"ğŸ“– ï¸ã‚³ãƒ¼ãƒ‰ãƒ™ãƒ¼ã‚¹ã®ãƒ†ã‚¹ãƒˆ","keywords":"","body":"ã‚³ãƒ¼ãƒ‰ãƒ™ãƒ¼ã‚¹ã®ãƒ†ã‚¹ãƒˆ ã¯ã˜ã‚ã« æœ¬ã‚µã‚¤ãƒˆã«ã¤ãã¾ã—ã¦ï¼Œä»¥ä¸‹ã‚’ã”èªè­˜ã®ã»ã©å®œã—ããŠé¡˜ã„ã„ãŸã—ã¾ã™ï¼ å‚è€ƒï¼šhttps://hiroki-it.github.io/tech-notebook-gitbook/ 01. ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆï¼æ©Ÿèƒ½ãƒ†ã‚¹ãƒˆã®è¦ç´  æ§‹æˆå›³ å„ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ï¼ˆãƒ†ã‚¹ãƒˆé–¢æ•°ï¼‰ã¯ãƒ†ã‚¹ãƒˆã‚¹ã‚¤ãƒ¼ãƒˆï¼ˆãƒ†ã‚¹ãƒˆã®çµ„ï¼‰ã‹ã‚‰æ§‹æˆã•ã‚Œï¼Œå…¨ã¦ã¯ãƒ†ã‚¹ãƒˆãƒ—ãƒ©ãƒ³ã§ã¾ã¨ã‚ã‚‰ã‚Œã‚‹ï¼ 02-02. PHPUnitã«ã‚ˆã‚‹ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆï¼æ©Ÿèƒ½ãƒ†ã‚¹ãƒˆ ã‚³ãƒãƒ³ãƒ‰ ãƒ»ã‚ªãƒ—ã‚·ãƒ§ãƒ³ç„¡ã— å…¨ã¦ã®ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã‚’å¯¾è±¡ã¨ã—ã¦ï¼Œå®šç¾©ã•ã‚ŒãŸãƒ¡ã‚½ãƒƒãƒ‰ã‚’å®Ÿè¡Œã™ã‚‹ï¼ $ vendor/bin/phpunit PHPUnit 9.5.0 by Sebastian Bergmann and contributors. ... 3 / 3 (100%) Time: 621 ms, Memory: 24.00 MB OK (3 tests, 3 assertions) ãƒ»--filter ç‰¹å®šã®ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã‚’å¯¾è±¡ã¨ã—ã¦ï¼Œå®šç¾©ã•ã‚ŒãŸãƒ¡ã‚½ãƒƒãƒ‰ã‚’å®Ÿè¡Œã™ã‚‹ï¼ $ vendor/bin/phpunit --filter Foo PHPUnit 9.5.0 by Sebastian Bergmann and contributors. ... 1 / 1 (100%) Time: 207 ms, Memory: 8.00 MB OK (1 tests, 1 assertions) ãƒ»--list-tests å®Ÿè¡Œã®å¯¾è±¡ã¨ãªã‚‹ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä¸€è¦§ã§è¡¨ç¤ºã™ã‚‹ï¼ $ vendor/bin/phpunit --list-tests PHPUnit 9.5.0 by Sebastian Bergmann and contributors. Available test(s): - Tests\\Unit\\FooTest::testFooMethod - Tests\\Feature\\FooTest::testFooMethod phpunit.xmlãƒ•ã‚¡ã‚¤ãƒ« ãƒ»phpunit.xmlãƒ•ã‚¡ã‚¤ãƒ«ã¨ã¯ PHPUnitã®è¨­å®šã‚’è¡Œã†ï¼æ¨™æº–ã®è¨­å®šã§ã¯ï¼Œã‚ã‚‰ã‹ã˜ã‚ãƒ«ãƒ¼ãƒˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«testsãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’é…ç½®ã—ï¼Œã“ã‚Œã‚’Unitsãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã¾ãŸã¯Featureãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«åˆ†å‰²ã—ã¦ãŠãï¼ã¾ãŸï¼ŒTestã§çµ‚ã‚ã‚‹phpãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã—ã¦ãŠãå¿…è¦ãŒã‚ã‚‹ï¼ å‚è€ƒï¼šhttp://phpunit.readthedocs.io/ja/latest/configuration.html ãƒ»testsuitesã‚¿ã‚° ãƒ†ã‚¹ãƒˆã‚¹ã‚¤ãƒ¼ãƒˆã‚’å®šç¾©ã§ãã‚‹ï¼testsuitesã‚¿ã‚°å†…ã®testsuitesã‚¿ã‚°ã‚’è¿½åŠ å¤‰æ›´ã™ã‚‹ã¨ï¼Œæ¤œè¨¼å¯¾è±¡ã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’å¢—ã‚„ã—ï¼Œã¾ãŸå¯¾è±¡ã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªåã‚’å¤‰æ›´ã§ãã‚‹ï¼ å‚è€ƒï¼šhttps://phpunit.readthedocs.io/ja/latest/configuration.html#appendixes-configuration-testsuites ... ./tests/Unit ./tests/Feature ... ãƒ»phpã‚¿ã‚° PHPUnitã®å®Ÿè¡Œå‰ã«è¨­å®šã™ã‚‹ini_seté–¢æ•°ï¼Œdefineé–¢æ•°ï¼Œã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°ï¼Œã‚’å®šç¾©ã§ãã‚‹ï¼ã‚¿ã‚°åã¨ã®å¯¾å¿œé–¢ä¿‚ã«ã¤ã„ã¦ã¯ï¼Œä»¥ä¸‹ã‚’å‚è€ƒã«ã›ã‚ˆï¼ å‚è€ƒï¼šhttps://phpunit.readthedocs.io/ja/latest/configuration.html#php-ini ï¼Šå®Ÿè£…ä¾‹ï¼Š composerã®å®Ÿè¡Œæ™‚ã«ãƒ¡ãƒ¢ãƒªä¸è¶³ã«ãªã‚‰ãªã„ã‚ˆã†ã«ãƒ¡ãƒ¢ãƒªã‚’æ‹¡å¼µã™ã‚‹ï¼ã¾ãŸï¼Œãƒ†ã‚¹ãƒˆç”¨ã®ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã«æ¥ç¶šã§ãã‚‹ã‚ˆã†ï¼Œãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã«é–¢ã™ã‚‹ç’°å¢ƒå¤‰æ•°ã‚’è¨­å®šã™ã‚‹ï¼ ... --> ... ã‚¢ã‚µãƒ¼ã‚·ãƒ§ãƒ³ãƒ¡ã‚½ãƒƒãƒ‰ ãƒ»ã‚¢ã‚µãƒ¼ã‚·ãƒ§ãƒ³ãƒ¡ã‚½ãƒƒãƒ‰ã¨ã¯ å®Ÿéš›ã®å€¤ã¨æœŸå¾…å€¤ã‚’æ¯”è¼ƒã—ï¼Œçµæœã«å¿œã˜ã¦SUCCESSã¾ãŸã¯FAILURESã‚’è¿”å´ã™ã‚‹ï¼éstaticã¾ãŸã¯staticã¨ã—ã¦ã‚³ãƒ¼ãƒ«ã§ãã‚‹ï¼ å‚è€ƒï¼šhttps://phpunit.readthedocs.io/ja/latest/assertions.html $this->assertTrue(); self::assertTrue() ãƒ»assertTrue å®Ÿéš›å€¤ãŒtrueã‹ã©ã†ã‹ã‚’æ¤œè¨¼ã™ã‚‹ï¼ $this->assertTrue($response->isOk()); ãƒ»assertEquals ã€Œ==ã€ã‚’ä½¿ç”¨ã—ã¦ï¼ŒæœŸå¾…å€¤ã¨å®Ÿéš›å€¤ã®æ•´åˆæ€§ã‚’æ¤œè¨¼ã™ã‚‹ï¼ãƒ‡ãƒ¼ã‚¿å‹ã‚’æ¤œè¨¼ã§ããªã„ãŸã‚ï¼ŒassertSameãƒ¡ã‚½ãƒƒãƒ‰ã‚’ä½¿ç”¨ã™ã‚‹æ–¹ãŒè‰¯ã„ï¼ $this->assertSame(200, $response->getStatusCode()); ãƒ»assertSame ã€Œ===ã€ã‚’ä½¿ç”¨ã—ã¦ï¼ŒæœŸå¾…å€¤ã¨å®Ÿéš›å€¤ã®æ•´åˆæ€§ã‚’æ¤œè¨¼ã™ã‚‹ï¼å€¤ã ã‘ã§ãªãï¼Œãƒ‡ãƒ¼ã‚¿å‹ã‚‚æ¤œè¨¼ã§ãã‚‹ï¼ $this->assertSame(200, $response->getStatusCode()); ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆ ãƒ»ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆã¨ã¯ ã‚¯ãƒ©ã‚¹ã®ãƒ¡ã‚½ãƒƒãƒ‰ãŒï¼Œãã‚Œå˜ä½“ã§ä»•æ§˜é€šã‚Šã«å‡¦ç†ãŒå‹•ä½œã™ã‚‹ã‹ã‚’æ¤œè¨¼ã™ã‚‹æ–¹æ³•ï¼æ¤œè¨¼å¯¾è±¡ä»¥å¤–ã®å‡¦ç†ã¯ã‚¹ã‚¿ãƒ–ã¨ã—ã¦å®šç¾©ã™ã‚‹ï¼ç†æƒ³ã¨ã—ã¦ã¯ï¼Œã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã®å±¤ã”ã¨ã«ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆã‚’è¡Œã†å¿…è¦ãŒã‚ã‚‹ï¼ã“ã®æ™‚ï¼Œãƒ‡ãƒ¼ã‚¿ã‚¢ã‚¯ã‚»ã‚¹ã«é–¢ã‚ã‚‹å±¤ã®ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆã®ãŸã‚ã«ï¼Œæœ¬æ¥ã®DBã¨ã¯åˆ¥ã«ï¼Œã‚ã‚‰ã‹ã˜ã‚ãƒ†ã‚¹ãƒˆç”¨DBã‚’ç”¨æ„ã—ãŸæ–¹ãŒè‰¯ã„ï¼ãƒ†ã‚¹ãƒˆç”¨DBã‚’docker-compose.ymlãƒ•ã‚¡ã‚¤ãƒ«ã«ã‚ˆã£ã¦ç”¨æ„ã™ã‚‹æ–¹æ³•ã«ã¤ã„ã¦ã¯ï¼Œä»¥ä¸‹ã‚’å‚è€ƒã«ã›ã‚ˆï¼ å‚è€ƒï¼šhttps://hiroki-it.github.io/tech-notebook-gitbook/public/virtualization/virtualization_container_orchestration.html ï¼Šå®Ÿè£…ä¾‹ï¼Š ä»¥é™ã®ãƒ†ã‚¹ãƒˆä¾‹ã§ã¯ï¼Œæ¬¡ã®ã‚ˆã†ãªé€šçŸ¥ã‚¯ãƒ©ã‚¹ã¨ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚¯ãƒ©ã‚¹ãŒå‰æã«ã‚ã‚‹ã¨ã™ã‚‹ï¼ httpClient = $httpClient; $this->token = $token; $this->logger = $logger; } public function sendMessage(FooMessage $fooMessage) { if (empty($this->token)) { throw new CouldNotSendMessageException(\"API requests is required.\"); } if (empty($fooMessage->channel_id)) { throw new CouldNotSendMessageException(\"Channnel ID is required.\"); } $json = json_encode($fooMessage->message); try { $this->httpClient->request( \"POST\", \"https://xxxxxxxx\", [ \"headers\" => [ \"Authorization\" => $this->token, \"Content-Length\" => strlen($json), \"Content-Type\" => \"application/json\", ], \"form_params\" => [ \"body\" => $fooMessage->message ] ] ); } catch (ClientException $exception) { $this->logger->error(sprintf( \"ERROR: %s at %s line %s\", $exception->getMessage(), $exception->getFile(), $exception->getLine() )); throw new CouldNotSendMessageException($exception->getMessage()); } catch (\\Exception $exception) { $this->logger->error(sprintf( \"ERROR: %s at %s line %s\", $exception->getMessage(), $exception->getFile(), $exception->getLine() )); throw new CouldNotSendMessageException($exception->getMessage()); } return true; } } channel_id = $channel_id; $this->message = $message; } } ãƒ»æ­£å¸¸ç³»ãƒ†ã‚¹ãƒˆä¾‹ ãƒ¡ã‚½ãƒƒãƒ‰ã®ã‚¢ãƒãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ã§ï¼Œ@testã‚’å®£è¨€ã™ã‚‹ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š ãƒªã‚¯ã‚¨ã‚¹ãƒˆã«ã¦ï¼Œãƒãƒ£ãƒ³ãƒãƒ«ã¨ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’é€ä¿¡ã—ãŸæ™‚ã«ï¼Œãƒ¬ã‚¹ãƒãƒ³ã‚¹ã¨ã—ã¦TRUEãŒè¿”ä¿¡ã•ã‚Œã‚‹ã‹ã‚’æ¤œè¨¼ã™ã‚‹ï¼ client = \\Phake::mock(Client::class); $this->logger = \\Phake::mock(LoggerInterface::class); } /** * @test */ public function testSendMessage_FooMessage_ReturnTrue() { $fooNotification = new FooNotification( $this->client, \"xxxxxxx\", $this->logger ); $fooMessage = new FooMessage(\"test\", \"X-CHANNEL\"); $this->assertTrue( $fooNotification->sendMessage($fooMessage) ); } } # Time: x seconds # OK ãƒ»ç•°å¸¸ç³»ãƒ†ã‚¹ãƒˆä¾‹ ãƒ¡ã‚½ãƒƒãƒ‰ã®ã‚¢ãƒãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ã§ï¼Œ@testã¨@expectedExceptionã‚’å®£è¨€ã™ã‚‹ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š ãƒªã‚¯ã‚¨ã‚¹ãƒˆã«ã¦ï¼Œãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®ã¿ã‚’é€ä¿¡ã—ã‚ˆã†ã¨ã—ãŸæ™‚ã«ï¼Œä¾‹å¤–ã‚’ç™ºç”Ÿã•ã›ã‚‰ã‚Œã‚‹ã‹ã‚’æ¤œè¨¼ã™ã‚‹ï¼ client = \\Phake::mock(Client::class); $this->logger = \\Phake::mock(LoggerInterface::class); } /** * @test * @expectedException */ public function testSendMessage_EmptyMessage_ExceptionThrown() { $fooNotification = new FooNotification( $this->client, \"xxxxxxx\", $this->logger ); $fooMessage = new FooMessage(\"test\", \"\"); $fooNotification->sendMessage($fooMessage); } } # Time: x seconds # OK æ©Ÿèƒ½ãƒ†ã‚¹ãƒˆ ãƒ»æ©Ÿèƒ½ãƒ†ã‚¹ãƒˆã¨ã¯ ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã«ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é€ä¿¡ã—ï¼Œãƒ¬ã‚¹ãƒãƒ³ã‚¹ãŒæ­£ã—ãè¿”ä¿¡ã•ã‚Œã‚‹ã‹ã©ã†ã‹ã‚’æ¤œè¨¼ã™ã‚‹æ–¹æ³•ï¼ã‚¹ã‚¿ãƒ–ã‚’ä½¿ç”¨ã™ã‚‹ã“ã¨ã¯å°‘ãªã„ï¼ãƒ¡ã‚½ãƒƒãƒ‰ã®ã‚¢ãƒãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ã§ï¼Œ@testã‚’å®£è¨€ã™ã‚‹å¿…è¦ãŒã‚ã‚‹ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š request( \"GET\", \"https://xxxxxxxx\", [ \"query\" => [ \"id\" => 1 ] ] ); // ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã®å®Ÿéš›å€¤ã¨æœŸå¾…å€¤ã®æ•´åˆæ€§ã‚’æ¤œè¨¼ã™ã‚‹ï¼ } } ãƒ»ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ä¾‹ HTTPãƒ¡ã‚½ãƒƒãƒ‰ åˆ†é¡ ãƒ‡ãƒ¼ã‚¿ã®æ¡ä»¶ assertãƒ¡ã‚½ãƒƒãƒ‰ã®æ¤œè¨¼å†…å®¹ä¾‹ POSTï¼ŒPUT æ­£å¸¸ç³» ãƒªã‚¯ã‚¨ã‚¹ãƒˆã®ãƒœãƒ‡ã‚£ã«ã¦ï¼Œå¿…é ˆãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã«ãƒ‡ãƒ¼ã‚¿ãŒå‰²ã‚Šå½“ã¦ã‚‰ã‚Œã¦ã„ã‚‹å ´åˆï¼ ãƒ»ControllerãŒ200ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã®ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’è¿”ä¿¡ã™ã‚‹ã“ã¨ï¼ãƒ»æ›´æ–°ã•ã‚ŒãŸãƒ‡ãƒ¼ã‚¿ã®IDãŒæœŸå¾…é€šã‚Šã§ã‚ã‚‹ã“ã¨ï¼ãƒ»ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã•ã‚ŒãŸãƒ‡ãƒ¼ã‚¿ãŒæœŸå¾…é€šã‚Šã§ã‚ã‚‹ã“ã¨ï¼ ãƒªã‚¯ã‚¨ã‚¹ãƒˆã®ãƒœãƒ‡ã‚£ã«ã¦ï¼Œä»»æ„ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã«ãƒ‡ãƒ¼ã‚¿ãŒå‰²ã‚Šå½“ã¦ã‚‰ã‚Œã¦ã„ãªã„å ´åˆï¼ ãƒ»ControllerãŒ200ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã®ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’è¿”ä¿¡ã™ã‚‹ã“ã¨ï¼ãƒ»æ›´æ–°ã•ã‚ŒãŸãƒ‡ãƒ¼ã‚¿ã®IDãŒæœŸå¾…é€šã‚Šã§ã‚ã‚‹ã“ã¨ï¼ãƒ»ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã•ã‚ŒãŸãƒ‡ãƒ¼ã‚¿ãŒæœŸå¾…é€šã‚Šã§ã‚ã‚‹ã“ã¨ï¼ ãƒªã‚¯ã‚¨ã‚¹ãƒˆã®ãƒœãƒ‡ã‚£ã«ã¦ï¼Œç©ºæ–‡å­—ã‚„nullãŒè¨±å¯ã•ã‚ŒãŸãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã«ï¼Œãƒ‡ãƒ¼ã‚¿ãŒå‰²ã‚Šå½“ã¦ã‚‰ã‚Œã¦ã„ãªã„å ´åˆï¼ ãƒ»ControllerãŒ200ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã®ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’è¿”ä¿¡ã™ã‚‹ã“ã¨ï¼ãƒ»æ›´æ–°ã•ã‚ŒãŸãƒ‡ãƒ¼ã‚¿ã®IDãŒæœŸå¾…é€šã‚Šã§ã‚ã‚‹ã“ã¨ï¼ãƒ»ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã•ã‚ŒãŸãƒ‡ãƒ¼ã‚¿ãŒæœŸå¾…é€šã‚Šã§ã‚ã‚‹ã“ã¨ï¼ ç•°å¸¸ç³» ãƒªã‚¯ã‚¨ã‚¹ãƒˆã®ãƒœãƒ‡ã‚£ã«ã¦ï¼Œå¿…é ˆãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã«ãƒ‡ãƒ¼ã‚¿ãŒå‰²ã‚Šå½“ã¦ã‚‰ã‚Œã¦ã„ãªã„å ´åˆï¼ ãƒ»ControllerãŒ400ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã®ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’è¿”ä¿¡ã™ã‚‹ã“ã¨ï¼ãƒ»ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã•ã‚ŒãŸãƒ‡ãƒ¼ã‚¿ãŒæœŸå¾…é€šã‚Šã§ã‚ã‚‹ã“ã¨ï¼ ãƒªã‚¯ã‚¨ã‚¹ãƒˆã®ãƒœãƒ‡ã‚£ã«ã¦ï¼Œç©ºæ–‡å­—ã‚„nullãŒè¨±å¯ã•ã‚ŒãŸãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã«ï¼Œç©ºæ–‡å­—ã‚„nullãŒå‰²ã‚Šå½“ã¦ã‚‰ã‚Œã¦ã„ã‚‹å ´åˆï¼ ãƒ»ControllerãŒ400ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã®ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’è¿”ä¿¡ã™ã‚‹ã“ã¨ï¼ãƒ»ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã•ã‚ŒãŸãƒ‡ãƒ¼ã‚¿ãŒæœŸå¾…é€šã‚Šã§ã‚ã‚‹ã“ã¨ï¼ ãƒªã‚¯ã‚¨ã‚¹ãƒˆã®ãƒœãƒ‡ã‚£ã«ã¦ï¼Œãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã®ãƒ‡ãƒ¼ã‚¿å‹ãŒèª¤ã£ã¦ã„ã‚‹å ´åˆï¼ ãƒ»ControllerãŒ400ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã®ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’è¿”ä¿¡ã™ã‚‹ã“ã¨ï¼ãƒ»ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã•ã‚ŒãŸãƒ‡ãƒ¼ã‚¿ãŒæœŸå¾…é€šã‚Šã§ã‚ã‚‹ã“ã¨ï¼ GET æ­£å¸¸ç³» ãƒªã‚¯ã‚¨ã‚¹ãƒˆã«ã¦ï¼Œãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã«ãƒ‡ãƒ¼ã‚¿ãŒå‰²ã‚Šå½“ã¦ã‚‰ã‚Œã¦ã„ã‚‹å ´åˆï¼ ControllerãŒ200ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã®ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’è¿”ä¿¡ã™ã‚‹ã“ã¨ï¼ ç•°å¸¸ç³» ãƒªã‚¯ã‚¨ã‚¹ãƒˆã®ãƒœãƒ‡ã‚£ã«ã¦ï¼Œãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã«å‚ç…§ç¦æ­¢ã®ãƒ‡ãƒ¼ã‚¿ãŒå‰²ã‚Šå½“ã¦ã‚‰ã‚Œã¦ã„ã‚‹å ´åˆï¼ˆèªå¯ã®å¤±æ•—ï¼‰ï¼ ControllerãŒ403ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã®ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’è¿”ä¿¡ã™ã‚‹ã“ã¨ï¼ DELETE æ­£å¸¸ç³» ãƒªã‚¯ã‚¨ã‚¹ãƒˆã®ãƒœãƒ‡ã‚£ã«ã¦ï¼Œãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã«ãƒ‡ãƒ¼ã‚¿ãŒå‰²ã‚Šå½“ã¦ã‚‰ã‚Œã¦ã„ã‚‹å ´åˆï¼ ãƒ»ControllerãŒ200ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã®ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’è¿”ä¿¡ã™ã‚‹ã“ã¨ï¼ãƒ»å‰Šé™¤ã•ã‚ŒãŸãƒ‡ãƒ¼ã‚¿ã®IDãŒæœŸå¾…é€šã‚Šã§ã‚ã‚‹ã“ã¨ï¼ãƒ»ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã•ã‚ŒãŸãƒ‡ãƒ¼ã‚¿ãŒæœŸå¾…é€šã‚Šã§ã‚ã‚‹ã“ã¨ï¼ ç•°å¸¸ç³» ãƒªã‚¯ã‚¨ã‚¹ãƒˆã®ãƒœãƒ‡ã‚£ã«ã¦ï¼Œãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã«å‰Šé™¤ç¦æ­¢ã®ãƒ‡ãƒ¼ã‚¿ãŒå‰²ã‚Šå½“ã¦ã‚‰ã‚Œã¦ã„ã‚‹å ´åˆï¼ˆèªå¯ã®å¤±æ•—ï¼‰ï¼ ãƒ»ControllerãŒ400ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã®ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’è¿”ä¿¡ã™ã‚‹ã“ã¨ï¼ãƒ»ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã•ã‚ŒãŸãƒ‡ãƒ¼ã‚¿ãŒæœŸå¾…é€šã‚Šã§ã‚ã‚‹ã“ã¨ï¼ èªè¨¼èªå¯ æ­£å¸¸ç³» ãƒªã‚¯ã‚¨ã‚¹ãƒˆã®ãƒ˜ãƒƒãƒ€ãƒ¼ã«ã¦ï¼Œèªè¨¼ã•ã‚Œã¦ã„ã‚‹ãƒˆãƒ¼ã‚¯ãƒ³ãŒå‰²ã‚Šå½“ã¦ã‚‰ã‚Œã¦ã„ã‚‹å ´åˆï¼ˆèªè¨¼ã®æˆåŠŸï¼‰ï¼ ControllerãŒ200ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã®ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’è¿”ä¿¡ã™ã‚‹ã“ã¨ï¼ ç•°å¸¸ç³» ãƒªã‚¯ã‚¨ã‚¹ãƒˆã®ãƒ˜ãƒƒãƒ€ãƒ¼ã«ã¦ï¼Œèªè¨¼ã•ã‚Œã¦ã„ãªã„ãƒˆãƒ¼ã‚¯ãƒ³ãŒå‰²ã‚Šå½“ã¦ã‚‰ã‚Œã¦ã„ã‚‹å ´åˆï¼ˆèªè¨¼ã®å¤±æ•—ï¼‰ï¼ ControllerãŒ401ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã®ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’è¿”ä¿¡ã™ã‚‹ã“ã¨ï¼ ãƒªã‚¯ã‚¨ã‚¹ãƒˆã®ãƒœãƒ‡ã‚£ã«ã¦ï¼Œãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã«ã‚¢ã‚¯ã‚»ã‚¹ç¦æ­¢ã®ãƒ‡ãƒ¼ã‚¿ãŒå‰²ã‚Šå½“ã¦ã‚‰ã‚Œã¦ã„ã‚‹å ´åˆï¼ˆèªå¯ã®å¤±æ•—ï¼‰ï¼ ControllerãŒ403ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã®ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’è¿”ä¿¡ã™ã‚‹ã“ã¨ï¼ ãƒ»æ­£å¸¸ç³»GET ControllerãŒ200ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã®ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’è¿”ä¿¡ã™ã‚‹ã“ã¨ã‚’æ¤œè¨¼ã™ã‚‹ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š request( \"GET\", \"/xxx/yyy/\" ); $response = $client->getResponse(); // 200ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãŒè¿”å´ã•ã‚Œã‚‹ã‹ã‚’æ¤œè¨¼ã™ã‚‹ï¼ $this->assertSame(200, $response->getStatusCode()); } } ãƒ»æ­£å¸¸ç³»POST ControllerãŒ200ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã®ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’è¿”ä¿¡ã™ã‚‹ã“ã¨ï¼Œæ›´æ–°ã•ã‚ŒãŸãƒ‡ãƒ¼ã‚¿ã®IDãŒæœŸå¾…é€šã‚Šã§ã‚ã‚‹ã“ã¨ï¼Œãƒ¬ã‚¹ãƒãƒ³ã‚¹ã•ã‚ŒãŸãƒ‡ãƒ¼ã‚¿ãŒæœŸå¾…é€šã‚Šã§ã‚ã‚‹ã“ã¨ã‚’æ¤œè¨¼ã™ã‚‹ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š request( \"POST\", \"/xxx/yyy/\", [ \"id\" => 1, \"message\" => \"Hello World!\" ], [ \"HTTP_X_API_Token\" => \"Bearer xxxxxx\" ] ); $response = $client->getResponse(); // 200ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãŒè¿”å´ã•ã‚Œã‚‹ã‹ã‚’æ¤œè¨¼ã™ã‚‹ï¼ $this->assertSame(200, $response->getStatusCode()); // ãƒ¬ã‚¹ãƒãƒ³ã‚¹ãƒ‡ãƒ¼ã‚¿ã‚’æŠ½å‡ºã™ã‚‹ï¼ $actual = json_decode($response->getContent(), true); // æ›´æ–°ã•ã‚ŒãŸãƒ‡ãƒ¼ã‚¿ã®IDãŒæ­£ã—ã„ã‹ã‚’æ¤œè¨¼ã™ã‚‹ï¼ $this->assertSame(1, $actual[\"id\"]); // ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã•ã‚ŒãŸãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒæ­£ã—ã„ã‹ã‚’æ¤œè¨¼ã™ã‚‹ï¼ $this->assertSame( [ \"ãƒ‡ãƒ¼ã‚¿ã‚’å¤‰æ›´ã—ã¾ã—ãŸï¼\" ], $actual[\"message\"] ); } } ãƒ»ç•°å¸¸ç³»POST ControllerãŒ400ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã®ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’è¿”ä¿¡ã™ã‚‹ã“ã¨ï¼Œãƒ¬ã‚¹ãƒãƒ³ã‚¹ã•ã‚ŒãŸãƒ‡ãƒ¼ã‚¿ãŒæœŸå¾…é€šã‚Šã§ã‚ã‚‹ã“ã¨ï¼Œã‚’æ¤œè¨¼ã™ã‚‹ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š request( \"POST\", \"/xxx/yyy/\", [ \"id\" => 1, \"message\" => \"\" ], [ \"HTTP_X_API_Token\" => \"Bearer xxxxxx\" ] ); $response = $client->getResponse(); // 400ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãŒè¿”å´ã•ã‚Œã‚‹ã‹ã‚’æ¤œè¨¼ã™ã‚‹ï¼ $this->assertSame(400, $response->getStatusCode()); // ãƒ¬ã‚¹ãƒãƒ³ã‚¹ãƒ‡ãƒ¼ã‚¿ã®ã‚¨ãƒ©ãƒ¼ã‚’æŠ½å‡ºã™ã‚‹ï¼ $actual = json_decode($response->getContent(), true); // ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã•ã‚ŒãŸã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒæ­£ã—ã„ã‹ã‚’æ¤œè¨¼ã™ã‚‹ï¼ $this->assertSame( [ \"IDã¯å¿…ãšå…¥åŠ›ã—ã¦ãã ã•ã„ï¼\", \"ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã¯å¿…ãšå…¥åŠ›ã—ã¦ãã ã•ã„ï¼\" ], $actual[\"errors\"] ); } } ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ ãƒ»Data Provider ãƒ†ã‚¹ãƒˆå¯¾è±¡ã®ãƒ¡ã‚½ãƒƒãƒ‰ã®å¼•æ•°ã‚’äº‹å‰ã«ç”¨æ„ã™ã‚‹ï¼ãƒ¡ã‚½ãƒƒãƒ‰ã®ã‚¢ãƒãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ã§ï¼Œ@testã¨@dataProvider ãƒ‡ãƒ¼ã‚¿ãƒ—ãƒ­ãƒã‚¤ãƒ€åã‚’å®£è¨€ã™ã‚‹ï¼ãƒ‡ãƒ¼ã‚¿ãƒ—ãƒ­ãƒã‚¤ãƒ€ã®è¿”å´å€¤ã¨ã—ã¦é…åˆ—ã‚’è¨­å®šã—ï¼Œé…åˆ—ã®å€¤ã®é †ç•ªã§ï¼Œå¼•æ•°ã«å€¤ã‚’æ¸¡ã™ã“ã¨ãŒã§ãã‚‹ï¼ å‚è€ƒï¼šhttps://phpunit.readthedocs.io/ja/latest/writing-tests-for-phpunit.html#writing-tests-for-phpunit-data-providers ï¼Šå®Ÿè£…ä¾‹ï¼Š å‰å‡¦ç†ã¨å¾Œå‡¦ç† ãƒ»setUpãƒ¡ã‚½ãƒƒãƒ‰ å‰å‡¦ç†ã¨ã—ã¦ï¼Œå…¨ã¦ã®ãƒ†ã‚¹ãƒˆé–¢æ•°ã®å‰ã«ã‚³ãƒ¼ãƒ«ã•ã‚Œã‚‹ãƒ¡ã‚½ãƒƒãƒ‰ã§ã‚ã‚‹ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š DIã‚³ãƒ³ãƒ†ãƒŠã‚’äº‹å‰ã«ç”Ÿæˆã™ã‚‹ï¼ container[\"option\"]; } } ï¼Šå®Ÿè£…ä¾‹ï¼Š å˜ä½“ãƒ†ã‚¹ãƒˆã§æ¤œè¨¼ã™ã‚‹ã‚¯ãƒ©ã‚¹ãŒå®Ÿéš›ã®å‡¦ç†ã®ä¸­ã§ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹åŒ–ã•ã‚Œã‚‹æ™‚ï¼Œä¾å­˜å¯¾è±¡ã®ã‚¯ãƒ©ã‚¹ã¯ã™ã§ã«ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹åŒ–ã•ã‚Œã¦ã„ã‚‹ã¯ãšã§ã‚ã‚‹ï¼ãã®ãŸã‚ï¼Œã“ã‚Œã¨åŒã˜ã‚ˆã†ã«ä¾å­˜å¯¾è±¡ã®ã‚¯ãƒ©ã‚¹ã®ãƒ¢ãƒƒã‚¯ã‚’äº‹å‰ã«ç”Ÿæˆã—ã¦ãŠãï¼ hoge = Phake::mock(Hoge::class); } public function testFoo_Xxx_Xxx() { // å®Ÿéš›ã®å‡¦ç†ã§ã¯ï¼Œã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹åŒ–æ™‚ã«ï¼ŒFooã‚¯ãƒ©ã‚¹ã¯Hogeã‚¯ãƒ©ã‚¹ã«ä¾å­˜ã—ã¦ã„ã‚‹ï¼ $foo = new Foo($this->hoge) // ä½•ã‚‰ã‹ã®ãƒ†ã‚¹ãƒˆã‚³ãƒ¼ãƒ‰ } } ãƒ»tearDownãƒ¡ã‚½ãƒƒãƒ‰ å¾Œå‡¦ç†ã¨ã—ã¦ï¼Œå…¨ã¦ã®ãƒ†ã‚¹ãƒˆé–¢æ•°ã®å¾Œã«ã‚³ãƒ¼ãƒ«ã•ã‚Œã‚‹ãƒ¡ã‚½ãƒƒãƒ‰ã§ã‚ã‚‹ï¼ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°ã‚„ã‚µãƒ¼ãƒ“ã‚¹ã‚³ãƒ³ãƒ†ãƒŠã«ãƒ‡ãƒ¼ã‚¿ã‚’æ ¼ç´ã™ã‚‹å ´åˆï¼Œå¾Œã®æ¤œè¨¼ã§ã‚‚ãã®ãƒ‡ãƒ¼ã‚¿ãŒèª¤ã£ã¦ä½¿ç”¨ã•ã‚Œã¦ã—ã¾ã‚ãªã„ã‚ˆã†ã«ï¼Œã‚µãƒ¼ãƒ“ã‚¹ã‚³ãƒ³ãƒ†ãƒŠã‚’ç ´æ£„ã™ã‚‹ãŸã‚ã«ç”¨ã„ã‚‰ã‚Œã‚‹ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š container[\"option\"]; } // å…¨ã¦ã®ãƒ†ã‚¹ãƒˆé–¢æ•°ã®å¾Œã«å®Ÿè¡Œã•ã‚Œã‚‹ï¼ protected function tearDown() { // DIã‚³ãƒ³ãƒ†ãƒŠã«nullã‚’æ ¼ç´ã™ã‚‹ï¼ $this->container = null; } } å‘½åè¦å‰‡ ãƒ»ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹å Roy Osheroveæ°ã®å‘½åè¦å‰‡ã«å¾“ã£ã¦ï¼Œã€ãƒ†ã‚¹ãƒˆå¯¾è±¡ã®ãƒ¡ã‚½ãƒƒãƒ‰åã€ã€å…¥åŠ›å€¤ã€ã€æœŸå¾…ã•ã‚Œã‚‹è¿”å´å€¤ã€ã®ä¸‰è¦ç´ ã§ãƒ†ã‚¹ãƒˆé–¢æ•°ã‚’å‘½åã™ã‚‹ï¼æœŸå¾…ã•ã‚Œã‚‹è¿”å´å€¤ã®å‘½åã§ã€æ­£å¸¸ç³»ãƒ†ã‚¹ãƒˆã€ã‹ã€ç•°å¸¸ç³»ãƒ†ã‚¹ãƒˆã€ã‹ã¨è­˜åˆ¥ã™ã‚‹ï¼ä¾‹ãˆã°ï¼Œæ­£å¸¸ç³»ã§ã‚ã‚Œã°ã€testFoo_Xxx_ReturnXxxã€ï¼Œã¾ãŸç•°å¸¸ç³»ã§ã‚ã‚Œã°ã€testFoo_Xxx_ExceptionThrownã€ã‚„ã€testFoo_Xxx_ErrorThrownã€ã¨ã™ã‚‹ï¼Roy Osheroveæ°ã®å‘½åè¦å‰‡ã«ã¤ã„ã¦ã¯ï¼Œä»¥ä¸‹ã®ãƒªãƒ³ã‚¯ã‚’å‚è€ƒã«ã›ã‚ˆï¼ å‚è€ƒï¼šhttps://osherove.com/blog/2005/4/3/naming-standards-for-unit-tests.html ãƒ»ã‚¢ã‚µãƒ¼ã‚·ãƒ§ãƒ³ã®æ¯”è¼ƒå€¤ ã‚¢ã‚µãƒ¼ã‚·ãƒ§ãƒ³ã§å€¤ã‚’æ¯”è¼ƒã™ã‚‹å ´åˆï¼Œå€¤ã‚’å®šæ•°ã¨ã—ã¦ç®¡ç†ã—ãŸæ–¹ãŒã‚ˆã„ï¼ å‚è€ƒï¼šhttps://osherove.com/blog/2005/4/3/naming-standards-for-unit-tests.html 02-03. Test Doubleï¼ˆãƒ†ã‚¹ãƒˆãƒ€ãƒ–ãƒ«ï¼‰ ãƒ†ã‚¹ãƒˆãƒ€ãƒ–ãƒ«ã®ç¨®é¡ ãƒ»ãƒ¢ãƒƒã‚¯ãƒ„ãƒ¼ãƒ«ï¼Œã‚¹ã‚¿ãƒ–ãƒ„ãƒ¼ãƒ« PHPUnitï¼ŒPhakeï¼ŒMockeryï¼ŒJUnit ãƒ»ãƒ¢ãƒƒã‚¯ ä¸Šå±¤ã‚¯ãƒ©ã‚¹ãŒä¸‹å±¤ã‚¯ãƒ©ã‚¹ã‚’æ­£ã—ãã‚³ãƒ¼ãƒ«ã§ãã‚‹ã‹ã©ã†ã‹ã‚’æ¤œè¨¼ã—ãŸã„æ™‚ã«ï¼Œä¸Šå±¤ã‚¯ãƒ©ã‚¹ä»¥å¤–ã®éƒ¨åˆ†ã®å‡¦ç†ã¯ä¸è¦ã§ã‚ã‚Šï¼Œä¸‹å±¤ã‚¯ãƒ©ã‚¹ã®å®Ÿä½“ãŒã‚ã‚‹ã‹ã®ã‚ˆã†ã«è¦‹ã›ã‹ã‘ã‚‹ï¼ã“ã®æ™‚ï¼Œè¦‹ã›ã‹ã‘ã®ä¸‹å±¤ã‚¯ãƒ©ã‚¹ã¨ã—ã¦ä½¿ç”¨ã™ã‚‹æ“¬ä¼¼ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’ã€ãƒ¢ãƒƒã‚¯ã€ã¨ã„ã†ï¼ã‚¹ã‚¿ãƒ–ã¨ã¯ï¼Œç”¨ã„ã‚‰ã‚Œã‚‹ãƒ†ã‚¹ãƒˆãŒç•°ãªã‚‹ãŒï¼Œã©ã¡ã‚‰ã‚‚æ“¬ä¼¼ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã§ã‚ã‚‹ï¼ã‚¹ã‚¿ãƒ–ã«ã¤ã„ã¦ã¯å¾Œè¿°ã®èª¬æ˜ã‚’å‚è€ƒã«ã›ã‚ˆï¼ãƒ¢ãƒƒã‚¯ã«ãŠã„ã¦ã¯ï¼Œã‚¯ãƒ©ã‚¹ã®ãƒ¡ã‚½ãƒƒãƒ‰ã¨ãƒ‡ãƒ¼ã‚¿ãŒå…¨ã¦ãƒ€ãƒŸãƒ¼å®Ÿè£…ã«ç½®ãæ›ãˆã‚‰ã‚Œã¦ã„ã‚‹ï¼ã‚‚ã—ä¸‹å±¤ã‚¯ãƒ©ã‚¹ã‚’æ­£ã—ã„å›æ•°å®Ÿè¡Œã§ãã¦ã„ã‚‹ã‹ã‚’æ¤œè¨¼ã—ãŸã„å ´åˆã¯ï¼Œä¸‹å±¤ã‚¯ãƒ©ã‚¹ã®ãƒ¢ãƒƒã‚¯ã‚’å®šç¾©ã—ï¼Œå®Ÿä½“ã®ã‚ã‚‹ä¸Šå±¤ã‚¯ãƒ©ã‚¹ãŒä¸‹å±¤ã‚¯ãƒ©ã‚¹ã«ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’æ¸¡ã—ãŸæ™‚ã®ã‚³ãƒ¼ãƒ«å›æ•°ã¨æŒ‡å®šå›æ•°ã‚’æ¯”è¼ƒã™ã‚‹ï¼ãªãŠï¼Œç”¨èªã®å®šç¾©ã¯ãƒ†ã‚¹ãƒˆãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã”ã¨ã«ã‚„ã‚„ç•°ãªã‚‹ã“ã¨ã«æ³¨æ„ã™ã‚‹ï¼PHPUnitã«ãŠã‘ã‚‹ãƒ¢ãƒƒã‚¯ã«ã¤ã„ã¦ã¯ï¼Œä»¥ä¸‹ã®ãƒªãƒ³ã‚¯ã‚’å‚è€ƒã«ã›ã‚ˆï¼ å‚è€ƒï¼šhttps://phpunit.readthedocs.io/ja/latest/test-doubles.html#test-doubles-mock-objects ãƒ„ãƒ¼ãƒ«å ãƒ¢ãƒƒã‚¯ã®ãƒ¡ã‚½ãƒƒãƒ‰ã®è¿”å´å€¤ è£œè¶³ PHPUnit ãƒ¡ã‚½ãƒƒãƒ‰ã¯ï¼Œnullã‚’è¿”å´ã™ã‚‹ï¼ æ³¨æ„ç‚¹ã¨ã—ã¦ï¼Œfinalï¼Œprivateãªãƒ¡ã‚½ãƒƒãƒ‰ã¯ãƒ¢ãƒƒã‚¯åŒ–ã•ã‚Œãšï¼Œå®Ÿä½“ã‚’ãã®ã¾ã¾å¼•ãç¶™ãï¼ã¾ãŸï¼Œstaticãªãƒ¡ã‚½ãƒƒãƒ‰ã¯BadMethodCallExceptionã‚’ã‚¹ãƒ­ãƒ¼ã™ã‚‹ãƒ¢ãƒƒã‚¯ã«ç½®ãæ›ãˆã‚‰ã‚Œã‚‹ï¼ JUnit ãƒ¡ã‚½ãƒƒãƒ‰ã¯ï¼Œå…ƒã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®ãƒ¡ã‚½ãƒƒãƒ‰ã®è¿”å´å€¤ã®å‹ã«åŸºã¥ã„ã¦ï¼ŒåˆæœŸå€¤ã‚’è¿”å´ã™ã‚‹ï¼ˆä¾‹ï¼šboolå‹ãªã‚‰falseï¼‰ ãƒ»ã‚¹ã‚¿ãƒ– ã‚¯ãƒ©ã‚¹ã®ãƒ¡ã‚½ãƒƒãƒ‰ã®å‡¦ç†ã‚’æ¤œè¨¼ã—ãŸã„æ™‚ã«ï¼Œæ¤œè¨¼å¯¾è±¡å¤–ã®ã‚¯ãƒ©ã‚¹ã«ä¾å­˜ã—ã¦ã„ã‚‹éƒ¨åˆ†ã¯ï¼Œå®Ÿä½“ãŒã‚ã‚‹ã‹ã®ã‚ˆã†ã«è¦‹ã›ã‹ã‘ã‚‹ï¼ã“ã®æ™‚ï¼Œè¦‹ã›ã‹ã‘ã®ä¸‹å±¤ã‚¯ãƒ©ã‚¹ã¨ã—ã¦ä½¿ç”¨ã™ã‚‹æ“¬ä¼¼ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’ã€ã‚¹ã‚¿ãƒ–ã€ã¨ã„ã†ï¼ãƒ¢ãƒƒã‚¯ã¨ã¯ï¼Œç”¨ã„ã‚‰ã‚Œã‚‹ãƒ†ã‚¹ãƒˆãŒç•°ãªã‚‹ãŒï¼Œã©ã¡ã‚‰ã‚‚æ“¬ä¼¼ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã§ã‚ã‚‹ï¼ãƒ¢ãƒƒã‚¯ã¨åŒæ§˜ã«ã‚¹ã‚¿ãƒ–ã«ãŠã„ã¦ã‚‚ï¼Œã‚¯ãƒ©ã‚¹ã®ãƒ¡ã‚½ãƒƒãƒ‰ã¨ãƒ‡ãƒ¼ã‚¿ãŒå…¨ã¦ãƒ€ãƒŸãƒ¼å®Ÿè£…ã«ç½®ãæ›ãˆã‚‰ã‚Œã¦ã„ã‚‹ï¼ã‚¹ã‚¿ãƒ–ã«ã¯ï¼Œæ­£ã—ã„å‡¦ç†ã‚’å®Ÿè¡Œã™ã‚‹ã‚ˆã†ã«å¼•æ•°ã¨è¿”å´å€¤ã‚’æŒã¤ãƒ¡ã‚½ãƒƒãƒ‰ã‚’å®šç¾©ã—ï¼Œãã®ä»–ã®å®Ÿä½“ã®ã‚ã‚‹å‡¦ç†ãŒæ­£ã—ãå®Ÿè¡Œã•ã‚Œã‚‹ã‹ã‚’æ¤œè¨¼ã™ã‚‹ï¼ã“ã‚Œã‚‰ã«ã‚ˆã‚Šï¼Œæ¤œè¨¼å¯¾è±¡ã®å‡¦ç†ã®ã¿ãŒå®Ÿä½“ã§ã‚ã£ã¦ã‚‚ï¼Œä¸€é€£ã®å‡¦ç†ã‚’å®Ÿè¡Œã§ãã‚‹ï¼ãªãŠï¼Œç”¨èªã®å®šç¾©ã¯ãƒ†ã‚¹ãƒˆãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã”ã¨ã«ã‚„ã‚„ç•°ãªã‚‹ã“ã¨ã«æ³¨æ„ã™ã‚‹ï¼PHPUnitã«ãŠã‘ã‚‹ã‚¹ã‚¿ãƒ–ã«ã¤ã„ã¦ã¯ï¼Œä»¥ä¸‹ã®ãƒªãƒ³ã‚¯ã‚’å‚è€ƒã«ã›ã‚ˆï¼ å‚è€ƒï¼šhttps://phpunit.readthedocs.io/ja/latest/test-doubles.html#test-doubles-stubs PHPUnit ãƒ»createMockãƒ¡ã‚½ãƒƒãƒ‰ ã‚¯ãƒ©ã‚¹ã®åå‰ç©ºé–“ã‚’å…ƒã«ï¼Œãƒ¢ãƒƒã‚¯ã¾ãŸã¯ã‚¹ã‚¿ãƒ–ã¨ã—ã¦ä½¿ç”¨ã™ã‚‹æ“¬ä¼¼ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’ç”Ÿæˆã™ã‚‹ï¼ä»¥é™ã®å‡¦ç†ã§ã®ç”¨é€”ã«ã‚ˆã£ã¦ï¼Œå‘¼ã³åãŒç•°ãªã‚‹ã“ã¨ã«æ³¨æ„ã™ã‚‹ï¼ã¡ãªã¿ã«ï¼ŒPHPUnitã®å ´åˆï¼Œãƒ¢ãƒƒã‚¯ã®ãƒ¡ã‚½ãƒƒãƒ‰ã¯nullã‚’è¿”å´ã™ã‚‹ï¼ createMock(Foo::class); // null $foo = $mock->find(1) } } ãƒ»methodãƒ¡ã‚½ãƒƒãƒ‰ ãƒ¢ãƒƒã‚¯ã¾ãŸã¯ã‚¹ã‚¿ãƒ–ã®ãƒ¡ã‚½ãƒƒãƒ‰ã«å¯¾ã—ã¦ï¼Œå‡¦ç†ã®å†…å®¹ã‚’å®šç¾©ã™ã‚‹ï¼ç‰¹å®šã®å¤‰æ•°ãŒæ¸¡ã•ã‚ŒãŸæ™‚ã«ï¼Œç‰¹å®šã®å€¤ã‚’è¿”å´ã•ã›ã‚‹ã“ã¨ãŒã§ãã‚‹ï¼ createMock(Foo::class); // ã‚¹ã‚¿ãƒ–ã®ãƒ¡ã‚½ãƒƒãƒ‰ã«å‡¦ç†å†…å®¹ã‚’å®šç¾©ã™ã‚‹ï¼ $stub->method(\"find\") ->with(1) ->willReturn([]); // []ï¼ˆç©ºé…åˆ—ï¼‰ $result = $stub->find(1) } } Phake ãƒ»Phakeã¨ã¯ ãƒ¢ãƒƒã‚¯ã¨ã‚¹ã‚¿ãƒ–ã‚’æä¾›ã™ã‚‹ãƒ©ã‚¤ãƒ–ãƒ©ãƒªï¼ å‚è€ƒï¼šhttps://github.com/mlively/Phake#phake ãƒ»mockãƒ¡ã‚½ãƒƒãƒ‰ ã‚¯ãƒ©ã‚¹ã®åå‰ç©ºé–“ã‚’å…ƒã«ï¼Œãƒ¢ãƒƒã‚¯ã¾ãŸã¯ã‚¹ã‚¿ãƒ–ã¨ã—ã¦ä½¿ç”¨ã™ã‚‹æ“¬ä¼¼ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’ç”Ÿæˆã™ã‚‹ï¼ä»¥é™ã®å‡¦ç†ã§ã®ç”¨é€”ã«ã‚ˆã£ã¦ï¼Œå‘¼ã³åãŒç•°ãªã‚‹ã“ã¨ã«æ³¨æ„ã™ã‚‹ï¼ ãƒ»whenãƒ¡ã‚½ãƒƒãƒ‰ ãƒ¢ãƒƒã‚¯ã¾ãŸã¯ã‚¹ã‚¿ãƒ–ã®ãƒ¡ã‚½ãƒƒãƒ‰ã«å¯¾ã—ã¦ï¼Œå‡¦ç†ã®å†…å®¹ã‚’å®šç¾©ã™ã‚‹ï¼ã¾ãŸï¼Œç‰¹å®šã®å¤‰æ•°ãŒæ¸¡ã•ã‚ŒãŸæ™‚ã«ï¼Œç‰¹å®šã®å€¤ã‚’è¿”å´ã•ã›ã‚‹ã“ã¨ãŒã§ãã‚‹ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š ãƒ¢ãƒƒã‚¯ã®findãƒ¡ã‚½ãƒƒãƒ‰ã¯ï¼Œ1ãŒæ¸¡ã•ã‚ŒãŸæ™‚ã«ï¼Œç©ºé…åˆ—ã‚’è¿”å´ã™ã‚‹ï¼ find(1) ->thenReturn([]); ãƒ»verifyãƒ¡ã‚½ãƒƒãƒ‰ ä¸Šå±¤ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆãŒä¸‹å±¤ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’ã‚³ãƒ¼ãƒ«ã§ãã‚‹ã“ã¨ã‚’ç¢ºèªã™ã‚‹ãŸã‚ã«ï¼Œãƒ¢ãƒƒã‚¯ã®ãƒ¡ã‚½ãƒƒãƒ‰ãŒnå›å®Ÿè¡Œã§ããŸã“ã¨ã‚’æ¤œè¨¼ã™ã‚‹ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š find($fooId) ->thenReturn(new User(1)); // ä¸Šå±¤ã‚¯ãƒ©ã‚¹ã«å¯¾ã—ã¦ï¼Œä¸‹å±¤ã‚¯ãƒ©ã‚¹ã®ãƒ¢ãƒƒã‚¯ã®ã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³ã‚’è¡Œã† $foo = new Foo($mockFooRepository); // ä¸Šå±¤ã‚¯ãƒ©ã‚¹ã®å†…éƒ¨ã«ã‚ã‚‹ä¸‹å±¤ãƒ¢ãƒƒã‚¯ã®findãƒ¡ã‚½ãƒƒãƒ‰ã‚’ã‚³ãƒ¼ãƒ«ã™ã‚‹ $foo->getUser($fooId) // ä¸Šå±¤ã®ã‚¯ãƒ©ã‚¹ãŒï¼Œä¸‹å±¤ãƒ¢ãƒƒã‚¯ã«ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’æ¸¡ã—ï¼Œãƒ¡ã‚½ãƒƒãƒ‰ã‚’å®Ÿè¡Œã—ãŸã“ã¨ã‚’æ¤œè¨¼ã™ã‚‹ï¼ Phake::verify($mockFooRepository, Phake::times(1))->find($fooId); } } 03. ãƒ–ãƒ©ãƒƒã‚¯ãƒ†ã‚¹ãƒˆ/ãƒ›ãƒ¯ã‚¤ãƒˆãƒœãƒƒã‚¯ã‚¹ãƒ†ã‚¹ãƒˆ ãƒ–ãƒ©ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ãƒ†ã‚¹ãƒˆ ãƒ»ãƒ–ãƒ©ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ãƒ†ã‚¹ãƒˆã¨ã¯ ãƒ›ãƒ¯ã‚¤ãƒˆãƒœãƒƒã‚¯ã‚¹ãƒ†ã‚¹ãƒˆã¨çµ„ã¿åˆã‚ã›ã¦ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆã‚’æ§‹æˆã™ã‚‹ï¼å®Ÿè£…å†…å®¹ã¯æ°—ã«ã›ãšï¼Œå…¥åŠ›ã«å¯¾ã—ã¦ï¼Œé©åˆ‡ãªå‡ºåŠ›ãŒè¡Œã‚ã‚Œã¦ã„ã‚‹ã‹ã‚’æ¤œè¨¼ã™ã‚‹ï¼ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆã¨ãƒ›ãƒ¯ã‚¤ãƒˆ/ãƒ–ãƒ©ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ãƒ†ã‚¹ãƒˆã®é–¢ä¿‚æ€§ã«ã¤ã„ã¦ã¯ï¼Œä»¥ä¸‹ã®æ›¸ç±ã‚’å‚è€ƒã«ã›ã‚ˆï¼ å‚è€ƒï¼šhttps://www.amazon.co.jp/dp/477415377X/ ãƒ›ãƒ¯ã‚¤ãƒˆãƒœãƒƒã‚¯ã‚¹ãƒ†ã‚¹ãƒˆ ãƒ»ãƒ›ãƒ¯ã‚¤ãƒˆãƒœãƒƒã‚¯ã‚¹ãƒ†ã‚¹ãƒˆã¨ã¯ ãƒ–ãƒ©ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ãƒ†ã‚¹ãƒˆã¨çµ„ã¿åˆã‚ã›ã¦ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆã‚’æ§‹æˆã™ã‚‹ï¼å®Ÿè£…å†…å®¹ãŒé©åˆ‡ã‹ã‚’ç¢ºèªã—ãªãŒã‚‰ï¼Œå…¥åŠ›ã«å¯¾ã—ã¦ï¼Œé©åˆ‡ãªå‡ºåŠ›ãŒè¡Œã‚ã‚Œã¦ã„ã‚‹ã‹ã‚’æ¤œè¨¼ã™ã‚‹ï¼ç¶²ç¾…æ¡ä»¶ãŒã„ãã¤ã‹ã‚ã‚Šï¼Œæ±‚ã‚ã‚‰ã‚Œã‚‹ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢å“è³ªã«å¿œã˜ãŸã‚‚ã®ã‚’æ¡ç”¨ã™ã‚‹ï¼ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆã¨ãƒ›ãƒ¯ã‚¤ãƒˆ/ãƒ–ãƒ©ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ãƒ†ã‚¹ãƒˆã®é–¢ä¿‚æ€§ã«ã¤ã„ã¦ã¯ï¼Œä»¥ä¸‹ã®æ›¸ç±ã‚’å‚è€ƒã«ã›ã‚ˆï¼ å‚è€ƒï¼šhttps://www.amazon.co.jp/dp/477415377X/ ï¼Šå®Ÿè£…ä¾‹ï¼Š if (A = 1 && B = 1) { ã€€return X; } ãƒ»Cï¼ï¼šStatement Coverageï¼ˆå‘½ä»¤ç¶²ç¾…ï¼‰ å…¨ã¦ã®å‘½ä»¤ãŒå®Ÿè¡Œã•ã‚Œã‚‹ã‹ã‚’æ¤œè¨¼ã™ã‚‹ï¼ ï¼Šä¾‹ï¼Š Aã¨Bã¯ï¼Œã€1ã€ã¾ãŸã¯ã€0ã€ã«ãªã‚Šå¾—ã‚‹ã¨ã™ã‚‹ï¼ æ¡ä»¶ å‡¦ç†å®Ÿè¡Œã®æœ‰ç„¡ A = 1ï¼ŒB = 1 return X ãŒå®Ÿè¡Œã•ã‚Œã‚‹ã“ã¨ï¼ ãƒ»Cï¼‘ï¼šDecision Coverageï¼ˆåˆ¤å®šæ¡ä»¶ç¶²ç¾…ï¼‰ å…¨ã¦ã®åˆ¤å®šãŒå®Ÿè¡Œã•ã‚Œã‚‹ã‹ã‚’æ¤œè¨¼ã™ã‚‹ï¼ ï¼Šä¾‹ï¼Š Aã¨Bã¯ï¼Œã€1ã€ã¾ãŸã¯ã€0ã€ã«ãªã‚Šå¾—ã‚‹ã¨ã™ã‚‹ï¼ æ¡ä»¶ å‡¦ç†å®Ÿè¡Œã®æœ‰ç„¡ A = 1ï¼ŒB = 1 return X ãŒå®Ÿè¡Œã•ã‚Œã‚‹ã“ã¨ï¼ A = 1ï¼ŒB = 0 return X ãŒå®Ÿè¡Œã•ã‚Œãªã„ã“ã¨ï¼ ãƒ»Cï¼’ï¼šCondition Coverageï¼ˆæ¡ä»¶ç¶²ç¾…ï¼‰ å„æ¡ä»¶ãŒï¼Œå–ã‚Šå¾—ã‚‹å…¨ã¦ã®å€¤ã§å®Ÿè¡Œã•ã‚Œã‚‹ã‹ã‚’æ¤œè¨¼ã™ã‚‹ï¼ ï¼Šä¾‹ï¼Š Aã¨Bã¯ï¼Œã€1ã€ã¾ãŸã¯ã€0ã€ã«ãªã‚Šå¾—ã‚‹ã¨ã™ã‚‹ï¼ æ¡ä»¶ å‡¦ç†å®Ÿè¡Œã®æœ‰ç„¡ A = 1ï¼ŒB = 0 return X ãŒå®Ÿè¡Œã•ã‚Œãªã„ã“ã¨ï¼ A = 0ï¼ŒB = 1 return X ãŒå®Ÿè¡Œã•ã‚Œãªã„ã“ã¨ï¼ ã¾ãŸã¯ï¼Œæ¬¡ã®çµ„ã¿åˆã‚ã›ã§ã‚‚ã‚ˆã„ï¼ æ¡ä»¶ å‡¦ç†å®Ÿè¡Œã®æœ‰ç„¡ A = 1ï¼ŒB = 1 return X ãŒå®Ÿè¡Œã•ã‚Œã‚‹ã“ã¨ï¼ A = 0ï¼ŒB = 0 return X ãŒå®Ÿè¡Œã•ã‚Œãªã„ã“ã¨ï¼ ãƒ»MCCï¼šMultiple Condition Coverageï¼ˆè¤‡æ•°æ¡ä»¶ç¶²ç¾…ï¼‰ å„æ¡ä»¶ãŒï¼Œå–ã‚Šå¾—ã‚‹å…¨ã¦ã®å€¤ã§ï¼Œã‹ã¤å…¨ã¦ã®çµ„ã¿åˆã‚ã›ãŒå®Ÿè¡Œã•ã‚Œã‚‹ã‹ã‚’æ¤œè¨¼ã™ã‚‹ï¼Webã‚·ã‚¹ãƒ†ãƒ ã§ã¯ï¼Œä¸€èˆ¬çš„ã«è¤‡æ•°æ¡ä»¶ç¶²ç¾…ã‚’æ¡ç”¨ã™ã‚Œã°ï¼Œæœ€ä½é™ã®ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢å“è³ªã‚’æ‹…ä¿ã§ãã¦ã„ã‚‹ã¨è¨€ãˆã‚‹ï¼ ï¼Šä¾‹ï¼Š Aã¨Bã¯ï¼Œã€1ã€ã¾ãŸã¯ã€0ã€ã«ãªã‚Šå¾—ã‚‹ã¨ã™ã‚‹ï¼ æ¡ä»¶ å‡¦ç†å®Ÿè¡Œã®æœ‰ç„¡ A = 1ï¼ŒB = 1 return X ãŒå®Ÿè¡Œã•ã‚Œã‚‹ã“ã¨ï¼ A = 1ï¼ŒB = 0 return X ãŒå®Ÿè¡Œã•ã‚Œãªã„ã“ã¨ï¼ A = 0ï¼ŒB = 1 return X ãŒå®Ÿè¡Œã•ã‚Œãªã„ã“ã¨ï¼ A = 0ï¼ŒB = 0 return X ãŒå®Ÿè¡Œã•ã‚Œãªã„ã“ã¨ï¼ ãƒ›ãƒ¯ã‚¤ãƒˆãƒœãƒƒã‚¯ã‚¹ãƒ†ã‚¹ãƒˆã®æŒ‡æ¨™ ãƒ»ç¶²ç¾…ç‡ æ¡ç”¨ã—ãŸç¶²ç¾…ã§è€ƒãˆã‚‰ã‚Œã‚‹å…¨ã¦ã®æ¡ä»¶ã®ã†ã¡ï¼Œãƒ†ã‚¹ãƒˆã§æ¤œè¨¼ã§ãã¦ã„ã‚‹å‰²åˆã®ã“ã¨ï¼ ç¶²ç¾…ç‡ã¯ãƒ†ã‚¹ãƒˆã‚¹ã‚¤ãƒ¼ãƒˆã‚„ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’å˜ä½ã¨ã—ã¦è§£æã•ã‚Œï¼Œã“ã‚Œã¯è¨€èªåˆ¥ã«ç•°ãªã‚‹ï¼PHPUnitã§ç¶²ç¾…ç‡ã‚’è§£æã™ã‚‹æ–¹æ³•ã«ã¤ã„ã¦ã¯ï¼Œä»¥ä¸‹ã®ãƒªãƒ³ã‚¯ã‚’å‚è€ƒã«ã›ã‚ˆï¼ å‚è€ƒï¼šhttps://phpunit.readthedocs.io/ja/latest/code-coverage-analysis.html ãƒ»å¾ªç’°çš„è¤‡é›‘åº¦ ãƒ†ã‚¹ãƒˆå¯¾è±¡ãŒã©ã‚Œã ã‘è¤‡é›‘ãªå®Ÿè£…æ–¹æ³•ã«ãªã£ã¦ã„ã‚‹ã‹ã®ç¨‹åº¦ã®ã“ã¨ï¼ãŠãŠãã‚ˆï¼Œåˆ†å²ç¶²ç¾…ã®çµŒè·¯æ•°ã®ç¨‹åº¦ã§ã‚ã‚‹ï¼ å‚è€ƒï¼šhttps://jp.mathworks.com/discovery/cyclomatic-complexity.html å¾ªç’°çš„è¤‡é›‘åº¦ è¤‡é›‘ã•ã®çŠ¶æ…‹ ãƒã‚°æ··å…¥ç‡ 10ä»¥ä¸‹ éå¸¸ã«è‰¯ã„ 25% 30ä»¥ä¸Š æ§‹é€ çš„ãªãƒªã‚¹ã‚¯ã‚ã‚Š 40% 50ä»¥ä¸Š ãƒ†ã‚¹ãƒˆä¸å¯èƒ½ 70% 75ä»¥ä¸Š å¤‰æ›´ã«ã‚ˆã£ã¦èª¤ä¿®æ­£ãŒç”Ÿã˜ã‚‹ï¼ 98% 04. PHPStanã«ã‚ˆã‚‹é™çš„è§£æ ã‚³ãƒãƒ³ãƒ‰ ãƒ»ã‚ªãƒ—ã‚·ãƒ§ãƒ³ç„¡ã— å…¨ã¦ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’å¯¾è±¡ã¨ã—ã¦ï¼Œé™çš„è§£æã‚’è¡Œã†ï¼ $ vendor/bin/phpstan analyse phpstan.neonãƒ•ã‚¡ã‚¤ãƒ« ãƒ»phpstan.neonãƒ•ã‚¡ã‚¤ãƒ«ã¨ã¯ PHPStanã®è¨­å®šã‚’è¡Œã†ï¼ ãƒ»includes includes: - ./vendor/nunomaduro/larastan/extension.neon ãƒ»parameters é™çš„è§£æã®è¨­å®šã‚’è¡Œã†ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š parameters: # è§£æå¯¾è±¡ã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª paths: - src # è§£æã®å³æ ¼ã•ï¼ˆæœ€å¤§ãƒ¬ãƒ™ãƒ«ã¯ï¼˜ï¼‰ï¼å„ãƒ¬ãƒ™ãƒ«ã®è§£æé …ç›®ã«ã¤ã„ã¦ã¯ä»¥ä¸‹ã‚’å‚è€ƒã«ã›ã‚ˆï¼ # https://phpstan.org/user-guide/rule-levels level: 5 # ç™ºç”Ÿã‚’ç„¡è¦–ã™ã‚‹ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ ignoreErrors: - '#Unsafe usage of new static#' # è§£æå¯¾è±¡ã¨ã—ã¦é™¤å¤–ã™ã‚‹ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª excludes_analyse: - ./src/Foo/* checkMissingIterableValueType: false inferPrivatePropertyTypeFromConstructor: true "},"public/software/software_application_backend_php_testing_based_on_test_specification.html":{"url":"public/software/software_application_backend_php_testing_based_on_test_specification.html","title":"ğŸ“– ï¸ãƒ†ã‚¹ãƒˆä»•æ§˜æ›¸ãƒ™ãƒ¼ã‚¹ã®ãƒ†ã‚¹ãƒˆ","keywords":"","body":"ãƒ†ã‚¹ãƒˆä»•æ§˜æ›¸ãƒ™ãƒ¼ã‚¹ã®ãƒ†ã‚¹ãƒˆ ã¯ã˜ã‚ã« æœ¬ã‚µã‚¤ãƒˆã«ã¤ãã¾ã—ã¦ï¼Œä»¥ä¸‹ã‚’ã”èªè­˜ã®ã»ã©å®œã—ããŠé¡˜ã„ã„ãŸã—ã¾ã™ï¼ å‚è€ƒï¼šhttps://hiroki-it.github.io/tech-notebook-gitbook/ 01. ãƒ†ã‚¹ãƒˆä»•æ§˜æ›¸ã«åŸºã¥ãçµåˆãƒ†ã‚¹ãƒˆ çµåˆãƒ†ã‚¹ãƒˆã¨ã¯ å˜ä½“ãƒ†ã‚¹ãƒˆã®æ¬¡ã«è¡Œã†ãƒ†ã‚¹ãƒˆï¼è¤‡æ•°ã®ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’ç¹‹ã’ï¼Œãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«é–“ã®ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ã‚¤ã‚¹ãŒé©åˆ‡ã«å‹•ã„ã¦ã„ã‚‹ã‹ã‚’æ¤œè¨¼ï¼ çµåˆãƒ†ã‚¹ãƒˆã®æ–¹å‘ ãƒ»ãƒˆãƒƒãƒ—ãƒ€ã‚¦ãƒ³ãƒ†ã‚¹ãƒˆ ä¸Šå±¤ã®ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‹ã‚‰ä¸‹å±¤ã®ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã«å‘ã‹ã£ã¦ï¼Œçµåˆãƒ†ã‚¹ãƒˆã‚’è¡Œã†ï¼ä¸‹å±¤ã«ã¯ãƒ†ã‚¹ãƒˆãƒ€ãƒ–ãƒ«ã®ã‚¹ã‚¿ãƒ–ã‚’ä½œæˆã™ã‚‹ï¼ ãƒ»ãƒœãƒˆãƒ ã‚¢ãƒƒãƒ—ãƒ†ã‚¹ãƒˆ ä¸‹å±¤ã®ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‹ã‚‰ä¸Šå±¤ã®ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã«å‘ã‹ã£ã¦ï¼Œçµåˆãƒ†ã‚¹ãƒˆã‚’è¡Œã†ï¼ä¸Šå±¤ã«ã¯ãƒ†ã‚¹ãƒˆãƒ€ãƒ–ãƒ«ã®ãƒ‰ãƒ©ã‚¤ãƒãƒ¼ã‚’ä½œæˆã™ã‚‹ï¼ Scenarioãƒ†ã‚¹ãƒˆ å®Ÿéš›ã®æ¥­å‹™ãƒ•ãƒ­ãƒ¼ã‚’å‚è€ƒã«ã—ï¼Œãƒ¦ãƒ¼ã‚¶ãŒæ“ä½œã™ã‚‹é †ã«ãƒ†ã‚¹ãƒˆã‚’è¡Œã†ï¼ 02. ãƒ†ã‚¹ãƒˆä»•æ§˜æ›¸ã«åŸºã¥ãã‚·ã‚¹ãƒ†ãƒ ãƒ†ã‚¹ãƒˆ ã‚·ã‚¹ãƒ†ãƒ ãƒ†ã‚¹ãƒˆ ãƒ»ã‚·ã‚¹ãƒ†ãƒ ãƒ†ã‚¹ãƒˆã¨ã¯ çµåˆãƒ†ã‚¹ãƒˆã®æ¬¡ã«è¡Œã†ãƒ†ã‚¹ãƒˆï¼ã‚·ã‚¹ãƒ†ãƒ å…¨ä½“ãŒé©åˆ‡ã«å‹•ã„ã¦ã„ã‚‹ã‹ã‚’æ¤œè¨¼ã™ã‚‹ï¼User Acceptanceãƒ†ã‚¹ãƒˆï¼Œã¾ãŸç·åˆãƒ†ã‚¹ãƒˆã¨ã‚‚ã„ã†ï¼ ãƒ»ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ä¾‹ ä»¥ä¸‹ã®æ“ä½œã‚’å¯¾è±¡ã¨ã—ã¦æ¤œè¨¼ã™ã‚‹ã¨ã‚ˆã„ï¼ å¤§åˆ†é¡ ä¸­åˆ†é¡ æ¤œè¨¼å¯¾è±¡ã®æ“ä½œ æ©Ÿèƒ½ æ­£å¸¸ç³» åŸºæœ¬æ“ä½œï¼ˆç™»éŒ²ï¼Œå‚ç…§ï¼Œæ›´æ–°ï¼Œå‰Šé™¤ï¼‰ï¼Œç”»é¢é·ç§»ï¼ŒçŠ¶æ…‹é·ç§»ï¼Œã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ï¼Œãªã© ç•°å¸¸ç³» åŸºæœ¬æ“ä½œï¼ˆç™»éŒ²ï¼Œå‚ç…§ï¼Œæ›´æ–°ï¼Œå‰Šé™¤ï¼‰ï¼Œãªã© çµ„ã¿åˆã‚ã› åŒæ™‚æ“ä½œï¼Œå‰²ã‚Šè¾¼ã¿æ“ä½œï¼Œæ’ä»–åˆ¶å¾¡ã«é–¢ã‚ã‚‹æ“ä½œï¼Œãªã© æ¥­å‹™ã‚·ãƒŠãƒªã‚ª ã‚·ãƒŠãƒªã‚ªã«æ²¿ã£ãŸãƒ¦ãƒ¼ã‚¶ã«ã‚ˆã‚‹ä¸€é€£ã®æ“ä½œ é–‹ç™ºè€…ã‚·ãƒŠãƒªã‚ª ã‚·ãƒŠãƒªã‚ªã«æ²¿ã£ãŸé–‹ç™ºè€…ã«ã‚ˆã‚‹ä¸€é€£ã®æ“ä½œï¼ˆæ‰‹å‹•ã‚³ãƒãƒ³ãƒ‰ãªã©ï¼‰ å¤–éƒ¨ã‚·ã‚¹ãƒ†ãƒ é€£æº å¤–éƒ¨ã®APIã¨ã®é€£æºå‡¦ç†ã«é–¢ã‚ã‚‹æ“ä½œ éæ©Ÿèƒ½ è² è·è€æ€§ã‚„æ€§èƒ½ å„ç¨®è² è·ãƒ†ã‚¹ãƒˆï¼ˆæ€§èƒ½ãƒ†ã‚¹ãƒˆï¼Œé™ç•Œãƒ†ã‚¹ãƒˆï¼Œè€ä¹…ãƒ†ã‚¹ãƒˆï¼‰ æ©Ÿèƒ½ãƒ†ã‚¹ãƒˆ æ©Ÿèƒ½è¦ä»¶ã‚’æº€ãŸã›ã¦ã„ã‚‹ã‹ã‚’æ¤œè¨¼ã™ã‚‹ï¼PHPUnitã§ã®æ©Ÿèƒ½ãƒ†ã‚¹ãƒˆã¨ã¯æ„å‘³åˆã„ãŒç•°ãªã‚‹ã®ã§æ³¨æ„ï¼ è² è·ãƒ†ã‚¹ãƒˆ ãƒ»è² è·ãƒ†ã‚¹ãƒˆã¨ã¯ å®Ÿéš›ã®é‹ç”¨æ™‚ã«ï¼Œæƒ³å®šã—ãŸãƒªã‚¯ã‚¨ã‚¹ãƒˆæ•°ã«è€ãˆã‚‰ã‚Œã‚‹ã‹ï¼Œã‚’æ¤œè¨¼ã™ã‚‹ï¼ã¾ãŸï¼Œãƒ†ã‚¹ãƒˆçµæœã‹ã‚‰ï¼Œé‹ç”¨æ™‚ã®ç›£è¦–ã§å‚è€ƒã«ã™ã‚‹ãŸã‚ã®ï¼Œå®‰å…¨ç¯„å›²ï¼ˆé’ä¿¡å·ï¼‰ï¼Œå±é™ºç¯„å›²ï¼ˆé»„è‰²ä¿¡å·ï¼‰ï¼Œé™ç•Œå€¤ï¼ˆèµ¤ä¿¡å·ï¼‰ï¼Œã‚’å°ãå¿…è¦ãŒã‚ã‚‹ï¼ å‚è€ƒï¼šhttps://www.oracle.com/jp/technical-resources/article/ats-tech/tech/useful-class-8.html ãƒ»è² è·ãƒ†ã‚¹ãƒˆã®ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ é …ç›® èª¬æ˜ ã‚¹ãƒ¬ãƒƒãƒ‰æ•° ãƒ¦ãƒ¼ã‚¶æ•°ã«ç›¸å½“ã™ã‚‹ï¼ ãƒ«ãƒ¼ãƒ—æ•° ãƒ¦ãƒ¼ã‚¶å½“ãŸã‚Šã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆé€ä¿¡æ•°ã«ç›¸å½“ã™ã‚‹ï¼ RampUpç§’ ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é€ä¿¡ã™ã‚‹æœŸé–“ã«ç›¸å½“ã™ã‚‹ï¼é•·ãã—éãã™ã‚‹ã¨ï¼Œå…¨ã¦ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆæ•°ã‚’é€ä¿¡ã™ã‚‹ã¾ã§ã«æ™‚é–“ãŒã‹ã‹ã‚‹ã‚ˆã†ã«ãªã‚‹ãŸã‚ï¼Œè² è·ãŒå°ã•ããªã‚‹ï¼ ãƒ»æ€§èƒ½ãƒ†ã‚¹ãƒˆ ä¸€å®šæ™‚é–“å†…ã«ï¼Œãƒ¦ãƒ¼ã‚¶ãŒä¸€é€£ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆï¼ˆä¾‹ï¼šãƒ­ã‚°ã‚¤ãƒ³ï¼Œé–²è¦§ï¼Œç™»éŒ²ï¼Œãƒ­ã‚°ã‚¢ã‚¦ãƒˆï¼‰ã‚’è¡Œã£ãŸæ™‚ã«ï¼Œã‚·ã‚¹ãƒ†ãƒ ã®ã‚¹ãƒ«ãƒ¼ãƒ—ãƒƒãƒˆã¨ãƒ¬ã‚¹ãƒãƒ³ã‚¹æ™‚é–“ã«ã©ã®ã‚ˆã†ãªå¤‰åŒ–ãŒã‚ã‚‹ã‹ã‚’æ¤œè¨¼ã™ã‚‹ï¼å…·ä½“çš„ã«ã¯ãƒ†ã‚¹ãƒˆæ™‚ã«ï¼Œã‚¢ã‚¯ã‚»ã‚¹æ•°ã‚’æ®µéšçš„ã«å¢—åŠ ã•ã›ã¦ï¼Œãã®çµæœã‚’ã‚°ãƒ©ãƒ•åŒ–ã™ã‚‹ï¼ã‚°ãƒ©ãƒ•çµæœã‚’å…ƒã«ï¼Œæƒ³å®šã•ã‚Œã‚‹ãƒªã‚¯ã‚¨ã‚¹ãƒˆæ•°ãŒç¾åœ¨ã®æ€§èƒ½ã«ã©ã®ç¨‹åº¦ã®è² è·ã‚’ã‹ã‘ã‚‹ã®ã‹ã‚’ç¢ºèªã—ï¼Œã¾ãŸæ€§èƒ½ã®è² è·ãŒæœ€å¤§ã«ãªã‚‹å€¤ã‚’å°ãï¼ã“ã‚Œã‚‰ã‚’é‹ç”¨æ™‚ã®ç›£è¦–ã®å‚è€ƒå€¤ã«ã™ã‚‹ï¼ ãƒ»é™ç•Œãƒ†ã‚¹ãƒˆ æ€§èƒ½ã®é™ç•Œå€¤ã«é”ã™ã‚‹ã»ã©ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆæ•°ãŒé€ä¿¡ã•ã‚ŒãŸæ™‚ã«ï¼Œéšœå®³å›é¿å‡¦ç†ï¼ˆä¾‹ï¼šã‚¢ã‚¯ã‚»ã‚¹ãŒè¾¼ã¿åˆã£ã¦ã„ã‚‹æ—¨ã®ãƒšãƒ¼ã‚¸ã‚’è¡¨ç¤ºï¼‰ãŒå®Ÿè¡Œã•ã‚Œã‚‹ã‹ã‚’æ¤œè¨¼ã™ã‚‹ï¼å…·ä½“çš„ã«ã¯ãƒ†ã‚¹ãƒˆæ™‚ã«ï¼Œéšœå®³å›é¿å‡¦ç†ä»¥å¤–ã®å‹•ä½œï¼ˆã‚¨ãƒ©ãƒ¼ï¼Œé–“é•ã£ãŸå‡¦ç†ï¼Œéšœå®³å›å¾©å¾Œã«ã‚‚å¾©æ—§ã§ããªã„ï¼Œã‚·ã‚¹ãƒ†ãƒ ãƒ€ã‚¦ãƒ³ï¼‰ãŒèµ·ã“ã‚‰ãªã„ã‹ã‚’ç¢ºèªã™ã‚‹ï¼ ãƒ»è€ä¹…ãƒ†ã‚¹ãƒˆ é•·æ™‚é–“ã®å¤§é‡ãƒªã‚¯ã‚¨ã‚¹ãƒˆãŒé€ä¿¡ã•ã‚ŒãŸæ™‚ã«ï¼ŒçŸ­æ™‚é–“ã§ã¯æ¤œå‡ºã§ããªã„ã©ã®ã‚ˆã†ãªå•é¡ŒãŒå­˜åœ¨ã™ã‚‹ã‹ã‚’æ¤œè¨¼ã™ã‚‹ï¼å…·ä½“çš„ã«ã¯ãƒ†ã‚¹ãƒˆæ™‚ã«ï¼Œé•·æ™‚é–“ã®å¤§é‡ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’å‡¦ç†ã•ã›ï¼Œå•é¡Œï¼ˆä¾‹ï¼šå¾®é‡ã®ãƒ¡ãƒ¢ãƒªãƒªãƒ¼ã‚¯ãŒè“„ç©ã—ã¦ãƒ¡ãƒ¢ãƒªã‚’åœ§è¿«ï¼Œã‚»ãƒƒã‚·ãƒ§ãƒ³æƒ…å ±ãŒè“„ç©ã—ã¦ãƒ¡ãƒ¢ãƒªã‚„ãƒ‡ã‚£ã‚¹ã‚¯ã‚’åœ§è¿«ï¼Œãƒ­ã‚°ãŒè“„ç©ã—ã¦ãƒ‡ã‚£ã‚¹ã‚¯ã‚’åœ§è¿«ï¼Œãƒ’ãƒ¼ãƒ—ã‚„ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³ãƒ­ã‚°ãŒCPUã‚„I/Oå‡¦ç†ã‚’åœ§è¿«ï¼‰ å†ç¾ãƒ†ã‚¹ãƒˆ ãƒ»å†ç¾ãƒ†ã‚¹ãƒˆã¨ã¯ éšœå®³ç™ºç”Ÿå¾Œã®æªç½®ã¨ã—ã¦ã‚¹ãƒšãƒƒã‚¯ã‚’ä¸Šã’ã‚‹å ´åˆï¼Œãã®ã‚¹ãƒšãƒƒã‚¯ãŒéšœå®³ç™ºç”Ÿæ™‚ã®è² è·ã«è€ãˆã‚‰ã‚Œã‚‹ã‹ã‚’æ¤œè¨¼ã™ã‚‹ï¼ ãƒ»ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ä¾‹ é–‹å§‹ã‹ã‚‰ãƒ”ãƒ¼ã‚¯ã¾ã§ã«ï¼Œæ¬¡ã®ã‚ˆã†ã«ãƒªã‚¯ã‚¨ã‚¹ãƒˆæ•°ãŒå¢—ã—ï¼Œéšœå®³ãŒèµ·ã“ã£ãŸã¨ã™ã‚‹ï¼ãã®å¾Œï¼Œãƒ‡ãƒ¼ã‚¿ã‚’åé›†ã—ãŸï¼ éšœå®³ç™ºç”ŸæœŸé–“ åˆè¨ˆé–²è¦§ãƒšãƒ¼ã‚¸æ•°(PVæ•°/min) å¹³å‡ãƒ¦ãƒ¼ã‚¶æ•°(UAæ•°/min) ãƒ¦ãƒ¼ã‚¶å½“ãŸã‚Šé–²è¦§ãƒšãƒ¼ã‚¸æ•°(PVæ•°/UAæ•°) 13:00 ~ 13:05ï¼ˆé–‹å§‹ï¼‰ 300 100 3 13:05 ~ 13:10 600 200 3 13:10 ~ 13:15ï¼ˆãƒ”ãƒ¼ã‚¯ï¼‰ 900 300 3 ãƒ©ãƒ³ã‚­ãƒ³ã‚° URL å‰²åˆ 1 /aaa/bbb/* 40 % 2 /ccc/ddd/* 30 % 3 /eee/fff/* 20 % 4 /ggg/hhh/* 10 % ï¼Šãƒ†ã‚¹ãƒˆä¾‹ï¼Š ãƒ¦ãƒ¼ã‚¶å½“ãŸã‚Šã®é–²è¦§ãƒšãƒ¼ã‚¸æ•°ã¯ãƒ«ãƒ¼ãƒ—æ•°ã«ç½®ãæ›ãˆã‚‰ã‚Œã‚‹ã®ã§ï¼Œãƒ«ãƒ¼ãƒ—æ•°ã¯ã€Œ3å›ã€ã«ãªã‚‹ï¼éšœå®³ç™ºç”ŸæœŸé–“ã®é–²è¦§ãƒšãƒ¼ã‚¸æ•°ã¯ã‚¹ãƒ¬ãƒƒãƒ‰æ•°ã«ç½®ãæ›ãˆã‚‰ã‚Œã‚‹ã®ã§ï¼Œã‚¹ãƒ¬ãƒƒãƒ‰æ•°ã¯ã€Œ1800å€‹ï¼ˆ300 + 600 + 900ï¼‰ã€ã«ãªã‚‹ï¼éšœå®³ç™ºç”ŸæœŸé–“ã¯ï¼ŒRamp-Upã«ç½®ãæ›ãˆã‚‰ã‚Œã‚‹ã®ã§ï¼ŒRamp-UpæœŸé–“ã¯ã€Œ900ç§’ï¼ˆ15åˆ†é–“ï¼‰ã€ ã‚¹ãƒ¬ãƒƒãƒ‰æ•°ï¼ˆå€‹ï¼‰ ãƒ«ãƒ¼ãƒ—æ•°ï¼ˆå›ï¼‰ Ramp-UpæœŸé–“(sec) 1800 3 900 03. ãã®ä»–ã®ãƒ†ã‚¹ãƒˆ Regressionãƒ†ã‚¹ãƒˆï¼ˆå›å¸°ãƒ†ã‚¹ãƒˆï¼‰ ã‚·ã‚¹ãƒ†ãƒ ã‚’å¤‰æ›´ã—ãŸå¾Œï¼Œä»–ã®ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã«æ‚ªå½±éŸ¿ã‚’ä¸ãˆã¦ã„ãªã„ã‹ã‚’æ¤œè¨¼ï¼ 04. ã‚°ãƒ©ãƒ•ã«ã‚ˆã‚‹ãƒ†ã‚¹ãƒˆã®å¯è¦–åŒ– ãƒã‚°ç®¡ç†å›³ ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®æ™‚ï¼Œæ®‹å­˜ãƒ†ã‚¹ãƒˆæ•°ã¨ä¸è‰¯æ‘˜å‡ºæ•°ï¼ˆãƒã‚°ç™ºè¦‹æ•°ï¼‰ã‚’ç¸¦è»¸ã«ã¨ã‚Šï¼Œæ™‚é–“ã‚’æ¨ªè»¸ã«ã¨ã‚‹ã“ã¨ã§ï¼Œãƒã‚°ç®¡ç†å›³ã‚’ä½œæˆã™ã‚‹ï¼ãã‚Œãã‚Œã®æ›²ç·šã®çŠ¶æ…‹ã‹ã‚‰ï¼Œãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®é€²æ—çŠ¶æ³ã‚’èª­ã¿å–ã‚‹ã“ã¨ãŒã§ãã‚‹ï¼ ä¸è‰¯æ‘˜å‡ºå®Ÿç¸¾ç·šï¼ˆä¿¡é ¼åº¦æˆé•·æ›²ç·šï¼‰ã¯ï¼Œãƒ—ãƒ­ã‚°ãƒ©ãƒ ã®å“è³ªã®çŠ¶æ…‹ã‚’è¡¨ã—ï¼ŒSå­—å‹ã§ãªã„ã‚‚ã®ã¯ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã®å“è³ªãŒè‰¯ããªã„ã“ã¨ã‚’è¡¨ã™ï¼ "},"public/software/software_application_backend_php_debug.html":{"url":"public/software/software_application_backend_php_debug.html","title":"ğŸ“– ï¸ãƒ‡ãƒãƒƒã‚°","keywords":"","body":"ãƒ‡ãƒãƒƒã‚°ã®è±†çŸ¥è­˜ ã¯ã˜ã‚ã« æœ¬ã‚µã‚¤ãƒˆã«ã¤ãã¾ã—ã¦ï¼Œä»¥ä¸‹ã‚’ã”èªè­˜ã®ã»ã©å®œã—ããŠé¡˜ã„ã„ãŸã—ã¾ã™ï¼ å‚è€ƒï¼šhttps://hiroki-it.github.io/tech-notebook-gitbook/ 01. ãƒ‡ãƒãƒƒã‚°ã®Tips var_dumpãƒ¡ã‚½ãƒƒãƒ‰ã§ãƒ‡ãƒ¼ã‚¿ã®ä¸­èº«ã‚’ç¢ºèª ãƒ» åŸºæœ¬å½¢ ãƒ–ãƒ©ã‚¦ã‚¶ã®ã€ãƒ‡ãƒ™ãƒ­ãƒƒãƒ‘ãƒ¼ãƒ„ãƒ¼ãƒ«ï¼Networkï¼å‡ºåŠ›å…ˆãƒšãƒ¼ã‚¸ã®Previewã‚¿ãƒ–ã¾ãŸã¯Responseã‚¿ãƒ–ã€ã§ç¢ºèªã§ãã‚‹ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š ãƒ»ä¾‹å¤–å‡¦ç†ã¨ã®çµ„ã¿åˆã‚ã› ãƒ–ãƒ©ã‚¦ã‚¶ã®ãƒ‡ãƒ™ãƒ­ãƒƒãƒ‘ãƒ¼ãƒ„ãƒ¼ãƒ«ï¼Networkï¼å‡ºåŠ›å…ˆãƒšãƒ¼ã‚¸ã®Previewã‚¿ãƒ–ã§ä¾‹å¤–ã‚¨ãƒ©ãƒ¼ç”»é¢ãŒè¡¨ç¤ºã•ã‚Œã‚‹ï¼ã‚¨ãƒ©ãƒ¼ç”»é¢ã®ä¸Šéƒ¨ã§ï¼Œvar_dump($var)ã®çµæœã‚’ç¢ºèªã§ãã‚‹ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š var_dumpãƒ¡ã‚½ãƒƒãƒ‰ã®çµæœãŒè¡¨ç¤ºã•ã‚Œãªã„ ãƒ»å‡¦ç†ã®é€šéåœ°ç‚¹ã®ç‰¹å®š å‡¦ç†ãŒvar_dumpãƒ¡ã‚½ãƒƒãƒ‰ã‚’é€šéã—ã¦ã„ãªã„ã“ã¨ãŒåŸå› ï¼ä»»æ„ã®å ´æ‰€ã«var_dump(\"æ–‡å­—åˆ—\")ã‚’è¨˜è¿°ã—ï¼Œã©ã“ã«è¨˜è¿°ã—ãŸæ™‚ã«æ–‡å­—åˆ—ãŒå‡ºåŠ›ã•ã‚Œã‚‹ã‹ã‚’ç¢ºèªã™ã‚‹ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š 500ã‚¨ãƒ©ãƒ¼ã®ä½ç½®ã‚’ç‰¹å®šã§ããªã„ ãƒ»ã‚¨ãƒ©ãƒ¼ç®‡æ‰€ã®ç‰¹å®š ä»»æ„ã®å ´æ‰€ã«exitãƒ¡ã‚½ãƒƒãƒ‰ã‚’è¨˜è¿°ã—ï¼Œã©ã“ã«è¨˜è¿°ã—ãŸæ™‚ã«ï¼Œ500ã‚¨ãƒ©ãƒ¼ãŒèµ·ã“ã‚‰ãšã«å‡¦ç†ãŒçµ‚äº†ã™ã‚‹ï¼ˆãƒ¬ã‚¹ãƒãƒ³ã‚¹ç„¡ã—ï¼‰ã‹ã‚’ç¢ºèªã™ã‚‹ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š ãƒ»æ–‡å­—ã‚³ãƒ¼ãƒ‰ã®ä¿®æ­£ æ–‡å­—ã‚³ãƒ¼ãƒ‰ãŒç•°ãªã£ã¦ã„ã‚‹ã“ã¨ãŒåŸå› ï¼ä»¥ä¸‹ã‚’ï¼Œvar_dumpãƒ¡ã‚½ãƒƒãƒ‰ã‚ˆã‚Šã‚‚ä¸Šæµã«è¿½åŠ ã™ã‚‹ï¼ 02. Xdebugã«ã‚ˆã‚‹ãƒ‡ãƒãƒƒã‚° å°å…¥æ–¹æ³• 1. ãƒ­ãƒ¼ã‚«ãƒ«ã‚µãƒ¼ãƒã¸ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ« ãƒ­ãƒ¼ã‚«ãƒ«ã‚µãƒ¼ãƒã§ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œï¼ $ sudo pecl install xdebug-2.2.7 2. Xdebugã®è¨­å®š Xdebugã®ã‚ã‚‹ãƒ­ãƒ¼ã‚«ãƒ«ã‚µãƒ¼ãƒã‹ã‚‰è¦‹ã¦ï¼ŒPhpStromãƒ“ãƒ«ãƒˆã‚¤ãƒ³ã‚µãƒ¼ãƒã‚’æ¥ç¶šå…ˆã¨è¦‹ãªã™ï¼ zend_extension=/usr/lib64/php/modules/xdebug.so xdebug.default_enable=1 # ãƒªãƒ¢ãƒ¼ãƒˆãƒ‡ãƒãƒƒã‚°ã®æœ‰åŠ¹åŒ–ï¼ xdebug.remote_enable=1 # DBGãƒ—ãƒ­ãƒˆã‚³ãƒ« xdebug.remote_handler=dbgp # ã‚¨ãƒ‡ã‚£ã‚¿ã‚µãƒ¼ãƒã®ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆIPã‚¢ãƒ‰ãƒ¬ã‚¹ï¼ xdebug.remote_host=10.0.2.2 # ã‚¨ãƒ‡ã‚£ã‚¿ã‚µãƒ¼ãƒã®é–‹æ”¾ãƒãƒ¼ãƒˆï¼ xdebug.remote_port=9001 # å¸¸ã«ãƒ‡ãƒãƒƒã‚°ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚’å®Ÿè¡Œï¼ xdebug.remote_autostart=1 # DBGpãƒãƒ³ãƒ‰ãƒ©ãƒ¼ã«æ¸¡ã™IDEã‚­ãƒ¼ã‚’è¨­å®šï¼ xdebug.idekey=PhpStorm 3. ãƒ­ãƒ¼ã‚«ãƒ«ã‚µãƒ¼ãƒã‚’å†èµ·å‹• $ sudo service httpd restart 4. PhpStormãƒ“ãƒ«ãƒˆã‚¤ãƒ³ã‚µãƒ¼ãƒã®è¨­å®š ãƒ‡ãƒãƒƒã‚°ã«ãŠã‘ã‚‹é€šä¿¡ã®ä»•çµ„ã¿ 1. ã‚¨ãƒ‡ã‚£ã‚¿ã‚µãƒ¼ãƒã®æ§‹ç¯‰ ã‚¨ãƒ‡ã‚£ã‚¿ã¯ã‚µãƒ¼ãƒã‚’æ§‹ç¯‰ã—ï¼Œãƒãƒ¼ãƒˆ9000ã‚’é–‹æ”¾ã™ã‚‹ï¼ 2. ã‚¨ãƒ‡ã‚£ã‚¿ã‹ã‚‰ãƒ‡ãƒãƒƒã‚¬ãƒ¼ã‚¨ãƒ³ã‚¸ãƒ³ã¸ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆ ãƒ‡ãƒãƒƒã‚¬ãƒ¼ã‚¨ãƒ³ã‚¸ãƒ³ï¼ˆXdebugï¼‰ã¯ãƒãƒ¼ãƒˆ80ã‚’é–‹æ”¾ã™ã‚‹ï¼ã‚¨ãƒ‡ã‚£ã‚¿ã‚µãƒ¼ãƒã¯ã“ã‚Œã«å¯¾ã—ã¦ï¼Œã‚»ãƒƒã‚·ãƒ§ãƒ³é–‹å§‹ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’HTTPãƒ—ãƒ­ãƒˆã‚³ãƒ«ã§é€ä¿¡ã™ã‚‹ï¼ 3. ãƒ‡ãƒãƒƒã‚¬ãƒ¼ã‚¨ãƒ³ã‚¸ãƒ³ã‹ã‚‰ã‚µãƒ¼ãƒã¸ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆ ãƒ‡ãƒãƒƒã‚¬ãƒ¼ã‚¨ãƒ³ã‚¸ãƒ³ï¼ˆXdebugï¼‰ã¯ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚’é–‹å§‹ã—ï¼Œã‚¨ãƒ‡ã‚£ã‚¿ã‚µãƒ¼ãƒã®ãƒãƒ¼ãƒˆ9000ã«å¯¾ã—ã¦ï¼Œãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’é€ä¿¡ã™ã‚‹ï¼ 4. Breakpointã®è¨­å®š ã‚¨ãƒ‡ã‚£ã‚¿ã‚µãƒ¼ãƒã¯ï¼Œãƒ‡ãƒãƒƒã‚¬ãƒ¼ã‚¨ãƒ³ã‚¸ãƒ³ã«å¯¾ã—ã¦ï¼ŒBreakpointã‚’è¨­å®šã™ã‚‹ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é€ä¿¡ã™ã‚‹ï¼ 5. DBGãƒ—ãƒ­ãƒˆã‚³ãƒ«ï¼šDebuggerãƒ—ãƒ­ãƒˆã‚³ãƒ«ã«ã‚ˆã‚‹ç›¸äº’é€šä¿¡ã®ç¢ºç«‹ DBGãƒ—ãƒ­ãƒˆã‚³ãƒ«ã‚’ä½¿ç”¨ã—ï¼Œã‚¨ãƒ‡ã‚£ã‚¿ã‚µãƒ¼ãƒã¨ãƒ‡ãƒãƒƒã‚¬ãƒ¼ã‚¨ãƒ³ã‚¸ãƒ³ã®é–“ã®ç›¸äº’é€šä¿¡ã‚’ç¢ºç«‹ã™ã‚‹ï¼ 6. ç›¸äº’é€šä¿¡ã®å®Ÿè¡Œ ã‚¨ãƒ‡ã‚£ã‚¿ã¯ï¼Œãƒ‡ãƒãƒƒã‚¬ãƒ¼ã‚¨ãƒ³ã‚¸ãƒ³ã«å¯¾ã—ã¦ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã‚’é€ä¿¡ã™ã‚‹ï¼ãƒ‡ãƒãƒƒã‚¬ãƒ¼ã‚¨ãƒ³ã‚¸ãƒ³ã¯ï¼ŒBreakpointã¾ã§ã®å„å¤‰æ•°ã®ä¸­èº«ã‚’è§£æã—ï¼Œã‚¨ãƒ‡ã‚£ã‚¿ã‚µãƒ¼ãƒã«è¿”ä¿¡ã™ã‚‹ï¼ "},"public/software/software_application_backend_go.html":{"url":"public/software/software_application_backend_go.html","title":"ğŸ“– Goã¨ã¯","keywords":"","body":"Goã¨ã¯ ã¯ã˜ã‚ã« æœ¬ã‚µã‚¤ãƒˆã«ã¤ãã¾ã—ã¦ï¼Œä»¥ä¸‹ã‚’ã”èªè­˜ã®ã»ã©å®œã—ããŠé¡˜ã„ã„ãŸã—ã¾ã™ï¼ https://hiroki-it.github.io/tech-notebook-gitbook/ 01. ç‰¹é•· ä¸¦åˆ—å‡¦ç†ãŒå®Ÿè£…å¯èƒ½ å€‹äººçš„ã«Goã§æœ€å¤§ã®ç‰¹é•·ï¼ä¸¦åˆ—å‡¦ç†ã‚’ç°¡å˜ã«å®Ÿè£…ã§ãã‚‹ï¼ä¸¦è¡Œå‡¦ç†ã—ã¦ã‚‚çµæœã«å½±éŸ¿ã—ãªã‘ã‚Œã°ï¼Œå‡¦ç†ã‚’é«˜é€ŸåŒ–ã§ãã‚‹ï¼ä¸¦åˆ—å‡¦ç†ã«ã¤ã„ã¦ã¯ï¼Œæœ¬ãƒãƒ¼ãƒˆå†…ã®èª¬æ˜ã‚’å‚è€ƒã«ã›ã‚ˆï¼ ã»ã©ã‚ˆãã‚·ãƒ³ãƒ—ãƒ« é»’é­”è¡“çš„ãªé–¢æ•°ã‚„ãƒ©ã‚¤ãƒ–ãƒ©ãƒªãŒãªã„ä¸€æ–¹ã§ï¼ŒåŸºæœ¬çš„ãªæ©Ÿèƒ½ã¯æƒã£ã¦ã„ã‚‹ãŸã‚ï¼Œå‡¦ç†ã®å¯èª­æ€§ãŒé«˜ã„ï¼ãã®ãŸã‚ï¼Œå¾Œç¶šè€…ãŒé–‹ç™ºã—ã‚„ã™ãï¼Œå®Ÿè£…ãŒã‚¹ã‚±ãƒ¼ãƒªãƒ³ã‚°ã—ã‚„ã™ã„ï¼ å‹ä»˜ã‘ã®å³æ ¼ã•ã¨å‹æ¨è«– å‹ä»˜ã‘ãƒ«ãƒ¼ãƒ«ãŒå³ã—ãï¼Œå®šç¾©ã«å¿…ãšå‹ä»˜ã‘ãŒå¿…è¦ã§ã‚ã‚‹ä¸€æ–¹ã§ï¼Œå‹æ¨è«–ã§å‹ä»˜ã‘ã®å®Ÿè£…ã‚’çœç•¥ã§ãã‚‹ï¼ãã®ãŸã‚ï¼Œå‹ä»˜ã‘ã®å®Ÿè£…ãªã—ã«é™çš„å‹ä»˜ã‘ã®ãƒ¡ãƒªãƒƒãƒˆã‚’äº«å—ã§ãã‚‹ï¼ç‰¹ã«ãƒã‚°ãŒè¨±ã•ã‚Œãªã„ã‚ˆã†ãªåŸºç›¤éƒ¨åˆ†ã«é©ã—ã¦ã„ã‚‹ï¼ é«˜é€Ÿãªã‚³ãƒ³ãƒ‘ã‚¤ãƒ« ä»–ã®é™çš„å‹ä»˜ã‘è¨€èªã®Javaã®ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã§ã¯ï¼Œã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã‚’ä¸€åº¦ä¸­é–“è¨€èªã«å¤‰æ›ã—ï¼Œãã®å¾Œæ©Ÿæ¢°èªã«ç¿»è¨³ã™ã‚‹ï¼ã—ã‹ã—Goã®ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã§ã¯ï¼Œãƒ—ãƒ­ã‚°ãƒ©ãƒ ã‚’ç›´æ¥æ©Ÿæ¢°èªã«ç¿»è¨³ã™ã‚‹ãŸã‚ï¼Œã‚ˆã‚Šé«˜é€Ÿã§ã‚ã‚‹ï¼ ãƒ¡ãƒ¢ãƒªã®å®‰å…¨æ€§ã‚’æ‹…ä¿ã™ã‚‹ä»•çµ„ã¿ ãƒ¡ãƒ¢ãƒªã‚¢ãƒ‰ãƒ¬ã‚¹ã«å‰²ã‚Šå½“ã¦ã‚‰ã‚Œã¦ã„ã‚‹æ•°å€¤åŒå£«ã‚’æ¼”ç®—ã™ã‚‹ã€ãƒã‚¤ãƒ³ã‚¿æ¼”ç®—ã€ã®æ©Ÿèƒ½ã‚’æ„å›³ã—ã¦å»ƒæ­¢ã—ã¦ã„ã‚‹ï¼ãƒã‚¤ãƒ³ã‚¿æ¼”ç®—ã®ä¾‹ã¨ã—ã¦ï¼Œ10ç•ªã‚¢ãƒ‰ãƒ¬ã‚¹ã¨20ç•ªã‚¢ãƒ‰ãƒ¬ã‚¹ã®æ•°å€¤ã‚’è¶³ã—ã¦ï¼Œ30ç•ªã‚¢ãƒ‰ãƒ¬ã‚¹ã«æ–°ã—ãå‰²ã‚Šå½“ã¦ã‚‹ï¼Œã¨ã„ã£ãŸå‡¦ç†ã‚’è¡Œã†ï¼ã“ã®æ™‚ï¼Œä½•ã‚‰ã‹ã®åŸå› ã§ç‰‡æ–¹ã®ã‚¢ãƒ‰ãƒ¬ã‚¹ãŒæ–‡å­—åˆ—ã ã£ãŸå ´åˆï¼Œ30ç•ªã‚¢ãƒ‰ãƒ¬ã‚¹ã«äºˆæœŸã—ãªã„å€¤ï¼ˆæ•°å€¤ï¼‹æ–‡å­—åˆ—ï¼‰ãŒå‰²ã‚Šå½“ã¦ã‚‰ã‚Œã‚‹ã“ã¨ã«ãªã‚‹ï¼ã“ã‚Œã¯ï¼Œä¸å…·åˆã‚„æ‚ªæ„ã‚ã‚‹æ“ä½œã«ç¹‹ãŒã‚‹ãŸã‚ï¼ŒGoã§ã¯ãƒã‚¤ãƒ³ã‚¿æ¼”ç®—å­ã®æ©Ÿèƒ½ãŒãªã„ï¼ ã‚¯ãƒ©ã‚¹ã‚„ç¶™æ‰¿ãŒãªã„ ç¶™æ‰¿ã¯ã‚«ãƒ—ã‚»ãƒ«åŒ–ã‚’å£Šã™ãŸã‚ï¼Œã“ã‚Œã‚’å›é¿ã§ãã‚‹ã€å§”è­²ã€ã®æ–¹ãŒå„ªã‚Œã¦ã„ã‚‹ã¨ã•ã‚Œã¦ã„ã‚‹ï¼ãã®ãŸã‚ï¼Œæ€æƒ³ã¨ã—ã¦ã‚¯ãƒ©ã‚¹ã‚„ç¶™æ‰¿ã‚’å»ƒæ­¢ã—ã¦ã„ã‚‹ï¼åŸ‹ã‚è¾¼ã¿ã«ã‚ˆã£ã¦ï¼Œå§”è­²ã‚’å®Ÿç¾ã™ã‚‹ï¼åŸ‹ã‚è¾¼ã¿ã«ã¤ã„ã¦ã¯ï¼Œæœ¬ãƒãƒ¼ãƒˆå†…ã®èª¬æ˜ã‚’å‚è€ƒã«ã›ã‚ˆï¼ è£œè¶³ 02. å®Ÿè£…è¦å‰‡ ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹é€  ãƒ»$GOPATH ãƒ‘ã‚¹ã¯å¥½ã¿ã§ã‚ã‚‹ãŒï¼Œ$HOME/goã¨ã™ã‚‹ã“ã¨ãŒå¤šã„ï¼ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹é€ ã®ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹ã¯ä»¥ä¸‹ã‚’å‚è€ƒã«ã›ã‚ˆï¼ å‚è€ƒï¼šhttps://github.com/golang-standards/project-layout $GOPATH # ä¾‹ãˆã°ï¼Œã€$HOME/goã€ã¨ã™ã‚‹ï¼ â”œâ”€â”€ bin â”œâ”€â”€ pkg â””â”€â”€ src â”œâ”€â”€ build # Dockerfileã‚’é…ç½®ã™ã‚‹ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª â”œâ”€â”€ cmd # main.goãƒ•ã‚¡ã‚¤ãƒ«ã‚„ï¼Œã‚µãƒ–mainãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’é…ç½®ã™ã‚‹ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª â”‚ â”œâ”€â”€ main.go â”‚ â””â”€â”€ foo â”‚ â””â”€â”€ foo.go â”‚ â”œâ”€â”€ configs â”‚ â””â”€â”€ envrc.template â”‚ â”œâ”€â”€ docsï¼ˆãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’é…ç½®ã™ã‚‹ï¼‰ â”‚ â”œâ”€â”€ BUG.md â”‚ â”œâ”€â”€ ROUTING.md â”‚ â””â”€â”€ TODO.md â”‚ â”œâ”€â”€ internal # cmdãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªå†…ã§ã‚¤ãƒ³ãƒãƒ¼ãƒˆã•ã›ãªã„ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é…ç½®ã™ã‚‹ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª â”‚ â””â”€â”€ pkg â”‚ â”œâ”€â”€ pkg # cmdãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªå†…ã§ã‚¤ãƒ³ãƒãƒ¼ãƒˆã™ã‚‹ç‹¬è‡ªgoãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’é…ç½®ã™ã‚‹ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª â”‚ â””â”€â”€ public â”‚ â””â”€â”€ add.go â”‚ â”œâ”€â”€ scripts â”‚ â””â”€â”€ Makefile â”‚ â”œâ”€â”€ test â”‚ â””â”€â”€ test.go â”‚ â””â”€â”€ webï¼ˆç”»åƒï¼ŒCSSï¼Œãªã©ï¼‰ â”œâ”€â”€ static â””â”€â”€ template ãƒ»bin ãƒ“ãƒ«ãƒ‰ã•ã‚ŒãŸã‚¢ãƒ¼ãƒ†ã‚£ãƒ•ã‚¡ã‚¯ãƒˆï¼ˆãƒã‚¤ãƒŠãƒªãƒ•ã‚¡ã‚¤ãƒ«ï¼‰ã‚’é…ç½®ã™ã‚‹ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªï¼ãƒã‚¤ãƒŠãƒªãƒ•ã‚¡ã‚¤ãƒ«åã‚’æŒ‡å®šã™ã‚‹ã¨ï¼Œå‡¦ç†ã‚’å®Ÿè¡Œã§ãã‚‹ï¼ ãƒ»pkg ã‚¢ãƒ¼ãƒ†ã‚£ãƒ•ã‚¡ã‚¯ãƒˆã¨ã¯åˆ¥ã«ç”Ÿæˆã•ã‚Œã‚‹ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é…ç½®ã™ã‚‹ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª ãƒ»src ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã‚’é…ç½®ã™ã‚‹ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª ãƒ•ã‚¡ã‚¤ãƒ«ã®è¦ç´  ãƒ»package åå‰ç©ºé–“ã¨ã—ã¦ï¼Œãƒ‘ãƒƒã‚±ãƒ¼ã‚¸åã‚’å®šç¾©ã™ã‚‹ï¼ä¸€ã¤ã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªå†…ã§ã¯ï¼Œä¸€ã¤ã®ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸åã—ã‹å®£è¨€ã§ããªã„ï¼ package main ãƒ»import ãƒ“ãƒ«ãƒˆã‚¤ãƒ³ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ï¼Œå†…éƒ¨ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ï¼Œäº‹å‰ã«ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚ŒãŸå¤–éƒ¨ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’èª­ã¿è¾¼ã‚€ï¼ import \"\" äº’ã„ã«ã‚¤ãƒ³ãƒãƒ¼ãƒˆã—åˆã†ã¨ï¼Œå¾ªç’°å‚ç…§ã‚¨ãƒ©ãƒ¼ï¼ˆmport cycle not allowedï¼‰ã«ãªã‚‹ï¼ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã¨æ§‹é€ ä½“ã®ä¸¡æ–¹ã‚’åŒã˜ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã«ç½®ã„ã¦ã„ã‚‹ã¨ï¼Œã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ãŒä»–ã‹ã‚‰ã‚¤ãƒ³ãƒãƒ¼ãƒˆã•ã‚Œï¼Œæ§‹é€ ä½“ãŒä»–ã‚’ã‚¤ãƒ³ãƒãƒ¼ãƒˆã™ã‚‹ã‚ˆã†ã«ãªã‚Šï¼Œèµ·ã“ã‚Šã‚„ã™ã„ï¼ ãƒ»func è©³ã—ãã¯ï¼Œé–¢æ•°ã‚’å‚è€ƒã«ã›ã‚ˆï¼ func xxx() { } ãƒ»æ–‡ã®åŒºåˆ‡ã‚Š Goã§ã¯æ–‡ã®å‡¦ç†ã¯ã‚»ãƒŸã‚³ãƒ­ãƒ³ã§åŒºåˆ‡ã‚‰ã‚Œã‚‹ï¼ãŸã ã—ï¼Œã‚»ãƒŸã‚³ãƒ­ãƒ³ã¯ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«æ™‚ã«è£œå®Œã•ã‚Œï¼Œå®Ÿè£…æ™‚ã«ã¯çœç•¥ã§ãã‚‹ï¼ å‘½åè¦å‰‡ ãƒ»ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªå å°æ–‡å­—ä¸€å˜èªã¾ãŸã¯ã‚±ãƒãƒ–ã‚±ãƒ¼ã‚¹ã§å‘½åã™ã‚‹ï¼ãƒ“ãƒ«ãƒ‰æ™‚ã«ã‚·ãƒ³ã‚¿ãƒƒã‚¯ã‚¹ã‚¨ãƒ©ãƒ¼ã¨ãªã‚‹å¯èƒ½æ€§ãŒã‚ã‚‹ãŸã‚ï¼Œå¯èƒ½ãªé™ã‚Šãƒã‚¤ãƒ•ãƒ³ã‚’ä½¿ç”¨ã—ãªã„æ–¹ãŒè‰¯ã„ï¼ ãƒ»ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸å å°æ–‡å­—ä¸€å˜èªã§å‘½åã™ã‚‹ï¼ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªåã«å°æ–‡å­—ä¸€å˜èªãŒä½¿ç”¨ã•ã‚Œã¦ã„ã‚‹å ´åˆã¯ï¼Œã“ã‚Œã¨åŒã˜ã«ã™ã‚‹ã¨ãªãŠè‰¯ã„ï¼ã¾ãŸï¼Œå‡¦ç†ä¸­ã®å¤‰æ•°åã¨è¢«ã‚‹ã¨ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®ã‚¤ãƒ³ãƒãƒ¼ãƒˆã«å¤±æ•—ã™ã‚‹ãŸã‚ï¼Œå¤‰æ•°åã¨è¢«ã‚‰ãªã„ã‚ˆã†ã«ï¼Œã§ãã‚‹ã ã‘çœç•¥ã—ãªã„åå‰ã®æ–¹ãŒè‰¯ã„ï¼ãŸã ã—ï¼Œãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã«é–¢ã—ã¦ã¯ï¼Œãƒ‘ãƒƒã‚±ãƒ¼ã‚¸åã‚’ã€xxxxx_testã€ã¨ã—ã¦ã‚ˆã„ï¼ å‚è€ƒï¼šhttps://github.com/golang/go/wiki/CodeReviewComments#package-names ãƒ»ãƒ•ã‚¡ã‚¤ãƒ«å å°æ–‡å­—ä¸€å˜èªã¾ãŸã¯ã‚¹ãƒãƒ¼ã‚¯ã‚±ãƒ¼ã‚¹ã§å‘½åã™ã‚‹ï¼ãƒ•ã‚¡ã‚¤ãƒ«åã¨ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸åã¯åˆã‚ã›ã‚‹å¿…è¦ã¯ãªã„ãŒï¼Œç‹¬è‡ªãƒ«ãƒ¼ãƒ«ã‚’è¨­ã‘ã¦ã‚‚è‰¯ã„ï¼ä¾‹ãˆã°ãƒ‰ãƒ¡ã‚¤ãƒ³é§†å‹•è¨­è¨ˆã®å ´åˆã«ï¼Œãƒ«ãƒ¼ãƒˆã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã®ãƒ•ã‚¡ã‚¤ãƒ«åã¨ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸åã‚’åˆã‚ã›ã‚‹ã‚ˆã†ã«å·¥å¤«ã§ãã‚‹ï¼ å‚è€ƒï¼šhttps://ja.stackoverflow.com/q/41599 å‚è€ƒï¼š ãƒ»é–¢æ•°ï¼Œtypeï¼Œæ§‹é€ ä½“ ã‚¢ãƒƒãƒ‘ãƒ¼ã‚­ãƒ£ãƒ¡ãƒ«ã‚±ãƒ¼ã‚¹ã¾ãŸã¯ãƒ­ãƒ¼ãƒ¯ãƒ¼ã‚­ãƒ£ãƒ¡ãƒ«ã‚±ãƒ¼ã‚¹ã§å‘½åã™ã‚‹ï¼ ãƒ»ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹å æœ«å°¾ã«ã€erã€ã‚’ã¤ã‘ã‚‹ï¼ å‚è€ƒï¼šhttps://golang.org/doc/effective_go#interface-names ãƒ»ãƒ¬ã‚·ãƒ¼ãƒå æ§‹é€ ä½“åã®é ­ä¸€æ–‡å­—ã¾ãŸã¯é ­äºŒæ–‡å­—ã‚’å–ã£ã¦å‘½åã™ã‚‹ï¼ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å†…ã§æ§‹é€ ä½“åã®é ­æ–‡å­—ãŒé‡è¤‡ã™ã‚‹ã¨ï¼ŒåŒã˜ãƒ¬ã‚·ãƒ¼ãƒåã®æ§‹é€ ä½“ãŒä¹±ç«‹ã—ã¦ã—ã¾ã†ãŸã‚ï¼Œã“ã‚Œã‚’é˜²ããŸã‚ã«äºŒæ–‡å­—ã‚’å–ã‚‹ã¨ã‚ˆã„ï¼ã¾ãŸï¼Œä¿®é£¾èªã¨çµ„ã¿åˆã‚ã›ã¦æ§‹æˆã•ã‚Œã‚‹æ§‹é€ ä½“åã®å ´åˆï¼Œè¢«ä¿®é£¾èªã®é ­äºŒæ–‡å­—ã‚’å–ã‚‹ï¼ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆæŒ‡å‘ã§ä½¿ã‚ã‚Œã‚‹ã€thisã€ã€selfã€ å‚è€ƒï¼š https://github.com/golang/go/wiki/CodeReviewComments#receiver-names https://yyh-gl.github.io/tech-blog/blog/go-ddd-entity-vo/ ï¼Šä¾‹ï¼Š httpClientã§ã‚ã‚Œã°ï¼Œä¿®é£¾èªã¯ã€httpã€è¢«ä¿®é£¾èªã€clientã€ã§ã‚ã‚‹ï¼ãã®ãŸã‚ï¼Œãƒ¬ã‚·ãƒ¼ãƒåã¾ãŸã¯å¼•æ•°åã§ã¯ã€clã€ã¨ã™ã‚‹ï¼` ãƒ»ä¸€æ™‚çš„ãªå¤‰æ•°å è‹±å˜èªã®é ­ä¸€æ–‡å­—ï¼Œé ­äºŒæ–‡å­—ï¼Œç•¥èªï¼Œã§å‘½åã™ã‚‹ï¼ã“ã‚Œã¯ï¼Œå®Ÿéš›ã®å‡¦ç†ã‚’å¼·èª¿ã—ï¼Œå¤‰æ•°ã‚’ç›®ç«‹ãŸãªãã™ã‚‹ãŸã‚ã§ã‚ã‚‹ï¼ãŸã ã—ï¼Œã‚¹ã‚³ãƒ¼ãƒ—ã®å¤§ããªå¤‰æ•°ã«çœç•¥ã—ãŸåå‰ã‚’ã¤ã‘ã‚‹ã¨ï¼Œé‡è¤‡ã™ã‚‹å¯èƒ½æ€§ãŒã‚ã‚‹ãŸã‚ï¼Œçœç•¥ã›ãšã«ãƒ­ãƒ¼ãƒ¯ãƒ¼ã‚­ãƒ£ãƒ¡ãƒ«ã‚±ãƒ¼ã‚¹ã§å‘½åã—ã¦ã‚‚ã‚ˆã„ï¼ å‚è€ƒï¼šhttps://github.com/golang/go/wiki/CodeReviewComments#variable-names çœç•¥åã«ã¤ã„ã¦ã¯ï¼Œç•¥èªæ¤œç´¢ã‚µã‚¤ãƒˆã§æ¢ã™ï¼ã‚ã‚‹ã„ã¯ï¼ŒGoãƒªãƒ•ã‚¡ãƒ¬ãƒ³ã‚¹ã‹ã‚‰ãã®å˜èªãŒã©ã†çœç•¥ã•ã‚Œã¦ã„ã‚‹ã‹ã‚’æ¢ã—ã¦ã‚‚ã‚ˆã„ï¼ å‚è€ƒï¼šhttps://www.allacronyms.com/ ãƒ»ãƒ¢ãƒƒã‚¯ã®å¤‰æ•° ãƒ¢ãƒƒã‚¯æ§‹é€ ä½“ã‚’ä»£å…¥ã™ã‚‹ãŸã‚ã®å¤‰æ•°ã¯ï¼Œã€mã€ã¨ã™ã‚‹ï¼ ãƒ»erroræ§‹é€ ä½“ã®å¤‰æ•° erroræ§‹é€ ä½“ã‚’å¤‰æ•°ã«ä»£å…¥ã™ã‚‹å ´åˆï¼Œã€Errã€ã¨ãƒ—ãƒ¬ãƒ•ã‚£ã‚¯ã‚¹ã‚’ã¤ã‘ã‚‹ï¼ ãƒ»ã‚­ãƒ¼åã®æ¤œè¨¼ ãƒãƒƒãƒ—å‹ã‚„ã‚¹ãƒ©ã‚¤ã‚¹å‹ã«ãŠã„ã¦ï¼ŒæŒ‡å®šã—ãŸã‚­ãƒ¼åãŒå­˜åœ¨ã™ã‚‹ã‹æ¤œè¨¼ã™ã‚‹å ´åˆï¼ŒçœŸå½å€¤ã‚’ä»£å…¥ã™ã‚‹å¤‰æ•°ã‚’ã€okã€ã¨ã™ã‚‹ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š package main import ( \"fmt\" \"log\" ) func main() { userIds := map[string]int{ \"user_id\": 1, } // user_idã‚­ãƒ¼ãŒå­˜åœ¨ã™ã‚‹å ´åˆï¼Œokã«trueãŒè¿”å´ã•ã‚Œã‚‹ï¼ userId, ok := userIds[\"user_id\"] if ok == false { log.Fatal(\"user_id does not exist\") // 2009/11/10 23:00:00 user_id does not exist } fmt.Printf(\"%#v\\n\", userId) // 1 } ãã®ä»–ã®ãŠä½œæ³• ãƒ»ã‚³ãƒ¡ãƒ³ãƒˆã®æ›¸å¼ å‚è€ƒï¼šhttps://github.com/golang/go/wiki/CodeReviewComments#comment-sentences ãƒ»Uberé¢¨ã®ãŠä½œæ³• Uberç¤¾ãŒæ¡ç”¨ã—ã¦ã„ã‚‹ãŠä½œæ³•ï¼ å‚è€ƒï¼šhttps://github.com/uber-go/guide/blob/master/style.md "},"public/software/software_application_backend_go_command_and_configuration.html":{"url":"public/software/software_application_backend_go_command_and_configuration.html","title":"ğŸ“– Goã‚³ãƒãƒ³ãƒ‰ã¨è¨­å®š","keywords":"","body":"Goã‚³ãƒãƒ³ãƒ‰ã¨è¨­å®š ã¯ã˜ã‚ã« æœ¬ã‚µã‚¤ãƒˆã«ã¤ãã¾ã—ã¦ï¼Œä»¥ä¸‹ã‚’ã”èªè­˜ã®ã»ã©å®œã—ããŠé¡˜ã„ã„ãŸã—ã¾ã™ï¼ https://hiroki-it.github.io/tech-notebook-gitbook/ 01. ã‚³ãƒãƒ³ãƒ‰ install ãƒ»ã‚ªãƒ—ã‚·ãƒ§ãƒ³ç„¡ã— ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã¨å¤–éƒ¨ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã«å¯¾ã—ã¦buildã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ï¼Œ$GOPATHä»¥ä¸‹ã®binãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã¾ãŸã¯pkgãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ï¼ˆé…ç½®ï¼‰ã™ã‚‹ï¼å†…éƒ¨ã¾ãŸã¯å¤–éƒ¨ã®ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã‹ã‚‰ãƒ“ãƒ«ãƒ‰ã•ã‚ŒãŸã‚¢ãƒ¼ãƒ†ã‚£ãƒ•ã‚¡ã‚¯ãƒˆï¼ˆãƒã‚¤ãƒŠãƒªãƒ•ã‚¡ã‚¤ãƒ«ï¼‰ã§ã‚ã‚Œã°binãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«é…ç½®ã—ï¼Œãã‚Œä»¥å¤–ï¼ˆä¾‹ï¼š.aãƒ•ã‚¡ã‚¤ãƒ«ï¼‰ã§ã‚ã‚Œã°pkgãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«é…ç½®ã™ã‚‹ï¼ $ go install get ãƒ»ã‚ªãƒ—ã‚·ãƒ§ãƒ³ç„¡ã— æŒ‡å®šã—ãŸãƒ‘ã‚¹ã‹ã‚‰ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ï¼Œã“ã‚Œã«å¯¾ã—ã¦installã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã™ã‚‹ï¼ã“ã‚Œã«ã‚ˆã‚Šï¼Œå†…éƒ¨ã¾ãŸã¯å¤–éƒ¨ã®ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã‹ã‚‰ãƒ“ãƒ«ãƒ‰ã•ã‚ŒãŸã‚¢ãƒ¼ãƒ†ã‚£ãƒ•ã‚¡ã‚¯ãƒˆï¼ˆãƒã‚¤ãƒŠãƒªãƒ•ã‚¡ã‚¤ãƒ«ï¼‰ã§ã‚ã‚Œã°binãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«é…ç½®ã—ï¼Œãã‚Œä»¥å¤–ï¼ˆä¾‹ï¼š.aãƒ•ã‚¡ã‚¤ãƒ«ï¼‰ã§ã‚ã‚Œã°pkgãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«é…ç½®ã™ã‚‹ï¼ $ go get build ãƒ»ã‚ªãƒ—ã‚·ãƒ§ãƒ³ç„¡ã— æŒ‡å®šã—ãŸãƒ‘ã‚¹ã‚’ãƒ“ãƒ«ãƒ‰å¯¾è±¡ã¨ã—ã¦ï¼Œãƒ“ãƒ«ãƒ‰ã®ã‚¢ãƒ¼ãƒ†ã‚£ãƒ•ã‚¡ã‚¯ãƒˆã‚’ç”Ÿæˆã™ã‚‹ï¼xxxxx_test.goãƒ•ã‚¡ã‚¤ãƒ«ã¯ãƒ“ãƒ«ãƒ‰ã‹ã‚‰è‡ªå‹•çš„ã«é™¤å¤–ã•ã‚Œã‚‹ï¼ # cmdãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’ãƒ“ãƒ«ãƒ‰å¯¾è±¡ã¨ã—ã¦ï¼Œãƒ«ãƒ¼ãƒˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«cmdã‚¢ãƒ¼ãƒ†ã‚£ãƒ•ã‚¡ã‚¯ãƒˆã‚’ç”Ÿæˆã™ã‚‹ï¼ $ go build ./cmd ãƒ»-o æŒ‡å®šã—ãŸãƒ‘ã‚¹ã«ãƒ“ãƒ«ãƒ‰ã®ã‚¢ãƒ¼ãƒ†ã‚£ãƒ•ã‚¡ã‚¯ãƒˆã‚’ç”Ÿæˆã™ã‚‹ï¼ãƒ“ãƒ«ãƒ‰å¯¾è±¡ãƒ‘ã‚¹ã‚’æŒ‡å®šã—ãªã„å ´åˆï¼Œãƒ«ãƒ¼ãƒˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã®goãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ“ãƒ«ãƒ‰ã®å¯¾è±¡ã¨ã™ã‚‹ï¼ # ãƒ«ãƒ¼ãƒˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªå†…ã®goãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ“ãƒ«ãƒ‰å¯¾è±¡ã¨ã—ã¦ # $HOME/go/binãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ãƒ«ãƒ¼ãƒˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªåã‚¢ãƒ¼ãƒ†ã‚£ãƒ•ã‚¡ã‚¯ãƒˆã‚’ç”Ÿæˆã™ã‚‹ï¼ $ go build -o $HOME/go/bin ã¾ãŸï¼ŒæŒ‡å®šã—ãŸãƒ‘ã‚¹å†…ã®goãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ“ãƒ«ãƒ‰å¯¾è±¡ã¨ã—ã¦ï¼ŒæŒ‡å®šã—ãŸãƒ‘ã‚¹ã«ãƒ“ãƒ«ãƒ‰ã®ã‚¢ãƒ¼ãƒ†ã‚£ãƒ•ã‚¡ã‚¯ãƒˆã‚’ç”Ÿæˆã™ã‚‹ã“ã¨ã‚‚ã§ãã‚‹ï¼ # cmdãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªå†…ã®goãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ“ãƒ«ãƒ‰å¯¾è±¡ã¨ã—ã¦ # $HOME/go/binãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«cmdã‚¢ãƒ¼ãƒ†ã‚£ãƒ•ã‚¡ã‚¯ãƒˆã‚’ç”Ÿæˆã™ã‚‹ï¼ $ go build -o $HOME/go/bin ./cmd ã¡ãªã¿ã«ï¼Œäº‹å‰ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã«å¤±æ•—ã«ï¼Œãƒ“ãƒ«ãƒ‰å¯¾è±¡ãŒå­˜åœ¨ã—ã¦ã„ãªã„ã¨ï¼Œä»¥ä¸‹ã®ã‚ˆã†ãªã‚¨ãƒ©ãƒ¼ã«ãªã‚‹ï¼ package xxxxx is not in GOROOT (/usr/local/go/src/xxxxx) env ãƒ»ã‚ªãƒ—ã‚·ãƒ§ãƒ³ç„¡ã— Goã«é–¢ã™ã‚‹ç’°å¢ƒå¤‰æ•°ã‚’å‡ºåŠ›ã™ã‚‹ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š $ go env # go.modã®æœ‰åŠ¹åŒ– GO111MODULE=\"on\" # ã‚³ãƒ³ãƒ‘ã‚¤ãƒ©ãŒå®Ÿè¡Œã•ã‚Œã‚‹CPUã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ GOARCH=\"amd64\" # installã‚³ãƒãƒ³ãƒ‰ã«ã‚ˆã‚‹ã‚¢ãƒ¼ãƒ†ã‚£ãƒ•ã‚¡ã‚¯ãƒˆã‚’é…ç½®ã™ã‚‹ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªï¼ˆæŒ‡å®šç„¡ã—ã®å ´åˆï¼Œ$GOPATH/binï¼‰ GOBIN=\"\" GOCACHE=\"/root/.cache/go-build\" GOENV=\"/root/.config/go/env\" GOEXE=\"\" GOFLAGS=\"\" GOHOSTARCH=\"amd64\" # ã‚³ãƒ³ãƒ‘ã‚¤ãƒ©ãŒå®Ÿè¡Œã•ã‚Œã‚‹OS GOHOSTOS=\"linux\" GOINSECURE=\"\" GOMODCACHE=\"/go/pkg/mod\" GONOPROXY=\"\" GONOSUMDB=\"\" GOOS=\"linux\" # ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ãŒé…ç½®ã•ã‚Œã‚‹ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª GOPATH=\"/go\" GOPRIVATE=\"\" GOPROXY=\"https://proxy.golang.org,direct\" # Goæœ¬ä½“ã‚’é…ç½®ã™ã‚‹ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª GOROOT=\"/usr/local/go\" GOSUMDB=\"sum.golang.org\" GOTMPDIR=\"\" GOTOOLDIR=\"/usr/local/go/pkg/tool/linux_amd64\" GCCGO=\"gccgo\" AR=\"ar\" CC=\"gcc\" CXX=\"g++\" # cè¨€èªè£½ã®ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®æœ‰åŠ¹åŒ–ï¼ç„¡åŠ¹åŒ–ã—ãªã„ã¨ï¼Œvetã‚³ãƒãƒ³ãƒ‰ãŒå¤±æ•—ã™ã‚‹ï¼ CGO_ENABLED=\"0\" GOMOD=\"/go/src/go.mod\" CGO_CFLAGS=\"-g -O2\" CGO_CPPFLAGS=\"\" CGO_CXXFLAGS=\"-g -O2\" CGO_FFLAGS=\"-g -O2\" CGO_LDFLAGS=\"-g -O2\" PKG_CONFIG=\"pkg-config\" GOGCCFLAGS=\"-fPIC -m64 -fmessage-length=0 -fdebug-prefix-map=/tmp/go-build887404645=/tmp/go-build -gno-record-gcc-switches\" fmt ãƒ»ã‚ªãƒ—ã‚·ãƒ§ãƒ³ç„¡ã— æŒ‡å®šã—ãŸãƒ‘ã‚¹ã®ãƒ•ã‚¡ã‚¤ãƒ«ã®ã‚¤ãƒ³ãƒ‡ãƒ³ãƒˆã‚’æ•´å½¢ã™ã‚‹ï¼ãƒ‘ã‚¹ã¨ã—ã¦ã€./...ã€ã‚’æŒ‡å®šã—ã¦ï¼Œå†å¸°çš„ã«å®Ÿè¡Œã™ã‚‹ã®ãŒãŠã™ã™ã‚ï¼ $ go fmt ./... vet ãƒ»ã‚ªãƒ—ã‚·ãƒ§ãƒ³ç„¡ã— æŒ‡å®šã—ãŸãƒ‘ã‚¹ã®ãƒ•ã‚¡ã‚¤ãƒ«ã«å¯¾ã—ã¦é™çš„è§£æã‚’è¡Œã†ï¼ãƒ‘ã‚¹ã¨ã—ã¦ã€./...ã€ã‚’æŒ‡å®šã—ã¦ï¼Œå†å¸°çš„ã«å®Ÿè¡Œã™ã‚‹ã®ãŒãŠã™ã™ã‚ï¼ $ go vet ./... test ãƒ»ã‚ªãƒ—ã‚·ãƒ§ãƒ³ç„¡ã— æŒ‡å®šã—ãŸãƒ‘ã‚¹ã®xxxxx_test.goãƒ•ã‚¡ã‚¤ãƒ«ã§ã€Testã€ã‹ã‚‰å§‹ã¾ã‚‹ãƒ†ã‚¹ãƒˆé–¢æ•°ã‚’å®Ÿè¡Œã™ã‚‹ï¼testãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªå†…ã‚’å†å¸°çš„ã«å®Ÿè¡Œã™ã‚‹ã®ãŒãŠã™ã™ã‚ï¼ $ go test ./... ãƒ»-v ãƒ†ã‚¹ãƒˆæ™‚ã«ãƒ†ã‚¹ãƒˆã®å®Ÿè¡Œæ™‚é–“ã‚’å‡ºåŠ›ã™ã‚‹ï¼ $ go test -v ./... ãƒ»-cover ãƒ†ã‚¹ãƒˆæ™‚ã«ï¼Œxxxxx_test.goãƒ•ã‚¡ã‚¤ãƒ«ãŒã‚ã‚‹ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸å†…ãƒ•ã‚¡ã‚¤ãƒ«ã®å‘½ä»¤ç¶²ç¾…ã®ç¶²ç¾…ç‡ã‚’è§£æã™ã‚‹ï¼åå¯¾ã«ï¼Œxxxxx_test.goãƒ•ã‚¡ã‚¤ãƒ«ãŒãªã‘ã‚Œã°ï¼Œãã®ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®ç¶²ç¾…ç‡ã¯è§£æã—ãªã„ï¼ç¶²ç¾…æ¡ä»¶ã«ã¤ã„ã¦ã¯ï¼Œä»¥ä¸‹ã®ãƒªãƒ³ã‚¯ã‚’å‚è€ƒã«ã›ã‚ˆï¼ å‚è€ƒï¼šhttps://hiroki-it.github.io/tech-notebook-gitbook/public/software/software_application_backend_php_testing_based_on_code.html $ go test -cover ./... "},"public/software/software_application_backend_go_logic_method_data.html":{"url":"public/software/software_application_backend_go_logic_method_data.html","title":"ğŸ“– ãƒ¡ã‚½ãƒƒãƒ‰ï¼Œãƒ‡ãƒ¼ã‚¿","keywords":"","body":"ãƒ¡ã‚½ãƒƒãƒ‰ï¼Œãƒ‡ãƒ¼ã‚¿ ã¯ã˜ã‚ã« æœ¬ã‚µã‚¤ãƒˆã«ã¤ãã¾ã—ã¦ï¼Œä»¥ä¸‹ã‚’ã”èªè­˜ã®ã»ã©å®œã—ããŠé¡˜ã„ã„ãŸã—ã¾ã™ï¼ https://hiroki-it.github.io/tech-notebook-gitbook/ 01. ãƒ‡ãƒ¼ã‚¿å‹ ãƒ‡ãƒ¼ã‚¿å‹ã®ç¨®é¡ ãƒ»ãƒ‡ãƒ¼ã‚¿å‹ã®åˆæœŸå€¤ ãƒ‡ãƒ¼ã‚¿å‹ã«ã¯ï¼Œå€¤ãŒä»£å…¥ã•ã‚Œã¦ã„ãªã„æ™‚ï¼ŒåˆæœŸå€¤ãŒä»£å…¥ã•ã‚Œã¦ã„ã‚‹ï¼ ãƒ»ãƒ—ãƒªãƒŸãƒ†ã‚£ãƒ–å‹ã«å±ã™ã‚‹ãƒ‡ãƒ¼ã‚¿å‹ ãƒ‡ãƒ¼ã‚¿å‹ è¡¨è¨˜ åˆæœŸå€¤ æ•°å€¤ intï¼Œfloat 0 æ–‡å­—åˆ— string \"\"ï¼ˆç©ºæ–‡å­—ï¼‰ çœŸå½å€¤ boolean false ãƒ»åˆæˆå‹ã«å±ã™ã‚‹ãƒ‡ãƒ¼ã‚¿å‹ ãƒ‡ãƒ¼ã‚¿å‹ è¡¨è¨˜ åˆæœŸå€¤ æ§‹é€ ä½“ struct é…åˆ— [i] ãƒ»å‚ç…§å‹ã«å±ã™ã‚‹ãƒ‡ãƒ¼ã‚¿å‹ ãƒ‡ãƒ¼ã‚¿å‹ è¡¨è¨˜ åˆæœŸå€¤ ãƒã‚¤ãƒ³ã‚¿ * nil ã‚¹ãƒ©ã‚¤ã‚¹ [] nilï¼ˆè¦ç´ æ•°ï¼Œå®¹é‡ï¼š0ï¼‰ ãƒãƒƒãƒ— nil ãƒãƒ£ãƒãƒ« nil ãƒ—ãƒªãƒŸãƒ†ã‚£ãƒ–å‹ã®ã¾ã¨ã‚ ãƒ»ãƒ—ãƒªãƒŸãƒ†ã‚£ãƒ–å‹ã¨ã¯ ï¼Šå®Ÿè£…ä¾‹ï¼Š // å®šç¾©ï¼ˆåˆæœŸå€¤ã¨ã—ã¦ã€0ã€ãŒå‰²ã‚Šå½“ã¦ã‚‰ã‚Œã‚‹ï¼‰ var number int // ä»£å…¥ number = 5 ãƒ»Defined Typeã«ã‚ˆã‚‹ç‹¬è‡ªã®ãƒ—ãƒªãƒŸãƒ†ã‚£ãƒ–å‹ Defined Typeã‚’ä½¿ç”¨ã—ã¦ï¼Œç‹¬è‡ªã®ãƒ—ãƒªãƒŸãƒ†ã‚£ãƒ–å‹ã‚’å®šç¾©ã™ã‚‹ï¼å…ƒã®ãƒ—ãƒªãƒŸãƒ†ã‚£ãƒ–å‹ã¨ã¯äº’æ›æ€§ãŒãªããªã‚‹ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š intå‹ã‚’å…ƒã«ï¼ŒAgeå‹ã‚’å®šç¾©ã™ã‚‹ï¼ type Age int ï¼Šå®Ÿè£…ä¾‹ï¼Š ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®å‹ã‚’å…ƒã«ï¼ŒMyAppWriterå‹ã‚’å®šç¾©ã™ã‚‹ï¼ type MyAppWriter io.Writer ãƒ»ãƒ—ãƒªãƒŸãƒ†ã‚£ãƒ–å‹ã¨ãƒ¡ãƒ¢ãƒªã®é–¢ä¿‚ ãƒ—ãƒªãƒŸãƒ†ã‚£ãƒ–å‹ã®å¤‰æ•°ã‚’å®šç¾©ã™ã‚‹ã¨ï¼Œãƒ‡ãƒ¼ã‚¿å‹ã®ãƒã‚¤ãƒˆæ•°ã«å¿œã˜ã¦ï¼Œç©ºã„ã¦ã„ã‚‹ãƒ¡ãƒ¢ãƒªé ˜åŸŸã«ï¼Œå¤‰æ•°ãŒå‰²ã‚Šå½“ã¦ã‚‰ã‚Œã‚‹ï¼ä¸€ã¤ã®ãƒ¡ãƒ¢ãƒªã‚¢ãƒ‰ãƒ¬ã‚¹å½“ãŸã‚Šï¼‘ãƒã‚¤ãƒˆã«ç›¸å½“ã™ã‚‹ï¼ ãƒ»å„ãƒ‡ãƒ¼ã‚¿å‹ã®ã‚µã‚¤ã‚º ç¨®é¡ å‹å ã‚µã‚¤ã‚º(bit) èª¬æ˜ intï¼ˆç¬¦å·ä»˜ãæ•´æ•°ï¼‰ int8 8 int16 16 int32 32 int64 64 int 32 or 64 å®Ÿè£…ç’°å¢ƒã«ã‚ˆã£ã¦ç•°ãªã‚‹ï¼ uintï¼ˆç¬¦å·ãªã—æ•´æ•°ï¼‰ uint8 8 uint16 16 unit32 32 uint64 64 uint 32 or 64 å®Ÿè£…ç’°å¢ƒã«ã‚ˆã£ã¦ç•°ãªã‚‹ï¼ floatï¼ˆæµ®å‹•å°æ•°ç‚¹ï¼‰ float32 32 float64 64 complexï¼ˆè¤‡ç´ æ•°ï¼‰ complex64 64 å®Ÿéƒ¨ï¼šfloat32ï¼Œè™šéƒ¨ï¼šfloat32 complex128 128 å®Ÿéƒ¨ï¼šfloat64ï¼Œè™šéƒ¨ï¼šfloat64 æ§‹é€ ä½“ ãƒ»æ§‹é€ ä½“ã¨ã¯ ä»–ã®è¨€èªã§ã„ã†ã€ãƒ‡ãƒ¼ã‚¿ã®ã¿ã‚’ä¿æŒã™ã‚‹ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã€ã«ç›¸å½“ã™ã‚‹ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š æ§‹é€ ä½“ã‚’å®šç¾©ã—ï¼Œå¤‰æ•°ã«ä»£å…¥ã™ã‚‹ï¼ var person struct { Name string } ãƒ»Defined Typeã«ã‚ˆã‚‹ç‹¬è‡ªã®æ§‹é€ ä½“ Defined Typeã‚’ä½¿ç”¨ã—ã¦ï¼Œç‹¬è‡ªã®ãƒ‡ãƒ¼ã‚¿å‹ã®æ§‹é€ ä½“ã‚’å®šç¾©ã™ã‚‹ï¼ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰åã®é ­æ–‡å­—ã‚’å¤§æ–‡å­—ã«ã—ãŸå ´åˆã¯ï¼Œãƒ‘ãƒƒã‚±ãƒ¼ã‚¸å¤–ã‹ã‚‰ã®ã‚¢ã‚¯ã‚»ã‚¹ã‚’ãƒ‘ãƒ–ãƒªãƒƒã‚¯ã«ï¼Œå°æ–‡å­—ã«ã—ãŸå ´åˆã¯ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆã«ãªã‚‹ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š ãƒ‘ãƒ–ãƒªãƒƒã‚¯ãªãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’æŒã¤æ§‹é€ ä½“ã¯ä»¥ä¸‹ã®é€šã‚Šï¼ type Person struct { // ãƒ‘ãƒ–ãƒªãƒƒã‚¯ Name string } ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆãªãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’æŒã¤æ§‹é€ ä½“ã¯ä»¥ä¸‹ã®é€šã‚Šï¼ type Person struct { // ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆ name string } ãƒ»ä½¿ç”¨ä¸å¯ã®ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰å å°æ–‡å­—ã®ã€typeã€ã¯äºˆç´„èªã®ãŸã‚ä½¿ç”¨ä¸å¯ã§ã‚ã‚‹ï¼å¤§æ–‡å­—ã®Typeã¯å¯èƒ½ï¼ type Person struct { // å®šç¾©ä¸å¯ã‚¨ãƒ©ãƒ¼ type string // å®šç¾©å¯èƒ½ Type string } ãƒ»åˆæœŸåŒ– ã™ã§ã«å€¤ãŒä»£å…¥ã•ã‚Œã¦ã„ã‚‹æ§‹é€ ä½“ã‚’åˆæœŸåŒ–ã™ã‚‹å ´åˆï¼Œã„ãã¤ã‹è¨˜æ³•ãŒã‚ã‚‹ï¼ãã®ä¸­ã§ã¯ï¼Œã‚¿ã‚°ä»˜ããƒªãƒ†ãƒ©ãƒ«ãŒæ¨å¥¨ã•ã‚Œã‚‹ï¼åˆæœŸåŒ–ã«ã‚ˆã£ã¦æ§‹ç¯‰ã™ã‚‹æ§‹é€ ä½“ã¯ï¼Œãƒã‚¤ãƒ³ã‚¿å‹ã¾ãŸã¯éãƒã‚¤ãƒ³ã‚¿å‹ã®ã„ãšã‚Œã§ã‚‚å•é¡Œãªã„ï¼ãŸã ã—ï¼Œå¤šãã®é–¢æ•°ãŒãƒã‚¤ãƒ³ã‚¿å‹ã‚’å¼•æ•°å‹ã¨ã—ã¦ã„ã‚‹ã“ã¨ã‹ã‚‰ï¼Œãã‚Œã«åˆã‚ã›ã¦ãƒã‚¤ãƒ³ã‚¿å‹ã‚’æ§‹ç¯‰ã™ã‚‹ã“ã¨ãŒå¤šã„ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š ã¾ãšã¯ï¼Œã‚¿ã‚°ä»˜ããƒªãƒ†ãƒ©ãƒ«è¡¨è¨˜ï¼ package main import \"fmt\" type Person struct { Name string } func main() { person := &Person{ // ã‚¿ã‚°ä»˜ããƒªãƒ†ãƒ©ãƒ«è¡¨è¨˜ Name: \"Hiroki\", } fmt.Printf(\"%#v\\n\", person.Name) // \"Hiroki\" } äºŒã¤ç›®ã«ï¼Œã‚¿ã‚°ç„¡ã—ãƒªãƒ†ãƒ©ãƒ«è¡¨è¨˜ãŒã‚ã‚‹ï¼ package main import \"fmt\" type Person struct { Name string } func main() { person := &Person{ // ã‚¿ã‚°ç„¡ã—ãƒªãƒ†ãƒ©ãƒ«è¡¨è¨˜ \"Hiroki\", } fmt.Printf(\"%#v\\n\", person.Name) // \"Hiroki\" } ä¸‰ã¤ç›®ã«ï¼Œnewé–¢æ•°ã¨ãƒ‡ãƒ¼ã‚¿ä»£å…¥ã«ã‚ˆã‚‹åˆæœŸåŒ–ãŒã‚ã‚‹ï¼newé–¢æ•°ã¯ï¼Œãƒ‡ãƒ¼ã‚¿ãŒä»£å…¥ã•ã‚Œã¦ã„ãªã„æ§‹é€ ä½“ã‚’ä½œæˆã™ã‚‹ãŸã‚ï¼Œãƒªãƒ†ãƒ©ãƒ«è¡¨è¨˜æ™‚ã§ã‚‚è¡¨ç¾ã§ãã‚‹ï¼newé–¢æ•°ã¯ï¼Œæ§‹é€ ä½“ä»¥å¤–ã®ãƒ‡ãƒ¼ã‚¿å‹ã§ã‚‚ä½¿ç”¨ã§ãã‚‹ï¼ãƒã‚¤ãƒ³ã‚¿å‹ã®æ§‹é€ ä½“ã‚’è¿”å´ã™ã‚‹ï¼ package main import \"fmt\" type Person struct { Name string } /** * å‹ã®ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ * â€»ã‚¹ã‚³ãƒ¼ãƒ—ã¯ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸å†…ã®ã¿ã¨ã™ã‚‹ï¼ */ func newPerson(name string) *Person { // newé–¢æ•°ã‚’ä½¿ç”¨ã™ã‚‹ï¼ // &Person{} ã«åŒã˜ï¼ person := new(Person) // ãƒã‚¤ãƒ³ã‚¿å‹ã®åˆæœŸåŒ–ã•ã‚ŒãŸæ§‹é€ ä½“ãŒè¿”å´ã•ã‚Œã‚‹ï¼ fmt.Printf(\"%#v\\n\", person) // &main.Person{Name:\"\"} // ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã«ä»£å…¥ã™ã‚‹ person.Name = name return person } func main() { person := newPerson(\"Hiroki\") fmt.Printf(\"%#v\\n\", person.Name) // \"Hiroki\" } ãƒ»DIï¼ˆä¾å­˜æ€§æ³¨å…¥ï¼‰ æ§‹é€ ä½“ã®ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã¨ã—ã¦æ§‹é€ ä½“ã‚’ä¿æŒã™ã‚‹ã“ã¨ã«ã‚ˆã‚Šï¼Œä¾å­˜é–¢ä¿‚ã‚’æ§‹æˆã™ã‚‹ï¼ä¾å­˜ã•ã‚Œã‚‹å´ã‚’ã‚µãƒ—ãƒ©ã‚¤ãƒ¤ãƒ¼ï¼Œã¾ãŸä¾å­˜ã™ã‚‹å´ã‚’ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã¨ã„ã†ï¼æ§‹é€ ä½“é–“ã«ä¾å­˜é–¢ä¿‚ã‚’æ§‹æˆã™ã‚‹ã«ã¯ï¼Œã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã«ã‚µãƒ—ãƒ©ã‚¤ãƒ¤ãƒ¼ã‚’æ³¨å…¥ã™ã‚‹ï¼æ³¨å…¥æ–¹æ³•ã«ã¯ï¼Œã€Constructor Injectionã€ã€Setter Injectionã€ã€Setter Injectionã€ãŒã‚ã‚‹ï¼è©³ã—ãã¯ï¼Œä»¥ä¸‹ã®ãƒªãƒ³ã‚¯ã‚’å‚è€ƒã«ã›ã‚ˆï¼ å‚è€ƒï¼šhttps://hiroki-it.github.io/tech-notebook-gitbook/public/software/software_application_backend_php_object_orientation_class.html package main import \"fmt\" //======================== // ã‚µãƒ—ãƒ©ã‚¤ãƒ¤ãƒ¼å´ //======================== type Name struct { FirstName string LastName string } func NewName(firstName string, lastName string) *Name { return &Name{ FirstName: firstName, LastName: lastName, } } func (n *Name) fullName() string { return fmt.Sprintf(\"%s %s\", n.FirstName, n.LastName) } //======================== // ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå´ //======================== type Person struct { Name *Name } func NewPerson(name *Name) *Person { return &Person{ Name: name, } } func (p *Person) getName() *Name { return p.Name } func main() { name := NewName(\"Hiroki\", \"Hasegawa\") // ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³ã«ã‚ˆã‚‹DI person := NewPerson(name) fmt.Printf(\"%#v\\n\", person.getName().fullName()) // \"Hiroki Hasegawa\" } ãƒ»åŸ‹ã‚è¾¼ã¿ã«ã‚ˆã‚‹å§”è­² Goã«ã¯ç¶™æ‰¿ãŒãªãï¼Œä»£ã‚ã‚Šã«å§”è­²ãŒã‚ã‚‹ï¼æ§‹é€ ä½“ã®ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã¨ã—ã¦åˆ¥ã®æ§‹é€ ä½“ã‚’åŸ‹ã‚è¾¼ã‚€ã“ã¨ã«ã‚ˆã‚Šï¼ŒåŸ‹ã‚è¾¼ã¾ã‚ŒãŸæ§‹é€ ä½“ã«å‡¦ç†ã‚’å§”è­²ã™ã‚‹ï¼å§”è­²ã™ã‚‹å´ã®æ§‹é€ ä½“ã‚’å®£è¨€ã™ã‚‹ã ã‘ã§ãªãï¼Œãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã¨ã—ã¦æ¸¡ã™å¿…è¦ãŒã‚ã‚‹ï¼ã“ã®æ™‚ï¼Œå®Ÿè£…è€…ãŒå§”è­²ã‚’æ„è­˜ã—ãªãã¦è‰¯ããªã‚‹ã‚ˆã†ã«ï¼Œã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ã®ä¸­ã§åˆæœŸåŒ–ã™ã‚‹ã‚ˆã†ã«ã™ã‚‹ï¼ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã®å§”è­²ã¨ã¯ç•°ãªã‚Šï¼Œã‚¢ãƒƒãƒ—ã‚­ãƒ£ã‚¹ãƒˆã¯è¡Œãˆãªã„ï¼ã¤ã¾ã‚Šï¼Œå§”è­²ã•ã‚ŒãŸæ§‹é€ ä½“ã¯å§”è­²ã™ã‚‹æ§‹é€ ä½“ã®ãƒ‡ãƒ¼ã‚¿å‹ã«ã‚­ãƒ£ã‚¹ãƒˆã§ãï¼ŒåŒä¸€ã®ãƒ‡ãƒ¼ã‚¿å‹ã¨ã—ã¦æ‰±ãˆãªã„ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š package main import \"fmt\" //======================== // å§”è­²ã™ã‚‹å´ï¼ˆåŸ‹ã‚è¾¼ã‚€æ§‹é€ ä½“ï¼‰ //======================== type Name struct { FirstName string LastName string } func (n *Name) fullName() string { return fmt.Sprintf(\"%s %s\", n.FirstName, n.LastName) } //======================== // å§”è­²ã•ã‚Œã‚‹å´ï¼ˆåŸ‹ã‚è¾¼ã¾ã‚Œã‚‹æ§‹é€ ä½“ï¼‰ //======================== type MyName struct { *Name } func NewMyName(firstName string, lastName string) *MyName { return &MyName{ // ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿å†…ã§å§”è­²ã™ã‚‹æ§‹é€ ä½“ã‚’åˆæœŸåŒ–ã™ã‚‹ï¼ Name: &Name{ FirstName: firstName, LastName: lastName, }, } } //================ // main //================ func main() { myName := NewMyName(\"Hiroki\", \"Hasegawa\") // myNameæ§‹é€ ä½“ã¯ï¼ŒNameæ§‹é€ ä½“ã®ãƒ¡ã‚½ãƒƒãƒ‰ã‚’ã‚³ãƒ¼ãƒ«ã§ãã‚‹ï¼ fmt.Printf(\"%#v\\n\", myName.fullName()) // \"Hiroki Hasegawa\" } ã‚‚ã—ï¼Œå§”è­²ã™ã‚‹å´ã¨å§”è­²ã•ã‚Œã‚‹å´ã«ï¼ŒåŒã˜åå‰ã®ãƒ¡ã‚½ãƒƒãƒ‰ï¼ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ãŒå­˜åœ¨ã™ã‚‹å ´åˆã¯ï¼Œå§”è­²ã•ã‚ŒãŸå´ã®ã‚‚ã®ãŒå„ªå…ˆã—ã¦ã‚³ãƒ¼ãƒ«ã•ã‚Œã‚‹ï¼ package main import \"fmt\" //======================== // å§”è­²ã™ã‚‹å´ï¼ˆåŸ‹ã‚è¾¼ã‚€æ§‹é€ ä½“ï¼‰ //======================== type Name struct { FirstName string LastName string } func (n *Name) fullName() string { return fmt.Sprintf(\"%s %s\", n.FirstName, n.LastName) } //======================== // å§”è­²ã•ã‚Œã‚‹å´ï¼ˆåŸ‹ã‚è¾¼ã¾ã‚Œã‚‹æ§‹é€ ä½“ï¼‰ //======================== type MyName struct { *Name } func NewMyName(firstName string, lastName string) *MyName { return &MyName{ // ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿å†…ã§å§”è­²ã™ã‚‹æ§‹é€ ä½“ã‚’åˆæœŸåŒ–ã™ã‚‹ï¼ Name: &Name{ FirstName: firstName, LastName: lastName, }, } } // å§”è­²ã™ã‚‹å´ã¨å§”è­²ã•ã‚Œã‚‹å´ã§åŒã˜ãƒ¡ã‚½ãƒƒãƒ‰ func (n *MyName) fullName() string { return fmt.Sprintf(\"%s\", \"å§”è­²ã•ã‚ŒãŸæ§‹é€ ä½“ã§ã™\") } //================ // main //================ func main() { myName := NewMyName(\"Hiroki\", \"Hasegawa\") // åŒã˜ãƒ¡ã‚½ãƒƒãƒ‰ãŒã‚ã‚‹å ´åˆï¼Œå§”è­²ã•ã‚ŒãŸå´ãŒå„ªå…ˆï¼ fmt.Printf(\"%#v\\n\", myName.fullName()) // \"å§”è­²ã•ã‚ŒãŸæ§‹é€ ä½“ã§ã™\" } ãƒ»ç„¡åæ§‹é€ ä½“ æ§‹é€ ä½“ã®å®šç¾©ã¨åˆæœŸåŒ–ã‚’åŒæ™‚ã«è¡Œã†ï¼æ§‹é€ ä½“ã«åå‰ãŒãªãï¼Œãƒ‡ãƒ¼ã‚¿å‹ã‚’å‰²ã‚Šå½“ã¦ã‚‹ã“ã¨ãŒã§ããªã„ãŸã‚ï¼Œè¿”å´å€¤ã¨ã—ã¦ã¯ä½¿ç”¨ã§ããªã„ã“ã¨ã«æ³¨æ„ã™ã‚‹ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š package main import \"fmt\" type Person struct { Name string } func main() { person := &struct { Name string }{ // ã‚¿ã‚°ä»˜ããƒªãƒ†ãƒ©ãƒ«è¡¨è¨˜ï¼ˆã‚¿ã‚°ç„¡ã—ãƒªãƒ†ãƒ©ãƒ«è¡¨è¨˜ã‚‚å¯èƒ½ï¼‰ Name: \"Hiroki\", } fmt.Printf(\"%#v\\n\", person.Name) // \"Hiroki\" } JSON ãƒ»JSONã¨æ§‹é€ ä½“ã®ãƒãƒƒãƒ”ãƒ³ã‚° æ§‹é€ ä½“ã¨JSONã®é–“ã§ãƒ‘ãƒ¼ã‚¹ã‚’å®Ÿè¡Œã™ã‚‹æ™‚ï¼Œæ§‹é€ ä½“ã®å„ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã¨ï¼ŒJSONã®ã‚­ãƒ¼åã‚’ï¼Œãƒãƒƒãƒ”ãƒ³ã‚°ã—ã¦ãŠãã“ã¨ãŒã§ãã‚‹ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š package main import ( \"encoding/json\" \"fmt\" \"log\" ) type Person struct { Name string `json:\"name\"` } func main() { person := &Person{ Name: \"Hiroki\", } byteJson, err := json.Marshal(person) if err != nil { log.Println(\"JSONã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ã«å¤±æ•—ã—ã¾ã—ãŸã€‚\") } // ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰çµæœã‚’å‡ºåŠ› fmt.Printf(\"%#v\\n\", string(byteJson)) // \"{\\\"Name\\\":\\\"Hiroki\\\"}\" } ãƒ»omitempty å€¤ãŒã€falseï¼Œ0ï¼Œnilï¼Œç©ºé…åˆ—ï¼Œç©ºsliceï¼Œç©ºmapï¼Œç©ºæ–‡å­—ã€ã®æ™‚ã«ï¼ŒJSONã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ã§ã“ã‚Œã‚’é™¤å¤–ã§ãã‚‹ï¼æ§‹é€ ä½“ã‚’é™¤å¤–ã—ãŸã„å ´åˆã¯ï¼Œnilã«ãªã‚Šã†ã‚‹ãƒã‚¤ãƒ³ã‚¿å‹ã¨ã—ã¦ãŠãï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š package main import ( \"encoding/json\" \"fmt\" \"log\" ) type Person struct { // falseï¼Œ0ï¼Œnilï¼Œç©ºé…åˆ—ï¼Œç©ºsliceï¼Œç©ºmapï¼Œç©ºæ–‡å­—ã‚’é™¤å¤–ã§ãã‚‹ï¼ Id int `json:\"id\"` // æ§‹é€ ä½“ã¯ãƒã‚¤ãƒ³ã‚¿å‹ã¨ã—ã¦ãŠã Name *Name `json:\"name,omitempty\"` } type Name struct { FirstName string `json:\"first_name\"` LastName string `json:\"last_name\"` } func main() { person := &Person{ Id: 1, // Nameæ§‹é€ ä½“ã¯nilã«ã—ã¦ãŠã } byteJson, err := json.Marshal(person) if err != nil { log.Println(\"JSONã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ã«å¤±æ•—ã—ã¾ã—ãŸã€‚\") } // ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰çµæœã‚’å‡ºåŠ› fmt.Printf(\"%#v\\n\", string(byteJson)) // \"{\\\"id\\\":1}\" } é…åˆ— ãƒ»é…åˆ—ã¨ã¯ è¦ç´ ï¼Œå„è¦ç´ ã®ãƒ¡ãƒ¢ãƒªã‚¢ãƒ‰ãƒ¬ã‚¹ï¼Œã‹ã‚‰ãªã‚‹ãƒ‡ãƒ¼ã‚¿ã®ã“ã¨ï¼ ãƒ»å®£è¨€ã¨ä»£å…¥ é…åˆ—ã‚’å®£è¨€ã—ï¼Œå¤‰æ•°ã«ä»£å…¥ã™ã‚‹ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š å®£è¨€ã¨ä»£å…¥ã‚’åˆ¥ã€…ã«è¡Œã†ï¼ã¾ãŸï¼Œè¦ç´ æ•°ã®å®šç¾©ãŒå¿…è¦ã§ã‚ã‚‹ï¼ package main import \"fmt\" func main() { var z [2]string z[0] = \"Hiroki\" z[1] = \"Gopher\" fmt.Printf(\"%#v\\n\", z) // [Hiroki Gopher] fmt.Printf(\"%#v\\n\", z) // [2]string{\"Hiroki\", \"Gopher\"} } å®£è¨€ã¨ä»£å…¥ã‚’åŒæ™‚ã«è¡Œã†ï¼ã¾ãŸï¼Œè¦ç´ æ•°ã®å®šç¾©ãŒå¿…è¦ã§ã‚ã‚‹ï¼ package main import \"fmt\" func main() { var y [2]string = [2]string{\"Hiroki\", \"Gopher\"} fmt.Printf(\"%#v\\n\", y) // [Hiroki Gopher] fmt.Printf(\"%#v\\n\", y) // [2]string{\"Hiroki\", \"Gopher\"} } å®£è¨€ã¨ä»£å…¥ã‚’åŒæ™‚ã«è¡Œã†ï¼ã¾ãŸï¼Œå‹æ¨è«–ã¨è¦ç´ æ•°çœç•¥ã‚’è¡Œã†ï¼ package main import \"fmt\" func main() { x := [...]string{\"Hiroki\", \"Gopher\"} fmt.Printf(\"%#v\\n\", x) // [Hiroki Gopher] fmt.Printf(\"%#v\\n\", x) // [2]string{\"Hiroki\", \"Gopher\"} } ãƒ»é…åˆ—ã¨ãƒ¡ãƒ¢ãƒªã®é–¢ä¿‚ é…åˆ—å‹ã®å¤‰æ•°ã‚’å®šç¾©ã™ã‚‹ã¨ï¼Œç©ºã„ã¦ã„ã‚‹ãƒ¡ãƒ¢ãƒªé ˜åŸŸã«ï¼Œé…åˆ—ãŒã¾ã¨ã¾ã£ã¦å‰²ã‚Šå½“ã¦ã‚‰ã‚Œã‚‹ï¼ä¸€ã¤ã®ãƒ¡ãƒ¢ãƒªã‚¢ãƒ‰ãƒ¬ã‚¹å½“ãŸã‚Šï¼‘ãƒã‚¤ãƒˆã«ç›¸å½“ã™ã‚‹ï¼ ãƒã‚¤ãƒ³ã‚¿ ãƒ»ãƒã‚¤ãƒ³ã‚¿å‹ã¨ã¯ ãƒ¡ãƒ¢ãƒªã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’ä»£å…¥ã§ãã‚‹ãƒ‡ãƒ¼ã‚¿å‹ã®ã“ã¨ï¼ ãƒ»å‚ç…§æ¼”ç®—å­ï¼ˆ&ï¼‰ å®šç¾©ã•ã‚ŒãŸå¤‰æ•°ã«å¯¾ã—ã¦ï¼Œ&ï¼ˆã‚¢ãƒ³ãƒ‘ã‚µãƒ³ãƒ‰ï¼‰ã‚’å®£è¨€ã™ã‚‹ã¨ï¼Œãƒ¡ãƒ¢ãƒªã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’å‚ç…§ã§ãã‚‹ï¼å‚ç…§ã—ãŸãƒ¡ãƒ¢ãƒªã‚¢ãƒ‰ãƒ¬ã‚¹å€¤ã¯ï¼Œãƒã‚¤ãƒ³ã‚¿å‹ã®å¤‰æ•°ã«ä»£å…¥ã™ã‚‹å¿…è¦ãŒã‚ã‚‹ãŒï¼Œå‹æ¨è«–ã§è¨˜è¿°ã™ã‚Œã°ã“ã‚Œã‚’æ„è­˜ã—ãªãã¦ã‚ˆã„ï¼PHPã«ãŠã‘ã‚‹ãƒã‚¤ãƒ³ã‚¿ã¯ï¼Œä»¥ä¸‹ã‚’å‚è€ƒã«ã›ã‚ˆï¼ å‚è€ƒï¼šhttps://hiroki-it.github.io/tech-notebook-gitbook/public/backend_object_orientation_method_data.html ï¼Šå®Ÿè£…ä¾‹ï¼Š package main import \"fmt\" func main() { x := \"a\" // ãƒ¡ãƒ¢ãƒªã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’å‚ç…§ã™ã‚‹ï¼ var p *string = &x // p := &x ã¨åŒã˜ // ãƒ¡ãƒ¢ãƒªã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’å‚ç…§ã™ã‚‹å‰ fmt.Printf(\"%#v\\n\", x) // \"a\" // ãƒ¡ãƒ¢ãƒªã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’å‚ç…§ã—ãŸå¾Œ fmt.Printf(\"%#v\\n\", p) // (*string)(0xc0000841e0) } ãƒ»é–“æ¥å‚ç…§æ¼”ç®—å­ï¼ˆ*ï¼‰ ãƒã‚¤ãƒ³ã‚¿å‹ã®å¤‰æ•°ã«å¯¾ã—ã¦ã‚¢ã‚¹ã‚¿ãƒªã‚¹ã‚¯ã‚’å®£è¨€ã™ã‚‹ã¨ï¼Œãƒ¡ãƒ¢ãƒªã‚¢ãƒ‰ãƒ¬ã‚¹ã«å‰²ã‚Šå½“ã¦ã‚‰ã‚Œã¦ã„ã‚‹ãƒ‡ãƒ¼ã‚¿ã®å®Ÿä½“ã‚’å–å¾—ã§ãã‚‹ï¼ãƒã‚¤ãƒ³ã‚¿ã‚’ç”¨ã„ã¦ãƒ‡ãƒ¼ã‚¿ã®å®Ÿä½“ã‚’å–å¾—ã™ã‚‹ã“ã¨ã‚’ã€é€†å‚ç…§ï¼ˆãƒ‡ãƒªãƒ•ã‚¡ãƒ¬ãƒ³ã‚¹ï¼‰ã€ã¨ã„ã†ï¼ package main import \"fmt\" func main() { x := \"a\" p := &x // ãƒ¡ãƒ¢ãƒªã‚¢ãƒ‰ãƒ¬ã‚¹ã®å®Ÿä½“ã‚’å–å¾—ã™ã‚‹ï¼ˆãƒ‡ãƒªãƒ•ã‚¡ãƒ¬ãƒ³ã‚¹ï¼‰ï¼ y := *p // ãƒ¡ãƒ¢ãƒªã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’å‚ç…§ã™ã‚‹å‰ fmt.Printf(\"%#v\\n\", x) // \"a\" // ãƒ¡ãƒ¢ãƒªã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’å‚ç…§ã—ãŸå¾Œ fmt.Printf(\"%#v\\n\", p) // (*string)(0xc0000841e0) // ãƒ¡ãƒ¢ãƒªã‚¢ãƒ‰ãƒ¬ã‚¹ã«å‰²ã‚Šå½“ã¦ã‚‰ã‚ŒãŸãƒ‡ãƒ¼ã‚¿ fmt.Printf(\"%#v\\n\", y) // \"a\" } ãƒ»ãƒã‚¤ãƒ³ã‚¿å‹ã§æ‰±ã†ã¹ããƒ‡ãƒ¼ã‚¿å‹ ãƒ‡ãƒ¼ã‚¿å‹ ãƒã‚¤ãƒ³ã‚¿å‹ã§æ‰±ã†ã¹ãã‹ èª¬æ˜ æ§‹é€ ä½“ â—¯ ãƒã‚¤ãƒ³ã‚¿å‹ã¨ã—ã¦æ‰±ã†ã¨ï¼Œæ§‹é€ ä½“ãŒæŒã¤ãƒ¡ãƒ¢ãƒªã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’å‡¦ç†ã™ã‚‹ã ã‘ã§ã‚ˆããªã‚‹ï¼ãƒã‚¤ãƒ³ã‚¿å‹ã¨ã—ãªã„å ´åˆã¨æ¯”ã¹ã¦ï¼Œå°‘ãªã„ãƒ¡ãƒ¢ãƒªæ¶ˆè²»ã§æ§‹é€ ä½“ã‚’æ‰±ãˆã‚‹ï¼ sliceï¼Œmapï¼Œchanï¼Œ func â–³ ãƒ‡ãƒ¼ã‚¿ã‚µã‚¤ã‚ºã®å¤§ãã•ã«ã‚ˆã‚‹ï¼ ãƒ—ãƒªãƒŸãƒ†ã‚£ãƒ–å‹ Ã— ãƒã‚¤ãƒ³ã‚¿å‹ã§æ‰±ã†ãƒ¡ãƒªãƒƒãƒˆã¯ãªã„ï¼ ã‚¹ãƒ©ã‚¤ã‚¹ ãƒ»ã‚¹ãƒ©ã‚¤ã‚¹ã¨ã¯ å‚ç…§å…ˆã®é…åˆ—ã«å¯¾ã™ã‚‹ãƒã‚¤ãƒ³ã‚¿ï¼Œé•·ã•ï¼Œå®¹é‡ã‚’æŒã¤ãƒ‡ãƒ¼ã‚¿å‹ã§ã‚ã‚‹ï¼ // Goã®ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã‚ˆã‚Š type slice struct { array unsafe.Pointer len int cap int } å‚è€ƒï¼šhttps://github.com/golang/go/blob/04a4dca2ac3d4f963e3c740045ce7a2959bf0319/src/runtime/slice.go#L13-L17 ãƒ»å®£è¨€ã¨ä»£å…¥ ï¼Šå®Ÿè£…ä¾‹ï¼Š å®£è¨€ã¨ä»£å…¥ã‚’åŒæ™‚ã«è¡Œã†ï¼ package main import \"fmt\" func main() { var y []string = []string{\"Hiroki\", \"Gopher\"} fmt.Printf(\"%+v\\n\", y) // [Hiroki Gopher] fmt.Printf(\"%#v\\n\", y) // []string{\"Hiroki\", \"Gopher\"} } æ–‡å­—åˆ—ã®å®£è¨€ã¨ä»£å…¥ã‚’åŒæ™‚ã«è¡Œã†ï¼ã¾ãŸï¼Œå‹æ¨è«–ã‚’è¡Œã†ï¼ package main import \"fmt\" func main() { x := []string{\"Hiroki\", \"Gopher\"} fmt.Printf(\"%+v\\n\", x) // [Hiroki Gopher] fmt.Printf(\"%#v\\n\", x) // []string{\"Hiroki\", \"Gopher\"} } ãƒã‚¤ãƒˆæ–‡å­—åˆ—ã®å®£è¨€ã¨ä»£å…¥ã‚’åŒæ™‚ã«è¡Œã†ï¼ã¾ãŸï¼Œå‹æ¨è«–ã‚’è¡Œã†ï¼ package main import \"fmt\" func main() { x := []byte(\"abc\") fmt.Printf(\"%+v\\n\", x) // [97 98 99] fmt.Printf(\"%#v\\n\", x) // []byte{0x61, 0x62, 0x63} } æ§‹é€ ä½“ã®ã‚¹ãƒ©ã‚¤ã‚¹ã®å®£è¨€ã¨ä»£å…¥ã‚’åŒæ™‚ã«è¡Œã†ï¼ã¾ãŸï¼Œå‹æ¨è«–ã‚’è¡Œã†ï¼ package main import \"fmt\" type Person struct { Name string } func main() { person := []Person{{Name: \"Hiroki\"}} fmt.Printf(\"%+v\\n\", person) // [{Name:Hiroki}] fmt.Printf(\"%#v\\n\", person) // []main.Person{main.Person{Name:\"Hiroki\"}} } ãƒ»é…åˆ—ã®å€¤ã®å‚ç…§ å…¨ã¦ã®ã‚¹ãƒ©ã‚¤ã‚¹ãŒå…±é€šã®é…åˆ—ã‚’å‚ç…§ã—ã¦ã„ã‚‹ãŸã‚ï¼Œä¾‹ãˆã°ï¼Œxbå¤‰æ•°ã—ã‹ä¸Šæ›¸ãã—ã¦ã„ãªã„ã®ã«ã‚‚ã‹ã‹ã‚ã‚‰ãšï¼Œä»–ã®ã‚¹ãƒ©ã‚¤ã‚¹ã«ã‚‚ãã®ä¸Šæ›¸ããŒåæ˜ ã•ã‚Œã‚‹ï¼ package main import \"fmt\" func main() { // æœ€å¾Œã®è¦ç´ ã®å¾Œã«ã‚‚ã‚«ãƒ³ãƒãŒå¿…è¦ã§ã‚ã‚‹ï¼ x := [5]string{\"ã‚\", \"ã„\", \"ã†\", \"ãˆ\", \"ãŠ\"} fmt.Printf(\"%#v\\n\", x) // [5]string{\"ã‚\", \"ã„\", \"ã†\", \"ãˆ\", \"ãŠ\"} // 0ã‹ã‚‰3ç•ªç›®ã‚’å‚ç…§ã™ã‚‹ï¼ xa := x[0:3] fmt.Printf(\"%#v\\n\", xa) // []string{\"ã‚\", \"ã„\", \"ã†\"} // 2ã‹ã‚‰5ç•ªç›®ã‚’å‚ç…§ã™ã‚‹ï¼ xb := x[2:5] fmt.Printf(\"%#v\\n\", xb) // []string{\"ã†\", \"ãˆ\", \"ãŠ\"} // xbã‚¹ãƒ©ã‚¤ã‚¹ã®0ç•ªç›®ï¼ˆ\"ã†\"ï¼‰ã‚’ä¸Šæ›¸ãã™ã‚‹ï¼ xb[0] = \"Hiroki\" // xbã—ã‹ä¸Šæ›¸ãã—ã¦ã„ãªã„ãŒï¼Œä»–ã®ã‚¹ãƒ©ã‚¤ã‚¹ã«ã‚‚åæ˜ ã•ã‚Œã‚‹ï¼ fmt.Printf(\"%#v\\n\", xa) // []string{\"ã‚\", \"ã„\", \"Hiroki\"} fmt.Printf(\"%#v\\n\", xb) // []string{\"Hiroki\", \"ãˆ\", \"ãŠ\"} fmt.Printf(\"%#v\\n\", x) // [5]string{\"ã‚\", \"ã„\", \"Hiroki\", \"ãˆ\", \"ãŠ\"} } ãƒ»è¦ç´ ã®è¿½åŠ  æ¸¡ã•ã‚ŒãŸã‚¹ãƒ©ã‚¤ã‚¹ã§ï¼Œå¾Œã‚ã‹ã‚‰è¦ç´ ã‚’è¿½åŠ ã™ã‚‹ï¼ package main import ( \"fmt\" ) func main() { s := []int{10, 20, 30, 40} fmt.Println(s) // [10 20 30 40] // è¦ç´ ã‚’è¿½åŠ ï¼ s = append(s, 50, 60, 70, 80) fmt.Println(s) // [10 20 30 40 50 60 70 80] } ãƒãƒƒãƒ— ãƒ»å˜ä¸€ã®ãƒ—ãƒªãƒŸãƒ†ã‚£ãƒ–å‹ã‚’å€¤ã«æŒã¤ãƒãƒƒãƒ— ãƒãƒƒãƒ—ã®å®šç¾©ã¨ä»£å…¥ã‚’åŒæ™‚ã«è¡Œã†ï¼ package main import \"fmt\" func main() { // ã€æ•°å€¤:æ–‡å­—åˆ—ã€ã®ãƒãƒƒãƒ— m := map[int]string{ 0: \"Hiroki\", 1: \"Hiroko\", 2: \"Hiroshi\", } fmt.Println(m) // map[0:Hiroki 1:Hiroko 2:Hiroshi] } å®šç¾©ã¨ä»£å…¥ã‚’åˆ¥ã€…ã«è¡Œã†ï¼ package main import \"fmt\" func main() { // ã€æ•°å€¤:æ–‡å­—åˆ—ã€ã®ãƒãƒƒãƒ— m := map[int]string{} m[0] = \"Hiroki\" m[1] = \"Hiroshi\" m[2] = \"Hiroshi\" fmt.Println(m) // map[0:Hiroki 1:Hiroko 2:Hiroshi] } ã¾ãŸã¯ï¼Œmakeé–¢æ•°ã‚’ä½¿ç”¨ã—ã¦ãƒãƒƒãƒ—ã‚’ä½œæˆã™ã‚‹ã“ã¨ã‚‚ã§ãã‚‹ï¼ package main import \"fmt\" func main() { // ã€æ•°å€¤:æ–‡å­—åˆ—ã€ã®ãƒãƒƒãƒ— m := make(map[int]string) m[0] = \"Hiroki\" m[1] = \"Hiroshi\" m[2] = \"Hiroshi\" fmt.Println(m) // map[0:Hiroki 1:Hiroko 2:Hiroshi] } ãƒ»ã‚¹ãƒ©ã‚¤ã‚¹å‹ã‚’å€¤ã«æŒã¤ãƒãƒƒãƒ— package main import ( \"fmt\" ) func main() { // ã€æ–‡å­—åˆ—:ã‚¹ãƒ©ã‚¤ã‚¹ã€ã®ãƒãƒƒãƒ— m := map[string][]string{ \"errors\": { 0: \"ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸0\", 1: \"ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸1\", 2: \"ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸2\", }, } fmt.Println(m) // map[errors:[ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸0 ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸1 ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸2]] } ãƒ»è¤‡æ•°ã®ãƒ‡ãƒ¼ã‚¿å‹ã‚’æŒã¤ãƒãƒƒãƒ— ãƒãƒƒãƒ—å‹ãƒ‡ãƒ¼ã‚¿ã®å€¤ã‚’ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹å‹ã¨ã™ã‚‹ã“ã¨ã§ï¼Œè¤‡æ•°ã®ãƒ‡ãƒ¼ã‚¿å‹ã‚’è¡¨ç¾ã§ãã‚‹ï¼ package main import \"fmt\" func main() { // ã€æ–‡å­—åˆ—:è¤‡æ•°ã®ãƒ—ãƒªãƒŸãƒ†ã‚£ãƒ–å‹ã€ã®ãƒãƒƒãƒ— m := map[string]interface{}{ \"id\": 1, \"name\": \"Hiroki Hasegawa\", } fmt.Println(m) // map[id:1 name:Hiroki Hasegawa] } ãƒ»ãƒãƒƒãƒ—å€¤ã®æŠ½å‡º package main import \"fmt\" func main() { m := map[int]string{ 1: \"Hiroki\", 2: \"Hiroko\", 3: \"Hiroshi\", } // å€¤ã®æŠ½å‡º v, ok := m[1] // ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚° if ok != true { fmt.Println(\"Value is not found.\") // Value is not found. } fmt.Println(v) // Hiroki } ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ ãƒ»åŸ‹ã‚è¾¼ã¿ã«ã‚ˆã‚‹å§”è­² æ§‹é€ ä½“ã®ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã¨ã—ã¦åˆ¥ã®ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã‚’åŸ‹ã‚è¾¼ã‚€ã“ã¨ã«ã‚ˆã‚Šï¼ŒåŸ‹ã‚è¾¼ã¾ã‚ŒãŸæ§‹é€ ä½“ã«å‡¦ç†ã®å…¨ã¦ã‚’å§”è­²ã™ã‚‹ï¼ãŸã ã—ï¼Œæ§‹é€ ä½“ã«æ˜ç¤ºçš„ã«ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã‚’åŸ‹ã‚è¾¼ã‚€å¿…è¦ã¯ãªãï¼Œã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã‚’æº€ãŸã™é–¢æ•°ã‚’æ§‹é€ ä½“ã«ç´ä»˜ã‘ã‚‹ã¨ï¼Œã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã‚’æš—é»™çš„ã«å®Ÿè£…ã§ãã‚‹ï¼æ§‹é€ ä½“ã®å§”è­²ã¨ã¯ç•°ãªã‚Šï¼Œã‚¢ãƒƒãƒ—ã‚­ãƒ£ã‚¹ãƒˆã‚’è¡Œã†ã“ã¨ãŒã§ãã‚‹ï¼ã¤ã¾ã‚Šï¼Œå§”è­²ã•ã‚ŒãŸæ§‹é€ ä½“ã¯å§”è­²ã™ã‚‹ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã®ãƒ‡ãƒ¼ã‚¿å‹ã«ã‚­ãƒ£ã‚¹ãƒˆã§ãï¼ŒåŒä¸€ã®ãƒ‡ãƒ¼ã‚¿å‹ã¨ã—ã¦æ‰±ãˆã‚‹ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š InspectImplæ§‹é€ ä½“ã«Animalã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã‚’åŸ‹ã‚è¾¼ã¿ï¼Œæ§‹é€ ä½“ã«Eatãƒ¡ã‚½ãƒƒãƒ‰ï¼ŒSleepãƒ¡ã‚½ãƒƒãƒ‰ï¼ŒMatingãƒ¡ã‚½ãƒƒãƒ‰ï¼Œã®å‡¦ç†ã‚’å§”è­²ã™ã‚‹ï¼ package main import \"fmt\" // ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã¨ãã®ãƒ¡ã‚½ãƒƒãƒ‰ã‚’å®šç¾©ã™ã‚‹ï¼ type AnimalInterface interface { Name() string Eat() string Sleep() string } type InsectImpl struct { name string } type FishImpl struct { name string } type MammalImpl struct { name string } // ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ func NewInsect(name string) (*InsectImpl, error) { return &InsectImpl{ name: name, }, nil } // æ§‹é€ ä½“ã«é–¢æ•°ã‚’ç´ä»˜ã‘ã‚‹ï¼ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã‚’æš—é»™çš„ã«å®Ÿè£…ã™ã‚‹ï¼ func (i *InsectImpl) Name() string { return i.name } func (i *InsectImpl) Eat() string { return \"é£Ÿã¹ã‚‹\" } func (i *InsectImpl) Sleep() string { return \"çœ ã‚‹\" } func main() { insect, err := NewInsect(\"ã‚«ãƒ–ãƒˆãƒ ã‚·\") if err != nil { fmt.Println(err) } // ãƒ¡ã‚½ãƒƒãƒ‰ã‚’å®Ÿè¡Œã™ã‚‹ï¼ fmt.Println(insect.Name()) fmt.Println(insect.Eat()) fmt.Println(insect.Sleep()) } ãƒ»ã‚¢ãƒƒãƒ—ã‚­ãƒ£ã‚¹ãƒˆã®å¯å¦ã‚’åˆ©ç”¨ã—ãŸæ¤œè¨¼ ã‚‚ã—ï¼Œæ§‹é€ ä½“ã«å®Ÿè£…ã•ã‚ŒãŸãƒ¡ã‚½ãƒƒãƒ‰ã«ä¸è¶³ãŒã‚ã‚‹ã¨ï¼Œå§”è­²ãŒè‡ªå‹•çš„ã«å–ã‚Šæ¶ˆã•ã‚Œã‚‹ï¼ã‚¨ãƒ©ãƒ¼ã¯ç™ºç”Ÿã—ãªã„ãŸã‚ï¼Œå®Ÿè£…ã•ã‚ŒãŸãƒ¡ã‚½ãƒƒãƒ‰ãŒååˆ†ã§ã‚ã‚‹ã“ã¨ã‚’å®Ÿè£…è€…ãŒçŸ¥ã‚‰ãªã‘ã‚Œã°ãªã‚‰ãªã„ï¼ã‚¢ãƒƒãƒ—ã‚­ãƒ£ã‚¹ãƒˆã®å¯å¦ã‚’åˆ©ç”¨ã—ã¦ï¼Œæ„å›³çš„ã«ã‚¨ãƒ©ãƒ¼ã‚’ç™ºç”Ÿã•ã›ã‚‹ãƒ†ã‚¯ãƒ‹ãƒƒã‚¯ãŒã‚ã‚‹ï¼ å‚è€ƒï¼šhttps://github.com/uber-go/guide/blob/master/style.md#verify-interface-compliance package main import \"fmt\" // ã‚¢ãƒƒãƒ—ã‚­ãƒ£ã‚¹ãƒˆã®å¯å¦ã‚’åˆ©ç”¨ã—ã¦ï¼Œæ§‹é€ ä½“ãŒã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã‚’æº€ãŸã—ã¦ã„ã‚‹ã‚’æ¤œè¨¼ã™ã‚‹ï¼ var _ AnimalInterface = &InsectImpl{} // ã‚‚ã—ãã¯ (*InsectImpl)(nil) // ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã¨ãã®ãƒ¡ã‚½ãƒƒãƒ‰ã‚’å®šç¾©ã™ã‚‹ï¼ type AnimalInterface interface { Name() string Eat() string } type InsectImpl struct { name string } // ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ func NewInsect(name string) (*InsectImpl, error) { return &InsectImpl{ name: name, }, nil } // æ§‹é€ ä½“ã«é–¢æ•°ã‚’ç´ä»˜ã‘ã‚‹ï¼ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã‚’æš—é»™çš„ã«å®Ÿè£…ã™ã‚‹ï¼ func (i *InsectImpl) Name() string { return i.name } func main() { insect, err := NewInsect(\"ã‚«ãƒ–ãƒˆãƒ ã‚·\") if err != nil { fmt.Println(err) } // ãƒ¡ã‚½ãƒƒãƒ‰ã‚’å®Ÿè¡Œã™ã‚‹ï¼ fmt.Println(insect.Name()) } # Eatãƒ¡ã‚½ãƒƒãƒ‰ã‚’ç´ä»˜ã‘ã¦ã„ãªã„å ´åˆ cannot use insect (type Insect) as type Animal in assignment: Insect does not implement Animal (missing Eat method) ãƒ»ç·©ã„å‹ã¨ã—ã¦ã®ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ æ§˜ã€…ãªå€¤ã‚’ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹å‹ã¨ã—ã¦å®šç¾©ã§ãã‚‹ï¼ã¾ãŸï¼Œä»–ã®å‹ã«å¤‰æ›ã™ã‚‹ã“ã¨ã‚‚ã§ãã‚‹ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š package main import ( \"fmt\" ) func main() { var x interface{} x = 1 fmt.Printf(\"%#v\\n\", x) // 1 x = 3.14 fmt.Printf(\"%#v\\n\", x) // 3.14 x = \"Hiroki\" fmt.Printf(\"%#v\\n\", x) // \"Hiroki\" x = [...]uint8{1, 2, 3, 4, 5} fmt.Printf(\"%#v\\n\", x) // [5]uint8{0x1, 0x2, 0x3, 0x4, 0x5} } ãªãŠï¼Œã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹å‹ã¯ã¯æ¼”ç®—ã§ããªã„ï¼ package main import ( \"fmt\" ) func main() { var x, y interface{} // ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹å‹ x, y = 1, 2 fmt.Printf(\"%#v\\n\", x) // 1 fmt.Printf(\"%#v\\n\", y) // 2 // ã‚¨ãƒ©ãƒ¼ã«ãªã‚‹ï¼ // invalid operation: x + y (operator + not defined on interface) z := x + y fmt.Printf(\"%#v\\n\", z) } ãƒ»å‹ã‚¢ã‚µãƒ¼ã‚·ãƒ§ãƒ³ ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹å‹ã‚’ä»–ã®å‹ã«å¤‰æ›ã™ã‚‹ï¼ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹å‹ã®å¤‰æ•°ã§ã€.(ãƒ‡ãƒ¼ã‚¿å‹)ã€ã‚’å®£è¨€ã™ã‚‹ï¼ package main import ( \"fmt\" ) func main() { var x, y interface{} // ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹å‹ x, y = 1, 2 // ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹å‹ã‹ã‚‰æ•´æ•°å‹ã«å¤‰æ›ï¼ˆå¤‰æ›ã—ãªã„ã¨æ¼”ç®—ã§ããªã„ï¼‰ a := x.(int) b := y.(int) z := a + b fmt.Printf(\"%#v\\n\", z) } ãƒ»errorã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ Goã«ã¯ï¼Œæ¨™æº–æ­è¼‰ã•ã‚Œã¦ã„ã‚‹ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ãŒã‚ã‚‹ï¼ã“ã®ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ãŒå¼·åˆ¶ã™ã‚‹ãƒ¡ã‚½ãƒƒãƒ‰ã‚’å®Ÿè£…ã—ãŸæ§‹é€ ä½“ã‚’å®šç¾©ã™ã‚‹ã¨ï¼Œè‡ªå‹•çš„ã«å§”è­²ãŒè¡Œã‚ã‚Œã‚‹ï¼ ï¼Šä¾‹ï¼Š errorã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã®å§”è­²ã«ã¤ã„ã¦ã¯ï¼Œæœ¬ãƒãƒ¼ãƒˆå†…ã®èª¬æ˜ã‚’å‚è€ƒã«ã›ã‚ˆï¼ type error interface { Error() string } ãƒ»stringã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ æ§‹é€ ä½“ã«Stringãƒ¡ã‚½ãƒƒãƒ‰ã‚’å®šç¾©ã—ã¦ãŠãã¨ï¼ŒPrintç³»é–¢æ•°ã«æ§‹é€ ä½“ã‚’æ¸¡ã—ãŸæ™‚ã«ï¼Œã“ã‚ŒãŒå®Ÿè¡Œã•ã‚Œã‚‹ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š package main import \"fmt\" type Foo struct{} func (f *Foo) String() string { return \"Stringãƒ¡ã‚½ãƒƒãƒ‰ã‚’å®Ÿè¡Œã—ã¾ã—ãŸï¼\" } func main() { f := &Foo{} fmt.Println(f) } nil ãƒ»nilã¨ã¯ ã„ãã¤ã‹ã®ãƒ‡ãƒ¼ã‚¿å‹ã«ãŠã‘ã‚‹åˆæœŸå€¤ã®ã“ã¨ï¼ ãƒ»ãƒã‚¤ãƒ³ã‚¿ã®å ´åˆ ï¼Šå®Ÿè£…ä¾‹ï¼Š package main import \"fmt\" func main() { x := \"x\" // ãƒã‚¤ãƒ³ã‚¿å‹ã®å®šç¾©ã®ã¿ var p1 *string // ãƒã‚¤ãƒ³ã‚¿å‹ã®å¤‰æ•°ã‚’å®šç¾©ä»£å…¥ var p2 *string = &x fmt.Printf(\"%#v\\n\", p1) // (*string)(nil) fmt.Printf(\"%#v\\n\", p2) // (*string)(0xc0000841e0) } ãƒ»ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã®å ´åˆ ï¼Šå®Ÿè£…ä¾‹ï¼Š package main import \"fmt\" func main() { var x interface{} fmt.Printf(\"%#v\\n\", x) // } 02. é–¢æ•° mainé–¢æ•° ãƒ»mainé–¢æ•°ã¨ã¯ goã®ã‚¨ãƒ³ãƒˆãƒªãƒã‚¤ãƒ³ãƒˆã¨ãªã‚‹ï¼goã®ãƒ—ãƒ­ã‚°ãƒ©ãƒ ãŒèµ·å‹•ã—ãŸã¨ãã«ï¼Œå„ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®inité–¢æ•°ãŒå®Ÿè¡Œã•ã‚ŒãŸå¾Œï¼Œmainé–¢æ•°ãŒå®Ÿè¡Œã•ã‚Œã‚‹ï¼mainé–¢æ•°ã‚’ãƒ“ãƒ«ãƒ‰å¯¾è±¡ã«æŒ‡å®šã™ã‚‹ã¨ï¼Œã“ã‚Œã‚’èµ·ç‚¹ã¨ã—ã¦èª­ã¿è¾¼ã¾ã‚Œã‚‹ãƒ•ã‚¡ã‚¤ãƒ«ãŒæåˆ†ã‹ã‚ŒçŠ¶ã«ãƒ“ãƒ«ãƒ‰ã•ã‚Œã¦ã„ãï¼ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã€0ã€ã§ãƒ—ãƒ­ã‚»ã‚¹ã‚’çµ‚äº†ã™ã‚‹ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š package main import \"fmt\" func main() { fmt.Printf(\"%#v\\n\", \"Hello world!\") } å½“ç„¶ï¼Œmainãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚„mainé–¢æ•°ãŒç„¡ã„ã¨ï¼Œgoã®ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã®èµ·å‹•æ™‚ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã™ã‚‹ï¼ $ go run server.go go run: cannot run non-main package $ go run server.go # command-line-arguments runtime.main: call to external function main.main runtime.main: main.main: not defined runtime.main: undefined: main.main ç‹¬è‡ªé–¢æ•° ãƒ»é–¢æ•°ã¨ã¯ æ§‹é€ ä½“ã«ç´ä»˜ã‘ã‚‰ã‚Œã¦ã„ãªã„é–¢æ•°ã®ã“ã¨ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š package main import \"fmt\" // é ­æ–‡å­—ã‚’å¤§æ–‡å­—ã™ã‚‹ func Foo(x string) string { fmt.Println(x) } func main() { Foo(\"Hello world!\") } ãƒ»å¼•æ•°ã®å‹ å¼•æ•°ã®å‹ã¨ã—ã¦ï¼Œæ§‹é€ ä½“ã®å ´åˆã¯ãƒã‚¤ãƒ³ã‚¿å‹ï¼Œãã‚Œä»¥å¤–ã®ãƒ‡ãƒ¼ã‚¿ã®å ´åˆã¯ãƒã‚¤ãƒ³ã‚¿å‹ä»¥å¤–ãŒæ¨å¥¨ã•ã‚Œã‚‹ï¼ https://github.com/golang/go/wiki/CodeReviewComments#pass-values ãƒ»Closureï¼ˆç„¡åé–¢æ•°ï¼‰ã¨ã¯ åå‰ã®ãªã„é–¢æ•°ã®ã“ã¨ï¼ ãƒ»å³æ™‚é–¢æ•°ã¨ã¯ å®šç¾©ã—ãŸãã®å ´ã§ã‚³ãƒ¼ãƒ«ã•ã‚Œã‚‹ç„¡åé–¢æ•°ã®ã“ã¨ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š mainé–¢æ•°ã§å³æ™‚é–¢æ•°ã‚’å®Ÿè¡Œã™ã‚‹ï¼ package main import \"fmt\" func main() { result := func() string { return \"Closure is working!\" }() fmt.Printf(\"%#v\\n\", result) } ï¼Šå®Ÿè£…ä¾‹ï¼Š å³æ™‚é–¢æ•°ã«å¼•æ•°ã‚’è¨­å®šã§ãã‚‹ï¼ãã®å ´åˆï¼Œä»®å¼•æ•°ã¨å¼•æ•°ã®ä¸¡æ–¹ã‚’è¨­å®šã™ã‚‹å¿…è¦ãŒã‚ã‚‹ï¼ package main import \"fmt\" func main() { // ä»®å¼•æ•°ã‚’è¨­å®š result := func(x string) string { return x }(\"Closure is working!\") // å¼•æ•°ã«å€¤ã‚’æ¸¡ã™ fmt.Printf(\"%#v\\n\", result) } ãƒ¡ã‚½ãƒƒãƒ‰ ãƒ»ãƒ¡ã‚½ãƒƒãƒ‰ã¨ã¯ ãƒ‡ãƒ¼ã‚¿å‹ã‚„å‹ãƒªãƒ†ãƒ©ãƒ«ã«ç´ä»˜ã‘ã‚‰ã‚Œã¦ã„ã‚‹é–¢æ•°ã®ã“ã¨ï¼Goã¯ï¼Œè¨€èªã¨ã—ã¦ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã¨ã„ã†æ©Ÿèƒ½ã‚’æŒã£ã¦ã„ãªã„ãŒï¼Œæ§‹é€ ä½“ã«é–¢æ•°ã‚’ç´ä»˜ã‘ã‚‹ã“ã¨ã§ï¼Œæ“¬ä¼¼çš„ã«ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’è¡¨ç¾ã§ãã‚‹ï¼ ãƒ»ãƒ¬ã‚·ãƒ¼ãƒã«ã‚ˆã‚‹ç´ä»˜ã‘ ãƒ‡ãƒ¼ã‚¿å‹ã‚„å‹ãƒªãƒ†ãƒ©ãƒ«ãªã©ã‚’é–¢æ•°ã®ãƒ¬ã‚·ãƒ¼ãƒã¨ã—ã¦æ¸¡ã™ã“ã¨ã«ã‚ˆã£ã¦ï¼Œãã‚Œã«é–¢æ•°ã‚’ç´ä»˜ã‘ã‚‰ã‚Œã‚‹ï¼ç´ä»˜ã‘å¾Œï¼Œé–¢æ•°ã¯ãƒ¡ã‚½ãƒƒãƒ‰ã¨å‘¼ã°ã‚Œã‚‹ã‚ˆã†ã«ãªã‚‹ï¼ãƒ¡ã‚½ãƒƒãƒ‰åã¨ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰åã«åŒã˜åå‰ã¯ä½¿ç”¨ã§ããªã„ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š intå‹ã‚’å€¤ãƒ¬ã‚·ãƒ¼ãƒã¨ã—ã¦æ¸¡ã—ï¼Œæ§‹é€ ä½“ã«é–¢æ•°ã‚’ç´ä»˜ã‘ã‚‹ï¼ package main import \"fmt\" type Age int func (a Age) PrintAge() string { return fmt.Sprintf(\"%dã§ã™ï¼\", a) } func main() { var age Age = 20 fmt.Printf(\"%#v\\n\", age.printAge()) } ï¼Šå®Ÿè£…ä¾‹ï¼Š æ§‹é€ ä½“ã‚’å€¤ãƒ¬ã‚·ãƒ¼ãƒã¨ã—ã¦æ¸¡ã—ï¼Œæ§‹é€ ä½“ã«é–¢æ•°ã‚’ç´ä»˜ã‘ã‚‹ï¼ package main import \"fmt\" // æ§‹é€ ä½“ã‚’å®šç¾© type Person struct { name string } // ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ func NewPerson(name string) *Person { return &Person{ name: name, } } // æ§‹é€ ä½“ã«é–¢æ•°ã‚’ç´ä»˜ã‘ã‚‹ï¼ func (p Person) GetName() string { return p.name } // æ§‹é€ ä½“ã‹ã‚‰é–¢æ•°ã‚’ã‚³ãƒ¼ãƒ« func main() { // æ§‹é€ ä½“ã‚’åˆæœŸåŒ– person := NewPerson(\"Hiroki\") fmt.Printf(\"%#v\\n\", person.GetName()) // \"Hiroki\" } ãƒ»å€¤ãƒ¬ã‚·ãƒ¼ãƒ æ§‹é€ ä½“ã®å®Ÿä½“ã¨é–¢æ•°ã‚’ç›´æ¥çš„ã«ç´ä»˜ã‘ã‚‹ï¼ç´ä»˜ã‘å¾Œï¼Œé–¢æ•°ã¯ãƒ¡ã‚½ãƒƒãƒ‰ã¨å‘¼ã°ã‚Œã‚‹ã‚ˆã†ã«ãªã‚‹ï¼ãƒ¬ã‚·ãƒ¼ãƒã¨ã—ã¦æ¸¡ã•ã‚ŒãŸå¼•æ•°ã‚’ãƒ¡ã‚½ãƒƒãƒ‰å†…ã§ã‚³ãƒ”ãƒ¼ã—ã¦ã‹ã‚‰ä½¿ç”¨ã™ã‚‹ï¼å€¤ãƒ¬ã‚·ãƒ¼ãƒã«ã‚ˆã£ã¦ç´ä»˜ã‘ã‚‰ã‚Œã‚‹ã¨ï¼Œãã®ãƒ¡ã‚½ãƒƒãƒ‰ã¯æ§‹é€ ä½“ã®çŠ¶æ…‹ã‚’å¤‰ãˆã‚‰ã‚Œãªããªã‚‹ã®ã§ï¼Œæ§‹é€ ä½“ã‚’ã‚¤ãƒŸãƒ¥ãƒ¼ã‚¿ãƒ–ãƒ«ã«ã—ãŸã„å ´åˆã¯ï¼Œå€¤ãƒ¬ã‚·ãƒ¼ãƒã‚’ä½¿ã†ã¨è‰¯ã„ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š æ§‹é€ ä½“ã‚’å€¤ãƒ¬ã‚·ãƒ¼ãƒã¨ã—ã¦æ¸¡ã—ï¼Œæ§‹é€ ä½“ã«é–¢æ•°ã‚’ç´ä»˜ã‘ã‚‹ï¼ package main import \"fmt\" type Person struct { name string } // ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ func NewPerson(name string) *Person { return &Person{ name: name, } } // å€¤ãƒ¬ã‚·ãƒ¼ãƒ func (p Person) SetName(name string) { // å¼•æ•°ã®æ§‹é€ ä½“ã‚’ã‚³ãƒ”ãƒ¼ã—ã¦ã‹ã‚‰ä½¿ç”¨ p.name = name } func (p Person) GetName() string { return p.name } func main() { person := NewPerson(\"Gopher\") person.SetName(\"Hiroki\") fmt.Printf(\"%#v\\n\", person.GetName()) // \"Gopher\" } ãƒ»ãƒã‚¤ãƒ³ã‚¿ãƒ¬ã‚·ãƒ¼ãƒ æ§‹é€ ä½“ã®ãƒã‚¤ãƒ³ã‚¿ã‚’ç”¨ã„ã¦ï¼Œé–¢æ•°ã¨æ§‹é€ ä½“ã®å®Ÿä½“ã‚’ç´ä»˜ã‘ã‚‹ï¼ç´ä»˜ã‘å¾Œï¼Œé–¢æ•°ã¯ãƒ¡ã‚½ãƒƒãƒ‰ã¨å‘¼ã°ã‚Œã‚‹ã‚ˆã†ã«ãªã‚‹ï¼ãƒ¬ã‚·ãƒ¼ãƒã¨ã—ã¦æ¸¡ã•ã‚ŒãŸå¼•æ•°ã‚’ãƒ¡ã‚½ãƒƒãƒ‰å†…ã§ãã®ã¾ã¾ä½¿ç”¨ã™ã‚‹ï¼ãƒã‚¤ãƒ³ã‚¿ãƒ¬ã‚·ãƒ¼ãƒã«ã‚ˆã£ã¦ç´ä»˜ã‘ã‚‰ã‚Œã‚‹ã¨ï¼Œãã®ãƒ¡ã‚½ãƒƒãƒ‰ã¯æ§‹é€ ä½“ã®çŠ¶æ…‹ã‚’å¤‰ãˆã‚‰ã‚Œã‚‹ã‚ˆã†ã«ãªã‚‹ã®ã§ï¼Œæ§‹é€ ä½“ã‚’ãƒŸãƒ¥ãƒ¼ã‚¿ãƒ–ãƒ«ã«ã—ãŸã„å ´åˆã¯ï¼Œãƒã‚¤ãƒ³ã‚¿ãƒ¬ã‚·ãƒ¼ãƒã‚’ä½¿ã†ã¨è‰¯ã„ï¼æ§‹é€ ä½“ã‚’åˆæœŸåŒ–ã™ã‚‹å‡¦ç†ã‚’æŒã¤ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿é–¢æ•°ã®ã¿ã‚’ãƒã‚¤ãƒ³ã‚¿ãƒ¬ã‚·ãƒ¼ãƒã¨ã—ï¼Œä»–ã®ãƒ¡ã‚½ãƒƒãƒ‰ã‚’å…¨ã¦å€¤ãƒ¬ã‚·ãƒ¼ãƒã¨ã™ã‚‹ã¨ï¼Œæœ€ä½é™ã«ãƒŸãƒ¥ãƒ¼ã‚¿ãƒ–ãƒ«ãªãƒ—ãƒ­ã‚°ãƒ©ãƒ ã‚’å®Ÿè£…ã§ãã‚‹ï¼ã¾ãŸï¼Œæ§‹é€ ä½“ã¯ãƒã‚¤ãƒ³ã‚¿å‹ã¨ã—ã¦æ‰±ã£ãŸæ–¹ãŒãƒ¡ãƒ¢ãƒªã‚’ç¯€ç´„ã§ãã‚‹ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š package main import \"fmt\" type Person struct { Name string } // ãƒã‚¤ãƒ³ã‚¿ãƒ¬ã‚·ãƒ¼ãƒ func (p *Person) SetName(name string) { // å¼•æ•°ã®æ§‹é€ ä½“ã‚’ãã®ã¾ã¾ä½¿ç”¨ p.Name = name } func (p *Person) GetName() string { return p.Name } func main() { person := Person{Name: \"Gopher\"} person.SetName(\"Hiroki\") fmt.Printf(\"%#v\\n\", person.GetName()) // \"Hiroki\" } deferé–¢æ•° ãƒ»deferé–¢æ•°ã¨ã¯ å…¨ã¦ã®å‡¦ç†ã®æœ€å¾Œã«å¿…ãšå®Ÿè¡Œã•ã‚Œã‚‹é…å»¶å®Ÿè¡Œé–¢æ•°ã®ã“ã¨ï¼ãŸã¨ãˆï¼Œãƒ©ãƒ³ã‚¿ã‚¤ãƒ ã‚¨ãƒ©ãƒ¼ã®ã‚ˆã†ã«å‡¦ç†ãŒå¼·åˆ¶çš„ã«é€”ä¸­çµ‚äº†ã—ã¦ã‚‚å®Ÿè¡Œã•ã‚Œã‚‹ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š å³æ™‚é–¢æ•°ã‚’deferé–¢æ•°åŒ–ã—ã¦ã„ã‚‹ï¼å‡¦ç†ã®æœ€å¾Œã«ãƒ©ãƒ³ã‚¿ã‚¤ãƒ ã‚¨ãƒ©ãƒ¼ãŒèµ·ã“ã£ãŸã¨ãï¼Œã“ã‚Œã‚’recoverãƒ¡ã‚½ãƒƒãƒ‰ã§å¸åã§ãã‚‹ï¼ package main import \"fmt\" func main() { fmt.Println(\"Start\") // ã‚ã‚‰ã‹ã˜ã‚deferé–¢æ•°ã‚’å®šç¾©ã—ã¦ãŠã defer func() { err := recover() if err != nil { fmt.Printf(\"Recover: %#v\\n\", err) } fmt.Println(\"End\") }() // ã“ã“ã§æ„å›³çš„ã«å‡¦ç†ã‚’åœæ­¢ã•ã›ã¦ã„ã‚‹ï¼ panic(\"Runtime error\") } // Start // Recover: \"Runtime error\" // End ãƒ»è¤‡æ•°ã®deferé–¢æ•° deferã¯è¤‡æ•°ã®é–¢æ•°ã§å®£è¨€ã§ãã‚‹ï¼è¤‡æ•°å®£è¨€ã—ãŸå ´åˆï¼Œå¾Œã«å®£è¨€ã•ã‚ŒãŸã‚‚ã®ã‹ã‚‰å®Ÿè¡Œã•ã‚Œã‚‹ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š package main import \"fmt\" func main() { defer fmt.Println(\"1\") defer fmt.Println(\"2\") defer fmt.Println(\"3\") } // 3 // 2 // 1 è¿”å´å€¤ ãƒ»è¤‡æ•°ã®è¿”å´å€¤ ï¼Šå®Ÿè£…ä¾‹ï¼Š package main import \"fmt\" func division(x int, y int) (int, int) { // å•†ã‚’è¨ˆç®—ã™ã‚‹ï¼ quotient := x / y // ä½™ã‚Šã‚’è¨ˆç®—ã™ã‚‹ï¼ remainder := x % y // å•†ã¨ä½™ã‚Šã‚’è¿”å´ã™ã‚‹ï¼ return quotient, remainder } func main() { // 10Ã·3ã‚’è¨ˆç®—ã™ã‚‹ï¼ q, r := division(10, 3) fmt.Printf(\"å•†=%dï¼Œä½™ã‚Š=%d\", q, r) } ãƒ»è¿”å´å€¤ã®ç ´æ£„ é–¢æ•°ã‹ã‚‰è¤‡æ•°ã®å€¤ãŒè¿”å´ã•ã‚Œã‚‹æ™‚ï¼Œä½¿ã‚ãªã„å€¤ã‚’ã‚¢ãƒ³ãƒ€ãƒ¼ã‚¹ã‚³ã‚¢ã«ä»£å…¥ã™ã‚‹ã“ã¨ã§ï¼Œã“ã‚Œã‚’ç ´æ£„ã§ãã‚‹ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š package main import ( \"fmt\" \"os\" ) func main() { // errorã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã‚’ç ´æ£„ file, _ := os.Open(\"filename.txt\") // ã‚¨ãƒ©ãƒ¼ã‚­ãƒ£ãƒƒãƒã™ã‚‹å¿…è¦ãŒãªããªã‚‹ fmt.Printf(\"%#v\\n\", flle) } 04. å¤‰æ•° å®šç¾©ï¼ˆå®£è¨€ï¼‹ä»£å…¥ï¼‰ ãƒ»æ˜ç¤ºçš„ãªå®šç¾© ï¼Šå®Ÿè£…ä¾‹ï¼Š // ä¸€ã¤ã®å¤‰æ•°ã‚’å®šç¾©ï¼ˆå®£è¨€ã¨ä»£å…¥ãŒåŒæ™‚ã§ãªã„ï¼‰ var number int number = 5 // ä¸€ã¤ã®å¤‰æ•°ã‚’å®šç¾©ï¼ˆå®£è¨€ã¨ä»£å…¥ãŒåŒæ™‚ï¼‰ var number int = 5 // è¤‡æ•°ã®å¤‰æ•°ã‚’å®šç¾© var x, y, z int x, y, z = 1, 3, 5 ãƒ»æš—é»™çš„ãªå®šç¾©ï¼ˆå‹æ¨è«–ï¼‰ ï¼Šå®Ÿè£…ä¾‹ï¼Š // ãƒ‡ãƒ¼ã‚¿å‹ãŒè‡ªå‹•çš„ã«èªè­˜ã•ã‚Œã‚‹ w := 1 x := true y := 3.14 z := \"abc\" var w = 1 var ( x = true y = 3.14 z = \"abc\" ) package main import \"fmt\" func quotient(x int, y int) int { // å•†ã‚’è¨ˆç®—ã™ã‚‹ï¼ quotient := x / y // ã‚’è¿”å´ã™ã‚‹ï¼ return quotient } func main() { fmt.Println(quotient(2, 2)) } ãƒ»å†å®£è¨€ åŸºæœ¬çš„ã«ã¯ï¼ŒåŒã˜ã‚¹ã‚³ãƒ¼ãƒ—å†…ã§æ—¢å­˜ã®å¤‰æ•°ã‚’å†å®£è¨€ã§ããªã„ï¼ãŸã ã—ï¼Œè¤‡æ•°ã®å¤‰æ•°ã‚’å®£è¨€ã™ã‚‹æ™‚ã«ï¼Œã„ãšã‚Œã‹ã«æ–°ã—ã„å¤‰æ•°ã®å®£è¨€ãŒå«ã¾ã‚Œã¦ã„ã‚Œã°ï¼Œæ—¢å­˜ã®å¤‰æ•°ã‚’å®£è¨€ã—ãŸã¨ã—ã¦ã‚‚ï¼Œä»£å…¥ã®ã¿ãŒå®Ÿè¡Œã•ã‚Œã‚‹ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š package main import ( \"fmt\" ) func main() { x := 1 // æ–°ã—ã„å¤‰æ•°ã®å®£è¨€ãŒå«ã¾ã‚Œã¦ã„ã‚‹ x, y := 2, 3 fmt.Printf(\"%#v\\n\", x) // 2 fmt.Printf(\"%#v\\n\", y) // 3 } å®šç¾©ä½ç½®ã®ç¨®é¡ ãƒ»ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸å¤‰æ•° é–¢æ•°ã®å¤–éƒ¨ã§å®šç¾©ã•ã‚ŒãŸå¤‰æ•°ã®ã“ã¨ï¼ã‚¹ã‚³ãƒ¼ãƒ—ã¨ã—ã¦ï¼Œå®£è¨€ã•ã‚ŒãŸãƒ‘ãƒƒã‚±ãƒ¼ã‚¸å¤–éƒ¨ã§ã‚‚ä½¿ç”¨ã§ãã‚‹ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸å¤‰æ•°ã‚’å®£è¨€ã—ï¼Œé–¢æ•°å†…ã§å€¤ã‚’ä»£å…¥ã™ã‚‹ï¼ package main import ( \"fmt\" ) // ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸å¤‰æ•° var text string func main() { text = \"Hello World!\" fmt.Printf(\"%#v\\n\", text) } å¤‰æ•°ã¸ã®å€¤ã®ä»£å…¥ã¯é–¢æ•°å†…ã§ã—ã‹ã§ããªã„ãŸã‚ï¼Œå®£è¨€ã¨ä»£å…¥ã‚’åŒæ™‚ã«è¡Œã†å‹æ¨è«–ã‚’ä½¿ç”¨ã™ã‚‹ã¨ã‚¨ãƒ©ãƒ¼ã«ãªã‚‹ï¼ package main import ( \"fmt\" ) // ã‚¨ãƒ©ãƒ¼ã«ãªã‚‹ï¼ text := \"Hello World!\" func main() { fmt.Printf(\"%#v\\n\", text) } ãƒ»ãƒ­ãƒ¼ã‚«ãƒ«å¤‰æ•° é–¢æ•°ã®å†…éƒ¨ã§å®šç¾©ã•ã‚ŒãŸå¤‰æ•°ã®ã“ã¨ï¼ã‚¹ã‚³ãƒ¼ãƒ—ã¨ã—ã¦ï¼Œå®£è¨€ã•ã‚ŒãŸãƒ‘ãƒƒã‚±ãƒ¼ã‚¸å†…éƒ¨ã§ã—ã‹ä½¿ç”¨ã§ããªã„ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š package main import ( \"fmt\" ) func main() { // ãƒ­ãƒ¼ã‚«ãƒ«å¤‰æ•° text := \"Hello World!\" fmt.Printf(\"%#v\\n\", text) } 03. ã‚¹ã‚³ãƒ¼ãƒ— å¤‰æ•°ï¼Œå®šæ•° ãƒ»ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸å†…å¤–ã‹ã‚‰å‚ç…§å¯èƒ½ å¤‰æ•°åã¾ãŸã¯å®šæ•°åã®é ­æ–‡å­—ã‚’å¤§æ–‡å­—ã™ã‚‹ã¨ï¼Œãƒ‘ãƒƒã‚±ãƒ¼ã‚¸å†…å¤–ã§ã“ã‚Œã‚’ã‚³ãƒ¼ãƒ«ã§ãã‚‹ã‚ˆã†ã«ãªã‚‹ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š package foo // å®šæ•°ã‚’å®šç¾©ã™ã‚‹ï¼ const ( X = \"X\" ) package main import ( \"fmt\" ) func main() { fmt.Printf(\"%#v\\n\", X) // X } ãƒ»ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸å†…ã®ã¿å‚ç…§å¯èƒ½ å¤‰æ•°åã¾ãŸã¯å®šæ•°åã®é ­æ–‡å­—ã‚’å°æ–‡å­—ã™ã‚‹ã¨ï¼Œãƒ‘ãƒƒã‚±ãƒ¼ã‚¸å¤–ã§ã“ã‚Œã‚’ã‚³ãƒ¼ãƒ«ã§ããªããªã‚‹ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š package main import ( \"fmt\" ) // å®šæ•°ã‚’å®šç¾©ã™ã‚‹ï¼ const ( yZ = \"yZ\" ) func main() { fmt.Printf(\"%#v\\n\", yZ) // yZ } é–¢æ•° ãƒ»ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸å†…å¤–ã‹ã‚‰å‚ç…§å¯èƒ½ é–¢æ•°åã®é ­æ–‡å­—ã‚’å¤§æ–‡å­—ã™ã‚‹ã¨ï¼Œãƒ‘ãƒƒã‚±ãƒ¼ã‚¸å†…å¤–ã§ã“ã‚Œã‚’ã‚³ãƒ¼ãƒ«ã§ãã‚‹ã‚ˆã†ã«ãªã‚‹ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š package foo func Foo() { // ä½•ã‚‰ã‹ã®å‡¦ç† } package main func main() { Foo() } ãƒ»ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸å†…ã®ã¿å‚ç…§å¯èƒ½ é–¢æ•°åã®é ­æ–‡å­—ã‚’å°æ–‡å­—ã™ã‚‹ã¨ï¼Œãƒ‘ãƒƒã‚±ãƒ¼ã‚¸å¤–ã§ã“ã‚Œã‚’ã‚³ãƒ¼ãƒ«ã§ããªããªã‚‹ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š package main func foo() { // ä½•ã‚‰ã‹ã®å‡¦ç† } func main() { foo() } 04. åˆ¶å¾¡æ–‡ é…åˆ—ã¾ãŸã¯ã‚¹ãƒ©ã‚¤ã‚¹ã®èµ°æŸ» ãƒ»for ... range é…åˆ—ã¾ãŸã¯ã‚¹ãƒ©ã‚¤ã‚¹ã‚’èµ°æŸ»ã™ã‚‹ï¼PHPã®foreachã«ç›¸å½“ã™ã‚‹ï¼ package main import ( \"fmt\" ) func main() { slice := []string{\"a\", \"b\", \"c\"} for key, value := range slice { fmt.Println(key, value) } } // 0 a // 1 b // 2 c 05. å‡¦ç†ã®ç¨®é¡ åŒæœŸå‡¦ç† ãƒ»åŒæœŸå‡¦ç†ã¨ã¯ å‰ã®å‡¦ç†ã‚’å¾…ã£ã¦ï¼Œæ¬¡ã®å‡¦ç†ã‚’é–‹å§‹ã™ã‚‹ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š package main import \"fmt\" func main() { fmt.Println(\"1\") fmt.Println(\"2\") fmt.Println(\"3\") } // 1 // 2 // 3 éåŒæœŸå‡¦ç†ï¼ˆä¸¦è¡Œå‡¦ç†ï¼‰ ãƒ»éåŒæœŸå‡¦ç†ï¼ˆä¸¦è¡Œå‡¦ç†ï¼‰ã¨ã¯ å‰ã®å‡¦ç†ã®çµ‚äº†ã‚’å¾…ãŸãšã«æ¬¡ã®å‡¦ç†ã‚’é–‹å§‹ã—ï¼Œãã‚Œãã‚Œã®å‡¦ç†ãŒç‹¬ç«‹ã—ã¦çµ‚äº†ã™ã‚‹ï¼çµæœï¼Œçµ‚äº†ã™ã‚‹é †ç•ªã¯é †ä¸åŒã«ãªã‚‹ï¼ å‚è€ƒï¼šhttps://golang.org/pkg/sync/ ï¼Šå®Ÿè£…ä¾‹ï¼Š ä¸¦åˆ—å‡¦ç† ãƒ»ä¸¦åˆ—å‡¦ç† æŒ‡å®šã—ãŸå‡¦ç†ã‚’åŒæ™‚ã«é–‹å§‹ã—ï¼Œãã‚Œãã‚Œã®å‡¦ç†ãŒç‹¬ç«‹ã—ã¦çµ‚äº†ã™ã‚‹ï¼çµæœï¼Œçµ‚äº†ã™ã‚‹é †ç•ªã¯é †ä¸åŒã«ãªã‚‹ï¼é–¢æ•°ã§Goãƒ«ãƒ¼ãƒãƒ³ã‚’å®£è¨€ã™ã‚‹ã¨ï¼Œãã®é–¢æ•°ã®ã‚³ãƒ¼ãƒ«ã‚’ä¸¦åˆ—åŒ–ã§ãã‚‹ï¼ãŸã ã—ï¼Œmainé–¢æ•°ã¯Goãƒ«ãƒ¼ãƒãƒ³å®£è¨€ã•ã‚ŒãŸé–¢æ•°ã®å®Œäº†ã‚’å¾…ãŸãšã«çµ‚äº†ã—ã¦ã—ã¾ã†ãŸã‚ï¼Œã“ã®é–¢æ•°ã®å®Ÿè¡Œå®Œäº†ã‚’å¾…ã¤ã‚ˆã†ã«ã™ã‚‹å¿…è¦ãŒã‚ã‚‹ï¼æ–¹æ³•ã«ã¯ï¼Œä»¥ä¸‹ã®ä¸‰ã¤ãŒã‚ã‚‹ï¼ ãƒ»channel ã‚­ãƒ¥ãƒ¼ã¨ã—ã¦æ©Ÿèƒ½ã™ã‚‹ï¼ã‚­ãƒ¥ãƒ¼ã«å€¤ã‚’æ ¼ç´ã—ï¼Œã¾ãŸã‚­ãƒ¥ãƒ¼ã‹ã‚‰å€¤ã‚’å–ã‚Šå‡ºã›ã‚‹ï¼ package main import \"fmt\" func main() { // ãƒãƒ£ãƒ³ãƒãƒ«ã‚’ä»»æ„ã®ãƒ‡ãƒ¼ã‚¿å‹ã§ä½œæˆ channel := make(chan string) go func() { // ãƒãƒ£ãƒ³ãƒãƒ«ã«å€¤ã‚’æ ¼ç´ channel ãƒ»WaitGroup ä¸€ã¤ã¾ãŸã¯è¤‡æ•°ã®é–¢æ•°ã§Goãƒ«ãƒ¼ãƒãƒ³ã‚’å®£è¨€ã—ãŸã„æ™‚ã«ä½¿ç”¨ã™ã‚‹ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š ä¸¦åˆ—å‡¦ç†ã«ã‚ˆã‚Šï¼Œåå¾©å‡¦ç†ã‚’ç´ æ—©ãå®Œäº†ã§ãã‚‹ï¼å®Ÿè¡Œå®Œäº†ã«ä¸€ç§’ã‹ã‹ã‚‹é–¢æ•°ãŒã‚ã‚‹ã¨ä»®å®šã™ã‚‹ï¼åå¾©å‡¦ç†ã§ã“ã®é–¢æ•°ã‚’ã‚³ãƒ¼ãƒ«ã™ã‚‹å ´åˆï¼Œæ¯å›ã®èµ°æŸ»ã«ä¸€ç§’ã‹ã‹ã‚‹ãŸã‚ï¼Œåå¾©ã®å›æ•°ã ã‘ç§’æ•°ãŒå¢—ãˆã‚‹ï¼ã—ã‹ã—ï¼ŒGoãƒ«ãƒ¼ãƒãƒ³ã‚’å®£è¨€ã—ä¸¦åˆ—åŒ–ã™ã‚‹ã“ã¨ã«ã‚ˆã‚Šï¼Œå„èµ°æŸ»ãŒå…¨ã¦ä¸¦åˆ—ã«å®Ÿè¡Œã•ã‚Œã‚‹ãŸã‚ï¼Œåå¾©å›æ•°ãŒä½•å›ã§ã‚ã£ã¦ã‚‚ï¼Œä¸€ç§’ã§å‡¦ç†ãŒçµ‚ã‚ã‚‹ï¼ package main import ( \"fmt\" \"sync\" \"time\" ) func print(key int, value string) { fmt.Println(key, value) time.Sleep(time.Second * 1) // å‡¦ç†å®Œäº†ã«ä¸€ç§’ã‹ã‹ã‚‹ã¨ä»®å®šã™ã‚‹ï¼ } func main() { wg := &sync.WaitGroup{} slice := []string{\"a\", \"b\", \"c\"} // å‡¦ç†ã®é–‹å§‹æ™‚åˆ»ã‚’å–å¾— start := time.Now() for key, value := range slice { wg.Add(1) // go routineã®å®£è¨€ã®æ•° // Goãƒ«ãƒ¼ãƒãƒ³ã‚’å®£è¨€ã—ã¦ä¸¦åˆ—åŒ– go func(key int, value string) { defer wg.Done() // æ™‚é–“ã®ã‹ã‹ã‚‹é–¢æ•° print(key, value) }(key, value) } // Addé–¢æ•°ã§æŒ‡å®šã—ãŸæ•°ã®go routineãŒå®Ÿè¡Œã•ã‚Œã‚‹ã¾ã§å¾…æ©Ÿ wg.Wait() // é–‹å§‹æ™‚åˆ»ã‹ã‚‰çµŒéã—ãŸç§’æ•°ã‚’å–å¾— fmt.Printf(\"çµŒéç§’æ•°: %s\", time.Since(start)) } // 2 c // 0 a // 1 b // çµŒéç§’æ•°: 1s ãƒ»errgroup ã‚¨ãƒ©ãƒ¼å‡¦ç†ã‚’å«ã‚€é–¢æ•°ã§Goãƒ«ãƒ¼ãƒãƒ³ã‚’å®£è¨€ã—ãŸã„æ™‚ã«ä½¿ç”¨ã™ã‚‹ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š 06. ã‚¨ãƒ©ãƒ¼ã‚­ãƒ£ãƒƒãƒï¼Œä¾‹å¤–ã‚¹ãƒ­ãƒ¼ Goã«ãŠã‘ã‚‹ã‚¨ãƒ©ãƒ¼ã‚­ãƒ£ãƒƒãƒã¨ä¾‹å¤–ã‚¹ãƒ­ãƒ¼ ãƒ»ä¾‹å¤–ã‚¹ãƒ­ãƒ¼ã®ã‚ã‚‹è¨€èªã®å ´åˆ ä¾‹å¤–ã‚¹ãƒ­ãƒ¼ã®æ„ç¾©ã¯ï¼Œä»¥ä¸‹ã®å‚è€ƒã«ã›ã‚ˆï¼ å‚è€ƒï¼šhttps://hiroki-it.github.io/tech-notebook-gitbook/public/software/software_application_backend_php_logic_validation.html ãƒ»Goã«ã¯ä¾‹å¤–ãŒç„¡ã„ ä¾‹ãˆã°PHPã§ã¯ï¼Œã‚¨ãƒ©ãƒ¼ã‚’ã‚­ãƒ£ãƒƒãƒã—ï¼Œã‚·ã‚¹ãƒ†ãƒ é–‹ç™ºè€…ã«ã‚ã‹ã‚‹è¨€è‘‰ã«å¤‰æ›ã—ãŸä¾‹å¤–ã¨ã—ã¦ã‚¹ãƒ­ãƒ¼ã™ã‚‹ï¼Goã«ã¯ä¾‹å¤–ã‚¯ãƒ©ã‚¹ã«ç›¸å½“ã™ã‚‹ã‚‚ã®ãŒç„¡ã„ï¼ãã®ä»£ã‚ã‚Šï¼Œã‚¨ãƒ©ãƒ¼ãã®ã‚‚ã®ãŒerrorã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã«ä¿æŒã•ã‚Œã¦ãŠã‚Šï¼Œã“ã‚Œã‚’ä¸€ã¤ã®å€¤ã¨ã—ã¦æ‰±ãˆã‚‹ï¼ä¸‹æµã§ç™ºç”Ÿã—ãŸerrorã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã‚’ï¼Œãã®ã¾ã¾ä¸Šæµã«è¿”å´ã™ã‚‹ï¼ ã‚¨ãƒ©ãƒ¼ã‚­ãƒ£ãƒƒãƒ ãƒ»nilã®æ¯”è¼ƒæ¤œè¨¼ é–¢æ•°ã‹ã‚‰è¿”å´ã•ã‚ŒãŸerrã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ãŒï¼Œnilã§ãªã‹ã£ãŸå ´åˆã«ï¼Œã‚¨ãƒ©ãƒ¼ã§ã‚ã‚‹ã¨è¦‹ãªã™ã‚ˆã†ã«ã™ã‚‹ï¼ if err != nil { // ä½•ã‚‰ã‹ã®å‡¦ç† } errorã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ ãƒ»æ¨™æº–ã‚¨ãƒ©ãƒ¼ Goã§ã¯è¤‡æ•°ã®å€¤ã‚’è¿”å´ã§ãã‚‹ãŸã‚ï¼Œå¤šãã®é–¢æ•°ã§ã¯æ¨™æº–ã§ï¼Œæœ€å¾Œã«errorã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ãŒè¿”å´ã•ã‚Œã‚‹ã‚ˆã†ã«ãªã£ã¦ã„ã‚‹ï¼errorã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã¯æš—é»™çš„ã«Errorãƒ¡ã‚½ãƒƒãƒ‰ã‚’ã‚³ãƒ¼ãƒ«ã™ã‚‹ï¼ type error interface { Error() string } ï¼Šå®Ÿè£…ä¾‹ï¼Š osãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®Openãƒ¡ã‚½ãƒƒãƒ‰ã‹ã‚‰errorã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ãŒè¿”å´ã•ã‚Œã‚‹ï¼errorã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã¯Errorãƒ¡ã‚½ãƒƒãƒ‰ã‚’è‡ªå‹•çš„ã«å®Ÿè¡Œã—ï¼Œæ¨™æº–ã‚¨ãƒ©ãƒ¼å‡ºåŠ›ã«å‡ºåŠ›ã™ã‚‹ï¼ package main import ( \"fmt\" \"log\" \"os\" ) func main() { // å‡¦ç†çµæœã¨errorã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ãŒè¿”å´ã•ã‚Œã‚‹ï¼ file, err := os.Open(\"filename.txt\") if err != nil { // ã‚¨ãƒ©ãƒ¼ã®å†…å®¹ã‚’å‡ºåŠ›ã™ã‚‹ï¼ log.Fatalf(\"ERROR: %#v\\n\", err) } fmt.Printf(\"%#v\\n\", flle) } ãƒ»Newé–¢æ•°ã«ã‚ˆã‚‹ç‹¬è‡ªã‚¨ãƒ©ãƒ¼ errorsãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®Newãƒ¡ã‚½ãƒƒãƒ‰ã«ã‚¨ãƒ©ãƒ¼ã‚’è¨­å®šã™ã‚‹ï¼ã“ã‚Œã«ã‚ˆã‚Šï¼Œç‹¬è‡ªã®ã‚¨ãƒ©ãƒ¼ã‚’ä¿æŒã™ã‚‹errorã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã‚’å®šç¾©ã§ãã‚‹ï¼errorã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã¯Errorãƒ¡ã‚½ãƒƒãƒ‰ã‚’è‡ªå‹•çš„ã«å®Ÿè¡Œã™ã‚‹ï¼ å‚è€ƒï¼šhttps://golang.org/pkg/errors/#New ï¼Šå®Ÿè£…ä¾‹ï¼Š package main import ( \"errors\" \"fmt\" \"log\" \"os\" ) func NewError() error { return errors.New(\"\") } func main() { file, err := os.Open(\"filename.txt\") if err != nil { // ç‹¬è‡ªã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¨­å®šã™ã‚‹ï¼ myErr := NewError() log.Fatalf(\"ERROR: %#v\\n\", myErr) } fmt.Printf(\"%#v\\n\", flle) } ãƒ»fmt.Errorfãƒ¡ã‚½ãƒƒãƒ‰ã«ã‚ˆã‚‹ç‹¬è‡ªã‚¨ãƒ©ãƒ¼ fmtãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®Errorfãƒ¡ã‚½ãƒƒãƒ‰ã§ç‹¬è‡ªã‚¨ãƒ©ãƒ¼ã‚’ä½œæˆã§ãã‚‹ï¼äº‹å‰ã«å®šç¾©ã—ãŸãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã‚’å…ƒã«ã‚¨ãƒ©ãƒ¼ã‚’è¨­å®šã™ã‚‹ï¼ã“ã‚Œã«ã‚ˆã‚Šï¼Œç‹¬è‡ªã®ã‚¨ãƒ©ãƒ¼ã‚’ä¿æŒã™ã‚‹errorã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã‚’å®šç¾©ã§ãã‚‹ï¼errorã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã¯Errorãƒ¡ã‚½ãƒƒãƒ‰ã‚’è‡ªå‹•çš„ã«å®Ÿè¡Œã™ã‚‹ï¼ å‚è€ƒï¼šhttps://golang.org/pkg/fmt/#Errorf ï¼Šå®Ÿè£…ä¾‹ï¼Š package main import ( \"fmt\" \"os\" ) func main() { file, err := os.Open(\"filename.txt\") if err != nil { fmt.Errorf(\"ERROR: %s\", err) } fmt.Printf(\"%#v\\n\", flle) } ãƒ»æ§‹é€ ä½“ã«ã‚ˆã‚‹ç‹¬è‡ªã‚¨ãƒ©ãƒ¼ æ§‹é€ ä½“ã«Errorãƒ¡ã‚½ãƒƒãƒ‰ã‚’å®šç¾©ã™ã‚‹ã¨ï¼Œã“ã®æ§‹é€ ä½“ã«errorã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ãŒè‡ªå‹•çš„ã«å§”è­²ã•ã‚Œã‚‹ï¼ã“ã‚Œã«ã‚ˆã‚Šï¼Œç‹¬è‡ªã®ã‚¨ãƒ©ãƒ¼ã‚’ä¿æŒã™ã‚‹errorã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã‚’å®šç¾©ã§ãã‚‹ï¼errorã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã¯Errorãƒ¡ã‚½ãƒƒãƒ‰ã‚’è‡ªå‹•çš„ã«å®Ÿè¡Œã™ã‚‹ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š package main import ( \"fmt\" \"os\" ) type Error struct { Message string } func (error *Error) Error() string { return fmt.Sprintf(\"ERROR: %s\", error.Message) } func main() { file, err := os.Open(\"filename.txt\") if err != nil { // æ§‹é€ ä½“ã«å€¤ã‚’è¨­å®šã™ã‚‹ï¼ myError := &Error{Message: \"ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ãŸãŸã‚ï¼Œå‡¦ç†ã‚’çµ‚äº†ã—ã¾ã—ãŸï¼\"} // æ§‹é€ ä½“ã‚’ã‚³ãƒ¼ãƒ«ã™ã‚‹ã ã‘ã§ï¼ŒErrorãƒ¡ã‚½ãƒƒãƒ‰ãŒå®Ÿè¡Œã•ã‚Œã‚‹ï¼ fmt.Printf(\"%#v\\n\", myError) os.Exit(1) } fmt.Printf(\"%#v\\n\", flle) } xerrorsãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ ãƒ»xerrorsãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã¨ã¯ æ¨™æº–ã®errorsãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã«ã¯ï¼Œã‚¨ãƒ©ãƒ¼ã«ã‚¹ã‚¿ãƒƒã‚¯ãƒˆãƒ¬ãƒ¼ã‚¹æƒ…å ±ãŒå«ã¾ã‚Œã¦ã„ãªã„ï¼xerrorsãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã«ã‚ˆã£ã¦ç”Ÿæˆã•ã‚Œã‚‹errorã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã«ã¯ï¼Œerrorã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ãŒè¿”å´ã•ã‚ŒãŸè¡Œæ•°ãŒã‚¹ã‚¿ãƒƒã‚¯ãƒˆãƒ¬ãƒ¼ã‚¹ã¨ã—ã¦å«ã¾ã‚Œã¦ã„ã‚‹ï¼ ãƒ»Newé–¢æ•°ã«ã‚ˆã‚‹ãƒˆãƒ¬ãƒ¼ã‚¹ä»˜ä¸ ï¼Šå®Ÿè£…ä¾‹ï¼Š package main import ( \"fmt\" \"golang.org/x/xerrors\" \"log\" \"os\" ) func NewErrorWithTrace() error { return xerrors.New(\"\") } func main() { file, err := os.Open(\"filename.txt\") if err != nil { // errorã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ãŒè¿”å´ã•ã‚ŒãŸè¡Œæ•°ãŒä»˜ä¸ã•ã‚Œã‚‹ï¼ errWithStack := NewErrorWithTrace() // %+v\\n ã‚’ä½¿ç”¨ã™ã‚‹ï¼ log.Fatalf(\"ERROR: %+v\\n\", errWithStack) } fmt.Printf(\"%#v\\n\", flle) } ãƒ»Errorfãƒ¡ã‚½ãƒƒãƒ‰ã«ã‚ˆã‚‹ãƒˆãƒ¬ãƒ¼ã‚¹ä»˜ä¸ package main import ( \"fmt\" \"golang.org/x/xerrors\" \"log\" \"os\" ) func main() { file, err := os.Open(\"filename.txt\") if err != nil { // errorã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ãŒè¿”å´ã•ã‚ŒãŸè¡Œæ•°ãŒä»˜ä¸ã•ã‚Œã‚‹ï¼ errWithStack := xerrors.Errorf(\"ERROR: %w\", err) // %+v\\n ã‚’ä½¿ç”¨ã™ã‚‹ï¼ log.Fatalf(\"ERROR: %+v\\n\", errWithStack) } fmt.Printf(\"%#v\\n\", flle) } 06-02. ãƒ­ã‚®ãƒ³ã‚° logãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ ãƒ»logãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã¨ã¯ Goã«ã¯æ¨™æº–ã§ï¼Œãƒ­ã‚®ãƒ³ã‚°ç”¨ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ãŒç”¨æ„ã•ã‚Œã¦ã„ã‚‹ï¼ãŸã ã—ï¼Œæ©Ÿèƒ½ãŒä¹ã—ã„ã®ã§ï¼Œå¤–éƒ¨ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ï¼ˆä¾‹ï¼šlogrusï¼‰ã‚‚æ¨å¥¨ã§ã‚ã‚‹ï¼ å‚è€ƒï¼š https://pkg.go.dev/log https://github.com/sirupsen/logrus ãƒ»æ¥å°¾è¾Printãƒ¡ã‚½ãƒƒãƒ‰ æ¸¡ã•ã‚ŒãŸå€¤ã‚’æ¨™æº–å‡ºåŠ›ã«å‡ºåŠ›ã™ã‚‹ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š æ¸¡ã•ã‚ŒãŸerrorã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã‚’æ¨™æº–å‡ºåŠ›ã«å‡ºåŠ›ã™ã‚‹ï¼ if err != nil { log.Printf(\"ERROR: %#v\\n\", err) } ãƒ»æ¥å°¾è¾Fatalãƒ¡ã‚½ãƒƒãƒ‰ æ¸¡ã•ã‚ŒãŸå€¤ã‚’æ¨™æº–å‡ºåŠ›ã«å‡ºåŠ›ã—ï¼Œos.Exit(1)ã‚’å®Ÿè¡Œã—ã¦ï¼Œã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã€1ã€ã§å‡¦ç†ã‚’çµ‚äº†ã™ã‚‹ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š æ¸¡ã•ã‚ŒãŸerrorã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã‚’æ¨™æº–å‡ºåŠ›ã«å‡ºåŠ›ã™ã‚‹ï¼ if err != nil { // å†…éƒ¨ã§os.Exit(1)ã‚’å®Ÿè¡Œã™ã‚‹ï¼ log.Fatalf(\"ERROR: %#v\\n\", err) } ãƒ»æ¥å°¾è¾Panicãƒ¡ã‚½ãƒƒãƒ‰ æ¸¡ã•ã‚ŒãŸå€¤ã‚’æ¨™æº–å‡ºåŠ›ã«å‡ºåŠ›ã—ï¼ŒäºˆæœŸã›ã¬ã‚¨ãƒ©ãƒ¼ãŒèµ·ããŸã¨è¦‹ãªã—ã¦panicãƒ¡ã‚½ãƒƒãƒ‰ã‚’å®Ÿè¡Œã™ã‚‹ï¼ã¡ãªã¿ã«ï¼Œpanicãƒ¡ã‚½ãƒƒãƒ‰ã«ã‚ˆã£ã¦ï¼Œã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å‡ºåŠ›ï¼Œã‚¹ã‚¿ãƒƒã‚¯ãƒˆãƒ¬ãƒ¼ã‚¹å‡ºåŠ›ï¼Œå‡¦ç†åœæ­¢ãŒè¡Œã‚ã‚Œã‚‹ï¼ä½¿ç”¨ã¯éæ¨å¥¨ã§ã‚ã‚‹ï¼ å‚è€ƒï¼šhttps://github.com/golang/go/wiki/CodeReviewComments#dont-panic ï¼Šå®Ÿè£…ä¾‹ï¼Š æ¸¡ã•ã‚ŒãŸerrorã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã‚’æ¨™æº–å‡ºåŠ›ã«å‡ºåŠ›ã™ã‚‹ï¼ if err != nil { // panicãƒ¡ã‚½ãƒƒãƒ‰ã‚’å®Ÿè¡Œã™ã‚‹ï¼ log.Panicf(\"ERROR: %#v\\n\", err) } 07. ãƒ†ã‚¹ãƒˆ ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆ ãƒ»ãƒ†ã‚¹ãƒˆã®å˜ä½ ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆã¯æ§‹é€ ä½“ã‚’ãƒ†ã‚¹ãƒˆã‚¹ã‚¤ãƒ¼ãƒˆã®å˜ä½ã¨ã—ã¦è¡Œã†ï¼ ãƒ»æ§‹æˆ ãƒ–ãƒ©ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ãƒ†ã‚¹ãƒˆã¨ãƒ›ãƒ¯ã‚¤ãƒˆãƒœãƒƒã‚¯ã‚¹ãƒ†ã‚¹ãƒˆã‹ã‚‰æ§‹æˆã•ã‚Œã‚‹ï¼ä»¥ä¸‹ã®ãƒªãƒ³ã‚¯ã‚’å‚è€ƒã«ã›ã‚ˆï¼ å‚è€ƒï¼šhttps://hiroki-it.github.io/tech-notebook-gitbook/public/software/software_application_backend_php_testing_based_on_code.html ãƒ–ãƒ©ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ãƒ†ã‚¹ãƒˆ ãƒ»å®Ÿç¾æ–¹æ³• ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸åãŒï¼ŒåŒã˜ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ã‚ã‚‹å®Ÿéš›ã®å‡¦ç†ãƒ•ã‚¡ã‚¤ãƒ«ã«ã€_testã€ã‚’åŠ ãˆãŸãƒ‘ãƒƒã‚±ãƒ¼ã‚¸åã®å ´åˆï¼Œãã‚Œã¯ãƒ–ãƒ©ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ãƒ†ã‚¹ãƒˆã«ãªã‚‹ï¼ã¡ãªã¿ã«ï¼ŒGoã§ã¯ä¸€ã¤ã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªå†…ã«ä¸€ã¤ã®ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸åã—ã‹å®£è¨€ã§ããªã„ãŒï¼Œãƒ–ãƒ©ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ãƒ†ã‚¹ãƒˆã®ãŸã‚ã«ã€_testã€ã‚’åŠ ãˆã‚‹ã“ã¨ã¯è¨±ã•ã‚Œã¦ã„ã‚‹ï¼ ãƒ›ãƒ¯ã‚¤ãƒˆãƒœãƒƒã‚¯ã‚¹ãƒ†ã‚¹ãƒˆ ãƒ»å®Ÿç¾æ–¹æ³• ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸åãŒï¼ŒåŒã˜ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ã‚ã‚‹å®Ÿéš›ã®å‡¦ç†ãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸åã¨åŒã˜å ´åˆï¼Œãã‚Œã¯ãƒ›ãƒ¯ã‚¤ãƒˆãƒœãƒƒã‚¯ã‚¹ãƒ†ã‚¹ãƒˆã«ãªã‚‹ï¼ ãƒ»ç¶²ç¾…ç‡ ç¶²ç¾…ç‡ã¯ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’å˜ä½ã¨ã—ã¦è§£æã•ã‚Œã‚‹ï¼ç¶²ç¾…ã«ã¤ã„ã¦ã¯ï¼Œä»¥ä¸‹ã®ãƒªãƒ³ã‚¯ã‚’å‚è€ƒã«ã›ã‚ˆï¼ å‚è€ƒï¼šhttps://hiroki-it.github.io/tech-notebook-gitbook/public/software/software_application_backend_php_testing_based_on_code.html ãƒ†ã‚¹ãƒˆã®å®Ÿè£…æ–¹æ³•ã®Tips ãƒ»ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã®å°å…¥ ãƒ†ã‚¹ãƒˆã§ããªã„æ§‹é€ ä½“ã¯ãƒ¢ãƒƒã‚¯ã«å·®ã—æ›¿ãˆã‚‰ã‚Œã‚‹ã“ã¨ãªã‚‹ï¼ã“ã®æ™‚ï¼Œã‚ã‚‰ã‹ã˜ã‚å®Ÿéš›ã®æ§‹é€ ä½“ã‚’ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã®å®Ÿè£…ã«ã—ã¦ãŠãï¼ãƒ†ã‚¹ãƒˆæ™‚ã«ï¼Œãƒ¢ãƒƒã‚¯ã‚‚ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ã‚¤ã‚¹ã®å®Ÿè£…ã¨ã™ã‚Œã°ï¼Œãƒ¢ãƒƒã‚¯ãŒå®Ÿéš›ã®æ§‹é€ ä½“ã¨åŒã˜ãƒ‡ãƒ¼ã‚¿å‹ã¨ã—ã¦èªè­˜ã•ã‚Œã‚‹ã‚ˆã†ã«ãªã‚‹ï¼ã“ã‚Œã«ã‚ˆã‚Šï¼Œãƒ¢ãƒƒã‚¯ã«å·®ã—æ›¿ãˆã‚‰ã‚Œã‚‹ã‚ˆã†ã«ãªã‚‹ï¼ ãƒ»ãƒ†ãƒ¼ãƒ–ãƒ«é§†å‹•ãƒ†ã‚¹ãƒˆ å‚è€ƒï¼šhttps://github.com/golang/go/wiki/TableDrivenTests ãƒ»å›å¸°ãƒ†ã‚¹ãƒˆ å›å¸°ãƒ†ã‚¹ãƒˆã‚’å®Ÿç¾ã™ã‚‹ãŸã‚ï¼Œéå»ã®ãƒ†ã‚¹ãƒˆçµæœã‚’ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ã‚’ä¿å­˜ã—ã¦ãŠãï¼Œä»Šå›ã®ãƒ†ã‚¹ãƒˆçµæœãŒéå»ã®ã‚‚ã®ã¨ä¸€è‡´ã™ã‚‹ã‹ã‚’ç¢ºèªã™ã‚‹ï¼Goã§ã¯ï¼Œã“ã®ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ã‚’ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã€Golden Fileã€ã¨ã„ã†ï¼Goldenï¼ˆé‡‘ï¼‰ã¯åŒ–å­¦çš„ã«å®‰å®šã—ãŸç‰©è³ªã§ã‚ã‚‹ã“ã¨ã«ç”±æ¥ã—ã¦ãŠã‚Šï¼Œã€å®‰å®šã—ãŸãƒ—ãƒ­ãƒ€ã‚¯ãƒˆã€ã¨ã‹ã‘ã¦ã„ã‚‹ï¼å›å¸°ãƒ†ã‚¹ãƒˆã«ã¤ã„ã¦ã¯ï¼Œä»¥ä¸‹ã‚’å‚è€ƒã«ã›ã‚ˆï¼ å‚è€ƒï¼šhttps://hiroki-it.github.io/tech-notebook-gitbook/public/software/software_application_backend_php_testing_based_on_code.html ãƒ»POSTãƒ‡ãƒ¼ã‚¿ã®åˆ‡ã‚Šåˆ†ã‘ POSTãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’å—ä¿¡ã™ã‚‹ãƒ†ã‚¹ãƒˆã‚’è¡Œã†æ™‚ã«ï¼ŒJSONãƒ‡ãƒ¼ã‚¿ã‚’ãƒ•ã‚¡ã‚¤ãƒ«ã«åˆ‡ã‚Šåˆ†ã‘ã¦ãŠãï¼ã“ã‚Œã‚’ReadFileé–¢æ•°ã§èª­ã¿å‡ºã™ã‚ˆã†ã«ã™ã‚‹ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š package test import ( \"io/ioutil\" ) /** * mainãƒ¡ã‚½ãƒƒãƒ‰ã‚’ãƒ†ã‚¹ãƒˆã—ã¾ã™ï¼ */ func TestMain(t *testing.T) { // jsonãƒ•ã‚¡ã‚¤ãƒ«ã®èª­ã¿å‡ºã— data, err := ioutil.ReadFile(\"../testdata/foo.json\") // ä»¥ä¸‹ã«ãƒ†ã‚¹ãƒˆã‚³ãƒ¼ãƒ‰ã‚’å®Ÿè£…ã—ã¦ã„ã } 08. ãƒ“ãƒ«ãƒˆã‚¤ãƒ³ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ å‚è€ƒï¼šhttps://golang.org/pkg/ bytes ãƒ»Bufferãƒ¡ã‚½ãƒƒãƒ‰ æ¸¡ã•ã‚ŒãŸæ–‡å­—åˆ—ã‚’çµåˆã—ï¼Œæ¨™æº–å‡ºåŠ›ã«å‡ºåŠ›ã™ã‚‹ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š package main import ( \"bytes\" \"fmt\" ) func main() { var buffer bytes.Buffer buffer.WriteString(\"Hello \") buffer.WriteString(\"world!\") fmt.Printf(\"%#v\\n\", buffer.String()) // \"Hello world!\" } encoding/json ãƒ»Marshalé–¢æ•° æ§‹é€ ä½“ã‚’JSONã«å¤‰æ›ã™ã‚‹ï¼å¤‰æ›å‰ã«ï¼Œãƒãƒƒãƒ”ãƒ³ã‚°ã‚’è¡Œã†ã‚ˆã†ã«ã™ã‚‹ï¼å¼•æ•°ã®ãƒ‡ãƒ¼ã‚¿å‹ã¯ï¼Œãƒã‚¤ãƒ³ã‚¿å‹ã¾ãŸã¯éãƒã‚¤ãƒ³ã‚¿å‹ã®ã„ãšã‚Œã§ã‚‚å•é¡Œãªã„ï¼ãŸã ã—ï¼Œä»–ã®å¤šãã®é–¢æ•°ãŒãƒã‚¤ãƒ³ã‚¿å‹ã‚’å¼•æ•°å‹ã¨ã—ã¦ã„ã‚‹ã“ã¨ã‹ã‚‰ï¼Œãã‚Œã«åˆã‚ã›ã¦ãƒã‚¤ãƒ³ã‚¿å‹ã§æ¸¡ã™ã“ã¨ãŒå¤šã„ï¼ å‚è€ƒï¼šhttps://golang.org/pkg/encoding/json/#Marshal ï¼Šå®Ÿè£…ä¾‹ï¼Š package main import ( \"encoding/json\" \"fmt\" \"log\" ) type Person struct { // Marshalã«æ¸¡ã™æ§‹é€ ä½“ã®ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã¯ãƒ‘ãƒ–ãƒªãƒƒã‚¯ãŒå¿…é ˆ Name string `json:\"name\"` } func main() { person := &Person{Name: \"Hiroki\"} // ãƒã‚¤ãƒ³ã‚¿å‹ã¨éãƒã‚¤ãƒ³ã‚¿å‹ã®ä¸¡æ–¹ã®å¼•æ•°ã«å¯¾å¿œ byteJson, err := json.Marshal(person) if err != nil { log.Fatalf(\"ERROR: %#v\\n\", err) } // ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰çµæœã‚’å‡ºåŠ› fmt.Printf(\"%#v\\n\", string(byteJson)) // \"{\\\"Name\\\":\\\"Hiroki\\\"}\" } ã“ã®æ™‚ï¼Œæ§‹é€ ä½“ã®ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã¯ãƒ‘ãƒ–ãƒªãƒƒã‚¯ã«ã™ã‚‹å¿…è¦ãŒã‚ã‚‹ï¼ã—ã‹ã—ï¼ŒMarshalJSONé–¢æ•°ã‚’æ§‹é€ ä½“ã«å®šç¾©ã™ã‚‹ã¨ï¼ŒMarshalé–¢æ•°ã®ä»£ã‚ã‚Šã«ã“ã‚ŒãŒã‚³ãƒ¼ãƒ«ã•ã‚Œã‚‹ã‚ˆã†ã«ãªã‚‹ï¼æ§‹é€ ä½“ã«ã‚²ãƒƒã‚¿ãƒ¼ã‚’ç”¨æ„ã—ã¦ï¼ŒMarshalJSONé–¢æ•°ã§ãƒ‘ãƒ–ãƒªãƒƒã‚¯ãªæ§‹é€ ä½“ã‚’ä½œæˆã™ã‚‹ã‚ˆã†ã«ã™ã‚‹ã¨ï¼Œãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆãªæ§‹é€ ä½“ã«å¯¾ã—ã¦ã‚‚Marshalé–¢æ•°ã‚’ä½¿ç”¨ã§ãã‚‹ã‚ˆã†ã«ãªã‚‹ï¼ package main import ( \"encoding/json\" \"fmt\" \"log\" ) type Person struct { name string } func NewPerson(name string) *Person { return &Person{ name: name, } } func (p *Person) Name() string { return p.name } func (p *Person) MarshalJSON() ([]byte, error) { byteJson, err := json.Marshal(&struct { // ã“ã“ã§jsonã‚¿ã‚°ã‚’å®šç¾©ã™ã‚‹ï¼ Name string `json:\"name\"` }{ Name: p.Name(), }) return byteJson, err } func main() { person := NewPerson(\"Hiroki\") byteJson, err := json.Marshal(person) if err != nil { log.Fatalf(\"ERROR: %#v\\n\", err) } // ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰çµæœã‚’å‡ºåŠ› fmt.Printf(\"%#v\\n\", string(byteJson)) // \"{\\\"Name\\\":\\\"Hiroki\\\"}\" } ãƒ»Unmarshalé–¢æ•° JSONã‚’æ§‹é€ ä½“ã«å¤‰æ›ã™ã‚‹ï¼ãƒªã‚¯ã‚¨ã‚¹ãƒˆã®å—ä¿¡ã«ã‚ˆãä½¿ã‚ã‚Œã‚‹ï¼ãƒªã‚¯ã‚¨ã‚¹ãƒˆã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãƒœãƒ‡ã‚£ã«ã¯ãƒã‚¤ãƒˆå‹ãƒ‡ãƒ¼ã‚¿ãŒå‰²ã‚Šå½“ã¦ã‚‰ã‚Œã¦ã„ã‚‹ãŸã‚ï¼ŒUnmarshalé–¢æ•°ã®ç¬¬ä¸€å¼•æ•°ã¯ãƒã‚¤ãƒˆå‹ã«ãªã‚‹ï¼ã¾ãŸï¼Œç¬¬äºŒå¼•æ•°ã¨ã—ã¦ï¼Œå¤‰æ›å¾Œã®æ§‹é€ ä½“ã®ãƒ¡ãƒ¢ãƒªã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’æ¸¡ã™ã“ã¨ã«ã‚ˆã‚Šï¼Œç¬¬ä¸€å¼•æ•°ãŒãã®æ§‹é€ ä½“ã«å¤‰æ›ã•ã‚Œã‚‹ï¼å†…éƒ¨çš„ã«ã¯ï¼Œãã®ãƒ¡ãƒ¢ãƒªã‚¢ãƒ‰ãƒ¬ã‚¹ã«å‰²ã‚Šå½“ã¦ã‚‰ã‚Œã¦ã„ã‚‹å¤‰æ•°ã‚’æ›¸ãæ›ãˆã¦ã„ã‚‹ï¼Unmarshalé–¢æ•°ã«æ¸¡ã™æ§‹é€ ä½“ã®ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã¯ãƒ‘ãƒ–ãƒªãƒƒã‚¯ãŒå¿…è¦ã§ã‚ã‚‹ãŒï¼ŒMarshalé–¢æ•°ã¨åŒæ§˜ã«ã—ã¦ï¼ŒUnMarshalJSONé–¢æ•°ã‚’æ§‹é€ ä½“ã«å®šç¾©ã™ã‚Œã°ï¼Œä»£ã‚ã‚Šã«ã“ã‚Œã‚’ã‚³ãƒ¼ãƒ«ã§ãã‚‹ï¼ å‚è€ƒï¼šhttps://golang.org/pkg/encoding/json/#Unmarshal ï¼Šå®Ÿè£…ä¾‹ï¼Š package main import ( \"encoding/json\" \"fmt\" \"log\" ) type Person struct { // Unmarshalã«æ¸¡ã™æ§‹é€ ä½“ã®ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã¯ãƒ‘ãƒ–ãƒªãƒƒã‚¯ãŒå¿…é ˆ Name string } func main() { // ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’å—ä¿¡ã—ãŸå ´åˆã‚’æƒ³å®šã™ã‚‹ï¼ byte := []byte(`{\"name\":\"Hiroki\"}`) var person Person fmt.Printf(\"%#v\\n\", person) // main.Person{Name:\"\"}ï¼ˆå¤‰æ•°ã¯ã¾ã æ›¸ãæ›ãˆã‚‰ã‚Œã¦ã„ãªã„ï¼‰ // personå¤‰æ•°ã‚’å¤‰æ›å¾Œã®å€¤ã«æ›¸ãæ›ãˆã¦ã„ã‚‹ï¼ err := json.Unmarshal(byteJson, &person) if err != nil { log.Fatalf(\"ERROR: %#v\\n\", err) } fmt.Printf(\"%#v\\n\", person) // main.Person{Name:\"Hiroki\"}ï¼ˆå¤‰æ•°ãŒæ›¸ãæ›ãˆã‚‰ã‚ŒãŸï¼‰ } ãƒ»RawMessageé–¢æ•° JSONã‹ã‚‰æ§‹é€ ä½“ã«ãƒ‘ãƒ¼ã‚¹ã™ã‚‹ãŸã‚ã«Unmarshalé–¢æ•°ã‚’å®Ÿè¡Œã—ãŸæ™‚ã«ï¼Œéƒ¨åˆ†çš„ã«ãƒ‘ãƒ¼ã‚¹ã›ãšã«JSONã®ã¾ã¾å–å¾—ã§ãã‚‹ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š CloudWatchã¯æ§˜ã€…ãªã‚¤ãƒ™ãƒ³ãƒˆã‚’æ‰±ã†ãŸã‚ï¼Œä¸€éƒ¨ã®JSONæ§‹é€ ãŒå‹•çš„ã«å¤‰åŒ–ã™ã‚‹ï¼ãã®ãŸã‚ï¼ŒRawMessageé–¢æ•°ãŒä½¿ç”¨ã•ã‚Œã¦ã„ã‚‹ï¼ å‚è€ƒï¼šhttps://github.com/aws/aws-lambda-go/blob/master/events/cloudwatch_events.go package events import ( \"encoding/json\" \"time\" ) type CloudWatchEvent struct { Version string `json:\"version\"` // ï½ ä¸­ç•¥ ï½ Resources []string `json:\"resources\"` // å‹•çš„ã«å¤‰åŒ–ã™ã‚‹JSONæ§‹é€  Detail json.RawMessage `json:\"detail\"` } ã‚¤ãƒ™ãƒ³ãƒˆã®JSONã‚’æ–‡å­—åˆ—ã®ã¾ã¾å–å¾—ã§ãã‚‹ï¼ package handler import ( \"fmt\" ) /** * Lambdaãƒãƒ³ãƒ‰ãƒ©ãƒ¼é–¢æ•° */ func HandleRequest(event events.CloudWatchEvent) (string) { return fmt.Printf(\"%#v\\n\", event.Detail) } ãƒ»Indenté–¢æ•° æ¸¡ã•ã‚ŒãŸJSONã«ã‚¤ãƒ³ãƒ‡ãƒ³ãƒˆã‚’æŒ¿å…¥ã™ã‚‹ï¼ã‚¿ãƒ–ã‚’æŒ¿å…¥ã™ã‚‹å ´åˆã¯ã€\\tã€ï¼Œç©ºç™½äºŒã¤ã‚’æŒ¿å…¥ã™ã‚‹å ´åˆã¯ã€ ã€ã‚’è¨­å®šã™ã‚‹ï¼æ¨™æº–å‡ºåŠ›ã«å‡ºåŠ›ã™ã‚‹ã¨ï¼Œæ•´å½¢ã•ã‚ŒãŸJSONã‚’ç¢ºèªã§ãã‚‹ï¼ package main import ( \"bytes\" \"encoding/json\" \"fmt\" \"log\" ) type Objects struct { Id int Name string } func main() { objects := []Objects{ {1, \"Hiroki\"}, {2, \"Hiroko\"}, {3, \"Hiroshi\"}, } byteJson, err := json.Marshal(objects) if err != nil { log.Fatal(err) } var buf bytes.Buffer // ã‚¤ãƒ³ãƒ‡ãƒ³ãƒˆï¼ˆã‚¿ãƒ–ï¼Œç©ºç™½ï¼‰ã‚’æŒ¿å…¥ã™ã‚‹ï¼ json.Indent(&buf, byteJson, \"\", \"\\t\") // json.Indent(&buf, byteJson, \"\", \" \") fmt.Println(buf.String()) } /* çµæœ [ { \"Id\": 1, \"Name\": \"Hiroki\" }, { \"Id\": 2, \"Name\": \"Hiroko\" }, { \"Id\": 3, \"Name\": \"Hiroshi\" } ] */ fmt ãƒ»æ¥é ­æ¥å°¾è¾ç„¡ã—ãƒ¡ã‚½ãƒƒãƒ‰ æ¥é ­æ¥å°¾è¾ã®ç„¡ã„ãƒ¡ã‚½ãƒƒãƒ‰ï¼ˆPrintãƒ¡ã‚½ãƒƒãƒ‰ï¼ŒSprintãƒ¡ã‚½ãƒƒãƒ‰ï¼ŒFprintãƒ¡ã‚½ãƒƒãƒ‰ï¼Œãªã©ï¼‰ãŒå±ã™ã‚‹ï¼è¤‡æ•°ã®å¼•æ•°ã‚’ã‚¹ãƒšãƒ¼ã‚¹ã‚’æŒŸã‚“ã§ç¹‹ãï¼ å‚è€ƒï¼š https://golang.org/pkg/fmt/#Print https://golang.org/pkg/fmt/#Fprint https://golang.org/pkg/fmt/#Sprint ï¼Šå®Ÿè£…ä¾‹ï¼Š package mainimport \"fmt\"func main() { fmt.Print(\"Hello world!\") // Hello world! } ï¼Šå®Ÿè£…ä¾‹ï¼Š package main import \"fmt\" func main() { // è¤‡æ•°ã®å¼•æ•°ã‚’ã‚¹ãƒšãƒ¼ã‚¹ã§æŒŸã‚“ã§ç¹‹ã fmt.Print(1, 2, 3) // 1 2 3 } ãŸã ã—ï¼Œå¼•æ•°ã®ã„ãšã‚Œã‹ãŒæ–‡å­—åˆ—ã®å€¤ã®å ´åˆï¼Œã‚¹ãƒšãƒ¼ã‚¹ãŒæŒ¿å…¥ã•ã‚Œãªã„ï¼ package main import \"fmt\" func main() { // ã„ãšã‚Œã‹ãŒæ–‡å­—åˆ— fmt.Print(\"Hello\", \"world!\", 12345) // Helloworld!12345 } ã¾ãŸï¼Œé€£ç¶šã§ä½¿ç”¨ã—ã¦ã‚‚ï¼Œæ”¹è¡ŒãŒæŒ¿å…¥ã•ã‚Œãªã„ï¼ package main import \"fmt\" func main() { fmt.Print(\"Hello\", \"world!\") fmt.Print(\"Hello\", \"world!\") // Hello world!Hello world! } ãƒ»æ¥é ­è¾Sãƒ¡ã‚½ãƒƒãƒ‰ æ¥é ­è¾ã«Sã®ã‚ã‚‹ãƒ¡ã‚½ãƒƒãƒ‰ï¼ˆSprintãƒ¡ã‚½ãƒƒãƒ‰ï¼ŒSprintfãƒ¡ã‚½ãƒƒãƒ‰ï¼ŒSprintlnãƒ¡ã‚½ãƒƒãƒ‰ï¼Œãªã©ï¼‰ãŒå±ã™ã‚‹ï¼æ¥é ­è¾ãŒFã‚„Pã®ãƒ¡ã‚½ãƒƒãƒ‰ã¨ã¯ç•°ãªã‚Šï¼Œå‡¦ç†çµæœã‚’æ¨™æº–å‡ºåŠ›ã«å‡ºåŠ›ã›ãšã«è¿”å´ã™ã‚‹ï¼æ¨™æº–å‡ºåŠ›ã«å‡ºåŠ›ã§ãã‚‹ä»–ã®é–¢æ•°ã®å¼•æ•°ã¨ã—ã¦æ¸¡ã™å¿…è¦ãŒã‚ã‚‹ï¼ å‚è€ƒï¼š https://golang.org/pkg/fmt/#Sprint https://golang.org/pkg/fmt/#Sprintf https://golang.org/pkg/fmt/#Sprintln ï¼Šå®Ÿè£…ä¾‹ï¼Š package mainimport \"fmt\"func main() { // Sprintã¯è¿”å´ã™ã‚‹ã ã‘ fmt.Print(fmt.Sprint(1, 2, 3)) // 1 2 3} ãƒ»æ¥å°¾è¾lnãƒ¡ã‚½ãƒƒãƒ‰ æ¥å°¾è¾ã«lnã®ã‚ã‚‹ãƒ¡ã‚½ãƒƒãƒ‰ï¼ˆPrintlnãƒ¡ã‚½ãƒƒãƒ‰ï¼ŒFprintlnãƒ¡ã‚½ãƒƒãƒ‰ï¼ŒSprintlnãƒ¡ã‚½ãƒƒãƒ‰ï¼Œãªã©ï¼‰ãŒå±ã™ã‚‹ï¼è¤‡æ•°ã®å¼•æ•°ã‚’ã‚¹ãƒšãƒ¼ã‚¹ã‚’æŒŸã‚“ã§ç¹‹ãï¼Œæœ€å¾Œã«æ”¹è¡Œã‚’æŒ¿å…¥ã—ã¦çµåˆã™ã‚‹ï¼ å‚è€ƒï¼š https://golang.org/pkg/fmt/#Println https://golang.org/pkg/fmt/#Fprintln https://golang.org/pkg/fmt/#Sprintln ï¼Šå®Ÿè£…ä¾‹ï¼Š æ–‡å­—ã‚’é€£ç¶šã§æ¨™æº–å‡ºåŠ›ã«å‡ºåŠ›ã™ã‚‹ï¼ package mainimport \"fmt\"func main() { fmt.Println(\"Hello\", \"world!\") fmt.Println(\"Hello\", \"world!\") // Hello world! // Hello world!} ãƒ»æ¥å°¾è¾fãƒ¡ã‚½ãƒƒãƒ‰ æ¸¡ã•ã‚ŒãŸå¼•æ•°ã‚’ï¼Œäº‹å‰ã«å®šç¾©ã—ãŸãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã«ã‚‚åŸºã¥ã„ã¦çµåˆã™ã‚‹ï¼ ã‚ˆãä½¿ã†è­˜åˆ¥å­ æ¨™æº–å‡ºåŠ›ã«å‡ºåŠ›ã•ã‚Œã‚‹ã‚‚ã® å‚™è€ƒ %s æ–‡å­—åˆ—ã¾ãŸã¯ã‚¹ãƒ©ã‚¤ã‚¹ã¨ã—ã¦ %p ãƒã‚¤ãƒ³ã‚¿ã¨ã—ã¦ %+v ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’å«ã‚€æ§‹é€ ä½“ã¨ã—ã¦ ãƒ‡ãƒ¼ã‚¿ã®æ§‹é€ ã‚’ç¢ºèªã§ãã‚‹ãŸã‚ï¼Œãƒ‡ãƒãƒƒã‚°ã«æœ‰åŠ¹ã§ã‚ã‚‹ï¼ %#v Goæ§‹æ–‡ã¨ã—ã¦ ãƒ‡ãƒ¼ã‚¿ã®æ§‹é€ ã‚’ç¢ºèªã§ãã‚‹ãŸã‚ï¼Œãƒ‡ãƒãƒƒã‚°ã«æœ‰åŠ¹ã§ã‚ã‚‹ï¼ å‚è€ƒï¼š https://golang.org/pkg/fmt/#Printf https://golang.org/pkg/fmt/#Fprintf https://golang.org/pkg/fmt/#Sprintf ï¼Šå®Ÿè£…ä¾‹ï¼Š æ¸¡ã•ã‚ŒãŸå¼•æ•°ã‚’æ–‡å­—åˆ—ã¨ã—ã¦çµåˆã™ã‚‹ package main import \"fmt\" func main() { fmt.Printf(\"String is %s\", \"Hello world!\") } ã¾ãŸï¼Œé€£ç¶šã—ã¦ä½¿ç”¨ã—ã¦ã‚‚ï¼Œæ”¹è¡Œã¯æŒ¿å…¥ã•ã‚Œãªã„ï¼ package main import \"fmt\" func main() { fmt.Printf(\"String is %s\", \"Hello world!\") fmt.Printf(\"String is %s\", \"Hello world!\") // String is Hello world!String is Hello world! } ï¼Šå®Ÿè£…ä¾‹ï¼Š æ¸¡ã•ã‚ŒãŸå¼•æ•°ã‚’ãƒã‚¤ãƒ³ã‚¿ã¨ã—ã¦çµåˆã™ã‚‹ï¼ package main import \"fmt\" type Person struct { Name string } func main() { person:= new(Person) person.Name = \"Hiroki\" fmt.Printf(\"Pointer is %p\", person) // 0xc0000821e0 } ï¼Šå®Ÿè£…ä¾‹ï¼Š æ¸¡ã•ã‚ŒãŸè¤‡æ•°ã®å¼•æ•°ã‚’æ–‡å­—åˆ—ã¨ã—ã¦çµåˆã™ã‚‹ï¼ package mainimport \"fmt\"func main() { var first string = \"Hiroki\" var last string = \"Hasegawa\" fmt.Printf(\"Im %s %s\", first, last) // Im Hiroki Hasegawa} net/http ãƒ»httpãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã¨ã¯ HTTPã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã¾ãŸã¯Webã‚µãƒ¼ãƒã‚’æä¾›ã™ã‚‹ï¼ãã®ãŸã‚ï¼ŒGoã§ã¯Nginxã‚„ApacheãŒä¸è¦ã§ã‚ã‚‹ï¼ãŸã ï¼ŒGoã«ã‚ˆã‚‹Webã‚µãƒ¼ãƒã¯æ©Ÿèƒ½ãŒä¸ååˆ†ã§ã‚ã‚‹ï¼Œãã®ãŸã‚ï¼ŒNginxã‚„Apacheã‚’Webã‚µãƒ¼ãƒã¨ã—ã¦ï¼ŒGoã‚’Appã‚µãƒ¼ãƒã¨ã—ã¦ä½¿ç”¨ã—ãŸæ–¹ãŒè‰¯ã„ï¼ å‚è€ƒï¼š https://golang.org/pkg/net/http/#pkg-index https://stackoverflow.com/questions/17776584/what-are-the-benefits-of-using-nginx-in-front-of-a-webserver-for-go ãƒ»Getãƒ¡ã‚½ãƒƒãƒ‰ ï¼Šå®Ÿè£…ä¾‹ï¼Š package mainimport ( \"fmt\" \"log\" \"net/http\")func main() { response, err := http.Get(\"http://xxx/api.com\") defer response.Body.Close() if err != nil { log.Fatal(err) } fmt.Println(response.Body)} ãƒ»Postãƒ¡ã‚½ãƒƒãƒ‰ ï¼Šå®Ÿè£…ä¾‹ï¼Š package mainimport ( \"bytes\" \"encoding/json\" \"fmt\" \"log\" \"net/http\")type User struct { id int `json:\"id\"` name string `json:\"name\"`}// ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿func NewUser(id int, name string) *User { return &User{ id: id, name: name, }}func main() { user := NewUser(1, \"Hiroki\") byteJson, err := json.Marshal(user) response, err := http.Post( \"http://xxx/api.com\", // URL \"application/json\", // Content-Type bytes.NewBuffer(byteJson), // ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãƒœãƒ‡ã‚£ ) defer response.Body.Close() if err != nil { log.Fatal(err) } fmt.Println(response.Body)} ãƒ»NewRequestãƒ¡ã‚½ãƒƒãƒ‰ ï¼Šå®Ÿè£…ä¾‹ï¼Š package main import ( \"bytes\" \"encoding/json\" \"fmt\" \"log\" \"net/http\" ) type User struct { id int `json:\"id\"` name string `json:\"name\"` } // ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ func NewUser(id int, name string) *User { return &User{ id: id, name: name, } } func main() { user := NewUser(1, \"Hiroki\") byteJson, err := json.Marshal(user) // ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’ä½œæˆã™ã‚‹ï¼ request, err := http.NewRequest( \"POST\", // HTTPãƒ¡ã‚½ãƒƒãƒ‰ \"http://xxx/api.com\", // URL bytes.NewBuffer(byteJson), // ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãƒœãƒ‡ã‚£ ) // ãƒ˜ãƒƒãƒ€ãƒ¼ã‚’ä½œæˆã™ã‚‹ï¼ request.Header.Set(\"Content-Type\", \"application/json\") // Content-Type // ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚’ä½œæˆã™ã‚‹ï¼ client := &http.Client{} // ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é€ä¿¡ã™ã‚‹ï¼ response, err := client.Do(request) defer response.Body.Close() if err != nil || response.StatusCode != 200 { log.Fatal(err) } // ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã®ãƒœãƒ‡ã‚£ã‚’å–å¾—ã™ã‚‹ï¼ // ä»£ã‚ã‚Šã«ï¼Œhttputil.DumpResponseã‚’ä½¿ç”¨ã—ã¦ã‚‚ã‚ˆã„ï¼ body, _ := ioutil.ReadAll(response.Body) log.Println(string(body)) } ãƒ»ListenAndServeãƒ¡ã‚½ãƒƒãƒ‰ ã‚µãƒ¼ãƒã‚’èµ·å‹•ã™ã‚‹ï¼ç¬¬ä¸€å¼•æ•°ã«ã‚µãƒ¼ãƒã®URLï¼Œç¬¬äºŒå¼•æ•°ã«ServeMuxé–¢æ•°ï¼ˆãƒãƒ«ãƒãƒ—ãƒ¬ã‚¯ã‚µé–¢æ•°ï¼‰ã‚’æ¸¡ã™ï¼ç¬¬äºŒå¼•æ•°ã«nilã‚’æ¸¡ã—ãŸå ´åˆï¼Œãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå¼•æ•°ã¨ã—ã¦http.DefaultServeMuxãŒæ¸¡ã•ã‚Œã‚‹ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š package main import ( \"net/http\" \"log\" ) func main() { err := http.ListenAndServe(\":8080\", nil) // ä»¥ä¸‹ã§ã‚‚åŒã˜ï¼ // http.ListenAndServe(\":8080\", http.DefaultServeMux) if err != nil { log.Fatal(\"Error ListenAndServe : \", err) } } ãƒ»NewServeMuxãƒ¡ã‚½ãƒƒãƒ‰ ã‚µãƒ¼ãƒãƒ¼ã‚’èµ·å‹•ã™ã‚‹ListenAndServeãƒ¡ã‚½ãƒƒãƒ‰ã«å¯¾ã—ã¦ï¼Œè‡ªèº«ã§å®šç¾©ã—ãŸServeMuxé–¢æ•°ã‚’æ¸¡ã™å ´åˆï¼ŒNewServeMuxãƒ¡ã‚½ãƒƒãƒ‰ã‚’ä½¿ç”¨ã™ã‚‹å¿…è¦ãŒã‚ã‚‹ï¼ã“ã‚Œã®HandleFuncé–¢æ•°ã«å¯¾ã—ã¦ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã¨é–¢æ•°ã‚’å®šç¾©ã™ã‚‹ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š HTMLã‚’ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã¨ã—ã¦è¿”ä¿¡ã™ã‚‹ã‚µãƒ¼ãƒï¼ˆhttp://localhost:8080/ï¼‰ã‚’èµ·å‹•ã™ã‚‹ï¼ package main import ( \"log\" \"net/http\" ) func myHandler(writer http.ResponseWriter, request *http.Request) { // HTMLã‚’ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã¨ã—ã¦è¿”ä¿¡ã™ã‚‹ï¼ fmt.Fprintf(writer, \"Hello world!\") } func main() { mux := http.NewServeMux() // ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã¨é–¢æ•°ã‚’è¨­å®šã™ã‚‹ï¼ mux.HandleFunc(\"/\", myHandler) // ã‚µãƒ¼ãƒã‚’èµ·å‹•ã™ã‚‹ï¼ err := http.ListenAndServe(\":8080\", mux) if err != nil { log.Fatal(\"Error ListenAndServe : \", err) } } JSONã‚’ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã¨ã—ã¦è¿”ä¿¡ã™ã‚‹ã‚µãƒ¼ãƒï¼ˆhttp://localhost:8080/ï¼‰ã‚’èµ·å‹•ã™ã‚‹ï¼ package main import ( \"encoding/json\" \"log\" \"net/http\" ) type User struct { Id int `json:\"id\"` Name string `json:\"name\"` } // ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ func NewUser(id int, name string) *User { return &User{ Id: id, Name: name, } } func myHandler(writer http.ResponseWriter, request *http.Request) { user := NewUser(1, \"Hiroki\") byteJson, err := json.Marshal(user) if err != nil { log.Fatal(err) } // JSONã‚’ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã¨ã—ã¦è¿”ä¿¡ã™ã‚‹ï¼ writer.Header().Set(\"Content-Type\", \"application/json; charset=utf-8\") writer.Write(byteJson) } func main() { mux := http.NewServeMux() // ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã¨é–¢æ•°ã‚’è¨­å®šã™ã‚‹ï¼ mux.HandleFunc(\"/\", myHandler) // ã‚µãƒ¼ãƒã‚’èµ·å‹•ã™ã‚‹ï¼ err := http.ListenAndServe(\":8080\", mux) if err != nil { log.Fatal(err) } } os ãƒ»Opené–¢æ•° ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ReadOnlyçŠ¶æ…‹ã«ã™ã‚‹ï¼ package main import ( \"fmt\" \"os\" ) func main() { file, err := os.Open(\"filename.txt\") if err != nil { log.Fatalf(\"ERROR: %#v\\n\", err) } fmt.Printf(\"%#v\\n\", file) } reflect ãƒ»TypeOfãƒ¡ã‚½ãƒƒãƒ‰ï¼ŒValueOfãƒ¡ã‚½ãƒƒãƒ‰ æ§‹é€ ä½“ã‹ã‚‰ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰æƒ…å ±ã‚’å–å¾—ã™ã‚‹ï¼ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ãŒè¤‡æ•°ã‚ã‚‹å ´åˆã¯ï¼Œè¦ç´ ç•ªå·ã®æŒ‡å®šãŒå¿…è¦ã«ãªã‚‹ãŸã‚ï¼Œäº‹å‰ã«è¦ç´ æ•°ã‚’å–å¾—ã™ã‚‹ã‚ˆã†ã«ã—ã¦ãŠãï¼ package main import ( \"fmt\" \"reflect\" ) type Foo struct { bar string baz int } func main() { foo := &Foo{bar: \"BAR\", baz: 1} fields := reflect.TypeOf(*foo) fmt.Println(fields) values := reflect.ValueOf(*foo) // å†å¸°çš„ã«ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã¨å€¤ã‚’å–å¾—ã™ã‚‹ for i := 0; i strings ãƒ»Builderé–¢æ•° æ¸¡ã•ã‚ŒãŸæ–‡å­—åˆ—ã‚’çµåˆã—ï¼Œæ¨™æº–å‡ºåŠ›ã«å‡ºåŠ›ã™ã‚‹ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š package main import ( \"fmt\" \"strings\" ) func main() { var builder strings.Builder builder.WriteString(\"Hello \") builder.WriteString(\"world!\") fmt.Println(builder.String()) // Hello world! } "},"public/software/software_application_backend_go_package.html":{"url":"public/software/software_application_backend_go_package.html","title":"ğŸ“– ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸","keywords":"","body":"ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ ã¯ã˜ã‚ã« æœ¬ã‚µã‚¤ãƒˆã«ã¤ãã¾ã—ã¦ï¼Œä»¥ä¸‹ã‚’ã”èªè­˜ã®ã»ã©å®œã—ããŠé¡˜ã„ã„ãŸã—ã¾ã™ï¼ å‚è€ƒï¼šhttps://hiroki-it.github.io/tech-notebook-gitbook/ 01. ãƒ“ãƒ«ãƒˆã‚¤ãƒ³ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ ä»¥ä¸‹ã®ãƒªãƒ³ã‚¯ã‚’å‚è€ƒã«ã›ã‚ˆï¼ å‚è€ƒï¼šhttps://hiroki-it.github.io/tech-notebook-gitbook/public/software/software_application_backend_go_logic_method_data.html 02. aws-sdk-go-v2 aws-sdk-go-v2ã¨ã¯ å‚è€ƒï¼šhttps://pkg.go.dev/github.com/aws/aws-sdk-go-v2?tab=versions awsã¨ã¯ æ±ç”¨çš„ãªé–¢æ•°ãŒåŒæ¢±ã•ã‚Œã¦ã„ã‚‹ï¼ å‚è€ƒï¼šhttps://pkg.go.dev/github.com/aws/aws-sdk-go-v2/aws?tab=versions ãƒã‚¤ãƒ³ã‚¿å‹ã‹ã‚‰æ–‡å­—åˆ—å‹ã«å¤‰æ›ã™ã‚‹ToStringé–¢æ•°ã‚„ï¼Œåå¯¾ã«æ–‡å­—åˆ—å‹ã‹ã‚‰ãƒã‚¤ãƒ³ã‚¿å‹ã«å¤‰æ›ã™ã‚‹Stringé–¢æ•°ã‚’ã‚ˆãä½¿ã†ï¼ å‚è€ƒï¼š https://pkg.go.dev/github.com/aws/aws-sdk-go-v2/aws#String https://pkg.go.dev/github.com/aws/aws-sdk-go-v2/aws#ToString ãƒ»serviceãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ å‚è€ƒï¼šhttps://pkg.go.dev/github.com/aws/aws-sdk-go-v2/service/amplify?tab=versions 03. aws-lambda-go ä»¥ä¸‹ã®ãƒªãƒ³ã‚¯ã‚’å‚è€ƒã«ã›ã‚ˆï¼ å‚è€ƒï¼šhttps://hiroki-it.github.io/tech-notebook-gitbook/public/infrastructure_cloud_computing_aws_lambda_function.html 04. gorm gormã¨ã¯ Goè£½ã®ORMã§ã‚ã‚‹ï¼ Gormãƒ¢ãƒ‡ãƒ« ãƒ»Gormãƒ¢ãƒ‡ãƒ«åŸ‹ã‚è¾¼ã¿ æ§‹é€ ä½“ã«Gormãƒ¢ãƒ‡ãƒ«ã‚’åŸ‹ã‚è¾¼ã‚€ã¨ï¼ŒIDã‚„ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—ãƒ¬ã‚³ãƒ¼ãƒ‰ãŒãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã¨ã—ã¦è¿½åŠ ã•ã‚Œã‚‹ï¼æ§‹é€ ä½“ã‚’ãƒãƒƒãƒ”ãƒ³ã‚°ã—ãŸãƒ†ãƒ¼ãƒ–ãƒ«ã«ï¼Œidã‚«ãƒ©ãƒ ï¼Œcreated_atã‚«ãƒ©ãƒ ï¼Œupdated_atã‚«ãƒ©ãƒ ï¼Œdeleted_atã‚«ãƒ©ãƒ ãŒè¿½åŠ ã•ã‚Œã‚‹ï¼ å‚è€ƒï¼šhttps://gorm.io/ja_JP/docs/models.html#embedded_struct type User struct { gorm.Model Name string } // ä»¥ä¸‹ã¨åŒã˜ type User struct { ID uint `gorm:\"primaryKey\"` Name string CreatedAt time.Time UpdatedAt time.Time DeletedAt gorm.DeleteAt `gorm:\"index\"` } ãƒ»ãƒ—ãƒ©ã‚¤ãƒãƒªã‚­ãƒ¼ ã€IDã€ã¨ã„ã†åå‰ã®ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’èªè­˜ã—ã¦ï¼Œã“ã‚Œã‚’ãƒ—ãƒ©ã‚¤ãƒãƒªã‚­ãƒ¼ã¨ã—ã¦ãƒ‡ãƒ¼ã‚¿ã‚’ãƒãƒƒãƒ”ãƒ³ã‚°ã™ã‚‹ï¼ã‚‚ã—ï¼Œä»–ã®åå‰ã®ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’IDã¨ã—ã¦ä½¿ç”¨ã—ãŸã„å ´åˆã¯ï¼Œgorm:\"primaryKey\"ã‚¿ã‚°ã‚’ã¤ã‘ã‚‹ï¼ å‚è€ƒï¼šhttps://gorm.io/ja_JP/docs/conventions.html#ID-as-Primary-Key type User struct { ID string // ãƒ—ãƒ©ã‚¤ãƒãƒªã‚­ãƒ¼ã¨ã—ã¦ä½¿ç”¨ã•ã‚Œã‚‹ï¼ Name string } type User struct { UserID string `gorm:\"primaryKey\"` // ãƒ—ãƒ©ã‚¤ãƒãƒªã‚­ãƒ¼ã¨ã—ã¦ä½¿ç”¨ã•ã‚Œã‚‹ï¼ Name string } ãƒ»SoftDelete æ§‹é€ ä½“ãŒï¼Œgorm.DeleteAtã‚’ãƒ‡ãƒ¼ã‚¿å‹ã¨ã™ã‚‹ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’æŒã£ã¦ã„ã‚‹ã¨ï¼Œãã®æ§‹é€ ä½“ã‚’ç”¨ã„ãŸDELETEå‡¦ç†ã§ã¯è«–ç†å‰Šé™¤ãŒå®Ÿè¡Œã•ã‚Œã‚‹ï¼Gormãƒ¢ãƒ‡ãƒ«ã‚’åŸ‹ã‚è¾¼ã‚€ã“ã¨ã«ã‚ˆã‚Šã“ã®ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’æŒãŸã›ã‚‹ã‹ï¼Œã¾ãŸã¯ç‹¬è‡ªå®šç¾©ã™ã‚‹ã“ã¨ã«ã‚ˆã‚Šï¼ŒSoftDeleteã‚’æœ‰åŠ¹åŒ–ã§ãã‚‹ï¼ å‚è€ƒï¼šhttps://gorm.io/ja_JP/docs/delete.html#Soft-Delete type User struct { ID int Deleted gorm.DeletedAt Name string } user := User{Id:111} // user's ID is `111` db.Delete(&user) // UPDATE users SET deleted_at=\"2013-10-29 10:23\" WHERE id = 111; // Batch Delete db.Where(\"age = ?\", 20).Delete(&User{}) // UPDATE users SET deleted_at=\"2013-10-29 10:23\" WHERE age = 20; // Soft deleted records will be ignored when querying db.Where(\"age = 20\").Find(&user) // SELECT * FROM users WHERE age = 20 AND deleted_at IS NULL; ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ ãƒ»TableNameãƒ¡ã‚½ãƒƒãƒ‰ æ¨™æº–ã§ã¯Gormãƒ¢ãƒ‡ãƒ«ã®åå‰ã‚’ã‚¹ãƒãƒ¼ã‚¯ã‚±ãƒ¼ã‚¹ã«å¤‰æ›´ã—ï¼Œã¾ãŸè¤‡æ•°å½¢ã¨ã—ãŸåå‰ã®ãƒ†ãƒ¼ãƒ–ãƒ«ãŒç”Ÿæˆã•ã‚Œã‚‹ï¼TableNameãƒ¡ã‚½ãƒƒãƒ‰ã«ã‚ˆã‚Šï¼Œç‹¬è‡ªã®ãƒ†ãƒ¼ãƒ–ãƒ«åã‚’ã¤ã‘ã‚‰ã‚Œã‚‹ï¼ å‚è€ƒï¼šhttps://gorm.io/ja_JP/docs/conventions.html#TableName // ãƒ†ãƒ¼ãƒ–ãƒ«åã¯æ¨™æº–ã§ã¯ã€usersã€ã«ãªã‚‹ï¼ type User struct { ID int Deleted gorm.DeletedAt Name string } // ãƒ†ãƒ¼ãƒ–ãƒ«åã‚’ã€fooã€ã«ãªã‚‹ï¼ func (User) TableName() string { return \"foo\" } Create Gormãƒ¢ãƒ‡ãƒ«ã®ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã«è¨­å®šã•ã‚ŒãŸå€¤ã‚’å…ƒã«ï¼Œã‚«ãƒ©ãƒ ã‚’ä½œæˆã™ã‚‹ï¼ä½œæˆã—ãŸã‚«ãƒ©ãƒ ã®ãƒ—ãƒ©ã‚¤ãƒãƒªã‚­ãƒ¼ã‚’ï¼Œæ§‹é€ ä½“ã‹ã‚‰å–å¾—ã§ãã‚‹ï¼ å‚è€ƒï¼šhttps://gorm.io/docs/create.html#Create-Record user := User{Name: \"Jinzhu\", Age: 18, Birthday: time.Now()} result := db.Create(&user) // pass pointer of data to Create user.ID // returns inserted data's primary key result.Error // returns error result.RowsAffected // returns inserted records count Read ãƒ»å…¨ã‚«ãƒ©ãƒ å–å¾— å‚è€ƒï¼šhttps://gorm.io/ja_JP/docs/query.html#Retrieving-all-objects user := User{} // Get all records result := db.Find(&users) // SELECT * FROM users; result.RowsAffected // returns found records count, equals `len(users)` result.Error // returns error ãƒ»å˜ä¸€ï¼è¤‡æ•°ã‚«ãƒ©ãƒ å–å¾— Gormãƒ¢ãƒ‡ãƒ«ã¨ãƒ—ãƒ©ã‚¤ãƒãƒªã‚­ãƒ¼ã‚’æŒ‡å®šã—ã¦ï¼Œãƒ—ãƒ©ã‚¤ãƒãƒªã‚­ãƒ¼ã®ãƒ¢ãƒ‡ãƒ«ã«ç´ä»˜ã‘ã‚‰ã‚ŒãŸã‚«ãƒ©ãƒ ã‚’å–å¾—ã™ã‚‹ï¼ å‚è€ƒï¼šhttps://gorm.io/ja_JP/docs/query.html#Retrieving-objects-with-primary-key user := User{} db.First(&user, 10) // SELECT * FROM users WHERE id = 10; db.First(&user, \"10\") // SELECT * FROM users WHERE id = 10; db.Find(&users, []int{1,2,3}) // SELECT * FROM users WHERE id IN (1,2,3); Update ãƒ»å˜ä¸€ã‚«ãƒ©ãƒ æ›´æ–°ï¼ˆæš—é»™çš„ï¼‰ ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã¨ã¯ç„¡é–¢ä¿‚ã«ï¼Œæ¸¡ã•ã‚ŒãŸå€¤ã‚’å…ƒã«UPDATEåˆ†ã‚’å®Ÿè¡Œã™ã‚‹ï¼ å‚è€ƒï¼šhttps://gorm.io/ja_JP/docs/update.html#Update-single-column // Update with conditions db.Model(&User{}).Where(\"active = ?\", true).Update(\"name\", \"hello\") // UPDATE users SET name='hello', updated_at='2013-11-17 21:34:10' WHERE active=true; user := User{Id:111} // User's ID is `111`: db.Model(&user).Update(\"name\", \"hello\") // UPDATE users SET name='hello', updated_at='2013-11-17 21:34:10' WHERE id=111; // Update with conditions and model value db.Model(&user).Where(\"active = ?\", true).Update(\"name\", \"hello\") // UPDATE users SET name='hello', updated_at='2013-11-17 21:34:10' WHERE id=111 AND active=true; ãƒ»è¤‡æ•°ã‚«ãƒ©ãƒ æ›´æ–°ï¼ˆæš—é»™çš„ï¼‰ Gormãƒ¢ãƒ‡ãƒ«ã®ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’æš—é»™çš„ã«æŒ‡å®šã—ã¦ï¼Œè¤‡æ•°ã®ã‚«ãƒ©ãƒ å€¤ã‚’æ›´æ–°ã™ã‚‹ï¼ã¾ãŸã¯ï¼Œãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã¨ã¯ç„¡é–¢ä¿‚ã«ï¼Œãƒãƒƒãƒ—ãƒ‡ãƒ¼ã‚¿ã‚’å…ƒã«UPDATEæ–‡ã‚’å®Ÿè¡Œã™ã‚‹ï¼Gormãƒ¢ãƒ‡ãƒ«ã‚’ä½¿ç”¨ã—ãŸå ´åˆï¼Œãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰å€¤ãŒã‚¼ãƒ­å€¤ã§ã‚ã‚‹ã¨ï¼Œã“ã‚Œã«ç´ä»˜ã‘ã‚‰ã‚ŒãŸã‚«ãƒ©ãƒ å€¤ã®æ›´æ–°ã¯ã‚¹ã‚­ãƒƒãƒ—ã•ã‚Œã¦ã—ã¾ã†ï¼ å‚è€ƒï¼šhttps://gorm.io/ja_JP/docs/update.html#Updates-multiple-columns user := User{Id:111} // Update attributes with `struct`, will only update non-zero fields db.Model(&user).Updates(User{Name: \"hello\", Age: 18, Active: false}) // UPDATE users SET name='hello', age=18, updated_at = '2013-11-17 21:34:10' WHERE id = 111; // Update attributes with `map` db.Model(&user).Updates(map[string]interface{}{\"name\": \"hello\", \"age\": 18, \"active\": false}) // UPDATE users SET name='hello', age=18, active=false, updated_at='2013-11-17 21:34:10' WHERE id=111; ãƒ»è¤‡æ•°ã‚«ãƒ©ãƒ æ›´æ–°ï¼ˆæ˜ç¤ºçš„ï¼‰ Gormãƒ¢ãƒ‡ãƒ«ã®ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’æ˜ç¤ºçš„ã«æŒ‡å®šã—ã¦ï¼Œè¤‡æ•°ã®ã‚«ãƒ©ãƒ å€¤ã‚’æ›´æ–°ã™ã‚‹ï¼ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰å€¤ãŒã‚¼ãƒ­å€¤ã§ã‚ã£ã¦ã‚‚ï¼Œã‚¹ã‚­ãƒƒãƒ—ã•ã‚Œãªã„ï¼ å‚è€ƒï¼šhttps://gorm.io/ja_JP/docs/update.html#Update-Selected-Fields user := User{Id:111} // Select with Struct (select zero value fields) db.Model(&user).Select(\"Name\", \"Age\").Updates(User{Name: \"new_name\", Age: 0}) // UPDATE users SET name='new_name', age=0 WHERE id=111; // Select all fields (select all fields include zero value fields) db.Model(&user).Select(\"*\").Updates(User{Name: \"jinzhu\", Role: \"admin\", Age: 0}) // UPDATE users SET name='new_name', age=0 WHERE id=111; ãƒ»å…¨ã‚«ãƒ©ãƒ æ›´æ–° Gormãƒ¢ãƒ‡ãƒ«ã®ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’æš—é»™çš„ã«å…¨ã¦æŒ‡å®šã—ã¦ï¼Œå…¨ã¦ã®ã‚«ãƒ©ãƒ å€¤ã‚’å¼·åˆ¶çš„ã«æ›´æ–°ã™ã‚‹ï¼ å‚è€ƒï¼šhttps://gorm.io/ja_JP/docs/update.html#Save-All-Fields user := User{Id:111} db.First(&user) user.Name = \"jinzhu 2\" user.Age = 100 db.Save(&user) // UPDATE users SET name='jinzhu 2', age=100, birthday='2016-01-01', updated_at = '2013-11-17 21:34:10' WHERE id=111; 05. testify testifyã¨ã¯ ãƒ¢ãƒƒã‚¯ï¼Œã‚¹ã‚¿ãƒ–ï¼Œã‚¢ã‚µãƒ¼ã‚·ãƒ§ãƒ³ãƒ¡ã‚½ãƒƒãƒ‰ã‚’æä¾›ã™ã‚‹ãƒ©ã‚¤ãƒ–ãƒ©ãƒªï¼Goã§ã¯ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®æ¦‚å¿µãŒãªã„ãŸã‚ï¼Œãƒ¢ãƒƒã‚¯ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã¨ã¯è¨€ã‚ãªã„ï¼ãƒ¢ãƒƒã‚¯ã¨ã‚¹ã‚¿ãƒ–ã«ã¤ã„ã¦ã¯ï¼Œä»¥ä¸‹ã‚’å‚è€ƒã«ã›ã‚ˆï¼ å‚è€ƒï¼šhttps://hiroki-it.github.io/tech-notebook-gitbook/public/software/software_application_backend_php_testing_based_on_code.html mockï¼Œassert ãƒ»ãƒ¢ãƒƒã‚¯åŒ– ã‚ˆãä½¿ã†ãƒ¡ã‚½ãƒƒãƒ‰ èª¬æ˜ ãªã— ãƒ‡ãƒ¼ã‚¿ã¨ã—ã¦ï¼Œæ§‹é€ ä½“ã«Mockã‚’è¨­å®šã™ã‚Œã°ï¼Œãã®æ§‹é€ ä½“ã¯ãƒ¢ãƒƒã‚¯åŒ–ã•ã‚Œã‚‹ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š AWSã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚’ãƒ¢ãƒƒã‚¯åŒ–ã™ã‚‹ï¼ package amplify import ( \"github.com/stretchr/testify/mock\" ) /** * AWSã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚’ãƒ¢ãƒƒã‚¯åŒ–ã—ã¾ã™ï¼ */ type MockedAwsClient struct { mock.Mock } ãƒ»ã‚¹ã‚¿ãƒ–åŒ– å‚è€ƒï¼šhttps://pkg.go.dev/github.com/stretchr/testify/mock?tab=versions ã‚ˆãä½¿ã†ãƒ¡ã‚½ãƒƒãƒ‰ èª¬æ˜ Mock.Calledãƒ¡ã‚½ãƒƒãƒ‰ é–¢æ•°ã®ä¸€éƒ¨ã®å‡¦ç†ã‚’ã‚¹ã‚¿ãƒ–åŒ–ã™ã‚‹æ™‚ã«ä½¿ç”¨ã™ã‚‹ï¼é–¢æ•°ã«å€¤ãŒæ¸¡ã•ã‚ŒãŸã“ã¨ã‚’ãƒ¢ãƒƒã‚¯ã«ä¼ãˆã‚‹ï¼ Arguments.Getãƒ¡ã‚½ãƒƒãƒ‰ é–¢æ•°ã®ä¸€éƒ¨ã®å‡¦ç†ã‚’ã‚¹ã‚¿ãƒ–åŒ–ã™ã‚‹æ™‚ã«ä½¿ç”¨ã™ã‚‹ï¼å¼•æ•°ã¨ã—ã¦ï¼Œè¿”å´å€¤ã®é †ç•ªã‚’æ¸¡ã™ï¼ç‹¬è‡ªã®ãƒ‡ãƒ¼ã‚¿å‹ã‚’è¿”å´ã™ã‚‹å‡¦ç†ã‚’å®šç¾©ã™ã‚‹ï¼ Arguments.Errorãƒ¡ã‚½ãƒƒãƒ‰ é–¢æ•°ã®ä¸€éƒ¨ã®å‡¦ç†ã‚’ã‚¹ã‚¿ãƒ–åŒ–ã™ã‚‹æ™‚ã«ä½¿ç”¨ã™ã‚‹ï¼å¼•æ•°ã¨ã—ã¦ï¼Œè¿”å´å€¤ã®é †ç•ªã‚’æ¸¡ã™ï¼ã‚¨ãƒ©ãƒ¼ã‚’è¿”å´ã™ã‚‹å‡¦ç†ã‚’å®šç¾©ã™ã‚‹ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š é–¢æ•°ã®ä¸€éƒ¨ã®å‡¦ç†ã‚’ã‚¹ã‚¿ãƒ–åŒ–ã—ï¼Œã“ã‚Œã‚’AWSã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã®ãƒ¢ãƒƒã‚¯ã«ç´ä»˜ã‘ã‚‹ï¼ package amplify import ( aws_amplify \"github.com/aws/aws-sdk-go-v2/service/amplify\" \"github.com/stretchr/testify/mock\" ) type MockedAmplifyAPI struct { mock.Mock } /** * Amplifyã®GetBranché–¢æ•°ã®å‡¦ç†ã‚’ã‚¹ã‚¿ãƒ–åŒ–ã—ã¾ã™ï¼ */ func (mock *MockedAmplifyAPI) GetBranch(ctx context.Context, params *aws_amplify.GetBranchInput, optFns ...func(*aws_amplify.Options)) (*aws_amplify.GetBranchOutput, error) { arguments := mock.Called(ctx, params, optFns) return arguments.Get(0).(*aws_amplify.GetBranchOutput), arguments.Error(1) } ãƒ»ã‚¢ã‚µãƒ¼ã‚·ãƒ§ãƒ³ãƒ¡ã‚½ãƒƒãƒ‰ã«ã‚ˆã‚‹æ¤œè¨¼ å‚è€ƒï¼š https://pkg.go.dev/github.com/stretchr/testify/mock?tab=versions https://pkg.go.dev/github.com/stretchr/testify/assert?tab=versions ã‚ˆãä½¿ã†ãƒ¡ã‚½ãƒƒãƒ‰ èª¬æ˜ Mock.Onãƒ¡ã‚½ãƒƒãƒ‰ é–¢æ•°ã®æ¤œè¨¼æ™‚ã«ä½¿ç”¨ã™ã‚‹ï¼é–¢æ•°å†…éƒ¨ã®ã‚¹ã‚¿ãƒ–ã«å¼•æ•°ã¨ã—ã¦æ¸¡ã•ã‚Œã‚‹å€¤ã¨ï¼Œãã®æ™‚ã®è¿”å´å€¤ã‚’å®šç¾©ã™ã‚‹ï¼ Mock.AssertExpectationsãƒ¡ã‚½ãƒƒãƒ‰ é–¢æ•°ã®æ¤œè¨¼æ™‚ã«ä½¿ç”¨ã™ã‚‹ï¼é–¢æ•°å†…éƒ¨ã®ã‚¹ã‚¿ãƒ–ãŒæ­£ã—ãå®Ÿè¡Œã•ã‚ŒãŸã‹ã©ã†ã‹ã‚’æ¤œè¨¼ã™ã‚‹ï¼ assert.Exactlyãƒ¡ã‚½ãƒƒãƒ‰ é–¢æ•°ã®æ¤œè¨¼æ™‚ã«ä½¿ç”¨ã™ã‚‹ï¼æœŸå¾…å€¤ã¨å®Ÿéš›å€¤ã®æ•´åˆæ€§ã‚’æ¤œè¨¼ã™ã‚‹ï¼å€¤ã ã‘ã§ãªãï¼Œãƒ‡ãƒ¼ã‚¿å‹ã‚‚æ¤œè¨¼ã§ãã‚‹ï¼ ãƒ»å‰å‡¦ç†ã¨å¾Œå‡¦ç† ãƒ†ã‚¹ãƒˆé–¢æ•°ã‚’å®Ÿè¡Œã™ã‚‹ç›´å‰ã«ï¼Œå‰å‡¦ç†ã‚’å®Ÿè¡Œã™ã‚‹ï¼ãƒ¢ãƒƒã‚¯ã®ç”Ÿæˆã®ãŸã‚ã«ä½¿ç”¨ã™ã‚‹ã¨ã‚ˆã„ï¼PHPUnitã«ãŠã‘ã‚‹å‰å‡¦ç†ã¨å¾Œå‡¦ç†ã«ã¤ã„ã¦ã¯ï¼Œä»¥ä¸‹ã®ãƒªãƒ³ã‚¯ã‚’å‚è€ƒã«ã›ã‚ˆï¼ å‚è€ƒï¼šhttps://hiroki-it.github.io/tech-notebook-gitbook/public/software/software_application_backend_php_testing_based_on_code.html å‰å‡¦ç†ã¨å¾Œå‡¦ç†ã«ã¤ã„ã¦ã¯ï¼Œä»¥ä¸‹ã®ãƒªãƒ³ã‚¯ã‚’å‚è€ƒã«ã›ã‚ˆï¼ å‚è€ƒï¼šhttps://github.com/google/go-github/blob/master/github/github_test.go#L36-L66 ã‚ˆãä½¿ã†é–¢æ•° å®Ÿè¡Œã‚¿ã‚¤ãƒŸãƒ³ã‚° èª¬æ˜ SetupSuite 1 ãƒ†ã‚¹ãƒˆã‚¹ã‚¤ãƒ¼ãƒˆå†…ã®å…¨ã¦ã®ãƒ†ã‚¹ãƒˆã®å‰å‡¦ç†ã¨ã—ã¦ï¼Œä¸€å›ã ã‘å®Ÿè¡Œã™ã‚‹ï¼ SetupTest 2 ãƒ†ã‚¹ãƒˆã‚¹ã‚¤ãƒ¼ãƒˆå†…ã®å„ãƒ†ã‚¹ãƒˆã®å‰å‡¦ç†ã¨ã—ã¦ï¼Œãƒ†ã‚¹ãƒˆã®åº¦ã«äº‹å‰ã«å®Ÿè¡Œã™ã‚‹ï¼BeforeTesté–¢æ•°ã‚ˆã‚Šã‚‚å‰ã«å®Ÿè¡Œã•ã‚Œã‚‹ã“ã¨ã«æ³¨æ„ã™ã‚‹ï¼ BeforeTest 3 ãƒ†ã‚¹ãƒˆã‚¹ã‚¤ãƒ¼ãƒˆå†…ã®å„ãƒ†ã‚¹ãƒˆã®ç›´å‰ã®å‰å‡¦ç†ã¨ã—ã¦ï¼Œãƒ†ã‚¹ãƒˆã®åº¦ã«äº‹å‰ã«å®Ÿè¡Œã™ã‚‹ï¼å¿…ãšï¼Œã€suiteNameã€ã€testNameã€ã‚’å¼•æ•°ã¨ã—ã¦è¨­å®šã™ã‚‹å¿…è¦ãŒã‚ã‚‹ï¼ AfterTest 4 ãƒ†ã‚¹ãƒˆã‚¹ã‚¤ãƒ¼ãƒˆå†…ã®å„ãƒ†ã‚¹ãƒˆã®ç›´å¾Œã®å¾Œå‡¦ç†ã¨ã—ã¦ï¼Œãƒ†ã‚¹ãƒˆã®åº¦ã«äº‹å¾Œã«å®Ÿè¡Œã™ã‚‹ï¼å¿…ãšï¼Œã€suiteNameã€ã€testNameã€ã‚’å¼•æ•°ã¨ã—ã¦è¨­å®šã™ã‚‹å¿…è¦ãŒã‚ã‚‹ï¼ TearDownTest 5 ãƒ†ã‚¹ãƒˆã‚¹ã‚¤ãƒ¼ãƒˆå†…ã®å„ãƒ†ã‚¹ãƒˆã®å¾Œå‡¦ç†ã¨ã—ã¦ï¼Œãƒ†ã‚¹ãƒˆã®åº¦ã«äº‹å¾Œã«å®Ÿè¡Œã™ã‚‹ï¼BeforeTesté–¢æ•°ã‚ˆã‚Šã‚‚å¾Œã«å®Ÿè¡Œã•ã‚Œã‚‹ã“ã¨ã«æ³¨æ„ã™ã‚‹ï¼ TearDownSuite 6 ãƒ†ã‚¹ãƒˆã‚¹ã‚¤ãƒ¼ãƒˆå†…ã®å…¨ã¦ã®ãƒ†ã‚¹ãƒˆã®å¾Œå‡¦ç†ã¨ã—ã¦ï¼Œä¸€å›ã ã‘å®Ÿè¡Œã™ã‚‹ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š äº‹å‰ã«ãƒ¢ãƒƒã‚¯ã‚’ç”Ÿæˆã™ã‚‹ãŸã‚ã«ï¼ŒBeforeTesté–¢æ•°ã‚’ä½¿ç”¨ã™ã‚‹ï¼ package foo import ( \"testing\" ) /** * ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆã®ãƒ†ã‚¹ãƒˆã‚¹ã‚¤ãƒ¼ãƒˆã‚’æ§‹æˆã™ã‚‹ï¼ */ type FooSuite struct { suite.Suite fooMock *FooMock } /** * ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆã®ç›´å‰ã®å‰å‡¦ç†ã‚’å®Ÿè¡Œã™ã‚‹ï¼ */ func (suite *FooSuite) BeforeTest(suiteName string, testName string) { // ãƒ¢ãƒƒã‚¯ã‚’ç”Ÿæˆã™ã‚‹ï¼ suite.fooMock = &FooMock{} } /** * ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆã®ãƒ†ã‚¹ãƒˆã‚¹ã‚¤ãƒ¼ãƒˆã‚’å®Ÿè¡Œã™ã‚‹ï¼ */ func TestFooSuite(t *testing.T) { suite.Run(t, &FooSuite{}) } package foo import ( \"github.com/stretchr/testify/assert\" ) /** * Methodãƒ¡ã‚½ãƒƒãƒ‰ãŒæˆåŠŸã™ã‚‹ã“ã¨ã‚’ãƒ†ã‚¹ãƒˆã™ã‚‹ï¼ */ func (suite *FooSuite) TestMethod() { suite.T().Helper() // å‰å‡¦ç†ã§ç”Ÿæˆã—ãŸãƒ¢ãƒƒã‚¯ã‚’ä½¿ç”¨ã™ã‚‹ï¼ fooMock := suite.fooMock // ä»¥é™ã«ãƒ†ã‚¹ãƒˆå‡¦ç† } 06. validator validatorã¨ã¯ ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã¨ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ package validators import ( \"fmt\" \"github.com/go-playground/validator\" ) type FoobarbazValidator struct { Foo string `json:\"foo\" validate:\"required\"` Bar string `json:\"bar\" validate:\"required\"` Baz string `json:\"baz\" validate:\"required\"` } // NewValidator ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ func NewValidator() *Validator { return &Validator{} } // Validate ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’å®Ÿè¡Œã—ã¾ã™ï¼ func (v *FoobarbazValidator) Validate() map[string]string { err := validator.New().Struct(v) var errorMessages = make(map[string]string) if err != nil { for _, err := range err.(validator.ValidationErrors) { switch err.Field() { // ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã”ã¨ã«ãƒãƒƒãƒ—å½¢å¼ã§ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’æ§‹æˆã—ã¾ã™ï¼ case \"foo\": errorMessages[\"foo\"] = v.stringValidation(err) errorMessages[\"foo\"] = v.requiredValidation(err) case \"bar\": errorMessages[\"bar\"] = v.stringValidation(err) case \"baz\": errorMessages[\"baz\"] = v.stringValidation(err) errorMessages[\"baz\"] = v.requiredValidation(err) } } } return errorMessages } // stringValidation æ–‡å­—åˆ—å‹æŒ‡å®šã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¿”å´ã—ã¾ã™ï¼ func (v *FoobarbazValidator) stringValidation(err validator.FieldError) string { return fmt.Sprintf(\"%s ã¯æ–‡å­—åˆ—ã®ã¿æœ‰åŠ¹ã§ã™\", err.Field()) } // requiredValidation å¿…é ˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¿”å´ã—ã¾ã™ï¼ func (v *FoobarbazValidator) requiredValidation(err validator.FieldError) string { return fmt.Sprintf(\"%s ã¯å¿…é ˆã§ã™\", err.Field()) } package main import ( \"encoding/json\" \"fmt\" \"log\" \"github.com/foobarbaz_repository/validators\" ) func main() { v := NewFoobarbazValidator() // JSONã‚’æ§‹é€ ä½“ã«ãƒãƒƒãƒ”ãƒ³ã‚°ã—ã¾ã™ï¼ err := json.Unmarshal([]byte(`{\"foo\": \"test\", \"bar\": \"test\", \"baz\": \"test\"}`), v) if err != nil { log.Println(\"JSONã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ã«å¤±æ•—ã—ã¾ã—ãŸã€‚\") } // ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’å®Ÿè¡Œã—ã¾ã™ï¼ errorMessages := v.Validate() if len(errorMessages) > 0 { // ãƒãƒƒãƒ—ã‚’JSONã«å¤‰æ›ã—ã¾ã™ï¼ byteJson, _ := json.Marshal(errorMessages) fmt.Printf(\"%#v\\n\", byteJson) } // ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰çµæœã‚’å‡ºåŠ›ã—ã¾ã™ï¼ fmt.Println(\"ãƒ‡ãƒ¼ã‚¿ã«å•é¡Œã¯ã‚ã‚Šã¾ã›ã‚“ï¼\") } 07. å¤–éƒ¨ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®ç®¡ç† ã‚³ãƒãƒ³ãƒ‰ ãƒ»go mod tidy ã‚¤ãƒ³ãƒãƒ¼ãƒˆã•ã‚Œã¦ã„ã‚‹ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã«åˆã‚ã›ã¦ï¼Œgo.modãƒ•ã‚¡ã‚¤ãƒ«ã¨go.sumãƒ•ã‚¡ã‚¤ãƒ«ã‚’æ›´æ–°ã™ã‚‹ï¼ $ go mod tidy go.modãƒ•ã‚¡ã‚¤ãƒ« ãƒ»go.modãƒ•ã‚¡ã‚¤ãƒ«ã¨ã¯ PHPã«ãŠã‘ã‚‹composer.jsonãƒ•ã‚¡ã‚¤ãƒ«ã«ç›¸å½“ã™ã‚‹ï¼ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆä¸Šã«ãŠã‘ã‚‹è‡ªèº«ã®ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸åã¨Goãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’å®šç¾©ã™ã‚‹ãŸã‚ã«ï¼Œå…¨ã¦ã®Goã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã§å¿…ãšå¿…è¦ã§ã‚ã‚‹ï¼ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ãŸã„å¤–éƒ¨ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚‚å®šç¾©ã§ãã‚‹ï¼ module github.com/hiroki-it/foo_repository go 1.16 ãƒ»ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆã‹ã‚‰ã‚¤ãƒ³ãƒãƒ¼ãƒˆ ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸åã¨ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚¿ã‚°ã‚’ç”¨ã„ã¦ï¼Œã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆã‹ã‚‰ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’ã‚¤ãƒ³ãƒãƒ¼ãƒˆã™ã‚‹ï¼go mod tidyã‚³ãƒãƒ³ãƒ‰ã«ã‚ˆã£ã¦indirectã‚³ãƒ¡ãƒ³ãƒˆã®ã¤ã„ãŸãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ãŒå®Ÿè£…ã•ã‚Œã‚‹ï¼ã“ã‚Œã¯ï¼Œä½¿ç”¨ã—ã¦ã„ã‚‹ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã§ã¯ãªãï¼Œã‚¤ãƒ³ãƒãƒ¼ãƒˆã—ã¦ã„ã‚‹ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ãŒä¾å­˜ã—ã¦ã„ã‚‹ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã§ã‚ã‚‹ï¼ãªãŠï¼Œãƒ‘ãƒƒã‚±ãƒ¼ã‚¸åã¯ï¼Œä½¿ç”¨ã—ãŸã„ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®go.modãƒ•ã‚¡ã‚¤ãƒ«ã‚’å‚ç…§ã™ã‚‹ã“ã¨ï¼ å‚è€ƒï¼šhttps://github.com/golang/go/wiki/Modules#should-i-commit-my-gosum-file-as-well-as-my-gomod-file module github.com/hiroki-it/repository go 1.16 require ( github.com/foo v1.3.0 github.com/bar v1.0.0 github.com/baz // indirect ) import \"github.com/bar\" func main() { // ä½•ã‚‰ã‹ã®å‡¦ç† } ãƒ»ãƒ­ãƒ¼ã‚«ãƒ«PCã‹ã‚‰ã‚¤ãƒ³ãƒãƒ¼ãƒˆ ãƒ­ãƒ¼ã‚«ãƒ«PCã§ã®ã¿ä½¿ç”¨ã™ã‚‹ç‹¬è‡ªå…±æœ‰ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã¯ï¼Œã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆä¸Šã§ã®è‡ªèº«ã®ãƒªãƒã‚¸ãƒˆãƒªã‹ã‚‰ã‚¤ãƒ³ãƒãƒ¼ãƒˆã›ãšã«ï¼Œreplaceé–¢æ•°ã‚’ä½¿ç”¨ã—ã¦ã‚¤ãƒ³ãƒãƒ¼ãƒˆã™ã‚‹å¿…è¦ãŒã‚ã‚‹ï¼ç‹¬è‡ªå…±æœ‰ã®å…¨ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã§ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸åã‚’ç½®æ›ã™ã‚‹å¿…è¦ã¯ãªãï¼Œãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ãƒ«ãƒ¼ãƒˆãƒ‘ã‚¹ã«ã¤ã„ã¦ã®ã¿å®šç¾©ã™ã‚Œã°ã‚ˆã„ï¼ãƒ‘ã‚¹å®Ÿéš›ï¼Œunknown revisionã®ã‚¨ãƒ©ãƒ¼ã§ï¼Œãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’è¦‹ã¤ã‘ã‚‰ã‚Œãªã„ï¼ å‚è€ƒï¼šhttps://qiita.com/hnishi/items/a9217249d7832ed2c035 module foo.com/hiroki-it/repository go 1.16 replace github.com/hiroki-it/foo_repository => / ã¾ãŸï¼Œãƒ«ãƒ¼ãƒˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã ã‘ã§ãªãï¼Œå„ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã«ã‚‚go.modãƒ•ã‚¡ã‚¤ãƒ«ã‚’é…ç½®ã™ã‚‹å¿…è¦ãŒã‚ã‚‹ï¼ foo_repository â”œâ”€â”€ cmd â”‚ â””â”€â”€ hello.go â”‚ â”œâ”€â”€ go.mod â”œâ”€â”€ go.sum â””â”€â”€ local-pkg â”œâ”€â”€ go.mod # å„ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã«go.modã‚’é…ç½®ã™ã‚‹ï¼ â””â”€â”€ module.go module foo.com/hiroki-it/foo_repository/local-pkg go 1.16 ã“ã‚Œã‚‰ã«ã‚ˆã‚Šï¼Œãƒ­ãƒ¼ã‚«ãƒ«ã®ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’ã‚¤ãƒ³ãƒãƒ¼ãƒˆã§ãã‚‹ã‚ˆã†ã«ãªã‚‹ï¼ import \"local.packages/local-pkg\" func main() { // ä½•ã‚‰ã‹ã®å‡¦ç† } go.sumãƒ•ã‚¡ã‚¤ãƒ« ãƒ»go.sumãƒ•ã‚¡ã‚¤ãƒ«ã¨ã¯ PHPã«ãŠã‘ã‚‹composer.lockãƒ•ã‚¡ã‚¤ãƒ«ã«ç›¸å½“ã™ã‚‹ï¼go.modãƒ•ã‚¡ã‚¤ãƒ«ã«ã‚ˆã£ã¦å®Ÿéš›ã«ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚ŒãŸãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ãŒè‡ªå‹•çš„ã«å®Ÿè£…ã•ã‚Œã‚‹ï¼ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã”ã¨ã®ãƒã‚§ãƒƒã‚¯ã‚µãƒ ãŒè¨˜éŒ²ã•ã‚Œã‚‹ãŸã‚ï¼Œå‰å›ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æ™‚ã¨æ¯”è¼ƒã—ã¦ï¼Œãƒ©ã‚¤ãƒ–ãƒ©ãƒªã«å¤‰æ›´ãŒã‚ã‚‹ã‹ã©ã†ã‹ã‚’æ¤œçŸ¥ã§ãã‚‹ï¼ "},"public/software/software_application_backend_go_framework_gin.html":{"url":"public/software/software_application_backend_go_framework_gin.html","title":"ğŸ“– Gin","keywords":"","body":"Gin ã¯ã˜ã‚ã« æœ¬ã‚µã‚¤ãƒˆã«ã¤ãã¾ã—ã¦ï¼Œä»¥ä¸‹ã‚’ã”èªè­˜ã®ã»ã©å®œã—ããŠé¡˜ã„ã„ãŸã—ã¾ã™ï¼ https://hiroki-it.github.io/tech-notebook-gitbook/ Context Bind ãƒ»å‡¦ç† ãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‹ã‚‰ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ã—ï¼Œæ§‹é€ ä½“ã«ç´ä»˜ã‘ã‚‹ï¼Cotent-Typeãƒ˜ãƒƒãƒ€ãƒ¼ã®MIMEã‚¿ã‚¤ãƒ—ã«å¿œã˜ã¦ï¼Œãƒã‚¤ãƒ³ãƒ‰é–¢æ•°ã‚’ã‚³ãƒ¼ãƒ«ã—åˆ†ã‘ã‚‹ï¼ å‚è€ƒï¼šhttps://pkg.go.dev/github.com/gin-gonic/gin?utm_source=godoc#Context.Bind BindJSON ãƒ»å‡¦ç† Content-Typeãƒ˜ãƒƒãƒ€ãƒ¼ã®MIMEã‚¿ã‚¤ãƒ—ãŒapplication/jsonã§ã‚ã‚‹ã“ã¨ãŒå‰æã§ã‚ã‚‹ï¼ãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‹ã‚‰JSONãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ã—ï¼Œæ§‹é€ ä½“ã«ç´ä»˜ã‘ã‚‹ï¼ å‚è€ƒï¼šhttps://pkg.go.dev/github.com/gin-gonic/gin?utm_source=godoc#Context.BindJSON BindQuery ãƒ»å‡¦ç† ã‚¯ã‚¨ãƒªãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‹ã‚‰ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ã—ï¼Œæ§‹é€ ä½“ã«ç´ä»˜ã‘ã‚‹ï¼ Get ãƒ»å‡¦ç† åŒä¸€ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆã«ã¦Seté–¢æ•°ã§ã‚»ãƒƒãƒˆã•ã‚ŒãŸãƒãƒƒãƒ—å‹ãƒ‡ãƒ¼ã‚¿ã‹ã‚‰ï¼Œã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹å‹ã§å€¤ã‚’å–å¾—ã™ã‚‹ï¼å€¤ãŒå­˜åœ¨ã—ãªã„å ´åˆã¯ï¼Œç¬¬äºŒè¿”å´å€¤ã§falseã‚’è¿”å´ã™ã‚‹ï¼ å‚è€ƒï¼šhttps://pkg.go.dev/github.com/gin-gonic/gin#Context.Get ShouldBindQueryï¼ˆ= ShouldBindWithï¼‰ ãƒ»å‡¦ç† ã‚¯ã‚¨ãƒªãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‹ã‚‰ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ã—ï¼ŒæŒ‡å®šã—ãŸãƒã‚¤ãƒ³ãƒ‡ã‚£ãƒ³ã‚°ãƒ„ãƒ¼ãƒ«ã‚’ä½¿ç”¨ã—ã¦ï¼Œæ§‹é€ ä½“ã«ç´ä»˜ã‘ã‚‹ï¼ JSON ãƒ»å‡¦ç† JSONãƒ‡ãƒ¼ã‚¿ã¨ã—ã¦ï¼Œãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’è¿”ä¿¡ã™ã‚‹ï¼ç¬¬äºŒå¼•æ•°ã®å¼•æ•°å‹ãŒã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã«ãªã£ã¦ã„ã‚‹ãŸã‚ï¼Œæ§˜ã€…ãªãƒ‡ãƒ¼ã‚¿å‹ã‚’æ¸¡ã›ã‚‹ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š ãƒãƒƒãƒ—å‹ãƒ‡ãƒ¼ã‚¿ã‚’æ¸¡ã™ï¼ c.JSON(200, gin.H{ \"id\": 1, \"name\": \"hiroki hasegawa\", }) æ§‹é€ ä½“å‹ãƒ‡ãƒ¼ã‚¿ã‚’æ¸¡ã™ï¼ type Foo struct { id int json:\"id\" name string json:\"name\" } c.JSON(200, &Foo{ id: 1, name: \"hiroki hasegawa\", }) MustGet ãƒ»å‡¦ç† åŒä¸€ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆã«ã¦Seté–¢æ•°ã§ã‚»ãƒƒãƒˆã•ã‚ŒãŸãƒãƒƒãƒ—å‹ãƒ‡ãƒ¼ã‚¿ã‹ã‚‰ï¼Œã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹å‹ã§å€¤ã‚’å–å¾—ã™ã‚‹ï¼å€¤ãŒå­˜åœ¨ã—ãªã„å ´åˆã¯ï¼Œãƒ©ãƒ³ã‚¿ã‚¤ãƒ ã‚¨ãƒ©ãƒ¼ã¨ãªã‚‹ï¼ å‚è€ƒï¼šhttps://pkg.go.dev/github.com/gin-gonic/gin#Context.MustGet Param ãƒ»å‡¦ç† ã‚¯ã‚¨ãƒªãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‹ã‚‰ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ã™ã‚‹ï¼ã“ã®å¾Œï¼Œæ§‹é€ ä½“ã«ç´ä»˜ã‘ã‚‹å ´åˆã¯ï¼ŒBindQueryé–¢æ•°ã‚’ä½¿ç”¨ã—ãŸæ–¹ãŒè‰¯ã„ï¼ Set ãƒ»å‡¦ç† å½“è©²ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆã§åˆ©ç”¨ã§ãã‚‹ãƒãƒƒãƒ—å‹ãƒ‡ãƒ¼ã‚¿ã«ï¼Œå€¤ã‚’ä¿å­˜ã™ã‚‹ï¼ å‚è€ƒï¼šhttps://pkg.go.dev/github.com/gin-gonic/gin#Context.Set ãƒ»æ³¨æ„ç‚¹ ãƒ‡ãƒ¼ã‚¿å‹ã‚’å¤‰æ›ã—ãŸå€¤ã‚’Seté–¢æ•°ã§ä¿å­˜ã—ãªã„ã‚ˆã†ã«ã™ã‚‹ã“ã¨ã§ã‚ã‚‹ï¼Seté–¢æ•°å¾Œã«Geté–¢æ•°ã§å–å¾—ã•ã‚Œã‚‹å€¤ã¯ï¼Œå…ƒã€…ã®ãƒ‡ãƒ¼ã‚¿å‹ã«é–¢ä¿‚ãªãã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹å‹ã«å¤‰æ›ã•ã‚Œã¦ã—ã¾ã†ï¼ãã®ãŸã‚ï¼Œä¾‹ãˆã°ï¼Œã‚¿ã‚¤ãƒ—IDå‹ã¨ã—ã¦å€¤ã‚’ä¿å­˜ã—ãŸã¨ã—ã¦ã‚‚ï¼ŒGeté–¢æ•°ã§å¾—ã‚‰ã‚ŒãŸã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹å‹ãƒ‡ãƒ¼ã‚¿ã‚’æ”¹ã‚ã¦å¤‰æ›ã—ãªã„ã¨ã„ã‘ãªããªã£ã¦ã—ã¾ã†ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š package middlewares import ( \"strconv\" \"github.com/gin-gonic/gin\" ) // ConvertId ãƒ‘ã‚¹ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã®idã®ãƒ‡ãƒ¼ã‚¿å‹ã‚’å¤‰æ›ã—ã¾ã™ï¼ func ConvertId() gin.HandlerFunc { return func(ctx *gin.Context) { id, err := strconv.Atoi(ctx.Param(\"id\")) if err != nil { _ = ctx.Error(err) return } ctx.Set(\"id\", id) ctx.Next() } } package controller type UserController struct { *interfaces.Controller userInteractor *interactor.UserInteractor } func (uc *UserController) GetUser(ctx *gin.Context) { // ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹å‹ã«ãªã£ã¦ã—ã¾ã†ï¼ userId, ok := ctx.Get(\"id\") if !ok { uc.SendErrorJson(ctx, 400, []string{\"Parameters are not found.\"}) return } Util H ãƒãƒƒãƒ—å‹ã®å¤‰æ•°ã®ã‚¨ã‚¤ãƒªã‚¢ã‚¹ã¨ã—ã¦åƒãï¼ type H map[string]interface{} c.JSON(200, gin.H{ \"id\": 1, \"name\": \"hiroki hasegawa\", }) c.JSON(400, gin.H{ \"errors\": []string{ \"Fooã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸\", \"Barã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸\", } }) Validator tag ãƒ»binding ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã®ãƒ«ãƒ¼ãƒ«ã‚’å®šç¾©ã™ã‚‹ï¼æ¨™æº–ã®ãƒ«ãƒ¼ãƒ«ã®ä¸€è¦§ã¯ï¼Œä»¥ä¸‹ã®ãƒªãƒ³ã‚¯ã‚’å‚è€ƒã«ã›ã‚ˆï¼ å‚è€ƒï¼šhttps://github.com/go-playground/validator/blob/65bb1236771df9bc1630c78a43b0bfea10fe7122/baked_in.go#L70 "},"public/software/software_application_frontend_js_object_orientation_prototype.html":{"url":"public/software/software_application_frontend_js_object_orientation_prototype.html","title":"ğŸ“– ï¸ãƒ—ãƒ­ãƒˆã‚¿ã‚¤ãƒ—","keywords":"","body":"ãƒ—ãƒ­ãƒˆã‚¿ã‚¤ãƒ— ã¯ã˜ã‚ã« æœ¬ã‚µã‚¤ãƒˆã«ã¤ãã¾ã—ã¦ï¼Œä»¥ä¸‹ã‚’ã”èªè­˜ã®ã»ã©å®œã—ããŠé¡˜ã„ã„ãŸã—ã¾ã™ï¼ å‚è€ƒï¼šhttps://hiroki-it.github.io/tech-notebook-gitbook/ 01. æ¨™æº–ãƒ“ãƒ«ãƒˆã‚¤ãƒ³ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ æ¨™æº–ãƒ“ãƒ«ãƒˆã‚¤ãƒ³ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã¨ã¯ JavaScriptã®å®Ÿè¡Œç’°å¢ƒã«ã‚ã‚‰ã‹ã˜ã‚çµ„ã¿è¾¼ã¾ã‚ŒãŸã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆï¼ Object ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’ç”Ÿæˆã™ã‚‹ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆï¼ä»–ã®å…¨ã¦ã®æ¨™æº–ãƒ“ãƒ«ãƒˆã‚¤ãƒ³ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®ç¶™æ‰¿å…ƒã«ãªã£ã¦ã„ã‚‹ãŸã‚ï¼Œæ¨™æº–ãƒ“ãƒ«ãƒˆã‚¤ãƒ³ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã¯ï¼ŒObjectãŒæŒã¤ãƒ¡ã‚½ãƒƒãƒ‰ã¨ãƒ‡ãƒ¼ã‚¿ã‚’ä½¿ã†ã“ã¨ãŒã§ãã‚‹ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š // newæ¼”ç®—å­ã‚’ä½¿ã£ã¦ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’ç”Ÿæˆ const obj = new Object(); Function ï¼Šå®Ÿè£…ä¾‹ï¼Š Array ãƒ»Array.prototype.entries() é…åˆ—ã‹ã‚‰keyã¨valueã‚’å–å¾—ã™ã‚‹ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š const array = [\"foo\", \"bar\", \"baz\"]; // keyï¼Œvalueã‚’å–å¾—ã§ãã‚‹ï¼ const iterator = array.entries(); // for-ofã§å±•é–‹ for (const value of iterator) { console.log(value); } // [ 0, 'foo' ] // [ 1, 'bar' ] // [ 2, 'baz' ] ãƒ»Array.prototype.map() ï¼Šå®Ÿè£…ä¾‹ï¼Š // ã“ã“ã«å®Ÿè£…ä¾‹ ãƒ»Array.prototype.filter() ï¼Šå®Ÿè£…ä¾‹ï¼Š // ã“ã“ã«å®Ÿè£…ä¾‹ ãƒ»Array.length è¦ç´ æ•°ã‚’å‡ºåŠ›ã™ã‚‹ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š const param = [\"foo\", \"bar\", \"baz\", \"qux\"]; console.log( param.length ); // 4 JSON ãƒ»JSON.parseãƒ¡ã‚½ãƒƒãƒ‰ JavaScriptã‹ã‚‰JSONã«ã‚·ãƒªã‚¢ãƒ©ã‚¤ã‚ºã™ã‚‹ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š console.log( JSON.stringify({ x : 1, y : 5, z : \"test\" }) ); // JSONå½¢å¼ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ // \"{\"x\":5, \"y\":5 \"z\":\"test\"}\" ãƒ»stringifyãƒ¡ã‚½ãƒƒãƒ‰ JSONã‹ã‚‰JavaScriptã«ãƒ‡ã‚·ãƒªã‚¢ãƒ©ã‚¤ã‚ºã™ã‚‹ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š console.log( JSON.parse({ \"x\" : 1, \"y\" : 5, \"z\" : \"test\" }) ); // JavaScriptã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ // {x:5, y:5 z:\"test\"} 02. ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®ç”Ÿæˆï¼ŒåˆæœŸåŒ– ãƒªãƒ†ãƒ©ãƒ«è¡¨è¨˜ã®ä½¿ç”¨ ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’ãƒªãƒ†ãƒ©ãƒ«è¡¨è¨˜ã§ç”Ÿæˆã™ã‚‹æ–¹æ³•ï¼ã‚­ãƒ£ãƒ¡ãƒ«ã‚±ãƒ¼ã‚¹ï¼ˆå°æ–‡å­—ã‹ã‚‰å§‹ã‚ã‚‹è¨˜æ³•ï¼‰ã‚’ç”¨ã„ã‚‹ï¼ ãƒ»éçœç•¥å½¢ ï¼Šå®Ÿè£…ä¾‹ï¼Š // ãƒªãƒ†ãƒ©ãƒ«è¡¨è¨˜ const foo = { // æ…£ç¿’çš„ã«ã‚¢ãƒ³ãƒ€ãƒ¼ãƒãƒ¼ã§privateã‚’è¡¨ã™ï¼ _property: 0, alertValue: (value) => { alert(value); }, setValue(value) { this._property = value; }, getValue() { return this._property; } } ãƒ»çœç•¥å½¢ ãƒªãƒ†ãƒ©ãƒ«è¡¨è¨˜ã«ãŠã„ã¦ï¼ŒmethodA(): fucntion{} ã¨ã™ã‚‹ã¨ã“ã‚ã‚’ï¼ŒmethodA() {}ã¨è¨˜è¿°ã§ãã‚‹ï¼ // ãƒªãƒ†ãƒ©ãƒ«è¡¨è¨˜ const foo = { // ï½ ä¸­ç•¥ ï½ alertValue(value) { alert(value); }, // ï½ ä¸­ç•¥ ï½ } ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿é–¢æ•°ã®ä½¿ç”¨ ãƒ»Objectã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿é–¢æ•° ã‚­ãƒ£ãƒ¡ãƒ«ã‚±ãƒ¼ã‚¹ï¼ˆå°æ–‡å­—ã‹ã‚‰å§‹ã‚ã‚‹è¨˜æ³•ï¼‰ã‚’ç”¨ã„ã‚‹ï¼ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã‚’ç”Ÿæˆã™ã‚‹ãŸã‚ã«ã¯ï¼Œå€¤ã‚’æ ¼ç´ã™ã‚‹å¿…è¦ãŒã‚ã‚‹ï¼é–¢æ•°å®£è¨€ã‚ã‚‹ã„ã¯é–¢æ•°å¼ã§è¨˜è¿°ã™ã‚‹ï¼ãƒ‘ã‚¹ã‚«ãƒ«ã‚±ãƒ¼ã‚¹ï¼ˆå¤§æ–‡å­—ã‹ã‚‰å§‹ã‚ã‚‹è¨˜æ³•ï¼‰ã‚’ç”¨ã„ã‚‹ï¼ã¡ãªã¿ã«ï¼Œã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£å€¤ã¨ã—ã¦ç”Ÿæˆã•ã‚ŒãŸé–¢æ•°ã‚’ï¼Œãƒ¡ã‚½ãƒƒãƒ‰ã¨å‘¼ã¶ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š const foo = new Object({ // æ…£ç¿’çš„ã«ã‚¢ãƒ³ãƒ€ãƒ¼ãƒãƒ¼ã§privateã‚’è¡¨ã™ï¼ _property: 0, setValue(value) { this._property = value; }, getValue() { return this._property; } }) ãƒ»Functionã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿é–¢æ•° ï¼Šå®Ÿè£…ä¾‹ï¼Š const Foo = new Function(); ãŸã ã—ï¼Œå…¬å¼ã‹ã‚‰ã“ã®ã‚ˆã†ãªè¨˜æ³•ã¯ï¼Œéæ¨å¥¨ã¨ã•ã‚Œã¦ã„ã‚‹ï¼ä»¥ä¸‹ã®é–¢æ•°å®£è¨€ï¼Œé–¢æ•°å¼ï¼Œã‚¢ãƒ­ãƒ¼é–¢æ•°ã«ã‚ˆã‚‹é–¢æ•°å¼çœç•¥ï¼Œã®è¨˜æ³•ãŒæ¨å¥¨ã•ã‚Œã‚‹ï¼ç‰¹ã«ã‚¢ãƒ­ãƒ¼é–¢æ•°ã§ã¯ï¼ŒthisãŒå®£è¨€ã•ã‚ŒãŸã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆè‡ªèº«ã‚’æŒ‡ã™ãŸã‚ï¼Œä¿å®ˆæ€§ãŒé«˜ããŠã™ã™ã‚ã§ã‚ã‚‹ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š // é–¢æ•°å®£è¨€ function Foo() { // æ…£ç¿’çš„ã«ã‚¢ãƒ³ãƒ€ãƒ¼ãƒãƒ¼ã§privateã‚’è¡¨ã™ï¼ _property = 0; // ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£å€¤ã¨ã—ã¦å®£è¨€ã—ãŸé–¢æ•°ã‚’ï¼Œãƒ¡ã‚½ãƒƒãƒ‰ã¨ã„ã†ï¼ this.setValue = (value) => { this._property = value; }; this.getValue = () =>{ return this._property; }; } // ã‚³ãƒ¼ãƒ« const Foo = new Foo(); // é–¢æ•°å¼ const Foo = (value) => { // æ…£ç¿’çš„ã«ã‚¢ãƒ³ãƒ€ãƒ¼ãƒãƒ¼ã§privateã‚’è¡¨ã™ï¼ _property = 0; this.setValue = (value) => { this._property = value; }; this.getValue = () => { return this._property; }; } // ã‚¢ãƒ­ãƒ¼é–¢æ•°ã«ã‚ˆã‚‹é–¢æ•°å¼ã®çœç•¥è¨˜æ³• const Foo = (value) => { // æ…£ç¿’çš„ã«ã‚¢ãƒ³ãƒ€ãƒ¼ãƒãƒ¼ã§privateã‚’è¡¨ã™ï¼ _property = 0; this.setValue = (value) => { this._property = value; }; this.getValue = () => { return this._property; }; } ãƒªãƒ†ãƒ©ãƒ«è¡¨è¨˜ã¨Objectã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿é–¢æ•°ã«ã‚ˆã‚‹ç”Ÿæˆã¨ã¯ç•°ãªã‚Šï¼Œã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿é–¢æ•°ã«ã‚ˆã£ã¦å®£è¨€ã•ã‚ŒãŸã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã¯ï¼Œæš—ç¤ºçš„ã«prototypeãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã‚’æŒã¤ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š // ãƒªãƒ†ãƒ©ãƒ«è¡¨è¨˜ã«ã‚ˆã‚‹ç”Ÿæˆ const object1 = {}; // Objectã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿é–¢æ•°ã«ã‚ˆã‚‹ç”Ÿæˆ const object2 = new Object({}); // ãƒ¦ãƒ¼ã‚¶å®£è¨€Functionã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿é–¢æ•°ã«ã‚ˆã‚‹ç”Ÿæˆ const Object3 = () => {}; // å‡ºåŠ›çµæœ console.log( object1.prototype, // undefined object2.prototype, // undefined object3.prototype // Object3 {} ); ç³–è¡£æ§‹æ–‡ã®classã®ä½¿ç”¨ ãƒ»JavaScriptã®ã‚¯ãƒ©ã‚¹ã¨ã¯ ES6ã‹ã‚‰ï¼Œç³–è¡£æ§‹æ–‡ã®classã«ã‚ˆã£ã¦ï¼Œã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’å®£è¨€ã§ãã‚‹ã‚ˆã†ã«ãªã£ãŸï¼ã‚¯ãƒ©ã‚¹å®£è¨€ã‚ã‚‹ã„ã¯ã‚¯ãƒ©ã‚¹å¼ã§è¨˜è¿°ã™ã‚‹ï¼ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®ç”Ÿæˆæ™‚ï¼Œconstructor()ã§ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®åˆæœŸåŒ–ã‚’è¡Œã†ï¼ãƒ‘ã‚¹ã‚«ãƒ«ã‚±ãƒ¼ã‚¹ï¼ˆå¤§æ–‡å­—ã‹ã‚‰å§‹ã‚ã‚‹è¨˜æ³•ï¼‰ã‚’ç”¨ã„ã‚‹ï¼ ãƒ»ã‚¯ãƒ©ã‚¹å®£è¨€è¨˜æ³• ï¼Šå®Ÿè£…ä¾‹ï¼Š // named exportã«ã‚ˆã‚‹å‡ºåŠ› export class Foo { // classã§ã—ã‹ä½¿ãˆãªã„ï¼ // Setterã®ä»£ã‚ã‚Šã«ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ã§Immutableã‚’å®Ÿç¾ï¼ // ãƒ‡ãƒ¼ã‚¿ã®å®£è¨€ã¨æ ¼ç´ãŒåŒæ™‚ã«è¡Œã‚ã‚Œã‚‹ï¼ constructor(value) { this.property = value; } getValue() { return this.property; } } // ãƒ•ã‚¡ã‚¤ãƒ«ã®èª­ã¿è¾¼ã¿ import {Foo} from \"./foo.js\"; // ç”Ÿæˆï¼ŒåˆæœŸåŒ– const foo = new Foo(1); // ãƒ¡ã‚½ãƒƒãƒ‰ã®ã‚³ãƒ¼ãƒ« foo.getValue(); ãƒ»ã‚¯ãƒ©ã‚¹å¼è¨˜æ³• // named exportã«ã‚ˆã‚‹å‡ºåŠ› export const Foo = class { // classã§ã—ã‹ä½¿ãˆãªã„ï¼ // Setterã®ä»£ã‚ã‚Šã«ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ã§Immutableã‚’å®Ÿç¾ï¼ // ãƒ‡ãƒ¼ã‚¿ã®å®£è¨€ã¨æ ¼ç´ãŒåŒæ™‚ã«è¡Œã‚ã‚Œã‚‹ï¼ constructor(value) { this._property = value; } getValue() { return this._property; } } // ãƒ•ã‚¡ã‚¤ãƒ«ã®èª­ã¿è¾¼ã¿ import { Foo } from \"./foo.js\"; // ç”Ÿæˆï¼ŒåˆæœŸåŒ– const foo = new Foo(1); // ãƒ¡ã‚½ãƒƒãƒ‰ã®ã‚³ãƒ¼ãƒ« foo.getValue(); 02-02. ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®æ“ä½œ ãƒ—ãƒ­ãƒˆã‚¿ã‚¤ãƒ—ãƒã‚§ãƒ¼ãƒ³ã«ã‚ˆã‚‹ç¶™æ‰¿ ãƒ»ãƒ—ãƒ­ãƒˆã‚¿ã‚¤ãƒ—ãƒã‚§ãƒ¼ãƒ³ã¨ã¯ ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆãŒæš—ç¤ºçš„ã«æŒã¤prototypeãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã«ï¼Œåˆ¥ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®ãƒ¡ãƒ³ãƒã‚’è¿½åŠ ã™ã‚‹ã“ã¨ã«ã‚ˆã£ã¦ï¼Œãã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®ãƒ—ãƒ­ãƒˆã‚¿ã‚¤ãƒ—ã‚’ç¶™æ‰¿ã§ãã‚‹ï¼ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‹ã‚‰ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã‚„ãƒ¡ã‚½ãƒƒãƒ‰ã‚’ã‚³ãƒ¼ãƒ«ã—ãŸæ™‚ï¼Œãã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã«ã“ã‚Œã‚‰ãŒå­˜åœ¨ã—ãªã‘ã‚Œã°ï¼Œç¶™æ‰¿å…ƒã¾ã§è¾¿ã‚‹ä»•çµ„ã¿ã‚’ã€ãƒ—ãƒ­ãƒˆã‚¿ã‚¤ãƒ—ãƒã‚§ãƒ¼ãƒ³ã€ã¨ã„ã†ï¼ã‚¯ãƒ©ã‚¹ãƒ™ãƒ¼ã‚¹ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆæŒ‡å‘ã§ç”¨ã„ã‚‰ã‚Œã‚‹ã‚¯ãƒ©ã‚¹ãƒã‚§ãƒ¼ãƒ³ã«ã¤ã„ã¦ã¯ï¼Œåˆ¥ãƒãƒ¼ãƒˆã‚’å‚ç…§ã›ã‚ˆï¼ ãƒ»new Obejct()ã‚’ç”¨ã„ãŸç¶™æ‰¿ ï¼Šå®Ÿè£…ä¾‹ï¼Š // å¤§å…ƒã¨ãªã‚‹ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã¯å€‹åˆ¥ãƒ•ã‚¡ã‚¤ãƒ«ã§ç®¡ç†ã—ã¦ãŠãã®ãŒãƒ™ã‚¿ãƒ¼ï¼ // ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿é–¢æ•°ã®é–¢æ•°å¼ã«ã‚ˆã‚‹å®£è¨€ï¼ const Foo = (value) => { // æ…£ç¿’çš„ã«ã‚¢ãƒ³ãƒ€ãƒ¼ãƒãƒ¼ã§privateã‚’è¡¨ã™ï¼ _property = 0; this.setValue = (value) => { this._property = value; } this.getValue = () => { return this._property; }; } åˆ¥ã‚¯ãƒ©ã‚¹ã§ï¼Œä»¥ä¸‹ã®ã‚ˆã†ã«ç¶™æ‰¿ã™ã‚‹ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š // ç¶™æ‰¿å…ƒã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’èª­ã¿è¾¼ã‚€ã“ã¨ã‚‚å¿˜ã‚Œãšã«ï¼ // prototypeãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã®ç¶™æ‰¿å…ˆã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’å®£è¨€ï¼ const SubFoo = (subValue) => { // æ…£ç¿’çš„ã«ã‚¢ãƒ³ãƒ€ãƒ¼ãƒãƒ¼ã§privateã‚’è¡¨ã™ï¼ this.subProperty = subValue; this.setSubValue = (subValue) => { this.subProperty = subValue; } this.getSubValue = () => { return this.subProperty; }; } // new Foo()ã‚’ç”¨ã„ãŸç¶™æ‰¿ï¼ SubFoo.prototype = new Foo(); // SubFooã‚¯ãƒ©ã‚¹ã«ã¯getValue()ã¯ç„¡ã„ï¼ // ç¶™æ‰¿å…ƒã¾ã§è¾¿ã‚Šï¼ŒExamlpeã‚¯ãƒ©ã‚¹ã‹ã‚‰ãƒ¡ã‚½ãƒƒãƒ‰ãŒã‚³ãƒ¼ãƒ«ã•ã‚Œã‚‹ï¼ˆãƒ—ãƒ­ãƒˆã‚¿ã‚¤ãƒ—ãƒã‚§ãƒ¼ãƒ³ï¼‰ï¼ const result = SubFoo.getValue() console.log(result); ãƒ»Object.create()ã‚’ç”¨ã„ãŸç¶™æ‰¿ã¨ãƒ¡ãƒ³ãƒè¿½åŠ  ï¼Šå®Ÿè£…ä¾‹ï¼Š // ç¶™æ‰¿å…ƒã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’èª­ã¿è¾¼ã‚€ã“ã¨ã‚‚å¿˜ã‚Œãšã«ï¼ // prototypeãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã®ç¶™æ‰¿å…ˆã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’å®£è¨€ï¼ const SubFoo = () => { // æ…£ç¿’çš„ã«ã‚¢ãƒ³ãƒ€ãƒ¼ãƒãƒ¼ã§privateã‚’è¡¨ã™ï¼ _property = 0; this.setSubValue = (subValue) => { this.subProperty = subValue; }; this.getSubValue = () => { return this.subProperty; }; }; // Object.create()ã‚’ç”¨ã„ãŸç¶™æ‰¿ï¼ SubFoo.prototype = Object.create(Foo.prototype); // SubFooã‚¯ãƒ©ã‚¹ã«ã¯getValue()ã¯ç„¡ã„ï¼ // ç¶™æ‰¿å…ƒã¾ã§è¾¿ã‚Šï¼ŒExamlpeã‚¯ãƒ©ã‚¹ã‹ã‚‰ãƒ¡ã‚½ãƒƒãƒ‰ãŒã‚³ãƒ¼ãƒ«ã•ã‚Œã‚‹ï¼ˆãƒ—ãƒ­ãƒˆã‚¿ã‚¤ãƒ—ãƒã‚§ãƒ¼ãƒ³ï¼‰ï¼ const result = SubFoo.getValue(); console.log(result); ã¾ãŸï¼ŒObject.create()ã‚’ç”¨ã„ã‚‹å ´åˆï¼Œç¶™æ‰¿ã ã‘ã§ãªãï¼Œãƒ¡ãƒ³ãƒã‚’æ–°ã—ãè¿½åŠ ã™ã‚‹ã“ã¨ã‚‚ã§ãã‚‹ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š // Object.create()ã«ã‚ˆã‚‹ç¶™æ‰¿ï¼ SubFoo.prototype = Object.create(Foo.prototype, { // ãƒ‡ãƒ¼ã‚¿ã‚’å®šç¾© subProperty: \"ãƒ†ã‚¹ãƒˆ\" // ãƒ¡ã‚½ãƒƒãƒ‰ã‚’å®šç¾© printSubValue: () => { return \"ã“ã‚Œã¯\" + this.subProperty + \"ã§ã™ï¼\"; } }); // SubFooã‚¯ãƒ©ã‚¹ã«ã¯printSubValue()ãŒè¿½åŠ ã•ã‚ŒãŸï¼ const result = SubFoo.printSubValue(); console.log(result); 02-03. thisã®å‚ç…§å…ˆ ãƒ¡ã‚½ãƒƒãƒ‰ã¨ã—ã¦ã‚³ãƒ¼ãƒ«ã™ã‚‹å ´åˆ ãƒ¡ã‚½ãƒƒãƒ‰å†…ã®thisã¯ï¼Œfooã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’æŒ‡ã™ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š const foo = { // æ…£ç¿’çš„ã«ã‚¢ãƒ³ãƒ€ãƒ¼ãƒãƒ¼ã§privateã‚’è¡¨ã™ï¼ _property: 0, setValue(value) { this._property = value; }, getValue() { return this._property; } } // ãƒ¡ã‚½ãƒƒãƒ‰å†…ã®thisã¯ï¼Œfooã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’æŒ‡ã™ï¼ foo.setValue(1); foo.getValue(); // 1 ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿é–¢æ•°ã¨ã—ã¦ã‚³ãƒ¼ãƒ«ã™ã‚‹å ´åˆ ãƒ»é–¢æ•°å®£è¨€ã¨é–¢æ•°å¼ã«ã‚ˆã‚‹ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿é–¢æ•°å†…ã®thisã®å ´åˆ ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿é–¢æ•°å†…ã®thisã¯ï¼Œè‡ªèº«ãŒã‚³ãƒ¼ãƒ«ã•ã‚ŒãŸã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’æŒ‡ã™ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š // ä¸€ç•ªå¤–å´ã¯Windowã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ param = \"global param\"; // é–¢æ•°å®£è¨€ function printParam(){ console.log(this.param); } // ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ1 const object1 = { param: \"object1 param\", func: printParam } // ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ2 const object2 = { param: \"object2 param\", func: printParam } /* ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿é–¢æ•°å†…ã®thisã®å ´åˆ ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿é–¢æ•°å†…ã®thisã¯ï¼Œè‡ªèº«ãŒã‚³ãƒ¼ãƒ«ã•ã‚ŒãŸã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’æŒ‡ã™ï¼ ã“ã“ã§ã¯ï¼Œobject1ã¨object2 */ object1.printParam; // object1 param object2.printParam; // object2 param ãƒ»ã‚¢ãƒ­ãƒ¼é–¢æ•°ã«ã‚ˆã‚‹ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿é–¢æ•°å†…ã®thisã®å ´åˆ ã‚¢ãƒ­ãƒ¼é–¢æ•°å†…ã®thisã®å‚ç…§å…ˆã«ã¯ï¼Œååˆ†ãªæ³¨æ„ãŒå¿…è¦ã§ã‚ã‚‹ï¼ä»Šã¾ã§ï¼ŒJavaScriptã§ã¯ï¼Œthisã®å‚ç…§å…ˆãŒæ–‡è„ˆã«ã‚ˆã£ã¦å¤‰ã‚ã‚‹ã“ã¨ã«æ‰¹åˆ¤ãŒé›†ã¾ã£ã¦ã„ãŸï¼ãã“ã§ï¼Œå‚ç…§å…ˆãŒæ–‡è„ˆã«ã‚ˆã£ã¦å¤‰ã‚ã‚‰ãªã„æ©Ÿèƒ½ãŒè¿½åŠ ã•ã‚ŒãŸï¼thisã¯ï¼Œè‡ªèº«ãŒå®£è¨€ã•ã‚ŒãŸã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’æŒ‡ã™ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š // ä¸€ç•ªå¤–å´ã¯Windowã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ param = \"global param\"; // ã‚¢ãƒ­ãƒ¼é–¢æ•°ã«ã‚ˆã‚‹çœç•¥è¨˜æ³• const printParam = () => { console.log(this.param); }; // ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ1 const object1 = { param: \"object1 param\", func: printParam }; // ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ2 const object2 = { param: \"object2 param\", func: printParam } /* ã‚¢ãƒ­ãƒ¼é–¢æ•°å†…ã®thisã®å ´åˆ thisã¯ï¼Œè‡ªèº«ãŒå®£è¨€ã•ã‚ŒãŸã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’æŒ‡ã™ï¼ ã“ã“ã§ã¯ï¼Œä¸€ç•ªå¤–å´ã®Windowã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã§ã‚ã‚Šï¼Œobject1ã¨object2ã§ã¯ãªã„ï¼ å‚ç…§å…ˆã¯æ–‡è„ˆã«ã‚ˆã£ã¦å¤‰ã‚ã‚‰ãªã„ï¼ */ object1.printParam; // global param object2.printParam; // global param ã¾ãŸï¼Œã‚¢ãƒ­ãƒ¼é–¢æ•°ãŒã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯é–¢æ•°ã®å¼•æ•°ã¨ãªã£ã¦ã„ã‚‹å ´åˆâ€¦ï¼ˆè¦å‹‰å¼·ï¼‰ "},"public/software/software_application_frontend_js_object_orientation_method_data.html":{"url":"public/software/software_application_frontend_js_object_orientation_method_data.html","title":"ğŸ“– ï¸ãƒ¡ã‚½ãƒƒãƒ‰ï¼ãƒ‡ãƒ¼ã‚¿","keywords":"","body":"ãƒ¡ã‚½ãƒƒãƒ‰ï¼ãƒ‡ãƒ¼ã‚¿ ã¯ã˜ã‚ã« æœ¬ã‚µã‚¤ãƒˆã«ã¤ãã¾ã—ã¦ï¼Œä»¥ä¸‹ã‚’ã”èªè­˜ã®ã»ã©å®œã—ããŠé¡˜ã„ã„ãŸã—ã¾ã™ï¼ å‚è€ƒï¼šhttps://hiroki-it.github.io/tech-notebook-gitbook/ 01. é–¢æ•° é–¢æ•°ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ ãƒ»é–¢æ•°ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã¨ã¯ ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã§ã‚‚ã‚ã‚Šï¼Œé–¢æ•°ã§ã‚ã‚‹ï¼ ãƒ»ãƒªãƒ†ãƒ©ãƒ«è¡¨è¨˜ã«ã‚ˆã‚‹é–¢æ•°ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ // å®šç¾© const object = { foo: \"bar\", age: 42, baz: {myProp: 12}, } ãƒ»ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿é–¢æ•° é–¢æ•°å®£è¨€æ–¹å¼ã®Functionã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ã‚’ä½¿ç”¨ã—ã¦ï¼Œã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’å®šç¾©ã™ã‚‹ï¼ // é–¢æ•°å®£è¨€ã«ã‚ˆã‚‹å®šç¾© function car(make, model, year) { this.make = make; this.model = model; this.year = year; } // ã‚³ãƒ¼ãƒ« const mycar = new car(\"Eagle\", \"Talon TSi\", 1993); functionå‘½ä»¤ ãƒ»functionå‘½ä»¤ã¨ã¯ ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã§ã¯ãªã„é–¢æ•°ã§ã‚ã‚‹ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š // å®šç¾©ï¼ˆã‚³ãƒ¼ãƒ«ã™ã‚‹å ´æ‰€ãŒå‰å¾Œã—ã¦ã‚‚ç„¡é–¢ä¿‚ï¼‰ function foo(){ return \"foo\"; } // ã‚³ãƒ¼ãƒ« methodA(); ãƒ»åå‰ãŒãƒ‰ãƒ«ãƒãƒ¼ã‚¯ã®ã‚‚ã® JavaScriptã§ã‚ˆãè¦‹ã‹ã‘ã‚‹ãƒ‰ãƒ«ãƒãƒ¼ã‚¯ï¼ã“ã‚Œã¯ï¼Œé–¢æ•°ã®åå‰ã¨ã—ã¦ãƒ‰ãƒ«ãƒãƒ¼ã‚¯ã‚’ä½¿ç”¨ã—ã¦ã„ã‚‹ã ã‘ã§ã‚ã‚‹ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š // å®šç¾© function $(){ return \"foo\"; } jQueryã§ã¯ï¼Œãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®èª­ã¿è¾¼ã¿å®£è¨€æ™‚ã«ï¼Œã€ŒJqueryã€ã¨ã„ã†åå‰ã®ä»£ã‚ã‚Šã«ãƒ‰ãƒ«ãƒãƒ¼ã‚¯ã‚’ä½¿ç”¨ã™ã‚‹ä»•æ§˜ã«ãªã£ã¦ã‚‹ï¼ã“ã‚Œã¨æ··ä¹±ã—ãªã„ã‚ˆã†ã«æ³¨æ„ã™ã‚‹ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š // jQuery.get() ã¨åŒã˜ $.get() ãƒ»ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯é–¢æ•° const asyncFunc = (param, callback) => { setTimeout(() => { // getDataãƒ¡ã‚½ãƒƒãƒ‰ã¯ï¼Œæ•°å€¤ã‚’æ¸¡ã™ã¨dataã‚’å–å¾—ã—ã¦ãã‚Œã‚‹ã¨ä»®å®šã—ã¾ã™ï¼ const data = getData(param); const err = data.getError(); // ç¬¬äºŒå¼•æ•°ã®ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯é–¢æ•°ã¯ï¼ŒgetDataãƒ¡ã‚½ãƒƒãƒ‰ã¨getErrorãƒ¡ã‚½ãƒƒãƒ‰ã®å¾Œã«å®Ÿè¡Œã•ã‚Œã‚‹ï¼ callback(err, data); }, 0); } const test = 1 // asyFuncãƒ¡ã‚½ãƒƒãƒ‰ã®ç¬¬ä¸€å¼•æ•°ãŒï¼Œç¬¬äºŒå¼•æ•°ã§è¨­å®šã—ãŸã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯é–¢æ•°ã«æ¸¡ã•ã‚Œã‚‹ï¼ // æ¸¡ã•ã‚ŒãŸã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯é–¢æ•°ã¯ï¼ŒgetDataãƒ¡ã‚½ãƒƒãƒ‰ã¨getErrorãƒ¡ã‚½ãƒƒãƒ‰ã®å¾Œã«å®Ÿè¡Œã•ã‚Œã‚‹ãŸã‚ï¼Œerrã‚„dataã‚’å—ã‘å–ã‚Œã‚‹ asyncFunc(test, (err, data) => { if (err) { throw err; } console.log(data); }); ãƒ»ãƒ•ã‚¡ã‚¤ãƒ«å¤–ã§èª­ã¿è¾¼ã‚€ é–¢æ•°ã®å‰ã§exportã‚’å®£è¨€ã™ã‚‹ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š é–¢æ•°ã®å®šç¾©ã¨exportå®£è¨€ã‚’åŒæ™‚ã«è¡Œã†ï¼ export function foo(){ return \"foo\"; } ã‚ã‚‹ã„ã¯ï¼Œåˆ¥ã€…ã«è¡Œã†ï¼ const foo = () => { return \"foo\"; } export default foo 02. ãƒ‡ãƒ¼ã‚¿å‹ undefinedï¼Œnull ãƒ»undefined ãƒ‡ãƒ¼ã‚¿ã‚’ä»£å…¥ã—ãªã„æ™‚ã«é©ç”¨ã•ã‚Œã‚‹ãƒ‡ãƒ¼ã‚¿å‹ã§ã‚ã‚‹ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š // å¤‰æ•°b: åˆæœŸåŒ–ã•ã‚Œã¦ã„ãªã„ï¼ˆå€¤ãŒä»£å…¥ã•ã‚Œã¦ã„ãªã„ï¼‰ const b; // å¤‰æ•°bã®å‡ºåŠ› console.log(b); // undefied ãƒ»null nullã¯ï¼Œundefinedã¨ã¯ç•°ãªã‚Šï¼Œæ„å›³ã—ã¦ä»£å…¥ã—ãªã‘ã‚Œã°é©ç”¨ã•ã‚Œãªã„ãƒ‡ãƒ¼ã‚¿å‹ã§ã‚ã‚‹ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š // å¤‰æ•°a: æ„å›³ã‚’ã‚‚ã£ã¦nullã‚’å…¥ã‚Œã¦ã„ã‚‹ const a = null; console.log(a); // null ãƒ»undefinedã®è¿”å´ undefinedã‚’è¿”å´ã™ã‚‹å ´åˆï¼Œreturnã®ã¿ã‚’è¨˜è¿°ã™ã‚‹ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š function hoge(){ return; // ç©ºã®ã€returnæ–‡ã€ã§ã™ã€‚ç©ºãªã®ã§ã€undefinedã€ã‚’è¿”ã—ã¾ã™ã€‚ } const x = hoge(); // å¤‰æ•°ã€xã€ã«ã¯é–¢æ•°ã€hogeã€ã‹ã‚‰è¿”ã£ã¦ããŸã€undefinedã€ãŒä»£å…¥ã•ã‚Œã¾ã™ã€‚ console.log(x); // ã€undefinedã€ãŒå‡ºåŠ›ã•ã‚Œã¾ã™ã€‚ 03. å¤‰æ•° å¤‰æ•°ã®ç¨®é¡ ãƒ»ä¸€è¦§è¡¨ é …ç›® var let const å†å®£è¨€ å¯èƒ½ ä¸å¯èƒ½ ä¸å¯èƒ½ å†ä»£å…¥ å¯èƒ½ å¯èƒ½ ä¸å¯èƒ½ åˆæœŸåŒ–ï¼ˆundefinedåŒ–ï¼‰ å¯èƒ½ å¯èƒ½ ä¸å¯èƒ½ ã‚¹ã‚³ãƒ¼ãƒ— é–¢æ•°ã‚¹ã‚³ãƒ¼ãƒ— ãƒ–ãƒ­ãƒƒã‚¯ã‚¹ã‚³ãƒ¼ãƒ— ãƒ–ãƒ­ãƒƒã‚¯ã‚¹ã‚³ãƒ¼ãƒ— ãƒ»const åŸºæœ¬çš„ã«ã¯ï¼Œå®£è¨€ã«constã‚’ç”¨ã„ã‚‹ if (true) { // ãƒ–ãƒ­ãƒƒã‚¯å¤–ã‹ã‚‰ã‚¢ã‚¯ã‚»ã‚¹ä¸å¯ const x = \"foo\"; // å†å®£è¨€ä¸å¯ const x = \"bar\"; // ERROR // å†ä»£å…¥ä¸å¯ x = \"baz\"; // ERROR } // ãƒ–ãƒ­ãƒƒã‚¯å†…ã®constã«ã‚¢ã‚¯ã‚»ã‚¹ä¸å¯ console.log(x); // ERROR ãƒ» let ç¹°ã‚Šè¿”ã—å‡¦ç†ã«ãŠã„ã¦å†ä»£å…¥ãŒå¿…è¦ã§ã‚ã‚Œã°ï¼Œconstã§ã¯ãªãletã‚’ç”¨ã„ã‚‹ï¼ if (true) { // ãƒ–ãƒ­ãƒƒã‚¯å¤–ã‹ã‚‰ã‚¢ã‚¯ã‚»ã‚¹ä¸å¯ let x = \"foo\"; // å†å®£è¨€ä¸å¯ let x = \"bar\"; // ERROR // å†ä»£å…¥å¯èƒ½ x = \"baz\"; } // ãƒ–ãƒ­ãƒƒã‚¯å†…ã®letã«ã‚¢ã‚¯ã‚»ã‚¹ä¸å¯ console.log(x); // ERROR ã¾ãŸï¼Œtry-catchæ§‹æ–‡ã§ã¯å¤‰æ•°ã¸ã®ä»£å…¥ãŒä¿è¨¼ã•ã‚Œã¦ã„ãªã„ãŸã‚ï¼Œletã‚’ä½¿ç”¨ã—ã¦ï¼Œã‚ã‚‰ã‹ã˜ã‚åˆæœŸåŒ–ã—ã¦ãŠãå¿…è¦ãŒã‚ã‚‹ï¼ const asyncFunc = async () => { // åˆæœŸåŒ–ã™ã‚‹ã¨undefinedã«ãªã‚‹ï¼ let response; try { response = await axios.get(\"/some/path1\") console.info(response); } catch (error) { console.error(error); } return response; } ãƒ» var if (true) { // ãƒ–ãƒ­ãƒƒã‚¯å¤–ã‹ã‚‰ã‚¢ã‚¯ã‚»ã‚¹å¯ var x = \"hoge\"; // å†å®£è¨€ var x = \"fuga\"; // å†ä»£å…¥å¯èƒ½ x = \"fuga\"; } // ãƒ–ãƒ­ãƒƒã‚¯å†…ã®varã«ã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½ console.log(x); // fuga å¤‰æ•°ã®å·»ãä¸Šã’ ãƒ»å·»ãä¸Šã’ã®å¯¾ç­– æ„å›³ã—ãªã„æŒ™å‹•ã‚’é˜²ããŸã‚ï¼Œjavascriptã«ãŠã„ã¦ï¼Œå¤‰æ•°ã®å®£è¨€ã¨ä»£å…¥ã¯ï¼Œã‚¹ã‚³ãƒ¼ãƒ—ã®æœ€åˆã«è¡Œã†ï¼ ãƒ»var ç¢ºèªã®ãŸã‚console.logãƒ¡ã‚½ãƒƒãƒ‰ã‚’å®Ÿè¡Œã—ãŸå ´åˆï¼Œxã‚’å®£è¨€ã—ã¦ã„ãªã„ãŸã‚ï¼Œã€Œx is not defined ã€ã‚¨ãƒ©ãƒ¼ã«ãªã‚Šãã†ã§ã‚ã‚‹ï¼ã—ã‹ã—å®Ÿéš›ã¯ï¼Œå®£è¨€ãŒæ—¢ã«æ¸ˆã‚“ã§ãŠã‚Šï¼Œxã«å€¤ãŒä»£å…¥ã•ã‚Œã¦ã„ãªã„ã“ã¨ã‚’ç¤ºã™ã€Œundefinedã€ã¨ãªã‚‹ï¼ console.log(x); // undefined var x = \"hoge\"; // å®£è¨€ã¨ä»£å…¥ ã“ã‚Œã¯ï¼Œã‚¹ã‚³ãƒ¼ãƒ—ã®ç¯„å›²å†…ã§å®£è¨€ã¨ä»£å…¥ã‚’å®Ÿè¡Œã—ãŸå¤‰æ•°ã«ãŠã„ã¦ï¼Œå®£è¨€å‡¦ç†ãŒã‚¹ã‚³ãƒ¼ãƒ—ã®æœ€åˆã«è¡Œã£ãŸã“ã¨ã«ãªã‚‹ã¨ã„ã†ä»•æ§˜ã®ãŸã‚ã§ã‚ã‚‹ï¼ // var x å®£è¨€å‡¦ç†ã—ãŸã“ã¨ã«ãªã‚‹ console.log(x); // undefined var x = \"hoge\"; // å®£è¨€ã¨ä»£å…¥ã«ã‚ˆã‚Šï¼Œå®Ÿéš›ã¯å®£è¨€å‡¦ç†ã‚’å®Ÿè£…ã—ã¦ã„ãªãã¨ã‚‚ï¼Œè¡Œãªã£ãŸã“ã¨ã«ãªã‚‹ï¼ ãƒ»let,const å®£è¨€ã«letï¼Œconstã‚’ä½¿ç”¨ã—ãŸå ´åˆï¼Œå·»ãä¸Šã’ã¯èµ·ã“ã‚‰ãªã„ï¼ console.log(x); // x is not defined let x = \"hoge\"; åˆ†å‰²ä»£å…¥ ãƒ»é…åˆ— é…åˆ—ã®å€¤ã‚’ï¼Œä»»æ„ã®åå‰ã®å¤‰æ•°ã«ä»£å…¥ã™ã‚‹ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š const array = [1, 2, 3]; // fooã«1ï¼Œbarã«2ï¼Œbazã«3ï¼Œã‚’ä»£å…¥ const [foo, bar, baz] = array; console.log(foo); // 1 console.log(bar); // 2 console.log(baz); // 3 ãƒ»ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®å€¤ã‚’ï¼Œãƒ—ãƒ­ãƒ‘ãƒ†ã‚£åã¨åŒã˜åå‰ã®å¤‰æ•°ã«ä»£å…¥ã™ã‚‹ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š const obj = { foo: 1, bar: 2, baz: 3 }; // ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£åã¨åŒã˜åå‰ã®å¤‰æ•°ã«ä»£å…¥ const {foo, baz} = obj; console.log(foo); // 1 console.log(bar); // 3 04. åå¾© for ... of ãƒ»for ... ofã¨ã¯ é…åˆ—ã‚’é †åºã‚’ä¿ã£ãŸã¾ã¾èµ°æŸ»ã—ï¼Œé…åˆ—ã®å€¤ã‚’å–å¾—ã™ã‚‹ï¼ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã«å¯¾ã—ã¦entiresãƒ¡ã‚½ãƒƒãƒ‰ã‚’ä½¿ç”¨ã—ï¼Œä¸€åº¦é…åˆ—ã«å¤‰æ›ã™ã‚Œã°ï¼Œã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã§ã‚‚for ... ofã‚’ä½¿ç”¨ã§ãã‚‹ï¼for ... inã‚’ä½¿ç”¨ã™ã‚‹ã‚ˆã‚Šï¼Œã“ã¡ã‚‰ã‚’ä½¿ç”¨ã—ãŸæ–¹ãŒè‰¯ã„ï¼ ãƒ»é…åˆ—ã®å ´åˆ const array = [\"foo\", \"bar\", \"baz\"]; for (const value of array) { console.log(value); } // foo // bar // baz é…åˆ—ã®entiresãƒ¡ã‚½ãƒƒãƒ‰ã‚’ä½¿ç”¨ã™ã‚Œã°ï¼Œã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ç•ªå·ã‚’å–å¾—ã™ã‚‹ã“ã¨ã‚‚ã§ãã‚‹ï¼ const array = [\"foo\", \"bar\", \"baz\"]; for (const [key, value] of array.entries()) { console.log(key); } // 0 // 1 // 2 ãƒ»ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®å ´åˆ ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã«å¯¾ã—ã¦entiresãƒ¡ã‚½ãƒƒãƒ‰ã‚’å®Ÿè¡Œã—ï¼Œä¸€åº¦é€£æƒ³é…åˆ—ã«å¤‰æ›ã™ã‚Œã°ï¼Œã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã§ã‚‚for ... ofã‚’ä½¿ç”¨ã§ãã‚‹ï¼ const object = { \"x\": \"foo\", \"y\": \"bar\", \"z\": \"baz\" }; for (const [property, value] of Object.entries(object)) { console.log(value); } // foo // bar // baz for ... in ãƒ»for ... inã¨ã¯ é…åˆ—ï¼ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆï¼ˆé€£æƒ³é…åˆ—ï¼‰ã‚’é †åºã‚’ä¿ãŸãšã«èµ°æŸ»ã—ï¼Œã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£åã‚„é…åˆ—ã®ã‚­ãƒ¼åã‚’å–å¾—ã™ã‚‹ï¼ ãƒ»é…åˆ—ã®å ´åˆ const array = [\"foo\", \"bar\", \"baz\"]; for (const key in array) { console.log(key); } // 0 // 1 // 2 ãƒ»ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®å ´åˆ const object = { \"x\": \"foo\", \"y\": \"bar\", \"z\": \"baz\" }; for (const property in object) { console.log(property); console.log(object[property]); } // x // y // z // foo // bar // baz continue ãƒ»continueã¨ã¯ åå¾©å‡¦ç†ã®ç¾åœ¨ã®ãƒ«ãƒ¼ãƒ—ã‚’ã‚¹ã‚­ãƒƒãƒ—ã—ï¼Œæ¬¡ã®ãƒ«ãƒ¼ãƒ—ã‚’é–‹å§‹ã™ã‚‹ï¼ const array = [\"foo\", \"bar\", \"baz\"]; for (const [key, value] of array.entries()) { // ã‚­ãƒ¼åãŒå¶æ•°ã®çµ„ã‚’ã‚¹ã‚­ãƒƒãƒ—ã™ã‚‹ï¼ if(!(key % 2 == 0)){ continue; } console.log(value); } // foo // baz ãƒ»forEaché–¢æ•°ã‚’ä½¿ç”¨ã—ãŸä»£æ›¿æ³• åå¾©å‡¦ç†ã®ãƒ«ãƒ¼ãƒ—ã‚’continueã§ã‚¹ã‚­ãƒƒãƒ—ã¨åŒã˜å‹•ä½œã‚’ï¼Œé…åˆ—ã‚’æ‰±ã†é–¢æ•°ã®ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯é–¢æ•°ã§æ—©æœŸãƒªã‚¿ãƒ¼ãƒ³ã§å®Ÿç¾ã§ãã‚‹ï¼continueã‚’ä½¿ç”¨ã™ã‚‹ã‚ˆã‚Šï¼Œã“ã¡ã‚‰ã®æ–¹ãŒè‰¯ã„ï¼ å‚è€ƒï¼šhttps://www.deep-rain.com/programming/javascript/778#continue PHPã«ã‚‚ï¼ŒforEaché–¢æ•°ã¨åŒã˜ã‚ˆã†ã«é…åˆ—ã«å¯¾ã—ã¦ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯é–¢æ•°ã‚’é©ç”¨ã™ã‚‹é–¢æ•°ï¼ˆfindï¼Œfliterï¼Œmapï¼Œreduceï¼Œsomeï¼‰ãŒã‚ã‚Šï¼Œç”¨é€”ã«åˆã‚ã›ã¦ä½¿ã„åˆ†ã‘ã‚‹ï¼ å‚è€ƒï¼šhttps://qiita.com/diescake/items/70d9b0cbd4e3d5cc6fce ã¡ãªã¿ã«PHPã«ã‚‚ï¼ŒforEaché–¢æ•°ã¨åŒã˜ã‚ˆã†ãªä½¿ã„æ–¹ã‚’ã™ã‚‹array_walké–¢æ•°ãŒã‚ã‚‹ï¼ å‚è€ƒï¼šhttps://hiroki-it.github.io/tech-notebook-gitbook/public/backend_php_logic_iteration.html const array = [\"foo\", \"bar\", \"baz\"]; array.forEach((value, key) => { // ã‚­ãƒ¼ãŒå¶æ•°ã®çµ„ã‚’ã‚¹ã‚­ãƒƒãƒ—ã™ã‚‹ï¼ if(!(key % 2 == 0)){ return; } console.log(value); }) // foo // baz "},"public/software/software_application_frontend_js_logic_validation.html":{"url":"public/software/software_application_frontend_js_logic_validation.html","title":"ğŸ“– ï¸æ¤œè¨¼ãƒ­ã‚¸ãƒƒã‚¯","keywords":"","body":"æ¤œè¨¼ãƒ­ã‚¸ãƒƒã‚¯ ã¯ã˜ã‚ã« æœ¬ã‚µã‚¤ãƒˆã«ã¤ãã¾ã—ã¦ï¼Œä»¥ä¸‹ã‚’ã”èªè­˜ã®ã»ã©å®œã—ããŠé¡˜ã„ã„ãŸã—ã¾ã™ï¼ å‚è€ƒï¼šhttps://hiroki-it.github.io/tech-notebook-gitbook/ 01. æ¤œè¨¼ æ¤œè¨¼ã®å¿…è¦æ€§ã®æœ‰ç„¡ ãƒ»ä¸è¦ãªå ´åˆ ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‹ã‚‰å–å¾—ã—ãŸå¾Œã«ç›´æ¥è¡¨ç¤ºã™ã‚‹å€¤ã®å ´åˆï¼Œãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã§Nullã«ãªã‚‰ãªã„ã‚ˆã†ã«åˆ¶ç´„ã‚’ã‹ã‘ã‚‰ã‚Œã‚‹ï¼ãã®ãŸã‚ï¼Œå€¤ãŒæƒ³å®šé€šã‚Šã®çŠ¶æ…‹ã«ãªã£ã¦ã„ã‚‹ã‹ã‚’æ”¹ã‚ã¦æ¤œè¨¼ã™ã‚‹å¿…è¦ã¯ãªã„ï¼ ãƒ»å¿…è¦ãªå ´åˆ ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‹ã‚‰ã®å€¤ã‚’ç›´æ¥è¡¨ç¤ºã™ã‚‹å ´åˆã¨ç•°ãªã‚Šï¼Œæ–°ã—ãä½œã‚‰ã‚Œã‚‹å€¤ã‚’ç”¨ã„ã‚‹å ´åˆï¼Œãã®å€¤ãŒæƒ³å®šå¤–ã®çŠ¶æ…‹ã«ãªã£ã¦ã„ã‚‹å¯èƒ½æ€§ãŒã‚ã‚‹ï¼ãã®ãŸã‚ï¼Œå€¤ãŒæƒ³å®šé€šã‚Šã®çŠ¶æ…‹ã«ãªã£ã¦ã„ã‚‹ã‹ã‚’æ¤œè¨¼ã™ã‚‹å¿…è¦ãŒã‚ã‚‹ï¼æ¤œè¨¼ãƒ‘ã‚¿ãƒ¼ãƒ³ã«ã¤ã„ã¦ã¯ï¼Œå¾Œè¿°ã®èª¬æ˜ã‚’å‚è€ƒã«ã›ã‚ˆï¼ æ¤œè¨¼ãƒ‘ã‚¿ãƒ¼ãƒ³ã¨æ¤œè¨¼ãƒ¡ã‚½ãƒƒãƒ‰ã®å¯¾å¿œ ã€‡ï¼šTRUE âœ•ï¼šFALSE ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã®æ¤œè¨¼ã«ã¤ã„ã¦ã¯ä»¥ä¸‹ã‚’å‚è€ƒã«ã›ã‚ˆï¼ å‚è€ƒï¼šhttps://hiroki-it.github.io/tech-notebook-gitbook/public/software/software_application_backend_php_logic_validation.html typeof $var if($var) null object âœ• 0 number âœ• 1 number ã€‡ \"\"ï¼ˆç©ºæ–‡å­—ï¼‰ string âœ• \"ã‚\" string ã€‡ NaN number âœ• undefined undefined âœ• "},"public/software/software_application_frontend_js_logic_asynchronous_process.html":{"url":"public/software/software_application_frontend_js_logic_asynchronous_process.html","title":"ğŸ“– ï¸éåŒæœŸå‡¦ç†ãƒ­ã‚¸ãƒƒã‚¯","keywords":"","body":"éåŒæœŸå‡¦ç†ãƒ­ã‚¸ãƒƒã‚¯ 01. éåŒæœŸå‡¦ç† éåŒæœŸå‡¦ç† ãƒ»éåŒæœŸå‡¦ç†ã¨ã¯ å‚è€ƒï¼šhttps://hiroki-it.github.io/tech-notebook-gitbook/public/software/software_basic_language_processor_process_mode.html ãƒ»éåŒæœŸå‡¦ç†åŒ– å‡¦ç†ã®å®Ÿè¡Œã‚’éƒ¨åˆ†çš„ã«é…ã‚‰ã›ã‚‹ã¨ï¼Œå¾Œç¶šã™ã‚‹å‡¦ç†ãŒå…ˆã«å®Ÿè¡Œã•ã‚Œã‚‹ï¼ã“ã‚Œã¯éåŒæœŸå‡¦ç†ã§ã‚ã‚‹ï¼ å‚è€ƒï¼šhttps://qiita.com/kiyodori/items/da434d169755cbb20447#%E9%9D%9E%E5%90%8C%E6%9C%9F%E5%87%A6%E7%90%86 ï¼Šå®Ÿè£…ä¾‹ï¼Š éåŒæœŸåŒ–ã™ã‚‹å‡¦ç†ã‚’setTimeouté–¢æ•°ã«æ¸¡ã—ï¼Œå‡¦ç†ã‚’é…ã‚‰ã›ã‚‹ï¼ function asyncMethod() { // 1ç§’ã ã‘å®Ÿè¡Œã‚’é…ã‚‰ã›ã‚‹ setTimeout(function () { console.log(\"foo\"); }, 1000); console.log(\"bar\"); } asyncMethod(); // å…ˆã«barãŒå®Ÿè¡Œã•ã‚Œã‚‹ // bar // foo Promiseã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ ãƒ»Promiseã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã¨ã¯ JavaScriptã«ãŠã„ã¦ï¼ŒéåŒæœŸå‡¦ç†ã®æˆå¦ã‚’ç®¡ç†ã—ï¼Œå¾Œç¶šã™ã‚‹å‡¦ç†ã‚’å®šç¾©ã§ãã‚‹ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®ã“ã¨ï¼Promiseã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®å®Ÿè£…ã®ä»•æ§˜ã¯å–ã‚Šæ±ºã‚ã‚‰ã‚Œã¦ãŠã‚Šï¼Œä»¥ä¸‹ã®ãƒªãƒ³ã‚¯ã‚’å‚è€ƒã«ã›ã‚ˆï¼ å‚è€ƒï¼šhttps://promisesaplus.com/ ãƒ»Promiseã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®ç¨®é¡ ãƒã‚¤ãƒ†ã‚£ãƒ–ãªJavaScriptã®Promiseã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆï¼ŒJQueryã®Promiseã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆï¼ŒãŒã‚ã‚‹ï¼ãƒã‚¤ãƒ†ã‚£ãƒ–ã®æ–¹ãŒï¼ŒPromiseã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®ä»•æ§˜ã«ã‚ˆã‚Šå‰‡ã£ãŸæ©Ÿèƒ½ã‚’æŒã¤ï¼ å‚è€ƒï¼šhttps://stackoverflow.com/questions/32831143/javascript-promise-vs-jquery-deferred ãƒªãƒªãƒ¼ã‚¹æ—¥ æä¾› ç¨®é¡ èª¬æ˜ è£œè¶³ 2012 JQueryãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®Deferredãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ« Promiseã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ ãƒãƒ¼ã‚¸ãƒ§ãƒ³1.5ã§Promiseã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆãŒå°å…¥ã•ã‚ŒãŸï¼å‚è€ƒï¼šhttps://api.jquery.com/category/version/1.5/ å‚è€ƒï¼šhttps://api.jquery.com/category/deferred-object/ 2015 ãƒ“ãƒ«ãƒˆã‚¤ãƒ³ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ Promiseã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ JQueryã®Promiseã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’å‚è€ƒã«ã—ã¦ï¼ŒES2015ã‹ã‚‰æ–°ã—ãä½¿ç”¨ã§ãã‚‹ã‚ˆã†ã«ãªã£ãŸï¼ å‚è€ƒï¼šhttps://developer.mozilla.org/ja/docs/Web/JavaScript/Reference/Global_Objects/Promise 2017 ãƒ“ãƒ«ãƒˆã‚¤ãƒ³ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ async/awaitå®£è¨€ ES2017ã‹ã‚‰æ–°ã—ãä½¿ç”¨ã§ãã‚‹ã‚ˆã†ã«ãªã£ãŸï¼ãƒ“ãƒ«ãƒˆã‚¤ãƒ³ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®Promiseã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’ã‚ˆã‚Šä½¿ç”¨ã—ã‚„ã™ãã—ãŸã‚‚ã®ï¼ å‚è€ƒï¼šhttps://developer.mozilla.org/ja/docs/Web/JavaScript/Reference/Statements/async_function 02. ãƒã‚¤ãƒ†ã‚£ãƒ–ãªJavaScript Promiseã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ Promiseã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ã«ï¼ŒéåŒæœŸå‡¦ç†ã‚’æŒã¤é–¢æ•°ã‚’æ¸¡ã™ã“ã¨ã«ã‚ˆã‚Šï¼ŒPromiseã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã¯ã“ã®é–¢æ•°å†…ã®éåŒæœŸå‡¦ç†ã®æˆå¦ã‚’ç®¡ç†ã™ã‚‹ï¼ å‚è€ƒï¼šhttps://developer.mozilla.org/ja/docs/Web/JavaScript/Reference/Global_Objects/Promise const asyncFunc = () => { return new Promise( // éåŒæœŸå‡¦ç†ã‚’æŒã¤é–¢æ•°ã‚’æ¸¡ã™ (resolve, reject) => { // é–¢æ•°å†…ã®éåŒæœŸå‡¦ç†ã®æˆå¦ãŒç®¡ç†ã•ã‚Œã‚‹ }) } resolveãƒ¡ã‚½ãƒƒãƒ‰ï¼Œrejectãƒ¡ã‚½ãƒƒãƒ‰ ãƒ»ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ã‚’ä½¿ç”¨ã™ã‚‹å ´åˆ Promiseã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿å†…ã§ã¯ï¼Œæš—é»™çš„ã«try-catchãŒå®Ÿè¡Œã•ã‚Œã¦ã„ã‚‹ï¼ãã®ãŸã‚ï¼Œçµæœã®ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãŒæˆåŠŸã§ã‚ã‚Œã°resolveãƒ¡ã‚½ãƒƒãƒ‰ã®çµæœã‚’è¿”å´ã—ï¼Œåå¯¾ã«å¤±æ•—ã§ã‚ã‚Œã°rejectãƒ¡ã‚½ãƒƒãƒ‰ã‚’è¿”å´ã™ã‚‹ï¼ä¸¡æ–¹ã‚’å®Ÿè£…ã™ã‚‹ã¨è‰¯ã—ãªã«å®Ÿè¡Œã—ã¦ãã‚Œã‚‹ï¼resolveãƒ¡ã‚½ãƒƒãƒ‰ã¨resolveãƒ¡ã‚½ãƒƒãƒ‰ã®ã‚³ãƒ¼ãƒ«æ™‚ã«returnã‚’ä½¿ç”¨ã—ãªã„ã¨ï¼Œå¾Œç¶šã™ã‚‹å‡¦ç†ã‚‚å®Ÿè¡Œã•ã‚Œã‚‹ï¼ä¸€ã¤ç›®ã®æ›¸ãæ–¹ã¨ã—ã¦ï¼ŒPromiseã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã®ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯é–¢æ•°ã«æ¸¡ã™æ–¹æ³•ãŒã‚ã‚‹ï¼ const asyncFunc = () => { return new Promise((resolve, reject) => { // ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãŒæˆåŠŸã®å ´åˆã«é¸æŠã•ã‚Œã‚‹ï¼ resolve(\"SUCCESS\"); // Promise { \"SUCCESS\" } // ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãŒå¤±æ•—ã®å ´åˆã«é¸æŠã•ã‚Œã‚‹ï¼ reject(\"FAILED\"); // Promise { \"FAILED\" } console.log(\"test\"); }) } console.log(asyncFunc()); // å¾Œç¶šã™ã‚‹å‡¦ç†ã‚‚å®Ÿè¡Œã•ã‚Œï¼Œresolveãƒ¡ã‚½ãƒƒãƒ‰ã®çµæœãŒè¿”å´ã•ã‚Œã‚‹ï¼ // test // Promise { 'SUCCESS' } ä¸€æ–¹ã§ï¼Œresolveãƒ¡ã‚½ãƒƒãƒ‰ã¨resolveãƒ¡ã‚½ãƒƒãƒ‰ã®ã‚³ãƒ¼ãƒ«æ™‚ã«returnã‚’ä½¿ç”¨ã™ã‚‹ã¨ï¼Œå¾Œç¶šã™ã‚‹å‡¦ç†ã¯å®Ÿè¡Œã•ã‚Œãªã„ï¼ const asyncFunc = () => { return new Promise((resolve, reject) => { return resolve(\"SUCCESS\"); reject(\"FAILED\"); console.log(\"test\"); }) } console.log(asyncFunc()); // å¾Œç¶šã™ã‚‹å‡¦ç†ã‚‚å®Ÿè¡Œã•ã‚Œãªã„ï¼ // Promise { 'SUCCESS' } ãƒ»ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ã‚’ä½¿ç”¨ã—ãªã„å ´åˆ åˆ¥ã®æ›¸ãæ–¹ã¨ã—ã¦ï¼ŒPromiseã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‹ã‚‰ç›´æ¥resolveãƒ¡ã‚½ãƒƒãƒ‰ã‚„rejectãƒ¡ã‚½ãƒƒãƒ‰ã‚’ã‚³ãƒ¼ãƒ«ã—ã¦ã‚‚ã‚ˆã„ï¼ã“ã®å ´åˆï¼Œå¿…ãšreturnã§è¿”å´ã™ã‚‹å¿…è¦ãŒã‚ã‚‹ï¼returnã‚’ä½¿ç”¨ã—ãªã„ã¨ï¼Œä½•ã‚‚è¿”å´ã•ã‚Œãªã„ï¼ const asyncFunc = () => { // ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãŒæˆåŠŸã®å ´åˆã«é¸æŠã•ã‚Œã‚‹ï¼ return Promise.resolve(\"SUCCESS\"); // Promise { \"SUCCESS\" } } const asyncFunc = () => { // ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãŒå¤±æ•—ã®å ´åˆã«é¸æŠã•ã‚Œã‚‹ï¼ return Promise.reject(\"FAILED\"); // Promise { \"FAILED\" } } console.log(asyncFunc()); // Promise { 'SUCCESS' } const asyncFunc = () => { return Promise.resolve(\"SUCCESS\"); } asyncFunc() // å¤±æ•—æ™‚ã«è¿”å´ã•ã‚ŒãŸrejectã‚’ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚° .catch((reject) => { // rejectãƒ¡ã‚½ãƒƒãƒ‰ã‚’å®Ÿè¡Œ reject }) .then((resolve) => { // resolveãƒ¡ã‚½ãƒƒãƒ‰ã‚’å®Ÿè¡Œ resolve }) console.log(asyncFunc()); // Promise { 'SUCCESS' } éåŒæœŸå‡¦ç†å†…ã§ä¸¡æ–¹ã‚’ã‚³ãƒ¼ãƒ«ã™ã‚‹ã¨ã‚¨ãƒ©ãƒ¼ã«ãªã‚‹ï¼ const asyncFunc = () => { Promise.resolve(\"SUCCESS\"); Promise.reject(\"FAILED\"); } console.log(asyncFunc()); // ã‚¨ãƒ©ãƒ¼ã«ãªã‚‹ UnhandledPromiseRejectionWarning: FAILED (Use `node --trace-warnings ...` to show where the warning was created) UnhandledPromiseRejectionWarning: Unhandled promise rejection. This error originated either by throwing inside of an async function without a catch block, or by rejecting a promise which was not handled with .catch(). To terminate the node process on unhandled promise rejection, use the CLI flag `--unhandled-rejections=strict` (see https://nodejs.org/api/cli.html#cli_unhandled_rejections_mode). (rejection id: 1) [DEP0018] DeprecationWarning: Unhandled promise rejections are deprecated. In the future, promise rejections that are not handled will terminate the Node.js process with a non-zero exit code. è£œè¶³ã¨ã—ã¦ï¼ŒNodeã®HTTPãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®é–¢æ•°ã¯ï¼ŒPromiseã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã®ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯é–¢æ•°ã¨ã—ã¦ä½¿ç”¨ã—ãªã„ã¨ï¼Œæ­£ã—ãæŒ™å‹•ã—ãªã„ï¼ å‚è€ƒï¼šhttps://stackoverflow.com/questions/38533580/nodejs-how-to-promisify-http-request-reject-got-called-two-times thenãƒ¡ã‚½ãƒƒãƒ‰ï¼Œcatchãƒ¡ã‚½ãƒƒãƒ‰ï¼Œfinallyãƒ¡ã‚½ãƒƒãƒ‰ ãƒ»ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ã‚’ä½¿ç”¨ã™ã‚‹å ´åˆ å‚è€ƒï¼šhttps://developer.mozilla.org/ja/docs/Web/JavaScript/Reference/Global_Objects/Promise#instance_methods ï¼Šå®Ÿè£…ä¾‹ï¼Š const resolveFunc = new Promise((resolve, reject) => { return resolve(\"resolve!!\"); }); resolveFunc.then((value) => { // resolveFuncãŒPromiseã‚’è¿”ã—ã€resolve!!ãŒresolveã•ã‚Œã‚‹ãŸã‚ // thenãƒ¡ã‚½ãƒƒãƒ‰ãŒå®Ÿè¡Œã•ã‚Œã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã«resolve!!ãŒè¡¨ç¤ºã•ã‚Œã‚‹ console.log(value); // resolve!! }); const resolveFunc = () => { // resolveFuncã¯async functionã§ã¯ãªã„ãŸã‚ã€Promiseã‚’è¿”ã•ãªã„ return \"resolve!!\"; } resolveFunc.then((value) => { // resolveFuncã¯Promiseã‚’è¿”ã•ãªã„ãŸã‚ã€ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¦å‹•ã‹ãªã„ // Uncaught TypeError: resolveError(...).then is not a function console.log(value); }); const rejectFunc = new Promise((resolve, reject) => { reject(new Error(\"reject!!\")); }); rejectFunc.catch((err) => { // rejectFuncãŒPromiseã‚’è¿”ã—ã€reject!!ãŒrejectã•ã‚Œã‚‹ãŸã‚ // catchãƒ¡ã‚½ãƒƒãƒ‰ãŒå®Ÿè¡Œã•ã‚Œã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã«reject!!ãŒè¡¨ç¤ºã•ã‚Œã‚‹ console.log(err); // reject!! }); 02-02. async/awaitå®£è¨€ asyncå®£è¨€ ãƒ»asyncå®£è¨€ã¨ã¯ Promiseã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’æ˜ç¤ºçš„ã«ä½¿ç”¨ã™ã‚‹å ´åˆï¼Œã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ã«éåŒæœŸå‡¦ç†ã‚’æŒã¤é–¢æ•°ã‚’æ¸¡ã™å¿…è¦ãŒã‚ã‚‹ï¼ä¸€æ–¹ã§ï¼Œasyncå®£è¨€ã•ã‚ŒãŸé–¢æ•°å†…ã®éåŒæœŸå‡¦ç†ã¯ï¼ŒPromiseã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã«æ¸¡ã™ãŸã‚ã®é–¢æ•°å†…ã«æš—é»™çš„ã«å®šç¾©ã•ã‚Œã‚‹ï¼Promiseã‚„ï¼Œã“ã‚Œã®ã‚³ãƒ³ãƒˆãƒ©ã‚¯ã‚¿ã«æ¸¡ã™é–¢æ•°ã‚’å®Ÿè£…ã™ã‚‹å¿…è¦ãŒç„¡ã„ãŸã‚ï¼Œå¯èª­æ€§ãŒé«˜ã¾ã‚‹ï¼ã¾ãŸï¼Œä»®ã«Promiseã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’ã‚³ãƒ¼ãƒ«ã—ï¼ŒPromiseã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆãŒPromiseã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã«æ¸¡ã•ã‚Œã¦ã—ã¾ã£ã¦ã‚‚ï¼Œçµæœçš„ã«å…¥ã‚Œå­ã«ãªã‚‰ãªã„ã‚ˆã†ã«ã‚ˆã—ãªã«å‡¦ç†ã—ã¦ãã‚Œã‚‹ï¼ å‚è€ƒï¼šhttps://developer.mozilla.org/ja/docs/Web/JavaScript/Reference/Statements/async_function ï¼Šå®Ÿè£…ä¾‹ï¼Š ä»¥ä¸‹ã®å…¨ã¦ã¯ï¼ŒåŒã˜å‡¦ç†ã‚’å®šç¾©ã—ã¦ã„ã‚‹ï¼ const asyncFunc = async () => { // Promiseã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã«æ¸¡ã™ãŸã‚ã®é–¢æ•°å†…ã«æš—é»™çš„ã«å®šç¾©ã•ã‚Œã‚‹ï¼ return \"SUCCESS\" } // å˜ã«returnã¨ã—ã¦ã‚‚Promiseã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆãŒè¿”å´ã•ã‚Œã‚‹ï¼ console.log(asyncFunc()); // Promise { \"SUCCESS\" } const asyncFunc = async () => { return new Promise((resolve, reject) => { return resolve(\"SUCCESS\") // Promise { \"SUCCESS\" } }) } // Promiseã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’è¿”å´ã™ã‚‹ã‚ˆã†ã«ã—ã¦ã‚‚ï¼Œå…¥ã‚Œå­ã«ã¯ãªã‚‰ãªã„ï¼ console.log(asyncFunc()); // Promise { \"SUCCESS\" } const asyncFunc = async () => { return Promise.resolve(\"SUCCESS\") // Promise { \"SUCCESS\" } } // Promiseã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’è¿”å´ã™ã‚‹ã‚ˆã†ã«ã—ã¦ã‚‚ï¼Œå…¥ã‚Œå­ã«ã¯ãªã‚‰ãªã„ï¼ console.log(asyncFunc()); // Promise { \"SUCCESS\" } ã¾ãŸï¼Œaxiosã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®ã‚ˆã†ã«Promiseã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’æ¨™æº–ã§è¿”å´ã™ã‚‹ãƒ¡ã‚½ãƒƒãƒ‰ã‚’ä½¿ç”¨ã—ã¦ã‚‚ã‚ˆã„ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š éé“å‡¦ç†ã¨ã—ã¦GETã§ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é€ä¿¡ã—ã¦ã„ã‚‹ï¼ // axiosã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®ãƒ¡ã‚½ãƒƒãƒ‰ã¯Promiseã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’è¿”å´ã™ã‚‹ï¼ const asyncFunc = async () => { axios.get(\"/some/path\").then((res) => { console.log(res.data); // \"some data\" }); } awaitå®£è¨€ã¨ã¯ ãƒ»awaitå®£è¨€ ä»¥é™ã®å…¨å‡¦ç†ã‚’thenãƒ¡ã‚½ãƒƒãƒ‰ã«æ¸¡ã™ï¼Promiseã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®thenãƒ¡ã‚½ãƒƒãƒ‰ã«ç›¸å½“ã™ã‚‹ãŒï¼Œthenãƒ¡ã‚½ãƒƒãƒ‰ã®ã‚ˆã†ã«ãƒ¡ã‚½ãƒƒãƒ‰ãƒã‚§ãƒ¼ãƒ³ã™ã‚‹å¿…è¦ã¯ãªããªã‚‹ãŸã‚ï¼Œå¯èª­æ€§ãŒé«˜ã„ï¼æ™‚é–“ã®ã‹ã‹ã‚‹éåŒæœŸå‡¦ç†ã§ã“ã‚Œã‚’å®£è¨€ã™ã‚‹ã¨ï¼ŒäºˆæœŸã›ãšå‡¦ç†ãŒæµã‚Œã¦ã—ã¾ã†ã“ã¨ã‚’é˜²ã’ã‚‹ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š // Promiseã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®thenãƒ¡ã‚½ãƒƒãƒ‰ã‚’ä½¿ç”¨ã—ãŸå ´åˆ const asyncFunc = async () => { axios.get(\"/some/path\").then((res) => { console.log(res.data); // \"some data\" }); } // awaitã‚’ä½¿ç”¨ã—ãŸå ´åˆ const asyncFunc = async () => { // ä»¥é™ã®å…¨å‡¦ç†ãŒthenãƒ¡ã‚½ãƒƒãƒ‰ã«æ¸¡ã•ã‚Œã‚‹ï¼ const res = await axios.get(\"/some/path\"); console.log(res.data); // \"some data\" } awaitå®£è¨€ã«ã‚ˆã‚Šï¼Œã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯åœ°ç„ã®ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ãŒåˆ†ã‹ã‚Šã‚„ã™ããªã‚‹ï¼ // Promiseã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®thenãƒ¡ã‚½ãƒƒãƒ‰ã‚’ä½¿ç”¨ã—ãŸå ´åˆ const asyncFunc = async () => { // ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯é–¢æ•°åœ°ç„ã«ãªã£ã¦ã„ã‚‹ï¼ axios.get(\"/some/path1\").then((res) => { const res1 = res; axios.get(\"/some/path1\").then((res) => { const res2 = res; console.log(res1.data + res2.data); // \"some data\" }); }) } // awaitã‚’ä½¿ç”¨ã—ãŸå ´åˆ const asyncFunc = async () => { const res1 = await axios.get(\"/some/path1\"); const res2 = await axios.get(\"/some/path2\"); console.log(res1.data + res2.data); // \"some data\" } ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚° ãƒ»try-catch Promiseã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®thenãƒ¡ã‚½ãƒƒãƒ‰ï¼Œcatchãƒ¡ã‚½ãƒƒãƒ‰ï¼Œfinallyãƒ¡ã‚½ãƒƒãƒ‰ã‚’ä½¿ç”¨ã—ã¦ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã‚’å®Ÿè£…ã§ãã‚‹ãŒï¼Œtry-catchæ–‡ã¨awaitå®£è¨€ã‚’çµ„ã¿åˆã‚ã›ã¦ï¼Œã‚ˆã‚Šå¯èª­æ€§é«˜ãå®Ÿè£…ã§ãã‚‹ï¼ å‚è€ƒï¼šhttps://developer.mozilla.org/ja/docs/Web/JavaScript/Reference/Global_Objects/Promise#instance_methods ï¼Šå®Ÿè£…ä¾‹ï¼Š const asyncFunc = async () => { return axios.get(\"/some/path1\") .catch((error) => { console.error(error); }) .then((data) => { console.info(data); }); } const asyncFunc = async () => { // åˆæœŸåŒ– let response; try { response = await axios.get(\"/some/path1\") console.info(response); } catch (error) { console.error(error); } return response; } ã‚¹ãƒªãƒ¼ãƒ— ãƒ»setTimeout æŒ‡å®šã—ãŸç§’æ•°ã ã‘å‡¦ç†ã‚’å¾…æ©Ÿã™ã‚‹ï¼ // 5ç§’å¾…æ©Ÿã™ã‚‹ï¼ await new Promise((resolve) => { setTimeout(resolve, 5000) }); 03. JQuery Promiseã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ ãƒ»doneãƒ¡ã‚½ãƒƒãƒ‰ï¼Œfailãƒ¡ã‚½ãƒƒãƒ‰ï¼Œalwaysãƒ¡ã‚½ãƒƒãƒ‰ Promiseã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆãŒã‚‚ã¤ãƒ¡ã‚½ãƒƒãƒ‰ï¼ajaxãƒ¡ã‚½ãƒƒãƒ‰ã«ã‚ˆã£ã¦ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’å—ä¿¡ã—ãŸå¾Œï¼Œãã®çµæœã‚’doneï¼Œfailï¼Œalwaysã®ä¸‰ã¤ã«åˆ†é¡ã—ï¼Œã“ã‚Œã«å¿œã˜ãŸã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯å‡¦ç†ã‚’å®Ÿè¡Œã™ã‚‹æ–¹æ³•ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š JQueryãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®getãƒ¡ã‚½ãƒƒãƒ‰ã‚„postãƒ¡ã‚½ãƒƒãƒ‰ã‚’ä½¿ç”¨ã—ãŸå ´åˆï¼ const url = \"https://www.google.co.jp/\"; $.get(url) .done((data) => { console.log(data); }) .fail((error) => { console.log(error); }); const url = \"https://www.google.co.jp/\"; const params = { name: \"Hiroki\", }; $.post(url, params) .done((data) => { console.log(data); }) .fail((error) => { console.log(error); }); JQueryãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®ajaxãƒ¡ã‚½ãƒƒãƒ‰ã‚’ä½¿ç”¨ã—ãŸå ´åˆï¼ const id = 1; $.ajax({ type: \"POST\", url: \"/xxx/xxx/\" + id + \"/\", contentType: \"application/json\", data: { param1: \"AAA\", param2: \"BBB\" }, }) // éåŒæœŸé€šä¿¡ã®æˆåŠŸæ™‚ã®ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯å‡¦ç† .done((data) => { console.log(data); }) // éåŒæœŸé€šä¿¡ã®å¤±æ•—æ™‚ã®ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯å‡¦ç† .fail((error) => { console.log(data); toastr.error(\"\", \"ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸï¼\"); }) // éåŒæœŸé€šä¿¡ã®æˆåŠŸå¤±æ•—ã«é–¢ã‚ã‚‰ãšå¸¸ã«å®Ÿè¡Œã™ã‚‹å‡¦ç† .always((data) => { this.isLoaded = false; }); ãƒ»thenãƒ¡ã‚½ãƒƒãƒ‰ Promiseã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆãŒã‚‚ã¤ãƒ¡ã‚½ãƒƒãƒ‰ï¼ajaxãƒ¡ã‚½ãƒƒãƒ‰ã«ã‚ˆã£ã¦ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’å—ä¿¡ã—ãŸå¾Œï¼Œãã®çµæœã‚’thenãƒ¡ã‚½ãƒƒãƒ‰ã®å¼•æ•°ã®é †ç•ªã§åˆ†é¡ã—ï¼Œã“ã‚Œã«å¿œã˜ãŸã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯å‡¦ç†ã‚’å®Ÿè¡Œã™ã‚‹æ–¹æ³•ï¼éåŒæœŸå‡¦ç†ã®å¾Œã«åŒæœŸå‡¦ç†ã‚’è¡Œã„ãŸã„å ´åˆã«ç”¨ã„ã‚‹ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š JQueryãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®ajaxãƒ¡ã‚½ãƒƒãƒ‰ã‚’ä½¿ç”¨ã—ãŸå ´åˆï¼ const id = 1; $.ajax({ type: \"POST\", url: \"/xxx/xxx/\" + id + \"/\", contentType: \"application/json\", data: { param1: \"AAA\", param2: \"BBB\" }, }) // æœ€åˆã®then .then( // å¼•æ•°1ã¤ã‚ã¯é€šä¿¡æˆåŠŸæ™‚ã®ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯å‡¦ç† (data) => { }, // å¼•æ•°2ã¤ã‚ã¯é€šä¿¡å¤±æ•—æ™‚ã®ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯å‡¦ç† (data) => { }) // æ¬¡ã®then .then( // å¼•æ•°1ã¤ã‚ã¯é€šä¿¡æˆåŠŸæ™‚ã®ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯å‡¦ç† (data) => { }); "},"public/software/software_application_frontend_js_package.html":{"url":"public/software/software_application_frontend_js_package.html","title":"ğŸ“– ï¸ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸","keywords":"","body":"ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ ã¯ã˜ã‚ã« æœ¬ã‚µã‚¤ãƒˆã«ã¤ãã¾ã—ã¦ï¼Œä»¥ä¸‹ã‚’ã”èªè­˜ã®ã»ã©å®œã—ããŠé¡˜ã„ã„ãŸã—ã¾ã™ï¼ å‚è€ƒï¼šhttps://hiroki-it.github.io/tech-notebook-gitbook/ 01. npmã«ã‚ˆã‚‹ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®ç®¡ç† init ãƒ»package.jsonãƒ•ã‚¡ã‚¤ãƒ«ã®ä½œæˆ ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®package.jsonãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã™ã‚‹ï¼ $ npm init ãƒ»package.jsonãƒ•ã‚¡ã‚¤ãƒ«ã®æ§‹é€  { # npmãƒ‘ãƒƒã‚±ãƒ¼ã‚¸åï¼å…¨ã¦ã®npmãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®ä¸­ã§ï¼Œä¸€æ„ã®åå‰ã§ãªã‘ã‚Œã°ãªã‚‰ãªã„ï¼ \"name\": \"tech-notebook-gitbook\", \"version\": \"1.0.0\", \"description\": \"tech-notebook-gitbook\", \"main\": \"index.js\", \"directories\": {}, # æœ¬ç•ªç’°å¢ƒã¨é–‹ç™ºç’°å¢ƒã§ä¾å­˜ã™ã‚‹ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸åï¼ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸åã¯ä¸€æ„ã«è­˜åˆ¥ã§ãã‚‹ï¼ \"dependencies\": { \"gitbook-plugin-advanced-emoji\": \"^0.2.2\", \"gitbook-plugin-anchors\": \"^0.7.1\", \"gitbook-plugin-back-to-top-button\": \"^0.1.4\", \"gitbook-plugin-copy-code-button\": \"^0.0.2\", \"gitbook-plugin-ga\": \"^1.0.1\", \"gitbook-plugin-github-buttons\": \"^3.0.0\", \"gitbook-plugin-hide-published-with\": \"^1.0.3\", \"gitbook-plugin-intopic-toc\": \"^1.1.1\", # ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã¨ã—ã¦ç™»éŒ²ã•ã‚Œã¦ã„ãªã„ã‚‚ã®ã€ãƒªãƒã‚¸ãƒˆãƒªURLã‹ã‚‰ç›´æ¥å‚ç…§ã™ã‚‹ï¼ã€git+ã€ã‚’å¿˜ã‚Œãªã„ã“ã¨ï¼ \"gitbook-plugin-prism\": \"git+https://github.com/hiroki-it/gitbook-plugin-prism.git\", \"gitbook-plugin-search-pro-fixed\": \"^1.0.1\", \"gitbook-plugin-sunlight-highlighter\": \"^0.4.3\", \"gitbook-plugin-toolbar\": \"^0.6.0\" }, # é–‹ç™ºç’°å¢ƒã®ã¿ä¾å­˜ã™ã‚‹ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸åï¼ \"devDependencies\": {}, \"scripts\": {}, \"repository\": { \"type\": \"git\", \"url\": \"https://github.com/hiroki-it/tech-notebook-gitbook.git\" }, # è‘—è€…å \"author\": { \"name\": \"Hiroki Hasegawa\", \"email\": \"example@gmail.com\", \"url\": \"https://github.com/hiroki-it\" }, \"license\": \"ISC\", \"bugs\": { \"url\": \"https://github.com/hiroki-it/tech-notebook-gitbook/issues\" }, \"homepage\": \"https://github.com/hiroki-it/tech-notebook-gitbook\" } install ãƒ»ã‚ªãƒ—ã‚·ãƒ§ãƒ³ãªã— ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã«ã¦ï¼Œpackage.lockãƒ•ã‚¡ã‚¤ãƒ«ã«å®Ÿè£…ã•ã‚ŒãŸãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®ã†ã¡ã§ï¼Œã‚¤ãƒ³ã‚¹ãƒ¼ãƒ«ã•ã‚Œã¦ã„ãªã„ã‚‚ã®ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹ï¼package.lockãƒ•ã‚¡ã‚¤ãƒ«ã®ãŠã‹ã’ã§ï¼Œãƒªãƒã‚¸ãƒˆãƒªã®åˆ©ç”¨è€…ãŒï¼Œnpm installã®å®Ÿè¡Œæ™‚ã«ï¼Œå…±é€šã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã®ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã§ãã‚‹ï¼ $ npm install ãƒ»--force ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æ™‚ã«ï¼Œãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã®å®Ÿè¡Œæ¨©é™ä¸è¶³ã§ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ãŒåœæ­¢ã™ã‚‹ã“ã¨ãŒã‚ã‚‹ï¼ã“ã‚Œã‚’ç„¡è¦–ã—ã¦ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã‚’è¡Œã†ï¼ $ npm install --force ãƒ»--save ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§æœ‰åŠ¹åŒ–ã•ã‚Œã¦ã„ã‚‹ï¼ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æ™‚ã«ï¼Œä¾å­˜ã™ã‚‹ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã¨ã—ã¦ï¼Œdependenciesã‚­ãƒ¼ã«ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸åã¨ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’æ›¸ãè¾¼ã‚€ï¼ $ npm install --save update ãƒ»ã‚ªãƒ—ã‚·ãƒ§ãƒ³ãªã— ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã«ã¦ï¼Œpackage.jsonãƒ•ã‚¡ã‚¤ãƒ«ã«å®Ÿè£…ã•ã‚ŒãŸãƒãƒ¼ã‚¸ãƒ§ãƒ³ã®æŒ‡å®šã‚’ã‚‚ã¨ã«ï¼Œæ›´æ–°å¯èƒ½ãªãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’æ›´æ–°ã™ã‚‹ï¼ $ npm update run ãƒ»ã‚ªãƒ—ã‚·ãƒ§ãƒ³ãªã— ãƒ¦ãƒ¼ã‚¶ãŒå®šç¾©ã—ãŸã‚¨ã‚¤ãƒªã‚¢ã‚¹åã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã™ã‚‹ï¼ $ npm run ã‚ã‚‰ã‹ã˜ã‚ï¼Œä»»æ„ã®ã‚¨ã‚¤ãƒªã‚¢ã‚¹åã‚’scriptsã‚­ãƒ¼ä¸‹ã«å®šç¾©ã™ã‚‹ï¼ã‚¨ã‚¤ãƒªã‚¢ã‚¹ã®ä¸­ã§ï¼Œå®Ÿè¡Œã™ã‚‹ã‚³ãƒãƒ³ãƒ‰ã®ã‚»ãƒƒãƒˆã‚’å®šç¾©ã™ã‚‹ï¼ã¡ãªã¿ã«ï¼Œå®Ÿè¡Œã™ã‚‹ã‚³ãƒãƒ³ãƒ‰ã®ä¸­ã§ï¼Œå†åº¦runã‚³ãƒãƒ³ãƒ‰ã‚’å®šç¾©ã™ã‚‹ã“ã¨ã‚‚å¯èƒ½ã§ã‚ã‚‹ï¼ { \"scripts\": { # \"\": \"\", \"dev\": \"npm run development\", \"development\": \"cross-env NODE_ENV=development node_modules/webpack/bin/webpack.js --progress --hide-modules --config=node_modules/laravel-mix/setup/webpack.config.js\", \"watch\": \"npm run development -- --watch\", \"watch-poll\": \"npm run watch -- --watch-poll\", \"hot\": \"cross-env NODE_ENV=development node_modules/webpack-dev-server/bin/webpack-dev-server.js --inline --hot --disable-host-check --config=node_modules/laravel-mix/setup/webpack.config.js\", \"prod\": \"npm run production\", \"production\": \"cross-env NODE_ENV=production node_modules/webpack/bin/webpack.js --no-progress --hide-modules --config=node_modules/laravel-mix/setup/webpack.config.js\" } } NODE_OPTIONS ãƒ¡ãƒ¢ãƒªä¸Šé™ã‚’è¨­å®šã™ã‚‹ï¼ $ export NODE_OPTIONS=\"--max-old-space-size=2048\" 02. yarnã«ã‚ˆã‚‹ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ç®¡ç† 03. ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ãƒãƒ³ãƒ‰ãƒ« ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ãƒãƒ³ãƒ‰ãƒ«ã¨ã¯ ãƒ»èª­ã¿è¾¼ã‚€ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’ã¾ã¨ã‚ã‚‹ JavaScriptãƒ•ã‚¡ã‚¤ãƒ«ã‚’èª­ã¿è¾¼ã‚€scriptã‚¿ã‚°ã‚’ä¸€ã¤ã«ã¾ã¨ã‚ã‚‹ï¼HTMLãŒãƒ–ãƒ©ã‚¦ã‚¶ã«ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã•ã‚Œã‚‹ã¨ï¼ŒJavaScriptã®ãƒ•ã‚¡ã‚¤ãƒ«ã¸ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆæ•°ãŒæ¸›ã‚‹ãŸã‚ï¼Œãƒšãƒ¼ã‚¸ã®èª­ã¿è¾¼ã¿ãŒæ—©ããªã‚‹ï¼ å‚è€ƒï¼šhttps://qiita.com/soarflat/items/28bf799f7e0335b68186 ï¼Šä¾‹ï¼Š ä»¥ä¸‹ã®ã‚ˆã†ãªHTMLãƒ•ã‚¡ã‚¤ãƒ«ãŒã‚ã‚‹ã¨ã™ã‚‹ï¼ webpack tutorial ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ãƒãƒ³ãƒ‰ãƒ«ã¯ï¼Œscriptã‚¿ã‚°ã§ã®ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®èª­ã¿è¾¼ã¿ã‚’ã¾ã¨ã‚ã‚‹ï¼ webpack tutorial "},"public/software/software_application_frontend_js_framework_vuejs.html":{"url":"public/software/software_application_frontend_js_framework_vuejs.html","title":"ğŸ“– ï¸Vue.js","keywords":"","body":"Vue.js ã¯ã˜ã‚ã« æœ¬ã‚µã‚¤ãƒˆã«ã¤ãã¾ã—ã¦ï¼Œä»¥ä¸‹ã‚’ã”èªè­˜ã®ã»ã©å®œã—ããŠé¡˜ã„ã„ãŸã—ã¾ã™ï¼ å‚è€ƒï¼šhttps://hiroki-it.github.io/tech-notebook-gitbook/ 01. Vue.jsã‚’ç”¨ã„ãŸMVVMã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ MVVMã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ï¼ŒåŒæ–¹å‘ãƒ‡ãƒ¼ã‚¿ãƒã‚¤ãƒ³ãƒ‡ã‚£ãƒ³ã‚° ãƒ»MVVMã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã¨ã¯ å‚è€ƒï¼šhttps://hiroki-it.github.io/tech-notebook-gitbook/public/software/software_application_architecture_frontend.html ãƒ» MVVMã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã«ãŠã‘ã‚‹å„å±¤ã®è²¬å‹™ Viewå±¤ï¼ˆxxx.htmlï¼Œ/xxx.twigï¼Œxxx-component.vueã®templateã‚¿ã‚°éƒ¨åˆ†ï¼‰ ViewModelå±¤ã‹ã‚‰æ¸¡ã•ã‚ŒãŸãƒ‡ãƒ¼ã‚¿ã‚’å‡ºåŠ›ã™ã‚‹ã ã‘ï¼ ViewModelå±¤ï¼ˆindex.jsï¼Œxxx-component.vueã®scriptã‚¿ã‚°éƒ¨åˆ†ï¼‰ ãƒ—ãƒ¬ã‚¼ãƒ³ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ãƒ­ã‚¸ãƒƒã‚¯ï¼ˆãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆæ•´å½¢ï¼Œãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ï¼Œãƒšãƒ¼ã‚¸ã®ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ï¼Œã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ï¼Œã‚¤ãƒ™ãƒ³ãƒˆç™ºç«ãªã©ï¼‰ã‚„ï¼Œãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ï¼ˆâ€»æ§ãˆã‚ã«ï¼‰ã‚’è¨˜è¿°ã™ã‚‹ï¼scriptã‚¿ã‚°ã«ã‚ˆã£ã¦ï¼ŒJavaScriptãŒçµ„ã¿è¾¼ã¾ã‚Œã¦ã„ã‚‹ï¼ Modelå±¤ï¼ˆstore.jsã¾ãŸã¯xxx.js) ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ã‚„ï¼Œajaxãƒ¡ã‚½ãƒƒãƒ‰ã«ã‚ˆã‚‹ãƒ‡ãƒ¼ã‚¿é€å—ä¿¡ï¼Œã‚’è¨˜è¿°ã™ã‚‹ï¼ ãƒ»Vueã‚’ç”¨ã„ãŸMVVMã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ï¼ŒåŒæ–¹å‘ãƒ‡ãƒ¼ã‚¿ãƒã‚¤ãƒ³ãƒ‡ã‚£ãƒ³ã‚° Vueã¯ï¼Œã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®è¨­è¨ˆã«MVVMã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã‚’ç”¨ã„ã‚‹ã“ã¨ã‚’å‰æã¨ã—ã¦ï¼ŒåŒæ–¹å‘ãƒ‡ãƒ¼ã‚¿ãƒã‚¤ãƒ³ãƒ‡ã‚£ãƒ³ã‚°ã‚’å®Ÿç¾ã§ãã‚‹ã‚ˆã†ãªæ©Ÿèƒ½ã‚’æä¾›ã™ã‚‹ï¼ Viewå±¤ã§ã¯ï¼Œxxx.htmlï¼Œ/xxx.twigï¼Œxxx-component.vueã®templateã‚¿ã‚°éƒ¨åˆ†ï¼‰ ViewModelå±¤ã§ã¯ï¼Œindex.jsï¼Œxxx-component.vueã®scriptã‚¿ã‚°éƒ¨åˆ† Modelå±¤ã§ã¯ï¼ŒVuexï¼ˆstore.js)ã‚„JavaScriptã‹ã‚‰ãªã‚‹ãƒ¢ãƒ‡ãƒ«ï¼ˆxxx.jsï¼‰ã‚’è¨­ç½®ã™ã‚‹ï¼ ã“ã‚Œã®å…ƒï¼ŒåŒæ–¹å‘ãƒ‡ãƒ¼ã‚¿ãƒã‚¤ãƒ³ãƒ‡ã‚£ãƒ³ã‚°ãŒå®Ÿç¾ã•ã‚Œã‚‹ä»•çµ„ã¿ã¨ã—ã¦ï¼ŒViewå±¤ã§ã‚¤ãƒ™ãƒ³ãƒˆãŒèµ·ã“ã‚‹ã¨ï¼ŒViewModelå±¤ã§ã“ã‚Œã«ãƒã‚¤ãƒ³ãƒ‡ã‚£ãƒ³ã‚°ã•ã‚ŒãŸã‚¤ãƒ™ãƒ³ãƒˆãƒãƒ³ãƒ‰ãƒ©é–¢æ•°ãŒã‚³ãƒ¼ãƒ«ã•ã‚Œã‚‹ï¼ è¦ªå­ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆé–“ã®ãƒ‡ãƒ¼ã‚¿æ¸¡ã— ãƒ»è¦ªå­ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆé–“ã®ãƒ‡ãƒ¼ã‚¿æ¸¡ã—ã®ä»•çµ„ã¿ï¼ˆProps Down, Events Upï¼‰ ã¾ãšï¼ŒåŒæ–¹å‘ãƒ‡ãƒ¼ã‚¿ãƒã‚¤ãƒ³ãƒ‡ã‚£ãƒ³ã‚°ã¨ã¯ç•°ãªã‚‹æ¦‚å¿µãªã®ã§ï¼Œæ··ä¹±ã—ãªã„ã‚ˆã†ã«æ³¨æ„ã™ã‚‹ï¼ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆï¼ˆxxx-component.vueï¼‰ã®scriptã‚¿ã‚°éƒ¨åˆ†ï¼ˆViewModelå±¤ï¼‰ã®è¦ªå­é–“ã§ã¯ï¼Œpropsã¨$emit()ã‚’ç”¨ã„ã¦ï¼Œãƒ‡ãƒ¼ã‚¿ã‚’æ¸¡ã™ï¼ã“ã®ä»•çµ„ã¿ã‚’ï¼ŒProps Down, Events Upã¨ã„ã†ï¼ MVVMã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã®å®Ÿè£…ä¾‹ (1) ã€Viewå±¤ã€‘ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆï¼ˆxxx.htmlï¼Œxxx.twigï¼‰ ãƒ‡ãƒ¼ã‚¿ãŒï¼Œãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‹ã‚‰JavaScriptãƒ•ã‚¡ã‚¤ãƒ«ã«æ¸¡ã•ã‚Œã‚‹ä»•çµ„ã¿ã¯ï¼Œãƒ•ãƒ¬ãƒ¼ã‚¯ãƒ¯ãƒ¼ã‚¯ã‚’ä½¿ã‚ãªã„å ´åˆã¨åŒã˜ã§ã‚ã‚‹ï¼ãƒ‡ãƒ¼ã‚¿ãŒJavaScriptãƒ•ã‚¡ã‚¤ãƒ«ã«æ¸¡ã•ã‚Œã‚‹çŠ¶æ³ã¨ã—ã¦ã¯ï¼Œã‚¤ãƒ™ãƒ³ãƒˆç™ºç«æ™‚ã§ã‚ã‚‹ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š ä¾‹ãˆã°ï¼Œãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã®è¦ªã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚¿ã‚°ã§ã‚¯ãƒªãƒƒã‚¯ã‚¤ãƒ™ãƒ³ãƒˆãŒç™ºç«ã—ãŸæ™‚ï¼Œè¦ªã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‹ã‚‰ï¼Œã‚¤ãƒ™ãƒ³ãƒˆã«ç´ä»˜ã„ãŸã‚¤ãƒ™ãƒ³ãƒˆãƒãƒ³ãƒ‰ãƒ©é–¢æ•°ãŒã‚³ãƒ¼ãƒ«ã•ã‚Œã‚‹ï¼ (1-2) ã€ViewModelå±¤ã€‘ãƒ‡ãƒ¼ã‚¿ã®åˆæœŸåŒ–ã‚’è¡Œã†Vueã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿é–¢æ•°ï¼ˆindex.jsï¼‰ Vueã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿é–¢æ•°ã‚’ç”¨ã„ã¦ï¼Œã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹åŒ–ã™ã‚‹ã“ã¨ã«ã‚ˆã£ã¦ï¼Œãƒ«ãƒ¼ãƒˆVueã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ãŒç”Ÿæˆã•ã‚Œã‚‹ï¼ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã®å¤‰æ•°åvmã¯VIewModelã®æ„å‘³ã§ã‚ã‚‹ï¼ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹åŒ–æ™‚ï¼Œå…¨ã¦ã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®ãƒ‡ãƒ¼ã‚¿ãŒåˆæœŸåŒ–ã•ã‚Œã‚‹ï¼å„ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã§å€‹åˆ¥ã«çŠ¶æ…‹ã‚’å¤‰åŒ–ã•ã›ãŸã„ã‚‚ã®ã¯ï¼Œpropsã‚ªãƒ—ã‚·ãƒ§ãƒ³ã§ã¯ãªãï¼Œdataã‚ªãƒ—ã‚·ãƒ§ãƒ³ã¨ã—ã¦æ‰±ã†ï¼ å‚è€ƒï¼šhttps://v1-jp.vuejs.org/guide/instance.html ï¼Šå®Ÿè£…ä¾‹ï¼Š // ãƒ«ãƒ¼ãƒˆVueã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ // å¤‰æ•°ã¸ã®æ ¼ç´ã‚’çœç•¥ã—ã¦ã‚‚ã‚ˆã„ var vm = new Vue({ //ã€€Vueã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’ä½¿ç”¨ã™ã‚‹divã‚¿ã‚°ã‚’è¨­å®š. el: \"#app\", /* dataã‚ªãƒ—ã‚·ãƒ§ãƒ³ ãƒ»Vueã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã®ãƒ‡ãƒ¼ã‚¿ã‚’ä¿æŒã™ã‚‹ ãƒ»ç•°ãªã‚‹å ´æ‰€ã«ã‚ã‚‹åŒã˜ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã¯ç•°ãªã‚‹Vueã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‹ã‚‰ãªã‚‹ï¼ ãƒ»ç•°ãªã‚‹Vueã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã¯ç•°ãªã‚‹å€¤ã‚’æŒã¤å¿…è¦ãŒã‚ã‚‹ãŸã‚ï¼Œãƒ¡ã‚½ãƒƒãƒ‰ã¨ã—ã¦å®šç¾©ï¼ */ data: function () { return { isLoading: false, staffData: [], criteria: { id: null, name: null }, }; }, /* methodã‚ªãƒ—ã‚·ãƒ§ãƒ³ ãƒ»Vueã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã®ã‚¢ã‚¯ã‚»ã‚µãƒ¡ã‚½ãƒƒãƒ‰ã‚„çŠ¶æ…‹å¤‰åŒ–ãƒ¡ã‚½ãƒƒãƒ‰ ãƒ»ã‚¤ãƒ™ãƒ³ãƒˆãƒãƒ³ãƒ‰ãƒ©é–¢æ•°ï¼Œdataã‚ªãƒ—ã‚·ãƒ§ãƒ³ã®ã‚»ãƒƒã‚¿ãƒ¼ã‚’å®šç¾© */ method: { // ã‚¤ãƒ™ãƒ³ãƒˆãƒãƒ³ãƒ‰ãƒ©é–¢æ•° changeQuery(criteriaObj) { const keys = [ \"criteria\", \"limit\", ]; for (const key of keys) { if (key in criteriaObj) { this[key] = criteriaObj[key]; } } }, // dataã‚ªãƒ—ã‚·ãƒ§ãƒ³ã®ã‚»ãƒƒã‚¿ãƒ¼ load(query) { // ã“ã“ã§ã®thisã¯dataã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’æŒ‡ã™ï¼ this.isLoading = true; this.staffData = []; // ajaxãƒ¡ã‚½ãƒƒãƒ‰ã‚’ãƒ©ãƒƒãƒ”ãƒ³ã‚°ã—ãŸãƒ¡ã‚½ãƒƒãƒ‰ã‚’ã‚³ãƒ¼ãƒ« return Staff.find(query) /* done() ajaxãƒ¡ã‚½ãƒƒãƒ‰ã«ã‚ˆã£ã¦è¿”å´ã•ã‚ŒãŸJSONãŒå¼•æ•°ã«ãªã‚‹ï¼ */ .done((data) => { /* ã‚µãƒ¼ãƒã‚µã‚¤ãƒ‰ã‹ã‚‰ã®JSONã‚’ãƒ‡ã‚·ãƒªã‚¢ãƒ©ã‚¤ã‚ºï¼ dataã‚ªãƒ—ã‚·ãƒ§ãƒ³ã«è¨­å®šï¼ */ this.staffData = _.map( data.staffData, Staff.deserializeStaff ); }) }, }, /* watchã‚ªãƒ—ã‚·ãƒ§ãƒ³ ãƒ»Vueã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹å†…ã®å€¤ã®å¤‰åŒ–ã‚’ç›£è¦–ã™ã‚‹é–¢æ•°ã‚’å®šç¾©ï¼ ãƒ»Vue-Routerã‚’å‚ç…§ã›ã‚ˆï¼ */ watch: {}, // ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã¨è¦ªã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®å¯¾å¿œã«ãªã‚‹ã‚ˆã†ã«ã™ã‚‹ï¼ component: { //ã€HTMLã§ã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®ã‚¿ã‚°åï¼šå­ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã€ \"v-foo-component-1\": require(\".../component/xxx-1.vue\"), \"v-foo-component-2\": require(\".../component/xxx-2.vue\"), \"v-foo-component-3\": require(\".../component/xxx-3.vue\") }, }) (2) ã€View + ViewModelå±¤ã€‘å˜ä¸€ãƒ•ã‚¡ã‚¤ãƒ«ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã¨ã—ã¦ã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆï¼ˆxxx-component.vueï¼‰ ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã¯ï¼ŒViewå±¤ã¨ã—ã¦ã®templateã‚¿ã‚°ï¼ŒViewModelå±¤ã¨ã—ã¦ã®scriptã‚¿ã‚°ã¨styleã‚¿ã‚°ã‚’ç”¨ã„ã¦ï¼Œå˜ä¸€ãƒ•ã‚¡ã‚¤ãƒ«ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã¨ã™ã‚‹ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š ä¾‹ãˆã°ï¼Œè¦ªã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®å­ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚¿ã‚°ã§ã‚¯ãƒªãƒƒã‚¯ã‚¤ãƒ™ãƒ³ãƒˆãŒç™ºç«ã—ãŸæ™‚ï¼Œå­ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‹ã‚‰ï¼Œã‚¤ãƒ™ãƒ³ãƒˆã«ç´ä»˜ã„ãŸã‚¤ãƒ™ãƒ³ãƒˆãƒãƒ³ãƒ‰ãƒ©é–¢æ•°ãŒã‚³ãƒ¼ãƒ«ã•ã‚Œã‚‹ï¼ //============= // ViewModelå±¤ //============= // è¦ªã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆä»¥é™ã§ã¯ï¼ŒVueã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’ç”Ÿæˆã—ãªã„ã‚ˆã†ã«ã™ã‚‹ï¼ module.exports = { /* propsã‚ªãƒ—ã‚·ãƒ§ãƒ³ ãƒ»è¦ªã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã¾ãŸã¯ajaxãƒ¡ã‚½ãƒƒãƒ‰ã‹ã‚‰propsã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã«å€¤ãŒæ ¼ç´ã•ã‚Œã‚‹ï¼ */ props: { \"criteria\": { type: Object, required: true, }, \"foo\": { type: Object, required: true, } }, /* dataã‚ªãƒ—ã‚·ãƒ§ãƒ³ ãƒ»ç•°ãªã‚‹å ´æ‰€ã«ã‚ã‚‹åŒã˜ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã¯ç•°ãªã‚‹Vueã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‹ã‚‰ãªã‚‹ï¼ ãƒ»ç•°ãªã‚‹Vueã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã¯ç•°ãªã‚‹å€¤ã‚’æŒã¤å¿…è¦ãŒã‚ã‚‹ãŸã‚ï¼Œãƒ¡ã‚½ãƒƒãƒ‰ã¨ã—ã¦å®šç¾©ã™ã‚‹ï¼ */ data: function () { return { a: \"a\", b: \"b\", c: \"c\", d: \"d\", }; }, // ã‚¤ãƒ™ãƒ³ãƒˆãƒãƒ³ãƒ‰ãƒ©é–¢æ•°ï¼Œdataã‚ªãƒ—ã‚·ãƒ§ãƒ³ã®ã‚»ãƒƒã‚¿ãƒ¼ method: { updateCriteria(key, value) { /* ãƒ»ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆï¼ˆv-foo-component-1ï¼‰ã¨ç´ä»˜ãå‡¦ç† ãƒ»changeã‚¤ãƒ™ãƒ³ãƒˆã®ç™ºç«ã¨ï¼Œã“ã‚Œã®ã‚¤ãƒ™ãƒ³ãƒˆãƒãƒ³ãƒ‰ãƒ©é–¢æ•°ã«å¼•æ•°ã‚’æ¸¡ã™ï¼ */ this.$emit( \"change\", {\"criteria\": localCriteria} ); }, // ajaxãƒ¡ã‚½ãƒƒãƒ‰ã‹ã‚‰é€ä¿¡ã•ã‚Œã¦ããŸãƒ‡ãƒ¼ã‚¿ã‚’ç”¨ã„ã¦ï¼Œpropsã‚’æ›´æ–° updateProps(key, value) { }, // ã€HTMLã§ã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®ã‚¿ã‚°åï¼šã€€JSã§ã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆåã€ component: { // å­ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã¨å­«ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®å¯¾å¿œé–¢ä¿‚ \"v-foo-component-4\": require(\"./xxx/xxx/xxx-4\"), \"v-foo-component-5\": require(\"./xxx/xxx/xxx-5\"), }, } } (3) ã€Modelå±¤ã€‘ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã¨ã—ã¦ã®Vuexï¼ˆstore.jsï¼‰ Vuexã«ã¤ã„ã¦ã¯ï¼Œä»¥é™ã®èª¬æ˜ã‚’å‚ç…§ã›ã‚ˆï¼ (3-2) ã€Modelå±¤ã€‘ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã¨ã—ã¦ã®JavaScriptï¼ˆxxx.jsï¼‰ ã‚¯ãƒ©ã‚¹å®£è¨€ã§å®Ÿè£…ã™ã‚‹ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š class Foo { /* ãƒ»ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‹ã‚‰ãƒ‡ãƒ¼ã‚¿ã‚’å—ä¿¡ï¼ ãƒ»ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã®å®£è¨€ã¨ï¼ŒåŒæ™‚ã«æ ¼ç´ï¼ */ constructor(properties) { this.isOk = properties.isOk; } // ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ã«ã‚ˆã£ã¦å®£è¨€ã•ã‚Œã¦ã„ã‚‹ã®ã§ï¼Œã‚¢ã‚¯ã‚»ã‚¹ã§ãã‚‹ï¼ isOk() { // boolå€¤ã‚’è¿”å´ã™ã‚‹ã¨ã™ã‚‹ï¼ return this.isOk; } } 01-02. Viewå±¤ã¨ViewModelå±¤ã®é–“ã§ã®åŒæ–¹å‘ãƒ‡ãƒ¼ã‚¿ãƒã‚¤ãƒ³ãƒ‡ã‚£ãƒ³ã‚°ã®æ–¹æ³• ã‚¤ãƒ™ãƒ³ãƒˆãƒãƒ³ãƒ‰ãƒªãƒ³ã‚° ãƒ»v-on:ã¨ã¯ Viewå±¤ï¼ˆtemplateã‚¿ã‚°éƒ¨åˆ†ï¼‰ã®ã‚¤ãƒ™ãƒ³ãƒˆã‚’ï¼ŒViewModelå±¤ï¼ˆscriptã‚¿ã‚°éƒ¨åˆ†ï¼‰ã®ã‚¤ãƒ™ãƒ³ãƒˆãƒãƒ³ãƒ‰ãƒ©é–¢æ•°ï¼ˆmethods:å†…ã«ã‚ã‚‹ãƒ¡ã‚½ãƒƒãƒ‰ï¼‰ã‚„ã‚¤ãƒ³ãƒ©ã‚¤ãƒ³JSã‚¹ãƒ†ãƒ¼ãƒˆãƒ¡ãƒ³ãƒˆã«ãƒã‚¤ãƒ³ãƒ‡ã‚£ãƒ³ã‚°ã—ï¼Œã‚¤ãƒ™ãƒ³ãƒˆãŒç™ºç«ã—ãŸæ™‚ç‚¹ã§ã‚¤ãƒ™ãƒ³ãƒˆãƒãƒ³ãƒ‰ãƒ©é–¢æ•°ã‚’ã‚³ãƒ¼ãƒ«ã™ã‚‹ï¼ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®scriptã‚¿ã‚°éƒ¨åˆ†ï¼ˆViewModelå±¤ï¼‰ã®è¦ªå­é–“ãƒ‡ãƒ¼ã‚¿æ¸¡ã—ã§ã‚ã‚‹ã€ŒProps Down, Events Upã€ã¨ã¯ç•°ãªã‚‹æ¦‚å¿µãªã®ã§æ³¨æ„ã™ã‚‹ï¼ v-on:{ã‚¤ãƒ™ãƒ³ãƒˆå}=\"{ã‚¤ãƒ™ãƒ³ãƒˆãƒãƒ³ãƒ‰ãƒ©é–¢æ•°ï¼ˆmethods: å†…ã«ã‚ã‚‹ãƒ¡ã‚½ãƒƒãƒ‰ï¼‰}\" ã¾ãŸã¯ï¼Œçœç•¥ã—ã¦ï¼Œ @:{ã‚¤ãƒ™ãƒ³ãƒˆå}=\"\" ã§è¨˜è¿°ã™ã‚‹ï¼ ãƒ»v-on:submit=\"\"ï¼Œbuttonã‚¿ã‚° Viewå±¤ã®ãƒ•ã‚©ãƒ¼ãƒ é€ä¿¡ã‚¤ãƒ™ãƒ³ãƒˆãŒèµ·ããŸæ™‚ç‚¹ã§ï¼ŒViewModelå±¤ã«ãƒã‚¤ãƒ³ãƒ‡ã‚£ãƒ³ã‚°ã•ã‚ŒãŸã‚¤ãƒ™ãƒ³ãƒˆãƒãƒ³ãƒ‰ãƒ©é–¢æ•°ã‚’ã‚³ãƒ¼ãƒ«ã™ã‚‹ï¼ä¾‹ãˆã°ï¼Œè¦ªã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã§ã¯ï¼Œå­ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã«ã‚ˆã£ã¦ç™ºç«ã•ã›ã‚‰ã‚Œã‚‹searchã‚¤ãƒ™ãƒ³ãƒˆã«å¯¾ã—ã¦ï¼Œresult()ã¨ã„ã†ã‚¤ãƒ™ãƒ³ãƒˆãƒãƒ³ãƒ‰ãƒ©é–¢æ•°ã‚’ç´ä»˜ã‘ã¦ãŠãï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š index.jsã®methods:å†…ã«ã¯ï¼Œã‚¤ãƒ™ãƒ³ãƒˆãƒãƒ³ãƒ‰ãƒ©é–¢æ•°ã¨ã—ã¦result()ã‚’å®šç¾©ã™ã‚‹ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š // å¤‰æ•°ã¸ã®æ ¼ç´ã‚’çœç•¥ã—ã¦ã‚‚ã‚ˆã„ var vm = new Vue({ //ã€€Vueã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’ä½¿ç”¨ã™ã‚‹divã‚¿ã‚°ã‚’è¨­å®š. el: \"#app\", // ã‚¤ãƒ™ãƒ³ãƒˆãƒãƒ³ãƒ‰ãƒ©é–¢æ•° method: { result() { // ä½•ã‚‰ã‹ã®å‡¦ç† } } }) ã€æ¤œç´¢ãƒœã‚¿ãƒ³ã‚’æŠ¼ã™ã€ã¨ã„ã†submitã‚¤ãƒ™ãƒ³ãƒˆã®ç™ºç«ã«ã‚ˆã£ã¦ï¼Œformã‚¿ã‚°ã§ã‚¤ãƒ™ãƒ³ãƒˆã«ç´ä»˜ã‘ã‚‰ã‚Œã¦ã„ã‚‹ã‚¤ãƒ™ãƒ³ãƒˆãƒãƒ³ãƒ‰ãƒ©é–¢æ•°ï¼ˆsearch()ï¼‰ãŒã‚³ãƒ¼ãƒ«ã•ã‚Œã‚‹ï¼ ã‚¤ãƒ™ãƒ³ãƒˆãƒãƒ³ãƒ‰ãƒ©é–¢æ•°å†…ã®emit()ãŒï¼Œè¦ªã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®searchã‚¤ãƒ™ãƒ³ãƒˆã‚’ç™ºç«ã•ã›ã‚‹ï¼ã“ã‚Œã«ç´ä»˜ãã‚¤ãƒ™ãƒ³ãƒˆãƒãƒ³ãƒ‰ãƒ©é–¢æ•°ï¼ˆresult()ï¼‰ ãŒã‚³ãƒ¼ãƒ«ã•ã‚Œã‚‹ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š æ¤œç´¢ã™ã‚‹ // å¤‰æ•°ã¸ã®æ ¼ç´ã‚’çœç•¥ã—ã¦ã‚‚ã‚ˆã„ var vm = new Vue({ // ã‚¤ãƒ™ãƒ³ãƒˆãƒãƒ³ãƒ‰ãƒ©é–¢æ•°ã‚’å®šç¾© methods: { search() { // è¦ªã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®searchã‚¤ãƒ™ãƒ³ãƒˆã‚’ç™ºç«ã•ã›ã‚‹ï¼ this.$emit(\"search\") }, } }) ãƒ»v-on:click=\"\" Viewå±¤ã§ã‚¯ãƒªãƒƒã‚¯ã‚¤ãƒ™ãƒ³ãƒˆãŒèµ·ããŸæ™‚ç‚¹ã§ç™ºç«ã—ï¼ŒViewModelå±¤ã§ãƒã‚¤ãƒ³ãƒ‡ã‚£ãƒ³ã‚°ã•ã‚ŒãŸã‚¤ãƒ™ãƒ³ãƒˆãƒãƒ³ãƒ‰ãƒ©é–¢æ•°ã‚’ã‚³ãƒ¼ãƒ«ã™ã‚‹ï¼ ãƒ»v-on:change=\"\" Viewå±¤ã§inputã‚¿ã‚°ã‚„selectã‚¿ã‚°ã§ï¼Œå€¤ã®å…¥åŠ›å¾Œã«ãƒã‚¦ã‚¹ãƒ•ã‚©ãƒ¼ã‚«ã‚¹ãŒã‚¿ã‚°ã‹ã‚‰å¤–ã‚ŒãŸæ™‚ç‚¹ã§ç™ºç«ã—ï¼ŒViewModelå±¤ã§ãƒã‚¤ãƒ³ãƒ‡ã‚£ãƒ³ã‚°ã•ã‚ŒãŸã‚¤ãƒ™ãƒ³ãƒˆãƒãƒ³ãƒ‰ãƒ©é–¢æ•°ã‚’ã‚³ãƒ¼ãƒ«ã™ã‚‹ ãƒ»v-on:input=\"\" Viewå±¤ã§inputã‚¿ã‚°ã§ï¼Œä¸€æ–‡å­—ã§ã‚‚å€¤ãŒå…¥åŠ›ã•ã‚ŒãŸæ™‚ç‚¹ã§ç™ºç«ã—ï¼ŒViewModelå±¤ãƒã‚¤ãƒ³ãƒ‡ã‚£ãƒ³ã‚°ã•ã‚ŒãŸã‚¤ãƒ™ãƒ³ãƒˆãƒãƒ³ãƒ‰ãƒ©é–¢æ•°ã‚’ã‚³ãƒ¼ãƒ«ã™ã‚‹ï¼v-on:changeã¨ã¯ï¼Œã‚¤ãƒ™ãƒ³ãƒˆãŒç™ºç«ã™ã‚‹ã‚¿ã‚¤ãƒŸãƒ³ã‚°ãŒç•°ãªã‚‹ãŸã‚ï¼Œå…±å­˜ã™ã‚‹ã“ã¨ãŒå¯èƒ½ã§ã‚ã‚‹ï¼ æ¡ä»¶ä»˜ããƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚° ãƒ»v-showï¼v-ifã¨ã¯ æ¡ä»¶åˆ†å²ã‚’è¡Œã†ã‚¿ã‚°ã§ã‚ã‚Šï¼Œv-showã¾ãŸã¯v-ifã‚’ä½¿ç”¨ã—ã¦ï¼Œãƒ—ãƒ­ãƒ‘ãƒ†ã‚£åã‚’æŒ‡å®šã™ã‚‹ï¼ï¼ˆv-xxx=\"\"ï¼‰ã§è¨˜è¿°ã™ã‚‹ï¼è¦ªãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‹ã‚‰æ¸¡ã•ã‚ŒãŸpropså†…ã®ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£åãŒã‚‚ã¤å€¤ãŒTRUEã®æ™‚ã«è¡¨ç¤ºã—ï¼ŒFALSEã®æ™‚ã«éè¡¨ç¤ºã«ã™ã‚‹ï¼ã‚‚ã—é »ç¹ã«è¡¨ç¤ºã¨éè¡¨ç¤ºã®åˆ‡ã‚Šæ›¿ãˆã‚’è¡Œã†ã‚ˆã†ãªã‚‰ï¼Œv-ifã®æ–¹ãŒï¼Œæç”»ã‚³ã‚¹ãƒˆãŒé‡ãŸããªã‚‹ãƒªã‚¹ã‚¯ãŒé«˜ããªã‚‹ç‚ºï¼Œv-showæ¨å¥¨ã§ã‚ã‚‹ï¼ ã‚¿ã‚° ä½¿ã„åˆ†ã‘ v-if å˜ç™ºã®åˆ‡ã‚Šæ›¿ãˆãŒãƒ¡ã‚¤ãƒ³ã®å ´åˆ v-show è¡¨ç¤º/éè¡¨ç¤ºã®åˆ‡æ›¿å›æ•°ãŒå¤šã„å ´åˆ å±æ€§ãƒ‡ãƒ¼ã‚¿ãƒã‚¤ãƒ³ãƒ‡ã‚£ãƒ³ã‚° ãƒ»v-bindã¨ã¯ â€»è¦å‹‰å¼· ãƒ•ã‚©ãƒ¼ãƒ å…¥åŠ›ãƒ‡ãƒ¼ã‚¿ãƒã‚¤ãƒ³ãƒ‡ã‚£ãƒ³ã‚° ãƒ»v-modelã¨ã¯ å®Ÿè£…æ–¹æ³•ã¯ï¼Œv-on:input=\"\"ã¨åŒã˜ã§ã‚ã‚‹ï¼ä¾‹ãˆã°ï¼Œä»¥ä¸‹ã®äºŒã¤ã¯åŒã˜ã§ã‚ã‚‹ï¼ ãã®ä»–ã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒ†ã‚£ãƒ– ãƒ»v-cloakã¨ã¯ â€»è¦å‹‰å¼· 01-03. ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®ç™»éŒ²æ–¹æ³• ãƒ»ã‚°ãƒ­ãƒ¼ãƒãƒ«ç™»éŒ² ï¼Šå®Ÿè£…ä¾‹ï¼Š Vue.component(\"v-foo-component\", { template: require(\"./xxx/xxx/xxx\") }); // å¤‰æ•°ã¸ã®æ ¼ç´ã‚’çœç•¥ã—ã¦ã‚‚ã‚ˆã„ var vm = new Vue({ el: \"#app\" }) ãƒ»ãƒ­ãƒ¼ã‚«ãƒ«ç™»éŒ² ï¼Šå®Ÿè£…ä¾‹ï¼Š var vFooComponent = { // ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã¨è¦ªã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®å¯¾å¿œé–¢ä¿‚ template: require(\"./xxx/xxx/xxx\"), }; // å¤‰æ•°ã¸ã®æ ¼ç´ã‚’çœç•¥ã—ã¦ã‚‚ã‚ˆã„ var vm = new Vue({ el: \"#app\", components: { // è¦ªã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã«ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆåã‚’ã¤ã‘ã‚‹ï¼ \"v-foo-component\": vFooComponent } }) ãŸã ã—ï¼Œã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆåã®å®šç¾©ã¯ï¼Œä»¥ä¸‹ã®ã‚ˆã†ã«çœç•¥ã§ãã‚‹ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š // å¤‰æ•°ã¸ã®æ ¼ç´ã‚’çœç•¥ã—ã¦ã‚‚ã‚ˆã„ var vm = new Vue({ el: \"#app\", components: { // ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã¨è¦ªã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®å¯¾å¿œé–¢ä¿‚ \"v-foo-component\": require(\"./xxx/xxx/xxx\"), } }) 02. Vue-Routerãƒ©ã‚¤ãƒ–ãƒ©ãƒªã«ã‚ˆã‚‹ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚° Vue-Router ãƒ»Vue-Routerã¨ã¯ ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®ä¸€ã¤ï¼ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã«å¯¾ã—ã¦ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã‚’è¡Œã„ï¼Œ//ã«å¿œã˜ã¦ï¼Œã‚³ãƒ¼ãƒ«ã™ã‚‹ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’å‹•çš„ã«åˆ‡ã‚Šæ›¿ãˆã‚‹ã“ã¨ãŒã§ãã‚‹ï¼ GET http://www.example.co.jp:80//?text1=a&text2=b HTTP/2 ï¼Šå®Ÿè£…ä¾‹ï¼Š // Vue-Routerãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’èª­ã¿è¾¼ã‚€ï¼ const vueRouter = require(\"vue-router\").default; // VueRouterã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’ä½œæˆã™ã‚‹ï¼ const router = new VueRouter({ routes: [ {path: \"/\", component: Home}, {path: \"/foo\", component: Foo} ] }) // å¤–éƒ¨ãƒ•ã‚¡ã‚¤ãƒ«ãŒï¼ŒVueRouterã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’èª­ã¿è¾¼ã‚ã‚‹ã‚ˆã†ã«ã—ã¦ãŠãï¼ module.exports = router; ã¾ãŸï¼ŒVue-Routerã®æ©Ÿèƒ½ã‚’åˆ©ç”¨ã™ã‚‹ãŸã‚ã«ï¼Œrouterã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’ãƒ«ãƒ¼ãƒˆã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã«æ³¨å…¥ã™ã‚‹å¿…è¦ãŒã‚ã‚‹ï¼ import router from \"./router\" // å¤‰æ•°ã¸ã®æ ¼ç´ã‚’çœç•¥ã—ã¦ã‚‚ã‚ˆã„ var vm = new Vue({ // routerã‚ªãƒ—ã‚·ãƒ§ãƒ³ router, // watchã‚ªãƒ—ã‚·ãƒ§ãƒ³ watch: { // ã‚¹ã‚¿ãƒƒã‚¯å†…ã§å±¥æ­´ã®ç§»å‹•ãŒèµ·ã“ã£ãŸæ™‚ã«ï¼Œå¯¾å¿œä»˜ã‘ãŸç„¡åé–¢æ•°ã‚’å®Ÿè¡Œï¼ \"$route\": function (to, from) { if (to.fullPath !== from.fullPath) { // ä½•ã‚‰ã‹ã®å‡¦ç†ï¼ } }, } }) ãƒ»$routerï¼ˆRouterã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ï¼‰ Webã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å…¨ä½“ã«1ã¤å­˜åœ¨ã—ï¼Œå…¨ä½“çš„ãªRouteræ©Ÿèƒ½ã‚’ç®¡ç†ã—ã¦ã„ã‚‹ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ï¼ã‚¹ã‚¿ãƒƒã‚¯å‹ã§å±¥æ­´ã‚’ä¿æŒã—ï¼Œå±¥æ­´ã‚’è¡Œãæ¥ã™ã‚‹ã“ã¨ã§ï¼Œãƒšãƒ¼ã‚¸é·ç§»ã‚’è¡Œã†ï¼ ãƒ¡ã‚½ãƒƒãƒ‰ èª¬æ˜ push queryã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’å¼•æ•°ã¨ã™ã‚‹ï¼å±¥æ­´ã‚¹ã‚¿ãƒƒã‚¯å†…ã«æ–°ã—ã„å±¥æ­´ã‚’è¿½åŠ ã—ï¼Œç¾åœ¨ã‚’ãã®å±¥æ­´ã¨ã™ã‚‹ï¼ã¾ãŸï¼Œãƒ–ãƒ©ã‚¦ã‚¶ã®æˆ»ã‚‹æ“ä½œã§ï¼Œå±¥æ­´ã‚¹ã‚¿ãƒƒã‚¯å†…ã®ä¸€ã¤å‰ã®å±¥æ­´ã«ç§»å‹•ã™ã‚‹ï¼ å‚è€ƒï¼šhttps://router.vuejs.org/guide/essentials/navigation.html ï¼Šå®Ÿè£…ä¾‹ï¼Š // users/?foo=xyz ãŒå±¥æ­´ã‚¹ã‚¿ãƒƒã‚¯ã«è¿½åŠ ã•ã‚Œã‚‹ï¼ this.$router.push({ path : \"/users\", query: { foo : \"xyz\" }}); ãƒ»$routeï¼ˆRouteã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆï¼‰ ç¾åœ¨ã®ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãªãƒ«ãƒ¼ãƒˆã‚’æŒã¤ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ ãƒ‡ãƒ¼ã‚¿å‹ èª¬æ˜ æ³¨æ„ path string ç¾åœ¨ã®ãƒ«ãƒ¼ãƒˆã®æ–‡å­—åˆ—ï¼ query Object ã‚¯ã‚¨ãƒªãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã®ã‚­ãƒ¼åã¨å€¤ã‚’ä¿æŒã™ã‚‹ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆï¼/foo?user=1ã¨ã„ã†ã‚¯ã‚¨ãƒªãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã®å ´åˆï¼Œ$route.query.user==1ã¨ãªã‚‹ï¼ ã‚‚ã—ã‚¯ã‚¨ãƒªãƒ¼ãŒãªã„å ´åˆã¯ï¼Œç©ºã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ fullPath string URLå…¨ä½“ã®æ–‡å­—åˆ—ï¼ ãã®ä»–ã®Routerãƒ©ã‚¤ãƒ–ãƒ©ãƒª JQueryã«ã¯JQueryRouterï¼ŒReactã«ã¯React-RouterãŒã‚ã‚‹ï¼ 03. Vuexãƒ©ã‚¤ãƒ–ãƒ©ãƒªã«ã‚ˆã‚‹ãƒ‡ãƒ¼ã‚¿ã®çŠ¶æ…‹å¤‰åŒ–ã®ç®¡ç† Vuex ãƒ»Vuexã¨ã¯ Vuejsã§ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®ä¸€ã¤ã§ï¼ŒMVVMã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã®ãƒ¢ãƒ‡ãƒ«ã«ç›¸å½“ã™ã‚‹æ©Ÿèƒ½ã‚’æä¾›ã—ï¼Œã‚°ãƒ­ãƒ¼ãƒãƒ«ã§å‚ç…§ã§ãã‚‹ï¼ç•°ãªã‚‹ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã§å…±é€šã—ãŸãƒ‡ãƒ¼ã‚¿ã‚’æ‰±ã„ãŸãã¨ã‚‚ï¼ŒåŒæ–¹å‘ãƒ‡ãƒ¼ã‚¿ãƒã‚¤ãƒ³ãƒ‡ã‚£ãƒ³ã‚°ã§ã¯ï¼Œè¦ªå­ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆé–“ã§ã—ã‹ï¼Œãƒ‡ãƒ¼ã‚¿ã‚’å—ã‘æ¸¡ã—ã§ããªã„ï¼ã—ã‹ã—ï¼ŒVuexã‚¹ãƒˆã‚¢å†…ã§ï¼Œãƒ‡ãƒ¼ã‚¿ã®çŠ¶æ…‹ã®å¤‰åŒ–ã‚’ç®¡ç†ã™ã‚‹ã“ã¨ã«ã‚ˆã£ã¦ï¼Œè¦ªå­é–¢ä¿‚ãªãï¼Œå…¨ã¦ã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆé–“ã§ãƒ‡ãƒ¼ã‚¿ã‚’å—ã‘æ¸¡ã—ã§ãã‚‹ã‚ˆã†ã«ãªã‚‹ï¼ â€»Vuexã‹ã‚‰ãªã‚‹ãƒ¢ãƒ‡ãƒ«ã¯ã©ã†ã‚ã‚‹ã¹ãã‹ï¼Œã«ã¤ã„ã¦è¦å‹‰å¼· Vuex.Store()ã«ã‚ˆã‚‹Vuexã‚¹ãƒˆã‚¢ã®å®Ÿè£… å¤–éƒ¨ã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã¯ï¼Œå„ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã«ã‚¢ã‚¯ã‚»ã‚¹ã§ãã‚‹ï¼ ãƒ»getters:{} ãƒ‡ãƒ¼ã‚¿ã‹ã‚‰çŠ¶æ…‹ã‚’å–å¾—ã™ã‚‹ãƒ¡ã‚½ãƒƒãƒ‰ã‚’ã„ãã¤ã‹æŒã¤ï¼ã‚¯ãƒ©ã‚¹ãƒ™ãƒ¼ã‚¹ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆæŒ‡å‘ã§ã„ã†ã¨ã“ã‚ã®ï¼ŒGetterãƒ¡ã‚½ãƒƒãƒ‰ã«ç›¸å½“ã™ã‚‹ï¼ â€»MVVMã«ãŠã„ã¦ï¼Œãƒ¢ãƒ‡ãƒ«ã«ã‚²ãƒƒã‚¿ãƒ¼ã‚’æŒãŸã›ã¦ã¯ã„ã‘ãªã„ã¨ã„ã†ãƒ«ãƒ¼ãƒ«ã«ã¤ã„ã¦ã¯ï¼Œè¦å‹‰å¼·ï¼ ãƒ»state:{} ãƒ‡ãƒ¼ã‚¿ã®çŠ¶æ…‹ã®å¤‰åŒ–ã‚’ã„ãã¤ã‹ç®¡ç†ã™ã‚‹ï¼ã‚¯ãƒ©ã‚¹ãƒ™ãƒ¼ã‚¹ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆæŒ‡å‘ã§ã„ã†ã¨ã“ã‚ã®ï¼Œãƒ‡ãƒ¼ã‚¿ï¼ˆãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ï¼‰ã«ç›¸å½“ã™ã‚‹ï¼ ãƒ»mutations:{} ãƒ‡ãƒ¼ã‚¿ã«çŠ¶æ…‹ï¼ˆstateï¼‰ã‚’è¨­å®šã™ã‚‹ãƒ¡ã‚½ãƒƒãƒ‰ã‚’ã„ãã¤ã‹æŒã¤ï¼ä¿å®ˆæ€§ã®è¦³ç‚¹ã‹ã‚‰ï¼Œmutations:{}ã«ãŠããƒ¡ã‚½ãƒƒãƒ‰é–“ã¯åŒæœŸçš„ã«å®Ÿè¡Œã•ã‚Œã‚‹ã‚ˆã†ã«ã—ã¦ãŠã‹ãªã‘ã‚Œã°ãªã‚‰ãªã„ï¼ã‚¯ãƒ©ã‚¹ãƒ™ãƒ¼ã‚¹ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆæŒ‡å‘ã§ã„ã†ã¨ã“ã‚ã®ï¼ŒSetterãƒ¡ã‚½ãƒƒãƒ‰ã«ç›¸å½“ã™ã‚‹ï¼ ãƒ»actions:{} å®šç¾©ã•ã‚ŒãŸmutations{}ã®ãƒ¡ã‚½ãƒƒãƒ‰ã‚’é–“æ¥çš„ã«ã‚³ãƒ¼ãƒ«ã™ã‚‹ãŸã‚ã®ãƒ¡ã‚½ãƒƒãƒ‰ã‚’ã„ãã¤ã‹æŒã¤ï¼ã¾ãŸï¼ŒJQueryã®ajaxãƒ¡ã‚½ãƒƒãƒ‰ ã‚’ã‚³ãƒ¼ãƒ«ã—ï¼Œã‚µãƒ¼ãƒãƒ¼å´ã‹ã‚‰ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã•ã‚ŒãŸãƒ‡ãƒ¼ã‚¿ã‚’mutations:{}ã¸æ¸¡ã™ï¼ã‚¯ãƒ©ã‚¹ãƒ™ãƒ¼ã‚¹ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆæŒ‡å‘ã§ã„ã†ã¨ã“ã‚ã®ï¼ŒSetterãƒ¡ã‚½ãƒƒãƒ‰ã«ç›¸å½“ã™ã‚‹ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š // Vuexãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’èª­ã¿è¾¼ã‚€ï¼ const vuex = require(\"vuex\") // å¤–éƒ¨ãƒ•ã‚¡ã‚¤ãƒ«ãŒï¼Œã“ã®Storeã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’èª­ã¿è¾¼ã‚ã‚‹ã‚ˆã†ã«ã™ã‚‹ï¼ module.exports = new Vuex.Store({ /* getters ãƒ»ãƒ‡ãƒ¼ã‚¿ã‹ã‚‰çŠ¶æ…‹ã‚’å–å¾—ã™ã‚‹ãƒ¡ã‚½ãƒƒãƒ‰ã‚’ã„ãã¤ã‹æŒã¤ ãƒ»ã‚¯ãƒ©ã‚¹ãƒ™ãƒ¼ã‚¹ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆæŒ‡å‘ã®Getterãƒ¡ã‚½ãƒƒãƒ‰ã«ç›¸å½“. */ getters: { staffData(state) { return state.staffData; }, }, /* state ãƒ»çŠ¶æ…‹ã®å¤‰åŒ–ã‚’ç®¡ç†ã—ãŸã„ãƒ‡ãƒ¼ã‚¿ã‚’ã„ãã¤ã‹ã‚‚ã¤ï¼ ãƒ»ã‚¯ãƒ©ã‚¹ãƒ™ãƒ¼ã‚¹ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆæŒ‡å‘ã®ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã«ç›¸å½“ï¼ */ state: { // stateã«ã¯å¤šãã‚’è¨­å®šã›ãšï¼ŒVueã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã®dataã‚ªãƒ—ã‚·ãƒ§ãƒ³ã«è¨­å®šã—ã¦ãŠãï¼ staffData: [], }, /* mutations ãƒ»ãƒ‡ãƒ¼ã‚¿ã®çŠ¶æ…‹ï¼ˆstateï¼‰ã‚’å¤‰åŒ–ã•ã›ã‚‹ãƒ¡ã‚½ãƒƒãƒ‰ã‚’ã„ãã¤ã‹ã‚‚ã¤ï¼ ãƒ»ã‚¯ãƒ©ã‚¹ãƒ™ãƒ¼ã‚¹ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆæŒ‡å‘ã®Setterãƒ¡ã‚½ãƒƒãƒ‰ã«ç›¸å½“ï¼ */ mutations: { // Vuexã®stateã‚’ç¬¬ä¸€å¼•æ•°ï¼Œå¤–éƒ¨ã‹ã‚‰ã‚»ãƒƒãƒˆã—ãŸã„å€¤ã‚’ç¬¬äºŒå¼•æ•° mutate(state, staffData) { exArray.forEach( /* ãƒ»çŸ¢å°ã¯ã‚¢ãƒ­ãƒ¼é–¢æ•°ã‚’è¡¨ã—ï¼Œç„¡åé–¢æ•°ã®å³ã‚³ãƒ¼ãƒ«ã‚’çœç•¥ã§ãã‚‹ï¼ ãƒ»å¼•æ•°ã§æ¸¡ã•ã‚ŒãŸexArrayã®è¦ç´ ã‚’ï¼Œstateã®exArrayã«æ ¼ç´ã™ã‚‹ï¼ */ (element) => { state.exArray.push(element); } /* â€»ã‚¢ãƒ­ãƒ¼é–¢æ•°ã‚’ç”¨ã„ãªã‘ã‚Œã°ï¼Œä»¥ä¸‹ã®ã‚ˆã†ã«è¨˜è¿°ã§ãã‚‹ï¼ function(element) { state.exArray.push(element); } */ ); }, }, /* actions ãƒ»mutations{}ã®ãƒ¡ã‚½ãƒƒãƒ‰ã‚’é–“æ¥çš„ã«ã‚³ãƒ¼ãƒ«ã™ã‚‹ãŸã‚ã®ãƒ¡ã‚½ãƒƒãƒ‰ã‚’ã„ãã¤ã‹æŒã¤ï¼ ãƒ»contextã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‹ã‚‰commitæ©Ÿèƒ½ã‚’å–ã‚Šå‡ºã™å¿…è¦ãŒã‚ã‚‹ï¼ï¼ˆâ€»çœç•¥è¨˜æ³•ã‚ã‚Šï¼‰ ãƒ»ã‚¯ãƒ©ã‚¹ãƒ™ãƒ¼ã‚¹ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆæŒ‡å‘ã®Setterãƒ¡ã‚½ãƒƒãƒ‰ã«ç›¸å½“ï¼ */ actions: { // çœç•¥è¨˜æ³•ï¼ˆArgument destructuring) mutate({commit}) { commit(\"mutate\"); } } }) ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‹ã‚‰Vuexã¸ã®ã‚¢ã‚¯ã‚»ã‚¹ ä¾‹ãˆã°ï¼Œå­ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®ãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆtemplateã‚¿ã‚°ã‚’æŒã¤ãƒ•ã‚¡ã‚¤ãƒ«ï¼‰ã®ä¸‹éƒ¨ã«ï¼Œä»¥ä¸‹ã‚’è¨˜è¿°ã™ã‚‹ã“ã¨ã§ï¼ŒVuex.Store()ã¨ãƒ‡ãƒ¼ã‚¿ã‚’å—ã‘æ¸¡ã—ã§ãã‚‹ã‚ˆã†ã«ãªã‚‹ï¼ ãƒ»computed: {} ã‚¤ãƒ™ãƒ³ãƒˆãƒãƒ³ãƒ‰ãƒ©é–¢æ•°ã¨ã—ã¦ï¼ŒmapGettersãƒ˜ãƒ«ãƒ‘ãƒ¼ã¨mapStateãƒ˜ãƒ«ãƒ‘ãƒ¼ã‚’è¨­å®šã™ã‚‹ï¼ ãƒ»methods: {} ã‚¤ãƒ™ãƒ³ãƒˆãƒãƒ³ãƒ‰ãƒ©é–¢æ•°ã¨ã—ã¦ï¼ŒmapMutationsãƒ˜ãƒ«ãƒ‘ãƒ¼ã¨mapActionsãƒ˜ãƒ«ãƒ‘ãƒ¼ã‚’è¨­å®šã™ã‚‹ï¼ ãƒ»mapGettersãƒ˜ãƒ«ãƒ‘ãƒ¼ ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®computed:{}ã«ï¼ŒVuex.Store()ã®getters: {}ã‚’ãƒãƒƒãƒ”ãƒ³ã‚°ã—ï¼Œã‚³ãƒ¼ãƒ«ã§ãã‚‹ã‚ˆã†ã«ã™ã‚‹ï¼ ãƒ»mapStateãƒ˜ãƒ«ãƒ‘ãƒ¼ ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®computed:{}ã«ï¼ŒVuex.Store()ã®state: {}ã‚’ãƒãƒƒãƒ”ãƒ³ã‚°ã—ï¼Œã‚³ãƒ¼ãƒ«ã§ãã‚‹ã‚ˆã†ã«ã™ã‚‹ï¼ ãƒ»mapMutationsãƒ˜ãƒ«ãƒ‘ãƒ¼ ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®methods: {}ã«ï¼ŒVuex.Store()ã®mutations: {}```ã‚’ãƒãƒƒãƒ”ãƒ³ã‚°ã—ï¼Œã‚³ãƒ¼ãƒ«ã§ãã‚‹ã‚ˆã†ã«ã™ã‚‹ï¼ ãƒ»mapActionsãƒ˜ãƒ«ãƒ‘ãƒ¼ ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®methods: {}ã«ï¼ŒVuex.Store()ã®actions:{}ã‚’ãƒãƒƒãƒ”ãƒ³ã‚°ã—ï¼Œã‚³ãƒ¼ãƒ«ã§ãã‚‹ã‚ˆã†ã«ã™ã‚‹ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š ... // Vuex.Store()ã‚’èª­ã¿è¾¼ã‚€ï¼ const store = require(\"./_store\") // Vuex.Store()ã®gettersï¼Œmutationsï¼Œactionsã‚’ãƒãƒƒãƒ”ãƒ³ã‚°ã§ãã‚‹ã‚ˆã†ã«èª­ã¿è¾¼ã‚€ï¼ const mapGetters = require(\"vuex\").mapGetters; const mapActions = require(\"vuex\").mapActions; const mapMutaions = require(\"vuex\").mapMutaions; module.exports = { // ã‚¤ãƒ™ãƒ³ãƒˆãƒãƒ³ãƒ‰ãƒ©é–¢æ•°ã‚’å®šç¾©ï¼ˆâ€»ãƒ‡ãƒ¼ã‚¿ã‚’çŠ¶æ…‹ã®å¤‰æ›´ã‚’ä¿æŒã—ãŸããªã„ã‚‚ã®ï¼‰ computed: { /* mapGettersãƒ˜ãƒ«ãƒ‘ãƒ¼ï¼ Storeã®Getterã‚’ãƒ­ãƒ¼ã‚«ãƒ«ã®computed:{}ã«ãƒãƒƒãƒ”ãƒ³ã‚°ã—ï¼Œã‚³ãƒ¼ãƒ«ã§ãã‚‹ã‚ˆã†ã«ï¼ */ ...mapGetters([ \"x-Function\" ]) }, // ã‚¤ãƒ™ãƒ³ãƒˆãƒãƒ³ãƒ‰ãƒ©é–¢æ•°ã‚’å®šç¾©ï¼ˆâ€»ãƒ‡ãƒ¼ã‚¿ã‚’çŠ¶æ…‹ã®å¤‰æ›´ã‚’ä¿æŒã—ãŸã„ã‚‚ã®ï¼‰ methods: { // mapMutationsãƒ˜ãƒ«ãƒ‘ãƒ¼ ...mapMutations([ \"y-Function\" ]), // mapActionsãƒ˜ãƒ«ãƒ‘ãƒ¼ ...mapActions([ \"z-Function\" ]), } } 04. ãƒ©ã‚¤ãƒ•ã‚µã‚¤ã‚¯ãƒ« ãƒ©ã‚¤ãƒ•ã‚µã‚¤ã‚¯ãƒ«ãƒ•ãƒƒã‚¯ ãƒ»ãƒ©ã‚¤ãƒ•ã‚µã‚¤ã‚¯ãƒ«ãƒ•ãƒƒã‚¯ã¨ã¯ Vueã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã®ç”Ÿæˆã‹ã‚‰ç ´æ£„ã¾ã§ã®é–“ã«å®Ÿè¡Œã•ã‚Œã‚‹é–¢æ•°ã®ã“ã¨ï¼å…¨ã¦ã®é–¢æ•°ã‚’ä½¿ç”¨ã™ã‚‹å¿…è¦ã¯ãªã„ï¼ å‚è€ƒï¼šhttps://jp.vuejs.org/v2/api/index.html#%E3%82%AA%E3%83%97%E3%82%B7%E3%83%A7%E3%83%B3-%E3%83%A9%E3%82%A4%E3%83%95%E3%82%B5%E3%82%A4%E3%82%AF%E3%83%AB%E3%83%95%E3%83%83%E3%82%AF é †ç•ª ãƒ•ãƒƒã‚¯å ã‚¿ã‚¤ãƒŸãƒ³ã‚° 1 beforeCreate Vueã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã®ç”Ÿæˆå‰ 2 created Vueã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã®ç”Ÿæˆå¾Œ 3 beforeMount Vueã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ãŒãƒã‚¦ãƒ³ãƒˆã•ã‚Œã‚‹å‰ 4 mounted Vueã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ãŒãƒã‚¦ãƒ³ãƒˆã•ã‚ŒãŸå¾Œ 5 beforeUpdate ãƒ‡ãƒ¼ã‚¿æ›´æ–°æ™‚ã®å†ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°å‰ 6 updated ãƒ‡ãƒ¼ã‚¿æ›´æ–°æ™‚ã®å†ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°å¾Œ 7 beforeDestroy Vueã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ãŒå‰Šé™¤ã•ã‚Œã‚‹å‰ï¼ˆ$destroyãƒ¡ã‚½ãƒƒãƒ‰å®Ÿè¡Œå‰ï¼‰ 8 destroyed Vueã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ãŒå‰Šé™¤ã•ã‚ŒãŸå¾Œï¼ˆ$destroyãƒ¡ã‚½ãƒƒãƒ‰å®Ÿè¡Œå¾Œï¼‰ ãƒ»ãƒã‚¦ãƒ³ãƒˆã¨ã¯ ãƒ–ãƒ©ã‚¦ã‚¶ä¸Šã®ãƒªã‚¢ãƒ«DOMã®è¦ç´ ã‚’ï¼ŒVue.jsã®å‡¦ç†ã«ã‚ˆã£ã¦ç”Ÿæˆã•ã‚Œã‚‹ä»®æƒ³DOMã®è¦ç´ ã§ç½®ãæ›ãˆã‚‹ã“ã¨ï¼ å‚è€ƒï¼šhttps://jp.vuejs.org/v2/guide/render-function.html#%E3%83%8E%E3%83%BC%E3%83%89%E3%80%81%E3%83%84%E3%83%AA%E3%83%BC%E3%80%81%E3%81%8A%E3%82%88%E3%81%B3%E4%BB%AE%E6%83%B3-DOM ãƒ»beforeCreate Vueã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã®ç”Ÿæˆå‰ã«å®Ÿè¡Œã•ã‚Œã‚‹ï¼ ï¼Šæ¤œè¨¼ä¾‹ï¼Š beforeCreateãƒ•ãƒƒã‚¯ã®å‹•ä½œã‚’æ¤œè¨¼ã™ã‚‹ï¼dataã‚ªãƒ—ã‚·ãƒ§ãƒ³ã¯ï¼ŒVueã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ç”Ÿæˆå¾Œã«æœ‰åŠ¹ã«ãªã‚‹ãŸã‚ï¼ŒbeforeCreateãƒ•ãƒƒã‚¯ã§ã‚³ãƒ¼ãƒ«ã§ããšï¼Œundefinedã«ãªã‚‹ï¼ {{ name }} new Vue({ data(){ return{ hoge:\"Hiroki\" } }, beforeCreate () { console.log(this.name) } } # çµæœ undefined ãƒ»created ãƒ•ãƒƒã‚¯ã®ä¸­ã§ç‰¹ã«ã‚ˆãä½¿ã†ï¼Vueã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã®ç”Ÿæˆå¾Œã«å®Ÿè¡Œã•ã‚Œã‚‹ï¼ãƒã‚¦ãƒ³ãƒˆå‰ã«å¿…è¦ãªå‡¦ç†ã‚’å®Ÿè£…ã™ã‚‹ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š éåŒæœŸé€šä¿¡ã«ã‚ˆã‚‹ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ï¼Œãƒã‚¦ãƒ³ãƒˆæ™‚ã«å¿…è¦ãªãƒ‡ãƒ¼ã‚¿ã®æº–å‚™ï¼Œãªã© ï¼Šæ¤œè¨¼ä¾‹ï¼Š createdãƒ•ãƒƒã‚¯ã®å‹•ä½œã‚’æ¤œè¨¼ã™ã‚‹ï¼dataã‚ªãƒ—ã‚·ãƒ§ãƒ³ã¯ï¼ŒVueã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ç”Ÿæˆå¾Œã«è¨­å®šã•ã‚Œã‚‹ãŸã‚ï¼Œcreatedãƒ•ãƒƒã‚¯ã§ã‚³ãƒ¼ãƒ«ã§ãï¼Œå‡¦ç†çµæœãŒè¡¨ç¤ºã•ã‚Œã‚‹ï¼ {{ name }} // å¤‰æ•°ã¸ã®æ ¼ç´ã‚’çœç•¥ã—ã¦ã‚‚ã‚ˆã„ var vm = new Vue({ data() { return{ name:\"Hiroki\" } }, created() { console.log(this.name) } } # çµæœ \"Hiroki\" ãƒ»beforeMount Vueã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ãŒãƒã‚¦ãƒ³ãƒˆã•ã‚Œã‚‹å‰ã«å®Ÿè¡Œã•ã‚Œã‚‹ï¼ ï¼Šæ¤œè¨¼ä¾‹ï¼Š beforeMountãƒ•ãƒƒã‚¯ã®å‹•ä½œã‚’æ¤œè¨¼ã™ã‚‹ï¼dataã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‹ã‚‰nameå¤‰æ•°ã¸ã®å±•é–‹ã¯ï¼Œãƒã‚¦ãƒ³ãƒˆã«ã‚ˆã£ã¦å®Ÿè¡Œã•ã‚Œã‚‹ï¼ãã®ãŸã‚ï¼ŒbeforeMountãƒ•ãƒƒã‚¯ã®æ®µéšã§ã¯è¦ç´ è‡ªä½“ãŒç”Ÿæˆã•ã‚Œã¦ãŠã‚‰ãšï¼Œä½•ã‚‚è¡¨ç¤ºã•ã‚Œãªã„ï¼ {{ name }} // å¤‰æ•°ã¸ã®æ ¼ç´ã‚’çœç•¥ã—ã¦ã‚‚ã‚ˆã„ var vm = new Vue({ data() { return{ name: \"\" } }, beforeMount() { this.name = \"Hiroki\" } } # çµæœ è¦ç´ ãŒç”Ÿæˆã•ã‚Œã¦ã„ãªã„ãŸã‚ï¼Œä½•ã‚‚è¡¨ç¤ºã•ã‚Œãªã„ï¼ ãƒ»mounted ãƒ•ãƒƒã‚¯ã®ä¸­ã§ç‰¹ã«ã‚ˆãä½¿ã†ï¼Vueã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ãŒãƒã‚¦ãƒ³ãƒˆã•ã‚ŒãŸå¾Œã«å®Ÿè¡Œã•ã‚Œã‚‹ï¼è¦ç´ ã‚’æ“ä½œã™ã‚‹å‡¦ç†ã‚’å®Ÿè£…ã™ã‚‹ï¼ã¾ãšï¼ŒVueã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã«elã‚ªãƒ—ã‚·ãƒ§ãƒ³ãŒè¨­å®šã•ã‚Œã¦ã„ã‚‹ã‹ã‚’è­˜åˆ¥ã—ï¼Œã“ã‚Œã«å¿œã˜ã¦å‡¦ç†ã®æµã‚ŒãŒåˆ†å²ã™ã‚‹ï¼SSRã®å ´åˆã«ã¯ä½¿ç”¨ã§ããªã„ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š Vue.jsä»¥å¤–ã®å¤–éƒ¨ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®èª­ã¿è¾¼ã¿ï¼Œæ¤œç´¢å®Ÿè¡Œæ™‚ã®ã‚¤ãƒ™ãƒ³ãƒˆãƒãƒ³ãƒ‰ãƒ©é–¢æ•°ï¼Œãƒšãƒ¼ã‚¸ãƒ³ã‚°å®Ÿè¡Œæ™‚ã®ã‚¤ãƒ™ãƒ³ãƒˆãƒãƒ³ãƒ‰ãƒ©é–¢æ•°ï¼Œãªã© ï¼Šæ¤œè¨¼ä¾‹ï¼Š beforeMountãƒ•ãƒƒã‚¯ã®å‹•ä½œã‚’æ¤œè¨¼ã™ã‚‹ï¼dataã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‹ã‚‰nameå¤‰æ•°ã¸ã®å±•é–‹ã¯ï¼Œelementã¸ã®ãƒã‚¦ãƒ³ãƒˆä¸­ã«å®Ÿè¡Œã•ã‚Œã‚‹ï¼ãã®ãŸã‚ï¼Œmountedãƒ¡ã‚½ãƒƒãƒ‰ãŒå®Ÿè¡Œã•ã‚Œï¼Œç©ºæ–‡å­—ãŒä¸Šæ›¸ãã•ã‚Œã‚‹ï¼ {{ name }} // å¤‰æ•°ã¸ã®æ ¼ç´ã‚’çœç•¥ã—ã¦ã‚‚ã‚ˆã„ var vm = new Vue({ data() { return{ name: \"\" } }, mounted() { this.name = \"Hiroki\" } } # çµæœ \"Hiroki\" ãŸã ã—ï¼Œå…¨ã¦ã®å­ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã§ãƒã‚¦ãƒ³ãƒˆãŒå®Œäº†ã—ãŸã“ã¨ã‚’å¾…ã¤ãŸã‚ã«ï¼ŒnextTickãƒ¡ã‚½ãƒƒãƒ‰ã‚’ä½¿ç”¨ã™ã‚‹å¿…è¦ãŒã‚ã‚‹ï¼ {{ name }} // å¤‰æ•°ã¸ã®æ ¼ç´ã‚’çœç•¥ã—ã¦ã‚‚ã‚ˆã„ var vm = new Vue({ data() { return{ name: \"\" } }, mounted() { this.$nextTick(function () { this.name = \"Hiroki\" }) } } ãƒ»beforeUpdate ãƒ‡ãƒ¼ã‚¿ãŒæ›´æ–°ã•ã‚Œã‚‹æ™‚ã®å†ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°å‰ã«å®Ÿè¡Œã•ã‚Œã‚‹ï¼å†ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°å‰ã«è¦ç´ ã‚’æ“ä½œã™ã‚‹å‡¦ç†ã‚’å®Ÿè£…ã™ã‚‹ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š Windowã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚„Documentã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®ãƒ¡ã‚½ãƒƒãƒ‰ã«ã‚ˆã‚‹è¦ç´ ã®å–å¾—ï¼Œãªã© ï¼Šæ¤œè¨¼ä¾‹ï¼Š {{ name }} // å¤‰æ•°ã¸ã®æ ¼ç´ã‚’çœç•¥ã—ã¦ã‚‚ã‚ˆã„ var vm = new Vue({ data() { return{ name: \"\" } }, mounted() { this.$nextTick(function () { this.name = \"Hiroki\" }) }, beforeUpdate(){ console.log(this.name) } } # çµæœ \"Hiroki\" ãƒ»updated ãƒ‡ãƒ¼ã‚¿ãŒæ›´æ–°ã•ã‚Œã‚‹æ™‚ã®å†ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°å¾Œã«å®Ÿè¡Œã•ã‚Œã‚‹ï¼å†ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°å¾Œã«è¦ç´ ã‚’æ“ä½œã™ã‚‹å‡¦ç†ã‚’å®Ÿè£…ã™ã‚‹ï¼ {{ name }} // å¤‰æ•°ã¸ã®æ ¼ç´ã‚’çœç•¥ã—ã¦ã‚‚ã‚ˆã„ var vm = new Vue({ data() { return{ name: \"\" } }, mounted() { this.$nextTick(function () { this.name = \"Hiroki\" }) }, beforeUpdate(){ console.log(this.name) } } # çµæœ \"Hiroki\" ãƒ»beforeDestroy Vueã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ãŒå‰Šé™¤ã•ã‚Œã‚‹å‰ã«å®Ÿè¡Œã™ã‚‹ï¼ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’å‰Šé™¤ã™ã‚‹å‰ã«ç„¡åŠ¹åŒ–ã—ã¦ãŠãå¿…è¦ã®ã‚ã‚‹å‡¦ç†ã‚’å®Ÿè£…ã™ã‚‹ï¼SSRã®å ´åˆã«ã¯ä½¿ç”¨ã§ããªã„ï¼ ãƒ»destroyed Vueã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ãŒå‰Šé™¤ã•ã‚ŒãŸå¾Œã«å®Ÿè¡Œã™ã‚‹ï¼ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’å‰Šé™¤ã—ãŸå¾Œã®TearDownå‡¦ç†ã‚’å®Ÿè£…ã™ã‚‹ï¼SSRã®å ´åˆã«ã¯ä½¿ç”¨ã§ããªã„ï¼ "},"public/software/software_application_frontend_js_framework_nuxtjs.html":{"url":"public/software/software_application_frontend_js_framework_nuxtjs.html","title":"ğŸ“– ï¸Nuxt.js","keywords":"","body":"Nuxt.js ã¯ã˜ã‚ã« æœ¬ã‚µã‚¤ãƒˆã«ã¤ãã¾ã—ã¦ï¼Œä»¥ä¸‹ã‚’ã”èªè­˜ã®ã»ã©å®œã—ããŠé¡˜ã„ã„ãŸã—ã¾ã™ï¼ å‚è€ƒï¼šhttps://hiroki-it.github.io/tech-notebook-gitbook/ 01. ã‚³ãƒãƒ³ãƒ‰ serverãƒ¢ãƒ¼ãƒ‰ ãƒ»serverãƒ¢ãƒ¼ãƒ‰ã¨ã¯ ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’SSRã¨ã—ã¦ç¨¼åƒã•ã›ã‚‹ï¼ å‚è€ƒï¼šhttps://ja.nuxtjs.org/docs/2.x/get-started/commands#target-server ãƒ»dev ãƒ­ãƒ¼ã‚«ãƒ«ç’°å¢ƒã¨ã—ã¦ä½¿ç”¨ã™ã‚‹ãŸã‚ï¼Œã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ãƒ“ãƒ«ãƒ‰ã—ï¼ŒNodeã‚µãƒ¼ãƒã‚’èµ·å‹•ã™ã‚‹ï¼Webpackã¯ä½¿ç”¨ã•ã‚Œãªã„ãŸã‚ï¼Œé™çš„ãƒ•ã‚¡ã‚¤ãƒ«ã®åœ§ç¸®ã‚„ç”»åƒãƒ•ã‚¡ã‚¤ãƒ«åã®ãƒãƒƒã‚·ãƒ¥åŒ–ã¯å®Ÿè¡Œã•ã‚Œãªã„ï¼ $ nuxt dev ãƒ»build æœ¬ç•ªç’°å¢ƒã¨ã—ã¦ä½¿ç”¨ã™ã‚‹ãŸã‚ï¼ŒNodeã‚µãƒ¼ãƒã®èµ·å‹•å‰ã«ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ãƒ“ãƒ«ãƒ‰ã‚’å®Ÿè¡Œã™ã‚‹ï¼devã‚³ãƒãƒ³ãƒ‰ã¨ã¯ç•°ãªã‚Šï¼Œãƒ“ãƒ«ãƒ‰æ™‚ã«Webpackã«ã‚ˆã‚‹æœ€é©åŒ–ãŒå®Ÿè¡Œã•ã‚Œã‚‹ï¼ã“ã‚Œã«ã‚ˆã‚Šï¼ŒJavaScriptã¨CSSã¯minifyã•ã‚Œã‚‹ï¼minifyã«ã‚ˆã‚Šï¼Œä¸è¦ãªæ”¹è¡Œã‚„ã‚¤ãƒ³ãƒ‡ãƒ³ãƒˆãŒå‰Šé™¤ã•ã‚Œï¼Œãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®èª­ã¿è¾¼ã¿URLã¯ã¾ã¨ã‚ã‚‰ã‚Œï¼Œåœ§ç¸®ã•ã‚Œã‚‹ï¼ç”»åƒåã¯ãƒãƒƒã‚·ãƒ¥åŒ–ã•ã‚Œã‚‹ï¼ $ nuxt build ãƒ»start æœ¬ç•ªç’°å¢ƒã¨ã—ã¦ä½¿ç”¨ã™ã‚‹ãŸã‚ï¼Œãƒ“ãƒ«ãƒ‰å®Œäº†å¾Œã«Nodeã‚µãƒ¼ãƒã‚’èµ·å‹•ã™ã‚‹ï¼SSRãƒ¢ãƒ¼ãƒ‰ã®ãŸã‚ã«ä½¿ç”¨ã™ã‚‹ï¼ $ nuxt start staticãƒ¢ãƒ¼ãƒ‰ ãƒ»staticãƒ¢ãƒ¼ãƒ‰ã¨ã¯ ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’SSGã¨ã—ã¦ç¨¼åƒã•ã›ã‚‹ï¼ å‚è€ƒï¼šhttps://ja.nuxtjs.org/docs/2.x/get-started/commands#target-static ãƒ»dev ãƒ­ãƒ¼ã‚«ãƒ«ç’°å¢ƒã¨ã—ã¦ä½¿ç”¨ã™ã‚‹ãŸã‚ï¼Œã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ãƒ“ãƒ«ãƒ‰ã—ï¼ŒNodeã‚µãƒ¼ãƒã‚’èµ·å‹•ã™ã‚‹ï¼Webpackã¯ä½¿ç”¨ã•ã‚Œãªã„ãŸã‚ï¼Œé™çš„ãƒ•ã‚¡ã‚¤ãƒ«ã®åœ§ç¸®ã‚„ç”»åƒãƒ•ã‚¡ã‚¤ãƒ«åã®ãƒãƒƒã‚·ãƒ¥åŒ–ã¯å®Ÿè¡Œã•ã‚Œãªã„ï¼ $ nuxt dev ãƒ»build Node.jsã‚’ä½¿ç”¨ã—ã¦ãƒ†ã‚¹ãƒˆãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã‚’å‹•ã‹ã™ãŸã‚ã«ä½¿ç”¨ã™ã‚‹ï¼devã‚³ãƒãƒ³ãƒ‰ã¨ã¯ç•°ãªã‚Šï¼Œãƒ“ãƒ«ãƒ‰æ™‚ã«Webpackã«ã‚ˆã‚‹æœ€é©åŒ–ãŒå®Ÿè¡Œã•ã‚Œã‚‹ï¼ã“ã‚Œã«ã‚ˆã‚Šï¼ŒJavaScriptã¨CSSã¯minifyã•ã‚Œã‚‹ï¼minifyã«ã‚ˆã‚Šï¼Œä¸è¦ãªæ”¹è¡Œã‚„ã‚¤ãƒ³ãƒ‡ãƒ³ãƒˆãŒå‰Šé™¤ã•ã‚Œï¼Œãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®èª­ã¿è¾¼ã¿URLã¯ã¾ã¨ã‚ã‚‰ã‚Œï¼Œåœ§ç¸®ã•ã‚Œã‚‹ï¼ç”»åƒåã¯ãƒãƒƒã‚·ãƒ¥åŒ–ã•ã‚Œã‚‹ï¼ $ nuxt build ãƒ»generate JavaScriptã‹ã‚‰é™çš„ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç”Ÿæˆã™ã‚‹ï¼ãƒ“ãƒ«ãƒ‰æ™‚ã«ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã«æ¥ç¶šã—ï¼Œãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã«æ ¼ç´ã—ãŸãƒ‡ãƒ¼ã‚¿ï¼ˆä¾‹ï¼šç”»åƒãƒ•ã‚¡ã‚¤ãƒ«ãƒ‘ã‚¹ï¼‰ã‚’å…ƒã«ï¼Œé™çš„ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ“ãƒ«ãƒ‰ã™ã‚‹ã“ã¨ã‚‚å¯èƒ½ã§ã‚ã‚‹ï¼SSGãƒ¢ãƒ¼ãƒ‰ã®ãŸã‚ã«ä½¿ç”¨ã™ã‚‹ï¼ $ nuxt generate ãƒ»start é™çš„ãƒ›ã‚¹ãƒ†ã‚£ãƒ³ã‚°ã‚µã‚¤ãƒˆã‚’èµ·å‹•ã™ã‚‹ï¼ $ nuxt start ãƒ“ãƒ«ãƒ‰æ™‚ã®Webpackã‚ªãƒ—ã‚·ãƒ§ãƒ³ serverãƒ¢ãƒ¼ãƒ‰ã¨staticãƒ¢ãƒ¼ãƒ‰ã«ãŠã„ã¦ï¼Œbuildã‚³ãƒãƒ³ãƒ‰æ™‚ã«ä½¿ç”¨ã•ã‚Œã‚‹Webpackã®æœ€é©åŒ–æ–¹æ³•ã‚’æŒ‡å®šã§ãã‚‹ï¼` https://ja.nuxtjs.org/docs/2.x/get-started/commands#webpack-%E3%81%AE%E8%A8%AD%E5%AE%9A%E3%82%92%E6%A4%9C%E6%9F%BB 02. ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ nuxt.config.jsãƒ•ã‚¡ã‚¤ãƒ« ãƒ»nuxt.config.jsãƒ•ã‚¡ã‚¤ãƒ«ã¨ã¯ NuxtãŒæ¨™æº–ã§ç”¨æ„ã—ã¦ã„ã‚‹è¨­å®šã‚’ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã®è¨­å®šå€¤ã§ä¸Šæ›¸ãã§ãã‚‹ï¼å„ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã¯ä»¥ä¸‹ã®ãƒªãƒ³ã‚¯ã‚’å‚è€ƒã«ã›ã‚ˆï¼ å‚è€ƒï¼šhttps://ja.nuxtjs.org/docs/2.x/directory-structure/nuxt-config#nuxtconfigjs import { Configuration } from '@nuxt/types' const nuxtConfig: Configuration = { // ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ } ãƒ».envãƒ•ã‚¡ã‚¤ãƒ«ã®èª­ã¿è¾¼ã¿ ã‚ã‚‰ã‹ã˜ã‚ï¼Œdotenvãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹ï¼process.envã‹ã‚‰.envãƒ•ã‚¡ã‚¤ãƒ«ã®å¤‰æ•°ã‚’å‚ç…§ã™ã‚‹ï¼å®šæ•°ã«ä»£å…¥ã™ã‚‹å ´åˆã¯ï¼Œã¾ã¨ã‚ã¦ä»£å…¥ã™ã‚‹ã¨ã‚ˆã„ï¼ å‚è€ƒï¼šhttps://levelup.gitconnected.com/what-are-env-files-and-how-to-use-them-in-nuxt-7f194f083e3d $ npm install @nuxtjs/dotenv # APIã®URLï¼ã‚µãƒ¼ãƒä¸Šã®JavaScriptã‹ã‚‰APIã¸ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆã§ä½¿ç”¨ã™ã‚‹ï¼ API_URL=https://example.co.jp/api # APIã®URLï¼ãƒ–ãƒ©ã‚¦ã‚¶ä¸Šã®JavaScriptã‹ã‚‰APIã¸ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆã§ä½¿ç”¨ã™ã‚‹ï¼ API_URL_BROWSER=https://example.co.jp/api # APIã®Oauthèªè¨¼ã®æƒ…å ± OAUTH_CLIENT_ID= OAUTH_CLIENT_SECRET= # GoogleMapã®URL GOOGLE_MAP_QUERY_URL=https://www.google.com/maps/search/?api=1&query= # ãƒ›ãƒ¼ãƒ ãƒ‘ã‚¹ HOME_PATH=/ import { Configuration } from '@nuxt/types' const { API_URL, API_URL_BROWSER, OAUTH_CLIENT_ID, OAUTH_CLIENT_SECRET, HOME_PATH } = process.env const nuxtConfig: Configuration = { // ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ } ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ä¸€è¦§ ãƒ»hardSource ãƒ“ãƒ«ãƒ‰æ™‚ã®ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’æœ‰åŠ¹åŒ–ã™ã‚‹ï¼ãƒ“ãƒ«ãƒ‰ã®å®Œäº†ãŒæ—©ããªã‚‹ï¼ å‚è€ƒï¼šhttps://nuxtjs.org/docs/2.x/configuration-glossary/configuration-build#hardsource import { Configuration } from '@nuxt/types' const nuxtConfig: Configuration = { build: { hardSource: true, }, } ãƒ»privateRuntimeConfig SSRãƒ¢ãƒ¼ãƒ‰ã§ã®ã¿ä½¿ç”¨ã§ãã‚‹ç’°å¢ƒå¤‰æ•°ã‚’å®šç¾©ã™ã‚‹ï¼ç’°å¢ƒå¤‰æ•°ã¯ï¼Œpagesï¼Œstoreï¼Œcomponentsï¼Œpluginãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã§ä½¿ç”¨ã§ãã‚‹ï¼ãƒ–ãƒ©ã‚¦ã‚¶ã®JavaScriptã‚½ãƒ¼ã‚¹ã‚¿ãƒ–ã§å…¬é–‹ã•ã‚Œã¦ã—ã¾ã†ãŸã‚ï¼Œæ©Ÿå¯†ãªå€¤ã¯è¨­å®šã—ãªã„ã‚ˆã†ã«ã™ã‚‹ï¼ã‚‚ã—publicRuntimeConfigã§åŒã˜åå‰ã®å¤‰æ•°ãŒè¨­å®šã•ã‚Œã¦ã„ãŸå ´åˆã¯ï¼Œã“ã®å€¤ã‚’ä¸Šæ›¸ãã™ã‚‹ï¼ç’°å¢ƒå¤‰æ•°ã¯ï¼Œcontextã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®configå¤‰æ•°ã‹ã‚‰å–å¾—ã§ãã‚‹ï¼ å‚è€ƒï¼š https://nuxtjs.org/docs/directory-structure/nuxt-config/#privateruntimeconfig https://blog.mktia.com/dotenv-is-no-longer-need-in-nuxt/ import { Configuration } from '@nuxt/types' const { API_KEY, } = process.env const nuxtConfig: Configuration = { privateRuntimeConfig: { apiKey: API_KEY, }, } # .envãƒ•ã‚¡ã‚¤ãƒ« API_KEY=***** export function foo() { // contextã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®$configãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã‚’åˆ†å‰²ä»£å…¥ const { $config } = useContext() $config.apiKey } ãƒ»publicRuntimeConfig SPAãƒ¢ãƒ¼ãƒ‰ã¾ãŸã¯SSRãƒ¢ãƒ¼ãƒ‰ã§ä½¿ç”¨ã§ãã‚‹ç’°å¢ƒå¤‰æ•°ã‚’å®šç¾©ã™ã‚‹ï¼ç’°å¢ƒå¤‰æ•°ã¯ï¼Œpagesï¼Œstoreï¼Œcomponentsï¼Œpluginãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã§ä½¿ç”¨ã§ãã‚‹ï¼ç’°å¢ƒå¤‰æ•°ã¯ï¼Œcontextã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®configå¤‰æ•°ã‹ã‚‰å–å¾—ã§ãã‚‹ï¼ å‚è€ƒï¼š https://nuxtjs.org/docs/directory-structure/nuxt-config/#publicruntimeconfig https://blog.mktia.com/dotenv-is-no-longer-need-in-nuxt/ import { Configuration } from '@nuxt/types' const { API_URL, } = process.env const nuxtConfig: Configuration = { publicRuntimeConfig: { apiUrl: API_URL }, } # .envãƒ•ã‚¡ã‚¤ãƒ« API_URL=https://example.co.jp/api export function foo() { // contextã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®$configãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã‚’åˆ†å‰²ä»£å…¥ const { $config } = useContext() $config.apiUrl } ãƒ»quiet ãƒ“ãƒ«ãƒ‰æ™‚ã«ãƒ­ã‚°ã‚’æœ€å°é™ã«ã™ã‚‹ï¼CICDãƒ„ãƒ¼ãƒ«ã§ãƒ­ã‚°ãŒç¢ºèªã§ããªããªã‚‹ãŸã‚ï¼Œç„¡åŠ¹åŒ–ã—ã¦ãŠã„ãŸæ–¹ãŒè‰¯ã„ï¼ å‚è€ƒï¼šhttps://ja.nuxtjs.org/docs/2.x/configuration-glossary/configuration-build#quiet import { Configuration } from '@nuxt/types' const nuxtConfig: Configuration = { build: { quiet: false, }, } ãƒ»serverMiddleware ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’å—ä¿¡ã§ãã‚‹ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã¨ï¼Œç´ä»˜ã‘ã‚‹ãƒãƒ³ãƒ‰ãƒ©ãƒ¼é–¢æ•°ã‚’å®šç¾©ã™ã‚‹ï¼ å‚è€ƒï¼šhttps://nuxtjs.org/docs/configuration-glossary/configuration-servermiddleware/ import { Configuration } from '@nuxt/types' const nuxtConfig: Configuration = { serverMiddleware: [ { path: '/foos', handler: '~/foos/index.js' }, ] } 03. ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª distï¼šdistribution staticãƒ¢ãƒ¼ãƒ‰ã®generateã‚³ãƒãƒ³ãƒ‰ã®å®Ÿè¡Œæ™‚ã«ï¼Œã‚¢ãƒ¼ãƒ†ã‚£ãƒ•ã‚¡ã‚¯ãƒˆãŒé…ç½®ã•ã‚Œã‚‹ï¼ å‚è€ƒï¼šhttps://nuxtjs.org/ja/docs/directory-structure/dist module å‚è€ƒï¼šhttps://nuxtjs.org/docs/directory-structure/modules plugin å‚è€ƒï¼š https://nuxtjs.org/docs/directory-structure/plugins/ https://github.com/nuxt/nuxt.js/issues/2820 "},"public/software/software_application_frontend_js_debug.html":{"url":"public/software/software_application_frontend_js_debug.html","title":"ğŸ“– ï¸ãƒ‡ãƒãƒƒã‚°","keywords":"","body":"ãƒ‡ãƒãƒƒã‚°ã®è±†çŸ¥è­˜ ã¯ã˜ã‚ã« æœ¬ã‚µã‚¤ãƒˆã«ã¤ãã¾ã—ã¦ï¼Œä»¥ä¸‹ã‚’ã”èªè­˜ã®ã»ã©å®œã—ããŠé¡˜ã„ã„ãŸã—ã¾ã™ï¼ å‚è€ƒï¼šhttps://hiroki-it.github.io/tech-notebook-gitbook/ 01. JavaScript ãƒ‡ãƒãƒƒã‚°ã«ä½¿ãˆã‚‹ãƒ¡ã‚½ãƒƒãƒ‰ ãƒ»Console API ãƒ¡ã‚½ãƒƒãƒ‰å å‡ºåŠ›å†…å®¹ console.clearãƒ¡ã‚½ãƒƒãƒ‰ ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ç”»é¢ã‚’ã‚¯ãƒªã‚¢ã«ã™ã‚‹ console.countãƒ¡ã‚½ãƒƒãƒ‰ å®Ÿè¡Œã™ã‚‹åº¦ã«ã‚«ã‚¦ãƒ³ãƒˆã‚¢ãƒƒãƒ—ã—ã¦å›æ•°ã‚’å‡ºåŠ›ã™ã‚‹ console.dirãƒ¡ã‚½ãƒƒãƒ‰ ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆãŒæŒã¤ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã®ä¸€è¦§ã‚’ãƒªã‚¹ãƒˆã§å‡ºåŠ›ã™ã‚‹ console.errorãƒ¡ã‚½ãƒƒãƒ‰ ã‚¨ãƒ©ãƒ¼æƒ…å ±ã¨ã—ã¦å‡ºåŠ›ã™ã‚‹ï¼ˆä»–ã«ã€info() / warn()ã‚‚ã‚ã‚Šï¼‰ console.groupãƒ¡ã‚½ãƒƒãƒ‰ ã‚¤ãƒ³ãƒ‡ãƒ³ãƒˆã‚’ä»˜ã‘ã¦å‡ºåŠ›ã™ã‚‹ã“ã¨ã§éšå±¤æ§‹é€ ã‚’æŒãŸã›ã‚‹ï¼ˆgroupEnd()ã§çµ‚äº†ã™ã‚‹ï¼‰ console.logãƒ¡ã‚½ãƒƒãƒ‰ ä»»æ„ã®å€¤ã‚’å‡ºåŠ›ã™ã‚‹ console.tableãƒ¡ã‚½ãƒƒãƒ‰ é…åˆ—ã‚„ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆãªã©ã®æ§‹é€ ã‚’ãƒ†ãƒ¼ãƒ–ãƒ«è¡¨ã«ã—ã¦å‡ºåŠ›ã™ã‚‹ console.timeãƒ¡ã‚½ãƒƒãƒ‰ time()ã€œtimeEnd()ã¾ã§ã®é–“ã«ã‚ã‚‹å‡¦ç†ã‚’è¨ˆæ¸¬ã™ã‚‹ console.traceãƒ¡ã‚½ãƒƒãƒ‰ å‘¼ã³å‡ºã—å…ƒã‚’å‡ºåŠ›ã™ã‚‹ï¼ "},"public/software/software_application_frontend_js_browser_rendering.html":{"url":"public/software/software_application_frontend_js_browser_rendering.html","title":"ğŸ“– ï¸ãƒ–ãƒ©ã‚¦ã‚¶ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°","keywords":"","body":"ãƒ–ãƒ©ã‚¦ã‚¶ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚° ã¯ã˜ã‚ã« æœ¬ã‚µã‚¤ãƒˆã«ã¤ãã¾ã—ã¦ï¼Œä»¥ä¸‹ã‚’ã”èªè­˜ã®ã»ã©å®œã—ããŠé¡˜ã„ã„ãŸã—ã¾ã™ï¼ å‚è€ƒï¼šhttps://hiroki-it.github.io/tech-notebook-gitbook/ 01. ãƒ–ãƒ©ã‚¦ã‚¶ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã®ä»•çµ„ã¿ æ§‹æˆã™ã‚‹å‡¦ç† ä»¥ä¸‹ã®8ã¤ã®å‡¦ç†ã‹ã‚‰ãªã‚‹ï¼ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã®æ“ä½œã®ãŸã³ã«ã‚¤ãƒ™ãƒ³ãƒˆãŒç™ºç«ã—ï¼ŒScriptingãƒ—ãƒ­ã‚»ã‚¹ãŒç¹°ã‚Šè¿”ã—å®Ÿè¡Œã•ã‚Œã‚‹ï¼ Downloading Parse Scripting Rendering CalculateStyle Paint Rasterize Composite 01-02. ãƒãƒ¼ã‚¯ã‚¢ãƒƒãƒ—è¨€èª ãƒ»ãƒãƒ¼ã‚¯ã‚¢ãƒƒãƒ—è¨€èªã¨ã¯ ãƒãƒ¼ãƒ‰ã‚¦ã‚§ã‚¢ãŒèª­ã¿è¾¼ã‚€ãƒ•ã‚¡ã‚¤ãƒ«ã«ã¯ï¼Œãƒã‚¤ãƒŠãƒªãƒ•ã‚¡ã‚¤ãƒ«ã¨ãƒ†ã‚­ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ãŒã‚ã‚‹ï¼ã“ã®ã†ã¡ï¼Œãƒ†ã‚­ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚¿ã‚°ã¨ãƒ‡ãƒ¼ã‚¿ã«ã‚ˆã£ã¦æ§‹é€ çš„ã«è¡¨ç¾ã—ï¼Œãƒãƒ¼ãƒ‰ã‚¦ã‚§ã‚¢ãŒèª­ã¿è¾¼ã‚ã‚‹çŠ¶æ…‹ã™ã‚‹è¨€èªã®ã“ã¨ï¼ ãƒ»ãƒãƒ¼ã‚¯ã‚¢ãƒƒãƒ—è¨€èªã®æ­´å² Webãƒšãƒ¼ã‚¸ã‚’ãƒ†ã‚­ã‚¹ãƒˆã«ã‚ˆã£ã¦æ§‹æˆã™ã‚‹ãŸã‚ã®è¨€èªã‚’ãƒãƒ¼ã‚¯ã‚¢ãƒƒãƒ—è¨€èªã¨ã„ã†ï¼1970å¹´ï¼ŒIBMãŒï¼Œã‚¿ã‚°ã«ã‚ˆã£ã¦ï¼Œãƒ†ã‚­ã‚¹ãƒˆæ–‡ç« ã«æ§‹é€ ã‚„æ„å‘³ã‚’æŒãŸã›ã‚‹GMLè¨€èªã‚’ç™ºè¡¨ã—ãŸï¼ XMLå½¢å¼ï¼šExtensible Markup Language ãƒ»XMLå½¢å¼ã¨ã¯ ãƒ†ã‚­ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã®ã†ã¡ï¼Œä½•ã‚‰ã‹ã®ãƒ‡ãƒ¼ã‚¿ã®æ§‹é€ ã‚’è¡¨ç¾ã™ã‚‹ã“ã¨ã«ç‰¹åŒ–ã—ã¦ã„ã‚‹ï¼ ãƒ»ã‚¹ã‚­ãƒ¼ãƒè¨€èªã¨ã¯ ãƒãƒ¼ã‚¯ã‚¢ãƒƒãƒ—è¨€èªã®ç‰¹ã«XMLå½¢å¼ã«ãŠã„ã¦ï¼Œã‚¿ã‚°ã®ä»˜ã‘æ–¹ã¯è‡ªç”±ã§ã‚ã‚‹ï¼ã—ã‹ã—ï¼Œåˆ©ç”¨è€…é–“ã§å…±é€šã®ãƒ«ãƒ¼ãƒ«ã‚’è¨­ã‘ãŸæ–¹ãŒè‰¯ã„ï¼ãƒ«ãƒ¼ãƒ«ã‚’å®šç¾©ã™ã‚‹ãŸã‚ã®è¨€èªã‚’ã‚¹ã‚­ãƒ¼ãƒè¨€èªã¨ã„ã†ï¼ã‚¹ã‚­ãƒ¼ãƒè¨€èªã«ï¼ŒDTDï¼šDocument Type Definitionï¼ˆæ–‡æ›¸å‹å®šç¾©ï¼‰ãŒã‚ã‚‹ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š ]> HTMLå½¢å¼ï¼šHyperText Markup Language ãƒ»HTMLå½¢å¼ã¨ã¯ ãƒ†ã‚­ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã®ã†ã¡ï¼ŒWebãƒšãƒ¼ã‚¸ã®æ§‹é€ ã‚’è¡¨ç¾ã™ã‚‹ã“ã¨ã«ç‰¹åŒ–ã—ã¦ã„ã‚‹ï¼ 01-03. JavaScript ãƒãƒ¼ã‚¯ã‚¢ãƒƒãƒ—è¨€èªã¸ã®JavaScriptã®çµ„ã¿è¾¼ã¿ ãƒ»ã‚¤ãƒ³ãƒ©ã‚¤ãƒ³ã‚¹ã‚¯ãƒªãƒ—ãƒˆ JavaScriptãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç›´æ¥çµ„ã¿è¾¼ã‚€æ–¹æ³•ï¼ document.write(\"JavaScriptã‚’ç›´æ¥çµ„ã¿è¾¼ã‚“ã§ã„ã¾ã™ã€‚\") ãƒ»å¤–éƒ¨ã‚¹ã‚¯ãƒªãƒ—ãƒˆ å¤–éƒ¨JavaScriptãƒ•ã‚¡ã‚¤ãƒ«ã‚’çµ„ã¿è¾¼ã‚€æ–¹æ³•ï¼ CDNã®ä»•çµ„ã¿ã‚’ç”¨ã„ã¦ï¼ŒWebä¸Šã‹ã‚‰ãƒªã‚½ãƒ¼ã‚¹ã‚’å–å¾—ã™ã‚‹ã“ã¨ã‚‚ã§ãã‚‹ï¼ ãƒ»scriptã‚¿ã‚°ãŒè¤‡æ•°ã‚ã‚‹å ´åˆ ä¸€ã¤ã®ãƒšãƒ¼ã‚¸ã®Htmlå†…ã§ï¼Œscriptã‚¿ã‚°ãŒè¤‡æ•°ã«åˆ†æ•£ã—ã¦ã„ã¦ã‚‚ï¼ŒScriptingãƒ—ãƒ­ã‚»ã‚¹ã§ã¯ï¼Œä¸€ã¤ã«ã¾ã¨ã‚ã¦å®Ÿè¡Œã•ã‚Œã‚‹ï¼ãã®ãŸã‚ï¼Œã‚ˆã‚Šä¸Šéƒ¨ã®scriptã‚¿ã‚°ã®å‡¦ç†ã¯ï¼Œã‚ˆã‚Šä¸‹éƒ¨ã®scriptã«å¼•ãç¶™ãŒã‚Œã‚‹ï¼ 1ï¼ä¾‹ãˆã°ï¼Œä»¥ä¸‹ã®ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ãŒã‚ã‚‹ï¼ localNumè¦‹å‡ºã—ï¼‘ var globalNum = 10; è¦‹å‡ºã—ï¼’ globalNum = globalNum * 10; è¦‹å‡ºã—ï¼“ document.write(\"çµæœã¯\" + globalNum + \"ã§ã™\"); var hoge = true; // sample.js // ç„¡åé–¢æ•°ã®å³æ™‚å®Ÿè¡Œï¼å®šç¾©ã¨å‘¼ã³å‡ºã—ã‚’åŒæ™‚ã«è¡Œã†ï¼ (function () { // å¤–å´ã®å¤‰æ•°ï¼ˆhogeï¼‰ã‚’å‚ç…§ã§ãã‚‹ï¼ if(hoge) { console.log(\"å¤–éƒ¨ãƒ•ã‚¡ã‚¤ãƒ«ã‚’èª­ã¿è¾¼ã¿ã¾ã—ãŸ\"); } var localNum = 20; function localMethod() { // å¤–å´ã®å¤‰æ•°ï¼ˆlocalNumï¼‰ã‚’å‚ç…§ã§ãã‚‹ï¼ console.log(\"localNum\"); } // å®šç¾©ã—ãŸãƒ¡ã‚½ãƒƒãƒ‰ã‚’å®Ÿè¡Œ localMethod(); }()); å®Ÿè¡Œæ™‚ã«ã¯ä»¥ä¸‹ã®æ§˜ã«ï¼Œã¾ã¨ã‚ã¦å®Ÿè¡Œã•ã‚Œã‚‹ï¼ã“ã“ã§ã¯ï¼Œhtmlãƒ•ã‚¡ã‚¤ãƒ«ã§å®šç¾©ã—ãŸé–¢æ•°ã®å¤–ã«ã‚ã‚‹å¤‰æ•°ã¯ï¼Œã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°ã«ãªã£ã¦ã„ã‚‹ï¼ä¸€ã¤ã®ãƒšãƒ¼ã‚¸ã‚’æ§‹æˆã™ã‚‹Htmlã‚’åˆ¥ãƒ•ã‚¡ã‚¤ãƒ«ã¨ã—ã¦åˆ†å‰²ã—ã¦ã„ã¦ã‚‚ï¼ŒåŒã˜ã§ã‚ã‚‹ï¼ var globalNum = 10; localNum = localNum * 10; document.write(\"çµæœã¯\" + num + \"ã§ã™\"); var hoge = true; // ç„¡åé–¢æ•°ã®å³æ™‚å®Ÿè¡Œï¼å®šç¾©ã¨å‘¼ã³å‡ºã—ã‚’åŒæ™‚ã«è¡Œã†ï¼ (function () { // å¤–å´ã®å¤‰æ•°ï¼ˆhogeï¼‰ã‚’å‚ç…§ã§ãã‚‹ï¼ if(hoge) { console.log(\"å¤–éƒ¨ãƒ•ã‚¡ã‚¤ãƒ«ã‚’èª­ã¿è¾¼ã¿ã¾ã—ãŸ\"); } var localNum = 20; function localMethod() { // å¤–å´ã®å¤‰æ•°ï¼ˆlocalNumï¼‰ã‚’å‚ç…§ã§ãã‚‹ï¼ console.log(\"localNum\"); } // å®šç¾©ã—ãŸãƒ¡ã‚½ãƒƒãƒ‰ã‚’å®Ÿè¡Œ localMethod(); }()); 01-04. ãƒ–ãƒ©ã‚¦ã‚¶ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ Polyfill ãƒ»Polyfillã¨ã¯ JavaScriptã‚„HTMLã®æ›´æ–°ã«ãƒ–ãƒ©ã‚¦ã‚¶ãŒè¿½ã„ã¤ã„ã¦ã„ãªã„å ´åˆã«ï¼Œãã‚Œã‚’è£œå®Œã™ã‚‹ã‚ˆã†ã«å®Ÿè£…ã•ã‚ŒãŸãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®ã“ã¨ï¼ã€Polyfillaã€ã«ç”±æ¥ã—ã¦ã„ã‚‹ï¼ 02. Downloadingå‡¦ç† Downloadingå‡¦ç†ã¨ã¯ ãƒ»éåŒæœŸçš„ãªèª­ã¿è¾¼ã¿ ã¾ãšï¼Œã‚µãƒ¼ãƒã‚µã‚¤ãƒ‰ã‹ã‚‰ãƒªã‚½ãƒ¼ã‚¹ï¼ˆHtmlï¼ŒCSSï¼ŒJSï¼Œç”»åƒï¼‰ã¯ï¼Œåˆ†å‰²ã•ã‚ŒãªãŒã‚‰ï¼Œãƒã‚¤ãƒˆå½¢å¼ã§ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã•ã‚Œã‚‹ï¼ã“ã‚Œã¯ï¼Œãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãƒœãƒ‡ã‚£ã«å«ã¾ã‚Œã¦ã„ã‚‹ï¼ã“ã‚Œã‚’å„ªå…ˆåº¦ã«åŸºã¥ã„ã¦èª­ã¿è¾¼ã‚€å‡¦ç†ï¼åˆ†å‰²ã§ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã•ã‚ŒãŸãƒªã‚½ãƒ¼ã‚¹ã‚’ï¼Œéšæ™‚èª­ã¿è¾¼ã‚“ã§ã„ãï¼ãã®ãŸã‚ï¼Œå„ãƒªã‚½ãƒ¼ã‚¹ã®èª­ã¿è¾¼ã¿ã¯éåŒæœŸçš„ã«è¡Œã‚ã‚Œã‚‹ï¼Downloadingå‡¦ç†ãŒçµ‚äº†ã—ãŸãƒªã‚½ãƒ¼ã‚¹ã‹ã‚‰ï¼Œæ¬¡ã®Parseå‡¦ç†ã«é€²ã‚“ã§ã„ãï¼ ãƒ»ãƒªã‚½ãƒ¼ã‚¹ã®å„ªå…ˆé †ä½ HTML CSS JS ç”»åƒ Pre-Loading ãƒ»Pre-Loadingã¨ã¯ Downloadingå‡¦ç†ã®å„ªå…ˆé †ä½ã‚’ä¸Šã’ã‚‹ã‚ˆã†ã«å®£è¨€ã™ã‚‹æ–¹æ³•ï¼å„ªå…ˆåº¦ã®é«˜ã„åˆ†å‰²ãƒªã‚½ãƒ¼ã‚¹ã¯ï¼Œæ¬¡ã®Parseå‡¦ç†ï¼ŒScriptingå‡¦ç†ã‚‚è¡Œã‚ã‚Œã‚‹ï¼ãã®ãŸã‚ï¼ŒJSãƒ•ã‚¡ã‚¤ãƒ«ã®Scriptingå‡¦ç†ãŒï¼Œä»¥é™ã®imageãƒ•ã‚¡ã‚¤ãƒ«ã®Downloadingå‡¦ç†ã‚ˆã‚Šã‚‚æ—©ãã«è¡Œã‚ã‚Œã‚‹ã“ã¨ãŒã‚ã‚‹ï¼ Title Hello World Lazy Loadingï¼ˆé…å»¶èª­ã¿è¾¼ã¿ï¼‰ ãƒ»Lazy Loadingã¨ã¯ æ¡ä»¶ã«åˆè‡´ã—ãŸè¦ç´ ã‚’éšæ™‚èª­ã¿è¾¼ã‚€æ–¹æ³•ï¼æ¡ä»¶ã®æŒ‡å®šæ–¹æ³•ã«ã¯ï¼Œscroll/resizeã‚¤ãƒ™ãƒ³ãƒˆã«åŸºã¥ãæ–¹æ³•ã¨ï¼ŒIntersection Observerã«ã‚ˆã‚‹è¦ç´ ã®äº¤å·®ç‡ã«åŸºã¥ãæ–¹æ³•ãŒã‚ã‚‹ï¼ç”»åƒãƒ•ã‚¡ã‚¤ãƒ«ã®é…å»¶èª­ã¿è¾¼ã¿ã§ã¯ï¼Œèª­ã¿è¾¼ã¿å‰ã«ãƒ€ãƒŸãƒ¼ç”»åƒã‚’è¡¨ç¤ºã•ã›ã¦ãŠãï¼Œé…å»¶èª­ã¿è¾¼ã¿æ™‚ã«ãƒ€ãƒŸãƒ¼ç”»åƒãƒ‘ã‚¹ã‚’æœ¬æ¥ã®ç”»åƒãƒ‘ã‚¹ã«ä¸Šæ›¸ãã™ã‚‹ï¼ ãƒ»scrollã‚¤ãƒ™ãƒ³ãƒˆã¨resizeã‚¤ãƒ™ãƒ³ãƒˆã«åŸºã¥ãèª­ã¿è¾¼ã¿ scrollã‚¤ãƒ™ãƒ³ãƒˆã¨resizeã‚¤ãƒ™ãƒ³ãƒˆã‚’ç›£è¦–ã—ã€ã“ã‚Œã‚‰ã®ã‚¤ãƒ™ãƒ³ãƒˆã®ç™ºç«ã‚’ãƒˆãƒªã‚¬ãƒ¼ã«ã—ã¦ï¼Œç”»é¢å†…ã«æ–°ã—ãè¿½åŠ ã•ã‚ŒãŸè¦ç´ ã‚’éšæ™‚èª­ã¿è¾¼ã‚€æ–¹æ³•ï¼ ãƒ»Intersection Observerã«ã‚ˆã‚‹è¦ç´ ã®äº¤å·®ç‡ã«åŸºã¥ãèª­ã¿è¾¼ã¿ Intersection Observerã«ã‚ˆã‚‹è¦ç´ ã®äº¤å·®ç‡ã‚’ç›£è¦–ã—ï¼ŒæŒ‡å®šã®äº¤å·®ç‡ã‚’è¶…ãˆãŸè¦ç´ ã‚’éšæ™‚èª­ã¿è¾¼ã‚€æ–¹æ³•ï¼ä¾‹ãˆã°ï¼Œäº¤å·®ç‡ã®é–¾å€¤ã‚’ã€0.5ã€ã¨è¨­å®šã™ã‚‹ã¨ï¼Œã‚¿ãƒ¼ã‚²ãƒƒãƒˆã‚¨ãƒ¬ãƒ¡ãƒ³ãƒˆã®äº¤å·®ç‡ãŒã€0.5ã€ã‚’è¶…ãˆãŸè¦ç´ ã‚’éšæ™‚èª­ã¿è¾¼ã‚€ï¼ Eager Loading ãƒ»Eager Loadingã¨ã¯ 02-02. Parseå‡¦ç† Parseå‡¦ç†ã¨ã¯ Downloadingå‡¦ç†ã«ã‚ˆã£ã¦èª­ã¿è¾¼ã¾ã‚ŒãŸãƒªã‚½ãƒ¼ã‚¹ã‚’ç¿»è¨³ã™ã‚‹ãƒ—ãƒ­ã‚»ã‚¹ HTMLå½¢å¼ãƒ†ã‚­ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã®æ§‹é€ è§£æ ãƒ»æ§‹é€ è§£æã®æµã‚Œ Downloadingå‡¦ç†ã§èª­ã¿ã“ã¾ã‚ŒãŸãƒã‚¤ãƒˆå½¢å¼ãƒ•ã‚¡ã‚¤ãƒ«ã¯ï¼Œæ–‡å­—ã‚³ãƒ¼ãƒ‰ã«åŸºã¥ã„ã¦ï¼Œä¸€é€£ã®æ–‡å­—åˆ—ã«å¤‰æ›ã•ã‚Œã‚‹ï¼ã“ã“ã§ã¯ï¼Œä»¥ä¸‹ã®HTMLå½¢å¼ãƒ•ã‚¡ã‚¤ãƒ«ã¨CSSå½¢å¼ãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆstyle.cssï¼‰ã«å¤‰æ›ã•ã‚ŒãŸã¨ã™ã‚‹ï¼ Critical Path Hello web performance students! Hello world! /* style.css */ body { font-size: 16px } p { font-weight: bold } span { color: red } p span { display: none } img { float: right } ãƒªã‚½ãƒ¼ã‚¹ã®æ–‡å­—åˆ—ã‹ã‚‰HTMLã‚¿ã‚°ãŒèªè­˜ã•ã‚Œï¼Œãƒˆãƒ¼ã‚¯ãƒ³ã«å¤‰æ›ã•ã‚Œã‚‹ï¼å„ãƒˆãƒ¼ã‚¯ãƒ³ã¯ï¼Œä¸€ã¤ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã«å¤‰æ›ã•ã‚Œã‚‹ï¼ HTMLãƒ‘ãƒ¼ã‚µãƒ¼ã¯ï¼Œã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’ãƒãƒ¼ãƒ‰ã¨ã—ã¦ï¼ŒDOMãƒ„ãƒªãƒ¼ã‚’ç”Ÿæˆã™ã‚‹ï¼DOMãƒ„ãƒªãƒ¼ã‚’ç”Ÿæˆã™ã‚‹é€”ä¸­ã§scriptã‚¿ã‚°ã«åˆ°é”ã™ã‚‹ã¨ï¼Œä¸€æ—¦ï¼ŒJSãƒ•ã‚¡ã‚¤ãƒ«ã‚’èª­ã¿è¾¼ã‚“ã§Scriptingå‡¦ç†ã‚’çµ‚ãˆã¦ã‹ã‚‰ï¼ŒDOMãƒ„ãƒªãƒ¼ã®ç”Ÿæˆã‚’å†é–‹ã™ã‚‹ï¼DOMã®ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã«ã¤ã„ã¦ã¯ï¼Œä»¥ä¸‹ã®ãƒªãƒ³ã‚¯ã‚’å‚è€ƒã«ã›ã‚ˆï¼ å‚è€ƒï¼šhttps://developer.mozilla.org/ja/docs/Web/API/Document_Object_Model åŒæ™‚ã«ï¼ŒCSSãƒ‘ãƒ¼ã‚µãƒ¼ã¯ï¼Œheadã‚¿ã‚°ã«ã‚ã‚‹linkã‚¿ã‚°ã‚’ã‚‚ã¨ã«ã‚µãƒ¼ãƒã«ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’è¡Œã†ï¼ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã•ã‚ŒãŸCSSãƒ•ã‚¡ã‚¤ãƒ«ã«å¯¾ã—ã¦Downloadingå‡¦ç†ã‚’è¡Œã£ãŸå¾Œï¼Œã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’ãƒãƒ¼ãƒ‰ã¨ã—ã¦ï¼ŒCSSOMãƒ„ãƒªãƒ¼ã‚’ç”Ÿæˆã™ã‚‹ï¼ XMLå½¢å¼ãƒ†ã‚­ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã®æ§‹é€ è§£æ ãƒ»æ§‹é€ è§£æã®æµã‚Œ ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã‚¨ãƒ³ã‚¸ãƒ³ã¯ï¼Œæœ€åˆã«å‡ºç¾ã™ã‚‹ãƒ«ãƒ¼ãƒˆè¦ç´ ã‚’æ ¹ï¼ˆãƒ«ãƒ¼ãƒˆï¼‰ï¼Œã¾ãŸã™ã¹ã¦ã®è¦ç´ ã‚„å±æ€§ã‚’ï¼Œãã“ã‹ã‚‰å»¶ã³ã‚‹æè‘‰ã¨ã—ã¦æ„å‘³ã¥ã‘ï¼Œãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ãƒ„ãƒªãƒ¼ã‚’ç”Ÿæˆã™ã‚‹ï¼ ï¼Šä¾‹ï¼Š å¼•ç”¨ï¼šReal-time Generalization of Geodata in the WEBï¼Œhttps://www.researchgate.net/publication/228930844_Real-time_Generalization_of_Geodata_in_the_WEB 03. Scriptingå‡¦ç† Scriptingå‡¦ç†ã¨ã¯ JavaScriptã‚¨ãƒ³ã‚¸ãƒ³ã«ã‚ˆã£ã¦ï¼ŒJavaScriptã‚³ãƒ¼ãƒ‰ãŒæ©Ÿæ¢°èªã«ç¿»è¨³ã•ã‚Œï¼Œå®Ÿè¡Œã•ã‚Œã‚‹ï¼ã“ã®å‡¦ç†ã¯ï¼Œåˆå›ã‚¢ã‚¯ã‚»ã‚¹æ™‚ã ã‘ã§ãªãï¼Œã‚¤ãƒ™ãƒ³ãƒˆãŒç™ºç«ã—ãŸæ™‚ã«ã‚‚å®Ÿè¡Œã•ã‚Œã‚‹ï¼ JavaScriptã‚¨ãƒ³ã‚¸ãƒ³ ãƒ»JavaScriptã‚¨ãƒ³ã‚¸ãƒ³ã¨ã¯ JavaScriptã®ã‚¤ãƒ³ã‚¿ãƒ—ãƒªã‚¿ã®ã“ã¨ï¼JavaScriptã‚¨ãƒ³ã‚¸ãƒ³ã¯ï¼Œãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã‚¨ãƒ³ã‚¸ãƒ³ã‹ã‚‰HTMLãƒ•ã‚¡ã‚¤ãƒ«ã«çµ„ã¿è¾¼ã¾ã‚ŒãŸJavaScriptã®ã‚³ãƒ¼ãƒ‰ã‚’å—ã‘å–ã‚‹ï¼JavaScriptã‚¨ãƒ³ã‚¸ãƒ³ã¯ï¼Œã“ã‚Œã‚’æ©Ÿæ¢°èªã«ç¿»è¨³ã—ï¼Œãƒãƒ¼ãƒ‰ã‚¦ã‚§ã‚¢ã«å¯¾ã—ã¦ï¼Œå‘½ä»¤ã‚’å®Ÿè¡Œã™ã‚‹ï¼ ãƒ»æ©Ÿæ¢°èªç¿»è¨³ JavaScriptã‚¨ãƒ³ã‚¸ãƒ³ã¯ï¼Œã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã‚’ï¼Œå­—å¥è§£æï¼Œæ§‹é€ è§£æï¼Œæ„å‘³è§£é‡ˆï¼Œå‘½ä»¤ã®å®Ÿè¡Œï¼Œã‚’ã‚³ãƒ¼ãƒ‰ä¸€è¡Œãšã¤ã«å¯¾ã—ï¼Œç¹°ã‚Šè¿”ã—è¡Œã†ï¼è©³ã—ãã¯ï¼Œä»¥ä¸‹ã®ãƒãƒ¼ãƒˆã‚’å‚è€ƒã«ã›ã‚ˆï¼ å‚è€ƒï¼šhttps://hiroki-it.github.io/tech-notebook-gitbook/public/infrastructure_software_centos.html 03-02. ã‚¤ãƒ™ãƒ³ãƒˆ ã‚¤ãƒ™ãƒ³ãƒˆ ãƒ»ã‚¤ãƒ™ãƒ³ãƒˆã¨ã¯ ãƒ–ãƒ©ã‚¦ã‚¶ã®å„æ“ä½œã¯ã‚¤ãƒ™ãƒ³ãƒˆã¨ã—ã¦JavaScriptã¾ãŸã¯HTMLã«ç´ä»˜ã‘ã‚‰ã‚Œã¦ã„ã‚‹ï¼ å‚è€ƒï¼šhttps://developer.mozilla.org/ja/docs/Web/Events ãƒ»ã‚¤ãƒ™ãƒ³ãƒˆãƒãƒ³ãƒ‰ãƒ©é–¢æ•°ã¨ã¯ ã‚¤ãƒ™ãƒ³ãƒˆã®ç™ºç«ã«ä¼´ã£ã¦ã‚³ãƒ¼ãƒ«ã•ã‚Œã‚‹é–¢æ•°ã®ã“ã¨ï¼ã‚¤ãƒ™ãƒ³ãƒˆãƒãƒ³ãƒ‰ãƒ©é–¢æ•°ãŒå®Ÿè¡Œã•ã‚Œã‚‹ãŸã³ã«Scriptingå‡¦ç†ãŒç¹°ã‚Šè¿”ã•ã‚Œã‚‹ï¼ HTMLå½¢å¼ã«ãŠã‘ã‚‹ã‚¤ãƒ™ãƒ³ãƒˆãƒãƒ³ãƒ‰ãƒ©é–¢æ•°ã®ã‚³ãƒ¼ãƒ« ãƒ»onload ã€ç”»é¢ã®ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã€ã¨ã„ã†ã‚¤ãƒ™ãƒ³ãƒˆãŒç™ºç«ã™ã‚‹ã¨ï¼Œã‚¤ãƒ™ãƒ³ãƒˆãƒãƒ³ãƒ‰ãƒ©é–¢æ•°ã‚’ã‚³ãƒ¼ãƒ«ã™ã‚‹ï¼ ãƒ»onclick ã€è¦ç´ ã®ã‚¯ãƒªãƒƒã‚¯ã€ã¨ã„ã†ã‚¤ãƒ™ãƒ³ãƒˆãŒç™ºç«ã™ã‚‹ã¨ï¼Œã‚¤ãƒ™ãƒ³ãƒˆãƒãƒ³ãƒ‰ãƒ©é–¢æ•°ã‚’ã‚³ãƒ¼ãƒ«ã™ã‚‹ï¼ function methodA(){ console.log(\"ã‚¤ãƒ™ãƒ³ãƒˆãŒç™ºç«ã—ã¾ã—ãŸ\"); } JSå½¢å¼ã«ãŠã‘ã‚‹ã‚¤ãƒ™ãƒ³ãƒˆãƒãƒ³ãƒ‰ãƒ©é–¢æ•°ã®ã‚³ãƒ¼ãƒ« ãƒ»document.getElementById.onclické–¢æ•° æŒ‡å®šã—ãŸIDã«å¯¾ã—ã¦ï¼Œä¸€ã¤ã®ã‚¤ãƒ™ãƒ³ãƒˆã¨ä¸€ã¤ã®ã‚¤ãƒ™ãƒ³ãƒˆãƒãƒ³ãƒ‰ãƒ©é–¢æ•°ã‚’ç´ä»˜ã‘ã‚‹ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š // æŒ‡å®šã—ãŸIDã§ï¼Œã‚¯ãƒªãƒƒã‚¯ã‚¤ãƒ™ãƒ³ãƒˆãŒç™ºç«ã—ãŸæ™‚ã«ï¼Œå‡¦ç†ã‚’è¡Œã†ï¼ document.getElementById(\"btn\").onclick = () => { console.log(\"ã‚¤ãƒ™ãƒ³ãƒˆãŒç™ºç«ã—ã¾ã—ãŸ\"); } ãƒ»document.addEventListeneré–¢æ•° ä¸€ã¤ã®ã‚¤ãƒ™ãƒ³ãƒˆã«å¯¾ã—ã¦ï¼Œä¸€ã¤ä»¥ä¸Šã®ã‚¤ãƒ™ãƒ³ãƒˆãƒãƒ³ãƒ‰ãƒ©é–¢æ•°ã‚’ç´ä»˜ã‘ã‚‹ï¼ç¬¬ä¸€å¼•æ•°ã§ï¼Œclickãªã©ã®ã‚¤ãƒ™ãƒ³ãƒˆã‚’è¨­å®šã—ï¼Œç¬¬äºŒå¼•æ•°ã§ãƒ¡ã‚½ãƒƒãƒ‰ï¼ˆç„¡åé–¢æ•°ã§ã‚‚å¯ï¼‰ã‚’æ¸¡ã™ï¼falseã‚’è¨­å®šã™ã‚‹ã“ã¨ã§ï¼Œã‚¤ãƒ™ãƒ³ãƒˆãƒãƒ–ãƒªãƒ³ã‚°ã‚’è¡Œã‚ã›ãªã„ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š è¡¨ç¤º const btn = document.getElementById(\"btn\"); btn.addEventListener(\"click\", () => { console.log(\"ã‚¯ãƒªãƒƒã‚¯ã•ã‚Œã¾ã—ãŸï¼\"); },false); // DOMContentLoadedã‚¤ãƒ™ãƒ³ãƒˆãŒç™ºç«ã—ãŸæ™‚ã«ï¼Œå‡¦ç†ã‚’è¡Œã†ï¼ document.addEventListener(\"DOMContentLoaded\", () => { console.log(\"ã‚¤ãƒ™ãƒ³ãƒˆãŒç™ºç«ã—ã¾ã—ãŸ\"); }); // ä¸€ã¤ç›® document.getElementById(\"btn\").addEventListener(\"click\", () => { console.log(\"ã‚¤ãƒ™ãƒ³ãƒˆãŒç™ºç«ã—ã¾ã—ãŸï¼ˆï¼‘ï¼‰\"); }, false); // äºŒã¤ç›® document.getElementById(\"btn\").addEventListener(\"click\", () => { console.log(\"ã‚¤ãƒ™ãƒ³ãƒˆãŒç™ºç«ã—ã¾ã—ãŸï¼ˆï¼’ï¼‰\"); }, false); 04. Renderingå‡¦ç† Renderingå‡¦ç†ã¨ã¯ ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ãƒ„ãƒªãƒ¼ãŒç”Ÿæˆã•ã‚Œï¼Œãƒ–ãƒ©ã‚¦ã‚¶ä¸Šã®ã©ã“ã«ä½•ã‚’æç”»ã™ã‚‹ã®ã‹ã‚’è¨ˆç®—ã™ã‚‹ï¼CalculateStyleå‡¦ç†ã¨Layoutå‡¦ç†ã«åˆ†ã‘ã‚‰ã‚Œã‚‹ï¼ 04-02. CalculateStyleå‡¦ç† CalculateStyleå‡¦ç†ã¨ã¯ ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã‚¨ãƒ³ã‚¸ãƒ³ã¯ï¼ŒDOMãƒ„ãƒªãƒ¼ã®ãƒ«ãƒ¼ãƒˆã®ãƒãƒ¼ãƒ‰ã‹ã‚‰é †ã«CSSOSãƒ„ãƒªãƒ¼ã‚’é©ç”¨ã—ï¼ŒRenderãƒ„ãƒªãƒ¼ã‚’ç”Ÿæˆã™ã‚‹ï¼ 04-03. Layoutå‡¦ç† Layoutå‡¦ç†ã¨ã¯ ä¸Šè¨˜ã§èª­ã¿è¾¼ã¾ã‚ŒãŸHTMLå½¢å¼ãƒ†ã‚­ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã«ã¯ï¼Œãƒã‚¹ãƒˆã•ã‚ŒãŸ 2 ã¤ã® div ãŒã‚ã‚‹ï¼1 ã¤ç›®ï¼ˆè¦ªï¼‰ã®divã‚ˆã‚Šï¼Œãƒãƒ¼ãƒ‰ã®è¡¨ç¤ºã‚µã‚¤ã‚ºã‚’ãƒ“ãƒ¥ãƒ¼ãƒãƒ¼ãƒˆã®å¹…ã® 50% ã«è¨­å®šã—ã€ã“ã®è¦ªã«å«ã¾ã‚Œã¦ã„ã‚‹ 2 ã¤ç›®ï¼ˆå­ï¼‰ã®divã‚ˆã‚Šï¼Œãã®å¹…ã‚’è¦ªã®50%ã€ã¤ã¾ã‚Šãƒ“ãƒ¥ãƒ¼ãƒãƒ¼ãƒˆã®å¹…ã®25%ã«ãªã‚‹ã‚ˆã†ã«ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆã•ã‚Œã‚‹ï¼ 05. Paintå‡¦ç† Paintå‡¦ç†ã¨ã¯ DOMãƒ„ãƒªãƒ¼ã®å„ãƒãƒ¼ãƒ‰ã‚’ï¼Œãƒ–ãƒ©ã‚¦ã‚¶ä¸Šã«æç”»ã™ã‚‹ï¼ 05-02. Rasterizeå‡¦ç† Rasterizeå‡¦ç†ã¨ã¯ 05-03. CompositeLayerså‡¦ç† CompositeLayserså‡¦ç†ã¨ã¯ 06. ã‚­ãƒ£ãƒƒã‚·ãƒ¥ ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã¨ã¯ é™çš„ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ï¼ˆHTMLï¼ŒJavaScriptï¼ŒCSSï¼Œç”»åƒï¼‰ã‚’ãƒ‡ãƒ¼ã‚¿ã‚’ä¿å­˜ã—ã¦ãŠãï¼Œå†åˆ©ç”¨ã™ã‚‹ã“ã¨ã«ã‚ˆã£ã¦ï¼Œå‡¦ç†é€Ÿåº¦ã‚’é«˜ã‚ã‚‹ä»•çµ„ã¿ã®ã“ã¨ï¼ ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã®ä¿å­˜å ´æ‰€ã®ç¨®é¡ ãƒ»ãƒ–ãƒ©ã‚¦ã‚¶ã«ãŠã‘ã‚‹ã‚­ãƒ£ãƒƒã‚·ãƒ¥ ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã®ãƒ–ãƒ©ã‚¦ã‚¶ã«ãŠã„ã¦ï¼Œãƒ¬ã‚¹ãƒãƒ³ã‚¹ã•ã‚ŒãŸé™çš„ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ãŒã‚­ãƒ£ãƒƒã‚·ãƒ¥ã¨ã—ã¦ä¿å­˜ã•ã‚Œã‚‹ï¼Chromeã®å ´åˆã¯ï¼ŒCacheStorageã«ä¿æŒã•ã‚Œã‚‹ï¼ç¢ºèªæ–¹æ³•ã«ã¤ã„ã¦ã¯ï¼Œä»¥ä¸‹ã®ãƒªãƒ³ã‚¯ã‚’å‚è€ƒã«ã›ã‚ˆï¼ å‚è€ƒï¼šhttps://developer.chrome.com/docs/devtools/storage/cache/ ãƒ»ãƒªãƒãƒ¼ã‚¹Proxyã‚µãƒ¼ãƒã«ãŠã‘ã‚‹ã‚­ãƒ£ãƒƒã‚·ãƒ¥ ãƒªãƒãƒ¼ã‚¹Proxyã‚µãƒ¼ãƒã«ãŠã„ã¦ï¼Œãƒ¬ã‚¹ãƒãƒ³ã‚¹ã•ã‚ŒãŸé™çš„ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ãŒã‚­ãƒ£ãƒƒã‚·ãƒ¥ã¨ã—ã¦ä¿å­˜ã•ã‚Œã‚‹ï¼AWSã§ã¯ï¼ŒCloudFrontã«ãŠã‘ã‚‹ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãŒã“ã‚Œã«ç›¸å½“ã™ã‚‹ï¼ ãƒ»ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã«ãŠã‘ã‚‹ã‚­ãƒ£ãƒƒã‚·ãƒ¥ ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã«ãŠã„ã¦ï¼Œãƒ¡ã‚½ãƒƒãƒ‰å‡¦ç†çµæœãŒã‚­ãƒ£ãƒƒã‚·ãƒ¥ã¨ã—ã¦ä¿å­˜ã•ã‚Œã‚‹ï¼å¿…è¦ãªå ´åˆã«ï¼Œã“ã‚Œã‚’å–ã‚Šå‡ºã—ã¦å†åˆ©ç”¨ã™ã‚‹ï¼Laravelã®ã‚­ãƒ£ãƒƒã‚·ãƒ¥æ©Ÿèƒ½ã«ã¤ã„ã¦ã¯ï¼Œä»¥ä¸‹ã®ãƒªãƒ³ã‚¯ã‚’å‚è€ƒã«ã›ã‚ˆï¼ å‚è€ƒï¼šhttps://readouble.com/laravel/8.x/ja/cache.html ã‚µãƒ¼ãƒå´ã§ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã™ã¹ãã§ãªã„ãƒ‡ãƒ¼ã‚¿ ãƒªãƒãƒ¼ã‚¹Proxyã‚µãƒ¼ãƒï¼ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã«ãŠã„ã¦ï¼Œã‚­ãƒ£ãƒƒã‚·ãƒ¥ã™ã¹ãã§ãªã„ãƒ‡ãƒ¼ã‚¿ã‚’æŒã¤ãƒšãƒ¼ã‚¸ãŒã‚ã‚‹ï¼ ãƒšãƒ¼ã‚¸ ç†ç”± Formèªè¨¼ãƒšãƒ¼ã‚¸ ç„¡é–¢ä¿‚ã®ãƒ¦ãƒ¼ã‚¶ã«èªè¨¼æ¸ˆã¿ã®ãƒšãƒ¼ã‚¸ãŒè¿”ä¿¡ã•ã‚Œã¦ã—ã¾ã†ï¼ ç·¯åº¦çµŒåº¦ï¼ãƒ•ãƒªãƒ¼ãƒ¯ãƒ¼ãƒ‰ã«åŸºã¥ãæ¤œç´¢çµæœãƒšãƒ¼ã‚¸ ãƒ‘ã‚¿ãƒ¼ãƒ³æ•°ãŒå¤šãï¼Œå…¨ã¦ã®ãƒšãƒ¼ã‚¸ã‚’ç¶²ç¾…ã™ã‚‹ã“ã¨ãŒç¾å®Ÿçš„ã§ãªã„ï¼ ãƒ–ãƒ©ã‚¦ã‚¶ã‚­ãƒ£ãƒƒã‚·ãƒ¥ä½¿ç”¨ï¼ä¸ä½¿ç”¨ã®æ¤œè¨¼ ãƒ»ETagå€¤ã«ã‚ˆã‚‹æ¤œè¨¼ === ï¼ˆï¼‘ï¼‰ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã®æœ‰åŠ¹æ™‚é–“ãŒåˆ‡ã‚Œã‚‹ã¾ã§ === ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã®ãƒ–ãƒ©ã‚¦ã‚¶ã¯ï¼Œãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’ã‚µãƒ¼ãƒã«é€ä¿¡ã™ã‚‹ï¼ ã‚µãƒ¼ãƒã¯ï¼Œç‰¹å®šã®ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã‚’ä½¿ç”¨ã—ã¦ãƒãƒƒã‚·ãƒ¥å€¤ã‚’ç”Ÿæˆã—ï¼Œã“ã‚Œã‚’ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã®ETagå€¤ã¨ã™ã‚‹ï¼ ã‚µãƒ¼ãƒã¯ï¼ŒETagãƒ˜ãƒƒãƒ€ãƒ¼ã«ETagå€¤ã‚’è¨­å®šã—ï¼Œã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã¨ã¨ã‚‚ã«ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã«é€ä¿¡ã™ã‚‹ï¼ ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã®ãƒ–ãƒ©ã‚¦ã‚¶ã¯ï¼Œã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã¨ETagå€¤ã‚’ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã™ã‚‹ï¼ ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã®æœ‰åŠ¹æ™‚é–“ãŒåˆ‡ã‚Œã‚‹ã¾ã§ï¼Œãƒ–ãƒ©ã‚¦ã‚¶ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’ä½¿ç”¨ã—ç¶šã‘ã‚‹ï¼ === ï¼ˆï¼’ï¼‰ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã®æœ‰åŠ¹æ™‚é–“ãŒåˆ‡ã‚ŒãŸå¾Œ === ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã®æœ‰åŠ¹æ™‚é–“ãŒåˆ‡ã‚Œã‚‹ï¼ ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã®ãƒ–ãƒ©ã‚¦ã‚¶ã¯ï¼Œãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’ã‚µãƒ¼ãƒã«é€ä¿¡ã™ã‚‹ï¼ã“ã®æ™‚ï¼ŒIf-None-Matchãƒ˜ãƒƒãƒ€ãƒ¼ã«ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã—ã¦ãŠã„ãŸETagå€¤ã‚’è¨­å®šã™ã‚‹ï¼ ã‚µãƒ¼ãƒã¯ï¼Œé€ä¿¡ã•ã‚ŒãŸETagå€¤ã¨ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã®ETagå€¤ã‚’æ¯”è¼ƒæ¤œè¨¼ã™ã‚‹ï¼ === ï¼ˆï¼“ï¼‰æ¤œè¨¼ã«ã‚ˆã‚Šï¼Œãƒ–ãƒ©ã‚¦ã‚¶ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’ä½¿ç”¨ === ETagå€¤ã®æ¯”è¼ƒæ¤œè¨¼ã®çµæœï¼Œä¸€è‡´ã™ã‚‹ï¼ ã‚µãƒ¼ãƒã¯ï¼Œä¸¡æ–¹ã®å€¤ãŒä¸€è‡´ã™ã‚‹å ´åˆï¼Œ304ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã§ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã«é€ä¿¡ã™ã‚‹ï¼ ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã®ãƒ–ãƒ©ã‚¦ã‚¶ã¯ï¼Œã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’ä½¿ç”¨ã™ã‚‹ï¼ === ï¼ˆï¼”ï¼‰æ¤œè¨¼ã«ã‚ˆã‚Šï¼Œãƒ–ãƒ©ã‚¦ã‚¶ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’ä½¿ç”¨ã›ãš === ETagå€¤ã®æ¯”è¼ƒæ¤œè¨¼ã®çµæœï¼Œä¸€è‡´ã—ãªã„ï¼ ã‚µãƒ¼ãƒã¯ï¼Œä¸¡æ–¹ã®å€¤ãŒä¸€è‡´ã—ãªã„å ´åˆï¼ŒETagå€¤ã‚’ç”Ÿæˆã—ï¼Œã“ã‚Œã‚’ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã®æ–°ã—ã„ETagå€¤ã¨ã™ã‚‹ï¼ ã‚µãƒ¼ãƒã¯ï¼ŒETagãƒ˜ãƒƒãƒ€ãƒ¼ã«ETagå€¤ã‚’è¨­å®šã—ï¼Œã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã¨ã¨ã‚‚ã«ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã«é€ä¿¡ã™ã‚‹ï¼ ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã®ãƒ–ãƒ©ã‚¦ã‚¶ã¯ï¼Œã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã¨ETagå€¤ã‚’ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã™ã‚‹ï¼ ãƒ–ãƒ©ã‚¦ã‚¶ã‚­ãƒ£ãƒƒã‚·ãƒ¥æ™‚é–“ã®å®šç¾© ãƒ»ãƒ–ãƒ©ã‚¦ã‚¶ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãªã— ãƒ¬ã‚¹ãƒãƒ³ã‚¹ãƒ˜ãƒƒãƒ€ãƒ¼ã«ã¦ï¼ŒCache-Controlãƒ˜ãƒƒãƒ€ãƒ¼ã«no-storeã‚’è¨­å®šã™ã‚‹ï¼ã“ã®å ´åˆï¼ŒETagå€¤ãŒç„¡åŠ¹ã«ãªã‚Šï¼Œãƒ–ãƒ©ã‚¦ã‚¶ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’ä½¿ç”¨ã—ãªããªã‚‹ï¼ HTTP/1.1 200 # ï½ ä¸­ç•¥ ï½ Cache-Control: no-store # ï½ ä¸­ç•¥ ï½ # ãƒœãƒ‡ã‚£ ã“ã“ã«ã‚µã‚¤ãƒˆã®HTMLã®ã‚³ãƒ¼ãƒ‰ ãƒ»ãƒ–ãƒ©ã‚¦ã‚¶ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚ã‚Šï¼ˆæœ‰åŠ¹æ™‚é–“ã‚ã‚Šï¼‰ ãƒ¬ã‚¹ãƒãƒ³ã‚¹ãƒ˜ãƒƒãƒ€ãƒ¼ã«ã¦ï¼ŒCache-Controlãƒ˜ãƒƒãƒ€ãƒ¼ã«max-age=31536000ã‚’è¨­å®šã™ã‚‹ï¼Expireãƒ˜ãƒƒãƒ€ãƒ¼ã«æœ‰åŠ¹æ™‚é–“ã‚’è¨­å®šã—ã¦ã‚‚è‰¯ã„ãŒï¼ŒCache-Controlãƒ˜ãƒƒãƒ€ãƒ¼ã®æœ‰åŠ¹æ™‚é–“ãŒå„ªå…ˆã•ã‚Œã‚‹ï¼ã“ã®å ´åˆï¼Œæœ‰åŠ¹æ™‚é–“ã‚’éãã‚‹ã¨ï¼ŒETagå€¤ã‚’æ¯”è¼ƒæ¤œè¨¼ã™ã‚‹ã‚ˆã†ã«ãªã‚‹ï¼ HTTP/1.1 200 # ï½ ä¸­ç•¥ ï½ Cache-Control: max-age=31536000 # ï½ ä¸­ç•¥ ï½ # ãƒœãƒ‡ã‚£ ã“ã“ã«ã‚µã‚¤ãƒˆã®HTMLã®ã‚³ãƒ¼ãƒ‰ ãƒ»ãƒ–ãƒ©ã‚¦ã‚¶ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚ã‚Šï¼ˆæœ‰åŠ¹æ™‚é–“ãªã—ï¼‰ ãƒ¬ã‚¹ãƒãƒ³ã‚¹ãƒ˜ãƒƒãƒ€ãƒ¼ã«ã¦ï¼ŒCache-Controlãƒ˜ãƒƒãƒ€ãƒ¼ã«max-age=0ã‚’è¨­å®šã™ã‚‹ï¼ã¾ãŸï¼ŒExpireãƒ˜ãƒƒãƒ€ãƒ¼ã«æœŸé™åˆ‡ã‚Œã®æ—¥æ™‚ã‚’è¨­å®šã™ã‚‹ï¼ã“ã®å ´åˆï¼Œæ¯å›ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆæ™‚ã«ETagå€¤ã‚’æ¯”è¼ƒæ¤œè¨¼ã™ã‚‹ã‚ˆã†ã«ãªã‚‹ï¼ HTTP/1.1 200 # ï½ ä¸­ç•¥ ï½ Cache-Control: max-age=0 Expires: Sat, 01 Jan 2000 00:00:00 GMT # ï½ ä¸­ç•¥ ï½ # ãƒœãƒ‡ã‚£ ã“ã“ã«ã‚µã‚¤ãƒˆã®HTMLã®ã‚³ãƒ¼ãƒ‰ "},"public/hardware/hardware.html":{"url":"public/hardware/hardware.html","title":"ğŸ“– ï¸ãƒãƒ¼ãƒ‰ã‚¦ã‚§ã‚¢","keywords":"","body":"ãƒãƒ¼ãƒ‰ã‚¦ã‚§ã‚¢ ã¯ã˜ã‚ã« æœ¬ã‚µã‚¤ãƒˆã«ã¤ãã¾ã—ã¦ï¼Œä»¥ä¸‹ã‚’ã”èªè­˜ã®ã»ã©å®œã—ããŠé¡˜ã„ã„ãŸã—ã¾ã™ï¼ å‚è€ƒï¼šhttps://hiroki-it.github.io/tech-notebook-gitbook/ 01. ãƒãƒ¼ãƒ‰ã‚¦ã‚§ã‚¢ã¨ã¯ ãƒãƒ¼ãƒ‰ã‚¦ã‚§ã‚¢ã®ç¨®é¡ ãƒ»ãƒ¦ãƒ¼ã‚¶ã®æ“ä½œãŒï¼Œã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ã‚’ä»‹ã—ã¦ï¼Œãƒãƒ¼ãƒ‰ã‚¦ã‚§ã‚¢ã«ä¼ã‚ã‚‹ã¾ã§ ãƒ»CPUï¼ˆãƒ—ãƒ­ã‚»ãƒƒã‚µï¼‰ CPUã¯åˆ¶å¾¡ã¨æ¼”ç®—ã‚’è¡Œã†ï¼CPUã®åˆ¶å¾¡éƒ¨åˆ†ã¯ï¼Œãƒ—ãƒ­ã‚°ãƒ©ãƒ ã®å‘½ä»¤ã‚’è§£é‡ˆã—ã¦ï¼Œã‚³ãƒ³ãƒ”ãƒ¥ãƒ¼ã‚¿å…¨ä½“ã‚’åˆ¶å¾¡ï¼CPUã®æ¼”ç®—éƒ¨åˆ†ã¯ï¼Œè¨ˆç®—ã‚„æ¼”ç®—å‡¦ç†ã‚’è¡Œã†ï¼ç‰¹ã«ï¼Œã€ç®—è¡“è«–ç†æ¼”ç®—è£…ç½®ï¼ˆALUï¼šArithmetic and Logic Unitï¼‰ã€ã¨ã‚‚å‘¼ã¶ï¼ ãƒ»RAMï¼ˆãƒ¡ã‚¤ãƒ³ãƒ¡ãƒ¢ãƒªï¼‹ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãƒ¡ãƒ¢ãƒªï¼‰ ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã‚„ãƒ‡ãƒ¼ã‚¿ã‚’ä¸€æ™‚çš„ã«è¨˜æ†¶ã—ï¼Œã‚³ãƒ³ãƒ”ãƒ¥ãƒ¼ã‚¿ã®é›»æºã‚’åˆ‡ã‚‹ã¨ã“ã‚Œã‚‰ã¯æ¶ˆãˆã‚‹ï¼ ãƒ»ROM ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã‚„ãƒ‡ãƒ¼ã‚¿ã‚’é•·æœŸçš„ã«è¨˜æ†¶ã—ï¼Œã‚³ãƒ³ãƒ”ãƒ¥ãƒ¼ã‚¿ã®é›»æºã‚’åˆ‡ã£ã¦ã‚‚ã“ã‚Œã‚‰ã¯æ¶ˆãˆãªã„ï¼ ãƒ»ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ï¼ˆHDD vs SSDï¼‰ HDDï¼šHard Disk Driveã¨SSDï¼šSolid State DriveãŒã‚ã‚‹ï¼ ãƒ»å…¥åŠ›è£…ç½® ã‚³ãƒ³ãƒ”ãƒ¥ãƒ¼ã‚¿ã«ãƒ‡ãƒ¼ã‚¿ã‚’å…¥åŠ›ï¼ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ï¼Œãƒã‚¦ã‚¹ï¼Œã‚¹ã‚­ãƒ£ãƒŠãªã©ï¼ ãƒ»å‡ºåŠ›è£…ç½® ã‚³ãƒ³ãƒ”ãƒ¥ãƒ¼ã‚¿ã‹ã‚‰ãƒ‡ãƒ¼ã‚¿ã‚’å‡ºåŠ›ï¼ãƒ‡ã‚£ã‚¹ãƒ—ãƒ¬ã‚¤ï¼Œãƒ—ãƒªãƒ³ã‚¿ãªã©ï¼ 02. CPUï¼ˆãƒ—ãƒ­ã‚»ãƒƒã‚µï¼‰ Intelã¨AMDã«ãŠã‘ã‚‹CPUã®æ­´å²ï¼ˆâ€»2009å¹´ã¾ã§ï¼‰ ã‚¯ãƒ­ãƒƒã‚¯å‘¨æ³¢æ•° CPUã®å›è·¯ãŒå‡¦ç†ã¨æ­©èª¿ã‚’åˆã‚ã›ã‚‹ãŸã‚ã«ç”¨ã„ã‚‹ä¿¡å·ã‚’ï¼Œã€ã‚¯ãƒ­ãƒƒã‚¯ã€ã¨è¨€ã†ï¼ä¸€å®šæ™‚é–“ã”ã¨ã«ã‚¯ãƒ­ãƒƒã‚¯ãŒèµ·ã“ã‚‹æ™‚ï¼Œï¼‘ç§’é–“ã«ã‚¯ãƒ­ãƒƒã‚¯ãŒä½•å›èµ·ã“ã‚‹ã‹ã‚’ã€ã‚¯ãƒ­ãƒƒã‚¯å‘¨æ³¢æ•°ã€ã¨ã„ã†ï¼ã“ã‚Œã¯ï¼ŒHzã§è¡¨ã•ã‚Œã‚‹ï¼ã¡ãªã¿ã«ï¼Œãƒ¯ã‚¤ã®ãƒ‘ã‚½ã‚³ãƒ³ã®ã‚¯ãƒ­ãƒƒã‚¯å‘¨æ³¢æ•°ã¯2.60GHzã§ã—ãŸï¼ ï¼ˆä¾‹1ï¼‰ 3Hz = 3 (ã‚¯ãƒ­ãƒƒã‚¯æ•°ï¼ç§’) ï¼ˆä¾‹2ï¼‰ 2.6GHz = 2.6Ã—10^9 (ã‚¯ãƒ­ãƒƒã‚¯æ•°ï¼ç§’) MIPSï¼šMillion Instructions Per Secondï¼ˆÃ—10^6 å‘½ä»¤æ•°ï¼ç§’ï¼‰ CPUãŒ1ç§’é–“ã«ä½•å›å‘½ä»¤ã‚’å®Ÿè¡Œã™ã‚‹ã‹ã‚’è¡¨ã™ï¼ ï¼ˆä¾‹é¡Œï¼‰ (å‘½ä»¤å½“ãŸã‚Šã®å¹³å‡ã‚¯ãƒ­ãƒƒã‚¯æ•°) = (4Ã—0.3)ï¼‹(8Ã—0.6)ï¼‹(10Ã—0.1) = 7 (ã‚¯ãƒ­ãƒƒã‚¯å‘¨æ³¢æ•°) Ã· (ã‚¯ãƒ­ãƒƒã‚¯å½“ãŸã‚Šã®å‘½ä»¤æ•°) = 700Hz (Ã—10^6 ã‚¯ãƒ­ãƒƒã‚¯æ•°ï¼ç§’) Ã· 7 (ã‚¯ãƒ­ãƒƒã‚¯æ•°ï¼å‘½ä»¤) = 100 (Ã—10^6 å‘½ä»¤æ•°ï¼ç§’) ãƒ»1å‘½ä»¤å½“ãŸã‚Šã®å®Ÿè¡Œæ™‚é–“ (ç§’ï¼å‘½ä»¤) ã®æ±‚ã‚æ–¹ 1 Ã· 100 (Ã—10^6 å‘½ä»¤ï¼ç§’) = 10n (ç§’ï¼å‘½ä»¤) 03. ãƒ¡ãƒ¢ãƒª å‚è€ƒï¼šhttps://hiroki-it.github.io/tech-notebook-gitbook/public/hardware/hardware_memory.html 04. ãƒ‡ã‚£ã‚¹ã‚¯ãƒ¡ãƒ¢ãƒª CPUï¼Œãƒ¡ã‚¤ãƒ³ãƒ¡ãƒ¢ãƒªï¼Œã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸é–“ã«ã¯ï¼Œèª­ã¿è¾¼ã¿ã¨æ›¸ãå‡ºã—ã®å‡¦ç†é€Ÿåº¦ã«å·®ãŒã‚ã‚‹ï¼ï¼ˆâ€»å†åº¦è¨˜è¼‰ï¼‰ ãƒ‡ã‚£ã‚¹ã‚¯ãƒ¡ãƒ¢ãƒªã®æ©Ÿèƒ½ ãƒ¡ã‚¤ãƒ³ãƒ¡ãƒ¢ãƒªã¨ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã®é–“ã«ï¼Œãƒ‡ã‚£ã‚¹ã‚¯ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’è¨­ç½®ã—ï¼Œèª­ã¿è¾¼ã¿ã¨æ›¸ãå‡ºã—ã®å‡¦ç†é€Ÿåº¦ã®å·®ã‚’ç·©å’Œã•ã›ã‚‹ï¼ 05. HDD Defragmentation æ–­ç‰‡åŒ–ã•ã‚ŒãŸãƒ‡ãƒ¼ã‚¿é ˜åŸŸã‚’æ•´ç†æ•´é “ã™ã‚‹ï¼ RAIDï¼šRedundant Arrays of Inexpensive Disks è¤‡æ•°ã®HDDã‚’ä»®æƒ³çš„ã«ä¸€ã¤ã®HDDã§ã‚ã‚‹ã‹ã®ã‚ˆã†ã«ã—ã¦ï¼Œãƒ‡ãƒ¼ã‚¿ã‚’ç®¡ç†ã™ã‚‹æŠ€è¡“ï¼ ãƒ»RAID0ï¼ˆStripingï¼‰ ãƒ‡ãƒ¼ã‚¿ã‚’ï¼Œè¤‡æ•°ã®HDDã«åˆ†å‰²ã—ã¦æ›¸ãè¾¼ã‚€ï¼ ãƒ»RAID1ï¼ˆMirroringï¼‰ ãƒ‡ãƒ¼ã‚¿ã‚’ï¼Œè¤‡æ•°ã®HDDã«åŒã˜ã‚ˆã†ã«æ›¸ãè¾¼ã‚€ï¼ ãƒ»RAID5ï¼ˆStriping with parityï¼‰ ãƒ‡ãƒ¼ã‚¿ã¨ãƒ‘ãƒªãƒ†ã‚£ï¼ˆèª¤ã‚Šè¨‚æ­£ç¬¦å·ï¼‰ã‚’ï¼Œ3ã¤ä»¥ä¸Šã®HDDã«æ›¸ãè¾¼ã‚€ï¼ 06. GPUã¨VRAM GPUã¨VRAMã®å®¹é‡ã«ã‚ˆã£ã¦ï¼Œæ‰±ã†ã“ã¨ã®ã§ãã‚‹è§£åƒåº¦ã¨è‰²æ•°ãŒæ±ºã¾ã‚‹ï¼ å¯Œå£«é€šPCã®GPUã¨VRAMã®å®¹é‡ã¯ï¼Œä»¥ä¸‹ã®é€šã‚Šï¼ è‰²æ•°ã«ã‚ˆã£ã¦ï¼Œï¼‘ãƒ‰ãƒƒãƒˆå½“ãŸã‚Šä½•ãƒ“ãƒƒãƒˆã‚’è¦ã™ã‚‹ãŒç•°ãªã‚‹ï¼ "},"public/hardware/hardware_memory.html":{"url":"public/hardware/hardware_memory.html","title":"ğŸ“– ï¸ãƒ¡ãƒ¢ãƒª","keywords":"","body":"ãƒ¡ãƒ¢ãƒª ã¯ã˜ã‚ã« æœ¬ã‚µã‚¤ãƒˆã«ã¤ãã¾ã—ã¦ï¼Œä»¥ä¸‹ã‚’ã”èªè­˜ã®ã»ã©å®œã—ããŠé¡˜ã„ã„ãŸã—ã¾ã™ï¼ å‚è€ƒï¼šhttps://hiroki-it.github.io/tech-notebook-gitbook/ 01. ç‰©ç†ãƒ¡ãƒ¢ãƒªï¼ˆRAM + ROMï¼‰ ç‰©ç†ãƒ¡ãƒ¢ãƒªã®ç¨®é¡ ã€ç‰©ç†ãƒ¡ãƒ¢ãƒªã€ã¯ï¼ŒRAMã¨ROMã«å¤§ããåˆ†ã‘ã‚‰ã‚Œã‚‹ï¼ RAMï¼šRead Access Memory RAMã¯ï¼Œãƒ¡ã‚¤ãƒ³ãƒ¡ãƒ¢ãƒªã¨ã—ã¦ä½¿ã‚ã‚Œã‚‹ã€Dynamic RAMã€ã¨ï¼Œã‚­ãƒ£ãƒƒã‚·ãƒ¥ãƒ¡ãƒ¢ãƒªã¨ã—ã¦ä½¿ã‚ã‚Œã‚‹ã€Static RAMã€ã«åˆ†é¡ã•ã‚Œã‚‹ï¼ ãƒ»Dynamic RAM ãƒ¡ã‚¤ãƒ³ãƒ¡ãƒ¢ãƒªã¨ã—ã¦ç”¨ã„ã‚‰ã‚Œã‚‹ï¼ã‚ˆãè¦‹ã‚‹ã‚„ã¤ï¼ ãƒ»Static RAM ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãƒ¡ãƒ¢ãƒªã¨ã—ã¦ç”¨ã„ã‚‰ã‚Œã‚‹ï¼ ROMï¼šRead Only Memory ãƒ»Mask ROM ãƒ»Programmable ROM Garbage collection ãƒ—ãƒ­ã‚°ãƒ©ãƒ ãŒç¢ºä¿ã—ãŸãƒ¡ãƒ¢ãƒªé ˜åŸŸã®ã†ã¡ï¼Œä¸è¦ã«ãªã£ãŸé ˜åŸŸã‚’è‡ªå‹•çš„ã«è§£æ”¾ã™ã‚‹æ©Ÿèƒ½ï¼ ãƒ»Javaã«ãŠã‘ã‚‹Garbage collection Javaã§ã¯ï¼ŒJVMï¼šJava Virtual Machineï¼ˆJavaä»®æƒ³ãƒã‚·ãƒ³ï¼‰ãŒï¼Œãƒ¡ãƒ¢ãƒªé ˜åŸŸã‚’ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã«è‡ªå‹•çš„ã«å‰²ã‚Šå½“ã¦ï¼Œã¾ãŸä¸€æ–¹ã§ï¼Œä¸è¦ã«ãªã£ãŸãƒ¡ãƒ¢ãƒªé ˜åŸŸã®è§£æ”¾ã‚’è¡Œã†ï¼ä¸€æ–¹ã§è‡ªå‹•çš„ã«è¡Œã†ï¼ 02. SRAM CPUã‹ã‚‰å‘½ä»¤ãŒèµ·ã“ã‚‹ã¨ãï¼ŒCPUï¼ŒDRAMï¼Œã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸é–“ã«ã¯ï¼Œèª­ã¿è¾¼ã¿ã¨æ›¸ãå‡ºã—ã®å‡¦ç†é€Ÿåº¦ã«å·®ãŒã‚ã‚‹ï¼ ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãƒ¡ãƒ¢ãƒªã¨ã¯ ãƒ»ä¸€æ¬¡ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãƒ¡ãƒ¢ãƒªã¨äºŒæ¬¡ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãƒ¡ãƒ¢ãƒª** CPUã¨ãƒ¡ã‚¤ãƒ³ãƒ¡ãƒ¢ãƒªã®é–“ã«ï¼Œã‚­ãƒ£ãƒƒã‚·ãƒ¥ãƒ¡ãƒ¢ãƒªã‚’ä½•æ®µéšã‹è¨­ç½®ã—ï¼ŒCPUã¨ãƒ¡ã‚¤ãƒ³ãƒ¡ãƒ¢ãƒªã®é–“ã®èª­ã¿è¾¼ã¿ã¨æ›¸ãå‡ºã—ã®å‡¦ç†é€Ÿåº¦ã®å·®ã‚’ç·©å’Œã•ã›ã‚‹ï¼ ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãƒ¡ãƒ¢ãƒªã®èª­ã¿è¾¼ã¿æ–¹æ³• ãƒ»ãƒ¦ãƒ¼ã‚¶ãƒ¼ â” ãƒ¡ã‚¤ãƒ³ãƒ¡ãƒ¢ãƒª â” äºŒæ¬¡ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãƒ¡ãƒ¢ãƒª â” ä¸€æ¬¡ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãƒ¡ãƒ¢ãƒª ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒï¼Œãƒ‘ã‚½ã‚³ãƒ³ã«å¯¾ã—ã¦å‘½ä»¤ã‚’ä¸ãˆã‚‹ï¼ CPUã¯ï¼Œå‘½ä»¤ã‚’ãƒ¡ã‚¤ãƒ³ãƒ¡ãƒ¢ãƒªã«æ›¸ãè¾¼ã‚€ï¼ CPUã¯ï¼Œãƒ¡ã‚¤ãƒ³ãƒ¡ãƒ¢ãƒªã‹ã‚‰å‘½ä»¤ã‚’èª­ã¿å‡ºã™ï¼ CPUã¯ï¼ŒäºŒæ¬¡ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãƒ¡ãƒ¢ãƒªã«æ›¸ãè¾¼ã‚€ï¼ CPUã¯ï¼Œä¸€æ¬¡ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãƒ¡ãƒ¢ãƒªã«æ›¸ãè¾¼ã‚€ï¼ CPUã¯ï¼Œå‘½ä»¤ã‚’å®Ÿè¡Œã™ã‚‹ï¼ ãƒ»å®Ÿä¾‹ ã‚¿ã‚¹ã‚¯ãƒãƒãƒ¼ã‚¸ãƒ£ã®ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã‚¿ãƒ–ã§ï¼Œnæ¬¡ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãƒ¡ãƒ¢ãƒªãŒã©ã®ãã‚‰ã„ä½¿ã‚ã‚Œã¦ã„ã‚‹ã®ã‹ã‚’ç¢ºèªã§ãã‚‹ï¼ ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãƒ¡ãƒ¢ãƒªã¸ã®æ›¸ãè¾¼ã¿æ–¹å¼ã®ç¨®é¡ ãƒ»Write-throughtæ–¹å¼ CPUã¯ï¼Œå‘½ä»¤ã‚’ãƒ¡ã‚¤ãƒ³ãƒ¡ãƒ¢ãƒªã¨ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãƒ¡ãƒ¢ãƒªã®ä¸¡æ–¹ã«æ›¸ãè¾¼ã‚€ï¼å¸¸ã«ãƒ¡ã‚¤ãƒ³ãƒ¡ãƒ¢ãƒªã¨ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãƒ¡ãƒ¢ãƒªã®å†…å®¹ãŒä¸€è‡´ã—ã¦ã„ã‚‹çŠ¶æ…‹ã‚’ç¢ºä¿ã§ãã‚‹ãŒï¼Œãƒ¡ãƒ¢ãƒªã¸ã®æ›¸ãè¾¼ã¿ãŒé »ç¹ã«è¡Œã‚ã‚Œã‚‹ã®ã§é…ã„ï¼ ãƒ»Write-backæ–¹å¼ CPUã¯ï¼Œã‚­ãƒ£ãƒƒã‚·ãƒ¥ãƒ¡ãƒ¢ãƒªã®ã¿ã«æ›¸ãè¾¼ã‚€ï¼æ¬¡ã«ï¼Œã‚­ãƒ£ãƒƒã‚·ãƒ¥ãƒ¡ãƒ¢ãƒªãŒãƒ¡ã‚¤ãƒ³ãƒ¡ãƒ¢ãƒªã«æ›¸ãè¾¼ã‚€ï¼ãƒ¡ã‚¤ãƒ³ãƒ¡ãƒ¢ãƒªã¨ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãƒ¡ãƒ¢ãƒªã®å†…å®¹ãŒä¸€è‡´ã—ã¦ã„ã‚‹çŠ¶æ…‹ã‚’å¿…ãšã—ã‚‚ç¢ºä¿ã§ããªã„ãŒï¼Œãƒ¡ã‚¤ãƒ³ãƒ¡ãƒ¢ãƒªã¸ã®æ›¸ãè¾¼ã¿å›æ•°ãŒå°‘ãªã„ãŸã‚é€Ÿã„ å®ŸåŠ¹ã‚¢ã‚¯ã‚»ã‚¹æ™‚é–“ 03. ã‚¢ãƒ‰ãƒ¬ã‚¹ç©ºé–“ç®¡ç†ã®ç¨®é¡ å‰ç½®ã è¨€è‘‰ã®ä½¿ã„æ–¹ã‚’ï¼Œä»¥ä¸‹ã«çµ±ä¸€ã™ã‚‹ï¼ ä¸»è¨˜æ†¶ â‡’ ç‰©ç†ãƒ¡ãƒ¢ãƒªï¼ˆãƒ¡ã‚¤ãƒ³ãƒ¡ãƒ¢ãƒªï¼‹ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãƒ¡ãƒ¢ãƒªï¼‰ è£œåŠ©è¨˜æ†¶ â‡’ ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ ä»®æƒ³è¨˜æ†¶ â‡’ ä»®æƒ³ãƒ¡ãƒ¢ãƒª ç‰©ç†ãƒ¡ãƒ¢ãƒªã®ã‚¢ãƒ‰ãƒ¬ã‚¹ç©ºé–“ç®¡ç† ãƒ»åŒºç”»æ–¹å¼ å¾Œè¿°ã®èª¬æ˜ã‚’å‚è€ƒã«ã›ã‚ˆï¼ ãƒ»ã‚¹ãƒ¯ãƒƒãƒ”ãƒ³ã‚°æ–¹å¼ å¾Œè¿°ã®èª¬æ˜ã‚’å‚è€ƒã«ã›ã‚ˆï¼ ãƒ»ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤æ–¹å¼ å¾Œè¿°ã®èª¬æ˜ã‚’å‚è€ƒã«ã›ã‚ˆï¼ ä»®æƒ³ãƒ¡ãƒ¢ãƒªã®ã‚¢ãƒ‰ãƒ¬ã‚¹ç©ºé–“ç®¡ç† ãƒ»ãƒšãƒ¼ã‚¸ãƒ³ã‚°æ–¹å¼ å¾Œè¿°ã®èª¬æ˜ã‚’å‚è€ƒã«ã›ã‚ˆï¼ 03-02. ç‰©ç†ãƒ¡ãƒ¢ãƒªã®ã‚¢ãƒ‰ãƒ¬ã‚¹ç©ºé–“ç®¡ç† å›ºå®šåŒºç”»æ–¹å¼ï¼ˆåŒã˜å¤§ãã•ã®åŒºç”»ã«åˆ†å‰²ã™ã‚‹æ–¹å¼ï¼‰ ãƒ»å˜ä¸€åŒºç”»æ–¹å¼ã¨ã¯ ç‰©ç†ãƒ¡ãƒ¢ãƒªã®é ˜åŸŸã‚’ï¼Œä¸€ã¤ã®åŒºç”»ã¨ã—ã¦æ‰±ã„ï¼Œãƒ—ãƒ­ã‚°ãƒ©ãƒ ã«å‰²ã‚Šå½“ã¦ã‚‹æ–¹å¼ï¼å˜ä¸€ã®ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã—ã‹èª­ã¿è¾¼ã‚ãšï¼Œä½™ã‚Šã®ãƒ¡ãƒ¢ãƒªé ˜åŸŸã¯åˆ©ç”¨ã§ããªã„ï¼ ãƒ»å¤šé‡åŒºç”»æ–¹å¼ã¨ã¯ ç‰©ç†ãƒ¡ãƒ¢ãƒªã®é ˜åŸŸã‚’ï¼Œè¤‡æ•°ã®åŒã˜å¤§ãã•ã®åŒºç”»ã«åˆ†å‰²ã—ï¼Œå„åŒºç”»ã«ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã«å‰²ã‚Šå½“ã¦ã‚‹æ–¹å¼ï¼è¤‡æ•°ã®ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã‚’èª­ã¿è¾¼ã‚€ã“ã¨ãŒã§ãã‚‹ãŒï¼Œå˜ä¸€åŒºç”»æ–¹å¼ã¨åŒæ§˜ã«ï¼Œä½™ã£ãŸãƒ¡ãƒ¢ãƒªé ˜åŸŸã¯åˆ©ç”¨ã§ããªã„ï¼ å¯å¤‰åŒºç”»æ–¹å¼ï¼ˆæ§˜ã€…ãªå¤§ãã•ã®åŒºç”»ã«åˆ†å‰²ã™ã‚‹æ–¹å¼ï¼‰ ãƒ»å¯å¤‰åŒºç”»æ–¹å¼ã¨ã¯ ç‰©ç†ãƒ¡ãƒ¢ãƒªã®é ˜åŸŸã‚’ï¼Œãƒ—ãƒ­ã‚°ãƒ©ãƒ ã®å¤§ãã•ã«å¿œã˜ã¦ï¼ŒåŒºç”»ã‚’æ§˜ã€…ãªå¤§ãã•ã®åŒºç”»ã«åˆ†å‰²ã—ï¼Œãƒ—ãƒ­ã‚°ãƒ©ãƒ ã«å‰²ã‚Šå½“ã¦ã‚‹æ–¹å¼ï¼å›ºå®šåŒºç”»æ–¹å¼ã¨ã¯ç•°ãªã‚Šï¼Œãƒ¡ãƒ¢ãƒªé ˜åŸŸã‚’æœ‰åŠ¹ã«åˆ©ç”¨ã§ãã‚‹ï¼ ã‚¹ãƒ¯ãƒƒãƒ”ãƒ³ã‚°æ–¹å¼ ãƒ»ã‚¹ãƒ¯ãƒƒãƒ”ãƒ³ã‚°æ–¹å¼ã¨ã¯ ç‰©ç†ãƒ¡ãƒ¢ãƒªã®é ˜åŸŸã‚’ï¼Œå„ªå…ˆåº¦ã®é«˜ã„ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã«å‰²ã‚Šå½“ã¦ï¼Œåå¯¾ã«å„ªå…ˆåº¦ãŒä½ã„ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã¯ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã«é€€é¿ã•ã›ã‚‹æ–¹å¼ï¼ã‚¹ãƒ¯ãƒƒãƒ—é ˜åŸŸã®ä½œæˆæ–¹æ³•ã«ã¤ã„ã¦ã¯ï¼ŒCentOSã®ãƒãƒ¼ãƒˆã‚’å‚ç…§ï¼ ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤æ–¹å¼ ãƒ»ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤æ–¹å¼ã¨ã¯ GCï¼šã‚¬ãƒ™ãƒ¼ã‚¸ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ ãƒ»ã‚¬ãƒ™ãƒ¼ã‚¸ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã¨ã¯ ç¢ºä¿ã•ã‚ŒãŸç‰©ç†ãƒ¡ãƒ¢ãƒªã®ã†ã¡ï¼Œè§£æ”¾å¯èƒ½ãªãƒ¡ãƒ¢ãƒªã‚’ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã‹ã‚‰è§£æ”¾ã™ã‚‹ï¼ç‰©ç†ãƒ¡ãƒ¢ãƒªã‚’ä½¿ç”¨ã—ã¦ã„ã‚‹ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆãŒä½•ã‹ã—ã‚‰ã‹ã‚‰å‚ç…§ã•ã‚Œã¦ã„ã‚‹ã‹ã©ã†ã‹ã‚’å…ƒã«ï¼Œè§£æ”¾ã™ã‚‹ã‹ã©ã†ã‹ã‚’åˆ¤å®šã™ã‚‹ï¼ ãƒ»ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ  ã‚¬ãƒ™ãƒ¼ã‚¸ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã«ã¯æ§˜ã€…ãªã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ãŒã‚ã‚Šï¼Œæ¡ç”¨ã•ã‚Œã¦ã„ã‚‹ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã¯è¨€èªã”ã¨ã«ç•°ãªã‚‹ï¼Goã®ã‚¬ãƒ™ãƒ¼ã‚¸ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã«ã¤ã„ã¦ã¯ï¼Œä»¥ä¸‹ã‚’å‚è€ƒã«ã›ã‚ˆï¼ å‚è€ƒï¼šhttps://hiroki-it.github.io/tech-notebook-gitbook/public/software/software_application_backend_go_logic.html 03-03. ä»®æƒ³ãƒ¡ãƒ¢ãƒªã®ã‚¢ãƒ‰ãƒ¬ã‚¹ç©ºé–“ç®¡ç† ãƒšãƒ¼ã‚¸ãƒ³ã‚°æ–¹å¼ ãƒ»ãƒšãƒ¼ã‚¸ãƒ³ã‚°æ–¹å¼ã¨ã¯ ä»®æƒ³ãƒ¡ãƒ¢ãƒªã®å®Ÿè£…æ–¹æ³•ã®ä¸€ã¤ï¼ä»®æƒ³ãƒ¡ãƒ¢ãƒªã®ã‚¢ãƒ‰ãƒ¬ã‚¹ç©ºé–“ã‚’ã€å›ºå®šé•·ã€ã®é ˜åŸŸï¼ˆãƒšãƒ¼ã‚¸ï¼‰ï¼Œã¾ãŸç‰©ç†ãƒ¡ãƒ¢ãƒªã®ã‚¢ãƒ‰ãƒ¬ã‚¹ç©ºé–“ã‚’ã€å›ºå®šé•·ã€ã®é ˜åŸŸï¼ˆãƒšãƒ¼ã‚¸ãƒ•ãƒ¬ãƒ¼ãƒ ï¼‰ã«åˆ†å‰²ã—ï¼Œç®¡ç†ã™ã‚‹æ–¹å¼ï¼ ãƒ»ãƒšãƒ¼ã‚¸ã‚¤ãƒ³ï¼ãƒšãƒ¼ã‚¸ã‚¢ã‚¦ãƒˆ ä»®æƒ³ãƒ¡ãƒ¢ãƒªã¯ï¼ŒCPUã®å‡¦ç†ã«ã‚ˆã£ã¦ç¨¼åƒã—ãŸãƒ—ãƒ­ã‚°ãƒ©ãƒ ã®è¦æ±‚ã‚’ï¼Œç‰©ç†ãƒ¡ãƒ¢ãƒªã®ä»£ç†ã¨ã—ã¦å—ã‘ä»˜ã‘ã‚‹ï¼ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‹ã‚‰ç‰©ç†ãƒ¡ãƒ¢ãƒªã®ãƒšãƒ¼ã‚¸ãƒ•ãƒ¬ãƒ¼ãƒ ã«ãƒšãƒ¼ã‚¸ã‚’èª­ã¿è¾¼ã‚€ã“ã¨ã‚’ã€Page-inã€ã¨ã„ã†ï¼ã¾ãŸï¼Œç‰©ç†ãƒ¡ãƒ¢ãƒªã®ãƒšãƒ¼ã‚¸ãƒ•ãƒ¬ãƒ¼ãƒ ã‹ã‚‰ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã«ãƒšãƒ¼ã‚¸ã‚’è¿½ã„å‡ºã™ã“ã¨ã‚’ã€Page-outã€ã¨ã„ã†ï¼ ãƒ»ä»®æƒ³ãƒ¡ãƒ¢ãƒªã¨ã®ãƒãƒƒãƒ”ãƒ³ã‚°ã«ã‚ˆã‚‹å¤§å®¹é‡ã‚¢ãƒ‰ãƒ¬ã‚¹ç©ºé–“ã®å®Ÿç¾ ä»®æƒ³ãƒ¡ãƒ¢ãƒªã®ã‚¢ãƒ‰ãƒ¬ã‚¹ç©ºé–“ã‚’ï¼Œç‰©ç†ãƒ¡ãƒ¢ãƒªã®ã‚¢ãƒ‰ãƒ¬ã‚¹ç©ºé–“ã¨ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã«ãƒãƒƒãƒ”ãƒ³ã‚°ã™ã‚‹ã“ã¨ã«ã‚ˆã£ã¦ï¼Œç‰©ç†ãƒ¡ãƒ¢ãƒªã®ã‚¢ãƒ‰ãƒ¬ã‚¹ç©ºé–“ã‚’ç–‘ä¼¼çš„ã«å¤§ããè¦‹ã›ã‹ã‘ã‚‹ã“ã¨ãŒã§ãã‚‹ï¼ ã¡ãªã¿ã«ï¼Œå¯Œå£«é€šã®ä»®æƒ³ãƒ¡ãƒ¢ãƒªã®å®¹é‡ã¯ï¼Œä»¥ä¸‹ã®é€šã‚Šï¼ ã‚»ã‚°ãƒ¡ãƒ³ãƒˆæ–¹å¼ ãƒ»ã‚»ã‚°ãƒ¡ãƒ³ãƒˆæ–¹å¼ã¨ã¯ ä»®æƒ³ãƒ¡ãƒ¢ãƒªã®å®Ÿè£…æ–¹æ³•ã®ä¸€ã¤ï¼ä»®æƒ³ãƒ¡ãƒ¢ãƒªã®ã‚¢ãƒ‰ãƒ¬ã‚¹ç©ºé–“ã‚’ã€å¯å¤‰é•·ã€ã®é ˜åŸŸï¼ˆã‚»ã‚°ãƒ¡ãƒ³ãƒˆï¼‰ï¼Œã¾ãŸç‰©ç†ãƒ¡ãƒ¢ãƒªã®ã‚¢ãƒ‰ãƒ¬ã‚¹ç©ºé–“ã‚’ã€å¯å¤‰é•·ã€ã®é ˜åŸŸï¼ˆã‚»ã‚°ãƒ¡ãƒ³ãƒˆï¼‰ã«åˆ†å‰²ã—ï¼Œç®¡ç†ã™ã‚‹æ–¹å¼ï¼ MMUï¼šMemory Management Unitï¼ˆãƒ¡ãƒ¢ãƒªç®¡ç†ãƒ¦ãƒ‹ãƒƒãƒˆï¼‰ ãƒ»MMUã«ãŠã‘ã‚‹å‹•çš„ã‚¢ãƒ‰ãƒ¬ã‚¹å¤‰æ›æ©Ÿæ§‹ MMUã«ã‚ˆã£ã¦ï¼Œä»®æƒ³ãƒ¡ãƒ¢ãƒªã®ã‚¢ãƒ‰ãƒ¬ã‚¹ã¯ï¼Œç‰©ç†ãƒ¡ãƒ¢ãƒªã®ã‚¢ãƒ‰ãƒ¬ã‚¹ã«å¤‰æ›ã•ã‚Œã‚‹ï¼ã“ã®ä»•çµ„ã¿ã‚’ï¼Œã€å‹•çš„ã‚¢ãƒ‰ãƒ¬ã‚¹å¤‰æ›æ©Ÿæ§‹ã€ã¨å‘¼ã¶ï¼ ãƒ»ã‚¢ãƒ‰ãƒ¬ã‚¹å¤‰æ›ã®ä»•çµ„ã¿ï¼ˆãƒšãƒ¼ã‚¸ãƒ³ã‚°æ–¹å¼å‹ï¼ã‚»ã‚°ãƒ¡ãƒ³ãƒˆæ–¹å¼å‹ï¼‰ ä»®æƒ³ãƒ¡ãƒ¢ãƒªã«ãŠã‘ã‚‹ãƒšãƒ¼ã‚¸ã®ä»®æƒ³ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’ï¼Œãƒšãƒ¼ã‚¸ç•ªå·ã¨ãƒšãƒ¼ã‚¸ã‚ªãƒ•ã‚»ãƒƒãƒˆã«åˆ†å‰²ã™ã‚‹ï¼ ãƒšãƒ¼ã‚¸ãƒ†ãƒ¼ãƒ–ãƒ«ã‚’ç”¨ã„ã¦ï¼Œä»®æƒ³ã‚¢ãƒ‰ãƒ¬ã‚¹ã®ãƒšãƒ¼ã‚¸ç•ªå·ã«å¯¾å¿œã™ã‚‹ç‰©ç†ã‚¢ãƒ‰ãƒ¬ã‚¹ã®ãƒšãƒ¼ã‚¸ç•ªå·ã‚’æ¢ã™ï¼ ç‰©ç†ãƒšãƒ¼ã‚¸ç•ªå·ã«ãƒšãƒ¼ã‚¸ã‚ªãƒ•ã‚»ãƒƒãƒˆã‚’å†çµåˆã—ï¼Œç‰©ç†ãƒ¡ãƒ¢ãƒªã®ãƒšãƒ¼ã‚¸ãƒ•ãƒ¬ãƒ¼ãƒ ã®ç‰©ç†ã‚¢ãƒ‰ãƒ¬ã‚¹ã¨ã™ã‚‹ï¼ ãƒ»ãƒšãƒ¼ã‚¸ãƒ†ãƒ¼ãƒ–ãƒ«ã«ãŠã‘ã‚‹ä»®æƒ³ãƒšãƒ¼ã‚¸ç•ªå·ã¨ç‰©ç†ãƒšãƒ¼ã‚¸ç•ªå·ã®å¯¾å¿œã¥ã‘ 03-04. ãƒ—ãƒ­ã‚»ã‚¹ ãƒ—ãƒ­ã‚»ã‚¹ã¨ã¯ ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã¯ï¼Œãƒ¡ãƒ¢ãƒªä¸Šã®ç‰¹å®šã®ã‚¢ãƒ‰ãƒ¬ã‚¹ç¯„å›²ã«å‰²ã‚Šå½“ã¦ã‚‰ã‚Œã¦ã„ã‚‹ï¼ãƒ—ãƒ­ã‚°ãƒ©ãƒ è‡ªä½“ã‚’ã€ãƒ—ãƒ­ã‚»ã‚¹ã€ã¨ã„ã†ï¼ãƒ—ãƒ­ã‚»ã‚¹ã®ä»£ã‚ã‚Šã«ã€ã‚¿ã‚¹ã‚¯ã€ã¨ã„ã†ã“ã¨ã‚‚ã‚ã‚‹ï¼ãƒ—ãƒ­ã‚»ã‚¹ã¨ã—ã¦å‰²ã‚Šå½“ã¦ã‚‰ã‚ŒãŸãƒ—ãƒ­ã‚°ãƒ©ãƒ ã¯CPUã«å‚ç…§ã•ã‚Œï¼ŒCPUã®ã‚³ã‚¢ä¸Šã§å‡¦ç†ãŒå®Ÿè¡Œã•ã‚Œã‚‹ï¼ã‚·ãƒ³ã‚°ãƒ«ãƒ—ãƒ­ã‚»ã‚¹ã¨ãƒãƒ«ãƒãƒ—ãƒ­ã‚»ã‚¹ãŒã‚ã‚Šï¼Œç¾ä»£ã®ãƒãƒ¼ãƒ‰ã‚¦ã‚§ã‚¢ã®ã»ã¨ã‚“ã©ãŒãƒãƒ«ãƒãƒ—ãƒ­ã‚»ã‚¹ã®æ©Ÿèƒ½ã‚’æŒã¤ï¼ å‚è€ƒï¼š https://jpazamu.com/thread_process/#index_id5 http://staff.miyakyo-u.ac.jp/~m-yasu/curri-ex/os/txt/os5.html ãƒ—ãƒ­ã‚»ã‚·ãƒ³ã‚°ã®ç¨®é¡ ãƒ»ã‚·ãƒ³ã‚°ãƒ«ãƒ—ãƒ­ã‚»ã‚·ãƒ³ã‚° å˜ä¸€ã®ãƒ¡ãƒ¢ãƒªä¸Šã«ãŠã„ã¦ï¼Œå˜ä¸€ã®ãƒ—ãƒ­ã‚»ã‚¹ãŒã‚¢ãƒ‰ãƒ¬ã‚¹ã«å‰²ã‚Šå½“ã¦ã‚‰ã‚Œã‚‹ä»•çµ„ã¿ã®ã“ã¨ï¼ ãƒ»ãƒãƒ«ãƒãƒ—ãƒ­ã‚»ã‚·ãƒ³ã‚° å˜ä¸€ã®ãƒ¡ãƒ¢ãƒªä¸Šã«ãŠã„ã¦ï¼Œè¤‡æ•°ã®ãƒ—ãƒ­ã‚»ã‚¹ãŒã‚¢ãƒ‰ãƒ¬ã‚¹ã«å‰²ã‚Šå½“ã¦ã‚‰ã‚Œã‚‹ä»•çµ„ã¿ã®ã“ã¨ï¼å„ªå…ˆåº¦ã®ä½ã„ãƒ—ãƒ­ã‚»ã‚¹ã‹ã‚‰CPUã‚’åˆ‡ã‚Šé›¢ã—ï¼Œå„ªå…ˆåº¦ã®é«˜ã„ãƒ—ãƒ­ã‚»ã‚¹ã«CPUã‚’å‰²ã‚Šå½“ã¦ã‚‹ï¼Œã¨ã„ã£ãŸä»•çµ„ã¿ã‚’æŒã¤ï¼ å‚è€ƒï¼šhttps://linuxjf.osdn.jp/JFdocs/The-Linux-Kernel-5.html 03-05. ã‚¹ãƒ¬ãƒƒãƒ‰ ã‚¹ãƒ¬ãƒƒãƒ‰ã¨ã¯ ãƒ¡ãƒ¢ãƒªä¸Šã§ã¯ãƒ—ãƒ­ã‚°ãƒ©ãƒ ãŒãƒ—ãƒ­ã‚»ã‚¹ã¨ã—ã¦å‰²ã‚Šå½“ã¦ã‚‰ã‚Œã¦ãŠã‚Šï¼Œãƒ—ãƒ­ã‚°ãƒ©ãƒ ã¯CPUã®ã‚³ã‚¢ä¸Šã§å®Ÿè¡Œã•ã‚Œã‚‹ï¼CPUã®ã‚³ã‚¢ã¨ç´ä»˜ããƒ—ãƒ­ã‚»ã‚¹ã®å®Ÿè¡Œå˜ä½ã‚’ã€ã‚¹ãƒ¬ãƒƒãƒ‰ã€ã¨ã„ã†ï¼ å‚è€ƒï¼šhttps://atmarkit.itmedia.co.jp/ait/articles/0503/12/news025.html ã‚¹ãƒ¬ãƒƒãƒ‡ã‚£ãƒ³ã‚°ã®ç¨®é¡ ãƒ»ã‚·ãƒ³ã‚°ãƒ«ã‚¹ãƒ¬ãƒƒãƒ‡ã‚£ãƒ³ã‚° ãƒ¡ãƒ¢ãƒªä¸Šã®ç‰¹å®šã®ãƒ—ãƒ­ã‚»ã‚¹ã«ãŠã„ã¦ï¼Œå˜ä¸€ã®ã‚¹ãƒ¬ãƒƒãƒ‰ã‚’å®Ÿè¡Œã§ãã‚‹ä»•çµ„ã¿ã®ã“ã¨ï¼ ãƒ»ãƒãƒ«ãƒã‚¹ãƒ¬ãƒƒãƒ‡ã‚£ãƒ³ã‚° ãƒ¡ãƒ¢ãƒªä¸Šã®ç‰¹å®šã®ãƒ—ãƒ­ã‚»ã‚¹ã«ãŠã„ã¦ï¼Œè¤‡æ•°ã®ã‚¹ãƒ¬ãƒƒãƒ‰ã‚’å®Ÿè¡Œã§ãã‚‹ä»•çµ„ã¿ã®ã“ã¨ï¼å„ã‚¹ãƒ¬ãƒƒãƒ‰ãŒãƒ—ãƒ­ã‚»ã‚¹ã«å‰²ã‚Šå½“ã¦ã‚‰ã‚Œã¦ã„ã‚‹ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’å…±æœ‰ã—ã¦ä½¿ã†ï¼ ãƒãƒ«ãƒã‚¹ãƒ¬ãƒƒãƒ‡ã‚£ãƒ³ã‚°ã«ã¤ã„ã¦ ãƒ»é€šå¸¸ã®ãƒãƒ«ãƒã‚¹ãƒ¬ãƒƒãƒ‰ CPUã®ã‚³ã‚¢ãŒå˜ä¸€ã®ã‚¹ãƒ¬ãƒƒãƒ‰ãŒç´ä»˜ãã‚ˆã†ãªãƒãƒ«ãƒã‚¹ãƒ¬ãƒƒãƒ‰ã®ã“ã¨ï¼ å‚è€ƒï¼šhttps://milestone-of-se.nesuke.com/sv-basic/architecture/hyper-threading-smt/ ãƒ»åŒæ™‚ãƒãƒ«ãƒã‚¹ãƒ¬ãƒƒãƒ‰ CPUã®ã‚³ã‚¢ãŒè¤‡æ•°ã®ã‚¹ãƒ¬ãƒƒãƒ‰ãŒç´ä»˜ãã‚ˆã†ãªãƒãƒ«ãƒã‚¹ãƒ¬ãƒƒãƒ‰ã®ã“ã¨ï¼ å‚è€ƒï¼šhttps://milestone-of-se.nesuke.com/sv-basic/architecture/hyper-threading-smt/ 03-05. Page faultç™ºç”Ÿæ™‚ã®å‡¦ç† Page faultã¨ã¯ ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‹ã‚‰ç‰©ç†ãƒ¡ãƒ¢ãƒªã®ã‚¢ãƒ‰ãƒ¬ã‚¹ç©ºé–“ã¸ã®å‰²ã‚Šè¾¼ã¿å‡¦ç†ã®ã“ã¨ï¼CPUã«ã‚ˆã£ã¦ç¨¼åƒã—ãŸãƒ—ãƒ­ã‚°ãƒ©ãƒ ãŒï¼Œä»®æƒ³ãƒ¡ãƒ¢ãƒªã®ã‚¢ãƒ‰ãƒ¬ã‚¹ç©ºé–“ã®ãƒšãƒ¼ã‚¸ã«ã‚¢ã‚¯ã‚»ã‚¹ã—ï¼Œãã®ãƒšãƒ¼ã‚¸ãŒç‰©ç†ãƒ¡ãƒ¢ãƒªã®ã‚¢ãƒ‰ãƒ¬ã‚¹ç©ºé–“ã«ãƒãƒƒãƒ”ãƒ³ã‚°ã•ã‚Œã¦ã„ãªã‹ã£ãŸå ´åˆã«ï¼Œã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‹ã‚‰ç‰©ç†ãƒ¡ãƒ¢ãƒªã®ã‚¢ãƒ‰ãƒ¬ã‚¹ç©ºé–“ã«ã€ãƒšãƒ¼ã‚¸ã‚¤ãƒ³ã€ãŒèµ·ã“ã‚‹ï¼ Page Replacementã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ  ãƒšãƒ¼ã‚¸ã‚¢ã‚¦ãƒˆã®ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã®ã“ã¨ï¼æ–¹å¼ã”ã¨ã«ï¼Œç‰©ç†ãƒ¡ãƒ¢ãƒªã®ãƒšãƒ¼ã‚¸ãƒ•ãƒ¬ãƒ¼ãƒ ã‹ã‚‰ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã«ãƒšãƒ¼ã‚¸ã‚¢ã‚¦ãƒˆã™ã‚‹ãƒšãƒ¼ã‚¸ãŒç•°ãªã‚‹ï¼ ãƒ»ã€FIFOæ–¹å¼ï¼šFirst In First Outã€ã¨ã€LIFOæ–¹å¼ï¼šLast In First Outã€ ãƒ»ã€LRUæ–¹å¼ï¼šLeast Recently Usedã€ã¨ã€LFUæ–¹å¼ï¼šLeast Frequently Usedã€ 03-06. ã‚¢ãƒ‰ãƒ¬ã‚¹ç©ºé–“ç®¡ç†ã«ãŠã‘ã‚‹ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã®ç¨®é¡ Reusableï¼ˆå†ä½¿ç”¨å¯èƒ½ãƒ—ãƒ­ã‚°ãƒ©ãƒ ï¼‰ ä¸€åº¦å®Ÿè¡Œã™ã‚Œã°ï¼Œå†åº¦ï¼Œã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‹ã‚‰ç‰©ç†ãƒ¡ãƒ¢ãƒªã«ãƒšãƒ¼ã‚¸ã‚¤ãƒ³ã‚’è¡Œã‚ãšã«ï¼Œå®Ÿè¡Œã‚’ç¹°ã‚Šè¿”ã›ã‚‹ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã®ã“ã¨ï¼ Reentrantï¼ˆå†å…¥å¯èƒ½ãƒ—ãƒ­ã‚°ãƒ©ãƒ ï¼‰ å†ä½¿ç”¨å¯èƒ½ã®æ€§è³ªã‚’ã‚‚ã¡ï¼Œã¾ãŸè¤‡æ•°ã®ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã‹ã‚‰å‘¼ã³å‡ºã•ã‚Œã¦ã‚‚ï¼Œäº’ã„ã®å‘¼ã³å‡ºã—ãŒå¹²æ¸‰ã›ãšï¼ŒåŒæ™‚ã«å®Ÿè¡Œã§ãã‚‹ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã®ã“ã¨ï¼ Relocatableï¼ˆå†é…ç½®å¯èƒ½ãƒ—ãƒ­ã‚°ãƒ©ãƒ ï¼‰ ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‹ã‚‰ç‰©ç†ãƒ¡ãƒ¢ãƒªã«ãƒšãƒ¼ã‚¸ã‚¤ãƒ³ã‚’è¡Œã†æ™‚ã«ï¼Œã‚¢ãƒ‰ãƒ¬ã‚¹ç©ºé–“ä¸Šã®ã©ã“ã«é…ç½®ã•ã‚Œã¦ã‚‚å®Ÿè¡Œã§ãã‚‹ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã®ã“ã¨ï¼ "},"public/hardware/hardware_embedded_system.html":{"url":"public/hardware/hardware_embedded_system.html","title":"ğŸ“– ï¸çµ„ã¿è¾¼ã¿æ©Ÿå™¨","keywords":"","body":"çµ„ã¿è¾¼ã¿æ©Ÿå™¨ ã¯ã˜ã‚ã« æœ¬ã‚µã‚¤ãƒˆã«ã¤ãã¾ã—ã¦ï¼Œä»¥ä¸‹ã‚’ã”èªè­˜ã®ã»ã©å®œã—ããŠé¡˜ã„ã„ãŸã—ã¾ã™ï¼ å‚è€ƒï¼šhttps://hiroki-it.github.io/tech-notebook-gitbook/ 01. çµ„ã¿è¾¼ã¿æ©Ÿå™¨ çµ„ã¿è¾¼ã¿ã‚·ã‚¹ãƒ†ãƒ ã¨ã¯ çµ„ã¿è¾¼ã¿æ©Ÿå™¨ï¼ˆé™å®šçš„ãªç”¨é€”å‘ã‘ã«ç‰¹å®šã®æ©Ÿèƒ½ã‚’æœãŸã™äº‹ã‚’ç›®çš„ã¨ã—ãŸæ©Ÿå™¨ï¼‰ã‚’åˆ¶å¾¡ã™ã‚‹ã‚·ã‚¹ãƒ†ãƒ ã®ã“ã¨ï¼ â€»ãƒ‘ã‚½ã‚³ãƒ³ã¯ã€æ±ç”¨æ©Ÿå™¨ï¼ˆæ±ç”¨çš„ãªç”¨é€”å‘ã‘ã«å¤šæ§˜ãªæ©Ÿèƒ½ã‚’æœãŸã™äº‹ã‚’ç›®çš„ã¨ã—ãŸæ©Ÿå™¨ï¼‰ã«åˆ†é¡ã•ã‚Œã‚‹ï¼ ãƒã‚¤ã‚¯ãƒ­ã‚³ãƒ³ãƒ”ãƒ¥ãƒ¼ã‚¿ã¨ã¯ CPUã¨ã—ã¦ã€ã€ãƒã‚¤ã‚¯ãƒ­ãƒ—ãƒ­ã‚»ãƒƒã‚µã€ã‚’ç”¨ã„ãŸã‚³ãƒ³ãƒ”ãƒ¥ãƒ¼ã‚¿ã®ã“ã¨ï¼ ã‚»ãƒ³ã‚µã«ã‚ˆã‚‹ã‚¢ãƒŠãƒ­ã‚°æƒ…å ±ã®å…¥åŠ› å¤–éƒ¨ã®ã‚¢ãƒŠãƒ­ã‚°æƒ…å ±ã‚’è¨ˆæ¸¬ã—ã€ãƒã‚¤ã‚³ãƒ³ã«è»¢é€ã™ã‚‹ï¼ ï¼Šä¾‹ï¼Šï¼šæ¸©åº¦ã‚»ãƒ³ã‚µã€åŠ é€Ÿåº¦ã‚»ãƒ³ã‚µã€ç…§åº¦ã‚»ãƒ³ã‚µã€â€¦ A/Då¤‰æ›å™¨ã«ã‚ˆã‚‹ã‚¢ãƒŠãƒ­ã‚°æƒ…å ±ã‹ã‚‰ãƒ‡ã‚¸ã‚¿ãƒ«æƒ…å ±ã¸ã®å¤‰æ› D/Aå¤‰æ›å™¨ã«ã‚ˆã‚‹ãƒ‡ã‚¸ã‚¿ãƒ«æƒ…å ±ã‹ã‚‰ã‚¢ãƒŠãƒ­ã‚°æƒ…å ±ã¸ã®å¤‰æ› Actuater å…¥åŠ›ã•ã‚ŒãŸã‚¨ãƒãƒ«ã‚®ãƒ¼ã‚‚ã—ãã¯ã‚³ãƒ³ãƒ”ãƒ¥ãƒ¼ã‚¿ãŒå‡ºåŠ›ã—ãŸé›»æ°—ä¿¡å·ã‚’ç‰©ç†çš„é‹å‹•ã«å¤‰æ›ã™ã‚‹è£…ç½®ã®ã“ã¨ï¼ çµ„ã¿è¾¼ã¿ã‚·ã‚¹ãƒ†ãƒ ã®åˆ¶å¾¡æ–¹å¼ã®ç¨®é¡ ãƒ»ã‚·ãƒ¼ã‚±ãƒ³ã‚¹åˆ¶å¾¡ æ±ºã‚ã‚‰ã‚ŒãŸé †åºã‚„æ¡ä»¶ã«å¾“ã£ã¦ã€åˆ¶å¾¡ã®å„æ®µéšã‚’é€²ã‚ã¦ã„ãåˆ¶å¾¡æ–¹å¼ï¼ ï¼Šä¾‹ï¼Š æ´—æ¿¯æ©Ÿ ãƒ»ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯åˆ¶å¾¡ ãã®æ™‚ã®çŠ¶æ³ã‚’å®šæœŸçš„ã«è¨ˆæ¸¬ã—ã€ç›®æ¨™å€¤ã¨ã®å·®åˆ†ã‚’åŸºã«ã€å‡ºåŠ›ã‚’èª¿ç¯€ã™ã‚‹åˆ¶å¾¡æ–¹å¼ï¼ ï¼Šä¾‹ï¼Š ã‚¨ã‚¢ã‚³ãƒ³ 02. å…¥å‡ºåŠ›æ©Ÿå™¨ ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ã‹ã‚‰ãƒã‚¤ãƒ³ãƒ†ã‚£ãƒ³ã‚°ãƒ‡ãƒã‚¤ã‚¹ ãƒ»ã‚¸ãƒ§ã‚¤ã‚¹ãƒ†ã‚£ãƒƒã‚¯ èª­ã¿å–ã‚Šæ©Ÿå™¨ ãƒ»ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚¹ã‚­ãƒ£ãƒŠ ãƒ»Optical Character Reader ç´™ä¸Šã®æ–‡å­—ã‚’æ–‡å­—ãƒ‡ãƒ¼ã‚¿ã¨ã—ã¦èª­ã¿å–ã‚‹æ©Ÿå™¨ï¼ ãƒ»Optical Mark Reader ãƒãƒ¼ã‚¯ã‚·ãƒ¼ãƒˆã®å¡—ã‚Šæ½°ã—ä½ç½®ã‚’èª­ã¿å–ã‚‹æ©Ÿå™¨ï¼ ãƒ»ã‚­ãƒ£ãƒ—ãƒãƒ£ã‚«ãƒ¼ãƒ‰ ãƒ»ãƒ‡ã‚¸ã‚¿ãƒ«ã‚«ãƒ¡ãƒ© ãƒ‡ã‚£ã‚¹ãƒ—ãƒ¬ã‚¤ ãƒ»CRTãƒ‡ã‚£ã‚¹ãƒ—ãƒ¬ã‚¤ ãƒ»æ¶²æ™¶ãƒ‡ã‚£ã‚¹ãƒ—ãƒ¬ã‚¤ é›»åœ§ã®æœ‰ç„¡ã«ã‚ˆã£ã¦æ¶²æ™¶åˆ†å­ã‚’åˆ¶å¾¡ï¼å¤–éƒ¨ã‹ã‚‰ã®å…‰ã«ã‚ˆã£ã¦ç”»é¢ã‚’è¡¨ç¤ºã•ã›ã‚‹ï¼ ãƒ»æœ‰æ©ŸELãƒ‡ã‚£ã‚¹ãƒ—ãƒ¬ã‚¤ æœ‰æ©ŸåŒ–åˆç‰©ã«é›»åœ§ã‚’åŠ ãˆã‚‹ã“ã¨ã«ã‚ˆã£ã¦ç™ºå…‰ã•ã›ã€ç”»é¢ã‚’è¡¨ç¤ºã•ã›ã‚‹ï¼ ãƒ»ãƒ—ãƒ©ã‚ºãƒãƒ‡ã‚£ã‚¹ãƒ—ãƒ¬ã‚¤ 2æšã®ã‚¬ãƒ©ã‚¹ã®é–“ã«ã€å°å…¥ã•ã‚ŒãŸå¸Œã‚¬ã‚¹ã«é›»åœ§ã‚’ã‹ã‘ã‚‹ã¨æ”¾é›»ã—ã€ç´«å¤–ç·šãŒå‡ºã‚‹ï¼ãã—ã¦ã€ã“ã®ç´«å¤–ç·šãŒè›å…‰ä½“ã‚’ç™ºå…‰ã•ã›ã‚‹ã“ã¨ã«ã‚ˆã£ã¦ç”»é¢ã‚’è¡¨ç¤ºã™ã‚‹ï¼ æ¶²æ™¶ãƒ‡ã‚£ã‚¹ãƒ—ãƒ¬ã‚¤ã¨ã®ã‚·ã‚§ã‚¢å·®ãŒå¤§ãããªã‚Šã€2014å¹´ã«ä¸–ç•Œçš„ã«ç”Ÿç”£ãŒçµ‚äº†ã•ã‚ŒãŸï¼ ãƒ»LEDãƒ‡ã‚£ã‚¹ãƒ—ãƒ¬ã‚¤ 2018å¹´1æœˆã«é–‹å‚¬ã•ã‚ŒãŸã€ŒCES 2018ã€ã§ã‚µãƒ ã‚¹ãƒ³ãŒç™ºè¡¨ã—ãŸâ€œãƒã‚¤ã‚¯ãƒ­LEDãƒ†ãƒ¬ãƒ“â€ã€ŒThe Wallã€ã¯ã€å¾“æ¥ã®ã€Œæ¶²æ™¶ã€ã‚„ã€Œæœ‰æ©ŸELã€ã¨ã¯ç•°ãªã‚‹æ–°ãŸãªè¡¨ç¤ºæ–¹å¼ã‚’æ¡ç”¨ã—ãŸãƒ†ãƒ¬ãƒ“ã¨ã—ã¦ã€å¤§ããªè©±é¡Œã¨ãªã£ãŸï¼ ãƒ—ãƒªãƒ³ã‚¿ ãƒ»ãƒ‰ãƒƒãƒˆã‚¤ãƒ³ãƒ‘ã‚¯ãƒˆãƒ—ãƒªãƒ³ã‚¿ ãƒ»ã‚¤ãƒ³ã‚¯ã‚¸ã‚§ãƒƒãƒˆãƒ—ãƒªãƒ³ã‚¿ ãƒ»ãƒ¬ãƒ¼ã‚¶ãƒ—ãƒªãƒ³ã‚¿ ãƒ»ãƒ—ãƒªãƒ³ã‚¿ã®è§£åƒåº¦ ï¼‘ã‚¤ãƒ³ãƒå½“ãŸã‚Šã®ãƒ‰ãƒƒãƒˆæ•°ï¼ˆdpiï¼‰ã«ã‚ˆã£ã¦ã€è§£åƒåº¦ãŒç•°ãªã‚‹ï¼å¾©ç¿’ã§ã¯ã‚ã‚‹ãŒã€PCä¸Šã§ã¯ã€ãƒ‰ãƒƒãƒˆæ•°ãŒã©ã®ãã‚‰ã„ã®ãƒ“ãƒƒãƒˆæ•°ã‚’æŒã¤ã‹ã§ã€è§£åƒåº¦ãŒå¤‰ã‚ã‚‹ï¼ dpiãŒå¤§ãããªã‚‹ã«ã¤ã‚Œã¦ã€è§£åƒåº¦ã¯å¤§ãããªã‚‹ï¼ ãƒ»ãƒ—ãƒªãƒ³ã‚¿ã®å°å­—é€Ÿåº¦ 02-02. å…¥å‡ºåŠ›ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ã‚¤ã‚¹ Serial interface vs. Parallel interface ã‚·ãƒªã‚¢ãƒ«ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ã‚¤ã‚¹ã¯ã€æƒ…å ±ã‚’1bitãšã¤è»¢é€ã™ã‚‹æ–¹å¼ï¼ãƒ‘ãƒ©ãƒ¬ãƒ«ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ã‚¤ã‚¹ã¯ã€è¤‡æ•°ã®bitã®æƒ…å ±ã‚’åŒæ™‚ã«è»¢é€ã™ã‚‹æ–¹å¼ï¼ãƒ‘ãƒ©ãƒ¬ãƒ«ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ã‚¤ã‚¹ã¯ã€åŒæ™‚ã«ãƒ‡ãƒ¼ã‚¿ã‚’é€ä¿¡ã—ã€åŒæ™‚ã«å—ä¿¡ã—ãªã‘ã‚Œã°ãªã‚‰ãªã„ï¼é…ç·šã®å½¢çŠ¶ã‚„é•·ã•ã«ã‚ˆã£ã¦ã€ä¿¡å·ã®è»¢é€æ™‚é–“ã¯ç•°ãªã‚‹ï¼å‹•ä½œã‚¯ãƒ­ãƒƒã‚¯ãŒé€Ÿã‘ã‚Œã°é€Ÿã„ã»ã©ã€é…ç·šé–“ã®åŒæ™‚è»¢é€ã«èª¤å·®ãŒç”Ÿã˜ã¦ã—ã¾ã†ãŸã‚ã€ç¾ä»£ã®é«˜ã‚¹ãƒšãƒƒã‚¯ãƒ‘ã‚½ã‚³ãƒ³ã«ã¯å‘ã„ã¦ã„ãªã„ï¼ Serial interface ãŒç”¨ã„ã‚‰ã‚Œã¦ã„ã‚‹ä¾‹ ãƒ»USBï¼ˆUniversal Serial Busï¼‰ ãƒ»IEEE1394 ãƒ“ãƒ‡ã‚ªã‚«ãƒ¡ãƒ©ã¨ã®æ¥ç¶šã«ç”¨ã„ã‚‰ã‚Œã‚‹ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ã‚¤ã‚¹ Parallel interface ãŒç”¨ã„ã‚‰ã‚Œã¦ã„ã‚‹ä¾‹ ãƒ»IDEï¼ˆIntegrated Drive Electronicsï¼‰ ãƒãƒ¼ãƒ‰ãƒ‡ã‚£ã‚¹ã‚¯ã¨ã®æ¥ç¶šã«ç”¨ã„ã‚‰ã‚Œã‚‹ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ã‚¤ã‚¹ï¼ ãƒ»SCSIï¼ˆSmall Computer System Interfaceï¼‰ ãƒãƒ¼ãƒ‰ãƒ‡ã‚£ã‚¹ã‚¯ã€CD-ROMã€ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚¹ã‚­ãƒ£ãƒŠãªã©ã€æ§˜ã€…ãªå‘¨è¾ºæ©Ÿå™¨ã‚’ãƒ‡ã‚¤ã‚¸ãƒ¼ãƒã‚§ãƒ¼ãƒ³ã™ã‚‹ãŸã‚ã«ç”¨ã„ã‚‹ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ã‚¤ã‚¹ï¼ ç„¡ç·šã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ã‚¤ã‚¹ ãƒ»IrDAï¼ˆinfrared Data Assoiciationï¼‰ èµ¤å¤–ç·šã‚’ä½¿ã£ã¦ã€ç„¡ç·šé€šä¿¡ã‚’è¡Œã†ãŸã‚ã®ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ã‚¤ã‚¹ï¼ ãƒ»Bluetooth 2.4GHzã®é›»æ³¢ã‚’ä½¿ã£ã¦ç„¡ç·šé€šä¿¡ã‚’è¡Œã†ãŸã‚ã®ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ã‚¤ã‚¹ï¼ "},"public/network/network.html":{"url":"public/network/network.html","title":"ğŸ“– ï¸ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯","keywords":"","body":"ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ ã¯ã˜ã‚ã« æœ¬ã‚µã‚¤ãƒˆã«ã¤ãã¾ã—ã¦ï¼Œä»¥ä¸‹ã‚’ã”èªè­˜ã®ã»ã©å®œã—ããŠé¡˜ã„ã„ãŸã—ã¾ã™ï¼ å‚è€ƒï¼šhttps://hiroki-it.github.io/tech-notebook-gitbook/ 01. ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã®å…¨ä½“åƒ ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆï¼ŒWANï¼ŒLAN ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã«ã¯ï¼Œã€ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆã€ã€WANã€ã€LANã€ãŒã‚ã‚‹ï¼å®¶åº­å†…LANï¼Œå­¦å†…LANï¼Œä¼æ¥­å†…LANï¼Œä¼æ¥­WANãªã©ï¼Œã•ã¾ã–ã¾ãªãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ãŒã‚ã‚Šï¼Œã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆã¯ï¼Œãã‚Œãã‚Œã®ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚’äº’ã„ã«æ¥ç¶šã—ã¦ã„ã‚‹ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã§ã‚ã‚‹ï¼ WANï¼ŒLANã®ä¾‹ ä¾‹ãˆã°ï¼ŒLANã¨ã—ã¦Ethernetï¼ŒWANã¨ã—ã¦ãƒ‡ã‚¸ã‚¿ãƒ«å°‚ç”¨ç·šã‚’ç”¨ã„ã‚‹ï¼ WANã®ç¨®é¡ã¨æ­´å² ã‚°ãƒ­ãƒ¼ãƒãƒ«ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã¨ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ ãƒ«ãƒ¼ã‚¿ã‚’å¢ƒã«ï¼Œãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã¨ã‚°ãƒ­ãƒ¼ãƒãƒ«ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã«åˆ†ã‘ã‚‰ã‚Œã‚‹ï¼ã‚„ã‚„ã“ã—ã„ãŒï¼Œãƒ«ãƒ¼ã‚¿ã«ã¯ã‚°ãƒ­ãƒ¼ãƒãƒ«IPã‚¢ãƒ‰ãƒ¬ã‚¹ãŒå‰²ã‚Šå½“ã¦ã‚‰ã‚Œã¦ã„ã‚‹ï¼ 02. ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã¸ã®ãƒ‡ãƒ¼ã‚¿é€ä¿¡ ãƒ‡ãƒ¼ã‚¿é€šä¿¡æ–¹æ³•ã®ç¨®é¡ ãƒ»å›ç·šäº¤æ›æ–¹å¼ å°‘æ•°å¯¾å°‘æ•°ã§ãƒ‡ãƒ¼ã‚¿é€šä¿¡ã‚’è¡Œã†ãŸã‚ï¼Œé€ä¿¡æ™‚ã«ï¼Œé€ä¿¡è€…ã¨å—ä¿¡è€…ã®å®›å…ˆæƒ…å ±ã¯å¿…è¦ãªã„ï¼ ãƒ»ãƒ‘ã‚±ãƒƒãƒˆäº¤æ›æ–¹å¼ é€šä¿¡ã™ã‚‹ãƒ‡ãƒ¼ã‚¿ã‚’ãƒ‘ã‚±ãƒƒãƒˆåŒ–ã™ã‚‹ï¼å¤šæ•°å¯¾å¤šæ•°ã§ãƒ‡ãƒ¼ã‚¿é€šä¿¡ã‚’è¡Œã†ãŸã‚ï¼Œé€ä¿¡æ™‚ã«ï¼Œé€ä¿¡è€…ã¨å—ä¿¡è€…ã®å®›å…ˆæƒ…å ±ãŒå¿…è¦ã«ãªã‚‹ï¼ URLã¨ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ ãƒ»æ§‹é€  URLã¨ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã¯å®Œå…¨ä¿®é£¾ãƒ‰ãƒ¡ã‚¤ãƒ³åã‚’æŒã¤ï¼ ã¾ãŸï¼Œå®Œå…¨ä¿®é£¾ãƒ‰ãƒ¡ã‚¤ãƒ³åã¯ï¼Œãƒ‰ãƒ¡ã‚¤ãƒ³åã®å­é–¢ä¿‚ã«ã‚ã‚‹ã‚µãƒ–ãƒ‰ãƒ¡ã‚¤ãƒ³åã‚’æŒã¦ã‚‹ï¼ãƒ›ã‚¹ãƒˆåï¼ˆä»¥ä¸‹ã§ã¯çœç•¥ã•ã‚Œã¦ã„ã‚‹ï¼‰ã¨ï¼Œãƒ‰ãƒ¡ã‚¤ãƒ³åã®é–“ã«ã¤ã‘ã‚‹ï¼ ãƒ»å®Œå…¨ä¿®é£¾ãƒ‰ãƒ¡ã‚¤ãƒ³åã«ã‚ˆã‚‹ã‚µãƒ¼ãƒæŒ‡å®š å®Œå…¨ä¿®é£¾ãƒ‰ãƒ¡ã‚¤ãƒ³åã¯ï¼Œæ‰€å±ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚’æŒ‡ã™ãƒ‰ãƒ¡ã‚¤ãƒ³åã¨ï¼Œãã®ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã«ãŠã‘ã‚‹å…·ä½“çš„ãªã‚µãƒ¼ãƒã‚’æŒ‡ã™ãƒ›ã‚¹ãƒˆåã‹ã‚‰ãªã‚‹ï¼ãŸã ã—ï¼Œã‚µãƒ¼ãƒã®ãƒ›ã‚¹ãƒˆåãŒã€wwwã€ã§ã‚ã‚‹å ´åˆï¼Œã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã¯URLã®æŒ‡å®šæ™‚ã«ãƒ›ã‚¹ãƒˆåã‚’çœç•¥ã§ãã‚‹ï¼ä¾‹ãˆã°ï¼Œã€www.example.co.jpã€ã¨ã„ã†å®Œå…¨ä¿®é£¾ãƒ‰ãƒ¡ã‚¤ãƒ³åã‚’URLã§æŒ‡å®šã™ã‚‹å ´åˆï¼Œã€example.co.jpã€ã¨ã—ã¦ã‚‚ã‚ˆã„ï¼ ã‚»ã‚°ãƒ¡ãƒ³ãƒˆ ãƒ»ã‚»ã‚°ãƒ¡ãƒ³ãƒˆã®ç¨®é¡ ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã¯ï¼Œå¤–éƒ¨å…¬é–‹ç”¨ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ï¼Œéæ­¦è£…åœ°å¸¯ï¼Œå†…éƒ¨ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã«åˆ†é¡ã•ã‚Œã‚‹ï¼ ãƒ»éæ­¦è£…åœ°å¸¯ã®ã‚µãƒ¼ãƒã®ç¨®é¡ æ”»æ’ƒã®å½±éŸ¿ãŒå†…éƒ¨ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã«åºƒãŒã‚‹å¯èƒ½æ€§ã‚’é˜²ããŸã‚ã«ï¼Œå¤–éƒ¨ã‹ã‚‰ç›´æ¥ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’å—ã‘ã‚‹ï¼ãã®ãŸã‚ï¼Œã€DNSã‚µãƒ¼ãƒã€ã€ãƒ—ãƒ­ã‚­ã‚·ã‚µãƒ¼ãƒã€ã€Webã‚µãƒ¼ãƒã€ã€ãƒ¡ãƒ¼ãƒ«ã‚µãƒ¼ãƒã€ã¯ï¼Œéæ­¦è£…åœ°å¸¯ã«è¨­ç½®ã•ã‚Œã‚‹ï¼ ãƒ»å†…éƒ¨ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã®ã‚µãƒ¼ãƒã®ç¨®é¡ å¤–éƒ¨ã‹ã‚‰ç›´æ¥ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’å—ã‘ãªã„ï¼ãã®ãŸã‚ï¼Œã€DBã‚µãƒ¼ãƒã€ã¯ï¼Œå†…éƒ¨ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã«è¨­ç½®ã•ã‚Œã‚‹ï¼ 03. Webã‚·ã‚¹ãƒ†ãƒ ã‚’æ§‹æˆã™ã‚‹ä¸»è¦ãª3å±¤æ§‹é€  Webã‚·ã‚¹ãƒ†ãƒ ã¨ã¯ Webã‚µãƒ¼ãƒï¼ŒAppã‚µãƒ¼ãƒï¼ŒDBã‚µãƒ¼ãƒã«ã‚ˆã‚‹ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã®ä»•çµ„ã¿ã‚’Webã‚·ã‚¹ãƒ†ãƒ ã¨ã„ã†ï¼ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ã¨ãƒãƒ¼ãƒ‰ã‚¦ã‚§ã‚¢ã®ãƒãƒ¼ãƒˆã‚‚å‚ç…§ã›ã‚ˆï¼ Webã‚µãƒ¼ãƒ ãƒ»Webã‚µãƒ¼ãƒã®å½¹å‰² ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢ï¼ˆApacheï¼ŒNginxãªã©ï¼‰ãŒã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¦ã„ã‚‹ï¼ã¾ãŸï¼ŒWebå…¼Appã‚µãƒ¼ãƒã®ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢ã¨ã—ã¦æ©Ÿèƒ½ã™ã‚‹ï¼ˆNGINX Unitï¼‰ãŒã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¦ã„ã‚‹ã“ã¨ã‚‚ã‚ã‚‹ï¼ Webã‚µãƒ¼ãƒ â†’ Appã‚µãƒ¼ãƒ â†’ DBã‚µãƒ¼ãƒ é™çš„ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ é™çš„ãƒ¬ã‚¹ ãƒ¼ ãƒ¼ é™çš„ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ï¼‹å‹•çš„ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ é™çš„ãƒ¬ã‚¹ å‹•çš„ãƒ¬ã‚¹ ãƒ‡ãƒ¼ã‚¿ç®¡ç† ãƒ–ãƒ©ã‚¦ã‚¶ã‹ã‚‰é™çš„ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã®ã¿ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆãŒã‚ã£ãŸå ´åˆï¼Œé™çš„ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚’ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã™ã‚‹ï¼ã¾ãŸï¼Œé™çš„ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã¨å‹•çš„ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã®ä¸¡æ–¹ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆãŒã‚ã£ãŸå ´åˆã«ï¼Œã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚µãƒ¼ãƒã«å‹•çš„ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’è¡Œã†ï¼ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚µãƒ¼ãƒã‹ã‚‰ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’å—ã‘å–ã‚Šï¼Œãƒ–ãƒ©ã‚¦ã‚¶ã«ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’è¡Œã†ï¼ Appã‚µãƒ¼ãƒ ãƒ»Appã‚µãƒ¼ãƒã®å½¹å‰² ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢ï¼ˆPHPãªã‚‰PHP-FPMï¼ŒJavaãªã‚‰Tomcatï¼‰ãŒã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¦ã„ã‚‹ï¼ Webã‚µãƒ¼ãƒ â†’ Appã‚µãƒ¼ãƒ â†’ DBã‚µãƒ¼ãƒ é™çš„ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ é™çš„ãƒ¬ã‚¹ ãƒ¼ ãƒ¼ é™çš„ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ï¼‹å‹•çš„ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ é™çš„ãƒ¬ã‚¹ å‹•çš„ãƒ¬ã‚¹ ãƒ‡ãƒ¼ã‚¿ç®¡ç† Webã‚µãƒ¼ãƒã‹ã‚‰å‹•çš„ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆãŒã‚ã£ãŸå ´åˆã«ï¼Œãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°è¨€èªã‚’è¨€èªãƒ—ãƒ­ã‚»ãƒƒã‚µã§ç¿»è¨³ã—ï¼ŒDBã‚µãƒ¼ãƒã«ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’è¡Œã†ï¼DBã‚µãƒ¼ãƒã‹ã‚‰ã®ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’å—ã‘å–ã‚Šï¼ŒWebã‚µãƒ¼ãƒã«å‹•çš„ãªã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã®ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’è¡Œã†ï¼ DBç®¡ç†ã‚·ã‚¹ãƒ†ãƒ ã‚’æŒã¤DBã‚µãƒ¼ãƒ ãƒ»DBã‚µãƒ¼ãƒã®å½¹å‰² DBç®¡ç†ã‚·ã‚¹ãƒ†ãƒ ãŒã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¦ã„ã‚‹ï¼DBã®æƒ…å ±ãŒä¿å­˜ã•ã‚Œã¦ã„ã‚‹ï¼ ã‚µãƒ¼ãƒã®å‡¦ç†èƒ½åŠ›å‘ä¸Š ãƒ»å‚ç›´ã‚¹ã‚±ãƒ¼ãƒªãƒ³ã‚°ï¼ˆã‚¹ã‚±ãƒ¼ãƒ«ã‚¢ãƒƒãƒ— â‡” ã‚¹ã‚±ãƒ¼ãƒ«ãƒ€ã‚¦ãƒ³ï¼‰ ã‚µãƒ¼ãƒè‡ªä½“ã®ã‚¹ãƒšãƒƒã‚¯ã‚’ã‚ˆã‚Šé«˜ãã™ã‚‹ã“ã¨ã§ï¼Œã‚µãƒ¼ãƒå½“ãŸã‚Šã®å‡¦ç†èƒ½åŠ›ã‚’å‘ä¸Šã•ã›ã‚‹ï¼ãã®é€†ã¯ï¼Œã‚¹ã‚±ãƒ¼ãƒ«ãƒ€ã‚¦ãƒ³ï¼è¨­å®šã§ï¼Œä»®æƒ³ã‚µãƒ¼ãƒã®ã‚¹ãƒšãƒƒã‚¯ã‚’ä¸Šã’ã‚‹ã“ã¨ã‚‚ï¼Œã“ã‚Œã«è©²å½“ã™ã‚‹ï¼ ãƒ»æ°´å¹³ã‚¹ã‚±ãƒ¼ãƒªãƒ³ã‚°ï¼ˆã‚¹ã‚±ãƒ¼ãƒ«ã‚¢ã‚¦ãƒˆ â‡” ã‚¹ã‚±ãƒ¼ãƒ«ã‚¤ãƒ³ï¼‰ ã‚µãƒ¼ãƒã®å°æ•°ã‚’å¢—ã‚„ã™ã“ã¨ã§ï¼Œã‚µãƒ¼ãƒå…¨ä½“ã®å‡¦ç†èƒ½åŠ›ã‚’å‘ä¸Šã•ã›ã‚‹ï¼ãã®é€†ã¯ï¼Œã‚¹ã‚±ãƒ¼ãƒ«ã‚¤ãƒ³ï¼ 03-02. Webã‚·ã‚¹ãƒ†ãƒ ã®æ§‹æˆæ–¹æ³• Dualã‚·ã‚¹ãƒ†ãƒ  åŒã˜å‡¦ç†ã‚’è¡Œã†2ã¤ã®ã‚·ã‚¹ãƒ†ãƒ ã‹ã‚‰ãªã‚‹ã‚·ã‚¹ãƒ†ãƒ æ§‹æˆã®ã“ã¨ï¼éšæ™‚ï¼Œå‡¦ç†çµæœã‚’ç…§åˆã™ã‚‹ï¼ã„ãšã‚Œã‹ãŒæ•…éšœã—ãŸå ´åˆï¼Œç•°å¸¸ãŒç™ºç”Ÿã—ãŸã‚·ã‚¹ãƒ†ãƒ ã‚’åˆ‡ã‚Šé›¢ã—ï¼Œæ®‹ã‚‹ç‰‡æ–¹ã§å‡¦ç†ã‚’ç¶šã‘ã‚‹ã“ã¨ã«ã‚ˆã£ã¦ï¼Œæ•…éšœã‚’ä¹—ã‚Šåˆ‡ã‚‹ï¼ Duplexã‚·ã‚¹ãƒ†ãƒ  ã‚ªãƒ³ãƒ©ã‚¤ãƒ³å‡¦ç†ã‚’è¡Œã†ä¸»ç³»ã‚·ã‚¹ãƒ†ãƒ ã¨ï¼Œãƒãƒƒãƒå‡¦ç†ã‚’è¡Œã†å¾“ç³»ã‚·ã‚¹ãƒ†ãƒ ã‹ã‚‰ãªã‚‹ã‚·ã‚¹ãƒ†ãƒ æ§‹æˆã®ã“ã¨ï¼ä¸»ç³»ã‚·ã‚¹ãƒ†ãƒ ãŒæ•…éšœã—ãŸå ´åˆï¼Œä¸»ç³»ã‚·ã‚¹ãƒ†ãƒ ã®ã‚ªãƒ³ãƒ©ã‚¤ãƒ³å‡¦ç†ã‚’å¾“ç³»ã‚·ã‚¹ãƒ†ãƒ ã«å¼•ãç¶™ãï¼Œå‡¦ç†ã‚’ç¶šã‘ã‚‹ã“ã¨ã«ã‚ˆã£ã¦ï¼Œæ•…éšœã‚’ä¹—ã‚Šåˆ‡ã‚‹ï¼ å¾“ç³»ã‚·ã‚¹ãƒ†ãƒ ã®å¾…æ©Ÿæ–¹æ³•ã«ã¯ï¼’ã¤ã®ç¨®é¡ãŒã‚ã‚‹ï¼ ãƒ»ãƒ›ãƒƒãƒˆã‚¹ã‚¿ãƒ³ãƒã‚¤ ãƒ»ã‚³ãƒ¼ãƒ«ãƒ‰ã‚¹ã‚¿ãƒ³ãƒã‚¤ ã‚·ã‚¹ãƒ†ãƒ ã®ç¨¼åƒç‡ ä¸¦åˆ—ã‚·ã‚¹ãƒ†ãƒ ã®å ´åˆï¼Œä¸¡æ–¹ã®éç¨¼åƒç‡ã‚’ã‹ã‘ã¦ï¼Œå…¨ä½“ã‹ã‚‰å¼•ãï¼ ï¼Šä¾‹ï¼Š ï¼‘ï¼(1ï¼0.81) Ã— (1ï¼0.64) = 0.9316 04. ãƒ•ã‚©ãƒ¯ãƒ¼ãƒ‰ï¼ãƒªãƒãƒ¼ã‚¹ãƒ—ãƒ­ã‚­ã‚·ã‚µãƒ¼ãƒ å½¹å‰² ãƒ»ä»£ç†ãƒªã‚¯ã‚¨ã‚¹ãƒˆæ©Ÿèƒ½ï¼ˆã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã®ãƒãƒ¼ãƒˆã‚‚å‚ç…§ï¼‰ ä»£ç†ã§ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é€ã‚‹ãƒ•ã‚©ãƒ¯ãƒ¼ãƒ‰ãƒ—ãƒ­ã‚­ã‚·ã‚µãƒ¼ãƒã¨ï¼Œãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’é€ã‚‹ãƒªãƒãƒ¼ã‚¹ãƒ—ãƒ­ã‚­ã‚·ã‚µãƒ¼ãƒã«åˆ†é¡ã§ãã‚‹ï¼ ãƒ»ã‚­ãƒ£ãƒƒã‚·ãƒ¥æ©Ÿèƒ½ ãƒªãƒãƒ¼ã‚¹ãƒ—ãƒ­ã‚­ã‚·ã‚µãƒ¼ãƒã«ï¼ŒWebãƒšãƒ¼ã‚¸ã®ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚’ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã¨ã—ã¦ä¿å­˜ã™ã‚‹ã“ã¨ã«ã‚ˆã£ã¦ï¼ŒWebã‚µãƒ¼ãƒã®ã‚¢ã‚¯ã‚»ã‚¹è² è·ã‚’æŠ‘ãˆã‚‹ï¼ã¡ãªã¿ã«ï¼Œãƒ–ãƒ©ã‚¦ã‚¶ã‚‚ã‚­ãƒ£ãƒƒã‚·ãƒ¥æ©Ÿèƒ½ã‚’æŒã£ã¦ã„ã‚‹ï¼ è¨­ç½®å ´æ‰€ ãƒ»ç‰©ç†ã‚µãƒ¼ãƒã®å ´åˆ ãƒ•ã‚©ãƒ¯ãƒ¼ãƒ‰ãƒ—ãƒ­ã‚­ã‚·ã‚µãƒ¼ãƒã¯ãƒ—ãƒ­ãƒã‚¤ãƒ€ã®ä¼šç¤¾ã«ï¼Œãƒªãƒãƒ¼ã‚¹ãƒ—ãƒ­ã‚­ã‚·ã‚µãƒ¼ãƒã¯ãƒªã‚¯ã‚¨ã‚¹ãƒˆå…ˆã®ç¤¾å†…ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã«è¨­ç½®ã•ã‚Œã¦ã„ã‚‹ï¼ ãƒ»ã‚¯ãƒ©ã‚¦ãƒ‰ä¸Šã®å ´åˆ ã‚¯ãƒ©ã‚¦ãƒ‰ã®å ´åˆã‚‚ï¼Œã‚µãƒ¼ãƒãŒä»®æƒ³çš„ã«æ§‹ç¯‰ã•ã‚Œã‚‹é•ã„ã ã‘ã§ï¼Œè¨­ç½®å ´æ‰€ã¯åŒã˜ã§ã‚ã‚‹ï¼ ãƒªãƒãƒ¼ã‚¹ãƒ—ãƒ­ã‚­ã‚·ã‚µãƒ¼ãƒã®å®Ÿç¾æ–¹æ³• ãƒ»Nginx Webã‚µãƒ¼ãƒã¨ã—ã¦ã§ã¯ãªãï¼Œãƒªãƒãƒ¼ã‚¹ãƒ—ãƒ­ã‚­ã‚·ã‚µãƒ¼ãƒã¨ã—ã¦ä½¿ç”¨ã—ï¼Œä»£ç†ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚„ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’è¡Œã‚ã›ã‚‹ã“ã¨ãŒå¯èƒ½ï¼ 04-02. ãƒ—ãƒ­ã‚­ã‚·ã‚µãƒ¼ãƒï¼ŒDNSã‚µãƒ¼ãƒã«ã‚ˆã‚‹åå‰è§£æ±º ï¼ˆ1ï¼‰å®Œå…¨ä¿®é£¾ãƒ‰ãƒ¡ã‚¤ãƒ³åã«å¯¾å¿œã™ã‚‹IPã‚¢ãƒ‰ãƒ¬ã‚¹ã®ãƒ¬ã‚¹ãƒãƒ³ã‚¹ ãƒ»ä»•çµ„ã¿ ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆPCã¯ï¼Œå®Œå…¨ä¿®é£¾ãƒ‰ãƒ¡ã‚¤ãƒ³åã‚’ï¼Œãƒ•ã‚©ãƒ¯ãƒ¼ãƒ‰ãƒ—ãƒ­ã‚­ã‚·ã‚µãƒ¼ãƒï¼ˆã‚­ãƒ£ãƒƒã‚·ãƒ¥DNSã‚µãƒ¼ãƒï¼‰ã«ãƒªã‚¯ã‚¨ã‚¹ãƒˆï¼ ãƒ•ã‚©ãƒ¯ãƒ¼ãƒ‰ãƒ—ãƒ­ã‚­ã‚·ã‚µãƒ¼ãƒã¯ï¼Œå®Œå…¨ä¿®é£¾ãƒ‰ãƒ¡ã‚¤ãƒ³åã‚’ï¼Œãƒªãƒãƒ¼ã‚¹ãƒ—ãƒ­ã‚­ã‚·ã‚µãƒ¼ãƒã«ä»£ç†ãƒªã‚¯ã‚¨ã‚¹ãƒˆï¼ ãƒªãƒãƒ¼ã‚¹ãƒ—ãƒ­ã‚­ã‚·ã‚µãƒ¼ãƒã¯ï¼Œå®Œå…¨ä¿®é£¾ãƒ‰ãƒ¡ã‚¤ãƒ³åã‚’ï¼ŒDNSã‚µãƒ¼ãƒï¼ˆãƒãƒ¼ãƒ ã‚µãƒ¼ãƒï¼‰ã«ä»£ç†ãƒªã‚¯ã‚¨ã‚¹ãƒˆï¼ DNSã‚µãƒ¼ãƒã¯ï¼Œå®Œå…¨ä¿®é£¾ãƒ‰ãƒ¡ã‚¤ãƒ³ã«ãƒãƒƒãƒ”ãƒ³ã‚°ã•ã‚Œã‚‹IPv4ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’å–å¾—ã—ï¼Œãƒªãƒãƒ¼ã‚¹ãƒ—ãƒ­ã‚­ã‚·ã‚µãƒ¼ãƒã«ãƒ¬ã‚¹ãƒãƒ³ã‚¹ï¼ | å®Œå…¨ä¿®é£¾ãƒ‰ãƒ¡ã‚¤ãƒ³å | â‡„ | IPv4ã‚¢ãƒ‰ãƒ¬ã‚¹ | | :--------------------------: | :--: | :-------------------: | | http://www.example.com | | 203.142.205.139 | ãƒªãƒãƒ¼ã‚¹ãƒ—ãƒ­ã‚­ã‚·ã‚µãƒ¼ãƒã¯ï¼ŒIPv4ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’ï¼Œãƒ•ã‚©ãƒ¯ãƒ¼ãƒ‰ãƒ—ãƒ­ã‚­ã‚·ã‚µãƒ¼ãƒã«ä»£ç†ãƒ¬ã‚¹ãƒãƒ³ã‚¹ï¼ï¼ˆâ€»NATã«ã‚ˆã‚‹IPv4ã‚¢ãƒ‰ãƒ¬ã‚¹ã®ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯é–“å¤‰æ›ãŒèµ·ã“ã‚‹ï¼‰ ãƒ•ã‚©ãƒ¯ãƒ¼ãƒ‰ãƒ—ãƒ­ã‚­ã‚·ã‚µãƒ¼ãƒã¯ï¼ŒIPv4ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’ï¼Œã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆPCã«ä»£ç†ãƒ¬ã‚¹ãƒãƒ³ã‚¹ï¼ ãƒ»ãƒ—ãƒ­ã‚­ã‚·ã‚µãƒ¼ãƒï¼ˆã‚­ãƒ£ãƒƒã‚·ãƒ¥DNSã‚µãƒ¼ãƒï¼‰ã«ãŠã‘ã‚‹DNSã‚­ãƒ£ãƒƒã‚·ãƒ¥ ãƒ«ãƒ¼ãƒˆã‚µãƒ¼ãƒã¯ä¸–ç•Œã«13æ©Ÿã—ã‹å­˜åœ¨ã—ã¦ãŠã‚‰ãšï¼Œä¸–ç•Œä¸­ã®åå‰è§£æ±ºã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’å…¨ã¦å‡¦ç†ã™ã‚‹ã“ã¨ã¯ç¾å®Ÿçš„ã«ä¸å¯èƒ½ã§ã‚ã‚‹ï¼ãã“ã§ï¼ŒIPã‚¢ãƒ‰ãƒ¬ã‚¹ã¨ãƒ‰ãƒ¡ã‚¤ãƒ³åã®é–¢ä¿‚ã‚’ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã™ã‚‹ãƒ—ãƒ­ã‚­ã‚·ã‚µãƒ¼ãƒï¼ˆã‚­ãƒ£ãƒƒã‚·ãƒ¥DNSã‚µãƒ¼ãƒï¼‰ãŒä½¿ç”¨ã•ã‚Œã¦ã„ã‚‹ï¼åŸºæœ¬çš„ã«ã¯ï¼Œãƒ—ãƒ­ã‚­ã‚·ã‚µãƒ¼ãƒã¨DNSã‚µãƒ¼ãƒã¯åŒºåˆ¥ã•ã‚Œã‚‹ï¼ãŸã ã—ï¼ŒAmazon Route53ã®ã‚ˆã†ã«ï¼Œãƒ—ãƒ­ã‚­ã‚·ã‚µãƒ¼ãƒã¨DNSã‚µãƒ¼ãƒã®æ©Ÿèƒ½ã‚’ä¸¡ç«‹ã—ã¦ã„ã‚‹ã‚‚ã®ã‚‚ã‚ã‚‹ï¼ ï¼ˆ2ï¼‰IPã‚¢ãƒ‰ãƒ¬ã‚¹ã«å¯¾å¿œã™ã‚‹Webãƒšãƒ¼ã‚¸ã®ãƒ¬ã‚¹ãƒãƒ³ã‚¹ ãƒ»ä»•çµ„ã¿ ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆPCã¯ï¼Œãƒ¬ã‚¹ãƒãƒ³ã‚¹ã•ã‚ŒãŸIPv4ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’åŸºã«ï¼ŒWebãƒšãƒ¼ã‚¸ã‚’ï¼Œãƒªãƒãƒ¼ã‚¹ãƒ—ãƒ­ã‚­ã‚·ã‚µãƒ¼ãƒã«ãƒªã‚¯ã‚¨ã‚¹ãƒˆï¼ ãƒªãƒãƒ¼ã‚¹ãƒ—ãƒ­ã‚­ã‚·ã‚µãƒ¼ãƒã¯ï¼ŒWebãƒšãƒ¼ã‚¸ã‚’ï¼ŒWebã‚µãƒ¼ãƒã«ä»£ç†ãƒªã‚¯ã‚¨ã‚¹ãƒˆï¼ Webã‚µãƒ¼ãƒã¯ï¼ŒWebãƒšãƒ¼ã‚¸ã‚’ï¼Œãƒªãƒãƒ¼ã‚¹ãƒ—ãƒ­ã‚­ã‚·ã‚µãƒ¼ãƒã«ãƒ¬ã‚¹ãƒãƒ³ã‚¹ï¼ ãƒªãƒãƒ¼ã‚¹ãƒ—ãƒ­ã‚­ã‚·ã‚µãƒ¼ãƒã¯ï¼ŒWebãƒšãƒ¼ã‚¸ã‚’ï¼Œã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆPCã«ä»£ç†ãƒ¬ã‚¹ãƒãƒ³ã‚¹ï¼ 06. ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯é€Ÿåº¦ã®æŒ‡æ¨™ ä¸€è¦§ ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚¿ã‚¤ãƒ  ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é€ä¿¡ã—ã¦ã‹ã‚‰ï¼Œã‚µãƒ¼ãƒãŒå‡¦ç†ã‚’å®Ÿè¡Œã—ï¼Œãƒ¬ã‚¹ãƒãƒ³ã‚¹ãŒè¿”ä¿¡ã•ã‚Œã‚‹ã¾ã§ã«è¦ã™ã‚‹æ™‚é–“ã®ã“ã¨ï¼ ãƒ¬ã‚¤ãƒ†ãƒ³ã‚·ãƒ¼ ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é€ä¿¡ã—ã¦ã‹ã‚‰ï¼Œãƒ¬ã‚¹ãƒãƒ³ã‚¹ãŒè¿”ä¿¡ã•ã‚Œã‚‹ã¾ã§è¦ã™ã‚‹æ™‚é–“ã®ã“ã¨ï¼ã‚µãƒ¼ãƒã®å‡¦ç†æ™‚é–“ã¯å«ã¾ãªã„ï¼ Connection Timeï¼ˆæ¥ç¶šæ™‚é–“ï¼‰ ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é€ä¿¡ã™ã‚‹å‰ã«ï¼Œã‚µãƒ¼ãƒã¨ã®TCPæ¥ç¶šã®ç¢ºç«‹ã«è¦ã™ã‚‹æ™‚é–“ã®ã“ã¨ï¼ ãƒªã‚¯ã‚¨ã‚¹ãƒˆã¨ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã®é€å—ä¿¡ã®å‰å¾Œã«è¡Œã‚ã‚Œã‚‹TCPæ¥ç¶šã®ç¢ºç«‹ã‚’ã€Œã‚¹ãƒªãƒ¼ã‚¦ã‚§ã‚¤ãƒãƒ³ãƒ‰ã‚·ã‚§ã‚¤ã‚¯ã€ã¨ã„ã†ï¼ Bandwidthï¼ˆå¸¯åŸŸå¹…ï¼‰ ä¸€åº¦ã«é€å—ä¿¡ã§ãã‚‹ãƒ‡ãƒ¼ã‚¿ã®æœ€å¤§å®¹é‡ã®ã“ã¨ï¼ ã‚¹ãƒ«ãƒ¼ãƒ—ãƒƒãƒˆï¼ˆä¼é€é€Ÿåº¦ï¼‰ å˜ä½æ™‚é–“å½“ãŸã‚Šã®é€ä¿¡ã§ãã‚‹æœ€å¤§ã®ãƒ‡ãƒ¼ã‚¿å®¹é‡ã®ã“ã¨ï¼ ä»–ã‹ã‚‰ã®å½±éŸ¿ã‚’å—ã‘ãŸå®Ÿéš›ã®ã‚¹ãƒ«ãƒ¼ãƒ—ãƒƒãƒˆã‚’ã€Œå®ŸåŠ¹ã‚¹ãƒ«ãƒ¼ãƒ—ãƒƒãƒˆã€ã¨ã„ã†ï¼ ã‚¹ãƒ«ãƒ¼ãƒ—ãƒƒãƒˆï¼ˆä¼é€é€Ÿåº¦ï¼‰ ãƒ»ä¼é€ã¨ã¯ ã‚µãƒ¼ãƒã‹ã‚‰ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆPCã«ãƒ‡ãƒ¼ã‚¿ã‚’é€ä¿¡ã™ã‚‹ã“ã¨ï¼ç›¸äº’ã®é€ä¿¡ã¯ï¼Œé€šä¿¡ã¨å‘¼ã¶ï¼ ãƒ»ã‚¹ãƒ«ãƒ¼ãƒ—ãƒƒãƒˆã¨ã¯ å˜ä½æ™‚é–“å½“ãŸã‚Šã®é€ä¿¡ã§ãã‚‹æœ€å¤§ã®ãƒ‡ãƒ¼ã‚¿å®¹é‡ã®ã“ã¨ï¼å®Ÿéš›ã«ã¯ï¼Œã‚¹ãƒ«ãƒ¼ãƒ—ãƒƒãƒˆã¯ï¼Œã€ãƒ—ãƒ­ãƒã‚¤ãƒ€ã€ï¼Œã€å…‰å›ç·šã€ï¼Œã€è‡ªå®…ã®æœ‰ç·šï¼ç„¡ç·šã€ã®ä¸‰ã¤ã«å½±éŸ¿ã•ã‚Œã‚‹ãŸã‚ï¼Œã‚¹ãƒ«ãƒ¼ãƒ—ãƒƒãƒˆã§æœŸå¾…ã•ã‚Œã‚‹ãƒ‡ãƒ¼ã‚¿å®¹é‡ã‚’æº€ãŸã›ãªã„ã“ã¨ãŒå¤šã„ï¼å®Ÿéš›ã®ã‚¹ãƒ«ãƒ¼ãƒ—ãƒƒãƒˆã‚’ã€Œå®ŸåŠ¹ã‚¹ãƒ«ãƒ¼ãƒ—ãƒƒãƒˆã€ã¨ã„ã†ï¼ ãƒ»ä¼é€ç§’æ•°ã®æ±‚ã‚æ–¹ (ä¼é€ç§’æ•°) = ãƒ‡ãƒ¼ã‚¿å®¹é‡(bit) Ã· ã‚¹ãƒ«ãƒ¼ãƒ—ãƒƒãƒˆ(bit/s) Ã— ä¼é€åŠ¹ç‡ ãƒ»ãƒˆãƒ©ãƒ•ã‚£ãƒƒã‚¯ã¨ã¯ ã¨ã‚ã‚‹ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯åœ°ç‚¹ã§ã®ã‚¹ãƒ«ãƒ¼ãƒ—ãƒƒãƒˆã®ã“ã¨ï¼ å‚è€ƒï¼šhttps://xtech.nikkei.com/it/article/Keyword/20070222/262872/ ç·å‹™çœã®ãƒ‡ãƒ¼ã‚¿ã§ï¼Œæ—¥æœ¬ã®ãƒ–ãƒ­ãƒ¼ãƒ‰ãƒãƒ³ãƒ‰å¤§æ‰‹5ç¤¾ã®ç·ãƒˆãƒ©ãƒ•ã‚£ãƒƒã‚¯ã‚’å¹´æ¬¡ã§ã‚°ãƒ©ãƒ•åŒ–ã—ãŸã‚‚ã®ãŒã‚ã‚‹ï¼ å‚è€ƒï¼šhttps://xtech.nikkei.com/atcl/nxt/column/18/00525/112900001/ "},"public/network/network_osi_tcp_model.html":{"url":"public/network/network_osi_tcp_model.html","title":"ğŸ“– ï¸OSIå‚ç…§ãƒ¢ãƒ‡ãƒ«ï¼TCPéšå±¤ãƒ¢ãƒ‡ãƒ«","keywords":"","body":"OSIå‚ç…§ãƒ¢ãƒ‡ãƒ«ï¼TCPéšå±¤ãƒ¢ãƒ‡ãƒ« ã¯ã˜ã‚ã« æœ¬ã‚µã‚¤ãƒˆã«ã¤ãã¾ã—ã¦ï¼Œä»¥ä¸‹ã‚’ã”èªè­˜ã®ã»ã©å®œã—ããŠé¡˜ã„ã„ãŸã—ã¾ã™ï¼ å‚è€ƒï¼šhttps://hiroki-it.github.io/tech-notebook-gitbook/ 01. OSIå‚ç…§ãƒ¢ãƒ‡ãƒ«ã¨TCPéšå±¤ãƒ¢ãƒ‡ãƒ« ãƒ‡ãƒ¼ã‚¿ãŒãƒ‘ã‚±ãƒƒãƒˆã«ãªã‚‹ã¾ã§ ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å±¤ã§ãƒ‡ãƒ¼ã‚¿ãŒä½œæˆã•ã‚Œã‚‹ï¼ ãƒˆãƒ©ãƒ³ã‚¹ãƒãƒ¼ãƒˆå±¤ã§TCPãƒ˜ãƒƒãƒ€ãŒè¿½åŠ ã•ã‚Œã‚‹ï¼ ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆå±¤ã§IPãƒ˜ãƒƒãƒ€ãŒè¿½åŠ ã•ã‚Œã‚‹ï¼ ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹å±¤ã§Ethernetãƒ˜ãƒƒãƒ€ãŒè¿½åŠ ã•ã‚Œã‚‹ï¼ ãƒ‘ã‚±ãƒƒãƒˆã¨ã—ã¦é€ä¿¡ã•ã‚Œã‚‹ï¼ OSIå‚ç…§ãƒ¢ãƒ‡ãƒ« ãƒ»å„æ¦‚å¿µå±¤ã®ãƒ˜ãƒƒãƒ€æƒ…å ±è¿½åŠ  TCPéšå±¤ãƒ¢ãƒ‡ãƒ« ãƒ»ãƒ—ãƒ­ãƒˆã‚³ãƒ«ã®åˆ†é¡ã¨æ‰±ã‚ã‚Œã‚‹éšå±¤ TCP/IPãƒ¢ãƒ‡ãƒ«ã§ç”¨ã„ã‚‰ã‚Œã‚‹ãƒ—ãƒ­ãƒˆã‚³ãƒ«ã®ã†ã¡ï¼Œæœ€ã‚‚ä»£è¡¨çš„ãªã€ŒTCPã€ã¨ã€ŒIPã€ã‹ã‚‰åå‰ã‚’ã¨ã£ã¦ã€ŒTCP/IPã€ã¨åä»˜ã‘ã‚‰ã‚ŒãŸï¼ãƒ—ãƒ­ãƒˆã‚³ãƒ«ã¨ã—ã¦ã®æš—å·åŒ–æŠ€è¡“ã§ã‚ã‚‹ã€ã‚»ã‚­ãƒ¥ã‚¢ãƒ—ãƒ­ãƒˆã‚³ãƒ«ã€ã¯ï¼Œèµ¤è‰²ã§ç¤ºã—ã¦ã‚ã‚‹ï¼ 02-02. é€šä¿¡æ©Ÿå™¨ã«ãŠã‘ã‚‹ãƒ˜ãƒƒãƒ€æƒ…å ±èªè­˜ å„æ¦‚å¿µå±¤ã¨é€šä¿¡æ©Ÿå™¨ã®é–“ã®å¯¾å¿œé–¢ä¿‚ ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã«ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆPCãŒã‚ã‚‹ï¼ ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆPCã«ã¦ï¼ŒWebãƒ–ãƒ©ã‚¦ã‚¶ã®ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ãƒ—ãƒ­ã‚»ã‚¹ãŒTCPã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å±¤ï¼ˆOSIã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å±¤ï¼‹ãƒ—ãƒ¬ã‚¼ãƒ³ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³å±¤ï¼‹ã‚»ãƒƒã‚·ãƒ§ãƒ³å±¤ï¼‰ã§ç¨¼åƒã—ã¦ã„ã‚‹ï¼ã“ã“ã§ï¼Œãƒ‘ã‚±ãƒƒãƒˆãŒä½œæˆã•ã‚Œã‚‹ï¼ ãƒ‘ã‚±ãƒƒãƒˆã¯ï¼Œã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆPCã®TCPãƒˆãƒ©ãƒ³ã‚¹ãƒãƒ¼ãƒˆå±¤ï¼ˆOSIãƒˆãƒ©ãƒ³ã‚¹ãƒãƒ¼ãƒˆå±¤ï¼‰ï¼ŒTCPã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆå±¤ï¼ˆOSIãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯å±¤ï¼‰ï¼ŒTCPãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹å±¤ï¼ˆOSIãƒ‡ãƒ¼ã‚¿ãƒªãƒ³ã‚¯å±¤ï¼‹OSIç‰©ç†å±¤ï¼‰ã‚’çµŒã‚‹ï¼å„å±¤ã§ï¼Œãƒ‘ã‚±ãƒƒãƒˆã«ãƒ˜ãƒƒãƒ€ãƒ¼æƒ…å ±ãŒè¿½åŠ ã•ã‚Œã‚‹ï¼ PCã‹ã‚‰ãƒ«ãƒ¼ã‚¿ã«ãƒ‘ã‚±ãƒƒãƒˆãŒé€ä¿¡ã•ã‚Œã‚‹ï¼ ãƒ«ãƒ¼ã‚¿ã¯TCPã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆå±¤ï¼ˆOSIãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯å±¤ï¼‰ã«å±ã™ã‚‹ãŸã‚ï¼Œã‚ˆã‚Šä¸Šå±¤ã«ä¸€åº¦æˆ»ã‚‹ã“ã¨ã«ãªã‚‹ï¼ ã‚°ãƒ­ãƒ¼ãƒãƒ«ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚’çµŒã¦ï¼Œé€ä¿¡å…ˆã®ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã®ãƒ«ãƒ¼ã‚¿ã«åˆ°é”ã™ã‚‹ï¼ ãƒ«ãƒ¼ã‚¿ã‹ã‚‰ã‚µãƒ¼ãƒã«ãƒ‘ã‚±ãƒƒãƒˆãŒé€ä¿¡ã•ã‚Œã‚‹ï¼ ãƒ‘ã‚±ãƒƒãƒˆã¯ï¼Œã‚µãƒ¼ãƒã®CPãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹å±¤ï¼ˆOSIãƒ‡ãƒ¼ã‚¿ãƒªãƒ³ã‚¯å±¤ï¼‹OSIç‰©ç†å±¤ï¼‰ï¼ŒTCPã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆå±¤ï¼ˆOSIãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯å±¤ï¼‰ï¼ŒTCPãƒˆãƒ©ãƒ³ã‚¹ãƒãƒ¼ãƒˆå±¤ï¼ˆOSIãƒˆãƒ©ãƒ³ã‚¹ãƒãƒ¼ãƒˆå±¤ï¼‰ï¼Œã‚’çµŒã‚‹ï¼ ã‚µãƒ¼ãƒã«ã¦ï¼Œã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ãƒ—ãƒ­ã‚»ã‚¹ãŒç‰¹å®šã®ãƒãƒ¼ãƒˆç•ªã§ãƒªãƒƒã‚¹ãƒ³ã—ã¦ã„ã‚‹ï¼ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã«ã‚ˆã£ã¦ãƒ‘ã‚±ãƒƒãƒˆãŒå‡¦ç†ã•ã‚Œã‚‹ï¼ ãƒ»ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯å±¤ ãƒ»ãƒ‡ãƒ¼ã‚¿ãƒªãƒ³ã‚¯å±¤ ãƒ»ç‰©ç†å±¤ NICï¼šNetwork Interface Cardï¼ˆä¾‹ï¼šLANã‚¢ãƒ€ãƒ—ã‚¿ï¼ŒLANãƒœãƒ¼ãƒ‰ï¼ŒLANã‚«ãƒ¼ãƒ‰ï¼‰ï¼Œãƒªãƒ”ãƒ¼ã‚¿ï¼ŒLANã‚±ãƒ¼ãƒ–ãƒ« å„æ¦‚å¿µå±¤ã®ãƒ˜ãƒƒãƒ€æƒ…å ±èªè­˜ é€ä¿¡å…ƒã§ä½œæˆã•ã‚ŒãŸãƒ‘ã‚±ãƒƒãƒˆã¯ï¼Œéã‚«ãƒ—ã‚»ãƒ«åŒ–ã•ã‚ŒãªãŒã‚‰ï¼Œé€šä¿¡æ©Ÿå™¨ã«èªè­˜ã•ã‚Œã‚‹ï¼ å‚è€ƒï¼šhttps://ja.wikipedia.org/wiki/%E3%83%AB%E3%83%BC%E3%82%BF%E3%83%BC 03. TCPã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å±¤ ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å±¤ã¨ã¯ å„ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãŒãƒ—ãƒ­ã‚»ã‚¹ã¨ã—ã¦ç¨¼åƒã—ã¦ãŠã‚Šï¼Œãã‚Œãã‚ŒãŒãƒ‡ãƒ¼ã‚¿ï¼ˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ï¼‰ã‚’ä½œæˆã™ã‚‹ï¼å„ãƒ—ãƒ­ã‚»ã‚¹ã¯ç‰¹å®šã®ãƒãƒ¼ãƒˆç•ªå·ã‚’ãƒªãƒƒã‚¹ãƒ³ã™ã‚‹ï¼ å‚è€ƒï¼šhttps://netdekagaku.com/netstat-command/ ã¡ãªã¿ã«ï¼ŒæŒ‡å®šã—ãŸãƒãƒ¼ãƒˆç•ªå·ã§ãƒªãƒƒã‚¹ãƒ³ã—ã¦ã„ã‚‹ãƒ—ãƒ­ã‚»ã‚¹ã‚’ç‰¹å®šã§ãã‚‹ï¼ $ sudo lsof -i: 03-02. ãƒ¡ãƒ¼ãƒ«ãƒ‡ãƒ¼ã‚¿ã®ä½œæˆ ãƒ¡ãƒ¼ãƒ«ãƒ‡ãƒ¼ã‚¿ã®é€å—ä¿¡ ãƒ»ä»•çµ„ã¿ ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆï¼ˆãƒ¡ãƒ¼ãƒ«é€ä¿¡å¯èƒ½ãªã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ï¼‰ã‹ã‚‰é€ä¿¡ã•ã‚ŒãŸãƒ¡ãƒ¼ãƒ«ã¯ï¼Œé€ä¿¡å´ã®ãƒ¡ãƒ¼ãƒ«ã‚µãƒ¼ãƒã«é€ä¿¡ã•ã‚Œã‚‹ï¼ é€ä¿¡å´ã®ãƒ¡ãƒ¼ãƒ«ã‚µãƒ¼ãƒã¯ï¼Œãƒ¡ãƒ¼ãƒ«ã‚’å—ä¿¡å´ã®ãƒ¡ãƒ¼ãƒ«ã‚µãƒ¼ãƒã«è»¢é€ã™ã‚‹ï¼ å—ä¿¡å´ã®ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã¯ï¼Œå„ã€…ãŒæŒ‡å®šã—ãŸãƒ—ãƒ­ãƒˆã‚³ãƒ«ã«å¿œã˜ã¦ï¼Œå—ä¿¡å´ã®ãƒ¡ãƒ¼ãƒ«ã‚µãƒ¼ãƒã‹ã‚‰ãƒ¡ãƒ¼ãƒ«ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ã™ã‚‹ï¼ å‚è€ƒï¼šhttps://xtech.nikkei.com/it/pc/article/basic/20120312/1043605/ ãƒ»é€ä¿¡å´ã®ãƒ¡ãƒ¼ãƒ«ã‚µãƒ¼ãƒã®ãƒ¢ãƒƒã‚¯ ãƒ¡ãƒ¼ãƒ«ãƒ‡ãƒ¼ã‚¿ã®é€ä¿¡æ©Ÿèƒ½ã‚’é–‹ç™ºã™ã‚‹ã¨ãã«ï¼Œé€ä¿¡ãƒ†ã‚¹ãƒˆã‚’è¡Œã†å¿…è¦ãŒã‚ã‚Šï¼Œã“ã®å†…å®¹ã¯å…¬é–‹ã—ãŸããªã„ï¼ãã“ã§ï¼Œé€ä¿¡å´ã®ãƒ¡ãƒ¼ãƒ«ã‚µãƒ¼ãƒã®ãƒ¢ãƒƒã‚¯ã‚’æä¾›ã™ã‚‹ã‚µãƒ¼ãƒ“ã‚¹ã‚’åˆ©ç”¨ã™ã‚‹ï¼ã“ã®é€ä¿¡å´ãƒ¡ãƒ¼ãƒ«ã‚µãƒ¼ãƒãƒ¢ãƒƒã‚¯ã¯ï¼Œã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‹ã‚‰é€ä¿¡ã•ã‚ŒãŸãƒ¡ãƒ¼ãƒ«ã®ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ã‚’å—ä¿¡å´ã®ãƒ¡ãƒ¼ãƒ«ã‚µãƒ¼ãƒã«è»¢é€ã—ãªã„ãŸã‚ï¼Œå®‰å…¨ã«é€ä¿¡ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œã§ãã‚‹ï¼MailtrapãŒãŠã™ã™ã‚ã§ã‚ã‚‹ï¼ å‚è€ƒï¼šhttps://mailtrap.io/ SMTPï¼šSimple Mail Transfer Protocol ãƒ»SMTPã¨ã¯ ãƒ¡ãƒ¼ãƒ«ãƒ‡ãƒ¼ã‚¿ã‚’é€ä¿¡ã™ã‚‹ãŸã‚ã®ãƒ—ãƒ­ãƒˆã‚³ãƒ«ã®ã“ã¨ï¼ ãƒ»SMTP-AUTHï¼šSMTP AUTHentication SMTPã«èªè¨¼ã‚’çµ„ã¿è¾¼ã‚“ã ä»•çµ„ã¿ã®ã“ã¨ï¼ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆï¼ˆãƒ¡ãƒ¼ãƒ«é€ä¿¡å¯èƒ½ãªã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ï¼‰ã‹ã‚‰ãƒ¡ãƒ¼ãƒ«ã‚µãƒ¼ãƒã«ãƒ¡ãƒ¼ãƒ«ãƒ‡ãƒ¼ã‚¿ã‚’SMTPé€ä¿¡ã™ã‚‹æ™‚ï¼Œãƒ¡ãƒ¼ãƒ«ã‚µãƒ¼ãƒãŒã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã«å¯¾ã—ã¦èªè¨¼ã‚’å®Ÿè¡Œã™ã‚‹ï¼ POP3ï¼šPost Official Protocol version 3 ãƒ»POP3ã¨ã¯ ãƒ¡ãƒ¼ãƒ«ã‚µãƒ¼ãƒã«å±Šã„ãŸãƒ¡ãƒ¼ãƒ«ã‚’ï¼Œå—ä¿¡æ©Ÿå™¨ã«ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ï¼Œå—ä¿¡æ©Ÿå™¨ã§é–²è¦§ã™ã‚‹ãƒ—ãƒ­ãƒˆã‚³ãƒ«ï¼ãƒ¡ãƒ¼ãƒ«ã®æ—¢èª­æœªèª­çŠ¶æ³ã¯ï¼Œä»–ã®å—ä¿¡æ©Ÿå™¨ã¨å…±æœ‰ã•ã‚Œã‚‹ï¼ IMAP4ï¼šInternet Message Access Protocol version 4 ãƒ»IMAP4ã¨ã¯ ãƒ¡ãƒ¼ãƒ«ã‚µãƒ¼ãƒã«å±Šã„ãŸãƒ¡ãƒ¼ãƒ«ã‚’ï¼Œå—ä¿¡æ©Ÿå™¨ã«ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã›ãšï¼Œãƒ¡ãƒ¼ãƒ«ã‚µãƒ¼ãƒã«ç½®ã„ãŸã¾ã¾é–²è¦§ã™ã‚‹ãƒ—ãƒ­ãƒˆã‚³ãƒ«ï¼ãƒ¡ãƒ¼ãƒ«ã®æ—¢èª­æœªèª­çŠ¶æ³ã¯ï¼Œä»–ã®å—ä¿¡æ©Ÿå™¨ã¨å…±æœ‰ã•ã‚Œãªã„ï¼ ï¼Šä¾‹ï¼Š Gmailã§POPã‹IMAPã‚’è¨­å®šå¯èƒ½ APOPï¼šAuthenticated POP ãƒ»APOPã¨ã¯ ãƒ¡ãƒ¼ãƒ«å—ä¿¡ã®éš›ã«ï¼Œãƒãƒ£ãƒ¬ãƒ³ã‚¸ãƒ¬ã‚¹ãƒãƒ³ã‚¹æ–¹å¼ã®èªè¨¼ã‚’è¡Œã†ã“ã¨ã§å¹³æ–‡ã®èªè¨¼æƒ…å ±ãŒãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã«æµã‚Œã‚‹ã®ã‚’é˜²æ­¢ã™ã‚‹ãƒ—ãƒ­ãƒˆã‚³ãƒ« 04. TCPãƒˆãƒ©ãƒ³ã‚¹ãƒãƒ¼ãƒˆå±¤ ãƒˆãƒ©ãƒ³ã‚¹ãƒãƒ¼ãƒˆå±¤ã¨ã¯ ãƒ»å…¨ä½“åƒ ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‹ã‚‰ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆæ™‚ã«ï¼Œãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯å±¤ã‹ã‚‰æ¸¡ã•ã‚ŒãŸãƒ‘ã‚±ãƒƒãƒˆã®ãƒãƒ¼ãƒˆç•ªå·æƒ…å ±ã‚’å…ƒã«ï¼Œã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å±¤ã®ç‰¹å®šã®ãƒ—ãƒ­ã‚»ã‚¹ã«ãƒ‘ã‚±ãƒƒãƒˆã‚’æ¸¡ã™ï¼ã¾ãŸåå¯¾ã«ï¼Œãƒ¬ã‚¹ãƒãƒ³ã‚¹æ™‚ã«ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å±¤ã®ãƒ—ãƒ­ã‚»ã‚¹ã‹ã‚‰å‡ºåŠ›ã•ã‚ŒãŸãƒ‘ã‚±ãƒƒãƒˆã«æƒ…å ±ã‚’ä»˜åŠ ã—ï¼Œãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯å±¤ã«æ¸¡ã™ï¼ã“ã®æ™‚ï¼Œå„ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã¯ãƒ—ãƒ­ã‚»ã‚¹ã¨ã—ã¦ç¨¼åƒã—ã¦ã„ã‚‹ã“ã¨ã«ç•™æ„ã™ã‚‹ï¼ ãƒ»ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‹ã‚‰ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆæ™‚ï¼ˆå›³ã® ã€Œâ†’ã€ ï¼‰ ã¾ãšï¼Œãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯å±¤ã§ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆIPã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’ç”¨ã„ã¦ï¼Œãƒªã‚¯ã‚¨ã‚¹ãƒˆå…ˆã®ãƒ‘ã‚½ã‚³ãƒ³ã‚’è­˜åˆ¥ã™ã‚‹ï¼ãã®å¾Œï¼Œãƒˆãƒ©ãƒ³ã‚¹ãƒãƒ¼ãƒˆå±¤ã§ï¼Œãƒãƒ¼ãƒˆç•ªå·ã‚’å…ƒã«ã—ã¦ï¼Œã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å±¤ã®ãƒ—ãƒ­ã‚»ã‚¹ã«ãƒ‘ã‚±ãƒƒãƒˆã‚’é€ä¿¡ã™ã‚‹ï¼ ï¼Šä¾‹ï¼Š ãƒ­ãƒ¼ã‚«ãƒ«ç’°å¢ƒã®nginxãƒ—ãƒ­ã‚»ã‚¹ã®ãƒªãƒƒã‚¹ãƒ³ã™ã‚‹ãƒãƒ¼ãƒˆç•ªå·ã‚’8080ã¨è¨­å®šã—ãŸå ´åˆï¼Œãƒªã‚¯ã‚¨ã‚¹ãƒˆæ™‚ã«ä»¥ä¸‹ã®ã‚ˆã†ã«ãƒãƒ¼ãƒˆç•ªå·ã‚’æŒ‡å®šã™ã‚‹ã¨ï¼Œnginxãƒ—ãƒ­ã‚»ã‚¹ã«ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é€ä¿¡ã§ãã‚‹ï¼ GET http://localhost:8080/ ãƒ»ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã¸ã®ãƒ¬ã‚¹ãƒãƒ³ã‚¹æ™‚ï¼ˆå›³ã® ã€Œâ†ã€ ï¼‰ ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å±¤ã‹ã‚‰é€ä¿¡ã•ã‚Œã¦ããŸãƒ‘ã‚±ãƒƒãƒˆã®é€šéã—ãŸãƒãƒ¼ãƒˆç•ªå·ã‚’ãƒ˜ãƒƒãƒ€æƒ…å ±ã¨ã—ã¦è¿½åŠ ã™ã‚‹ï¼ã“ã‚Œã‚’ï¼Œãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯å±¤ã¸é€ä¿¡ã™ã‚‹ï¼ ãƒ»ã‚½ã‚±ãƒƒãƒˆï¼Œã‚½ã‚±ãƒƒãƒˆæ¥ç¶šã¨ã¯ ãƒˆãƒ©ãƒ³ã‚¹ãƒãƒ¼ãƒˆå±¤ã«å­˜åœ¨ã—ï¼Œå—ä¿¡ã—ãŸé€šä¿¡ã‚’ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å±¤ã®å„ãƒ—ãƒ­ã‚»ã‚¹ã«æŒ¯ã‚Šåˆ†ã‘ã‚‹å—ã‘å£ã‚’ã‚½ã‚±ãƒƒãƒˆã¨ã„ã†ï¼é€ä¿¡å…ƒã®ã‚µãƒ¼ãƒãŒé€ä¿¡å…ˆã«å¯¾ã—ã¦ï¼Œã€192.168.1.1:50001ï¼ˆé€ä¿¡å…ƒIPã‚¢ãƒ‰ãƒ¬ã‚¹:é€ä¿¡ãƒãƒ¼ãƒˆï¼‰ã€ã€10.0.0.1:80ï¼ˆå®›å…ˆIPã‚¢ãƒ‰ãƒ¬ã‚¹:å®›å…ˆãƒãƒ¼ãƒˆï¼‰ã€ã¨ã„ã£ãŸã‚ˆã†ã«ï¼ŒIPã‚¢ãƒ‰ãƒ¬ã‚¹ã¨ãƒãƒ¼ãƒˆç•ªå·ã®çµ„åˆã›ã§æŒ‡å®šã™ã‚‹ï¼ã‚ªãƒªã‚¸ãƒ³ã¨ã¯ä¼¼ã¦éãªã‚‹ã‚‚ã®ãªã®ã§æ³¨æ„ï¼ã‚µãƒ¼ãƒé–“ã®ã‚½ã‚±ãƒƒãƒˆé–“ã®ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯æ¥ç¶šã‚’ã‚½ã‚±ãƒƒãƒˆæ¥ç¶šã¨ã„ã†ï¼ ãƒãƒ¼ãƒˆç•ªå· ãƒ»ãƒãƒ¼ãƒˆç•ªå·ã¨ã¯ ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ãƒ—ãƒ­ã‚»ã‚¹ã¸ã®ãƒ‘ã‚±ãƒƒãƒˆé€å—ä¿¡ã«ï¼Œãƒ—ãƒ­ã‚»ã‚¹ã‚’åŒºåˆ¥ã™ã‚‹ãŸã‚ã«å„ãƒ—ãƒ­ã‚»ã‚¹ã«å‰²ã‚Šå½“ã¦ã‚‰ã‚Œã‚‹ç•ªå·ï¼ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã«ã¯ï¼Œãã‚Œãã‚Œãƒãƒ¼ãƒˆç•ªå·ãŒå‰²ã‚Šå½“ã¦ã‚‰ã‚Œã¦ãŠã‚Šï¼Œãƒˆãƒ©ãƒ³ã‚¹ãƒãƒ¼ãƒˆå±¤ã§ï¼Œãƒãƒ¼ãƒˆç•ªå·ã‚’å…ƒã«ã—ã¦ï¼Œç‰¹å®šã®ãƒ—ãƒ­ã‚»ã‚¹ã«ãƒ‘ã‚±ãƒƒãƒˆã‚’é€ä¿¡ã™ã‚‹ï¼ ãƒ»Well known ãƒãƒ¼ãƒˆç•ªå·ï¼ˆ0 ï½ 1023ï¼‰ IANAï¼šInternet Assigned Numbers Authorityï¼ˆã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆå‰²å½“ç•ªå·å…¬ç¤¾ï¼‰ã«ã‚ˆã£ã¦ç®¡ç†ã•ã‚Œã¦ã„ã‚‹ãƒãƒ¼ãƒˆç•ªå·ï¼Webã‚µãƒ¼ãƒãŒãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’å—ä¿¡ã™ã‚‹æ™‚ï¼Œã¾ãŸãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’é€ä¿¡ã™ã‚‹æ™‚ã«ä½¿ç”¨ã•ã‚Œã‚‹ï¼ãƒ›ã‚¹ãƒˆOSã¨ã‚²ã‚¹ãƒˆï¼ˆä»®æƒ³ã‚µãƒ¼ãƒï¼‰ã¨ã®é€šä¿¡ã§ã¯ï¼Œ80ç•ªï¼ˆHTTPï¼‰ã®å—ä¿¡ã«é–¢ã™ã‚‹æ§˜ã€…ãªè¨­å®šãŒå¿…è¦ã«ãªã‚‹ï¼ ãƒ»ç™»éŒ²æ¸ˆã¿ãƒãƒ¼ãƒˆç•ªå·ï¼ˆ1024 ï½ 49151ï¼‰ IANAãŒç™»éŒ²ç”³è«‹ã‚’å—ã‘ã¦å…¬é–‹ã—ã¦ã„ã‚‹ãƒãƒ¼ãƒˆç•ªå·ï¼ä¼æ¥­ãŒä½œæˆã—ãŸç‹¬è‡ªã®ã‚¢ãƒ—ãƒªãªã©ã«å¯¾ã—ã¦å‰²ã‚Šå½“ã¦ã‚‰ã‚Œã‚‹ï¼ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆãŒãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é€ä¿¡ã™ã‚‹æ™‚ï¼Œã¾ãŸãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’å—ä¿¡ã™ã‚‹æ™‚ã«ä½¿ç”¨ã•ã‚Œã‚‹ï¼ ãƒ»å‹•çš„ï¼éå…¬å¼ãƒãƒ¼ãƒˆç•ªå·ï¼ˆ49152 ï½ 65535ï¼‰ è‡ªç”±ã«ä½¿ç”¨ã§ãã‚‹ãƒãƒ¼ãƒˆç•ªå·ï¼ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆãŒãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é€ä¿¡ã™ã‚‹æ™‚ï¼Œã¾ãŸãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’å—ä¿¡ã™ã‚‹æ™‚ã«ä½¿ç”¨ã•ã‚Œã‚‹ï¼ ãƒ»ãƒãƒ¼ãƒˆãƒ•ã‚©ãƒ¯ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ï¼ˆãƒãƒ¼ãƒˆè»¢é€ï¼‰ ã‚µãƒ¼ãƒå†…ã®ç‰¹å®šã®ãƒãƒ¼ãƒˆç•ªå·ã®ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã«å¯¾ã—ã¦ï¼Œãƒ‘ã‚±ãƒƒãƒˆãŒé€ä¿¡ã•ã‚Œã¦ããŸæ™‚ï¼Œã“ã‚Œã‚’ç•°ãªã‚‹ãƒãƒ¼ãƒˆç•ªå·ã®ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã«è»¢é€ã™ã‚‹ã“ã¨ï¼SSHãƒ—ãƒ­ãƒˆã‚³ãƒ«ã¨çµ„ã¿åˆã‚ã›ã‚‹ã¨ï¼ŒSSHãƒãƒ¼ãƒˆãƒ•ã‚©ãƒ¯ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã‚’å®Ÿç¾ã§ãã‚‹ï¼ ãƒãƒ¼ãƒˆã‚¹ã‚­ãƒ£ãƒŠ ãƒ»ãƒãƒ¼ãƒˆã‚¹ã‚­ãƒ£ãƒŠã¨ã¯ ãƒãƒ¼ãƒˆã‚¹ã‚­ãƒ£ãƒŠã‚’ç”¨ã„ã‚‹ã“ã¨ã«ã‚ˆã£ã¦ï¼Œå„ãƒãƒ¼ãƒˆç•ªå·ã«ã‚¢ã‚¯ã‚»ã‚¹ã—ï¼Œå¿œç­”ãŒã‚ã‚‹ã‹ã©ã†ã‹ã‚„ï¼Œã©ã®ã‚ˆã†ãªã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ãŒå¿œç­”ã™ã‚‹ã‹ã‚’èª¿ã¹ï¼Œä¸€è¦§è¡¨ç¤ºã§ãã‚‹ï¼ 05. TCPã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆå±¤ ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆå±¤ã¨ã¯ IPãƒ‘ã‚±ãƒƒãƒˆã®ãƒ˜ãƒƒãƒ€æƒ…å ±ã‚’ç”¨ã„ã¦ï¼Œå®›å…ˆèªè­˜ã™ã‚‹ï¼ PC-Aã¯ï¼Œæ§‹æˆã—ãŸIPãƒ‘ã‚±ãƒƒãƒˆã‚’Ethernetã«ä¹—ã›ã¦ï¼Œãƒ«ãƒ¼ã‚¿Aã«é€ä¿¡ï¼ ãƒ«ãƒ¼ã‚¿Aã¯ï¼ŒIPãƒ‘ã‚±ãƒƒãƒˆã‚’ãƒ‡ã‚¸ã‚¿ãƒ«å°‚ç”¨ç·šã«ä¹—ã›ã¦ï¼Œãƒ«ãƒ¼ã‚¿Bã«é€ä¿¡ï¼ ãƒ«ãƒ¼ã‚¿Bã¯ï¼Œæ§‹æˆã—ãŸIPãƒ‘ã‚±ãƒƒãƒˆã‚’Ethernetã«ä¹—ã›ã¦ï¼ŒWebã‚µãƒ¼ãƒã«é€ä¿¡ï¼ IPv4ã‚¢ãƒ‰ãƒ¬ã‚¹ã®ç¨®é¡ ãƒ»ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆIPã‚¢ãƒ‰ãƒ¬ã‚¹ LANå†…ã§ä½¿ç”¨ã•ã‚Œã‚‹ï¼ç•°ãªã‚‹ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯é–“ã§ã¯ï¼ŒåŒã˜IPv4ã‚¢ãƒ‰ãƒ¬ã‚¹ãŒå­˜åœ¨ã™ã‚‹ï¼ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆIPã‚¢ãƒ‰ãƒ¬ã‚¹ã¯ï¼Œã€10.0.0.0 ï½ 10.255.255.255ã€ï¼Œã€172.16.0.0 ï½ 172.31.255.255ã€ï¼Œã€192.168.0.0 ï½ 192.168.255.255ã€ã§è¡¨ã•ã‚Œã‚‹ï¼ ãƒ»ã‚°ãƒ­ãƒ¼ãƒãƒ«IPã‚¢ãƒ‰ãƒ¬ã‚¹ ãƒ—ãƒ­ãƒã‚¤ãƒ€ãŒæä¾›ã™ã‚‹IPv4ã‚¢ãƒ‰ãƒ¬ã‚¹ã§ã‚ã‚‹ï¼ãƒ‘ãƒ–ãƒªãƒƒã‚¯ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯å†…ã«åŒã˜IPv4ã‚¢ãƒ‰ãƒ¬ã‚¹ã¯å­˜åœ¨ã›ãšï¼ŒNetwork Information Centerã¸ã®ä½¿ç”¨ç”³è«‹ãŒå¿…è¦ï¼ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆIPã‚¢ãƒ‰ãƒ¬ã‚¹ã®ç•ªå·ã§ãªã‘ã‚Œã°ï¼Œã‚°ãƒ­ãƒ¼ãƒãƒ«IPã‚¢ãƒ‰ãƒ¬ã‚¹ã§ã‚ã‚‹ï¼NATã¯ã‚°ãƒ­ãƒ¼ãƒãƒ«IPã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’æŒã£ã¦ãŠã‚Šï¼Œãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã¨ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯é–“ã®åŒæ–¹å‘ã¸ã®é€šä¿¡æ™‚ã«ï¼Œãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆIPã‚¢ãƒ‰ãƒ¬ã‚¹ã¨ç›¸äº’å¤‰æ›ã™ã‚‹ï¼ ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆï¼ã‚°ãƒ­ãƒ¼ãƒãƒ«IPã‚¢ãƒ‰ãƒ¬ã‚¹ã¨bitã¨ã®é–¢ä¿‚ ä¾‹ãˆã°ï¼Œãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆIPã‚¢ãƒ‰ãƒ¬ã‚¹ã®ï¼”ã¤ã®ã‚ªã‚¯ãƒ†ãƒƒãƒˆï¼ˆç¬¬ä¸€ã‚ªã‚¯ãƒ†ãƒƒãƒˆã‹ã‚‰ç¬¬å››ã‚ªã‚¯ãƒ†ãƒƒãƒˆã¾ã§ï¼‰ãŒï¼‘Byteã®å®¹é‡ã‚’ã‚‚ã¡ï¼ŒIPã‚¢ãƒ‰ãƒ¬ã‚¹å…¨ä½“ã§ï¼”Byteã®å®¹é‡ã‚’æŒã¤ï¼ã¡ãªã¿ã«ï¼Œ172ã‹ã‚‰å§‹ã¾ã‚‹IPã‚¢ãƒ‰ãƒ¬ã‚¹ã¯ï¼Œã‚¯ãƒ©ã‚¹Bã§ã‚ã‚‹ï¼ã€€ ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆï¼ã‚°ãƒ­ãƒ¼ãƒãƒ«IPã‚¢ãƒ‰ãƒ¬ã‚¹ã®ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯éƒ¨ã¨ãƒ›ã‚¹ãƒˆéƒ¨ ãƒ»ã‚¯ãƒ©ã‚¹ã«ã‚ˆã‚‹ãƒ›ã‚¹ãƒˆéƒ¨ã¨ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯éƒ¨ã®å®šç¾© IPã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’ã‚¯ãƒ©ã‚¹ã¨ã—ã¦åˆ†é¡ã—ï¼Œå„ã‚¯ãƒ©ã‚¹ã§IPã‚¢ãƒ‰ãƒ¬ã‚¹ã®ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯éƒ¨ã¨ãƒ›ã‚¹ãƒˆéƒ¨ã‚’å®šç¾©ã™ã‚‹æ–¹æ³•ï¼è¨­å®šã—ãŸIPã‚¢ãƒ‰ãƒ¬ã‚¹ã®å±ã™ã‚‹ã‚¯ãƒ©ã‚¹ã«ã‚ˆã£ã¦ï¼Œä½¿ç”¨ã§ãã‚‹IPã‚¢ãƒ‰ãƒ¬ã‚¹ã®ç¯„å›²ãŒæ±ºã¾ã£ã¦ã—ã¾ã†ï¼ãƒ›ã‚¹ãƒˆéƒ¨ã¨ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯éƒ¨ã®å®šç¾©æ–¹æ³•ãŒ4ç¨®é¡ã—ã‹ãªã„ãŸã‚ï¼ŒIPã‚¢ãƒ‰ãƒ¬ã‚¹ã®ãƒ‘ã‚¿ãƒ¼ãƒ³æ•°ï¼ˆæœ€å¤§ãƒ‘ã‚½ã‚³ãƒ³æ•°ï¼‰ãŒå¤šã™ããŸã‚Šï¼Œå°‘ãªã™ããŸã‚Šã—ã¦ã—ã¾ã†ï¼ ä½¿ç”¨å¯èƒ½ãªIPã‚¢ãƒ‰ãƒ¬ã‚¹ã®ç¯„å›² ã‚¯ãƒ©ã‚¹ ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯éƒ¨ã®ã‚ªã‚¯ãƒ†ãƒƒãƒˆ ãƒ›ã‚¹ãƒˆéƒ¨ã®ã‚ªã‚¯ãƒ†ãƒƒãƒˆ äºŒé€²æ•°ã§è¦‹ãŸæ™‚ï¼ˆnï¼šãƒï¼Œhï¼šãƒ›ï¼‰ IPã‚¢ãƒ‰ãƒ¬ã‚¹ã®ãƒ‘ã‚¿ãƒ¼ãƒ³æ•°ï¼ˆæœ€å¤§ãƒ‘ã‚½ã‚³ãƒ³æ•°ï¼‰ å‚™è€ƒ 0.0.0.0 ã€œ 127.255.255.255 A ç¬¬ä¸€ã®ã¿ ç¬¬äºŒã‹ã‚‰ç¬¬å›› 0nnnnnnn.hhhhhhhh.hhhhhhhh.hhhhhhhh 2^24ï¼ˆ16777216ï¼‰å€‹ 128.0.0.0 ã€œ 191.255.255.255 B ç¬¬ä¸€ã‹ã‚‰ç¬¬äºŒ ç¬¬ä¸‰ã‹ã‚‰ç¬¬å›› 10nnnnnn.nnnnnnnn.hhhhhhhh.hhhhhhhh 2^16ï¼ˆ65536ï¼‰å€‹ ã‚ˆãä½¿ã† 192.0.0.0 ã€œ 223.255.255.255 C ç¬¬ä¸€ã‹ã‚‰ç¬¬ä¸‰ ç¬¬å››ã®ã¿ 110nnnnn.nnnnnnnn.nnnnnnnn.hhhhhhhh 2^8ï¼ˆ256ï¼‰å€‹ 224.0.0.0 ã€œ 239.255.255.255 D - - 1110xxxx.xxxxxxxx.xxxxxxxx.xxxxxxxx - 240.0.0.0 ã€œ 255.255.255.255 E - - 1111xxxx.xxxxxxxx.xxxxxxxx.xxxxxxxx - ãƒ»ã‚µãƒ–ãƒãƒƒãƒˆãƒã‚¹ã‚¯ã‚ˆã‚‹ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯éƒ¨ã¨ãƒ›ã‚¹ãƒˆéƒ¨ã®å®šç¾© ã€1ã€ã‚ã‚‹ã„ã¯ã€0ã€ã§ï¼ŒIPã‚¢ãƒ‰ãƒ¬ã‚¹ã®ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯éƒ¨ã¨ãƒ›ã‚¹ãƒˆéƒ¨ã‚’å®šç¾©ã—ï¼ŒIPã‚¢ãƒ‰ãƒ¬ã‚¹ã®å¾Œã‚ã«è¨˜è¿°ã™ã‚‹æ–¹æ³•ï¼ˆï¼Šä¾‹ï¼Š192.168.42.23/24ï¼‰ï¼è¨­å®šã—ãŸIPã‚¢ãƒ‰ãƒ¬ã‚¹ã«å¯¾ã—ã¦ï¼Œä½¿ç”¨å¯èƒ½ãªIPã‚¢ãƒ‰ãƒ¬ã‚¹ã®ç¯„å›²ã‚’è‡ªç”±ã«å®šç¾©ã§ãã‚‹ï¼ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯éƒ¨ã‚’ã€1ã€ï¼Œãƒ›ã‚¹ãƒˆéƒ¨ã‚’ã€0ã€ã§è¡¨ç¾ã™ã‚‹ï¼ã‚µãƒ–ãƒãƒƒãƒˆãƒã‚¹ã‚¯ã®è¡¨è¨˜æ–¹æ³•ã«ã¯ï¼ŒäºŒé€²æ•°å½¢å¼ï¼ŒIPã‚¢ãƒ‰ãƒ¬ã‚¹å½¢å¼ï¼Œ1ã®å€‹æ•°ã§è¡¨ã™CIDRå½¢å¼ã«ã‚ˆã‚‹è¡¨ç¾æ–¹æ³•ãŒã‚ã‚‹ï¼ äºŒé€²æ•°å½¢å¼ IPã‚¢ãƒ‰ãƒ¬ã‚¹å½¢å¼ CIDRå½¢å¼ IPã‚¢ãƒ‰ãƒ¬ã‚¹ã®ãƒ‘ã‚¿ãƒ¼ãƒ³æ•°ï¼ˆæœ€å¤§PCæ•°ï¼‰ å‚™è€ƒ /10000000.00000000.00000000.00000000 /128.0.0.0 /1 /11000000.00000000.00000000.00000000 /192.0.0.0 /2 ... ... ... /11111111.00000000.00000000.00000000 /255.0.0.0 /8 2^24ï¼ˆ16777216ï¼‰å€‹ ... ... ... /11111111.11111110.00000000.00000000 /255.254.0.0 /15 /11111111.11111111.00000000.00000000 /255.255.0.0 /16 2^16ï¼ˆ65536ï¼‰å€‹ ã‚ˆãä½¿ã†ç¯„å›² ... ... /11111111.11111111.11111110.00000000 /255.255.254.0 /23 /11111111.11111111.11111111.00000000 /255.255.255.0 /24 2^8ï¼ˆ256ï¼‰å€‹ ... ... ... /11111111.11111111.11111111.11111110 /255.255.255.254 /31 /11111111.11111111.11111111.11111111 /255.255.255.255 /32 1å€‹ ã‚ˆãä½¿ã†ç¯„å›² ï¼Šä¾‹ï¼Š ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆIPã‚¢ãƒ‰ãƒ¬ã‚¹ãŒ192.168.0.0ï¼ˆ11000000.10101000.00000000.00000000ï¼‰ã§ï¼Œä½¿ã„ãŸã„IPã‚¢ãƒ‰ãƒ¬ã‚¹ã®ãƒ‘ã‚¿ãƒ¼ãƒ³æ•°ãŒ65536å€‹ï¼Œã¾ãŸã¯16777216å€‹ã®å ´åˆã«ï¼Œã‚µãƒ–ãƒãƒƒãƒˆãƒã‚¹ã‚¯ã®è¡¨è¨˜ï¼Œä½¿ç”¨å¯èƒ½ãªIPã‚¢ãƒ‰ãƒ¬ã‚¹ã®ç¯„å›²ã¯ä»¥ä¸‹ã®ã‚ˆã†ã«ãªã‚‹ï¼ ä½¿ã„ãŸã„IPã‚¢ãƒ‰ãƒ¬ã‚¹ã®ãƒ‘ã‚¿ãƒ¼ãƒ³æ•° äºŒé€²æ•°å½¢å¼ã«ã‚ˆã‚‹è¡¨è¨˜ IPã‚¢ãƒ‰ãƒ¬ã‚¹å½¢å¼ CIDRå½¢å¼ ä½¿ç”¨å¯èƒ½ãªIPã‚¢ãƒ‰ãƒ¬ã‚¹ã®ç¯„å›² 16777216å€‹ 192.168.0.0/11111111.00000000.00000000.00000000 192.168.0.0/255.0.0.0 192.168.0.0/24 â‡’ 192.168.0.1 ã€œ 192.168.0.254 65536å€‹ 192.168.0.0/11111111.11111111.00000000.00000000 192.168.0.0/255.255.0.0 192.168.0.0/16 â‡’ 192.168.0.1 ã€œ 192.168.255.254 1å€‹ 192.168.0.0/11111111.11111111.11111111.11111111 192.168.0.0/255.255.255.255 192.168.0.0/32 â‡’ 192.168.0.0 DNSã‚µãƒ¼ãƒã¨hostsãƒ•ã‚¡ã‚¤ãƒ«ã®å½¹å‰² ãƒ»å®Œå…¨ä¿®é£¾ãƒ‰ãƒ¡ã‚¤ãƒ³åã¨ã‚°ãƒ­ãƒ¼ãƒãƒ«IPã‚¢ãƒ‰ãƒ¬ã‚¹ã®ãƒãƒƒãƒ”ãƒ³ã‚° ä¾‹ãˆã°ï¼Œå¤–éƒ¨Webã‚µãƒ¼ãƒã®ã‚°ãƒ­ãƒ¼ãƒãƒ«IPã‚¢ãƒ‰ãƒ¬ã‚¹ãŒã€203.142.205.139ã€ã§ã‚ã‚‹ã¨çŸ¥ã£ã¦ã„ã‚‹å ´åˆï¼ŒURLã®ãƒ—ãƒ­ãƒˆã‚³ãƒ«éƒ¨åˆ†ä»¥ä¸‹ã‚’ã€203.142.205.139ã€ã¨ã—ã¦ãƒªã‚¯ã‚¨ã‚¹ãƒˆã™ã‚Œã°ï¼Œå¤–éƒ¨Webã‚µãƒ¼ãƒãŒæä¾›ã™ã‚‹ã‚¦ã‚§ãƒ–ã‚µã‚¤ãƒˆã«ã‚¢ã‚¯ã‚»ã‚¹ã§ãã‚‹ï¼ã—ã‹ã—ï¼Œã‚°ãƒ­ãƒ¼ãƒãƒ«IPã‚¢ãƒ‰ãƒ¬ã‚¹ã¯æ•°å­—ã®ç¾…åˆ—ã§ã‚ã‚‹ãŸã‚ï¼Œäººé–“ã«ã¯è¦šãˆã«ãã„ï¼ãã“ã§ï¼Œã‚°ãƒ­ãƒ¼ãƒãƒ«IPã‚¢ãƒ‰ãƒ¬ã‚¹ã®ä»£ã‚ã‚Šã«ï¼Œå®Œå…¨ä¿®é£¾ãƒ‰ãƒ¡ã‚¤ãƒ³åã‚’URLã®ä¸€éƒ¨ã¨ã—ã¦ç”¨ã„ã‚‹ï¼ ãƒ»hostsãƒ•ã‚¡ã‚¤ãƒ« DNSã‚µãƒ¼ãƒã‚ˆã‚Šã‚‚å…ˆã«å‚ç…§ã•ã‚Œã‚‹ãƒãƒƒãƒ”ãƒ³ã‚°ãƒ•ã‚¡ã‚¤ãƒ«ï¼Webã‚µãƒ¼ãƒã®IPã‚¢ãƒ‰ãƒ¬ã‚¹ãŒDNSã‚µãƒ¼ãƒã«ç™»éŒ²ã•ã‚Œã¦ã„ãªã„æ™‚ï¼Œã¾ãŸDNSã‚µãƒ¼ãƒãŒä¸å…·åˆã®æ™‚ã«ï¼ŒDNSã‚µãƒ¼ãƒã®ä»£ã‚ã‚Šã¨ã—ã¦ç”¨ã„ã‚‹ï¼ 05-02. ãƒ«ãƒ¼ã‚¿ NATï¼ˆé™çš„NATï¼‰ï¼šNetwork Address Translationã«ã‚ˆã‚‹IPã‚¢ãƒ‰ãƒ¬ã‚¹v4ã®å¤‰æ› ä¸€ã¤ã®ã‚°ãƒ­ãƒ¼ãƒãƒ«IPã‚¢ãƒ‰ãƒ¬ã‚¹ã«å¯¾ã—ã¦ï¼Œä¸€ã¤ã®ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆIPã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’ç´ä»˜ã‘ã‚‰ã‚Œã‚‹ï¼ã‚°ãƒ­ãƒ¼ãƒãƒ«IPã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’æŒã¡ï¼Œã‚°ãƒ­ãƒ¼ãƒãƒ«ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã¨ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã®åŒæ–¹å‘ã¸ã®é€šä¿¡æ™‚ã«ï¼ŒIPã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’å¤‰æ›ã§ãã‚‹ï¼ ãƒ»ãƒªã‚¯ã‚¨ã‚¹ãƒˆæ™‚ã®ãƒ«ãƒ¼ã‚¿ã«ãŠã‘ã‚‹å¤‰æ› ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‹ã‚‰å‡ºã‚‹æ™‚ã«ï¼Œãƒ‘ã‚±ãƒƒãƒˆã®ãƒ˜ãƒƒãƒ€æƒ…å ±ã«ãŠã‘ã‚‹ã€é€ä¿¡å…ƒã€ã®ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆIPã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’ã‚°ãƒ­ãƒ¼ãƒãƒ«IPã‚¢ãƒ‰ãƒ¬ã‚¹ã«å¤‰æ›ã™ã‚‹ï¼ ï¼Šä¾‹ï¼Š ä¾‹ãˆã°ï¼ŒGoogleã§Webãƒšãƒ¼ã‚¸ã‚’è¦‹ãªãŒã‚‰ï¼ŒGmailã‚¢ãƒ—ãƒªã‚’èµ·å‹•ã—ã¦ã„ã‚‹å ´åˆï¼Œãƒªã‚¯ã‚¨ã‚¹ãƒˆã«ãŠã‘ã‚‹ãƒ‘ã‚±ãƒƒãƒˆæƒ…å ±ã¨ã—ã¦â€¦ é€ä¿¡å…ƒãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆIPã‚¢ãƒ‰ãƒ¬ã‚¹ â‡„ é€ä¿¡å…ƒã‚°ãƒ­ãƒ¼ãƒãƒ«IPã‚¢ãƒ‰ãƒ¬ã‚¹ 192.168.1.1 200.1.1.1 ã€é€ä¿¡å…ƒãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆIPã‚¢ãƒ‰ãƒ¬ã‚¹ã€ã€é€ä¿¡å…ˆã‚°ãƒ­ãƒ¼ãƒãƒ«IPã‚¢ãƒ‰ãƒ¬ã‚¹ã€ã€ãƒ¡ãƒ¼ãƒ«ã‚µãƒ¼ãƒã®å¾…ã¡å—ã‘ãƒãƒ¼ãƒˆç•ªå·110ï¼ˆPOP3ï¼‰ã€ã‚’æŒ‡å®šã—ã¦ï¼Œãƒ¡ãƒ¼ãƒ«ã‚µãƒ¼ãƒã«ãƒªã‚¯ã‚¨ã‚¹ãƒˆï¼ GET http://www.example.co.jp:110/ ã€é€ä¿¡å…ƒãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆIPã‚¢ãƒ‰ãƒ¬ã‚¹ã€ã€é€ä¿¡å…ˆã‚°ãƒ­ãƒ¼ãƒãƒ«IPã‚¢ãƒ‰ãƒ¬ã‚¹ã€ã€Webã‚µãƒ¼ãƒã®å¾…ã¡å—ã‘ãƒãƒ¼ãƒˆç•ªå·80ï¼ˆHTTPï¼‰ã€ã‚’æŒ‡å®šã—ã¦ï¼ŒWebã‚µãƒ¼ãƒã«ãƒªã‚¯ã‚¨ã‚¹ãƒˆï¼ãŸã ã—ï¼80ã¯ï¼Œçœç•¥å¯èƒ½ï¼ GET http://www.example.co.jp:80/ ã€é€ä¿¡å…ƒãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆIPã‚¢ãƒ‰ãƒ¬ã‚¹ã€ã€é€ä¿¡å…ˆã‚°ãƒ­ãƒ¼ãƒãƒ«IPã‚¢ãƒ‰ãƒ¬ã‚¹ã€ã€DNSã‚µãƒ¼ãƒã®å¾…ã¡å—ã‘ãƒãƒ¼ãƒˆç•ªå·53ï¼ˆDNSï¼‰ã€ã‚’æŒ‡å®šã—ã¦ï¼ŒDNSã‚µãƒ¼ãƒã«ãƒªã‚¯ã‚¨ã‚¹ãƒˆ GET http://www.example.co.jp:53/ ã“ã‚Œã‚‰ã®ã€é€ä¿¡å…ƒãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆIPã‚¢ãƒ‰ãƒ¬ã‚¹ã€ãŒï¼ŒNATãƒ«ãƒ¼ã‚¿ã§ï¼Œã‚°ãƒ­ãƒ¼ãƒãƒ«IPã‚¢ãƒ‰ãƒ¬ã‚¹ã«å¤‰æ›ã•ã‚Œã‚‹ï¼ ãƒ»ãƒ¬ã‚¹ãƒãƒ³ã‚¹æ™‚ã®å¤‰æ› ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã«å…¥ã‚‹æ™‚ã«ï¼Œãƒ‘ã‚±ãƒƒãƒˆã®ãƒ˜ãƒƒãƒ€æƒ…å ±ã«ãŠã‘ã‚‹ã€å®›å…ˆã€ã®ã‚°ãƒ­ãƒ¼ãƒãƒ«IPã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆIPã‚¢ãƒ‰ãƒ¬ã‚¹ã«å¤‰æ›ã™ã‚‹ï¼ NAPTï¼ˆå‹•çš„NATï¼‰ï¼šNetwork Address Port Translationã«ã‚ˆã‚‹IPã‚¢ãƒ‰ãƒ¬ã‚¹ã¨ãƒãƒ¼ãƒˆç•ªå·ã®å¤‰æ› ä¸€ã¤ã®ã‚°ãƒ­ãƒ¼ãƒãƒ«IPã‚¢ãƒ‰ãƒ¬ã‚¹ã«å¯¾ã—ã¦ï¼Œè¤‡æ•°ã®ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆIPã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’ç´ä»˜ã‘ã‚‰ã‚Œã‚‹ï¼ã‚°ãƒ­ãƒ¼ãƒãƒ«ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã¨ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã®åŒæ–¹å‘ã¸ã®é€šä¿¡æ™‚ã«ï¼ŒIPã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’å¤‰æ›ã§ãã‚‹ï¼ ãƒ»ãƒªã‚¯ã‚¨ã‚¹ãƒˆæ™‚ã®å¤‰æ› ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‹ã‚‰å‡ºã‚‹æ™‚ã«ï¼Œãƒ‘ã‚±ãƒƒãƒˆã®ãƒ˜ãƒƒãƒ€æƒ…å ±ã«ãŠã‘ã‚‹ã€é€ä¿¡å…ƒã€ã®ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆIPã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’ã‚°ãƒ­ãƒ¼ãƒãƒ«IPã‚¢ãƒ‰ãƒ¬ã‚¹ã«å¤‰æ›ã™ã‚‹ï¼ãŸã ã—ï¼Œç•°ãªã‚‹ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆIPã‚¢ãƒ‰ãƒ¬ã‚¹ãŒåŒã˜ã‚°ãƒ­ãƒ¼ãƒãƒ«IPã«å¤‰æ›ã•ã‚Œã¦ã—ã¾ã†ãŸã‚ï¼Œã“ã‚Œã‚’è­˜åˆ¥ã™ã‚‹ãŸã‚ã«ï¼Œãƒãƒ¼ãƒˆç•ªå·ã‚’è¤‡æ•°ã®ç•°ãªã‚‹ãƒãƒ¼ãƒˆç•ªå·ã«å¤‰æ›ã—ï¼Œã‚°ãƒ­ãƒ¼ãƒãƒ«IPã‚¢ãƒ‰ãƒ¬ã‚¹ã«ä»˜ã‘åŠ ãˆã‚‹ï¼ ï¼Šä¾‹ï¼Š é€ä¿¡å…ƒãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆIPã‚¢ãƒ‰ãƒ¬ã‚¹ å¤‰æ›å‰ãƒãƒ¼ãƒˆç•ªå· â‡„ é€ä¿¡å…ƒã‚°ãƒ­ãƒ¼ãƒãƒ«IPã‚¢ãƒ‰ãƒ¬ã‚¹ å¤‰æ›å¾Œãƒãƒ¼ãƒˆç•ªå· 192.168.2.1 50011 130.X.X.X:50011 50011 192.168.3.1 50011 130.X.X.X:50012 50012 ãƒ»ãƒ¬ã‚¹ãƒãƒ³ã‚¹æ™‚ã®å¤‰æ› ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã«å…¥ã‚‹æ™‚ã«ï¼Œä»˜ã‘åŠ ãˆã‚‰ã‚ŒãŸãƒãƒ¼ãƒˆç•ªå·ã‚’å…ƒã«ï¼Œãƒ‘ã‚±ãƒƒãƒˆã®ãƒ˜ãƒƒãƒ€æƒ…å ±ã«ãŠã‘ã‚‹ã€å®›å…ˆã€ã®ã‚°ãƒ­ãƒ¼ãƒãƒ«IPã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’ï¼Œç•°ãªã‚‹ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆIPã‚¢ãƒ‰ãƒ¬ã‚¹ã«å¤‰æ›ã—åˆ†ã‘ã‚‹ï¼ "},"public/network/network_security_cyber_attacks.html":{"url":"public/network/network_security_cyber_attacks.html","title":"ğŸ“– ï¸ã‚µã‚¤ãƒãƒ¼æ”»æ’ƒ","keywords":"","body":"ã‚µã‚¤ãƒãƒ¼æ”»æ’ƒ ã¯ã˜ã‚ã« æœ¬ã‚µã‚¤ãƒˆã«ã¤ãã¾ã—ã¦ï¼Œä»¥ä¸‹ã‚’ã”èªè­˜ã®ã»ã©å®œã—ããŠé¡˜ã„ã„ãŸã—ã¾ã™ï¼ å‚è€ƒï¼šhttps://hiroki-it.github.io/tech-notebook-gitbook/ 01. ã‚µã‚¤ãƒãƒ¼æ”»æ’ƒã‹ã‚‰ã®é˜²å¾¡æ–¹æ³• é˜²å¾¡æ–¹æ³•ã®ç¨®é¡ ãƒ•ã‚¡ã‚¤ã‚¢ã‚¦ã‚©ãƒ¼ãƒ« ãƒ»Proxyã‚µãƒ¼ãƒã«ã‚ˆã‚‹ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚²ãƒ¼ãƒˆã‚¦ã‚§ã‚¤å‹ãƒ•ã‚¡ã‚¤ã‚¢ã‚¦ã‚©ãƒ¼ãƒ« Proxyã‚µãƒ¼ãƒä¸Šã§ï¼ŒSSLã‚µãƒ¼ãƒè¨¼æ˜æ›¸ã®èªè¨¼ï¼Œã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ç³»ã®ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ã®ç¨¼åƒï¼Œã‚’è¡Œã„ï¼Œãƒ•ã‚¡ã‚¤ã‚¢ã‚¦ã‚©ãƒ¼ãƒ«ã¨ã—ã¦ç”¨ã„ã‚‹ï¼Proxyã‚µãƒ¼ãƒã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ç²¾åº¦ã‚’é‡è¦–ã™ã‚‹å ´åˆã¯ã“ã¡ã‚‰ï¼ ãƒ»ãƒ‘ã‚±ãƒƒãƒˆãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°å‹ãƒ•ã‚¡ã‚¤ã‚¢ã‚¦ã‚©ãƒ¼ãƒ« ãƒ‘ã‚±ãƒƒãƒˆã®ãƒ˜ãƒƒãƒ€æƒ…å ±ã«è¨˜è¼‰ã•ã‚ŒãŸé€ä¿¡å…ƒIPã‚¢ãƒ‰ãƒ¬ã‚¹ã‚„ãƒãƒ¼ãƒˆç•ªå·ãªã©ã«ã‚ˆã£ã¦ï¼Œãƒ‘ã‚±ãƒƒãƒˆã‚’è¨±å¯ã™ã‚‹ã¹ãã‹ã©ã†ã‹ã‚’æ±ºå®šã™ã‚‹ï¼é€Ÿåº¦ã‚’é‡è¦–ã™ã‚‹å ´åˆã¯ã“ã¡ã‚‰ï¼ãƒ•ã‚¡ã‚¤ã‚¢ã‚¦ã‚©ãƒ¼ãƒ«ã¨Webã‚µãƒ¼ãƒã®é–“ã«ã¯ï¼ŒNATãƒ«ãƒ¼ã‚¿ã‚„NAPTãƒ«ãƒ¼ã‚¿ãŒè¨­ç½®ã•ã‚Œã¦ã„ã‚‹ï¼ã“ã‚Œã‚‰ã«ã‚ˆã‚‹é€ä¿¡å…ƒãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆIPã‚¢ãƒ‰ãƒ¬ã‚¹ã‹ã‚‰é€ä¿¡å…ƒã‚°ãƒ­ãƒ¼ãƒãƒ«IPã‚¢ãƒ‰ãƒ¬ã‚¹ã¸ã®å¤‰æ›ã«ã¤ã„ã¦ã‚‚å‚ç…§ã›ã‚ˆï¼ ï¼Šä¾‹ï¼Š Win10ã«ãŠã‘ã‚‹è¨­å®šç”»é¢ Detection Systemã¨ã¯ ãƒ»Detection Systemã¨ã¯ ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ä¸Šã‚’æµã‚Œã‚‹ãƒˆãƒ©ãƒ•ã‚£ãƒƒã‚¯ã‚’ç›£è¦–ã—ï¼Œä¸æ­£ã‚¢ã‚¯ã‚»ã‚¹ã¨æ€ã‚ã‚Œã‚‹ãƒ‘ã‚±ãƒƒãƒˆã‚’æ¤œå‡ºã—ãŸæ™‚ã«ï¼Œç®¡ç†è€…ã«é€šçŸ¥ã™ã‚‹ã‚·ã‚¹ãƒ†ãƒ ï¼ã‚ãã¾ã§é€šçŸ¥ã™ã‚‹ã ã‘ã§ï¼Œæ”»æ’ƒã‚’é˜²å¾¡ã™ã‚‹ã“ã¨ã¯ã—ãªã„ï¼ IPSï¼šIntrusion Prevention Systemã¨ã¯ ãƒ»IPSã¨ã¯ ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ä¸Šã‚’æµã‚Œã‚‹ãƒˆãƒ©ãƒ•ã‚£ãƒƒã‚¯ã‚’ç›£è¦–ã—ï¼Œä¸æ­£ã‚¢ã‚¯ã‚»ã‚¹ã¨æ€ã‚ã‚Œã‚‹ãƒ‘ã‚±ãƒƒãƒˆã‚’æ¤œå‡ºã—ãŸæ™‚ã«ï¼Œç®¡ç†è€…ã«é€šçŸ¥ã—ï¼Œã•ã‚‰ã«ãƒ‘ã‚±ãƒƒãƒˆã®ä¾µå…¥ã‚’é˜²ãã‚·ã‚¹ãƒ†ãƒ ï¼ WAFï¼šWeb Application Firewallã¨ã¯ ãƒ»WAFã¨ã¯ Webã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³è‡ªä½“ã‚’ä¿è­·ã™ã‚‹ã‚·ã‚¹ãƒ†ãƒ ï¼ 02. Malware ã®ç¨®é¡ã¨ç‰¹å¾´ Malware ã®èªæº ã€maliciousï¼ˆæ‚ªæ„ã®ã‚ã‚‹ï¼‰ï¼‹softwareï¼ˆã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ï¼‰ã€ Macroã‚¦ã‚¤ãƒ«ã‚¹ ãƒ»Macroã‚¦ã‚¤ãƒ«ã‚¹ã¨ã¯ Wordãªã©ã®ãƒ¯ãƒ¼ãƒ—ãƒ­ã‚¢ãƒ—ãƒªã‚„ï¼ŒExcelãªã©ã®è¡¨è¨ˆç®—ã‚¢ãƒ—ãƒªã«æ„ŸæŸ“ Worm ãƒ»Wormã¨ã¯ è‡ªå·±è¤‡è£½ã—ï¼Œ1ã¤ã®ã‚³ãƒ³ãƒ”ãƒ¥ãƒ¼ã‚¿ã‹ã‚‰ï¼Œ4ã¤ã®çµŒè·¯ï¼ˆãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ï¼Œãƒ¡ãƒ¼ãƒ«ï¼Œå…±æœ‰ãƒ•ã‚©ãƒ«ãƒ€ï¼ŒUSBï¼‰ã‚’è¾¿ã£ã¦ï¼Œä»–ã®ã‚³ãƒ³ãƒ”ãƒ¥ãƒ¼ã‚¿ã«æ„ŸæŸ“ã‚’åºƒã’ã¦ã„ãï¼ãƒ‘ã‚½ã‚³ãƒ³ãŒã‚°ãƒ­ãƒ¼ãƒãƒ«IPã§ç›´æ¥ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆã«æ¥ç¶šã—ã¦ã„ã‚‹ã¨æ„ŸæŸ“ã—ã‚„ã™ã„ï¼ãƒ¯ãƒ¼ãƒ ã‚’é˜²ããŸã‚ã«ã¯ï¼Œãƒ‘ã‚½ã‚³ãƒ³ã«ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆIPã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’è¨­å®šã—ï¼ŒNATã‚„NAPTãªã©ã‚’ä»‹ã—ã¦ï¼Œã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆã«æ¥ç¶šã•ã›ã‚‹å¿…è¦ãŒã‚ã‚‹ï¼ ï¼Šä¾‹ï¼Š å…±æœ‰ãƒ•ã‚©ãƒ«ãƒ€çµŒç”±ã§ã®æ„ŸæŸ“æ‹¡å¤§ ãƒˆãƒ­ã‚¤ã®æœ¨é¦¬ ãƒ»ãƒˆãƒ­ã‚¤ã®æœ¨é¦¬ã¨ã¯ ï¼Šä¾‹ï¼Š Google play ã§ï¼Œéå»ã«ã‚¢ãƒ—ãƒªã¨ã—ã¦å¿ã³è¾¼ã‚“ã§ã„ãŸãƒˆãƒ­ã‚¤ã®æœ¨é¦¬ æ„ŸæŸ“æ–¹æ³•ãŒã‚®ãƒªã‚·ãƒ£ç¥è©±ä¸Šã®ãƒˆãƒ­ã‚¤ã®æœ¨é¦¬ã«ä¼¼ã¦ã„ã‚‹ã“ã¨ã«ç”±æ¥ã™ã‚‹ï¼æœ‰ç”¨ãªãƒ—ãƒ­ã‚°ãƒ©ãƒ ã§ã‚ã‚‹ã‚ˆã†ã«è¦‹ã›ã‹ã‘ã¦ï¼Œãƒ‘ã‚½ã‚³ãƒ³åˆ©ç”¨è€…ã«å®Ÿè¡Œã•ã›ã‚‹ã“ã¨ã§æ„ŸæŸ“ï¼è£ã§ä¸æ­£ãªå‡¦ç†ã‚’è¡Œã†ï¼ â€»ãƒˆãƒ­ã‚¤ã®æœ¨é¦¬ã¯ã‚®ãƒªã‚·ãƒ£ç¥è©±ã«ç™»å ´ã™ã‚‹ï¼ã‚®ãƒªã‚·ãƒ£è»ã¯é›£æ”»ä¸è½ã®ãƒˆãƒ­ã‚¤åŸã‚’é™¥è½ã•ã›ã‚‹ãŸã‚ï¼Œä¸­ã«ç²¾é‹­éƒ¨éšŠã‚’å¿ã³è¾¼ã¾ã›ãŸæœ¨é¦¬ã‚’ãƒˆãƒ­ã‚¤åŸã®è¿‘ãã«ç½®ã„ã¦å¸°ã£ãŸï¼æˆ¦åˆ©å“ã ã¨å‹˜é•ã„ã—ãŸãƒˆãƒ­ã‚¤è»ã¯ï¼ŒåŸå†…ã«æœ¨é¦¬ã‚’æŒã¡å¸°ã£ãŸï¼å¤œä¸­ï¼Œæœ¨é¦¬ã®ä¸­ã«éš ã‚ŒãŸç²¾é‹­éƒ¨éšŠãŒè‡ªè»ã®å…µå£«ã‚’ãƒˆãƒ­ã‚¤åŸã«å¼•ãå…¥ã‚Œï¼ŒåŸã‚’åˆ¶åœ§ã—ãŸï¼ Spyware ãƒ»Spywareã¨ã¯ ãƒ‘ã‚½ã‚³ãƒ³åˆ©ç”¨è€…ã®å€‹äººæƒ…å ±ã‚’åé›†ã—ï¼Œå¤–éƒ¨ã«é€ä¿¡ã™ã‚‹ï¼ Bot ãƒ»Botã¨ã¯ ã‚ã‚‰ã‹ã˜ã‚BotåŒ–ã•ã›ã¦ãŠã„ãŸãƒ‘ã‚½ã‚³ãƒ³ã‚’è¸ã¿å°ã¨ã—ã¦ï¼Œæ”»æ’ƒè€…ã®å‘½ä»¤é€šã‚Šã«å‹•ã‹ã™ï¼ ãƒ»ãƒ‘ã‚½ã‚³ãƒ³ãŒãƒœãƒƒãƒˆåŒ–ã™ã‚‹ã¾ã§ã®ãƒ—ãƒ­ã‚»ã‚¹ ãƒ»ã‚¹ãƒãƒ›ãŒãƒœãƒƒãƒˆåŒ–ã™ã‚‹ã¾ã§ã®ãƒ—ãƒ­ã‚»ã‚¹ ãƒ»Bot ã®ä½¿ã‚ã‚Œæ–¹ ã¾ãšï¼Œæ”»æ’ƒå¯¾è±¡ã®ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯å†…ã«ã‚ã‚‹ãƒ‘ã‚½ã‚³ãƒ³ã‚’BotåŒ–ã•ã›ã‚‹ï¼æ”»æ’ƒè€…ã¯ï¼ŒBotåŒ–ã—ãŸãƒ‘ã‚½ã‚³ãƒ³ã‚’è¸ã¿å°ã¨ã—ã¦ã‚µãƒ¼ãƒãƒ¼ã‚’æ”»æ’ƒã•ã›ã‚‹ã‚ˆã†ã«ï¼ŒC&Cã‚µãƒ¼ãƒãƒ¼ã«å‘½ä»¤ã‚’å‡ºã™ï¼ 03. ã‚µã‚¤ãƒãƒ¼æ”»æ’ƒï¼ãã®å¯¾ç­– CSRFï¼šCross-Site Request Forgeries ãƒ»CSRFã¨ã¯ ãƒ¦ãƒ¼ã‚¶ãŒã¨ã‚ã‚‹ãƒ•ã‚©ãƒ¼ãƒ ã‹ã‚‰ãƒ­ã‚°ã‚¤ãƒ³å¾Œï¼Œã‚»ãƒƒã‚·ãƒ§ãƒ³IDã‚’ä¿æŒã—ãŸã¾ã¾æ‚ªæ„ã®ã‚ã‚‹ã‚µã‚¤ãƒˆã«ã‚¢ã‚¯ã‚»ã‚¹ã—ãŸã¨ã™ã‚‹ï¼æ‚ªæ„ã®ã‚ã‚‹ã‚µã‚¤ãƒˆã®ã‚µãƒ¼ãƒã¯ï¼Œãƒ¦ãƒ¼ã‚¶ã®ã‚»ãƒƒã‚·ãƒ§ãƒ³IDã‚’ä½¿ç”¨ã—ã¦ï¼Œå…ƒã€…ãƒ­ã‚°ã‚¤ãƒ³ã—ã¦ã„ãŸã‚µã‚¤ãƒˆã®ã‚µãƒ¼ãƒã‚’æ”»æ’ƒã™ã‚‹ï¼ã‚µãƒ¼ãƒã¯ï¼Œæ­£ã—ã„ãƒ•ã‚©ãƒ¼ãƒ ã‹ã‚‰ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆã¨èª¤èªã—ã¦ã—ã¾ã„ï¼Œæ”»æ’ƒã‚’è¨±å®¹ã—ã¦ã—ã¾ã†ï¼ å‚è€ƒï¼šhttps://www.ipa.go.jp/security/vuln/websecurity-HTML-1_6.html ãƒ»ã€å¯¾ç­–ã€‘ãƒ¯ãƒ³ã‚¿ã‚¤ãƒ ãƒˆãƒ¼ã‚¯ãƒ³ èªè¨¼æ™‚ã«ï¼Œã‚»ãƒƒã‚·ãƒ§ãƒ³IDã ã‘ã§ãªãï¼Œãƒ¯ãƒ³ã‚¿ã‚¤ãƒ ãƒˆãƒ¼ã‚¯ãƒ³ã‚‚ä½µç”¨ã™ã‚‹ï¼èªè¨¼ãƒ•ã‚©ãƒ¼ãƒ ãŒãƒªã‚¯ã‚¨ã‚¹ãƒˆã•ã‚ŒãŸæ™‚ï¼Œã‚µãƒ¼ãƒå´ã§ã¯ï¼Œãƒ¯ãƒ³ã‚¿ã‚¤ãƒ ãƒˆãƒ¼ã‚¯ãƒ³ã‚’ç™ºè¡Œã—ï¼Œã“ã‚Œã‚’Set-Cookieãƒ˜ãƒƒãƒ€ãƒ¼ã®csrftokenãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ï¼ˆãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã«ã‚ˆã£ã¦ã¯ï¼Œã“ã‚Œã«ç›¸å½“ã™ã‚‹ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ï¼‰ã‚„ç‹¬è‡ªãƒ˜ãƒƒãƒ€ãƒ¼ã«å‰²ã‚Šå½“ã¦ã¦ï¼Œãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’è¿”ä¿¡ã™ã‚‹ï¼ 200 OK Set-Cookie: csrftoken= # ç‹¬è‡ªãƒ˜ãƒƒãƒ€ãƒ¼ X-CSRF-TOKEN: ãƒ–ãƒ©ã‚¦ã‚¶ã§ã¯ãƒ¬ã‚¹ãƒãƒ³ã‚¹ãƒ˜ãƒƒãƒ€ãƒ¼ã‹ã‚‰ãƒ¯ãƒ³ã‚¿ã‚¤ãƒ ãƒˆãƒ¼ã‚¯ãƒ³ã‚’å–ã‚Šå‡ºã—ï¼Œèªè¨¼ãƒ•ã‚©ãƒ¼ãƒ ã®inputã‚¿ã‚°ã®hiddenå±æ€§ã«å‰²ã‚Šå½“ã¦ã‚‹ï¼ä»–ã«ï¼Œmetaã‚¿ã‚°ã«ãƒˆãƒ¼ã‚¯ãƒ³ã‚’å‰²ã‚Šå½“ã¦ã‚‹ã“ã¨ã‚‚ã‚ã‚‹ï¼ \"> \"> èªè¨¼ã®ãŸã‚ã®POSTãƒªã‚¯ã‚¨ã‚¹ãƒˆæ™‚ã«ï¼Œãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒœãƒ‡ã‚£ã‚„ç‹¬è‡ªãƒ˜ãƒƒãƒ€ãƒ¼ã«ãƒˆãƒ¼ã‚¯ãƒ³ã‚’å‰²ã‚Šå½“ã¦ï¼Œãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é€ä¿¡ã™ã‚‹ï¼ã©ã¡ã‚‰ã‚’ä½¿ç”¨ã™ã‚‹ã‹ã¯ï¼Œãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰å´ã®ä»•æ§˜ã«ã‚ˆã£ã¦ç•°ãªã‚‹ï¼ POST https://example.co.jp/bar-form.php HTTP/2 # ç‹¬è‡ªãƒ˜ãƒƒãƒ€ãƒ¼ x-csrf-token: { _token= } ã‚µãƒ¼ãƒå´ã§ã¯ï¼ŒPOSTãƒªã‚¯ã‚¨ã‚¹ãƒˆã«ã‚ˆã£ã¦é€ä¿¡ã•ã‚ŒãŸãƒˆãƒ¼ã‚¯ãƒ³ã¨ãƒ¯ãƒ³ã‚¿ã‚¤ãƒ ãƒˆãƒ¼ã‚¯ãƒ³ã‚’æ¯”è¼ƒã—ï¼Œèªè¨¼ã‚’å®Ÿè¡Œã™ã‚‹ï¼ä»¥é™ï¼ŒPOSTãƒªã‚¯ã‚¨ã‚¹ãƒˆã®å ´åˆã¯ãã®ãƒ¯ãƒ³ã‚¿ã‚¤ãƒ ãƒˆãƒ¼ã‚¯ãƒ³ã‚’ä½¿ã„å›ã—ï¼ŒGETãƒªã‚¯ã‚¨ã‚¹ãƒˆã®å ´åˆã¯ä½¿ç”¨ã—ãªã„ï¼ãƒˆãƒ¼ã‚¯ãƒ³ãŒå¤‰æ›´ã•ã‚Œã¦ã„ã‚Œã°ï¼Œèª¤ã£ãŸå…¥åŠ›ãƒ•ã‚©ãƒ¼ãƒ ã‹ã‚‰ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆã¨ã—ã¦åˆ¤å®šã—ï¼Œ401ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚’è¿”å´ã™ã‚‹ï¼ å‚è€ƒï¼š https://terasolunaorg.github.io/guideline/5.2.0.RELEASE/ja/Security/CSRF.html#spring-securitycsrf https://qiita.com/Nsystem/questions/1bd6d30748957e1b6700 https://qiita.com/mpyw/items/0595f07736cfa5b1f50c#%E3%83%88%E3%83%BC%E3%82%AF%E3%83%B3%E3%81%AE%E7%94%9F%E6%88%90%E6%96%B9%E6%B3%95 ãƒ»ã€å¯¾ç­–ã€‘CORS XSSã®èª¬æ˜ã‚’å‚è€ƒã«ã›ã‚ˆ ã‚»ãƒƒã‚·ãƒ§ãƒ³IDå›ºå®šåŒ– ãƒ»ã‚»ãƒƒã‚·ãƒ§ãƒ³IDå›ºå®šåŒ–ã¨ã¯ å‚è€ƒï¼šhttps://www.ipa.go.jp/security/vuln/websecurity-HTML-1_4.html Directory traversal ãƒ»Directory traversalã¨ã¯ traversalã¯ï¼Œæ¨ªæ–­ã™ã‚‹ï¼ˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã®æ§‹é€ ã‚’ä¹—ã‚Šè¶Šãˆã‚‹ï¼‰ã®æ„å‘³ï¼ãƒ‘ã‚¹åã‚’ä½¿ã£ã¦ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æŒ‡å®šã—ï¼Œç®¡ç†è€…ã®æ„å›³ã—ã¦ã„ãªã„ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä¸æ­£ã«é–²è¦§ã¾ãŸã¯ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã™ã‚‹ï¼ DoSæ”»æ’ƒï¼šDenial of Service ãƒ»DoSæ”»æ’ƒï¼ŒDDosæ”»æ’ƒã¨ã¯ ã‚¢ã‚¯ã‚»ã‚¹ãŒé›†ä¸­ã™ã‚‹ã“ã¨ã§Webã‚µãƒ¼ãƒãƒ¼ãŒãƒ‘ãƒ³ã‚¯ã™ã‚‹ã“ã¨ã‚’åˆ©ç”¨ã—ï¼Œæ‚ªæ„ã‚’æŒã£ã¦Webã‚µãƒ¼ãƒãƒ¼ã«å¤§é‡ã®ãƒ‡ãƒ¼ã‚¿ã‚’é€ã‚Šã¤ã‘ã‚‹æ‰‹æ³•ï¼ãƒªã‚¯ã‚¨ã‚¹ãƒˆã®é€ä¿¡å…ƒãŒä¸€ã¤ã®å ´åˆã¯Dosæ”»æ’ƒï¼Œè¤‡æ•°ã®å ´åˆã¯DDosæ”»æ’ƒã¨ã„ã†ï¼ ãƒ»ã€å¯¾ç­–ã€‘POSTãƒªã‚¯ã‚¨ã‚¹ãƒˆã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆæ•°åˆ¶é™ php.iniãƒ•ã‚¡ã‚¤ãƒ«ã«ã¦ï¼Œä¸€åº¦ã«å—ä¿¡ã§ãã‚‹POSTãƒªã‚¯ã‚¨ã‚¹ãƒˆã®ä¸Šé™å€¤ã‚’è¨­å®šã§ãã‚‹ï¼ max_input_vars = 1000 ãƒ»ã€å¯¾ç­–ã€‘åŒä¸€é€ä¿¡å…ƒã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆåˆ¶é™ åŒã˜é€ä¿¡å…ƒã‹ã‚‰ã®ä¸€åˆ†é–“ã‚ãŸã‚Šã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆæ•°ã‚’åˆ¶é™ã™ã‚‹ï¼ä¾‹ãˆã°ï¼ŒWAFï¼ŒAPI Gatewayã®æ©Ÿèƒ½ã‚’ä½¿ç”¨ã™ã‚‹ï¼ å‚è€ƒï¼šhttps://hiroki-it.github.io/tech-notebook-gitbook/public/cloud_computing/cloud_computing_aws.html SQL Injection ãƒ»SQL Injectionã¨ã¯ ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®SQLã‚¯ã‚¨ãƒªã®ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã¨ãªã‚‹å…¥åŠ›ã«ï¼Œä¸æ­£ãªæ–‡å­—åˆ—ã‚’å…¥åŠ›ã—ã¦ä¸æ­£ãªSQLã‚¯ã‚¨ãƒªã‚’å®Ÿè¡Œã•ã›ï¼Œãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®æƒ…å ±ã‚’æŠœãå–ã‚‹æ‰‹æ³•ï¼ãŸã ã—ï¼Œè¿‘å¹´ã¯æ¸›å°‘å‚¾å‘ã«ã‚ã‚‹ï¼ ãƒ»ã€å¯¾ç­–ã€‘ç‰¹æ®Šãªæ–‡å­—ã®ç„¡åŠ¹åŒ– ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®SQLã‚¯ã‚¨ãƒªã®ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã¨ãªã‚‹å…¥åŠ›ã§ã¯ï¼Œã€ã‚·ãƒ³ã‚°ãƒ«ã‚¯ã‚ªãƒ¼ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ã€ã‚„ã€ãƒãƒƒã‚¯ã‚¹ãƒ©ãƒƒã‚·ãƒ¥ã€ãªã©ã¯SQLã§ç‰¹åˆ¥ãªæ„å‘³ã‚’æŒã¤ï¼ãã®ãŸã‚ï¼Œã“ã‚Œã‚‰ã®ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãŒå‰²ã‚Šå½“ã¦ã‚‰ã‚Œã¦ã„ã‚‹ãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’æ‹’å¦ã™ã‚‹ï¼ä¾‹ãˆã°ï¼ŒWAFã®æ©Ÿèƒ½ã‚’ä½¿ç”¨ã™ã‚‹ï¼ å‚è€ƒï¼šhttps://docs.aws.amazon.com/ja_jp/waf/latest/developerguide/aws-managed-rule-groups-list.html ãƒ»ã€å¯¾ç­–ã€‘ãƒ—ãƒ¬ãƒ¼ã‚¹ãƒ›ãƒ«ãƒ€ãƒ¼ ãƒ—ãƒªãƒšã‚¢ãƒ¼ãƒ‰ã‚¹ãƒ†ãƒ¼ãƒˆãƒ¡ãƒ³ãƒˆã®SQLä¸­ã«ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’è¨­å®šã—ï¼Œå€¤ã‚’ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã«æ¸¡ã—ãŸä¸Šã§ï¼ŒSQLã¨ã—ã¦ç™ºè¡Œã™ã‚‹æ–¹æ³•ï¼å‡¦ç†é€Ÿåº¦ãŒé€Ÿã„ï¼ã¾ãŸï¼Œãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã«èª¤ã£ã¦SQLãŒæ¸¡ã•ã‚Œã¦ã‚‚ï¼Œã“ã‚Œã‚’å®Ÿè¡Œã§ããªããªã‚‹ãŸã‚ï¼ŒSQLã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³ã®å¯¾ç­–ã«ãªã‚‹ï¼ãƒ—ãƒ¬ãƒ¼ã‚¹ãƒ›ãƒ«ãƒ€ãƒ¼ã«ã¤ã„ã¦ã¯ï¼Œä»¥ä¸‹ã®ãƒªãƒ³ã‚¯ã‚’å‚è€ƒã«ã›ã‚ˆï¼ å‚è€ƒï¼šhttps://hiroki-it.github.io/tech-notebook-gitbook/public/software/software_application_backend_php_package_mysql.html XSSï¼šCross Site Scripting ãƒ»XSSã¨ã¯ Webã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã«ã‚ˆã‚‹HTMLå‡ºåŠ›ã®ã‚¨ã‚¹ã‚±ãƒ¼ãƒ—å‡¦ç†ã®æ¬ é™¥ã‚’æ‚ªç”¨ã—ï¼Œåˆ©ç”¨è€…ã®Webãƒ–ãƒ©ã‚¦ã‚¶ã§æ‚ªæ„ã®ã‚ã‚‹ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’å®Ÿè¡Œã•ã›ã‚‹ ï¼ ãƒ»ã€å¯¾ç­–ã€‘CORSï¼šCross-Origin Resource Sharingï¼ˆã‚ªãƒªã‚¸ãƒ³é–“ãƒªã‚½ãƒ¼ã‚¹å…±æœ‰ï¼‰ ç•°ãªã‚‹ãƒ‰ãƒ¡ã‚¤ãƒ³ã§è¡¨ç¤ºã•ã‚Œã‚‹ãƒšãƒ¼ã‚¸ã‹ã‚‰ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’è¨±å¯ã™ã‚‹ä»•çµ„ã¿ã®ã“ã¨ï¼æ¨™æº–ã§ã¯ï¼Œç•°ãªã‚‹ãƒ‰ãƒ¡ã‚¤ãƒ³ã§è¡¨ç¤ºã•ã‚Œã‚‹ãƒšãƒ¼ã‚¸ã‹ã‚‰ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆã¯æ‹’å¦ã•ã‚Œã‚‹ã‚ˆã†ã«ãªã£ã¦ã„ã‚‹ï¼ç•°ãªã‚‹ãƒ‰ãƒ¡ã‚¤ãƒ³ã§è¡¨ç¤ºã•ã‚Œã‚‹ãƒšãƒ¼ã‚¸ã‹ã‚‰ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’è¨±å¯ã—ãŸã„å ´åˆã¯ï¼Œãƒšãƒ¼ã‚¸ã‹ã‚‰ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã¨ã‚µãƒ¼ãƒã‹ã‚‰ã®ãƒ¬ã‚¹ãƒãƒ³ã‚¹ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®ä¸¡æ–¹ã§å¯¾å¿œãŒå¿…è¦ã§ã‚ã‚‹ï¼ å‚è€ƒï¼šhttps://developer.mozilla.org/ja/docs/Glossary/Origin ï¼Šå®Ÿè£…ä¾‹ï¼Š ã¾ãšï¼Œãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®Originãƒ˜ãƒƒãƒ€ãƒ¼ã«é€ä¿¡å…ƒã‚ªãƒªã‚¸ãƒ³ã‚’è¨­å®šã™ã‚‹ï¼åŠ ãˆã¦ï¼ŒCookieãƒ˜ãƒƒãƒ€ãƒ¼ã‚’æŒã¤ãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’é€ä¿¡ã—ãŸã„å ´åˆã¯ï¼ŒJavaScriptã®å®Ÿè£…ã§withCredentialsã«trueã‚’å‰²ã‚Šå½“ã¦ã‚‹ï¼JavaScriptã®ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã«ã‚ˆã£ã¦ã‚ªãƒ—ã‚·ãƒ§ãƒ³åãŒç•°ãªã‚‹ãŸã‚æ³¨æ„ã™ã‚‹ï¼ å‚è€ƒï¼šhttps://qiita.com/tomoyukilabs/items/81698edd5812ff6acb34#%E3%82%B7%E3%83%B3%E3%83%97%E3%83%AB%E3%81%AB%E3%83%87%E3%83%BC%E3%82%BF%E3%81%AE%E8%AA%AD%E3%81%BF%E8%BE%BC%E3%81%BF%E3%82%92%E8%A8%B1%E5%8F%AF%E3%81%97%E3%81%9F%E3%81%84%E5%A0%B4%E5%90%88 GET https://foo.com/bar HTTP/2 # é€ä¿¡å…ƒã‚ªãƒªã‚¸ãƒ³ Origin: https://example.com import axios from 'axios' const client = axios.create({ baseURL: \"https://foo.co.jp\", withCredentials: true, // ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã®æœ‰åŠ¹åŒ– }) return new Promise((resolve, reject) => { client.get('/bar') .then((data) => { resolve(data) }) .catch((err) => { reject(err) }) }) æ¬¡ã«ï¼Œãƒ¬ã‚¹ãƒãƒ³ã‚¹ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®Access-Control-Allow-Originãƒ˜ãƒƒãƒ€ãƒ¼ã«ï¼Œè¨±å¯ã•ã‚ŒãŸé€ä¿¡å…ƒã‚ªãƒªã‚¸ãƒ³ã‚’å‰²ã‚Šå½“ã¦ã¦è¿”ä¿¡ã™ã‚‹ï¼Cookieãƒ˜ãƒƒãƒ€ãƒ¼ã‚’æŒã¤ãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¨±å¯ã™ã‚‹å ´åˆï¼ŒåŒã˜ããƒ¬ã‚¹ãƒãƒ³ã‚¹ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®Access-Control-Allow-Credentialsãƒ˜ãƒƒãƒ€ãƒ¼ã«trueã‚’å‰²ã‚Šå½“ã¦ã‚‹ï¼ãã®ä»–ï¼Œè¨±å¯ã™ã‚‹HTTPãƒ¡ã‚½ãƒƒãƒ‰ã‚„HTTPãƒ˜ãƒƒãƒ€ãƒ¼ã‚’å®šç¾©ã§ãã‚‹ï¼ä¾‹ãˆã°ï¼Œè¨±å¯ã•ã‚Œã¦ã„ãªã„HTTPãƒ¡ã‚½ãƒƒãƒ‰ã‚’ä½¿ç”¨ã—ã¦ï¼Œç•°ãªã‚‹ã‚ªãƒªã‚¸ãƒ³ã«ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é€ä¿¡ã™ã‚‹ã¨ï¼Œ405ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã§ã‚¨ãƒ©ãƒ¼ãƒ¬ã‚¹ãƒãƒ³ã‚¹ãŒè¿”ä¿¡ã•ã‚Œã‚‹ï¼ å‚è€ƒï¼š https://developer.mozilla.org/ja/docs/Web/HTTP/Headers/Access-Control-Allow-Credentials https://stackoverflow.com/questions/24687313/what-exactly-does-the-access-control-allow-credentials-header-do 200 OK # è¨±å¯ã•ã‚ŒãŸé€ä¿¡å…ƒã‚ªãƒªã‚¸ãƒ³ Access-Control-Allow-Origin: https://example.co.jp # ãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒCookieãƒ˜ãƒƒãƒ€ãƒ¼ã‚’æŒã¤ã“ã¨ã‚’è¨±å¯ã™ã‚‹å ´åˆ Access-Control-Allow-Credentials: true # è¨±å¯ã™ã‚‹HTTPãƒ¡ã‚½ãƒƒãƒ‰ Access-Control-Allow-Methods: GET,POST,HEAD,OPTIONS # ãã®ä»–ï¼Œè¨±å¯ã™ã‚‹HTTPãƒ˜ãƒƒãƒ€ãƒ¼ Access-Control-Allow-Headers: Content-Type ã¡ãªã¿ã«ï¼ŒCookieãƒ˜ãƒƒãƒ€ãƒ¼ã‚’æŒã¤ãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¨±å¯ã—ãªã„å ´åˆã«é™ã‚Šï¼Œå…¨ã¦ã®ã‚ªãƒªã‚¸ãƒ³ã‚„ãƒ˜ãƒƒãƒ€ãƒ¼ã‚’è¨±å¯ã§ãã‚‹ï¼ 200 OK # å…¨ã¦ã®ã‚ªãƒªã‚¸ãƒ³ã‚’è¨±å¯ Access-Control-Allow-Origin: * Access-Control-Allow-Headers: * ãƒ»ã€å¯¾ç­–ã€‘Set-Cookieãƒ˜ãƒƒãƒ€ãƒ¼ã®Domainå±æ€§ ãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒCookieãƒ˜ãƒƒãƒ€ãƒ¼ã‚’æŒã¤ã“ã¨ã‚’è¨±å¯ã—ãŸå ´åˆã«ï¼Œã‚µãƒ–ãƒ‰ãƒ¡ã‚¤ãƒ³ã®ã‚ªãƒªã‚¸ãƒ³ã«ã‚‚Cookieãƒ˜ãƒƒãƒ€ãƒ¼ã®é€ä¿¡ã‚’è¨±å¯ã™ã‚‹ã‹ã©ã†ã‹ã‚’åˆ¶å¾¡ã§ãã‚‹ï¼ã‚µãƒ–ãƒ‰ãƒ¡ã‚¤ãƒ³ãƒ¬ã‚¹ãƒãƒ³ã‚¹ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®Set-Cookieãƒ˜ãƒƒãƒ€ãƒ¼ã«ã¦ï¼ŒDomainå±æ€§ã«ãƒ‰ãƒ¡ã‚¤ãƒ³ãŒå‰²ã‚Šå½“ã¦ãªã‹ã£ãŸå ´åˆã¯ï¼Œãƒšãƒ¼ã‚¸ã‚’è¡¨ç¤ºã™ã‚‹ã‚µãƒ¼ãƒã®ãƒ‰ãƒ¡ã‚¤ãƒ³ã«ã®ã¿Cookieãƒ˜ãƒƒãƒ€ãƒ¼ã‚’æŒã¤ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’è¨±å¯ã§ãï¼Œã‚µãƒ–ãƒ‰ãƒ¡ã‚¤ãƒ³ã¸ã®é€ä¿¡ã‚’æ‹’å¦ã§ãã‚‹ï¼ä¸€æ–¹ã§ï¼Œãƒ‰ãƒ¡ã‚¤ãƒ³ãŒå‰²ã‚Šå½“ã¦ãŸå ´åˆã¯ï¼Œãã®ãƒšãƒ¼ã‚¸ã‹ã‚‰ã‚µãƒ–ãƒ‰ãƒ¡ã‚¤ãƒ³ã«å¯¾ã—ã¦ã‚‚ï¼ŒCookieãƒ˜ãƒƒãƒ€ãƒ¼ã‚’æŒã¤ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’è¨±å¯ã§ãã‚‹ï¼ãƒ‰ãƒ¡ã‚¤ãƒ³ã§ã¯ãªãï¼Œã‚ªãƒªã‚¸ãƒ³ã§ã‚ã‚‹ã“ã¨ã«æ³¨æ„ã™ã‚‹ï¼ å‚è€ƒï¼š https://zenn.dev/agektmr/articles/f8dcd345a88c97 https://azisava.sakura.ne.jp/programming/0017.html#sec4-1 ï¼Šå®Ÿè£…ä¾‹ï¼Š Domainå±æ€§ã«example.co.jpãŒå‰²ã‚Šå½“ã¦ã‚‰ã‚Œã¦ã„ãŸã¨ã™ã‚‹ï¼æœ€åˆã«ãƒ‰ãƒƒãƒˆãŒã¤ã„ã¦ã„ã‚‹ãƒ‰ãƒ¡ã‚¤ãƒ³ï¼ˆ.example.co.jpï¼‰ã§ã‚‚ï¼ŒåŒã˜å€¤ã¨ã—ã¦èªè­˜ã•ã‚Œã‚‹ï¼ã“ã®å ´åˆï¼Œexample.co.jpã«åŠ ãˆã¦ï¼Œã‚µãƒ–ãƒ‰ãƒ¡ã‚¤ãƒ³ï¼ˆfoo.example.co.jpï¼‰ã«å¯¾ã—ã¦ã‚‚ï¼ŒCookieãƒ˜ãƒƒãƒ€ãƒ¼ã‚’æŒã¤ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é€ä¿¡ã§ãã‚‹ï¼ 200 OK Set-Cookie: domain=example.co.jp POST http://foo.example.co.jp/bar-form.php HTTP/2 # é€ä¿¡å…ƒã‚ªãƒªã‚¸ãƒ³ Origin: http://example.co.jp Cookie: sessionid=; csrftoken= ãƒ»ã€å¯¾ç­–ã€‘Set-Cookieãƒ˜ãƒƒãƒ€ãƒ¼ã®HttpOnlyå±æ€§ ã“ã‚Œã‚’æœ‰åŠ¹åŒ–ã—ãŸå ´åˆï¼ŒSet-Cookieãƒ˜ãƒƒãƒ€ãƒ¼ã«HttpOnlyå±æ€§ãŒå‰²ã‚Šå½“ã¦ã‚‰ã‚Œã‚‹ã‚ˆã†ã«ãªã‚‹ï¼JavaScriptã‹ã‚‰Cookieãƒ˜ãƒƒãƒ€ãƒ¼ã«ã‚¢ã‚¯ã‚»ã‚¹ã§ããªãã§ãã‚‹ï¼ 200 OK Set-Cookie: HttpOnly ãƒ»ã€å¯¾ç­–ã€‘Set-Cookieãƒ˜ãƒƒãƒ€ãƒ¼ã®sameSiteå±æ€§ ç¨®é¡ èª¬æ˜ None ç•°ãªã‚‹ãƒ‰ãƒ¡ã‚¤ãƒ³ã‹ã‚‰é€ä¿¡ã•ã‚ŒãŸå…¨ã¦ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆãŒCookieãƒ˜ãƒƒãƒ€ãƒ¼ã‚’æŒã¤ã“ã¨ã‚’è¨±å¯ã™ã‚‹ï¼ Lax ç•°ãªã‚‹ãƒ‰ãƒ¡ã‚¤ãƒ³ã‹ã‚‰é€ä¿¡ã•ã‚ŒãŸä¸€éƒ¨ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆãŒCookieãƒ˜ãƒƒãƒ€ãƒ¼ã‚’æŒã¤ã“ã¨ã‚’è¨±å¯ã™ã‚‹ï¼ Strict ç•°ãªã‚‹ãƒ‰ãƒ¡ã‚¤ãƒ³ã‹ã‚‰é€ä¿¡ã•ã‚ŒãŸå…¨ã¦ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆãŒCookieãƒ˜ãƒƒãƒ€ãƒ¼ã‚’æŒã¤ã“ã¨ã‚’æ‹’å¦ã™ã‚‹ï¼ ç•°ãªã‚‹ãƒ‰ãƒ¡ã‚¤ãƒ³ã‹ã‚‰ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆãŒCookieãƒ˜ãƒƒãƒ€ãƒ¼ã‚’æŒã¤ã“ã¨ã‚’è¨±å¯ï¼æ‹’å¦ã™ã‚‹ï¼ã“ã“ã§ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’åˆ¶å¾¡ã—ã¦ã„ã‚‹ã®ã¯ï¼Œã‚ªãƒªã‚¸ãƒ³ã§ã¯ãªãï¼Œãƒ‰ãƒ¡ã‚¤ãƒ³ã§ã‚ã‚‹ã“ã¨ã«æ³¨æ„ã™ã‚‹ï¼ å‚è€ƒï¼šhttps://zenn.dev/agektmr/articles/f8dcd345a88c97 200 OK Set-Cookie: SameSite=None ãƒ»ã€å¯¾ç­–ã€‘Set-Cookieãƒ˜ãƒƒãƒ€ãƒ¼ã®Secureå±æ€§ ã“ã‚Œã‚’æœ‰åŠ¹åŒ–ã—ãŸå ´åˆï¼ŒSet-Cookieãƒ˜ãƒƒãƒ€ãƒ¼ã«Secureå±æ€§ãŒå‰²ã‚Šå½“ã¦ã‚‰ã‚Œã‚‹ã‚ˆã†ã«ãªã‚‹ï¼HTTPSãƒ—ãƒ­ãƒˆã‚³ãƒ«ã‚’ä½¿ç”¨ã—ãŸå ´åˆã®ã¿ï¼Œãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã«Cookieãƒ˜ãƒƒãƒ€ãƒ¼ã‚’å‰²ã‚Šå½“ã¦ã‚‰ã‚Œã‚‹ã‚ˆã†ã«ãªã‚‹ï¼ 200 OK Set-Cookie: Secure ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒªã‚¹ãƒˆæ”»æ’ƒ ãƒ»ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒªã‚¹ãƒˆæ”»æ’ƒã¨ã¯ æ¼æ´©ã—ãŸãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’ç”¨ã„ã¦ï¼Œæ­£é¢ã‹ã‚‰æ­£ã€…å ‚ã€…ã¨ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹æ‰‹æ³•ï¼ Brute-forceæ”»æ’ƒã¨Reverse Brute-forceæ”»æ’ƒ ãƒ»Brute-forceæ”»æ’ƒã¨Reverse Brute-forceæ”»æ’ƒã¨ã¯ Brute-forceã¯åŠ›ãšãã®æ„å‘³ï¼IDã‚’å›ºå®šã—ã¦ï¼Œãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’ç·å½“ãŸã‚Šã§è©¦ã™æ‰‹æ³•ï¼ä¾‹ãˆã°ï¼Œ5æ¡æ•°å­—ã®ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãªã‚‰ï¼Œ9ã®5ä¹—é€šã‚Šã®çµ„ã¿åˆã‚ã›ã‚’è©¦ã™ï¼ä¸€æ–¹ã§ï¼ŒReverse Brute-forceã¯ï¼Œãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å›ºå®šã—ã¦ï¼ŒIDã‚’ç·å½“ãŸã‚Šã§è©¦ã™æ‰‹æ³•ï¼ ãƒ»ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã®ãƒ‘ã‚¿ãƒ¼ãƒ³æ•° ãƒ¬ã‚¤ãƒ³ãƒœãƒ¼æ”»æ’ƒ ãƒ»ãƒ¬ã‚¤ãƒ³ãƒœãƒ¼æ”»æ’ƒã¨ã¯ ãƒ¬ã‚¤ãƒ³ãƒœãƒ¼ãƒ†ãƒ¼ãƒ–ãƒ«ã®æ–‡å­—åˆ—ã¨ãƒãƒƒã‚·ãƒ¥å€¤ã®å¯¾å¿œé–¢ä¿‚ã‚’å…ƒã«ã—ã¦ï¼Œãƒãƒƒã‚·ãƒ¥åŒ–ã•ã‚ŒãŸæš—å·ã‹ã‚‰ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’æ¨æ¸¬ã™ã‚‹æ‰‹æ³•ï¼ ãƒ»ã€å¯¾ç­–ã€‘BCryptã«ã‚ˆã‚‹ãƒãƒƒã‚·ãƒ¥åŒ– BCryptã‚’ä½¿ç”¨ã—ã¦ï¼ŒBlowfishæ–¹å¼ã«åŸºã¥ãæš—å·åŒ–ã‚’å®Ÿè¡Œã™ã‚‹ï¼Blowfishæ–¹å¼ã§ã¯ï¼ŒåŒã˜ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã®æ–‡å­—åˆ—ã§ã‚ã£ã¦ã‚‚ç•°ãªã‚‹ãƒãƒƒã‚·ãƒ¥å€¤ãŒç”Ÿæˆã•ã‚Œã‚‹ãŸã‚ï¼Œãƒ¬ã‚¤ãƒ³ãƒœãƒ¼æ”»æ’ƒã‚’é˜²ã’ã‚‹ï¼Blowfishæ–¹å¼ã§ç”Ÿæˆã•ã‚ŒãŸãƒãƒƒã‚·ãƒ¥å€¤ã¯ï¼Œç•°ãªã‚‹ãƒ«ãƒ¼ãƒ«ã§ç”Ÿæˆã•ã‚ŒãŸè¤‡æ•°ã®ãƒãƒƒã‚·ãƒ¥å€¤ã®çµ„ã¿åˆã‚ã›ã§ã‚ã‚‹ï¼ å‚è€ƒï¼š https://medium-company.com/%E3%82%B9%E3%83%88%E3%83%AC%E3%83%83%E3%83%81%E3%83%B3%E3%82%B0/ https://medium-company.com/bcrypt/ # + + + $2y$10$1QVmWNzk.TsaZQLQ/zeI9OAZL02AWP.VdFPPyAc9hSc2Cp4yOXKtG æ–‡å­—åˆ— èª¬æ˜ $2y$ï¼ˆ4æ–‡å­—ï¼‰ æš—å·åŒ–ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’è¡¨ã™ï¼ä»–ã«ï¼Œ2ï¼Œ2aï¼Œ2bï¼Œ2xãŒã‚ã‚‹ï¼ $10$ï¼ˆ4æ–‡å­—ï¼‰ ã‚¹ãƒˆãƒ¬ãƒƒãƒãƒ³ã‚°ï¼ˆãƒãƒƒã‚·ãƒ¥åŒ–ã®åå¾©ï¼‰ã®å›æ•°ã‚’è¡¨ã™ï¼10ã¨ã—ãŸå ´åˆã¯ï¼Œ2^10å›åå¾©ã§ãƒãƒƒã‚·ãƒ¥åŒ–ã‚’å®Ÿè¡Œã™ã‚‹ï¼ 1QVmWNzk.TsaZQLQ/zeI9Oï¼ˆ22æ–‡å­—ï¼‰ ã‚½ãƒ«ãƒˆï¼ˆãƒ©ãƒ³ãƒ€ãƒ ãªæ–‡å­—åˆ—ï¼‰ã‚’è¡¨ã™ï¼ AZL02AWP.VdFPPyAc9hSc2Cp4yOXKtGï¼ˆ31æ–‡å­—ï¼‰ ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãã®ã‚‚ã®ã®ãƒãƒƒã‚·ãƒ¥å€¤ã‚’è¡¨ã™ï¼ 04. ãã®ä»–ã®ã‚µã‚¤ãƒãƒ¼æ”»æ’ƒ ã‚½ãƒ¼ã‚·ãƒ£ãƒ«ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ãƒªãƒ³ã‚° ãƒ»ã‚½ãƒ¼ã‚·ãƒ£ãƒ«ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ãƒªãƒ³ã‚°ã¨ã¯ æŠ€è¡“çš„ãªæ‰‹æ³•ã§ã¯ãªãï¼Œç‰©ç†çš„ãªæ‰‹æ³•ï¼ˆç›—ã¿è¦‹ï¼Œç›—ã¿èãï¼Œæˆã‚Šã™ã¾ã—ï¼Œè©æ¬ºãªã©ï¼‰ã«ã‚ˆã£ã¦ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å–å¾—ã—ï¼Œã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹æ‰‹æ³•ï¼ è¸ã¿å°æ”»æ’ƒ ãƒ»è¸ã¿å°æ”»æ’ƒã¨ã¯ å¯¾è±¡ã®ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆå†…ã®ãƒ‘ã‚½ã‚³ãƒ³ã«æ”»æ’ƒãƒ—ãƒ­ã‚°ãƒ©ãƒ ã‚’ä»•è¾¼ã‚“ã§ç½®ãï¼Œæ”»æ’ƒè€…ã‹ã‚‰ã®å‘½ä»¤ã§ã‚µãƒ¼ãƒã‚’æ”»æ’ƒã•ã›ã‚‹æ‰‹æ³•ï¼ˆâ€»ãƒœãƒƒãƒˆã‚’ç”¨ã„ãŸæ”»æ’ƒãªã©ï¼‰ ãƒ»ãƒ‘ã‚½ã‚³ãƒ³ãŒãƒœãƒƒãƒˆåŒ–ã™ã‚‹ã¾ã§ã®ãƒ—ãƒ­ã‚»ã‚¹ï¼ˆå†æ²ï¼‰ ãƒ»ã‚¹ãƒãƒ›ãŒãƒœãƒƒãƒˆåŒ–ã™ã‚‹ã¾ã§ã®ãƒ—ãƒ­ã‚»ã‚¹ï¼ˆå†æ²ï¼‰ ãƒ»Bot ã®ä½¿ã‚ã‚Œæ–¹ï¼ˆå†æ²ï¼‰ DNS Cache Poisoning ãƒ»DNS Cache Poisoningã¨ã¯ ã‚­ãƒ£ãƒƒã‚·ãƒ¥DNSã‚µãƒ¼ãƒãƒ¼ãŒã‚‚ã¤IPã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’å½ã®IPã‚¢ãƒ‰ãƒ¬ã‚¹ã«å¤‰ãˆï¼Œå½ã®Webã‚µã‚¤ãƒˆã«å¼·åˆ¶çš„ã«ã‚¢ã‚¯ã‚»ã‚¹ã•ã›ã‚‹æ‰‹æ³•ï¼ Back Door ãƒ»Back Doorã¨ã¯ ä¾‹ãˆã°ï¼ŒWebã‚µã‚¤ãƒˆã®ã‚«ãƒ¼ãƒ‰æ±ºæ¸ˆç”»é¢ã‚„ã‚µãƒ¼ãƒã«æ½œã¾ã›ã‚‹ã“ã¨ã«ã‚ˆã£ã¦ï¼Œã‚«ãƒ¼ãƒ‰æƒ…å ±ã‚’ç¬¬ä¸‰è€…ã«é€ä¿¡ã™ã‚‹æ‰‹æ³•ï¼ "},"public/network/network_security_encryption_technology.html":{"url":"public/network/network_security_encryption_technology.html","title":"ğŸ“– ï¸é€šä¿¡ãƒ‡ãƒ¼ã‚¿ã®æš—å·åŒ–æŠ€è¡“","keywords":"","body":"é€šä¿¡ãƒ‡ãƒ¼ã‚¿ã®æš—å·åŒ–æŠ€è¡“ ã¯ã˜ã‚ã« æœ¬ã‚µã‚¤ãƒˆã«ã¤ãã¾ã—ã¦ï¼Œä»¥ä¸‹ã‚’ã”èªè­˜ã®ã»ã©å®œã—ããŠé¡˜ã„ã„ãŸã—ã¾ã™ï¼ å‚è€ƒï¼šhttps://hiroki-it.github.io/tech-notebook-gitbook/ 01. é€šä¿¡ãƒ‡ãƒ¼ã‚¿ã‚’æš—å·åŒ–ã™ã‚‹ç›®çš„ ç›—è´ï¼ˆé€šä¿¡ãƒ‡ãƒ¼ã‚¿ã®ç›—ã¿å–ã‚Šï¼‰ã‚’é˜²ããŸã‚ ã€å…±é€šéµæš—å·æ–¹å¼ã€ã‚„ã€å…¬é–‹éµæš—å·æ–¹å¼ã€ã«ã‚ˆã£ã¦å®Ÿç¾ã•ã‚Œã‚‹ï¼æš—å·ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã«åŸºã¥ãæš—å·æ–¹å¼ã‚’ç”¨ã„ã¦ãƒ‡ãƒ¼ã‚¿ã‚’æš—å·åŒ–ã™ã‚‹ã“ã¨ã«ã‚ˆã£ã¦ï¼Œé€šä¿¡ãƒ‡ãƒ¼ã‚¿ã®ç›—è´ã‚’é˜²ãï¼ æ”¹ç«„ï¼ˆé€šä¿¡ãƒ‡ãƒ¼ã‚¿ã®æ›¸ãæ›ãˆï¼‰ã‚’é˜²ããŸã‚ ã€ãƒ‡ã‚¸ã‚¿ãƒ«ç½²åã€ã‚„ã€ãƒãƒƒã‚·ãƒ¥é–¢æ•°ã€ã«ã‚ˆã£ã¦å®Ÿç¾ã•ã‚Œã‚‹ï¼ç›¸æ‰‹ã«é€ã£ãŸãƒ‡ãƒ¼ã‚¿ã¨ç›¸æ‰‹ãŒå—ã‘å–ã£ãŸãƒ‡ãƒ¼ã‚¿ãŒåŒã˜ã‹ã©ã†ã‹ã‚’ç¢ºèªã™ã‚‹ã“ã¨ã«ã‚ˆã£ã¦ï¼Œé€šä¿¡ãƒ‡ãƒ¼ã‚¿ã®æ”¹ç«„ã‚’é˜²ãï¼ æˆã‚Šã™ã¾ã—ã‚’é˜²ããŸã‚ ã€ãƒ‡ã‚¸ã‚¿ãƒ«ç½²åã€ã«ã‚ˆã£ã¦å®Ÿç¾ã•ã‚Œã‚‹ï¼æ­£ã—ã„ç›¸æ‰‹ã§ã‚ã‚‹ã“ã¨ã‚’è¨¼æ˜ã™ã‚‹ã“ã¨ã«ã‚ˆã£ã¦ï¼Œæˆã‚Šã™ã¾ã—ã‚’é˜²ãï¼ 01-02. æš—å·ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ  é€šä¿¡ãƒ‡ãƒ¼ã‚¿ã®æš—å·åŒ–ã®ã»ã¨ã‚“ã©ã¯ï¼Œã€å…±é€šéµæš—å·æ–¹å¼ã€ã‚„ã€å…¬é–‹éµæš—å·æ–¹å¼ã€ã«ã‚ˆã£ã¦å®Ÿç¾ã•ã‚Œã‚‹ï¼ãã‚Œã‚‰ã®æ–¹å¼ã¯ï¼Œä»¥ä¸‹ã®ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã«ã‚ˆã£ã¦å®Ÿè£…ã•ã‚Œã‚‹ï¼ å…±é€šéµæš—å·ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ  å…±é€šéµæš—å·æ–¹å¼ã‚’å®Ÿè£…ã™ã‚‹ãŸã‚ã®ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ  ãƒ»DES æš—å·ï¼šData Encryption Standard ãƒ»AES æš—å·ï¼šAdvanced Encryption Standard å…¬é–‹éµæš—å·ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ  å…¬é–‹éµæš—å·æ–¹å¼ã‚’å®Ÿè£…ã™ã‚‹ãŸã‚ã®ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ  ãƒ»RSA æš—å·ï¼šRivest-Shamir-Adleman cryptosystem 01-03. æš—å·ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã«åŸºã¥ãæš—å·æ–¹å¼ æš—å·æ–¹å¼ã®ç¨®é¡ä¸€è¦§ å…±é€šéµæš—å·æ–¹å¼ å…¬é–‹éµæš—å·æ–¹å¼ æš—å·åŒ–ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ  å…±é€šéµæš—å·ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ  å…¬é–‹éµæš—å·ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ  ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã®ç¨®é¡ RC4ã€DESã€3DESã€AES RSAã€ElGamal æš—å·åŒ–ã«è¦ã™ã‚‹æ™‚é–“ ã‚ˆã‚ŠçŸ­ã„ ã‚ˆã‚Šé•·ã„ ç”Ÿæˆã•ã‚Œã‚‹æš—å·éµ å…±é€šéµ ç§˜å¯†éµã€å…¬é–‹éµ éµã®é…å¸ƒæ–¹æ³• ãƒ¡ãƒ¼ãƒ«ï¼ˆç›—è´ã«æ°—ã‚’ä»˜ã‘ã‚‹ï¼‰ ãƒ¡ãƒ¼ãƒ«ã€PKI éµã®å†åˆ©ç”¨ å†åˆ©ç”¨ã™ã‚‹ã¹ãã§ã¯ãªã„ å†åˆ©ç”¨ã—ã¦ã‚‚ã‚ˆã„ å…±é€šéµæš—å·æ–¹å¼ ãƒ»å…±é€šéµæš—å·æ–¹å¼ã¨ã¯ ã‚µãƒ¼ãƒã‹ã‚‰å—ä¿¡è€…ï¼ˆã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆï¼‰ã«ã‚ã‚‰ã‹ã˜ã‚ç§˜å¯†éµã‚’æ¸¡ã—ã¦ãŠãï¼éµã®å—ã‘æ¸¡ã—ã‚’å·¥å¤«ã—ãªã„ã¨ï¼Œå…±é€šéµãŒç›—è´ã•ã‚Œã‚‹å¯èƒ½æ€§ãŒã‚ã‚‹ï¼ˆéµé…é€å•é¡Œï¼‰ï¼ ï¼Šä¾‹ï¼Š ã‚¨ã‚¯ã‚»ãƒ«ã®ãƒ•ã‚¡ã‚¤ãƒ«ãƒ­ãƒƒã‚¯ é•·æ‰€ï¼šå‡¦ç†ãŒé€Ÿã„ çŸ­æ‰€ï¼šéµã®é…å¸ƒãŒå¤§å¤‰ ãƒ»å…±é€šéµã®å†åˆ©ç”¨ã®å¯å¦ å„å—ä¿¡è€…ï¼ˆã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆï¼‰ã¯ï¼Œã‚µãƒ¼ãƒã‹ã‚‰ï¼Œå—ä¿¡è€…ã”ã¨ã«ç”Ÿæˆã•ã‚ŒãŸå…±é€šéµã‚’ã‚‚ã‚‰ã†ï¼éµã®å†åˆ©ç”¨ã‚’ã™ã‚‹ã¹ãã§ã¯ãªã„ï¼ å…¬é–‹éµæš—å·æ–¹å¼ ãƒ»å…¬é–‹éµæš—å·æ–¹å¼ã¨ã¯ å…¬é–‹éµæš—å·æ–¹å¼ã§ã‚‚è¨˜è¼‰ã®é€šã‚Šï¼Œå…±é€šéµæš—å·æ–¹å¼ã®éµé…é€å•é¡Œã‚’è§£æ±ºã™ã¹ãé–‹ç™ºã•ã‚ŒãŸï¼ã€RSAæš—å·ã€ãªã©ã«ã‚ˆã£ã¦å®Ÿè£…ã•ã‚Œã‚‹ï¼å—ä¿¡è€…ï¼ˆã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆï¼‰ã®å…¬é–‹éµã§æš—å·åŒ–ã—ãŸå ´åˆï¼Œå—ä¿¡è€…ã®ç§˜å¯†éµã§ã®ã¿å¾©å·å¯èƒ½ï¼ã™ãªã‚ã¡ï¼Œç¬¬ä¸‰è€…ã«å¾©å·ï¼ˆè§£èª­ï¼‰ã•ã‚Œã‚‹ã“ã¨ã¯ãªã„ã¨åˆ¤æ–­å¯èƒ½ï¼ ï¼Šã‚µãƒ¼ãƒãŒè¡Œã†ã“ã¨ï¼Š ã‚µãƒ¼ãƒã¯ï¼Œå—ä¿¡è€…ï¼ˆã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆï¼‰ã‹ã‚‰å…¬é–‹éµã‚’ã‚‚ã‚‰ã†ï¼ å…¬é–‹éµã‚’ç”¨ã„ã¦ï¼Œæƒ…å ±ã‚’æš—å·åŒ–ã™ã‚‹ï¼ ï¼Šå—ä¿¡è€…ï¼ˆã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆï¼‰ãŒè¡Œã†ã“ã¨ï¼Š å—ä¿¡è€…ï¼ˆã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆï¼‰ã¯ï¼Œç§˜å¯†éµã§æƒ…å ±ã‚’å¾©å·ã™ã‚‹ï¼ ãƒ»å…¬é–‹éµã®å†åˆ©ç”¨ã®å¯å¦ å„å—ä¿¡è€…ï¼ˆã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆï¼‰ã¯ï¼Œã‚µãƒ¼ãƒã‹ã‚‰ï¼Œç•°ãªã‚‹ã‚µãƒ¼ãƒã§å†åˆ©ç”¨ã•ã‚Œã‚‹å…¬é–‹éµã‚’ã‚‚ã‚‰ã†ï¼ãŸã ã—ï¼Œã‚µãƒ¼ãƒã”ã¨ã«ç•°ãªã‚‹ç§˜å¯†éµã¨å…¬é–‹éµã‚’ç”¨ã„ã¦ã‚‚ã‚ˆã„ï¼ ãƒã‚¤ãƒ–ãƒªãƒƒãƒ‰æš—å·æ–¹å¼ å…±é€šéµæš—å·æ–¹å¼ã¨å…¬é–‹éµæš—å·æ–¹å¼ã‚’çµ„ã¿åˆã‚ã›ãŸæš—å·æ–¹å¼ï¼ä¸¡æ–¹ã®æ–¹å¼ã®é•·æ‰€ã¨çŸ­æ‰€ã‚’è£œã†ï¼ 02. æš—å·åŒ–æ–¹å¼ã«åŸºã¥ãã‚»ã‚­ãƒ¥ã‚¢ãƒ—ãƒ­ãƒˆã‚³ãƒ« ã‚»ã‚­ãƒ¥ã‚¢ãƒ—ãƒ­ãƒˆã‚³ãƒ«ã®ç¨®é¡ã¨æ‰±ã‚ã‚Œã‚‹éšå±¤ ãƒ—ãƒ­ãƒˆã‚³ãƒ«ã¨ã—ã¦ã®æš—å·åŒ–æŠ€è¡“ã§ã‚ã‚‹ã€ã‚»ã‚­ãƒ¥ã‚¢ãƒ—ãƒ­ãƒˆã‚³ãƒ«ã€ã¯ï¼Œèµ¤è‰²ã§ç¤ºã—ã¦ã‚ã‚‹ï¼ ã‚»ã‚­ãƒ¥ã‚¢ãƒ—ãƒ­ãƒˆã‚³ãƒ«ã§æ‰±ã‚ã‚Œã‚‹é€šä¿¡ãƒ‡ãƒ¼ã‚¿ ãƒ»é€šä¿¡ãƒ‡ãƒ¼ã‚¿ã®ç¨®é¡ Webã‚³ãƒ³ãƒ†ãƒ³ãƒ„ãƒ‡ãƒ¼ã‚¿ï¼Œãƒ¡ãƒ¼ãƒ«ãƒ‡ãƒ¼ã‚¿ï¼Œãã®ä»– ãƒ»é€šä¿¡ãƒ‡ãƒ¼ã‚¿ã®ä½œæˆï¼Œãƒ˜ãƒƒãƒ€æƒ…å ±è¿½åŠ ï¼Œã‚«ãƒ—ã‚»ãƒ«åŒ– ãƒ‘ã‚±ãƒƒãƒˆäº¤æ›æ–¹å¼ã«ãŠã‘ã‚‹ãƒ‘ã‚±ãƒƒãƒˆã®ãƒ˜ãƒƒãƒ€æƒ…å ±ã¯ï¼Œãƒ‘ã‚½ã‚³ãƒ³ã®å„æ¦‚å¿µå±¤ã®ãƒ—ãƒ­ãƒˆã‚³ãƒ«ã«ã‚ˆã£ã¦è¿½åŠ ã•ã‚Œã¦ã„ãï¼ 02-02. ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å±¤ã«ãŠã‘ã‚‹ãƒ¡ãƒ¼ãƒ«ãƒ‡ãƒ¼ã‚¿ã®æš—å·åŒ–æŠ€è¡“ S/MIMEï¼šSecure MIME ãƒ»S/MINEã¨ã¯ æš—å·åŒ–ãƒ€ã‚¤ã‚¸ã‚§ã‚¹ãƒˆï¼ˆãƒ‡ã‚¸ã‚¿ãƒ«ç½²åï¼‰ã‚’å«ã‚€ãƒ‡ã‚¸ã‚¿ãƒ«è¨¼æ˜æ›¸ã‚’ãƒ¡ãƒ¼ãƒ«ã«æ·»ä»˜ã™ã‚‹ã“ã¨ã«ã‚ˆã£ã¦ï¼Œå…¬é–‹éµã®æˆã‚Šã™ã¾ã—ã‚’é˜²ãã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£æŠ€è¡“ï¼ ãƒ»S/MIMEã«ãŠã‘ã‚‹ãƒ‡ã‚¸ã‚¿ãƒ«è¨¼æ˜æ›¸ ãƒ‡ã‚¸ã‚¿ãƒ«è¨¼æ˜æ›¸ã‚’S/MIMEã«ç”¨ã„ã‚‹å ´åˆï¼Œç‰¹ã«S/MIMEè¨¼æ˜æ›¸ã¨ã„ã†ï¼è©³ã—ãã¯ï¼Œæš—å·ãƒ€ã‚¤ã‚¸ã‚§ã‚¹ãƒˆï¼ˆãƒ‡ã‚¸ã‚¿ãƒ«ç½²åï¼‰ã‚’å‚ç…§ï¼ 02-03. ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å±¤ã«ãŠã‘ã‚‹ãƒªãƒ¢ãƒ¼ãƒˆæ¥ç¶šï¼æ“ä½œã‚„ãƒ•ã‚¡ã‚¤ãƒ«è»¢é€ã®æš—å·åŒ–æŠ€è¡“ SSHï¼šSecure Shell ãƒ»SSHã¨ã¯ å…¬é–‹éµæš—å·æ–¹å¼ã«åŸºã¥ãã‚»ã‚­ãƒ¥ã‚¢ãƒ—ãƒ­ãƒˆã‚³ãƒ«ï¼å…¬é–‹éµæš—å·æ–¹å¼ã¨ï¼Œå…¬é–‹éµèªè¨¼æ–¹å¼ã‚„ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰èªè¨¼æ–¹å¼ã®æŠ€è¡“ã‚’ç”¨ã„ã¦ï¼Œã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆã‚’çµŒç”±ã—ã¦ï¼Œã‚µãƒ¼ãƒã®ãƒªãƒ¢ãƒ¼ãƒˆæ¥ç¶šï¼æ“ä½œã‚’è¡Œã†ï¼ç‰©ç†Webã‚µãƒ¼ãƒã§ã‚ã£ã¦ã‚‚ï¼Œä»®æƒ³Webã‚µãƒ¼ãƒã§ã‚ã£ã¦ã‚‚ï¼ŒSSHã«ã‚ˆã‚‹ãƒªãƒ¢ãƒ¼ãƒˆæ¥ç¶šï¼æ“ä½œã®ä»•çµ„ã¿ã¯åŒã˜ã§ã‚ã‚‹ï¼ ãƒ»SSHæ¥ç¶šï¼æ“ä½œã™ã‚‹å´ã«å¿…è¦ãªã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ ã€OpenSSHã€ï¼Œã€TeraTermã€ï¼Œã€Puttyã€ãŒã‚ã‚‹ï¼ ãƒ»SSHæ¥ç¶šï¼æ“ä½œã•ã‚Œã‚‹å´ã«å¿…è¦ãªã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ ã€OpenSSHã€ï¼Œã€Apache MINA/SSHDã€ ãƒ»SSHãƒãƒ¼ãƒˆãƒ•ã‚©ãƒ¯ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ï¼ˆSSHãƒãƒ¼ãƒˆè»¢é€ï¼‰ ãƒ­ãƒ¼ã‚«ãƒ«ã‚µãƒ¼ãƒã¨è¸ã¿å°ã‚µãƒ¼ãƒã®SSHæ¥ç¶šã¨ï¼Œãƒãƒ¼ãƒˆãƒ•ã‚©ãƒ¯ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã‚’çµ„ã¿åˆã‚ã›ã‚‹ã“ã¨ã«ã‚ˆã£ã¦ï¼Œå¤–éƒ¨ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã®ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯å†…ãƒªãƒ¢ãƒ¼ãƒˆã‚µãƒ¼ãƒã®ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã«é–“æ¥çš„ã«é€šä¿¡ã‚’è¡Œã†æ–¹æ³•ï¼ãƒãƒ¼ãƒˆãƒ•ã‚©ãƒ¯ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã«ã¤ã„ã¦ã¯ï¼Œãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã®ãƒãƒ¼ãƒˆã‚’å‚ç…§ï¼ ï¼Šä¾‹ï¼Š è¸ã¿å°ã‚µãƒ¼ãƒï¼ˆä¾‹ï¼šEC2ï¼‰ã‚’ç”¨ã„ã¦ï¼Œãƒ­ãƒ¼ã‚«ãƒ«ã‚µãƒ¼ãƒï¼ˆä¾‹ï¼šè‡ªèº«ã®ãƒ‘ã‚½ã‚³ãƒ³ï¼‰ã®20000ç•ªãƒãƒ¼ãƒˆãŒå‰²ã‚Šå½“ã¦ã‚‰ã‚ŒãŸã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã¨ï¼Œãƒªãƒ¢ãƒ¼ãƒˆã‚µãƒ¼ãƒï¼ˆä¾‹ï¼šAuroraï¼‰ã®3306ç•ªãŒå‰²ã‚Šå½“ã¦ã‚‰ã‚ŒãŸã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ãƒãƒƒãƒ”ãƒ³ã‚°ã§ãã‚‹ã‚ˆã†ã«ãªã‚‹ï¼DBMSã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚½ãƒ•ãƒˆã§ã¯ï¼Œãƒªãƒ¢ãƒ¼ãƒˆã«ã‚ã‚‹DBã‚µãƒ¼ãƒã«æ¥ç¶šã™ã‚‹ãŸã‚ã«ï¼Œã“ã®ä»•çµ„ã¿ãŒã‚ˆãç”¨ã„ã‚‰ã‚Œã‚‹ï¼ # ãƒ­ãƒ¼ã‚«ãƒ«ã®20000ç•ªãƒãƒ¼ãƒˆãŒå‰²ã‚Šå½“ã¦ã‚‰ã‚ŒãŸã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã«å¯¾ã™ã‚‹é€šä¿¡ã‚’ï¼ŒRDSã®3306ç•ªãƒãƒ¼ãƒˆã®ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã«è»¢é€ï¼ [local pc] $ ssh -L20000:xxxx.rds.amazonaws.com:3306 username@fumidai.com ï¼Šä¾‹ï¼Š ã“ã®ãƒªãƒ¢ãƒ¼ãƒˆã‚µãƒ¼ãƒãŒä»®æƒ³ã‚µãƒ¼ãƒï¼ã‚³ãƒ³ãƒ†ãƒŠã®å ´åˆã‚‚ã‚ã‚Šï¼Œãƒ›ã‚¹ãƒˆOSã¨ä»®æƒ³ã‚µãƒ¼ãƒï¼ã‚³ãƒ³ãƒ†ãƒŠã®æ¥ç¶šã§ã‚‚SSHãƒãƒ¼ãƒˆãƒ•ã‚©ãƒ¯ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ãŒç”¨ã„ã‚‰ã‚Œã¦ã„ã‚‹ï¼ãƒ›ã‚¹ãƒˆå¤–éƒ¨ã®ãƒ‘ã‚½ã‚³ãƒ³ã‹ã‚‰ï¼Œãƒ›ã‚¹ãƒˆOSä¸Šã®ä»®æƒ³ã‚µãƒ¼ãƒï¼ã‚³ãƒ³ãƒ†ãƒŠã«æ¥ç¶šã—ãŸã„å ´åˆï¼ŒSSHãƒãƒ¼ãƒˆãƒ•ã‚©ãƒ¯ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã‚’ç”¨ã„ã‚‹ã“ã¨ã«ã‚ˆã£ã¦ï¼Œãƒ›ã‚¹ãƒˆOSã‚’è¸ã¿å°ã¨ã—ãŸä»®æƒ³ã‚µãƒ¼ãƒï¼ã‚³ãƒ³ãƒ†ãƒŠã¸ã®æ¥ç¶šãŒè¡Œãˆã‚‹ã‚ˆã†ã«ãªã‚‹ï¼ SCPï¼šSecure Copy Protocol ãƒ»SCPã¨ã¯ SSHã‚’ä»‹ã—ã¦ï¼Œãƒ•ã‚¡ã‚¤ãƒ«è»¢é€ã‚’è¡Œã†ï¼SSHã®æ©Ÿèƒ½ã‚’ã‚ˆã‚Šæ‹¡å¼µã—ãŸãƒ—ãƒ­ãƒˆã‚³ãƒ«ã§ã‚ã‚‹ï¼ ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã¯ï¼Œãƒªãƒ¢ãƒ¼ãƒˆæ¥ç¶šå…ˆã®ã‚µãƒ¼ãƒã«ãƒ•ã‚¡ã‚¤ãƒ«é€ä¿¡ã‚’å‘½ä»¤ã™ã‚‹ï¼ ã‚µãƒ¼ãƒã¯ï¼ŒShellã‚’ç”¨ã„ã¦SCPãƒ—ãƒ­ã‚°ãƒ©ãƒ ã‚’èµ·å‹•ã—ï¼Œã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã«ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é€ä¿¡ã™ã‚‹ï¼ ãƒ»ãƒ•ã‚¡ã‚¤ãƒ«ã‚’è¦æ±‚ã™ã‚‹å´ã«å¿…è¦ãªã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ ã€WinSCPã€ï¼Œã€Filezillaã€ ãƒ»ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é€ä¿¡ã™ã‚‹å´ã«å¿…è¦ãªã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ SFTPï¼šSSH File Transfer Protocol ãƒ»SFTPã¨ã¯ SSHã‚’ä»‹ã—ã¦ï¼Œãƒ•ã‚¡ã‚¤ãƒ«è»¢é€ã‚’è¡Œã†ï¼SSHã¨FTPã‚’çµ„ã¿åˆã‚ã›ãŸãƒ—ãƒ­ãƒˆã‚³ãƒ«ã§ã¯ãªãï¼ŒSSHã®æ©Ÿèƒ½ã‚’ã‚ˆã‚Šæ‹¡å¼µã—ãŸã‚‚ã®ã§ã‚ã‚‹ï¼ ãƒ»ãƒ•ã‚¡ã‚¤ãƒ«è¦æ±‚å´ã®ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ ã€WinSCPã€ï¼Œã€Filezillaã€ ãƒ»ãƒ•ã‚¡ã‚¤ãƒ«é€ä¿¡å´ã®ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ 02-04. ãƒˆãƒ©ãƒ³ã‚¹ãƒãƒ¼ãƒˆå±¤ã«ãŠã‘ã‚‹ãƒ˜ãƒƒãƒ€æƒ…å ±ã®æš—å·åŒ–æŠ€è¡“ SSL/TLSï¼šSecure Sockets Layer / Transport Layer Security ãƒ»SSL/TLSã¨ã¯ ãƒã‚¤ãƒ–ãƒªãƒƒãƒ‰æš—å·æ–¹å¼ã«åŸºã¥ãã‚»ã‚­ãƒ¥ã‚¢ãƒ—ãƒ­ãƒˆã‚³ãƒ«ï¼ãƒˆãƒ©ãƒ³ã‚¹ãƒãƒ¼ãƒˆå±¤ã§ï¼Œãƒ‘ã‚±ãƒƒãƒˆã®ãƒ˜ãƒƒãƒ€æƒ…å ±ã®æš—å·åŒ–ã‚’æ‹…ã†ï¼å…·ä½“çš„ã«ã¯ï¼ŒHTTPãƒ—ãƒ­ãƒˆã‚³ãƒ«ã§ï¼ŒGETé€ä¿¡ã®ãƒ˜ãƒƒãƒ€éƒ¨åˆ†ï¼Œã¾ãŸPOSTé€ä¿¡ã®ãƒ˜ãƒƒãƒ€éƒ¨åˆ†ã¨ãƒœãƒ‡ã‚£éƒ¨åˆ†ã‚’æš—å·åŒ–ã™ã‚‹ï¼ ï¼Šä¾‹ï¼Š Chromeã§ã¯ï¼ŒHTTPSã«ãŠã„ã¦ï¼ŒSSLã‚µãƒ¼ãƒè¨¼æ˜æ›¸ã«ä¸å‚™ãŒã‚ã‚‹ï¼ˆä¾‹ãˆã°ï¼Œã‚ªãƒ¬ã‚ªãƒ¬è¨¼æ˜æ›¸ã‚’ç”¨ã„ã¦ã„ã‚‹ï¼‰ã¨ï¼Œä»¥ä¸‹ã®ã‚ˆã†ãªè­¦å‘ŠãŒè¡¨ç¤ºã•ã‚Œã‚‹ï¼SSLã‚µãƒ¼ãƒè¨¼æ˜æ›¸ã«ã¤ã„ã¦ã¯ï¼Œå…¬é–‹éµåŸºç›¤ã®èª¬æ˜ã‚’å‚ç…§ã›ã‚ˆï¼ ãƒ»SSL/TLSã«ãŠã‘ã‚‹ãƒ‡ã‚¸ã‚¿ãƒ«è¨¼æ˜æ›¸ã¨ãƒ‰ãƒ¡ã‚¤ãƒ³èªè¨¼ ãƒ‡ã‚¸ã‚¿ãƒ«è¨¼æ˜æ›¸ã‚’SSLã«ç”¨ã„ã‚‹å ´åˆï¼Œç‰¹ã«SSLã‚µãƒ¼ãƒè¨¼æ˜æ›¸ã¨ã„ã†ï¼æä¾›ã•ã‚Œã‚‹ç§˜å¯†éµã¨çµ„ã¿åˆã‚ã›ã¦ï¼Œãƒ‰ãƒ¡ã‚¤ãƒ³ã®èªè¨¼ã«ç”¨ã„ã‚‰ã‚Œã‚‹ï¼è©³ã—ãã¯ï¼Œæš—å·ãƒ€ã‚¤ã‚¸ã‚§ã‚¹ãƒˆï¼ˆãƒ‡ã‚¸ã‚¿ãƒ«ç½²åï¼‰ã‚’å‚ç…§ï¼ VPNï¼šVirtual Private Networkï¼ˆä»®æƒ³ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ï¼‰ ãƒ»VPNã¨ã¯ ç•°ãªã‚‹ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯é–“ã§å®‰å…¨ãªé€šä¿¡ã‚’è¡Œã†ãŸã‚ã®ä»•çµ„ã¿ï¼IPsecã‚„SSL/TLSã«ã‚ˆã£ã¦å®Ÿç¾ã•ã‚Œã‚‹ï¼ ãƒ»ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆVPNã§ã®SSL/TLSé€šä¿¡ã®åˆ©ç”¨ VPNã‚²ãƒ¼ãƒˆã‚¦ã‚§ã‚¤ã¨ã®SSL/TLSé€šä¿¡ã«ã‚ˆã£ã¦ï¼Œã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆVPNã‚’å®Ÿç¾ã§ãã‚‹ï¼ 02-05. æš—å·ãƒ€ã‚¤ã‚¸ã‚§ã‚¹ãƒˆï¼ˆãƒ‡ã‚¸ã‚¿ãƒ«ç½²åï¼‰ã«ã¤ã„ã¦ æš—å·ãƒ€ã‚¤ã‚¸ã‚§ã‚¹ãƒˆï¼ˆãƒ‡ã‚¸ã‚¿ãƒ«ç½²åï¼‰ã‚’ç”¨ã„ãŸæš—å·åŒ–æŠ€è¡“ ãƒ»æš—å·ãƒ€ã‚¤ã‚¸ã‚§ã‚¹ãƒˆï¼ˆãƒ‡ã‚¸ã‚¿ãƒ«ç½²åï¼‰ã¨ã¯ ã€å…¬é–‹éµæš—å·æ–¹å¼ã¨ã¯é€†ã®ä»•çµ„ã¿ï¼ˆâ€»ã¤ã¾ã‚Šï¼Œå…¬é–‹éµæš—å·æ–¹å¼ã§ã¯ãªã„ï¼‰ã€ã¨ã€ãƒãƒƒã‚·ãƒ¥é–¢æ•°ã€ã‚’åˆ©ç”¨ã—ãŸæš—å·åŒ–ï¼ã€æˆã‚Šã™ã¾ã—ã€ã¨ã€æ”¹ç«„ã€ã‚’é˜²ã’ã‚‹ï¼ ï¼Šã‚µãƒ¼ãƒãŒè¡Œã†ã“ã¨ï¼Š ã‚µãƒ¼ãƒã¯ï¼Œå—ä¿¡è€…ï¼ˆã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆï¼‰ã«ã‚ã‚‰ã‹ã˜ã‚å…¬é–‹éµã‚’é…å¸ƒã—ã¦ãŠãï¼ å¹³æ–‡ã‚’ãƒãƒƒã‚·ãƒ¥åŒ–ã—ï¼Œãƒ€ã‚¤ã‚¸ã‚§ã‚¹ãƒˆã«ã™ã‚‹ï¼ ãƒ€ã‚¤ã‚¸ã‚§ã‚¹ãƒˆã‚’ç§˜å¯†éµã§æš—å·åŒ–ã—ï¼Œæš—å·ãƒ€ã‚¤ã‚¸ã‚§ã‚¹ãƒˆï¼ˆãƒ‡ã‚¸ã‚¿ãƒ«ç½²åï¼‰ã‚’ä½œæˆã™ã‚‹ï¼ ã€å¹³æ–‡ã€ï¼Œã€æš—å·ãƒ€ã‚¤ã‚¸ã‚§ã‚¹ãƒˆï¼ˆãƒ‡ã‚¸ã‚¿ãƒ«ç½²åï¼‰ã€ã‚’é€ä¿¡ã™ã‚‹ï¼ ï¼Šå—ä¿¡è€…ï¼ˆã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆï¼‰ãŒè¡Œã†ã“ã¨ï¼Š å—ä¿¡è€…ï¼ˆã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆï¼‰ã¯ï¼Œã€å¹³æ–‡ã€ã¨ã€æš—å·ãƒ€ã‚¤ã‚¸ã‚§ã‚¹ãƒˆï¼ˆãƒ‡ã‚¸ã‚¿ãƒ«ç½²åï¼‰ã€ã‚’å—ä¿¡ã™ã‚‹ï¼ å¹³æ–‡ã‚’ãƒãƒƒã‚·ãƒ¥åŒ–ã—ï¼Œãƒ€ã‚¤ã‚¸ã‚§ã‚¹ãƒˆã«ã™ã‚‹ï¼ ä¸Šè¨˜ï¼’ã¤ã®ãƒ€ã‚¤ã‚¸ã‚§ã‚¹ãƒˆãŒåŒä¸€ãªã‚‰ï¼Œã€æˆã‚Šã™ã¾ã—ã€ã¨ã€æ”¹ç«„ã€ãŒè¡Œã‚ã‚Œã¦ã„ãªã„ã¨åˆ¤æ–­ ãƒ»æš—å·ãƒ€ã‚¤ã‚¸ã‚§ã‚¹ãƒˆï¼ˆãƒ‡ã‚¸ã‚¿ãƒ«ç½²åï¼‰ã®ãƒ¡ãƒªãƒƒãƒˆ 1ï¼æ”¹ç«„ã‚’é˜²ã’ã‚‹ ã‚µãƒ¼ãƒã‹ã‚‰é€ã‚‰ã‚ŒãŸã€å¹³æ–‡ã€ã¨ã€æš—å·ãƒ€ã‚¤ã‚¸ã‚§ã‚¹ãƒˆã€ã®ã©ã¡ã‚‰ã‹ãŒï¼Œé€šä¿¡ã®é€”ä¸­ã§æ”¹ç«„ã•ã‚ŒãŸå ´åˆï¼Œã“ã‚Œã‚‰ã®ãƒ€ã‚¤ã‚¸ã‚§ã‚¹ãƒˆãŒåŒã˜ã«ãªã‚‹ã“ã¨ã¯ç¢ºç‡çš„ã«ã‚ã‚Šãˆãªã„ï¼ã—ãŸãŒã£ã¦ï¼Œç¢ºã‹ã«æ”¹ç«„ã•ã‚Œã¦ã„ãªã„ã¨åˆ¤æ–­å¯èƒ½ï¼ 2ï¼æˆã‚Šã™ã¾ã—ã‚’é˜²ã’ã‚‹ ç‰¹å®šã®ç§˜å¯†éµã‚’æŒã¤ã®ã¯ï¼Œç‰¹å®šã®ã‚µãƒ¼ãƒã ã‘ï¼ã—ãŸãŒã£ã¦ï¼Œç¢ºã‹ã«ã‚µãƒ¼ãƒã«ã‚ˆã£ã¦æš—å·åŒ–ã•ã‚ŒãŸã‚‚ã®ã ã¨åˆ¤æ–­å¯èƒ½ï¼ ãƒ»æš—å·ãƒ€ã‚¤ã‚¸ã‚§ã‚¹ãƒˆï¼ˆãƒ‡ã‚¸ã‚¿ãƒ«ç½²åï¼‰ã®ãƒ‡ãƒ¡ãƒªãƒƒãƒˆ â˜…â˜…å…¬é–‹éµã®æˆã‚Šã™ã¾ã—ã‚’é˜²ãã“ã¨ãŒã§ããªã„â˜…â˜… äºŒè€…é–“ã ã‘ã®ã‚„ã‚Šå–ã‚Šã§ã¯ï¼Œã‚ã‚‰ã‹ã˜ã‚å—ä¿¡è€…ã«æ¸¡ã•ã‚Œã‚‹å…¬é–‹éµãŒå½ã®é€ä¿¡è€…ã®ã‚‚ã®ã§ã‚ã£ã¦ã‚‚ï¼Œç¢ºã‹ã‚ã‚‹è¡“ãŒãªã„ï¼ã“ã‚Œã‚’ä¿éšœã™ã‚‹ä»•çµ„ã¿ã«ï¼ŒPKIï¼ˆå…¬é–‹éµåŸºç›¤ï¼‰ãŒã‚ã‚‹ï¼ æš—å·ãƒ€ã‚¤ã‚¸ã‚§ã‚¹ãƒˆï¼ˆãƒ‡ã‚¸ã‚¿ãƒ«ç½²åï¼‰ã¨å…¬é–‹éµæš—å·æ–¹å¼ã‚’ç”¨ã„ãŸæš—å·åŒ–æŠ€è¡“ ã€æˆã‚Šã™ã¾ã—ã€ã¨ã€æ”¹ç«„ã€ã‚’é˜²ã’ã‚‹ãƒ‡ã‚¸ã‚¿ãƒ«ç½²åã«ï¼Œã€ç›—è´ã€ã‚’é˜²ã’ã‚‹å…¬é–‹éµæš—å·æ–¹å¼ã‚’çµ„ã¿è¾¼ã‚“ã æš—å·åŒ–æŠ€è¡“ï¼ ãƒãƒƒã‚·ãƒ¥é–¢æ•°ã«ã‚ˆã‚‹ãƒãƒƒã‚·ãƒ¥åŒ– ä½•ã‹ã®ãƒ‡ãƒ¼ã‚¿ã‚’å…¥åŠ›ã™ã‚‹ã¨ï¼Œè¦å‰‡æ€§ã®ãªã„ä¸€å®šã®æ¡æ•°ã®å€¤ã‚’å‡ºåŠ›ã™ã‚‹æ¼”ç®—æ‰‹æ³•ï¼ PKIï¼šPublic Key Infrastructureï¼ˆå…¬é–‹éµåŸºç›¤ï¼‰ã«ã‚ˆã‚‹å…¬é–‹éµã®æ¤œè¨¼ ãƒ»ãƒ‰ãƒ¡ã‚¤ãƒ³ã®æ­£å½“æ€§ã®æ¤œè¨¼ ç§˜å¯†éµã¨ãƒ‡ã‚¸ã‚¿ãƒ«è¨¼æ˜æ›¸ã¯ãƒ‰ãƒ¡ã‚¤ãƒ³ã®æ­£å½“æ€§ï¼ˆå½ã‚µã‚¤ãƒˆã§ã¯ãªã„ã“ã¨ï¼‰ã‚’æ‹…ä¿ã™ã‚‹ã‚‚ã®ã§ã‚ã‚‹ï¼ãƒ‡ã‚¸ã‚¿ãƒ«ç½²åã«ç”¨ã„ãŸç§˜å¯†éµã«å¯¾å¿œã™ã‚‹å…¬é–‹éµã¯ï¼Œæˆã‚Šã™ã¾ã—ãŸäººç‰©ã«ã‚ˆã‚‹å½ã®å…¬é–‹éµã§ã‚ã‚‹å¯èƒ½æ€§ãŒã‚ã‚‹ï¼ç¬¬ä¸‰è€…æ©Ÿé–¢ã®èªè¨¼å±€ã«ã‚ˆã£ã¦ï¼Œå…¬é–‹éµã‚’æ¤œè¨¼ã™ã‚‹ã‚¤ãƒ³ãƒ•ãƒ©ã®ã“ã¨ã‚’ï¼Œå…¬é–‹éµåŸºç›¤ã¨ã„ã†ï¼ ãƒ»å…¬é–‹éµã®æ¤œè¨¼ã®ä»•çµ„ã¿ å¤šãã®å ´åˆï¼Œã‚µãƒ¼ãƒã®æä¾›ä¼šç¤¾ãŒä¸­é–“èªè¨¼å±€ã‚’ã‚‚ã£ã¦ã„ã‚‹ï¼ä¸­é–“èªè¨¼å±€ã¨ãƒ«ãƒ¼ãƒˆèªè¨¼å±€ã®é–¢ä¿‚ã«ã¤ã„ã¦ã¯ï¼Œèªè¨¼å±€ãã®ã‚‚ã®ã®ãªã‚Šã™ã¾ã—ã®é˜²æ­¢ç­–ã‚’å‚ç…§ï¼ ï¼Šä¾‹ï¼Š ã‚µãƒ¼ãƒæä¾›è€… è‡ªç¤¾ã®ä¸­é–“èªè¨¼å±€å ãƒ«ãƒ¼ãƒˆèªè¨¼å±€å AWS Amazon Trust Services Starfieldç¤¾ GCP Google Trust Services ï¼Šã‚µãƒ¼ãƒãŒè¡Œã†ã“ã¨ï¼Š ã‚µãƒ¼ãƒã¯ï¼Œå…¬é–‹éµã¨ç§˜å¯†éµã‚’ä½œã‚Šï¼Œèªè¨¼å±€ã«å…¬é–‹éµã¨ãƒ‡ã‚¸ã‚¿ãƒ«ç½²åã‚’æå‡ºï¼ èªè¨¼å±€ã‹ã‚‰ï¼Œæš—å·ãƒ€ã‚¤ã‚¸ã‚§ã‚¹ãƒˆï¼ˆãƒ‡ã‚¸ã‚¿ãƒ«ç½²åï¼‰ã‚’å«ã‚€ãƒ‡ã‚¸ã‚¿ãƒ«è¨¼æ˜æ›¸ï¼ˆS/MIMEè¨¼æ˜æ›¸ï¼ŒSSLã‚µãƒ¼ãƒè¨¼æ˜æ›¸ï¼‰ã‚’ç™ºè¡Œã—ã¦ã‚‚ã‚‰ã†ï¼ãƒ‡ã‚¸ã‚¿ãƒ«è¨¼æ˜æ›¸ãŒï¼Œå…¬é–‹éµã®æœ¬äººè¨¼æ˜ã«ãªã‚‹ï¼ãƒ‡ã‚¸ã‚¿ãƒ«è¨¼æ˜æ›¸ã¯ï¼ŒS/MIMEã§ç”¨ã„ã‚‹å ´åˆã«ã¯ï¼Œã€S/MIMEè¨¼æ˜æ›¸ã€ï¼ŒSSL/TLSã§ç”¨ã„ã‚‹å ´åˆã«ã¯ï¼Œã€SSLã‚µãƒ¼ãƒè¨¼æ˜æ›¸ã€ã¨ã„ã†ï¼ å—ä¿¡è€…ï¼ˆã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆï¼‰ã«ãƒ¡ãƒ¼ãƒ«ï¼Œæš—å·ãƒ€ã‚¤ã‚¸ã‚§ã‚¹ãƒˆï¼ˆãƒ‡ã‚¸ã‚¿ãƒ«ç½²åï¼‰ã‚’å«ã‚€ãƒ‡ã‚¸ã‚¿ãƒ«è¨¼æ˜æ›¸ã‚’é€ä¿¡ï¼ ï¼Šå—ä¿¡è€…ï¼ˆã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆï¼‰ãŒè¡Œã†ã“ã¨ï¼Š å—ä¿¡è€…ï¼ˆã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆï¼‰ã¯ï¼Œæš—å·ãƒ€ã‚¤ã‚¸ã‚§ã‚¹ãƒˆï¼ˆãƒ‡ã‚¸ã‚¿ãƒ«ç½²åï¼‰ã‚’å«ã‚€ãƒ‡ã‚¸ã‚¿ãƒ«è¨¼æ˜æ›¸ï¼ˆS/MIMEè¨¼æ˜æ›¸ï¼ŒSSLã‚µãƒ¼ãƒè¨¼æ˜æ›¸ï¼‰ã‚’å—ä¿¡ï¼ èªè¨¼å±€ã‹ã‚‰ã‚‚ã‚‰ã£ãŸå…¬é–‹éµã‚’ç”¨ã„ã¦ï¼Œãƒ‡ã‚¸ã‚¿ãƒ«è¨¼æ˜æ›¸ã®æš—å·ãƒ€ã‚¤ã‚¸ã‚§ã‚¹ãƒˆï¼ˆãƒ‡ã‚¸ã‚¿ãƒ«ç½²åï¼‰éƒ¨åˆ†ã‚’å¾©å·ã—ï¼Œãƒãƒƒã‚·ãƒ¥å€¤ãŒåŒã˜ãªã‚‰ï¼Œèªè¨¼å±€ãã®ã‚‚ã®ãŒæˆã‚Šã™ã¾ã—ã§ãªã„ã¨åˆ¤æ–­ã™ã‚‹ï¼ ãƒ»èªè¨¼å±€ãã®ã‚‚ã®ã®æˆã‚Šã™ã¾ã—ã®é˜²æ­¢ç­– ãƒ‡ã‚¸ã‚¿ãƒ«è¨¼æ˜æ›¸ï¼ˆS/MIMEè¨¼æ˜æ›¸ï¼ŒSSLã‚µãƒ¼ãƒè¨¼æ˜æ›¸ï¼‰ã‚’ç™ºè¡Œã™ã‚‹èªè¨¼å±€ãã®ã‚‚ã®ãŒï¼Œæˆã‚Šã™ã¾ã—ã®å¯èƒ½æ€§ãŒã‚ã‚‹ï¼ãã“ã§ï¼Œèªè¨¼å±€ã‚’ãƒ©ãƒ³ã‚¯ä»˜ã‘ã—ï¼Œãƒ«ãƒ¼ãƒˆèªè¨¼å±€ãŒä¸‹ä½ãƒ©ãƒ³ã‚¯ã®èªè¨¼å±€ã«æ¨©é™ã‚’ä¸ãˆã‚‹ã“ã¨ã§ï¼Œä¸‹ä½ã®èªè¨¼å±€ã®ä¿¡é ¼æ€§ã‚’æŒãŸã›ã¦ã„ã‚‹ï¼ãªãŠï¼Œãƒ«ãƒ¼ãƒˆèªè¨¼å±€ã¯å°‚é–€æ©Ÿé–¢ã‹ã‚‰å³ã—ã„å¯©æŸ»ã‚’å—ã‘ã¦ã„ã‚‹ãŸã‚ï¼Œãƒ«ãƒ¼ãƒˆèªè¨¼å±€è‡ªä½“ãŒãªã‚Šã™ã¾ã—ã§ã‚ã‚‹å¯èƒ½æ€§ã¯éå¸¸ã«ä½ã„ï¼ 02-06. ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯å±¤ã«ãŠã‘ã‚‹ãƒ˜ãƒƒãƒ€æƒ…å ±ã®æš—å·åŒ–æŠ€è¡“ IPsecï¼šInternet Protocol Security ãƒ»IPSecã¨ã¯ å…±é€šéµæš—å·æ–¹å¼ã«åŸºã¥ãã‚»ã‚­ãƒ¥ã‚¢ãƒ—ãƒ­ãƒˆã‚³ãƒ«ï¼ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯å±¤ã§ï¼Œãƒ‘ã‚±ãƒƒãƒˆã®ãƒ˜ãƒƒãƒ€æƒ…å ±ã®æš—å·åŒ–ã‚’æ‹…ã†ï¼ä¾‹ãˆã°ï¼Œãƒªãƒ¢ãƒ¼ãƒˆãƒ¯ãƒ¼ã‚¯æ™‚ã«ï¼Œè‡ªå®…PCã¨ä¼šç¤¾ã®ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚’VPNæ¥ç¶šã™ã‚‹ãŸã‚ã«ç”¨ã„ã‚‰ã‚Œã‚‹ï¼VPNæ¥ç¶šã•ã‚Œã‚‹ã¨ï¼Œè‡ªå®…PCã‹ã‚‰ã®TCPãƒ—ãƒ­ãƒˆã‚³ãƒ«ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆãŒä¼šç¤¾ã®ãƒ«ãƒ¼ã‚¿ãƒ¼ã‚’é€šéã™ã‚‹ãŸã‚ï¼Œé€ä¿¡å…ƒIPã‚¢ãƒ‰ãƒ¬ã‚¹ãŒä¼šç¤¾ã®ã‚‚ã®ã«ã‹ã‚ã‚‹ï¼ç›—è´ã‚’é˜²ã’ã‚‹ï¼ ãƒ»IPsecã«ã‚ˆã‚‹ãƒ‘ã‚±ãƒƒãƒˆã®ã‚«ãƒ—ã‚»ãƒ«åŒ– VPNï¼šVirtual Private Networkï¼ˆä»®æƒ³ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ï¼‰ ãƒ»VPNã¨ã¯ ç•°ãªã‚‹ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯é–“ã§å®‰å…¨ãªé€šä¿¡ã‚’è¡Œã†ãŸã‚ã®ä»•çµ„ã¿ï¼ä½¿ç”¨ã•ã‚Œã¦ã„ã‚‹ã‚»ã‚­ãƒ¥ã‚¢ãƒ—ãƒ­ãƒˆã‚³ãƒ«ã«åŸºã¥ã„ã¦ï¼Œã€PPTP-VPNã€ï¼Œã€SSL/TLS-VPNã€ï¼Œã€IPsec-VPNã€ãŒã‚ã‚‹ï¼ ãƒ»PPTP-VPNã®ä¾‹ ã€PPTPã€ ãƒ»SSL/TLS-VPNã®ä¾‹ ã€OpenVPNã€ ãƒ»IPsec-VPNã®ä¾‹ ã€L2TP/IPSecã€ 03. ãã®ä»–ã®ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£æŠ€è¡“ ãƒ¡ãƒ¼ãƒ«å—ä¿¡ã«ãŠã‘ã‚‹ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ ãƒ»OP25Bï¼ˆOutbound Port 25 Blockingï¼‰ ãƒ»SPFï¼ˆSender Policy Frameworkï¼‰ ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã®ä¿å­˜æ–¹æ³• å¹³æ–‡ã§ä¿å­˜ã—ã¦ãŠãã¨ï¼Œæµå‡ºã—ãŸæ™‚ã«å‹æ‰‹ã«ä½¿ç”¨ã•ã‚Œã¦ã—ã¾ã†ãŸã‚ï¼Œãƒãƒƒã‚·ãƒ¥å€¤ã§ä¿å­˜ã™ã‚‹ã¹ãã§ã‚ã‚‹ï¼ ç”Ÿä½“èªè¨¼ Web beacon webãƒšãƒ¼ã‚¸ã«ï¼Œã‚µãƒ¼ãƒã«å¯¾ã—ã¦HTTPãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é€ä¿¡ã™ã‚‹ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã‚’è¨­ç½®ã—ï¼Œé€ä¿¡ã•ã‚ŒãŸãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é›†è¨ˆã™ã‚‹ã‚¢ã‚¯ã‚»ã‚¹è§£ææ–¹æ³•ï¼ä¾‹ãˆã°ï¼Œ1x1ã®å°ã•ãªGifã€Œç”»åƒã€ãªã©ã‚’è¨­ç½®ã™ã‚‹ï¼ Penetration ãƒ†ã‚¹ãƒˆ æ—¢çŸ¥ã®ã‚µã‚¤ãƒãƒ¼æ”»æ’ƒã‚’æ„å›³çš„ã«è¡Œã„ï¼Œã‚·ã‚¹ãƒ†ãƒ ã®è„†å¼±æ€§ã‚’ç¢ºèªã™ã‚‹ãƒ†ã‚¹ãƒˆã®ã“ã¨ï¼ ï¼Šä¾‹ï¼Š æ ªå¼ä¼šç¤¾LACã«ã‚ˆã‚‹Penetration ãƒ†ã‚¹ãƒˆã‚µãƒ¼ãƒ“ã‚¹ "},"public/cloud_computing/cloud_computing.html":{"url":"public/cloud_computing/cloud_computing.html","title":"ğŸ“– ï¸ã‚¯ãƒ©ã‚¦ãƒ‰ã‚³ãƒ³ãƒ”ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°","keywords":"","body":"ã‚¯ãƒ©ã‚¦ãƒ‰ã‚³ãƒ³ãƒ”ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚° ã¯ã˜ã‚ã« æœ¬ã‚µã‚¤ãƒˆã«ã¤ãã¾ã—ã¦ï¼Œä»¥ä¸‹ã‚’ã”èªè­˜ã®ã»ã©å®œã—ããŠé¡˜ã„ã„ãŸã—ã¾ã™ï¼ å‚è€ƒï¼šhttps://hiroki-it.github.io/tech-notebook-gitbook/ 01. ã‚ªãƒ³ãƒ—ãƒ¬ãƒŸã‚¹ã¨ã‚¯ãƒ©ã‚¦ãƒ‰ã‚³ãƒ³ãƒ”ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã®ç¨®é¡ ã‚ªãƒ³ãƒ—ãƒ¬ãƒŸã‚¹ã¨ã¯ ãƒ™ãƒ³ãƒ€ãƒ¼ã¯é–¢ã‚ã‚‰ãšï¼Œãƒ¦ãƒ¼ã‚¶ã®è¨­å‚™ã«ã‚ˆã£ã¦ï¼Œã‚·ã‚¹ãƒ†ãƒ ã‚’é‹ç”¨ã™ã‚‹ã“ã¨ï¼ ã‚¯ãƒ©ã‚¦ãƒ‰ã‚³ãƒ³ãƒ”ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã¨ã¯ ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆã‚’çµŒç”±ã—ã¦ï¼Œãƒ™ãƒ³ãƒ€ãƒ¼ã®ã‚µãƒ¼ãƒã«è‡ªèº«ã®ãƒ‡ãƒ¼ã‚¿ã‚’ä¿å­˜ã—ï¼Œåˆ©ç”¨ã™ã‚‹ã“ã¨ï¼ãƒ™ãƒ³ãƒ€ãƒ¼ãŒï¼Œã‚·ã‚¹ãƒ†ãƒ ã‚’ç¨¼åƒã•ã›ã‚‹ãŸã‚ã«å¿…è¦ãªã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ã¨ãƒãƒ¼ãƒ‰ã‚¦ã‚§ã‚¢ã‚’ã©ã“ã¾ã§æä¾›ã™ã‚‹ã‹ã«ã‚ˆã£ã¦ï¼Œã‚µãƒ¼ãƒ“ã‚¹ã®åç§°ãŒç•°ãªã‚‹ï¼ 02. ã‚ªãƒ³ãƒ—ãƒ¬ãƒŸã‚¹ 03. ã‚¯ãƒ©ã‚¦ãƒ‰ã‚³ãƒ³ãƒ”ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚° IaaSï¼šInfrastructure as a Service ï¼Šä¾‹ï¼Š ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å æä¾› Amazon Web Service Amazon Google Cloud Platform Google Microsoft Azure Microsoft IBM Cloud IBM PaaSï¼šPlatform as a Service ï¼Šä¾‹ï¼Š ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å æä¾› Google App Engine Google Windows Azure Microsoft GitHub Pages GitHub FaaSï¼šPlatform as a Service ãƒ¦ãƒ¼ã‚¶å´ã¯é–¢æ•°ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã®å®Ÿè£…ã®ã¿ã‚’è¡Œã„ï¼Œãã‚Œä»¥å¤–ã¯ãƒ™ãƒ³ãƒ€ãƒ¼å´ã«ç®¡ç†ã—ã¦ã‚‚ã‚‰ã†ã‚µãƒ¼ãƒ“ã‚¹ã®ã“ã¨ï¼ ï¼Šä¾‹ï¼Š Lambda SaaSï¼šSoftware as a Service å¾“æ¥ã¯ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã¨ã—ã¦æä¾›ã—ã¦ã„ãŸã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ï¼ŒWebã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã¨ã—ã¦æä¾›ã™ã‚‹ã‚µãƒ¼ãƒ“ã‚¹ã®ã“ã¨ï¼ ï¼Šä¾‹ï¼Š Google Appsï¼ˆGoogle Mapï¼ŒGoogle Cloudï¼ŒGoogle Calender ãªã©ï¼‰ "},"public/cloud_computing/cloud_computing_aws.html":{"url":"public/cloud_computing/cloud_computing_aws.html","title":"ğŸ“– ï¸AWS","keywords":"","body":"AWSï¼šAmazon Web Service ã¯ã˜ã‚ã« æœ¬ã‚µã‚¤ãƒˆã«ã¤ãã¾ã—ã¦ï¼Œä»¥ä¸‹ã‚’ã”èªè­˜ã®ã»ã©å®œã—ããŠé¡˜ã„ã„ãŸã—ã¾ã™ï¼ https://hiroki-it.github.io/tech-notebook-gitbook/ 01. ALBï¼šApplication Load Balancing ALBã¨ã¯ ã‚¯ãƒ©ã‚¦ãƒ‰ãƒªãƒãƒ¼ã‚¹ãƒ—ãƒ­ã‚­ã‚·ã‚µãƒ¼ãƒï¼Œã‹ã¤ã‚¯ãƒ©ã‚¦ãƒ‰ãƒ­ãƒ¼ãƒ‰ãƒãƒ©ãƒ³ã‚µãƒ¼ã¨ã—ã¦åƒãï¼ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’ä»£ç†ã§å—ä¿¡ã—ï¼Œã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹ã‚’ãƒãƒ©ãƒ³ã‚¹ã‚ˆãåˆ†é…ã™ã‚‹ã“ã¨ã«ã‚ˆã£ã¦ï¼Œã‚µãƒ¼ãƒã¸ã®è² è·ã‚’ç·©å’Œã™ã‚‹ï¼ è¨­å®šé …ç›® ãƒ»æ¦‚è¦ è¨­å®šé …ç›® èª¬æ˜ è£œè¶³ ãƒªã‚¹ãƒŠãƒ¼ ALBã«å‰²ã‚ŠæŒ¯ã‚‹ãƒãƒ¼ãƒˆç•ªå·ãŠï¼Œå—ä¿¡ã™ã‚‹ãƒ—ãƒ­ãƒˆã‚³ãƒ«ã‚’è¨­å®šã™ã‚‹ï¼ãƒªãƒãƒ¼ã‚¹ãƒ—ãƒ­ã‚­ã‚·ã‹ã¤ãƒ­ãƒ¼ãƒ‰ãƒãƒ©ãƒ³ã‚µï¼ã¨ã—ã¦ï¼Œã“ã‚Œã‚‰ã®é€šä¿¡ã‚’ã‚¿ãƒ¼ã‚²ãƒƒãƒˆã‚°ãƒ«ãƒ¼ãƒ—ã«ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã™ã‚‹ï¼ ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒãƒªã‚·ãƒ¼ ãƒªã‚¯ã‚¨ã‚¹ãƒˆã®é€ä¿¡è€…ãŒä½¿ç”¨ã™ã‚‹SSL/TLSãƒ—ãƒ­ãƒˆã‚³ãƒ«ã‚„æš—å·åŒ–æ–¹å¼ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã«åˆã‚ã›ã¦ï¼ŒALBãŒå—ä¿¡ã§ãã‚‹ã“ã‚Œã‚‰ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’è¨­å®šã™ã‚‹ï¼ ãƒ»ãƒªã‚¯ã‚¨ã‚¹ãƒˆã®é€ä¿¡è€…ã«ã¯ï¼Œãƒ–ãƒ©ã‚¦ã‚¶ï¼ŒAPIã«ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é€ä¿¡ã™ã‚‹å¤–éƒ¨ã‚µãƒ¼ãƒ“ã‚¹ï¼Œè»¢é€å…ƒã®AWSãƒªã‚½ãƒ¼ã‚¹ï¼ˆCloudFrontãªã©ï¼‰ï¼Œãªã©ã‚’å«ã‚€ï¼ãƒ»å‚è€ƒï¼šhttps://docs.aws.amazon.com/ja_jp/elasticloadbalancing/latest/application/create-https-listener.html#describe-ssl-policies ãƒ«ãƒ¼ãƒ« ãƒªã‚¯ã‚¨ã‚¹ãƒˆã®ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã®ãƒ­ã‚¸ãƒƒã‚¯ã‚’è¨­å®šã™ã‚‹ï¼ ã‚¿ãƒ¼ã‚²ãƒƒãƒˆã‚°ãƒ«ãƒ¼ãƒ— ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°æ™‚ã«ä½¿ç”¨ã™ã‚‹ãƒ—ãƒ­ãƒˆã‚³ãƒ«ã¨ï¼Œãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°å…ˆã®ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã«å‰²ã‚Šå½“ã¦ã‚‰ã‚ŒãŸãƒãƒ¼ãƒˆç•ªå·ã‚’æŒ‡å®šã™ã‚‹ï¼ ã‚¿ãƒ¼ã‚²ãƒƒãƒˆã‚°ãƒ«ãƒ¼ãƒ—å†…ã®ã‚¿ãƒ¼ã‚²ãƒƒãƒˆã®ã†ã¡ï¼Œãƒˆãƒ©ãƒ•ã‚£ãƒƒã‚¯ã¯ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯ãŒOKã«ãªã£ã¦ã„ã‚‹ã‚¿ãƒ¼ã‚²ãƒƒãƒˆã«ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã•ã‚Œã‚‹ï¼ ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯ ã‚¿ãƒ¼ã‚²ãƒƒãƒˆã‚°ãƒ«ãƒ¼ãƒ—ã«å±ã™ã‚‹ãƒ—ãƒ­ãƒˆã‚³ãƒ«ã¨ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ãƒãƒ¼ãƒˆç•ªå·ã‚’æŒ‡å®šã—ã¦ï¼Œå®šæœŸçš„ã«ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é€ä¿¡ã™ã‚‹ï¼ ãƒ»ã‚¿ãƒ¼ã‚²ãƒƒãƒˆã‚°ãƒ«ãƒ¼ãƒ— ã‚¿ãƒ¼ã‚²ãƒƒãƒˆã®æŒ‡å®šæ–¹æ³• è£œè¶³ ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ ã‚¿ãƒ¼ã‚²ãƒƒãƒˆãŒï¼ŒEC2ã§ãªã‘ã‚Œã°ãªã‚‰ãªã„ï¼ IPã‚¢ãƒ‰ãƒ¬ã‚¹ ã‚¿ãƒ¼ã‚²ãƒƒãƒˆã®ãƒ‘ãƒ–ãƒªãƒƒã‚¯IPã‚¢ãƒ‰ãƒ¬ã‚¹ãŒï¼Œé™çš„ã§ãªã‘ã‚Œã°ãªã‚‰ãªã„ï¼ Lambda ã‚¿ãƒ¼ã‚²ãƒƒãƒˆãŒï¼ŒLambdaã§ãªã‘ã‚Œã°ãªã‚‰ãªã„ï¼ ãƒ«ãƒ¼ãƒ« ãƒ»ãƒ«ãƒ¼ãƒ«ã®è¨­å®šä¾‹ ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹ ãƒãƒ¼ãƒˆ IF THEN ãƒªã‚¯ã‚¨ã‚¹ãƒˆãŒãƒãƒ¼ãƒˆ80ã‚’æŒ‡å®šã—ãŸæ™‚ã«ï¼Œ443ã«ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆã—ãŸã„ï¼ 80 ãã‚Œä»¥å¤–ã®å ´åˆã¯ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã•ã‚Œãªã„ãƒªã‚¯ã‚¨ã‚¹ãƒˆ ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆå…ˆï¼šhttps://#{host}:443/#{path}?#{query}ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚³ãƒ¼ãƒ‰ï¼šHTTP_301 ãƒªã‚¯ã‚¨ã‚¹ãƒˆãŒãƒãƒ¼ãƒˆ443ã‚’æŒ‡å®šã—ãŸæ™‚ã«ï¼Œã‚¿ãƒ¼ã‚²ãƒƒãƒˆã‚°ãƒ«ãƒ¼ãƒ—ã«è»¢é€ã—ãŸã„ï¼ 443 ãã‚Œä»¥å¤–ã®å ´åˆã¯ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã•ã‚Œãªã„ãƒªã‚¯ã‚¨ã‚¹ãƒˆ ç‰¹å®šã®ã‚¿ãƒ¼ã‚²ãƒƒãƒˆã‚°ãƒ«ãƒ¼ãƒ— Webã‚µãƒ¼ãƒï¼Œã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã«ãŠã‘ã‚‹å¯¾å¿œ ãƒ»å•é¡Œ ALBã‹ã‚‰EC2ã¸ã®ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã‚’HTTPãƒ—ãƒ­ãƒˆã‚³ãƒ«ã¨ã—ãŸå ´åˆï¼Œã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å´ã§ï¼ŒHTTPSãƒ—ãƒ­ãƒˆã‚³ãƒ«ã‚’ç”¨ã„ãŸå‡¦ç†ãŒã§ããªããªã‚‹ï¼ãã“ã§ï¼Œã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‹ã‚‰ALBã«å¯¾ã™ã‚‹ãƒªã‚¯ã‚¨ã‚¹ãƒˆã®ãƒ—ãƒ­ãƒˆã‚³ãƒ«ãŒHTTPSã ã£ãŸå ´åˆï¼ŒWebã‚µãƒ¼ãƒã¾ãŸã¯ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã«ãŠã„ã¦ï¼Œãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã®ãƒ—ãƒ­ãƒˆã‚³ãƒ«ã‚’HTTPSã¨è¦‹ãªã™ã‚ˆã†ã«å¯¾å‡¦ã™ã‚‹ï¼ ãƒ»Webã‚µãƒ¼ãƒã«ãŠã‘ã‚‹å¯¾å‡¦æ–¹æ³• ALBã‚’çµŒç”±ã—ãŸãƒªã‚¯ã‚¨ã‚¹ãƒˆã®å ´åˆï¼Œãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒ˜ãƒƒãƒ€ãƒ¼ã«X-Forwarded-Protoãƒ˜ãƒƒãƒ€ãƒ¼ãŒä»˜ä¸ã•ã‚Œã‚‹ï¼ã“ã‚Œã«ã¯ï¼ŒALBã«å¯¾ã™ã‚‹ãƒªã‚¯ã‚¨ã‚¹ãƒˆã®ãƒ—ãƒ­ãƒˆã‚³ãƒ«ã®ç¨®é¡ãŒï¼Œæ–‡å­—åˆ—ã§ä»£å…¥ã•ã‚Œã¦ã„ã‚‹ï¼ã“ã‚ŒãŒã€HTTPSã€ã ã£ãŸå ´åˆï¼ŒWebã‚µãƒ¼ãƒã¸ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’HTTPSã§ã‚ã‚‹ã¨ã¿ãªã™ã‚ˆã†ã«å¯¾å‡¦ã™ã‚‹ï¼ã“ã‚Œã«ã‚ˆã‚Šï¼Œã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã¸ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆã®ãƒ—ãƒ­ãƒˆã‚³ãƒ«ãŒHTTPSã¨ãªã‚‹ï¼ˆã“ã¡ã‚‰ã‚’è¡Œã£ãŸå ´åˆã¯ï¼Œä»¥é™ã®ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å´ã®å¯¾å¿œä¸è¦ï¼‰ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š SetEnvIf X-Forwarded-Proto https HTTPS=on ãƒ»ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã«ãŠã‘ã‚‹å¯¾å‡¦æ–¹æ³• ALBã‚’çµŒç”±ã—ãŸãƒªã‚¯ã‚¨ã‚¹ãƒˆã®å ´åˆï¼Œãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒ˜ãƒƒãƒ€ãƒ¼ã«HTTP_X_FORWARDED_PROTOãƒ˜ãƒƒãƒ€ãƒ¼ãŒä»˜ä¸ã•ã‚Œã‚‹ï¼ã“ã‚Œã«ã¯ï¼ŒALBã«å¯¾ã™ã‚‹ãƒªã‚¯ã‚¨ã‚¹ãƒˆã®ãƒ—ãƒ­ãƒˆã‚³ãƒ«ã®ç¨®é¡ãŒï¼æ–‡å­—åˆ—ã§ä»£å…¥ã•ã‚Œã¦ã„ã‚‹ï¼ã“ã‚ŒãŒã€HTTPSã€ã ã£ãŸå ´åˆï¼Œã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã¸ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’HTTPSã§ã‚ã‚‹ã¨ã¿ãªã™ã‚ˆã†ã«ï¼Œindex.phpã«è¿½åŠ å®Ÿè£…ã‚’è¡Œã†ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š ãã®ä»–ã®ç•™æ„äº‹é … ãƒ»å‰²ã‚Šå½“ã¦ã‚‰ã‚Œã‚‹ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆIPã‚¢ãƒ‰ãƒ¬ã‚¹ç¯„å›² ALBã«å‰²ã‚Šå½“ã¦ã‚‰ã‚Œã‚‹IPã‚¢ãƒ‰ãƒ¬ã‚¹ç¯„å›²ã«ã¯ï¼ŒVPCã®ã‚‚ã®ãŒé©ç”¨ã•ã‚Œã‚‹ï¼ãã®ãŸã‚ï¼ŒEC2ã®Security Groupã§ã¯ï¼ŒVPCã®IPã‚¢ãƒ‰ãƒ¬ã‚¹ç¯„å›²ã‚’è¨±å¯ã™ã‚‹ã‚ˆã†ã«è¨­å®šã™ã‚‹å¿…è¦ãŒã‚ã‚‹ï¼ ãƒ»ALBã®ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚°ãƒ«ãƒ¼ãƒ— Route53ã‹ã‚‰è»¢é€ã•ã‚Œã‚‹ãƒ‘ãƒ–ãƒªãƒƒã‚¯IPã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’å—ä¿¡ã§ãã‚‹ã‚ˆã†ã«ã—ã¦ãŠãå¿…è¦ãŒã‚ã‚‹ï¼ãƒ‘ãƒ–ãƒªãƒƒã‚¯ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã«å…¬é–‹ã™ã‚‹Webã‚µã‚¤ãƒˆã§ã‚ã‚Œã°ï¼ŒIPã‚¢ãƒ‰ãƒ¬ã‚¹ã¯å…¨ã¦ã®ç¯„å›²ï¼ˆ0.0.0.0/0ã¨::/0ï¼‰ã«ã™ã‚‹ï¼ç¤¾å†…å‘ã‘ã®Webã‚µã‚¤ãƒˆã§ã‚ã‚Œã°ï¼Œç¤¾å†…ã®ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆIPã‚¢ãƒ‰ãƒ¬ã‚¹ã®ã¿ï¼ˆn.n.n.n/32ï¼‰ã‚’è¨±å¯ã™ã‚‹ã‚ˆã†ã«ã™ã‚‹ï¼ 02. Amplify Amplifyã¨ã¯ ã‚µãƒ¼ãƒãƒ¬ã‚¹ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’æ§‹ç¯‰ã™ã‚‹ãŸã‚ã®ã‚¯ãƒ©ã‚¦ãƒ‰ã‚¤ãƒ³ãƒ•ãƒ©ã‚¹ãƒˆãƒ©ã‚¯ãƒãƒ£ã®ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ï¼SSGã®å ´åˆï¼Œé™çš„ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ‡ãƒ—ãƒ­ã‚¤ã—ã•ãˆã™ã‚Œã°ï¼Œã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã¨ã—ã¦ã®è¦ä»¶ãŒå…¨ã¦æ•´ã†ï¼SPAã®å ´åˆï¼Œã‚µãƒ¼ãƒãƒ¬ã‚¹ã®ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã‚’è‡ªå‹•æ§‹ç¯‰ã—ã¦ãã‚Œï¼Œãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã‚’ãƒ‡ãƒ—ãƒ­ã‚¤ã—ã•ãˆã™ã‚Œã°ï¼Œè¦ä»¶ãŒå…¨ã¦æ•´ã†ï¼ã“ã‚Œã®AWSãƒªã‚½ãƒ¼ã‚¹ã¯CloudFormationã«ã‚ˆã£ã¦æ§‹ç¯‰ã•ã‚Œã‚‹ãŒï¼ŒAmplifyçµŒç”±ã§ã—ã‹è¨­å®šã‚’å¤‰æ›´ã§ããšï¼Œå„AWSãƒªãƒªãƒ¼ã‚¹ã®ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ç”»é¢ã‚’è¦‹ã¦ã‚‚ï¼Œéè¡¨ç¤ºã«ãªã£ã¦ã„ã‚‹ï¼ãŸã ã—ï¼ŒRoute53ã®è¨­å®šã¯è¡¨ç¤ºã•ã‚Œã¦ãŠã‚Šï¼ŒAmplifyãŒè¿½åŠ ã—ãŸãƒ¬ã‚³ãƒ¼ãƒ‰ã‚’ãƒ¦ãƒ¼ã‚¶ãŒç·¨é›†ã§ãã‚‹ã‚ˆã†ã«ãªã£ã¦ã„ã‚‹ï¼ å‚è€ƒï¼šhttps://d1.awsstatic.com/webinars/jp/pdf/services/20200520_AWSBlackBelt_Amplify_A.pdf å½¹å‰² ä½¿ç”¨ã•ã‚Œã¦ã„ã‚‹AWSãƒªã‚½ãƒ¼ã‚¹ èªè¨¼ Gognito é™çš„ã‚µã‚¤ãƒˆãƒ›ã‚¹ãƒ†ã‚£ãƒ³ã‚° CloudFrontï¼ŒS3 API API Gatewayï¼ŒAppSync GraphQL ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ãƒ­ã‚¸ãƒƒã‚¯ Lambda DB DynamoDB ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ S3 å…¨æ–‡æ¤œç´¢ Elastic Search ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ é€šçŸ¥ AppSyncï¼ŒIoT Core è¨­å®šé …ç›® é …ç›® èª¬æ˜ è£œè¶³ æœ¬ç•ªç¨¼åƒãƒ–ãƒ©ãƒ³ãƒ åŸºç‚¹ãƒ–ãƒ©ãƒ³ãƒã‚’è¨­å®šã™ã‚‹ï¼ Amplifyã‚’æœ¬ç•ªé‹ç”¨ã—ãªã„å ´åˆã¯ï¼Œdevelopãƒ–ãƒ©ãƒ³ãƒã‚’è¨­å®šã™ã‚Œã°ã‚ˆã„ï¼ Branch autodetection ãƒ–ãƒ©ãƒ³ãƒã®è‡ªå‹•æ¤œå‡ºã‚’æœ‰åŠ¹åŒ–ã™ã‚‹ï¼ ãƒ¯ã‚¤ãƒ«ãƒ‰ã‚«ãƒ¼ãƒ‰ã‚’çµ„ã¿è¾¼ã‚€å ´åˆï¼Œã‚¢ã‚¹ã‚¿ãƒªã‚¹ã‚¯ã‚’äºŒã¤å‰²ã‚Šå½“ã¦ãªã„ã¨ï¼Œãƒ–ãƒ©ãƒ³ãƒãŒæ¤œçŸ¥ã•ã‚Œãªã„ã“ã¨ãŒã‚ã‚‹ï¼ æ‰‹å‹•ãƒ“ãƒ«ãƒ‰ï¼†ãƒ‡ãƒ—ãƒ­ã‚¤ ãƒ»é–‹ç™ºç’°å¢ƒã§æ“¬ä¼¼å†ç¾ ã‚µãƒ¼ãƒãƒ¬ã‚¹ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’é–‹ç™ºç’°å¢ƒã§å†ç¾ã™ã‚‹ï¼ $ amplify mock api ãƒ»é–‹ç™ºç’°å¢ƒã‹ã‚‰ç›´æ¥ãƒ“ãƒ«ãƒ‰&ãƒ‡ãƒ—ãƒ­ã‚¤ é–‹ç™ºï¼ã‚¹ãƒ†ãƒ¼ã‚¸ãƒ³ã‚°ï¼æœ¬ç•ªç’°å¢ƒã«åˆ‡ã‚Šæ›¿ãˆã‚‹å¿…è¦ãŒã‚ã‚‹ï¼ # ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®è¨­å®š $ amplify add hosting # ãƒ“ãƒ«ãƒ‰&ãƒ‡ãƒ—ãƒ­ã‚¤ $ amplify publish è‡ªå‹•ãƒ“ãƒ«ãƒ‰&ãƒ‡ãƒ—ãƒ­ã‚¤ ãƒ»é€£æºå¯èƒ½ãªãƒãƒ¼ã‚¸ãƒ§ãƒ³ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ  å‚è€ƒï¼šhttps://docs.aws.amazon.com/ja_jp/amplify/latest/userguide/getting-started.html#step-1-connect-repository ãƒ»å¯¾å¿œã™ã‚‹ãƒªãƒã‚¸ãƒˆãƒªæ§‹é€  ç¨®é¡ ãƒ“ãƒ«ãƒ‰é–‹å§‹ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª éãƒ¢ãƒãƒªãƒã‚¸ãƒˆãƒª ãƒªãƒã‚¸ãƒˆãƒªåã‹ã‚‰ãªã‚‹ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª ãƒ¢ãƒãƒªãƒã‚¸ãƒˆãƒª ãƒ¢ãƒãƒªãƒã‚¸ãƒˆãƒªã®å„ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª ãƒ»amplify.ymlãƒ•ã‚¡ã‚¤ãƒ« ãƒªãƒã‚¸ãƒˆãƒªã®ãƒ«ãƒ¼ãƒˆã«amplify.ymlãƒ•ã‚¡ã‚¤ãƒ«ã‚’é…ç½®ã™ã‚‹ï¼Next.jsã§ã¯SSGï¼SSRã®ä¸¡ãƒ¢ãƒ¼ãƒ‰ã§ãƒ“ãƒ«ãƒ‰ï¼†ãƒ‡ãƒ—ãƒ­ã‚¤ãŒå¯èƒ½ã§ã‚ã‚‹ï¼package.jsonãƒ•ã‚¡ã‚¤ãƒ«ã§ä½¿ç”¨ã•ã‚Œã‚‹nextã‚³ãƒãƒ³ãƒ‰ã«å¿œã˜ã¦ï¼ŒSSGã¾ãŸã¯SSRã®ã„ãšã‚Œã‹ã®ã‚¤ãƒ³ãƒ•ãƒ©ãŒæ§‹ç¯‰ã•ã‚Œï¼Œãƒ‡ãƒ—ãƒ­ã‚¤ã•ã‚Œã‚‹ï¼SSGã®å ´åˆï¼Œè£å´ã§ã¯S3ï¼ŒCloudFrontï¼ŒRoute53ãªã©ãŒæ§‹ç¯‰ã•ã‚Œï¼Œé™çš„ãƒ›ã‚¹ãƒ†ã‚£ãƒ³ã‚°ãŒå®Ÿè¡Œã•ã‚Œã‚‹ï¼SSRã®å ´åˆï¼Œãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã ã‘ã§ãªããƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã®ç¨¼åƒç’°å¢ƒãŒå¿…è¦ã«ãªã‚‹ãŸã‚ï¼ŒLambdaã‚„CogniteãŒæ§‹ç¯‰ã•ã‚Œã‚‹ï¼ å‚è€ƒï¼š https://docs.aws.amazon.com/ja_jp/amplify/latest/userguide/build-settings.html https://docs.aws.amazon.com/ja_jp/amplify/latest/userguide/server-side-rendering-amplify.html#deploy-nextjs-app version: 1 #===================== # ç’°å¢ƒå¤‰æ•° #===================== env: variables: key: # ç’°å¢ƒå¤‰æ•°ã®ãƒãƒ¼ãƒ‰ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚° #===================== # ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã®CI/CD #===================== backend: phases: preBuild: commands: - # ã‚³ãƒãƒ³ãƒ‰ build: commands: - # ã‚³ãƒãƒ³ãƒ‰ postBuild: commands: - # ã‚³ãƒãƒ³ãƒ‰ #===================== # ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã®CI/CD #===================== frontend: phases: preBuild: commands: - npm install # ç’°å¢ƒå¤‰æ•°ã¨ã—ã¦ç™»éŒ²ã—ãŸã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰å€¤ã‚’ãƒ‡ã‚³ãƒ¼ãƒ‰ - echo $ENV | base64 -di > .env - cat .env build: commands: - nuxt generate --fail-on-error - ls -la ./dist artifacts: # ãƒ‡ãƒ—ãƒ­ã‚¤å¯¾è±¡ã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª files: # å…¨ã¦ã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª - \"**/*\" discard-paths: yes # ãƒ“ãƒ«ãƒ‰ã®ã‚¢ãƒ¼ãƒ†ã‚£ãƒ•ã‚¡ã‚¯ãƒˆã‚’é…ç½®ã™ã‚‹ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª baseDirectory: dist # ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã¨ã—ã¦ä¿å­˜ã™ã‚‹ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª cache: paths: - node_modules/**/* #===================== # ãƒ†ã‚¹ãƒˆ #===================== test: phases: preTest: commands: - # ã‚³ãƒãƒ³ãƒ‰ test: commands: - # ã‚³ãƒãƒ³ãƒ‰ postTest: commands: - # ã‚³ãƒãƒ³ãƒ‰ artifacts: # ãƒ‡ãƒ—ãƒ­ã‚¤å¯¾è±¡ã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª files: # å…¨ã¦ã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª - \"**/*\" configFilePath: *location* # ãƒ“ãƒ«ãƒ‰ã®ã‚¢ãƒ¼ãƒ†ã‚£ãƒ•ã‚¡ã‚¯ãƒˆã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª baseDirectory: *location* 03. API Gateway API Gatewayã¨ã¯ ç•°ãªã‚‹ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‹ã‚‰ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’å—ä¿¡ã—ã¦å·®åˆ†ã‚’å¸åã—ï¼Œé©åˆ‡ãªAPIã«æŒ¯ã‚Šåˆ†ã‘ã‚‰ã‚Œã‚‹ï¼ è¨­å®šé …ç›® ãƒ»æ¦‚è¦ API Gatewayã¯ï¼Œãƒ¡ã‚½ãƒƒãƒ‰ãƒªã‚¯ã‚¨ã‚¹ãƒˆï¼Œçµ±åˆãƒªã‚¯ã‚¨ã‚¹ãƒˆï¼Œçµ±åˆãƒ¬ã‚¹ãƒãƒ³ã‚¹ï¼Œãƒ¡ã‚½ãƒƒãƒ‰ãƒ¬ã‚¹ãƒãƒ³ã‚¹ï¼Œã‹ã‚‰æ§‹æˆã•ã‚Œã‚‹ï¼ è¨­å®šé …ç›® èª¬æ˜ è£œè¶³ ãƒªã‚½ãƒ¼ã‚¹ ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆï¼ŒHTTPãƒ¡ã‚½ãƒƒãƒ‰ï¼Œè»¢é€å…ˆï¼Œãªã©ã‚’è¨­å®šã™ã‚‹ï¼ æ§‹ç¯‰ã—ãŸAWSãƒªã‚½ãƒ¼ã‚¹ã®ãƒ‘ã‚¹ãŒï¼ŒAPI Gatewayã®ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã«ãªã‚‹ï¼ ã‚¹ãƒ†ãƒ¼ã‚¸ API Gatewayã‚’ãƒ‡ãƒ—ãƒ­ã‚¤ã™ã‚‹ç’°å¢ƒã‚’å®šç¾©ã™ã‚‹ï¼ ã‚ªãƒ¼ã‚½ãƒ©ã‚¤ã‚¶ãƒ¼ Lambdaã¾ãŸã¯Cognitoã«ã‚ˆã‚‹ã‚ªãƒ¼ã‚½ãƒ©ã‚¤ã‚¶ãƒ¼ã‚’ä½¿ç”¨ã—ã¦ï¼Œèªå¯ãƒ—ãƒ­ã‚»ã‚¹ã‚’å®šç¾©ã™ã‚‹ï¼ ã‚²ãƒ¼ãƒˆã‚¦ã‚§ã‚¤ã®ãƒ¬ã‚¹ãƒãƒ³ã‚¹ ãƒ¢ãƒ‡ãƒ« ãƒªã‚¯ã‚¨ã‚¹ãƒˆï¼ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã®ã‚¹ã‚­ãƒ¼ãƒã‚’è¨­å®šã™ã‚‹ï¼ã“ã‚Œã‚‰ã®ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã®ãŸã‚ã«ä½¿ç”¨ã§ãã‚‹ï¼ OpenAPIä»•æ§˜ã«ãŠã‘ã‚‹ã‚¹ã‚­ãƒ¼ãƒã«ã¤ã„ã¦ã¯ï¼Œä»¥ä¸‹ã®ãƒªãƒ³ã‚¯ã‚’å‚è€ƒã«ã›ã‚ˆï¼å‚è€ƒï¼šhttps://hiroki-it.github.io/tech-notebook-gitbook/public/software/software_application_collaboration_api_restful.html ãƒªã‚½ãƒ¼ã‚¹ãƒãƒªã‚·ãƒ¼ ãƒãƒªã‚·ãƒ¼ã‚’ä½¿ç”¨ã—ã¦ï¼ŒAPI Gatewayã«ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚’å®šç¾©ã¥ã‘ã‚‹ï¼ ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ APIã®è¨­å®š ä½¿ç”¨é‡ãƒ—ãƒ©ãƒ³ æœ‰æ–™ã‚µãƒ¼ãƒ“ã‚¹ã¨ã—ã¦APIã‚’å…¬é–‹ã—ï¼Œæ–™é‡‘ä½“ç³»ã«å¿œã˜ã¦ãƒªã‚¯ã‚¨ã‚¹ãƒˆé‡ã‚’åˆ¶é™ã™ã‚‹ãŸã‚ã«ä½¿ç”¨ã™ã‚‹ï¼APIã‚­ãƒ¼ã«ãƒªã‚¯ã‚¨ã‚¹ãƒˆé‡ã®ãƒ¬ãƒ¼ãƒˆã‚’è¨­å®šã™ã‚‹ï¼ æœ‰æ–™ã‚µãƒ¼ãƒ“ã‚¹ã¨ã—ã¦ä½¿ç”¨ã—ãªã„APIã®å ´åˆã¯ï¼Œãƒ¬ãƒ¼ãƒˆã‚’è¨­å®šã™ã‚‹å¿…è¦ã¯ãªã„ï¼ APIã‚­ãƒ¼ APIã‚­ãƒ¼èªè¨¼ã‚’è¨­å®šã™ã‚‹ï¼ ãƒ»ãã®ä»–ã®ã‚¢ã‚¯ã‚»ã‚¹åˆ¶å¾¡ã®æ–¹æ³•ã¨ã—ã¦ï¼Œä»¥ä¸‹ãŒã‚ã‚‹ï¼å‚è€ƒï¼šhttps://docs.aws.amazon.com/ja_jp/apigateway/latest/developerguide/apigateway-control-access-to-api.htmlãƒ»APIã‚­ãƒ¼èªè¨¼ã«ã¤ã„ã¦ã¯ï¼Œä»¥ä¸‹ã®ãƒªãƒ³ã‚¯ã‚’å‚è€ƒã«ã›ã‚ˆï¼å‚è€ƒï¼šhttps://hiroki-it.github.io/tech-notebook-gitbook/public/software/software_application_collaboration_authentication_authorization.html ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆè¨¼æ˜æ›¸ SSLã‚µãƒ¼ãƒè¨¼æ˜æ›¸ã‚’API Gatewayã«å‰²ã‚Šå½“ã¦ã‚‹ï¼ APIãŒï¼ŒAPI Gatewayã‹ã‚‰è»¢é€ã•ã‚ŒãŸãƒªã‚¯ã‚¨ã‚¹ãƒˆã§ã‚ã‚‹ã“ã¨è­˜åˆ¥ã§ãã‚‹ã‚ˆã†ã«ãªã‚‹ï¼ CloudWatchãƒ­ã‚°ã®è¨­å®š API GatewayãŒCloudWatchãƒ­ã‚°ã«ã‚¢ã‚¯ã‚»ã‚¹ã§ãã‚‹ã‚ˆã†ï¼Œãƒ­ãƒ¼ãƒ«ã‚’è¨­å®šã™ã‚‹ï¼ ä¸€ã¤ã®AWSç’°å¢ƒã«ã¤ãï¼Œä¸€ã¤ã®ãƒ­ãƒ¼ãƒ«ã‚’è¨­å®šã™ã‚Œã°ã‚ˆã„ï¼ ãƒªã‚½ãƒ¼ã‚¹ ãƒ»ãƒªã‚½ãƒ¼ã‚¹ é †ç•ª å‡¦ç† èª¬æ˜ è£œè¶³ 1 ãƒ¡ã‚½ãƒƒãƒ‰ãƒªã‚¯ã‚¨ã‚¹ãƒˆ ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‹ã‚‰é€ä¿¡ã•ã‚ŒãŸãƒ‡ãƒ¼ã‚¿ã®ã†ã¡ï¼Œå®Ÿéš›ã«è»¢é€ã™ã‚‹ãƒ‡ãƒ¼ã‚¿ã®ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°ã‚’è¡Œã†ï¼ 2 çµ±åˆãƒªã‚¯ã‚¨ã‚¹ãƒˆ ãƒ¡ã‚½ãƒƒãƒ‰ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‹ã‚‰è»¢é€ã•ã‚ŒãŸå„ãƒ‡ãƒ¼ã‚¿ã‚’ï¼Œãƒãƒƒãƒ”ãƒ³ã‚°ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã®JSONã«ç´ä»˜ã‘ã‚‹ï¼ 3 çµ±åˆãƒ¬ã‚¹ãƒãƒ³ã‚¹ çµ±åˆãƒªã‚¯ã‚¨ã‚¹ãƒˆã§ãƒ—ãƒ­ã‚­ã‚·çµ±åˆã‚’ä½¿ç”¨ã™ã‚‹å ´åˆï¼Œçµ±åˆãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’ä½¿ç”¨ã§ããªããªã‚‹ï¼ 4 ãƒ¡ã‚½ãƒƒãƒ‰ãƒ¬ã‚¹ãƒãƒ³ã‚¹ ãƒ¬ã‚¹ãƒãƒ³ã‚¹ãŒæˆåŠŸã—ãŸå ´åˆï¼Œã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã«é€ä¿¡ã™ã‚‹ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚³ãƒ¼ãƒ‰ã‚’è¨­å®šã™ã‚‹ï¼ ãƒ»ãƒ¡ã‚½ãƒƒãƒ‰ãƒªã‚¯ã‚¨ã‚¹ãƒˆ è¨­å®šé …ç›® èª¬æ˜ è£œè¶³ èªå¯ å®šç¾©ã—ãŸLambdaã¾ãŸã¯Cognitoã«ã‚ˆã‚‹ã‚ªãƒ¼ã‚½ãƒ©ã‚¤ã‚¶ãƒ¼ã‚’æœ‰åŠ¹åŒ–ã™ã‚‹ï¼ ãƒªã‚¯ã‚¨ã‚¹ãƒˆã®æ¤œè¨¼ ã€URLã‚¯ã‚¨ãƒªæ–‡å­—åˆ—ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã€ã€HTTPãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒ˜ãƒƒãƒ€ãƒ¼ã€ã€ãƒªã‚¯ã‚¨ã‚¹ãƒˆæœ¬æ–‡ã€ã®ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’æœ‰åŠ¹åŒ–ã™ã‚‹ï¼ APIã‚­ãƒ¼ã®å¿…è¦æ€§ ãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒ˜ãƒƒãƒ€ãƒ¼ã«ãŠã‘ã‚‹APIã‚­ãƒ¼ã®ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’è¡Œã†ï¼ãƒªã‚¯ã‚¨ã‚¹ãƒˆã®ãƒ˜ãƒƒãƒ€ãƒ¼ã«ã€x-api-keyã€ã‚’å«ã¿ï¼Œã“ã‚Œã«APIã‚­ãƒ¼ãŒå‰²ã‚Šå½“ã¦ã‚‰ã‚Œã¦ã„ã‚‹ã“ã¨ã‚’å¼·åˆ¶ã™ã‚‹ï¼ ãƒ˜ãƒƒãƒ€ãƒ¼åã¯å¤§æ–‡å­—ã§ã‚‚å°æ–‡å­—ã§ã‚‚å•é¡Œãªã„ãŒï¼Œå°æ–‡å­—ãŒæ¨å¥¨ï¼å‚è€ƒï¼šhttps://hiroki-it.github.io/tech-notebook-gitbook/public/software/software_application_collaboration_api_restful.html URLã‚¯ã‚¨ãƒªæ–‡å­—åˆ—ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ ãƒªã‚¯ã‚¨ã‚¹ãƒˆã•ã‚ŒãŸURLã®ã‚¯ã‚¨ãƒªãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã®ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’è¡Œã†ï¼ HTTPãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒ˜ãƒƒãƒ€ãƒ¼ ãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒ˜ãƒƒãƒ€ãƒ¼ã®ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’è¡Œã†ï¼ ãƒªã‚¯ã‚¨ã‚¹ãƒˆæœ¬æ–‡ ãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒœãƒ‡ã‚£ã®ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’è¡Œã†ï¼ SDKè¨­å®š ãƒ»çµ±åˆãƒªã‚¯ã‚¨ã‚¹ãƒˆ è¨­å®šé …ç›® èª¬æ˜ è£œè¶³ çµ±åˆã‚¿ã‚¤ãƒ— ãƒªã‚¯ã‚¨ã‚¹ãƒˆã®è»¢é€å…ˆã‚’è¨­å®šã™ã‚‹ï¼ URLãƒ‘ã‚¹ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ ãƒ¡ã‚½ãƒƒãƒ‰ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‹ã‚‰è»¢é€ã•ã‚ŒãŸãƒ‡ãƒ¼ã‚¿ã‚’ï¼ŒAPI Gatewayã‹ã‚‰è»¢é€ã™ã‚‹ãƒªã‚¯ã‚¨ã‚¹ãƒˆã®ãƒ‘ã‚¹ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã«ç´ä»˜ã‘ã‚‹ï¼ã¾ãŸã¯ç´ä»˜ã‘ãšã«ï¼Œæ–°ã—ã„ãƒ‡ãƒ¼ã‚¿ã‚’è»¢é€ã—ã¦ã‚‚è‰¯ã„ï¼ URLã‚¯ã‚¨ãƒªæ–‡å­—åˆ—ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ ãƒ¡ã‚½ãƒƒãƒ‰ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‹ã‚‰è»¢é€ã•ã‚ŒãŸãƒ‡ãƒ¼ã‚¿ã‚’ï¼ŒAPI Gatewayã‹ã‚‰è»¢é€ã™ã‚‹ãƒªã‚¯ã‚¨ã‚¹ãƒˆã®ã‚¯ã‚¨ãƒªãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã«ç´ä»˜ã‘ã‚‹ï¼ã¾ãŸã¯ç´ä»˜ã‘ãšã«ï¼Œæ–°ã—ã„ãƒ‡ãƒ¼ã‚¿ã‚’è»¢é€ã—ã¦ã‚‚è‰¯ã„ï¼ HTTPãƒ˜ãƒƒãƒ€ãƒ¼ ãƒ¡ã‚½ãƒƒãƒ‰ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‹ã‚‰è»¢é€ã•ã‚ŒãŸãƒ‡ãƒ¼ã‚¿ã‚’ï¼ŒAPI Gatewayã‹ã‚‰è»¢é€ã™ã‚‹ãƒªã‚¯ã‚¨ã‚¹ãƒˆã®ãƒ˜ãƒƒãƒ€ãƒ¼ã«ç´ä»˜ã‘ã‚‹ï¼ã¾ãŸã¯ç´ä»˜ã‘ãšã«ï¼Œæ–°ã—ã„ãƒ‡ãƒ¼ã‚¿ã‚’è»¢é€ã—ã¦ã‚‚è‰¯ã„ï¼ å€¤ã¯ã‚·ãƒ³ã‚°ãƒ«ã‚¯ã‚ªãƒ¼ãƒˆã§å›²ã†å¿…è¦ãŒã‚ã‚‹ï¼ ãƒãƒƒãƒ”ãƒ³ã‚°ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ ãƒ¡ã‚½ãƒƒãƒ‰ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‹ã‚‰è»¢é€ã•ã‚ŒãŸãƒ‡ãƒ¼ã‚¿ã‚’ï¼ŒAPI Gatewayã‹ã‚‰è»¢é€ã™ã‚‹ãƒªã‚¯ã‚¨ã‚¹ãƒˆã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãƒœãƒ‡ã‚£ã«ç´ä»˜ã‘ã‚‹ï¼ã¾ãŸã¯ç´ä»˜ã‘ãšã«ï¼Œæ–°ã—ã„ãƒ‡ãƒ¼ã‚¿ã‚’è»¢é€ã—ã¦ã‚‚è‰¯ã„ï¼ ãƒ»ãƒ†ã‚¹ãƒˆ è¨­å®šé …ç›® è¨­å®šä¾‹ è£œè¶³ ã‚¯ã‚¨ãƒªæ–‡å­— ãƒ˜ãƒƒãƒ€ãƒ¼ X-API-Token: test æ³¢æ‹¬å¼§ï¼Œã‚¹ãƒšãƒ¼ã‚¹ï¼Œã‚¯ã‚ªãƒ¼ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ã¯ä¸è¦ï¼ ãƒªã‚¯ã‚¨ã‚¹ãƒˆæœ¬æ–‡ {test:\"test\"} æ”¹è¡Œã‚¿ã‚°ã‚„ã‚¹ãƒšãƒ¼ã‚¹ãŒå…¥ã‚Šè¾¼ã¾ãªã„ã‚ˆã†ã«ã™ã‚‹ï¼ ãƒ»OpenAPIä»•æ§˜ã®ã‚¤ãƒ³ãƒãƒ¼ãƒˆ ä»¥ä¸‹ã®ãƒªãƒ³ã‚¯ã‚’å‚è€ƒã«ã›ã‚ˆï¼ å‚è€ƒï¼šhttps://hiroki-it.github.io/tech-notebook-gitbook/public/infrastructure_cloud_computing_aws_apigateway_import.html ãƒ»CORSã®æœ‰åŠ¹åŒ– CORSã‚’æœ‰åŠ¹åŒ–ã—ï¼Œç•°ãªã‚‹ã‚ªãƒªã‚¸ãƒ³ã«ã‚ˆã£ã¦è¡¨ç¤ºã•ã‚ŒãŸãƒšãƒ¼ã‚¸ã‹ã‚‰ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’è¨±å¯ã™ã‚‹ï¼ä»¥ä¸‹ã®ãƒªãƒ³ã‚¯ã‚’å‚è€ƒã«ã›ã‚ˆï¼ å‚è€ƒï¼šhttps://docs.aws.amazon.com/ja_jp/apigateway/latest/developerguide/how-to-cors.html ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆçµ±åˆ ãƒ»ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆçµ±åˆã¨ã¯ API Gatewayã¨VPCãƒªãƒ³ã‚¯ã®é–“ã§ï¼Œãƒªã‚¯ã‚¨ã‚¹ãƒˆï¼ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã®JSONãƒ‡ãƒ¼ã‚¿ã‚’è‡ªå‹•çš„ã«ãƒãƒƒãƒ”ãƒ³ã‚°ã™ã‚‹æ©Ÿèƒ½ã®ã“ã¨ï¼ å‚è€ƒï¼šhttps://docs.aws.amazon.com/ja_jp/apigateway/latest/developerguide/set-up-private-integration.html ã¾ãŸï¼ŒVPCãƒªãƒ³ã‚¯ã®è¨­å®šã«ã‚ˆã£ã¦ï¼ŒVPCã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã‚µãƒ¼ãƒ“ã‚¹ãŒæ§‹ç¯‰ã•ã‚Œã‚‹ï¼VPCã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã‚µãƒ¼ãƒ“ã‚¹ã«ã¤ã„ã¦ã¯ï¼ŒVPCã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã‚µãƒ¼ãƒ“ã‚¹ã®èª¬æ˜ã‚’å‚è€ƒã«ã›ã‚ˆï¼ è¨­å®šé …ç›® èª¬æ˜ çµ±åˆã‚¿ã‚¤ãƒ— VPCãƒªãƒ³ã‚¯ã‚’é¸æŠã™ã‚‹ï¼ ãƒ—ãƒ­ã‚­ã‚·çµ±åˆã®ä½¿ç”¨ VPCãƒªãƒ³ã‚¯ã¨ã®ãƒ—ãƒ­ã‚­ã‚·çµ±åˆã‚’æœ‰åŠ¹åŒ–ã™ã‚‹ï¼ ãƒ¡ã‚½ãƒƒãƒ‰ HTTPãƒ¡ã‚½ãƒƒãƒ‰ã‚’è¨­å®šã™ã‚‹ï¼ VPCãƒªãƒ³ã‚¯ VPCãƒªãƒ³ã‚¯åã‚’è¨­å®šã™ã‚‹ï¼ ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆURL NLBã®DNSåã‚’ãƒ‰ãƒ¡ã‚¤ãƒ³åã¨ã—ã¦ï¼Œè»¢é€å…ˆã®URLã‚’è¨­å®šã™ã‚‹ï¼ ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆã®ä½¿ç”¨ ãƒ»ãƒ¡ã‚½ãƒƒãƒ‰ãƒªã‚¯ã‚¨ã‚¹ãƒˆã¨çµ±åˆãƒªã‚¯ã‚¨ã‚¹ãƒˆã®ãƒãƒƒãƒ”ãƒ³ã‚° Lambdaãƒ—ãƒ­ã‚­ã‚·çµ±åˆ ãƒ»Lambdaãƒ—ãƒ­ã‚­ã‚·çµ±åˆã¨ã¯ API Gatewayã¨Lambdaã®é–“ã§ï¼Œãƒªã‚¯ã‚¨ã‚¹ãƒˆï¼ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã®JSONãƒ‡ãƒ¼ã‚¿ã‚’è‡ªå‹•çš„ã«ãƒãƒƒãƒ”ãƒ³ã‚°ã™ã‚‹æ©Ÿèƒ½ã®ã“ã¨ï¼ãƒ—ãƒ­ã‚­ã‚·çµ±åˆã‚’ä½¿ç”¨ã™ã‚‹ã¨ï¼ŒLambdaã«é€ä¿¡ã•ã‚ŒãŸãƒªã‚¯ã‚¨ã‚¹ãƒˆã¯ãƒãƒ³ãƒ‰ãƒ©é–¢æ•°ã®eventã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã«ä»£å…¥ã•ã‚Œã‚‹ï¼ãƒ—ãƒ­ã‚­ã‚·çµ±åˆã‚’ä½¿ç”¨ã—ãªã„å ´åˆï¼ŒLambdaã¨API Gatewayã®é–“ã®ãƒãƒƒãƒ”ãƒ³ã‚°ã‚’æ‰‹å‹•ã§è¡Œã†å¿…è¦ãŒã‚ã‚‹ï¼ å‚è€ƒï¼šhttps://docs.aws.amazon.com/ja_jp/apigateway/latest/developerguide/set-up-lambda-integrations.html è¨­å®šé …ç›® èª¬æ˜ çµ±åˆã‚¿ã‚¤ãƒ— Lambdaé–¢æ•°ã‚’é¸æŠã™ã‚‹ï¼ Lambdaãƒ—ãƒ­ã‚­ã‚·çµ±åˆã®ä½¿ç”¨ Lambdaã¨ã®ãƒ—ãƒ­ã‚­ã‚·çµ±åˆã‚’æœ‰åŠ¹åŒ–ã™ã‚‹ï¼ Lambdaãƒªãƒ¼ã‚¸ãƒ§ãƒ³ å®Ÿè¡Œã—ãŸLambdaé–¢æ•°ã®ãƒªãƒ¼ã‚¸ãƒ§ãƒ³ã‚’è¨­å®šã™ã‚‹ï¼ Lambdaé–¢æ•° å®Ÿè¡Œã—ãŸLambdaé–¢æ•°ã®åå‰ã‚’è¨­å®šã™ã‚‹ï¼ å®Ÿè¡Œãƒ­ãƒ¼ãƒ« å®Ÿè¡Œã—ãŸã„Lambdaé–¢æ•°ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹æ¨©é™ãŒã‚¢ã‚¿ãƒƒãƒã•ã‚ŒãŸãƒ­ãƒ¼ãƒ«ã®ARNã‚’è¨­å®šã™ã‚‹ï¼ãŸã ã—ï¼ŒLambdaå´ã«API Gatewayã¸ã®ã‚¢ã‚¯ã‚»ã‚¹æ¨©é™ã‚’ã‚¢ã‚¿ãƒƒãƒã—ã¦ã‚‚ã‚ˆã„ï¼ èªè¨¼æƒ…å ±ã®ã‚­ãƒ£ãƒƒã‚·ãƒ¥ ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆã®ä½¿ç”¨ ãƒ»ãƒªã‚¯ã‚¨ã‚¹ãƒˆæ™‚ã®ãƒãƒƒãƒ”ãƒ³ã‚° API Gatewayå´ã§ãƒ—ãƒ­ã‚­ã‚·çµ±åˆã‚’æœ‰åŠ¹åŒ–ã™ã‚‹ã¨ï¼ŒAPI Gatewayã‚’çµŒç”±ã—ãŸã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‹ã‚‰ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆã¯ï¼Œãƒãƒ³ãƒ‰ãƒ©é–¢æ•°ã®eventã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®JSONãƒ‡ãƒ¼ã‚¿ã«ãƒãƒƒãƒ”ãƒ³ã‚°ã•ã‚Œã‚‹ï¼ { \"resource\": \"Resource path\", \"path\": \"Path parameter\", \"httpMethod\": \"Incoming request's method name\", \"headers\": { String containing incoming request headers }, \"multiValueHeaders\": { List of strings containing incoming request headers }, \"queryStringParameters\": { query string parameters }, \"multiValueQueryStringParameters\": { List of query string parameters }, \"pathParameters\": { path parameters }, \"stageVariables\": { Applicable stage variables }, \"requestContext\": { Request context, including authorizer-returned key-value pairs }, \"body\": \"A JSON string of the request payload.\", \"isBase64Encoded\": \"A boolean flag to indicate if the applicable request payload is Base64-encoded\" } ãƒ»ãƒ¬ã‚¹ãƒãƒ³ã‚¹æ™‚ã®ãƒãƒƒãƒ”ãƒ³ã‚° API Gatewayã¯ï¼ŒLambdaã‹ã‚‰ã®ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’ï¼Œä»¥ä¸‹ã®JSONãƒ‡ãƒ¼ã‚¿ã«ãƒãƒƒãƒ”ãƒ³ã‚°ã™ã‚‹ï¼ã“ã‚Œä»¥å¤–ã®æ§‹é€ ã®JSONãƒ‡ãƒ¼ã‚¿ã‚’é€ä¿¡ã™ã‚‹ã¨ï¼ŒAPI Gatewayã§ã€Internal Server Errorã€ã®ã‚¨ãƒ©ãƒ¼ãŒèµ·ã“ã‚‹ï¼ { \"isBase64Encoded\": true | false, \"statusCode\": httpStatusCode, \"headers\": { \"headerName\": \"headerValue\", ... }, \"multiValueHeaders\": { \"headerName\": [ \"headerValue\", \"headerValue2\", ... ], ... }, \"body\": \"Hello Lambda\" } API Gatewayã¯ä¸Šè¨˜ã®JSONãƒ‡ãƒ¼ã‚¿ã‚’å—ä¿¡ã—ãŸå¾Œï¼Œbodyã®ã¿å€¤ã‚’ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãƒœãƒ‡ã‚£ã«æŒãŸã›ï¼Œã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã«é€ä¿¡ã™ã‚‹ï¼ \"Hello Lambda\" ã‚¹ãƒ†ãƒ¼ã‚¸ ãƒ»è¨­å®š è¨­å®šé …ç›® èª¬æ˜ ã‚­ãƒ£ãƒƒã‚·ãƒ¥è¨­å®š å‚è€ƒï¼šhttps://docs.aws.amazon.com/ja_jp/apigateway/latest/developerguide/api-gateway-caching.html ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®ãƒ¡ã‚½ãƒƒãƒ‰ã‚¹ãƒ­ãƒƒãƒˆãƒªãƒ³ã‚° ï¼‘ç§’å½“ãŸã‚Šã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆæ•°åˆ¶é™ã‚’è¨­å®šã™ã‚‹ï¼å‚è€ƒï¼šhttps://docs.aws.amazon.com/ja_jp/apigateway/latest/developerguide/api-gateway-request-throttling.html WAF å‚è€ƒï¼šhttps://docs.aws.amazon.com/ja_jp/apigateway/latest/developerguide/apigateway-control-access-aws-waf.html ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆè¨¼æ˜æ›¸ ç´ä»˜ã‘ã‚‹WAFã‚’è¨­å®šã™ã‚‹ï¼ ãƒ»ã‚¹ãƒ†ãƒ¼ã‚¸å¤‰æ•° ãƒ‡ãƒ—ãƒ­ã‚¤ã•ã‚Œã‚‹ã‚¹ãƒ†ãƒ¼ã‚¸å›ºæœ‰ã®ç’°å¢ƒå¤‰æ•°ã‚’è¨­å®šã§ãã‚‹ï¼Lambdaé–¢æ•°åï¼Œã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆURLï¼Œãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãƒãƒƒãƒ”ãƒ³ã‚°ï¼Œãƒãƒƒãƒ”ãƒ³ã‚°ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã§å€¤ã‚’å‡ºåŠ›ã§ãã‚‹ï¼ä»¥ä¸‹ã®ãƒªãƒ³ã‚¯ã‚’å‚è€ƒã«ã›ã‚ˆï¼ å‚è€ƒï¼šhttps://docs.aws.amazon.com/ja_jp/apigateway/latest/developerguide/aws-api-gateway-stage-variables-reference.html ãƒ»SDKã®ç”Ÿæˆ ãƒ»Canary è¨­å®šé …ç›® èª¬æ˜ ã‚¹ãƒ†ãƒ¼ã‚¸ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒ‡ã‚£ã‚¹ãƒˆãƒªãƒ“ãƒ¥ãƒ¼ã‚·ãƒ§ãƒ³ Canaryã®ãƒ‡ãƒ—ãƒ­ã‚¤ Canaryã‚¹ãƒ†ãƒ¼ã‚¸å¤‰æ•° ã‚­ãƒ£ãƒƒã‚·ãƒ¥ ãƒ­ã‚°ã®ç¨®é¡ ãƒ»å®Ÿè¡Œãƒ­ã‚° CloudWatchãƒ­ã‚°ã«API Gatewayã®å®Ÿè¡Œãƒ­ã‚°ã‚’é€ä¿¡ã™ã‚‹ã‹ã©ã†ã‹ã‚’è¨­å®šã§ãã‚‹ï¼ãƒªã‚¯ã‚¨ã‚¹ãƒˆï¼ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã®æ§‹é€ ã‚‚ãƒ­ã‚°ã«å‡ºåŠ›ã™ã‚‹ã‚ˆã†ã«ã—ãŸæ–¹ãŒè‰¯ã„ï¼ã€€ å‚è€ƒï¼šhttps://docs.aws.amazon.com/ja_jp/apigateway/latest/developerguide/set-up-logging.html ãƒ»ã‚«ã‚¹ã‚¿ãƒ ã‚¢ã‚¯ã‚»ã‚¹ãƒ­ã‚° CloudWatchãƒ­ã‚°ã«API Gatewayã®ã‚¢ã‚¯ã‚»ã‚¹ãƒ­ã‚°ã‚’é€ä¿¡ã™ã‚‹ã‹ã©ã†ã‹ã‚’è¨­å®šã§ãã‚‹ï¼ã‚¢ã‚¯ã‚»ã‚¹ãƒ­ã‚°ã‚’æ§‹é€ åŒ–ãƒ­ã‚°ã¨ã—ã¦å‡ºåŠ›ã§ãã‚‹ï¼ å‚è€ƒï¼šhttps://docs.aws.amazon.com/ja_jp/apigateway/latest/developerguide/set-up-logging.html åˆ†æ•£ãƒˆãƒ¬ãƒ¼ã‚¹ã®åé›† X-Rayã‚’ç”¨ã„ã¦ï¼ŒAPI Gatewayã‚’èµ·ç‚¹ã¨ã—ãŸåˆ†æ•£ãƒˆãƒ¬ãƒ¼ã‚¹ã‚’åé›†ã™ã‚‹ï¼ã¾ãšï¼ŒAPI Gatewayã§ãƒˆãƒ¬ãƒ¼ã‚¹IDãŒç”Ÿæˆã•ã‚Œã‚‹ï¼ãã®å¾Œï¼Œå„AWSãƒªã‚½ãƒ¼ã‚¹ã§ã‚¹ãƒ‘ãƒ³ã‚’å–å¾—ã—ï¼Œã‚¹ãƒ‘ãƒ³ã‚’ç´ä»˜ã‘ã‚‹ã“ã¨ã‚ˆã‚Šï¼Œåˆ†æ•£ãƒˆãƒ¬ãƒ¼ã‚¹ã‚’è¡¨ç¾ã§ãã‚‹ï¼ãªãŠX-Rayã§ã¯ï¼Œè¦ªã‚¹ãƒ‘ãƒ³ã‚’ã‚»ã‚°ãƒ¡ãƒ³ãƒˆï¼Œå­ã‚¹ãƒ‘ãƒ³ã‚’ã‚µãƒ–ã‚»ã‚°ãƒ¡ãƒ³ãƒˆã¨å‘¼ã¶ï¼ å‚è€ƒï¼šhttps://docs.aws.amazon.com/ja_jp/xray/latest/devguide/xray-concepts.html#xray-concepts-traces APIã®è¨­å®š ãƒ»ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã‚¿ã‚¤ãƒ— å‚è€ƒï¼šhttps://docs.aws.amazon.com/ja_jp/apigateway/latest/developerguide/api-gateway-api-endpoint-types.html ç¨®é¡ èª¬æ˜ ãƒªãƒ¼ã‚¸ãƒ§ãƒ³ API Gatewayã®ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã¸ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’ï¼Œãƒªãƒ¼ã‚¸ãƒ§ãƒ³å†…ã®ç‰©ç†ã‚µãƒ¼ãƒã§å—ã‘ä»˜ã‘ã‚‹ï¼ ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆ API Gatewayã®ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã¸ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’ï¼ŒVPCå†…ã‹ã‚‰ã®ã¿å—ã‘ä»˜ã‘ã‚‹ï¼ ã‚¨ãƒƒã‚¸æœ€é©åŒ– API Gatewayã®ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã¸ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’ï¼ŒCloudFrontã®ã‚¨ãƒƒã‚¸ã‚µãƒ¼ãƒã§å—ã‘ä»˜ã‘ã‚‹ï¼ 04. Auto Scaling Auto Scalingã¨ã¯ ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ãƒ¡ãƒˆãƒªã‚¯ã‚¹ã®é–¾å€¤ã‚’åŸºæº–ã¨ã—ã¦ï¼Œè‡ªå‹•æ°´å¹³ã‚¹ã‚±ãƒ¼ãƒªãƒ³ã‚°ã‚’è‡ªå‹•çš„ã«å®Ÿè¡Œã™ã‚‹ï¼ è¨­å®šé …ç›® ãƒ»èµ·å‹•è¨­å®š ã‚¹ã‚±ãƒ¼ãƒªãƒ³ã‚°ã®å¯¾è±¡ã¨ãªã‚‹AWSãƒªã‚½ãƒ¼ã‚¹ã‚’å®šç¾©ã™ã‚‹ï¼ ãƒ»ã‚¹ã‚±ãƒ¼ãƒªãƒ³ã‚°ã‚°ãƒ«ãƒ¼ãƒ— ã‚¹ã‚±ãƒ¼ãƒªãƒ³ã‚°ã®ã‚°ãƒ«ãƒ¼ãƒ—æ§‹æˆã‚’å®šç¾©ã™ã‚‹ï¼å„ã‚°ãƒ«ãƒ¼ãƒ—ã§æœ€å¤§æœ€å°å¿…è¦æ•°ã‚’è¨­å®šã§ãã‚‹ï¼ ãƒ»ã‚¹ã‚±ãƒ¼ãƒªãƒ³ã‚°ãƒãƒªã‚·ãƒ¼ ã‚¹ã‚±ãƒ¼ãƒªãƒ³ã‚°ã®æ–¹æ³•ã‚’å®šç¾©ã™ã‚‹ï¼ ç¨®é¡ èª¬æ˜ è£œè¶³ ã‚·ãƒ³ãƒ—ãƒ«ã‚¹ã‚±ãƒ¼ãƒªãƒ³ã‚° ç‰¹å®šã®ãƒ¡ãƒˆãƒªã‚¯ã‚¹ã«å˜ä¸€ã®é–¾å€¤ã‚’è¨­å®šã—ï¼Œãã‚Œã«å¿œã˜ã¦ã‚¹ã‚±ãƒ¼ãƒªãƒ³ã‚°ã‚’è¡Œã†ï¼ ã‚¹ãƒ†ãƒƒãƒ—ã‚¹ã‚±ãƒ¼ãƒªãƒ³ã‚° ç‰¹å®šã®ãƒ¡ãƒˆãƒªã‚¯ã‚¹ã«æ®µéšçš„ãªé–¾å€¤ã‚’è¨­å®šã—ï¼Œãã‚Œã«å¿œã˜ã¦æ®µéšçš„ã«ã‚¹ã‚±ãƒ¼ãƒªãƒ³ã‚°ã‚’å®Ÿè¡Œã™ã‚‹ï¼ ï¼ˆä¾‹ï¼‰CPUå¹³å‡ä½¿ç”¨ç‡ã«æ®µéšçš„ãªé–¾å€¤ã‚’è¨­å®šã™ã‚‹ï¼ãƒ»40%ã®æ™‚ã«ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ãŒï¼‘ã¤ã‚¹ã‚±ãƒ¼ãƒ«ã‚¢ã‚¦ãƒˆãƒ»70%ã®æ™‚ã«ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’ï¼’ã¤ã‚¹ã‚±ãƒ¼ãƒ«ã‚¢ã‚¦ãƒˆãƒ»90%ã®æ™‚ã«ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’ï¼“ã¤ã‚¹ã‚±ãƒ¼ãƒ«ã‚¢ã‚¦ãƒˆ ã‚¿ãƒ¼ã‚²ãƒƒãƒˆè¿½è·¡ã‚¹ã‚±ãƒ¼ãƒªãƒ³ã‚° ç‰¹å®šã®ãƒ¡ãƒˆãƒªã‚¯ã‚¹ï¼ˆCPUå¹³å‡ä½¿ç”¨ç‡ã‚„Memoryå¹³å‡ä½¿ç”¨ç‡ï¼‰ã«ã‚¿ãƒ¼ã‚²ãƒƒãƒˆå€¤ã‚’è¨­å®šã—ï¼Œãã‚Œã«åæŸã™ã‚‹ã‚ˆã†ã«è‡ªå‹•çš„ã«ã‚¹ã‚±ãƒ¼ãƒ«ã‚¤ãƒ³ã¨ã‚¹ã‚±ãƒ¼ãƒ«ã‚¢ã‚¦ãƒˆã‚’å®Ÿè¡Œã™ã‚‹ï¼ ã‚¿ãƒ¼ã‚²ãƒƒãƒˆå€¤ã‚’è¨­å®šã§ãã‚‹ãƒªã‚½ãƒ¼ã‚¹ã®ä¾‹ãƒ»ECSã‚µãƒ¼ãƒ“ã‚¹ã®ã‚¿ã‚¹ã‚¯æ•°ãƒ»RDSã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ã®Auroraã®ãƒªãƒ¼ãƒ‰ãƒ¬ãƒ—ãƒªã‚«æ•°ãƒ»Lambdaã®ã‚¹ã‚¯ãƒªãƒ—ãƒˆåŒæ™‚å®Ÿè¡Œæ•° 05. Certificate Manager è¨­å®šé …ç›® è¨­å®šé …ç›® èª¬æ˜ ãƒ‰ãƒ¡ã‚¤ãƒ³å èªè¨¼ã‚’ãƒªã‚¯ã‚¨ã‚¹ãƒˆã™ã‚‹ãƒ‰ãƒ¡ã‚¤ãƒ³åã‚’è¨­å®šã™ã‚‹ï¼ æ¤œè¨¼ã®æ–¹æ³• DNSæ¤œè¨¼ã‹Emailæ¤œè¨¼ã‹ã‚’è¨­å®šã™ã‚‹ï¼ èªè¨¼å±€ èªè¨¼å±€ã§ã‚ã‚‹ATSã«ã‚ˆã£ã¦èªè¨¼ã•ã‚ŒãŸSSLã‚µãƒ¼ãƒè¨¼æ˜æ›¸ã‚’ç®¡ç†ã§ãã‚‹ï¼ è‡ªç¤¾ã®ä¸­é–“èªè¨¼å±€å ãƒ«ãƒ¼ãƒˆèªè¨¼å±€å ATSï¼šAmazon Trust Services Starfieldç¤¾ ãƒ‰ãƒ¡ã‚¤ãƒ³ã®æ‰¿èªæ–¹æ³• ãƒ»DNSæ¤œè¨¼ CNAMEãƒ¬ã‚³ãƒ¼ãƒ‰ãƒ©ãƒ³ãƒ€ãƒ ãƒˆãƒ¼ã‚¯ãƒ³ã‚’ç”¨ã„ã¦ï¼Œãƒ‰ãƒ¡ã‚¤ãƒ³åã®æ‰€æœ‰è€…ã§ã‚ã‚‹ã“ã¨ã‚’è¨¼æ˜ã™ã‚‹æ–¹æ³•ï¼ACMã«ã‚ˆã£ã¦ç”Ÿæˆã•ã‚ŒãŸCNAMEãƒ¬ã‚³ãƒ¼ãƒ‰ãƒ©ãƒ³ãƒ€ãƒ ãƒˆãƒ¼ã‚¯ãƒ³ãŒæä¾›ã•ã‚Œã‚‹ã®ã§ï¼Œã“ã‚Œã‚’Route53ã«è¨­å®šã—ã¦ãŠã‘ã°ï¼ŒACMãŒã“ã‚Œã‚’æ¤œè¨¼ã—ï¼Œè¨¼æ˜æ›¸ã‚’ç™ºè¡Œã—ã¦ãã‚Œã‚‹ï¼ è¨¼æ˜æ›¸ ãƒ»ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒãƒªã‚·ãƒ¼ è¨±å¯ã™ã‚‹ãƒ—ãƒ­ãƒˆã‚³ãƒ«ã‚’å®šç¾©ã—ãŸãƒ«ãƒ¼ãƒ«ã“ã¨ï¼SSL/TLSãƒ—ãƒ­ãƒˆã‚³ãƒ«ã‚’è¨±å¯ã—ã¦ãŠã‚Šï¼Œå¯¾å¿œã§ãã‚‹ãƒãƒ¼ã‚¸ãƒ§ãƒ³ãŒç•°ãªã‚‹ãŸã‚ï¼Œãƒ–ãƒ©ã‚¦ã‚¶ãŒãã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã®SSL/TLSãƒ—ãƒ­ãƒˆã‚³ãƒ«ã‚’ä½¿ç”¨ã§ãã‚‹ã‹ã‚’èªè­˜ã—ã¦ãŠãå¿…è¦ãŒã‚ã‚‹ï¼ Policy-2016-08 Policy-TLS-1-1 Policy-TLS-1-2 Protocol-TLSv1 ã€‡ âœ• âœ• Protocol-TLSv1.1 ã€‡ ã€‡ âœ• Protocol-TLSv1.2 ã€‡ ã€‡ ã€‡ ãƒ»SSLã‚µãƒ¼ãƒè¨¼æ˜æ›¸ã®ç¨®é¡ DNSæ¤œè¨¼ã¾ãŸã¯Eãƒ¡ãƒ¼ãƒ«æ¤œè¨¼ã«ã‚ˆã£ã¦ï¼Œãƒ‰ãƒ¡ã‚¤ãƒ³åã®æ‰€æœ‰è€…ã§ã‚ã‚‹ã“ã¨ãŒè¨¼æ˜ã•ã‚Œã‚‹ã¨ï¼Œç™ºè¡Œã•ã‚Œã‚‹ï¼è¨¼æ˜æ›¸ã¯ï¼ŒPKIã«ã‚ˆã‚‹å…¬é–‹éµæ¤œè¨¼ã«ç”¨ã„ã‚‰ã‚Œã‚‹ï¼ è¨¼æ˜æ›¸ã®ç¨®é¡ èª¬æ˜ ãƒ¯ã‚¤ãƒ«ãƒ‰ã‚«ãƒ¼ãƒ‰è¨¼æ˜æ›¸ è¨¼æ˜ã™ã‚‹ãƒ‰ãƒ¡ã‚¤ãƒ³åã«ãƒ¯ã‚¤ãƒ«ãƒ‰ã‚«ãƒ¼ãƒ‰ã‚’ç”¨ã„ãŸã‚‚ã®ï¼ ãƒ»SSLã‚µãƒ¼ãƒè¨¼æ˜æ›¸ã®è¨­ç½®å ´æ‰€ãƒ‘ã‚¿ãƒ¼ãƒ³ AWSã®ä½¿ç”¨ä¸Šï¼ŒACMè¨¼æ˜æ›¸ã‚’è¨­ç½®ã§ããªã„AWSãƒªã‚½ãƒ¼ã‚¹ã«å¯¾ã—ã¦ã¯ï¼Œå¤–éƒ¨ã®è¨¼æ˜æ›¸ã‚’æ‰‹ã«å…¥ã‚Œã¦è¨­ç½®ã™ã‚‹ï¼HTTPSã«ã‚ˆã‚‹SSLãƒ—ãƒ­ãƒˆã‚³ãƒ«ã‚’å—ã‘ä»˜ã‘ã‚‹ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã®æœ€çµ‚åœ°ç‚¹ã®ã“ã¨ã‚’ï¼ŒSSLã‚¿ãƒ¼ãƒŸãƒãƒ¼ã‚·ãƒ§ãƒ³ã¨ã„ã†ï¼ ãƒ‘ã‚¿ãƒ¼ãƒ³ï¼ˆRoute53ã«ã¯å¿…ãšè¨­ç½®ï¼‰ SSLã‚¿ãƒ¼ãƒŸãƒãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆHTTPSã®æœ€çµ‚åœ°ç‚¹ï¼‰ è£œè¶³ Route53 â†’ ALB(+ACMè¨¼æ˜æ›¸) â†’ EC2 ALB Route53 â†’ CloudFront(+ACMè¨¼æ˜æ›¸) â†’ ALB(+ACMè¨¼æ˜æ›¸) â†’ EC2 ALB CloudFrontã¯ãƒãƒ¼ã‚¸ãƒ‹ã‚¢åŒ—éƒ¨ã§ï¼Œã¾ãŸALBã¯æ±äº¬ãƒªãƒ¼ã‚¸ãƒ§ãƒ³ã§ï¼Œè¨¼æ˜æ›¸ã‚’æ§‹ç¯‰ã™ã‚‹å¿…è¦ãŒã‚ã‚‹ï¼CloudFrontã«é€ä¿¡ã•ã‚ŒãŸHTTPSãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’ALBã«ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã™ã‚‹ãŸã‚ã«ï¼Œä¸¡æ–¹ã«ç´ä»˜ã‘ã‚‹è¨¼æ˜æ›¸ã§æ‰¿èªã™ã‚‹ãƒ‰ãƒ¡ã‚¤ãƒ³ã¯ï¼Œä¸€è‡´ã•ã›ã‚‹å¿…è¦ãŒã‚ã‚‹ï¼ Route53 â†’ CloudFront(+ACMè¨¼æ˜æ›¸) â†’ EC2 CloudFront Route53 â†’ CloudFront(+ACMè¨¼æ˜æ›¸) â†’ S3 CloudFront Route53 â†’ ALB(+ACMè¨¼æ˜æ›¸) â†’ EC2(+å¤–éƒ¨è¨¼æ˜æ›¸) EC2 Route53 â†’ NLB â†’ EC2(+å¤–éƒ¨è¨¼æ˜æ›¸) EC2 Route53 â†’ EC2(+å¤–éƒ¨è¨¼æ˜æ›¸) EC2 Route53 â†’ Lightsail(+ACMè¨¼æ˜æ›¸) Lightsail è¨¼æ˜æ›¸ã®ç¢ºèªæ–¹æ³• ãƒ»ãƒ–ãƒ©ã‚¦ã‚¶ã‹ã‚‰ã®ç¢ºèª Chromeã‚’ä¾‹ã«æŒ™ã’ã‚‹ã¨ï¼ŒSSLã‚µãƒ¼ãƒè¨¼æ˜æ›¸ã¯URLã®éµãƒãƒ¼ã‚¯ã‹ã‚‰ç¢ºèªã§ãã‚‹ï¼ ï¼Šä¾‹ï¼Š CircleCIã®ã‚µã‚¤ãƒˆã¯ï¼ŒSSLã‚µãƒ¼ãƒè¨¼æ˜æ›¸ã®ãŸã‚ã«ACMã‚’ä½¿ç”¨ã—ã¦ã„ã‚‹ï¼ 06. Chatbot Chatbotã¨ã¯ SNSã‚’çµŒç”±ã—ã¦ï¼ŒCloudWatchã‹ã‚‰ã®é€šçŸ¥ã‚’ãƒãƒ£ãƒƒãƒˆã‚¢ãƒ—ãƒªã«è»¢é€ã™ã‚‹AWSãƒªã‚½ãƒ¼ã‚¹ï¼ è¨­å®šé …ç›® ãƒ»slacké€šçŸ¥ã®å ´åˆ ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚’Slackã¨ã—ãŸå ´åˆã®è¨­å®šã‚’ä»¥ä¸‹ã«ç¤ºã™ï¼ è¨­å®šé …ç›® èª¬æ˜ Slackãƒãƒ£ãƒ³ãƒãƒ« é€šçŸ¥ã®è»¢é€å…ˆã®Slackãƒãƒ£ãƒ³ãƒãƒ«ã‚’è¨­å®šã™ã‚‹ï¼ ã‚¢ã‚¯ã‚»ã‚¹è¨±å¯ SNSã‚’ä»‹ã—ã¦ï¼ŒCloudWatchã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ãŸã‚ã®ãƒ­ãƒ¼ãƒ«ã‚’è¨­å®šã™ã‚‹ï¼ SNSãƒˆãƒ”ãƒƒã‚¯ CloudWatchã¸ã®ã‚¢ã‚¯ã‚»ã‚¹æ™‚çµŒç”±ã™ã‚‹ï¼ŒSNSãƒˆãƒ”ãƒƒã‚¯ã‚’è¨­å®šã™ã‚‹ï¼ ãƒ»ã‚µãƒãƒ¼ãƒˆå¯¾è±¡ã®ã‚¤ãƒ™ãƒ³ãƒˆ AWSãƒªã‚½ãƒ¼ã‚¹ã®ã‚¤ãƒ™ãƒ³ãƒˆã‚’ï¼ŒEventBridgeï¼ˆCloudWatchã‚¤ãƒ™ãƒ³ãƒˆï¼‰ã‚’ç”¨ã„ã¦ï¼ŒChatbotã«è»¢é€ã§ãã‚‹ãŒï¼Œå…¨ã¦ã®AWSãƒªã‚½ãƒ¼ã‚¹ã‚’ã‚µãƒãƒ¼ãƒˆã—ã¦ã„ã‚‹ã‚ã‘ã§ã¯ãªã„ï¼ã‚µãƒãƒ¼ãƒˆå¯¾è±¡ã®AWSãƒªã‚½ãƒ¼ã‚¹ã¯ä»¥ä¸‹ã®ãƒªãƒ³ã‚¯ã‚’å‚è€ƒã«ã›ã‚ˆï¼ å‚è€ƒï¼šhttps://docs.aws.amazon.com/ja_jp/chatbot/latest/adminguide/related-services.html#cloudwatchevents ãƒ»ã‚¤ãƒ³ã‚·ãƒ‡ãƒ³ãƒˆ ï¼”å¤§ã‚·ã‚°ãƒŠãƒ«ã‚’å«ã‚€ï¼Œã‚·ã‚¹ãƒ†ãƒ çš„ã«è‰¯ããªã„äº‹è±¡ã®ã“ã¨ï¼ ãƒ»ã‚ªãƒ³ã‚³ãƒ¼ãƒ« ã‚¤ãƒ³ã‚·ãƒ‡ãƒ³ãƒˆã‚’é€šçŸ¥ã™ã‚‹ã‚ˆã†ã«ã—ï¼Œé€šçŸ¥ã‚’å—ã‘ã¦å¯¾å¿œã™ã‚‹ã“ã¨ï¼ 07. CloudFront CloudFrontã¨ã¯ ã‚¯ãƒ©ã‚¦ãƒ‰ãƒªãƒãƒ¼ã‚¹ãƒ—ãƒ­ã‚­ã‚·ã‚µãƒ¼ãƒã¨ã—ã¦åƒãï¼VPCã®å¤–å´ï¼ˆãƒ‘ãƒ–ãƒªãƒƒã‚¯ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ï¼‰ã«è¨­ç½®ã•ã‚Œã¦ã„ã‚‹ï¼ã‚ªãƒªã‚¸ãƒ³ã‚µãƒ¼ãƒï¼ˆã‚³ãƒ³ãƒ†ãƒ³ãƒ„æä¾›å…ƒï¼‰ã‚’S3ã¨ã—ãŸå ´åˆï¼Œå‹•çš„ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã¸ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’EC2ã«æŒ¯ã‚Šåˆ†ã‘ã‚‹ï¼ã¾ãŸï¼Œé™çš„ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã¸ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’Cacheã—ï¼Œãã®ä¸Šã§S3ã¸æŒ¯ã‚Šåˆ†ã‘ã‚‹ï¼æ¬¡å›ä»¥é™ã®é™çš„ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã®ãƒªãƒ³ã‚¯ã‚¨ã‚¹ãƒˆã¯ï¼ŒCloudFrontãŒãƒ¬ãƒ³ã‚¹ãƒãƒ³ã‚¹ã‚’è¡Œã†ï¼ è¨­å®šé …ç›® ãƒ»æ¦‚è¦ è¨­å®šé …ç›® èª¬æ˜ Distributions Reports & analytics Distributions ãƒ»Distributions å‚è€ƒã«ãªã£ãŸã‚µã‚¤ãƒˆ è¨­å®šé …ç›® èª¬æ˜ è£œè¶³ General Origin and Origin Groups ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚’æä¾›ã™ã‚‹AWSãƒªã‚½ãƒ¼ã‚¹ã‚’è¨­å®šã™ã‚‹ï¼ Behavior ã‚ªãƒªã‚¸ãƒ³ã«ãƒªã‚¯ã‚¨ã‚¹ãƒˆãŒè¡Œã‚ã‚ŒãŸæ™‚ã®CloudFrontã®æŒ™å‹•ã‚’è¨­å®šã™ã‚‹ï¼ ErrorPage æŒ‡å®šã—ãŸã‚ªãƒªã‚¸ãƒ³ã‹ã‚‰ï¼ŒæŒ‡å®šã—ãŸãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’è¿”ä¿¡ã™ã‚‹ï¼ Restriction Invalidation CloudFrontã«ä¿å­˜ã•ã‚Œã¦ã„ã‚‹Cacheã‚’å‰Šé™¤ã§ãã‚‹ï¼ ãƒ»General è¨­å®šé …ç›® èª¬æ˜ è£œè¶³ Price Class ä½¿ç”¨ã™ã‚‹ã‚¨ãƒƒã‚¸ãƒ­ã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’è¨­å®šã™ã‚‹ï¼ AsiaãŒå«ã¾ã‚Œã¦ã„ã‚‹ã‚‚ã®ã‚’é¸æŠï¼ AWS WAF CloudFrontã«ç´ä»˜ã‘ã‚‹WAFã‚’è¨­å®šã™ã‚‹ï¼ CNAME CloudFrontã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆãƒ‰ãƒ¡ã‚¤ãƒ³åï¼ˆxxxxx.cloudfront.net.ï¼‰ã«ç´ä»˜ã‘ã‚‹Route53ãƒ¬ã‚³ãƒ¼ãƒ‰åã‚’è¨­å®šã™ã‚‹ï¼ ãƒ»Route53ã‹ã‚‰ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã™ã‚‹å ´åˆã¯å¿…é ˆï¼ãƒ»è¤‡æ•°ã®ãƒ¬ã‚³ãƒ¼ãƒ‰åã‚’è¨­å®šã§ãã‚‹ï¼ SSL Certificate HTTPSãƒ—ãƒ­ãƒˆã‚³ãƒ«ã§ã‚ªãƒªã‚¸ãƒ³ã«è»¢é€ã™ã‚‹å ´åˆã«è¨­å®šã™ã‚‹ï¼ ä¸Šè¿°ã®CNAMEã‚’è¨­å®šã—ãŸå ´åˆï¼ŒSSLè¨¼æ˜æ›¸ãŒåˆ¥é€”å¿…è¦ã«ãªã‚‹ï¼ã¾ãŸï¼ŒCertificate Managerã‚’ä½¿ç”¨ã™ã‚‹å ´åˆï¼Œã“ã®è¨¼æ˜æ›¸ã¯ã€ãƒãƒ¼ã‚¸ãƒ‹ã‚¢åŒ—éƒ¨ã€ã§ç”³è«‹ã™ã‚‹å¿…è¦ãŒã‚ã‚‹ï¼ Security Policy ãƒªã‚¯ã‚¨ã‚¹ãƒˆã®é€ä¿¡è€…ãŒä½¿ç”¨ã™ã‚‹SSL/TLSãƒ—ãƒ­ãƒˆã‚³ãƒ«ã‚„æš—å·åŒ–æ–¹å¼ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã«åˆã‚ã›ã¦ï¼ŒCloudFrontãŒå—ä¿¡ã§ãã‚‹ã“ã‚Œã‚‰ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’è¨­å®šã™ã‚‹ï¼ ãƒ»ãƒªã‚¯ã‚¨ã‚¹ãƒˆã®é€ä¿¡è€…ã«ã¯ï¼Œãƒ–ãƒ©ã‚¦ã‚¶ï¼ŒAPIã«ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é€ä¿¡ã™ã‚‹å¤–éƒ¨ã‚µãƒ¼ãƒ“ã‚¹ï¼Œè»¢é€å…ƒã®AWSãƒªã‚½ãƒ¼ã‚¹ï¼Œãªã©ã‚’å«ã‚€ï¼ãƒ»å‚è€ƒï¼šhttps://docs.aws.amazon.com/ja_jp/AmazonCloudFront/latest/DeveloperGuide/secure-connections-supported-viewer-protocols-ciphers.html Default Root Object ã‚ªãƒªã‚¸ãƒ³ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆãƒ«ãƒ¼ãƒˆã‚’è¨­å®šã™ã‚‹ï¼ ãƒ»ä½•ã‚‚è¨­å®šã—ãªã„å ´åˆï¼Œãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆãƒ«ãƒ¼ãƒˆã¯æŒ‡å®šã•ã‚Œãšï¼ŒBehaviorã§æ˜ç¤ºçš„ã«ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã™ã‚‹å¿…è¦ãŒã‚ã‚‹ï¼ãƒ»index.htmlã‚’è¨­å®šã™ã‚‹ã¨ï¼Œã€/ã€ã§ãƒªã‚¯ã‚¨ã‚¹ãƒˆã—ãŸæ™‚ã«ï¼Œã‚ªãƒªã‚¸ãƒ³ã®ãƒ«ãƒ¼ãƒˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ã‚ã‚‹index,htmlãƒ•ã‚¡ã‚¤ãƒ«ãŒãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆãƒ«ãƒ¼ãƒˆã«ãªã‚‹ï¼ Standard Logging CloudFrontã®ã‚¢ã‚¯ã‚»ã‚¹ãƒ­ã‚°ã‚’S3ã«ç”Ÿæˆã™ã‚‹ã‹ã©ã†ã‹ã‚’è¨­å®šã™ã‚‹ï¼ ãƒ»Origin and Origin Groups è¨­å®šé …ç›® èª¬æ˜ è£œè¶³ Origin Domain Name CloudFrontã‚’ãƒªãƒãƒ¼ã‚¹ãƒ—ãƒ­ã‚­ã‚·ã¨ã—ã¦ï¼ŒAWSãƒªã‚½ãƒ¼ã‚¹ã®ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã‚„DNSã«ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã™ã‚‹ï¼ ãƒ»ä¾‹ãˆã°ï¼ŒS3ã®ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆï¼ŒALBã®DNSåã‚’è¨­å®šã™ã‚‹ï¼ãƒ»åˆ¥ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã®AWSãƒªã‚½ãƒ¼ã‚¹ã®DNSåã§ã‚ã£ã¦ã‚‚ã‚ˆã„ï¼ Origin Path ã‚ªãƒªã‚¸ãƒ³ã®ãƒ«ãƒ¼ãƒˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’è¨­å®šã™ã‚‹ï¼ ãƒ»ä½•ã‚‚è¨­å®šã—ãªã„ã¨ï¼Œãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã¯ã€/ã€ã®ãªã‚‹ï¼Behaviorã§ã¯ï¼Œã€/ã€ã®å¾Œã«ãƒ‘ã‚¹ãŒè¿½åŠ ã•ã‚Œã‚‹ï¼ãƒ»ã€/var/www/appã€ã‚’è¨­å®šã™ã‚‹ã¨ï¼ŒBehaviorã§è¨­å®šã—ãŸãƒ‘ã‚¹ãŒã€/var/www/app/xxxxxã€ã®ã‚ˆã†ã«è¿½åŠ ã•ã‚Œã‚‹ï¼ Origin Access Identity ãƒªã‚¯ã‚¨ã‚¹ãƒˆã®è»¢é€å…ˆã¨ãªã‚‹AWSãƒªã‚½ãƒ¼ã‚¹ã§ã‚¢ã‚¯ã‚»ã‚¹æ¨©é™ã®ã‚¢ã‚¿ãƒƒãƒãŒå¿…è¦ãªå ´åˆã«è¨­å®šã™ã‚‹ï¼è»¢é€å…ˆã®AWSãƒªã‚½ãƒ¼ã‚¹ã§ã¯ï¼Œã‚¢ã‚¯ã‚»ã‚¹ãƒãƒªã‚·ãƒ¼ã‚’ã‚¢ã‚¿ãƒƒãƒã™ã‚‹ï¼ CloudFrontãŒS3ã«å¯¾ã—ã¦èª­ã¿å‡ºã—ã‚’è¡Œã†ãŸã‚ã«å¿…è¦ï¼ Origin Protocol Policy ãƒªã‚¯ã‚¨ã‚¹ãƒˆã®è»¢é€å…ˆã¨ãªã‚‹AWSãƒªã‚½ãƒ¼ã‚¹ã«å¯¾ã—ã¦ï¼ŒHTTPã¨HTTPSã®ã„ãšã‚Œã®ãƒ—ãƒ­ãƒˆã‚³ãƒ«ã§è»¢é€ã™ã‚‹ã‹ã‚’è¨­å®šã™ã‚‹ï¼ ãƒ»ALBã§å¿…è¦ï¼ALBã®ãƒªã‚¹ãƒŠãƒ¼ã®ãƒ—ãƒ­ãƒˆã‚³ãƒ«ã«åˆã‚ã›ã¦è¨­å®šã™ã‚‹ï¼ãƒ»HTTP Onlyï¼šHTTPã§è»¢é€ãƒ»HTTPS Onlyï¼šHTTPSã§è»¢é€ãƒ»Match Viewerï¼šä¸¡æ–¹ã§è»¢é€ HTTPãƒãƒ¼ãƒˆ è»¢é€æ™‚ã«æŒ‡å®šã™ã‚‹ã‚ªãƒªã‚¸ãƒ³ã®HTTPã®ãƒãƒ¼ãƒˆç•ªå· HTTPSãƒãƒ¼ãƒˆ è»¢é€æ™‚ã«æŒ‡å®šã™ã‚‹ã‚ªãƒªã‚¸ãƒ³ã®HTTPSã®ãƒãƒ¼ãƒˆç•ªå· ãƒ»Behavior ä½•ã«åŸºã¥ã„ãŸCacheã‚’è¡Œã†ã‹ã«ã¤ã„ã¦ã¯ï¼Œâ˜…ãƒãƒ¼ã‚¯ã®é …ç›®ã§åˆ¶å¾¡ã§ãã‚‹ï¼â˜…ãƒãƒ¼ã‚¯ã§ï¼Œå„é …ç›®ã®å…¨ã¦å€¤ãŒï¼Œéå»ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆã«åˆè‡´ã—ãŸæ™‚ã®ã¿ï¼Œãã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆã¨éå»ã®ã‚‚ã®ãŒåŒä¸€ã§ã‚ã‚‹ã¨è¦‹ãªã™ä»•çµ„ã¿ã«ãªã£ã¦ã„ã‚‹ï¼ã‚­ãƒ£ãƒƒã‚·ãƒ¥åˆ¤å®šæ™‚ã®ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’æ¸›ã‚‰ã—ï¼ŒHITç‡ã‚’æ”¹å–„ã™ã‚‹ãŸã‚ã«ï¼Œâ˜…ãƒãƒ¼ã‚¯ã§å¯èƒ½ãªé™ã‚Šã€Noneã€ã‚’é¸æŠã—ãŸæ–¹ãŒè‰¯ã„ï¼æœ€çµ‚çš„ã«ï¼Œå¯¾è±¡ã®ãƒ•ã‚¡ã‚¤ãƒ«ãŒCloudFrontã®Cacheã®å¯¾è±¡ã¨ãªã£ã¦ã„ã‚‹ã‹ã¯ï¼Œãƒ¬ã‚¹ãƒãƒ³ã‚¹ã®ãƒ˜ãƒƒãƒ€ãƒ¼ã«å«ã¾ã‚Œã‚‹ã€X-Cache:ã€ãŒã€Hit from cloudfrontã€ï¼Œã€Miss from cloudfrontã€ã®ã©ã¡ã‚‰ã§ï¼ŒCacheã®ä½¿ç”¨ã®æœ‰ç„¡ã‚’åˆ¤æ–­ã§ãã‚‹ï¼ãã®ä»–ã®æ”¹å–„æ–¹æ³•ã¯ï¼Œä»¥ä¸‹ãƒªãƒ³ã‚¯ã‚’å‚è€ƒã«ã›ã‚ˆï¼ å‚è€ƒï¼šhttps://docs.aws.amazon.com/ja_jp/AmazonCloudFront/latest/DeveloperGuide/cache-hit-ratio.html#cache-hit-ratio-query-string-parameters è¨­å®šé …ç›® èª¬æ˜ è£œè¶³ Precedence å‡¦ç†ã®å„ªå…ˆé †ä½ï¼ æœ€åˆã«æ§‹ç¯‰ã—ãŸBehaviorãŒã€Default (*)ã€ã¨ãªã‚Šï¼Œã“ã‚Œã¯å¾Œã‹ã‚‰å¤‰æ›´ã§ããªã„ãŸã‚ï¼Œä¸»è¦ãªBehaviorã‚’ã¾ãšæœ€åˆã«è¨­å®šã™ã‚‹ï¼ Path Pattern Behaviorã‚’è¡Œã†ãƒ•ã‚¡ã‚¤ãƒ«ãƒ‘ã‚¹ã‚’è¨­å®šã™ã‚‹ï¼ Origin or Origin Group Behaviorã‚’è¡Œã†ã‚ªãƒªã‚¸ãƒ³ã‚’è¨­å®šã™ã‚‹ï¼ Viewer Protocol Policy HTTPï¼HTTPSã®ã©ã¡ã‚‰ã‚’å—ä¿¡ã™ã‚‹ã‹ï¼Œã¾ãŸã©ã®ã‚ˆã†ã«å¤‰æ›ã—ã¦è»¢é€ã™ã‚‹ã‹ã‚’è¨­å®š ãƒ»HTTP and HTTPSï¼šä¸¡æ–¹å—ä¿¡ã—ï¼Œãã®ã¾ã¾è»¢é€ãƒ»Redirect HTTP to HTTPSï¼šä¸¡æ–¹å—ä¿¡ã—ï¼ŒHTTPSã§è»¢é€ãƒ»HTTPS Onlyï¼šHTTPSã®ã¿å—ä¿¡ã—ï¼ŒHTTPSã§è»¢é€ Allowed HTTP Methods ãƒªã‚¯ã‚¨ã‚¹ãƒˆã®HTTPãƒ¡ã‚½ãƒƒãƒ‰ã®ã†ã¡ï¼Œã‚ªãƒªã‚¸ãƒ³ã¸ã®è»¢é€ã‚’è¨±å¯ã™ã‚‹ã‚‚ã®ã‚’è¨­å®š ãƒ»ãƒ‘ã‚¹ãƒ‘ã‚¿ãƒ¼ãƒ³ãŒé™çš„ãƒ•ã‚¡ã‚¤ãƒ«ã¸ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆã®å ´åˆï¼ŒGETã®ã¿è¨±å¯ï¼ãƒ»ãƒ‘ã‚¹ãƒ‘ã‚¿ãƒ¼ãƒ³ãŒå‹•çš„ãƒ•ã‚¡ã‚¤ãƒ«ã¸ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆã®å ´åˆï¼Œå…¨ã¦ã®ãƒ¡ã‚½ãƒƒãƒ‰ã‚’è¨±å¯ï¼ â˜…Cache Based on Selected Request Headersï¼ˆâ˜…ã«ã¤ã„ã¦ã¯è¡¨ä¸Šéƒ¨å‚è€ƒï¼‰ ãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒ˜ãƒƒãƒ€ãƒ¼ã®ã†ã¡ï¼Œã‚ªãƒªã‚¸ãƒ³ã¸ã®è»¢é€ã‚’è¨±å¯ã—ï¼Œã¾ãŸCacheã®å¯¾è±¡ã¨ã™ã‚‹ã‚‚ã®ã‚’è¨­å®šã™ã‚‹ï¼ ãƒ»å„ãƒ˜ãƒƒãƒ€ãƒ¼è»¢é€ã®å…¨æ‹’å¦ï¼Œä¸€éƒ¨è¨±å¯ï¼Œå…¨è¨±å¯ã‚’è¨­å®šã§ãã‚‹ï¼ãƒ»å…¨æ‹’å¦ï¼šå…¨ã¦ã®ãƒ˜ãƒƒãƒ€ãƒ¼ã®è»¢é€ã‚’æ‹’å¦ã—ï¼ŒCacheã®å¯¾è±¡ã¨ã—ãªã„ï¼å‹•çš„ã«ãªã‚Šã‚„ã™ã„å€¤ã‚’æŒã¤ãƒ˜ãƒƒãƒ€ãƒ¼ï¼ˆAccept-Datetimeãªã©ï¼‰ã‚’ä¸€åˆ‡ä½¿ç”¨ã›ãšã«ï¼Œãã‚Œä»¥å¤–ã®ã‚¯ã‚¨ãƒªæ–‡å­—ã‚„Cookieã§Cacheã‚’åˆ¤å®šã™ã‚‹ã‚ˆã†ã«ãªã‚‹ãŸã‚ï¼ŒåŒä¸€ã¨è¦‹ãªã™ãƒªã‚¯ã‚¨ã‚¹ãƒˆãŒå¢—ãˆï¼ŒHITç‡æ”¹å–„ã«ã¤ãªãŒã‚‹ï¼ãƒ»ä¸€éƒ¨è»¢é€ï¼šæŒ‡å®šã—ãŸãƒ˜ãƒƒãƒ€ãƒ¼ã®ã¿è»¢é€ã‚’è¨±å¯ã—ï¼ŒCacheã®å¯¾è±¡ã¨ã™ã‚‹ï¼ãƒ»å…¨è¨±å¯ï¼šå…¨ã¦ã®ãƒ˜ãƒƒãƒ€ãƒ¼ãŒCacheã®å¯¾è±¡ã¨ãªã‚‹ï¼ã—ã‹ã—ï¼Œæ—¥ä»˜ã«é–¢ã™ã‚‹ãƒ˜ãƒƒãƒ€ãƒ¼ãªã©ã®å‹•çš„ãªå€¤ã‚’Cacheã®å¯¾è±¡ã¨ã—ã¦ã—ã¾ã†ã¨ï¼åŒä¸€ã¨è¦‹ãªã™ãƒªã‚¯ã‚¨ã‚¹ãƒˆãŒã»ã¨ã‚“ã©ãªããªã‚Šï¼ŒHITã—ãªããªã‚‹ï¼ãã®ãŸã‚ï¼Œã“ã®è¨­å®šã§Cacheã¯å®Ÿè³ªç„¡åŠ¹ã¨ãªã‚Šï¼Œã€å¯¾è±¡ã¨ã—ãªã„ã€ã«ç­‰ã—ã„ï¼ Whitelist Header Cache Based on Selected Request Headers ã‚’å‚è€ƒã«ã›ã‚ˆï¼ ãƒ»Accept-xxxxxï¼šã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã«ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã—ã¦æ¬²ã—ã„ãƒ‡ãƒ¼ã‚¿ã®ç¨®é¡ï¼ˆãƒ‡ãƒ¼ã‚¿å‹ãªã©ï¼‰ã‚’æŒ‡å®šï¼ãƒ» CloudFront-Is-xxxxx-Viewerï¼šãƒ‡ãƒã‚¤ã‚¹ã‚¿ã‚¤ãƒ—ã®Boolå€¤ãŒæ ¼ç´ã•ã‚Œã¦ã„ã‚‹ï¼ Object Caching CloudFrontã«ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã®Cacheã‚’ä¿å­˜ã—ã¦ãŠãç§’æ•°ã‚’è¨­å®šã™ã‚‹ï¼ ãƒ»Origin Cache ãƒ˜ãƒƒãƒ€ãƒ¼ã‚’é¸æŠã—ãŸå ´åˆï¼Œã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‹ã‚‰ã®ãƒ¬ã‚¹ãƒãƒ³ã‚¹ãƒ˜ãƒƒãƒ€ãƒ¼ã®Cache-Controlã®å€¤ãŒé©ç”¨ã•ã‚Œã‚‹ï¼ãƒ»ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºã‚’é¸æŠã—ãŸå ´åˆï¼Œãƒ–ãƒ©ã‚¦ã‚¶ã®TTLã¨ã¯åˆ¥ã«è¨­å®šã§ãã‚‹ï¼ TTL CloudFrontã«Cacheã‚’ä¿å­˜ã—ã¦ãŠãç§’æ•°ã‚’è©³ç´°ã«è¨­å®šã™ã‚‹ï¼ ãƒ»Minï¼ŒMaxï¼ŒDefaultï¼Œã®å…¨ã¦ã‚’0ç§’ã¨ã™ã‚‹ã¨ï¼ŒCacheã‚’ç„¡åŠ¹åŒ–ã§ãã‚‹ï¼ãƒ»ã€Cache Based on Selected Request Headers = Allã€ã¨ã—ã¦ã„ã‚‹å ´åˆï¼ŒCacheãŒå®Ÿè³ªç„¡åŠ¹ã¨ãªã‚‹ãŸã‚ï¼Œæœ€å°TTLã¯ã‚¼ãƒ­ã§ãªã‘ã‚Œã°ãªã‚‰ãªã„ï¼ â˜…Farward Cookiesï¼ˆâ˜…ã«ã¤ã„ã¦ã¯è¡¨ä¸Šéƒ¨å‚è€ƒï¼‰ Cookieæƒ…å ±ã®ã‚­ãƒ¼åã®ã†ã¡ï¼Œã‚ªãƒªã‚¸ãƒ³ã¸ã®è»¢é€ã‚’è¨±å¯ã—ï¼ŒCacheã®å¯¾è±¡ã¨ã™ã‚‹ã‚‚ã®ã‚’è¨­å®šã™ã‚‹ï¼ ãƒ»Cookieæƒ…å ±ã‚­ãƒ¼åè»¢é€ã®å…¨æ‹’å¦ï¼Œä¸€éƒ¨è¨±å¯ï¼Œå…¨è¨±å¯ã‚’è¨­å®šã§ãã‚‹ï¼ãƒ»å…¨æ‹’å¦ï¼šå…¨ã¦ã®Cookieã®è»¢é€ã‚’æ‹’å¦ã—ï¼ŒCacheã®å¯¾è±¡ã¨ã—ãªã„ï¼Cookieã¯ãƒ¦ãƒ¼ã‚¶ã”ã¨ã«ä¸€æ„ã«ãªã‚‹ã“ã¨ãŒå¤šãï¼Œå‹•çš„ã§ã‚ã‚‹ãŒï¼Œãã‚Œä»¥å¤–ã®ãƒ˜ãƒƒãƒ€ãƒ¼ã‚„ã‚¯ã‚¨ãƒªæ–‡å­—ã§Cacheã‚’åˆ¤å®šã™ã‚‹ã‚ˆã†ã«ãªã‚‹ãŸã‚ï¼ŒåŒä¸€ã¨è¦‹ãªã™ãƒªã‚¯ã‚¨ã‚¹ãƒˆãŒå¢—ãˆï¼ŒHITç‡æ”¹å–„ã«ã¤ãªãŒã‚‹ï¼ãƒ»ãƒªã‚¯ã‚¨ã‚¹ãƒˆã®ãƒ˜ãƒƒãƒ€ãƒ¼ã«å«ã¾ã‚Œã‚‹Cookieæƒ…å ±ï¼ˆã‚­ãƒ¼åï¼å€¤ï¼‰ãŒå¤‰å‹•ã—ã¦ã„ã‚‹ã¨ï¼ŒCloudFrontã«ä¿å­˜ã•ã‚ŒãŸCacheãŒHITã—ãªã„ï¼CloudFrontã¯ã‚­ãƒ¼åï¼å€¤ã‚’ä¿æŒã™ã‚‹ãŸã‚ï¼Œå¤‰åŒ–ã—ã‚„ã™ã„ã‚­ãƒ¼åï¼å€¤ã¯ï¼Œã‚ªãƒªã‚¸ãƒ³ã«è»¢é€ã—ãªã„ã‚ˆã†ã«è¨­å®šã™ã‚‹ï¼ä¾‹ãˆã°ï¼ŒGoogleAnalyticsã®ã‚­ãƒ¼åï¼ˆ_gaï¼‰ã®å€¤ã¯ï¼Œãƒ–ãƒ©ã‚¦ã‚¶ã«ã‚ˆã£ã¦ç•°ãªã‚‹ãŸã‚ï¼Œï¼‘ãƒ¦ãƒ¼ã‚¶ãŒãƒ–ãƒ©ã‚¦ã‚¶ã‚’å¤‰ãˆã‚‹ãŸã³ã«ï¼Œç•°ãªã‚‹CacheãŒç”Ÿæˆã•ã‚Œã‚‹ã“ã¨ã«ãªã‚‹ï¼ãã®ãŸã‚ï¼Œãƒ¦ãƒ¼ã‚¶ã‚’ä¸€æ„ã«åˆ¤å®šã™ã‚‹ã“ã¨ãŒé›£ã—ããªã£ã¦ã—ã¾ã†ï¼GoogleAnalyticsã®ã‚­ãƒ¼ã¯ãƒ–ãƒ©ã‚¦ã‚¶ã‹ã‚‰Ajaxã§Googleã«é€ä¿¡ã•ã‚Œã‚‹ã‚‚ã®ã§ï¼Œã‚ªãƒªã‚¸ãƒ³ã«ã¨ã£ã¦ã‚‚åŸºæœ¬çš„ã«ä¸è¦ã§ã‚ã‚‹ï¼ãƒ»ã‚»ãƒƒã‚·ãƒ§ãƒ³IDã¯Cookieãƒ˜ãƒƒãƒ€ãƒ¼ã«è¨­å®šã•ã‚Œã¦ã„ã‚‹ãŸã‚ï¼Œãƒ•ã‚©ãƒ¼ãƒ é€ä¿¡ã«é–¢ã‚ã‚‹ãƒ‘ã‚¹ãƒ‘ã‚¿ãƒ¼ãƒ³ã§ã¯ï¼Œã‚»ãƒƒã‚·ãƒ§ãƒ³IDã®ã‚­ãƒ¼åã‚’è¨±å¯ã™ã‚‹å¿…è¦ãŒã‚ã‚‹ï¼ â˜…Query String Forwarding and Cachingï¼ˆâ˜…ã«ã¤ã„ã¦ã¯è¡¨ä¸Šéƒ¨å‚è€ƒï¼‰ ã‚¯ã‚¨ãƒªã‚¹ãƒˆãƒªãƒ³ã‚°ã®ã†ã¡ï¼Œã‚ªãƒªã‚¸ãƒ³ã¸ã®è»¢é€ã‚’è¨±å¯ã—ï¼ŒCacheã®å¯¾è±¡ã¨ã™ã‚‹ã‚‚ã®ã‚’è¨­å®šã™ã‚‹ï¼ ãƒ»ã‚¯ã‚¨ãƒªã‚¹ãƒˆãƒªãƒ³ã‚°è»¢é€ã¨Cacheã®ï¼Œå…¨æ‹’å¦ï¼Œä¸€éƒ¨è¨±å¯ï¼Œå…¨è¨±å¯ã‚’é¸æŠã§ãã‚‹ï¼å…¨æ‹’å¦ã«ã™ã‚‹ã¨ï¼ŒWebã‚µã‚¤ãƒˆã«ã‚¯ã‚¨ãƒªã‚¹ãƒˆãƒªãƒ³ã‚°ã‚’ãƒªã‚¯ã‚¨ã‚¹ãƒˆã§ããªããªã‚‹ã®ã§æ³¨æ„ï¼ãƒ»ç•°ãªã‚‹ã‚¯ã‚¨ãƒªãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’ï¼Œåˆ¥ã€…ã®Cacheã¨ã—ã¦ä¿å­˜ã™ã‚‹ã‹ã©ã†ã‹ã‚’è¨­å®šã§ãã‚‹ï¼ Restrict Viewer Access ãƒªã‚¯ã‚¨ã‚¹ãƒˆã®é€ä¿¡å…ƒã‚’åˆ¶é™ã™ã‚‹ã‹ã©ã†ã‹ã‚’è¨­å®šã§ãã‚‹ï¼ ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚°ãƒ«ãƒ¼ãƒ—ã§åˆ¶å¾¡ã§ãã‚‹ãŸã‚ï¼Œã“ã“ã§ã¯è¨­å®šã—ãªãã¦ã‚ˆã„ï¼ Compress Objects Automatically ãƒ¬ã‚¹ãƒãƒ³ã‚¹æ™‚ã«gzipã‚’åœ§ç¸®ã™ã‚‹ã‹ã©ã†ã‹ã‚’è¨­å®š ãƒ»ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‹ã‚‰ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒ˜ãƒƒãƒ€ãƒ¼ã®Accept-Encodingã«gzipãŒè¨­å®šã•ã‚Œã¦ã„ã‚‹å ´åˆï¼Œãƒ¬ã‚¹ãƒãƒ³ã‚¹æ™‚ã«ï¼Œgzipå½¢å¼ã§åœ§ç¸®ã—ã¦é€ä¿¡ã™ã‚‹ã‹ã©ã†ã‹ã‚’è¨­å®šã™ã‚‹ï¼è¨­å®šã—ãªã„å ´åˆï¼Œåœ§ç¸®ã›ãšã«ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’é€ä¿¡ã™ã‚‹ï¼ãƒ»ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå´ã®ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰é€Ÿåº¦å‘ä¸Šã®ãŸã‚ï¼ŒåŸºæœ¬çš„ã«ã¯æœ‰åŠ¹åŒ–ã™ã‚‹ï¼ ãƒ»Invalidation TTLç§’ã«ã‚ˆã‚‹Cacheã®è‡ªå‹•å‰Šé™¤ã‚’å¾…ãŸãšã«ï¼Œæ‰‹å‹•ã§Cacheã‚’å‰Šé™¤ã§ãã‚‹ï¼å…¨ã¦ã®ãƒ•ã‚¡ã‚¤ãƒ«ã®Cacheã‚’å‰Šé™¤ã—ãŸã„å ´åˆã¯ã€/*ã€ï¼Œç‰¹å®šã®ãƒ•ã‚¡ã‚¤ãƒ«ã®Cacheã‚’å‰Šé™¤ã—ãŸã„å ´åˆã¯ã€/ã€ï¼Œã‚’æŒ‡å®šã™ã‚‹ï¼CloudFrontã«é–¢ã™ã‚‹ã‚¨ãƒ©ãƒ¼ãƒšãƒ¼ã‚¸ãŒè¡¨ç¤ºã•ã‚ŒãŸå ´åˆï¼Œä¸å…·åˆã‚’ä¿®æ­£ã—ãŸå¾Œã§ã‚‚CacheãŒæ®‹ã£ã¦ã„ã‚‹ã¨ï¼Œã‚¨ãƒ©ãƒ¼ãƒšãƒ¼ã‚¸ãŒè¡¨ç¤ºã•ã‚Œã¦ã—ã¾ã†ãŸã‚ï¼Œä½œæ¥­å¾Œã«ã¯å¿…ãšCacheã‚’å‰Šé™¤ã™ã‚‹ï¼ ãƒ»ã‚ªãƒªã‚¸ãƒ³ã«å¯¾ã™ã‚‹ãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®æ§‹é€  CloudFrontã‹ã‚‰ã‚ªãƒªã‚¸ãƒ³ã«é€ä¿¡ã•ã‚Œã‚‹ãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®æ§‹é€ ä¾‹ã‚’ä»¥ä¸‹ã«ç¤ºã™ï¼ GET /foo/ # ãƒªã‚¯ã‚¨ã‚¹ãƒˆã•ã‚ŒãŸãƒ‰ãƒ¡ã‚¤ãƒ³å Host: foo.com User-Agent: Mozilla/5.0 (iPhone; CPU iPhone OS 13_2_3 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/13.0.3 Mobile/15E148 Safari/604.1 Authorization: Bearer X-Amz-Cf-Id: XXXXX Via: 2.0 77c20654dd474081d033f27ad1b56e1e.cloudfront.net (CloudFront) # å„Cookieã®å€¤ï¼ˆäºŒå›ç›®ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆæ™‚ã«è¨­å®šã•ã‚Œã‚‹ï¼‰ Cookie: sessionid=; __ulfpc=; _ga=; _gid= # é€ä¿¡å…ƒIPã‚¢ãƒ‰ãƒ¬ã‚¹ # â€»ãƒ—ãƒ­ã‚­ã‚·ã‚µãƒ¼ãƒï¼ˆALBã‚„CloudFrontãªã©ã‚‚å«ã‚€ï¼‰ã‚’çµŒç”±ã—ã¦ã„ã‚‹å ´åˆï¼Œãã‚Œã‚‰å…¨ã¦ã®IPã‚¢ãƒ‰ãƒ¬ã‚¹ã‚‚é †ã«è¨­å®šã•ã‚Œã‚‹ X-Forwarded-For: , , Accept-Language: ja,en;q=0.9 Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9 Accept-Encoding: gzip, deflate, br pragma: no-cache cache-control: no-cache upgrade-insecure-requests: 1 sec-fetch-site: none sec-fetch-mode: navigate sec-fetch-user: ?1 sec-fetch-dest: document # ãƒ‡ãƒã‚¤ã‚¹ã‚¿ã‚¤ãƒ— CloudFront-Is-Mobile-Viewer: true CloudFront-Is-Tablet-Viewer: false CloudFront-Is-SmartTV-Viewer: false CloudFront-Is-Desktop-Viewer: false # ãƒªã‚¯ã‚¨ã‚¹ãƒˆã®é€ä¿¡å…ƒã®å›½å CloudFront-Viewer-Country: JP # ãƒªã‚¯ã‚¨ã‚¹ãƒˆã®ãƒ—ãƒ­ãƒˆã‚³ãƒ« CloudFront-Forwarded-Proto: https ãƒ»CloudFrontã¨ã‚ªãƒªã‚¸ãƒ³é–“ã®HTTPSé€šä¿¡ CloudFrontã¨ã‚ªãƒªã‚¸ãƒ³é–“ã§HTTPSé€šä¿¡ã‚’è¡Œã†å ´åˆï¼Œä¸¡æ–¹ã«ãƒ‰ãƒ¡ã‚¤ãƒ³è¨¼æ˜æ›¸ã‚’å‰²ã‚Šå½“ã¦ã‚‹å¿…è¦ãŒã‚ã‚‹ï¼å‰²ã‚Šå½“ã¦ãŸã¨ã—ã¦ã‚‚ï¼Œä»¥ä¸‹ã®æ¡ä»¶ã‚’æº€ãŸã•ãªã„ã¨HTTPSé€šä¿¡ã‚’è¡Œã†ã“ã¨ã¯ã§ããªã„ï¼CLoudFronã‹ã‚‰ã‚ªãƒªã‚¸ãƒ³ã«Hostãƒ˜ãƒƒãƒ€ãƒ¼ã‚’è»¢é€ã—ãªã„è¨­å®šã®å ´åˆï¼Œã‚ªãƒªã‚¸ãƒ³ãŒè¿”å´ã™ã‚‹è¨¼æ˜æ›¸ã«ã€Origin Domain Nameã€ã¨ä¸€è‡´ã™ã‚‹ãƒ‰ãƒ¡ã‚¤ãƒ³åãŒå«ã¾ã‚Œã¦ã„ã‚‹å¿…è¦ãŒã‚ã‚‹ï¼ä¸€æ–¹ã§ï¼ŒHostãƒ˜ãƒƒãƒ€ãƒ¼ã‚’è»¢é€ã—ãªã„å ´åˆï¼Œã‚ªãƒªã‚¸ãƒ³ãŒè¿”å´ã™ã‚‹è¨¼æ˜æ›¸ã«ã€Origin Domain Nameã€ã¨ä¸€è‡´ã™ã‚‹ãƒ‰ãƒ¡ã‚¤ãƒ³åãŒå«ã¾ã‚Œã¦ã„ã‚‹ã‹ï¼Œã¾ãŸã¯ã‚ªãƒªã‚¸ãƒ³ãŒè¿”å´ã™ã‚‹è¨¼æ˜æ›¸ã«ï¼ŒHostãƒ˜ãƒƒãƒ€ãƒ¼ã®å€¤ã¨ä¸€è‡´ã™ã‚‹ãƒ‰ãƒ¡ã‚¤ãƒ³åãŒå«ã¾ã‚Œã¦ã„ã‚‹å¿…è¦ãŒã‚ã‚‹ï¼ ãƒ»ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã®æ™‚é–“ã®æ±ºã¾ã‚Šæ–¹ ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã®æ™‚é–“ã¯ï¼Œãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒ˜ãƒƒãƒ€ãƒ¼ï¼ˆCache-Controlï¼ŒExpiresï¼‰ã®å€¤ã¨CloudFrontã®è¨­å®šï¼ˆæœ€å¤§æœ€å°ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆTTLï¼‰ã®çµ„ã¿åˆã‚ã›ã«ã‚ˆã£ã¦æ±ºã¾ã‚‹ï¼ã¡ãªã¿ã«ï¼ŒCloudFrontã®æœ€å¤§æœ€å°ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆTTLã‚’å…¨ã¦ï¼ç§’ã«ã™ã‚‹ã¨ï¼Œã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’å®Œå…¨ã«ç„¡åŠ¹åŒ–ã§ãã‚‹ï¼ å‚è€ƒï¼šhttps://docs.aws.amazon.com/ja_jp/AmazonCloudFront/latest/DeveloperGuide/Expiration.html#ExpirationDownloadDist Reports & analytics ãƒ»Cache statistics ãƒªã‚¯ã‚¨ã‚¹ãƒˆã«é–¢é€£ã™ã‚‹æ§˜ã€…ãªãƒ‡ãƒ¼ã‚¿ã‚’ï¼Œæ—¥ä»˜åˆ¥ã«é›†è¨ˆã—ãŸã‚‚ã®ã‚’ç¢ºèªã§ãã‚‹ï¼ ãƒ»Popular objects ãƒªã‚¯ã‚¨ã‚¹ãƒˆã«é–¢é€£ã™ã‚‹æ§˜ã€…ãªãƒ‡ãƒ¼ã‚¿ã‚’ï¼Œã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆåˆ¥ã«é›†è¨ˆã—ãŸã‚‚ã®ã‚’ç¢ºèªã§ãã‚‹ï¼ ã‚¨ãƒƒã‚¸ãƒ­ã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã¨ã‚¨ãƒƒã‚¸ã‚µãƒ¼ãƒ ãƒ»Point Of Presence CloudFrontã¯ä¸–ç•Œä¸­ã«è¨­ç½®ã•ã‚Œã‚‹ã€Point Of Presenceï¼ˆã‚¨ãƒƒã‚¸ãƒ­ã‚±ãƒ¼ã‚·ãƒ§ãƒ³ï¼‹ä¸­é–“å±¤ã‚­ãƒ£ãƒƒã‚·ãƒ¥ï¼‰ã€ã«ãƒ‡ãƒ—ãƒ­ã‚¤ã•ã‚Œã‚‹ï¼ å‚è€ƒï¼šhttps://aws.amazon.com/jp/cloudfront/features/?whats-new-cloudfront.sort-by=item.additionalFields.postDateTime&whats-new-cloudfront.sort-order=desc ãƒ»ã‚¨ãƒƒã‚¸ãƒ­ã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã«ãŠã‘ã‚‹å…¨ã‚¨ãƒƒã‚¸ã‚µãƒ¼ãƒã®IPã‚¢ãƒ‰ãƒ¬ã‚¹ CloudFrontã«ã¯ï¼Œã‚¨ãƒƒã‚¸ãƒ­ã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®æ•°ã ã‘ã‚¨ãƒƒã‚¸ã‚µãƒ¼ãƒãŒã‚ã‚Šï¼Œå„ã‚µãƒ¼ãƒã«IPã‚¢ãƒ‰ãƒ¬ã‚¹ãŒå‰²ã‚Šå½“ã¦ã‚‰ã‚Œã¦ã„ã‚‹ï¼ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã§ï¼Œå…¨ã¦ã®ã‚¨ãƒƒã‚¸ã‚µãƒ¼ãƒã®IPã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’ç¢ºèªã§ãã‚‹ï¼ $ curl https://ip-ranges.amazonaws.com/ip-ranges.json \\ | jq \".prefixes[]| select(.service==\"CLOUDFRONT\") | .ip_prefix\" ã‚‚ã—ãã¯ï¼Œä»¥ä¸‹ã®ãƒªãƒ³ã‚¯ã‚’ç›´æ¥å‚è€ƒã—ï¼Œã€\"service\": \"CLOUDFRONT\"ã€ã¨ãªã£ã¦ã„ã‚‹éƒ¨åˆ†ã‚’æ¢ã™ï¼ å‚è€ƒï¼šhttps://ip-ranges.amazonaws.com/ip-ranges.json ãƒ»ã‚¨ãƒƒã‚¸ãƒ­ã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ä½¿ç”¨ä¸­ã‚µãƒ¼ãƒã®IPã‚¢ãƒ‰ãƒ¬ã‚¹ CloudFrontã«ã¯ï¼Œã‚¨ãƒƒã‚¸ãƒ­ã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãŒã‚ã‚Šï¼Œå„ãƒ­ã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã«ã‚µãƒ¼ãƒãŒã‚ã‚‹ï¼ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã§ï¼Œã‚¨ãƒƒã‚¸ãƒ­ã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã«ã‚ã‚‹ä½¿ç”¨ä¸­ã‚µãƒ¼ãƒã®IPã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’ç¢ºèªã§ãã‚‹ï¼ $ nslookup .cloudfront.net ã‚«ã‚¹ã‚¿ãƒ ã‚¨ãƒ©ãƒ¼ãƒšãƒ¼ã‚¸ ãƒ»ã‚«ã‚¹ã‚¿ãƒ ã‚¨ãƒ©ãƒ¼ãƒšãƒ¼ã‚¸ã¨ã¯ ã‚ªãƒªã‚¸ãƒ³ã«è©²å½“ã®ãƒ•ã‚¡ã‚¤ãƒ«ãŒå­˜åœ¨ã—ãªã„å ´åˆï¼Œã‚ªãƒªã‚¸ãƒ³ã¯CloudFrontã«ä»¥ä¸‹ã®403ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã®ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’è¿”ä¿¡ã™ã‚‹ï¼ã‚«ã‚¹ã‚¿ãƒ ã‚¨ãƒ©ãƒ¼ãƒšãƒ¼ã‚¸ã‚’è¨­å®šã—ãªã„å ´åˆï¼ŒCloudFrontã¯ã“ã®403ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚’ãã®ã¾ã¾ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã—ã¦ã—ã¾ã†ãŸã‚ï¼Œã‚ªãƒªã‚¸ãƒ³ã«é…ç½®ã—ãŸã‚«ã‚¹ã‚¿ãƒ ã‚¨ãƒ©ãƒ¼ãƒšãƒ¼ã‚¸ã‚’404ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã§ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã™ã‚‹ã‚ˆã†ã«è¨­å®šã™ã‚‹ï¼ This XML file does not appear to have any style information associated with it. The document tree is shown below. AccessDenied Access Denied ***** ***** ãƒ»è¨­å®šæ–¹æ³• ã‚ªãƒªã‚¸ãƒ³ã‹ã‚‰ã‚«ã‚¹ã‚¿ãƒ ã‚¨ãƒ©ãƒ¼ãƒšãƒ¼ã‚¸ã‚’ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã™ã‚‹ãƒ‘ã‚¹ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’å®šç¾©ã™ã‚‹ï¼Lamnda@Edgeã‚’ä½¿ç”¨ã—ãŸCloudFrontã®å ´åˆã¯ï¼ŒLambda@Edgeã‚’çµŒç”±ã—ã¦ï¼Œã‚«ã‚¹ã‚¿ãƒ ã‚¨ãƒ©ãƒ¼ãƒšãƒ¼ã‚¸ã‚’ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã™ã‚‹å¿…è¦ãŒã‚ã‚‹ï¼ å‚è€ƒï¼šhttps://docs.aws.amazon.com/ja_jp/AmazonCloudFront/latest/DeveloperGuide/HTTPStatusCodes.html 08. CloudTrail CloudTrailã¨ã¯ IAMãƒ¦ãƒ¼ã‚¶ã«ã‚ˆã‚‹æ“ä½œã‚„ï¼Œãƒ­ãƒ¼ãƒ«ã®ã‚¢ã‚¿ãƒƒãƒã®å±¥æ­´ã‚’è¨˜éŒ²ã—ï¼Œãƒ­ã‚°ãƒ•ã‚¡ã‚¤ãƒ«ã¨ã—ã¦S3ã«è»¢é€ã™ã‚‹ï¼CloudWatchã¨é€£æºã™ã‚‹ã“ã¨ã‚‚ã§ãã‚‹ï¼ 09. CloudWatch CloudWatchã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆ ãƒ»CloudWatchã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã¨ã¯ ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹å†…ã§ç¨¼åƒã™ã‚‹å¸¸é§ã‚·ã‚¹ãƒ†ãƒ ã®ã“ã¨ï¼ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹å†…ã®ãƒ‡ãƒ¼ã‚¿ã‚’åé›†ã—ï¼ŒCloudWatchã«å¯¾ã—ã¦é€ä¿¡ã™ã‚‹ï¼ ãƒ»CloudWatchã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã®è¨­å®š ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã®ç¨®é¡ èª¬æ˜ è£œè¶³ agentã‚»ã‚¯ã‚·ãƒ§ãƒ³ CloudWatchã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆå…¨ä½“ã‚’è¨­å®šã™ã‚‹ï¼ ãƒ»ã‚¦ã‚£ã‚¶ãƒ¼ãƒ‰ã‚’ä½¿ç”¨ã—ãŸå ´åˆï¼Œã“ã®ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã®è¨­å®šã¯ã‚¹ã‚­ãƒƒãƒ—ã•ã‚Œã‚‹ï¼ãƒ»å®Ÿè£…ã—ãªã‹ã£ãŸå ´åˆï¼Œãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ãŒé©ç”¨ã•ã‚Œã‚‹ï¼ metricsã‚»ã‚¯ã‚·ãƒ§ãƒ³ ãƒ»ã‚¦ã‚£ã‚¶ãƒ¼ãƒ‰ã‚’ä½¿ç”¨ã—ãŸå ´åˆï¼Œã“ã®ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã®è¨­å®šã¯ã‚¹ã‚­ãƒƒãƒ—ã•ã‚Œã‚‹ï¼ãƒ»å®Ÿè£…ã—ãªã‹ã£ãŸå ´åˆï¼Œä½•ã‚‚è¨­å®šã•ã‚Œãªã„ï¼ logsã‚»ã‚¯ã‚·ãƒ§ãƒ³ CloudWatchã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã¯ï¼Œ/opt/aws/amazon-cloudwatch-agent/bin/config.jsonãƒ•ã‚¡ã‚¤ãƒ«ã®å®šç¾©ã‚’å…ƒã«ï¼Œå®Ÿè¡Œã•ã‚Œã‚‹ï¼è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã¯åˆ†å‰²ã§ãã‚‹ï¼è¨­å®šå¾Œï¼Œamazon-cloudwatch-agent-ctlã‚³ãƒãƒ³ãƒ‰ã§è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã‚’èª­ã¿è¾¼ã¾ã›ã‚‹ï¼CloudWatchã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚’ä½¿ç”¨ã—ã¦ï¼ŒCloudWatchã«ãƒ­ã‚°ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é€ä¿¡ã™ã‚‹ã ã‘ã§ã‚ã‚Œã°ï¼Œè¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆ/opt/aws/amazon-cloudwatch-agent/bin/config.jsonï¼‰ã«ã¯logã‚»ãƒƒã‚·ãƒ§ãƒ³ã®ã¿ã®å®Ÿè£…ã§è‰¯ã„ï¼run_as_userã«ã¯ï¼Œãƒ—ãƒ­ã‚»ã‚¹ã®ãƒ¦ãƒ¼ã‚¶åï¼ˆä¾‹ï¼šcwagentï¼‰ã‚’è¨­å®šã™ã‚‹ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š { \"agent\": { \"run_as_user\": \"cwagent\" }, \"logs\": { \"logs_collected\": { \"files\": { \"collect_list\": [ { \"file_path\": \"/var/log/nginx/error.log\", \"log_group_name\": \"/foo-www/var/log/nginx/error_log\", \"log_stream_name\": \"{instance_id}\" }, { \"file_path\": \"/var/log/php-fpm/error.log\", \"log_group_name\": \"/foo-www/var/log/php-fpm/error_log\", \"log_stream_name\": \"{instance_id}\" } ] } } } } ãƒ»ãƒ­ã‚°é€ä¿¡æ¨©é™ å‚è€ƒï¼šhttps://docs.aws.amazon.com/ja_jp/AmazonCloudWatch/latest/logs/AWS-logs-and-resource-policy.html ãƒ»æ“ä½œã‚³ãƒãƒ³ãƒ‰ ï¼Šã‚³ãƒãƒ³ãƒ‰ä¾‹ï¼Š # EC2å†…ã«ã‚ã‚‹è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã‚’ï¼ŒCloudWatchã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã«èª­ã¿è¾¼ã¾ã›ã‚‹ï¼ˆå†èµ·å‹•ã‚’å«ã‚€ï¼‰ $ /opt/aws/amazon-cloudwatch-agent/bin/amazon-cloudwatch-agent-ctl \\ -a fetch-config \\ -m ec2 \\ -s \\ -c file:/opt/aws/amazon-cloudwatch-agent/bin/config.json # ãƒ—ãƒ­ã‚»ã‚¹ã®ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚’ç¢ºèª $ /opt/aws/amazon-cloudwatch-agent/bin/amazon-cloudwatch-agent-ctl \\ -m ec2 \\ -a status # è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ãŒèª­ã¿è¾¼ã¾ã‚ŒãŸã‹ã‚’ç¢ºèª ### CloudWatchã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã®ãƒ—ãƒ­ã‚»ã‚¹ã®ãƒ­ã‚°ãƒ•ã‚¡ã‚¤ãƒ« $ tail -f /opt/aws/amazon-cloudwatch-agent/logs/amazon-cloudwatch-agent.log ### è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã®æ§‹æ–‡ãƒã‚§ãƒƒã‚¯ã®ãƒ­ã‚°ãƒ•ã‚¡ã‚¤ãƒ« $ tail -f /opt/aws/amazon-cloudwatch-agent/logs/configuration-validation.log ### OSèµ·å‹•æ™‚ã«ãƒ‡ãƒ¼ãƒ¢ãƒ³ãŒç¨¼åƒã™ã‚‹ã‚ˆã†ã«è¨­å®šã•ã‚Œã¦ã„ã‚‹ã‹ã‚’ç¢ºèª $ systemctl list-unit-files --type=service 09-02. CloudWatchãƒ¡ãƒˆãƒªã‚¯ã‚¹ CloudWatchãƒ¡ãƒˆãƒªã‚¯ã‚¹ã¨ã¯ AWSãƒªã‚½ãƒ¼ã‚¹ã§ç™ºç”Ÿã—ãŸãƒ‡ãƒ¼ã‚¿ãƒã‚¤ãƒ³ãƒˆã®ãƒ¡ãƒˆãƒªã‚¯ã‚¹ã‚’åé›†ã™ã‚‹ï¼ ãƒ‡ãƒ¼ã‚¿ãƒã‚¤ãƒ³ãƒˆï¼Œãƒ¡ãƒˆãƒªã‚¯ã‚¹ ä»¥ä¸‹ã®ãƒªãƒ³ã‚¯ã‚’å‚è€ƒã«ã›ã‚ˆï¼ å‚è€ƒï¼šhttps://hiroki-it.github.io/tech-notebook-gitbook/public/observability_monitering/observability.html ãƒ¡ãƒˆãƒªã‚¯ã‚¹ã®åˆ†é¡å ãƒ»ãƒ‡ã‚£ãƒ¡ãƒ³ã‚·ãƒ§ãƒ³ï¼Œåå‰ç©ºé–“ï¼Œãƒ¡ãƒˆãƒªã‚¯ã‚¹å åˆ†é¡ç¾¤ èª¬æ˜ ãƒ‡ã‚£ãƒ¡ãƒ³ã‚·ãƒ§ãƒ³ ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’å˜ä½ã¨ã—ãŸåˆ†é¡åï¼ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹IDã§å‘½åã•ã‚Œã‚‹ï¼ åå‰ç©ºé–“ AWSãƒªã‚½ãƒ¼ã‚¹ã‚’å˜ä½ã¨ã—ãŸåˆ†é¡åï¼AWSãƒªã‚½ãƒ¼ã‚¹åã§è¡¨ç¾ã•ã‚Œã‚‹ï¼ ãƒ¡ãƒˆãƒªã‚¯ã‚¹å é›†è¨ˆå¯¾è±¡ã®ãƒ‡ãƒ¼ã‚¿ãƒã‚¤ãƒ³ãƒˆã®ç™ºç”Ÿé ˜åŸŸã‚’å˜ä½ã¨ã—ãŸåˆ†é¡åï¼ãƒ‡ãƒ¼ã‚¿ãƒã‚¤ãƒ³ãƒˆã®ç™ºç”Ÿé ˜åŸŸåã§è¡¨ç¾ã•ã‚Œã‚‹ï¼ å‚è€ƒï¼š https://docs.aws.amazon.com/ja_jp/AmazonCloudWatch/latest/monitoring/cloudwatch_concepts.html https://www.slideshare.net/AmazonWebServicesJapan/20190326-aws-black-belt-online-seminar-amazon-cloudwatch CloudWatchãƒ¡ãƒˆãƒªã‚¯ã‚¹ä¸Šã§ã¯ï¼Œä»¥ä¸‹ã®ã‚ˆã†ã«ç¢ºèªã§ãã‚‹ï¼ CloudWatch Synthetics ãƒ»CloudWatch Syntheticsã¨ã¯ åˆæˆç›£è¦–ã‚’è¡Œãˆã‚‹ã‚ˆã†ã«ãªã‚‹ï¼ 09-03. CloudWatchãƒ­ã‚° CloudWatchãƒ­ã‚° ã‚¯ãƒ©ã‚¦ãƒ‰ãƒ­ã‚°ã‚µãƒ¼ãƒã¨ã—ã¦åƒãï¼AWSãƒªã‚½ãƒ¼ã‚¹ã§ç”Ÿæˆã•ã‚ŒãŸãƒ­ã‚°ã‚’åé›†ã§ãã‚‹ï¼ãƒ­ã‚°ã«ã¤ã„ã¦ã¯ï¼Œä»¥ä¸‹ã®ãƒªãƒ³ã‚¯ã‚’å‚è€ƒã«ã›ã‚ˆï¼ å‚è€ƒï¼šhttps://hiroki-it.github.io/tech-notebook-gitbook/public/observability_monitering/observability.html è¨­å®šé …ç›® ãƒ»æ¦‚è¦ è¨­å®šé …ç›® èª¬æ˜ è£œè¶³ ãƒ­ã‚°ã‚°ãƒ«ãƒ¼ãƒ— ãƒ­ã‚°ã‚¹ãƒˆãƒªãƒ¼ãƒ ã‚’ã‚°ãƒ«ãƒ¼ãƒ—åŒ–ã—ã¦åé›†ã™ã‚‹ã‹ã©ã†ã‹ã‚’è¨­å®šã™ã‚‹ï¼ åŸºæœ¬çš„ã«ï¼Œãƒ­ã‚°ãƒ•ã‚¡ã‚¤ãƒ«ã¯ã‚°ãƒ«ãƒ¼ãƒ—åŒ–ã›ãšã«ï¼Œä¸€ã¤ã®ãƒ­ã‚°ã‚°ãƒ«ãƒ¼ãƒ—ã«ã¯ä¸€ã¤ã®ãƒ­ã‚°ã‚¹ãƒˆãƒªãƒ¼ãƒ ã—ã‹å«ã¾ã‚Œãªã„ã‚ˆã†ã«ã™ã‚‹ï¼ ãƒ¡ãƒˆãƒªã‚¯ã‚¹ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ãƒ‘ã‚¿ãƒ¼ãƒ³ã«åˆè‡´ã—ãŸæ–‡å­—åˆ—ã‚’æŒã¤ãƒ­ã‚°ã‚’ãƒˆãƒªã‚¬ãƒ¼ã¨ã—ã¦ï¼Œãƒ‡ãƒ¼ã‚¿ãƒã‚¤ãƒ³ãƒˆã‚’ç™ºç”Ÿã•ã›ã‚‹ï¼ã“ã‚Œã‚’åé›†ã™ã‚‹ãƒ¡ãƒˆãƒªã‚¯ã‚¹ã‚’è¨­å®šã™ã‚‹ï¼ ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ ãƒ»ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ãƒ‘ã‚¿ãƒ¼ãƒ³ ãƒ­ã‚°å†…ã§æ¤œçŸ¥ã™ã‚‹æ–‡å­—åˆ—ã‚’è¨­å®šã™ã‚‹ï¼å¤§æ–‡å­—ã¨å°æ–‡å­—ã‚’åŒºåˆ¥ã™ã‚‹ãŸã‚ï¼Œç¶²ç¾…çš„ã«è¨­å®šã™ã‚‹å¿…è¦ãŒã‚ã‚‹ï¼ å‚è€ƒï¼šhttps://qiita.com/shimajiri/items/81a4ed0fe39fe337fedb ï¼Šä¾‹ï¼Š ORæ¡ä»¶ã§å¤§æ–‡å­—å°æ–‡å­—ã‚’è€ƒæ…®ã—ï¼Œã€:ã€ãŒå«ã¾ã‚Œã‚‹ãƒ­ã‚°ã‚’æ¤œå‡ºã™ã‚‹ï¼ã“ã“ã§ã‚³ãƒ­ãƒ³ã‚’å«ã¾ã¦ã„ã‚‹ã®ã¯ï¼Œãƒ­ã‚°ã«å«ã¾ã‚Œã‚‹ãƒ•ã‚¡ã‚¤ãƒ«åã‚„ãƒ¡ã‚½ãƒƒãƒ‰åãŒèª¤ã£ã¦æ¤œçŸ¥ã•ã‚Œãªã„ã‚ˆã†ã™ã‚‹ãŸã‚ã§ã‚ã‚‹ï¼ ?\"WARNING:\" ?\"Warning:\" ?\"ERROR:\" ?\"Error:\" ?\"CRITICAL:\" ?\"Critical:\" ?\"EMERGENCY:\" ?\"Emergency:\" ?\"ALERT:\" ?\"Alert:\" ï¼Šä¾‹ï¼Š ORæ¡ä»¶ã§å¤§æ–‡å­—å°æ–‡å­—ã‚’è€ƒæ…®ã—ï¼Œã€ messageã€ãŒå«ã¾ã‚Œã‚‹ãƒ­ã‚°ã‚’æ¤œå‡ºã™ã‚‹ï¼ ?\"WARNING message\" ?\"Warning message\" ?\"ERROR message\" ?\"Error message\" ?\"CRITICAL message\" ?\"Critical message\" ?\"EMERGENCY message\" ?\"Emergency message\" ?\"ALERT message\" ?\"Alert message\" ï¼Šä¾‹ï¼Š ã€error:ã€ãŒå«ã¾ã‚Œï¼Œã‹ã¤ã€Fooã€ãŒå«ã¾ã‚Œãªã„ãƒ­ã‚°ã‚’æ¤œçŸ¥ã™ã‚‹ï¼ORæ¡ä»¶ã¨é™¤å¤–æ¡ä»¶ã‚’çµ„ã¿åˆã‚ã›ã‚ˆã†ã¨ã™ã‚‹ã¨ï¼ŒORæ¡ä»¶ãŒèªè­˜ã•ã‚Œãšã«é™¤å¤–æ¡ä»¶ã ã‘ãŒé©ç”¨ã•ã‚Œã¦ã—ã¾ã†ï¼ãã®ãŸã‚ï¼Œã“ã“ã§ã¯ORæ¡ä»¶ã‚’ä½¿ç”¨ã—ã¦ã„ãªã„ï¼ å‚è€ƒï¼šhttps://dev.classmethod.jp/articles/cloudwatch-metricsfilter-filterpattern/ \"error:\" -Foo CloudWatchãƒ­ã‚°ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆï¼ˆéæ¨å¥¨ï¼‰ ãƒ»CloudWatchãƒ­ã‚°ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã¨ã¯ ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹å†…ã§ç¨¼åƒã™ã‚‹å¸¸é§ã‚·ã‚¹ãƒ†ãƒ ã®ã“ã¨ï¼ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹å†…ã®ãƒ‡ãƒ¼ã‚¿ã‚’åé›†ã—ï¼ŒCloudWatchãƒ­ã‚°ã«å¯¾ã—ã¦é€ä¿¡ã™ã‚‹ï¼2020/10/05ç¾åœ¨ã¯éæ¨å¥¨ã§ï¼ŒCloudWatchã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã¸ã®è¨­å®šã®ç§»è¡ŒãŒæ¨å¥¨ã•ã‚Œã¦ã„ã‚‹ï¼ ãƒ»awslogs.confãƒ•ã‚¡ã‚¤ãƒ« ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹å†…ã®etcãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªä¸‹ã«awslogs.confãƒ•ã‚¡ã‚¤ãƒ«ã‚’ï¼Œè¨­ç½®ã™ã‚‹ï¼OSï¼ŒãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢ï¼Œã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ï¼Œã®å„å±¤ã§ãƒ­ã‚°ã‚’åé›†ã™ã‚‹ã®ãŒã‚ˆã„ï¼ å‚è€ƒï¼šhttps://docs.aws.amazon.com/ja_jp/AmazonCloudWatch/latest/logs/AgentReference.html#agent-configuration-file ï¼Šå®Ÿè£…ä¾‹ï¼Š ############################# # /var/awslogs/awslogs.conf ############################# # ------------------------------------------ # CentOS CloudWatch Logs # ------------------------------------------ [/var/log/messages] # ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ— #ï¼ˆä¾‹ï¼‰Jan 1 00:00:00 datetime_format = %b %d %H:%M:%S #ï¼ˆä¾‹ï¼‰2020-01-01 00:00:00 # datetime_format = %Y-%m-%d %H:%M:%S # åé›†ã—ãŸã„ãƒ­ã‚°ãƒ•ã‚¡ã‚¤ãƒ«ï¼ã“ã“ã§ã¯ï¼ŒCentOSã®ãƒ­ã‚°ã‚’æŒ‡å®šã™ã‚‹ï¼ file = /var/log/messages # æ–‡å­—ã‚³ãƒ¼ãƒ‰utf_8ã¨ã—ã¦é€ä¿¡ã™ã‚‹ï¼æ–‡å­—ã‚³ãƒ¼ãƒ‰ãŒåˆã‚ãªã„ã¨ï¼ŒCloudWatchãƒ­ã‚°ã®ç”»é¢ä¸Šã§æ–‡å­—åŒ–ã‘ã™ã‚‹ï¼ encoding = utf_8 # è¦å‹‰å¼· buffer_duration = 5000 initial_position = start_of_file # ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ID log_stream_name = {instance_id} # AWSä¸Šã§ç®¡ç†ã™ã‚‹ãƒ­ã‚°ã‚°ãƒ«ãƒ¼ãƒ—å log_group_name = /var/log/messages # ------------------------------------------ # Nginx CloudWatch Logs # ------------------------------------------ [/var/log/nginx/error.log] file = /var/log/nginx/error.log buffer_duration = 5000 log_stream_name = {instance_id} initial_position = start_of_file log_group_name = /var/log/nginx/error_log.production # ------------------------------------------ # Application CloudWatch Logs # ------------------------------------------ [/var/www/project/app/storage/logs/laravel.log] file = /var/www/project/app/storage/logs/laravel.log buffer_duration = 5000 log_stream_name = {instance_id} initial_position = start_of_file log_group_name = /var/www/project/app/storage/logs/laravel_log.production ############################# # /var/awslogs/awscli.conf ############################# [plugins] cwlogs = cwlogs [default] region = ap-northeast-1 ãƒ»ã‚³ãƒãƒ³ãƒ‰ è¨­å®šå¾Œï¼Œawslogsã‚³ãƒãƒ³ãƒ‰ã§ãƒ—ãƒ­ã‚»ã‚¹ã‚’èµ·å‹•ã™ã‚‹ï¼ ï¼Šã‚³ãƒãƒ³ãƒ‰ä¾‹ï¼Š # CloudWatchã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã®å†èµ·å‹• # æ³¨æ„: restartã ã¨CloudWatchã«åæ˜ ã•ã‚Œãªã„æ™‚ãŒã‚ã‚‹ï¼ $ service awslogs restart # ã‚‚ã—ãã¯ $ service awslogs stop $ service awslogs start # ãƒ­ã‚°ãŒæ–°ã—ãç”Ÿæˆã•ã‚Œãªã„ã¨å¤‰æ›´ãŒé©ç”¨ã•ã‚Œãªã„ã“ã¨ãŒã‚ã‚‹ãŸã‚ï¼Œãƒ­ã‚°ãƒ•ã‚¡ã‚¤ãƒ«ã«é©å½“ãªæ–‡å­—åˆ—è¡Œã‚’å¢—ã‚„ã—ã¦ã¿ã‚‹ï¼ Logã‚¤ãƒ³ã‚µã‚¤ãƒˆ ãƒ»Logã‚¤ãƒ³ã‚µã‚¤ãƒˆã¨ã¯ ã‚¯ã‚¨ãƒªã‚’ä½¿ç”¨ã—ã¦ãƒ­ã‚°ã‚’æŠ½å‡ºã™ã‚‹ï¼ ãƒ»ã‚¯ã‚¨ãƒªä¾‹ æ±ç”¨çš„ãªã‚¯ã‚¨ãƒªã‚’ç¤ºã™ï¼ å‚è€ƒï¼šhttps://docs.aws.amazon.com/ja_jp/AmazonCloudWatch/latest/logs/CWL_QuerySyntax.html ï¼Šä¾‹ï¼Š å°æ–‡å­—ã¨å¤§æ–‡å­—ã‚’åŒºåˆ¥ã›ãšã«ï¼ŒWarningã¾ãŸã¯Errorã‚’å«ã‚€ãƒ­ã‚°ã‚’æ¤œç´¢ã™ã‚‹ï¼ fields @timestamp, @message, @logStream | filter @message like /(?i)(Warning|Error)/ | sort @timestamp desc | limit 100 CLI ãƒ»ãƒ­ã‚°åé›†é‡ã‚’ç¢ºèª ï¼Šã‚³ãƒãƒ³ãƒ‰ä¾‹ï¼Š å…¨ã¦ã®ãƒ­ã‚°ã‚°ãƒ«ãƒ¼ãƒ—ã«å¯¾ã—ã¦ï¼Œä¸€æ—¥å½“ãŸã‚Šã®åé›†é‡ã‚’start-timeã‹ã‚‰end-timeã®é–“ã§å–å¾—ã™ã‚‹ï¼--dimensionsã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’ä½¿ç”¨ã—ã¦ï¼Œç‰¹å®šã®ãƒ‡ã‚£ãƒ¡ãƒ³ã‚·ãƒ§ãƒ³ï¼ˆãƒ­ã‚°ã‚°ãƒ«ãƒ¼ãƒ—ï¼‰ã«å¯¾ã—ã¦é›†è¨ˆã‚’å®Ÿè¡Œã™ã‚‹ã“ã¨ã‚‚ã§ãã‚‹ï¼ï¼ˆãŸã ï¼Œã‚„ã£ã¦ã¿ãŸã‘ã©ã†ã¾ãã„ã‹ãšï¼‰ å‚è€ƒï¼šhttps://docs.aws.amazon.com/cli/latest/reference/cloudwatch/get-metric-statistics.html $ aws cloudwatch get-metric-statistics \\ --namespace AWS/Logs \\ --metric-name IncomingBytes \\ --start-time \"2021-08-01T00:00:00\" \\ --end-time \"2021-08-31T23:59:59\" \\ --period 86400 --statistics Sum | jq -r \".Datapoints[] | [.Timestamp, .Sum] | @csv\" | sort 09-04. CloudWatchã‚¢ãƒ©ãƒ¼ãƒ  è¨­å®šé …ç›® ãƒ»ãƒ­ã‚°ãŒå¯¾è±¡ã®å ´åˆ è¨­å®šé …ç›® èª¬æ˜ è£œè¶³ åå‰ç©ºé–“ ç´ä»˜ããƒ­ã‚°ã‚°ãƒ«ãƒ¼ãƒ—ãŒå±ã™ã‚‹åå‰ç©ºé–“ã‚’è¨­å®šã™ã‚‹ï¼CloudWatchãƒ­ã‚°ãŒï¼Œè¨­å®šã—ãŸåå‰ç©ºé–“ã«å¯¾ã—ã¦ï¼Œå€¤ã‚’ç™ºè¡Œã™ã‚‹ï¼ ãƒ¡ãƒˆãƒªã‚¯ã‚¹ ç´ä»˜ããƒ­ã‚°ã‚°ãƒ«ãƒ¼ãƒ—ãŒå±ã™ã‚‹åå‰ç©ºé–“å†…ã®ãƒ¡ãƒˆãƒªã‚¯ã‚¹ã‚’è¨­å®šã™ã‚‹ï¼CloudWatchãƒ­ã‚°ãŒï¼Œè¨­å®šã—ãŸãƒ¡ãƒˆãƒªã‚¯ã‚¹ã«å¯¾ã—ã¦ï¼Œå€¤ã‚’ç™ºè¡Œã™ã‚‹ï¼ ãƒ¡ãƒˆãƒªã‚¯ã‚¹å€¤ ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ãƒ‘ã‚¿ãƒ¼ãƒ³ã§ãƒ­ã‚°ãŒæ¤œçŸ¥ã•ã‚ŒãŸæ™‚ã«ï¼Œãƒ‡ãƒ¼ã‚¿ãƒã‚¤ãƒ³ãƒˆã¨ã—ã¦ç™ºç”Ÿã•ã›ã‚‹å€¤ã®ã“ã¨ï¼ ä¾‹ãˆã°ã€æ¤œå‡ºæ•°ã€ã‚’ç™ºè¡Œã™ã‚‹å ´åˆã¯ï¼Œã€ï¼‘ã€ã‚’è¨­å®šã™ã‚‹ï¼ ãƒ»ãƒ¡ãƒˆãƒªã‚¯ã‚¹ãŒå¯¾è±¡ã®å ´åˆ ãƒ»æ¡ä»¶ è¨­å®šé …ç›® èª¬æ˜ è£œè¶³ é–¾å€¤ã®ç¨®é¡ ã‚¢ãƒ©ãƒ¼ãƒ ã‚’å®Ÿè¡Œã™ã‚‹ãƒ‡ãƒ¼ã‚¿ãƒã‚¤ãƒ³ãƒˆ ã‚¢ãƒ©ãƒ¼ãƒˆã‚’ç™ºç”Ÿã•ã›ã‚‹ãƒ‡ãƒ¼ã‚¿ãƒã‚¤ãƒ³ãƒˆæ•°ã‚’è¨­å®šã™ã‚‹ï¼ æ¬ è½ãƒ‡ãƒ¼ã‚¿ã®å‡¦ç† ãƒ‡ãƒ¼ã‚¿ãƒã‚¤ãƒ³ãƒˆãŒç™ºç”Ÿã—ãªã„ã“ã¨ã‚’ã©ã†åˆ¤å®šã™ã‚‹ã‹ã‚’è¨­å®šã™ã‚‹ï¼ ãƒ‡ãƒ¼ã‚¿ãƒã‚¤ãƒ³ãƒˆãŒç™ºç”Ÿã—ãªã„ã“ã¨ã‚’æ­£å¸¸ã¨è¦‹ãªã™å ´åˆã¯ã€notBreachingã€ã¨ã—ï¼Œç™ºç”Ÿã—ãªã„ã“ã¨ã‚’ç•°å¸¸ã¨ã™ã‚‹å ´åˆã¯ï¼Œã€breachingã€ã¨ã™ã‚‹ï¼å‚è€ƒï¼šhttps://docs.aws.amazon.com/ja_jp/AmazonCloudWatch/latest/monitoring/AlarmThatSendsEmail.html#alarms-and-missing-data CLI ãƒ»CloudWatchã‚¢ãƒ©ãƒ¼ãƒ ã®çŠ¶æ…‹å¤‰æ›´ ï¼Šã‚³ãƒãƒ³ãƒ‰ä¾‹ï¼Š CloudWatchã‚¢ãƒ©ãƒ¼ãƒ ã®çŠ¶æ…‹ã‚’å¤‰æ›´ã™ã‚‹ï¼ $ aws cloudwatch set-alarm-state \\ --alarm-name \"prd-foo-alarm\" \\ --state-value ALARM \\ --state-reason \"ã‚¢ãƒ©ãƒ¼ãƒ !!\" 10. Codeç³»ã‚µãƒ¼ãƒ“ã‚¹ CodePipeline ãƒ»CodePipelineã¨ã¯ CodeCommitï¼ŒCodeBuildï¼ŒCodeDeployã‚’é€£æºã•ã›ã¦ï¼ŒAWSã«å¯¾ã™ã‚‹CI/CDç’°å¢ƒã‚’æ§‹ç¯‰ã™ã‚‹ï¼CodeCommitã¯ï¼Œä»–ã®ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ç®¡ç†ã‚µãƒ¼ãƒ“ã‚¹ã§ä»£ç”¨ã§ãã‚‹ï¼ ãƒ»CodeCommitã¨ã¯ ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã‚’ãƒãƒ¼ã‚¸ãƒ§ãƒ³ç®¡ç†ã™ã‚‹ï¼ ãƒ»CodeBuildã¨ã¯ ãƒ“ãƒ«ãƒ‰ãƒ•ã‚§ãƒ¼ã‚ºã¨ãƒ†ã‚¹ãƒˆãƒ•ã‚§ãƒ¼ã‚ºã‚’å®Ÿè¡Œã™ã‚‹ï¼ ãƒ»CodeDeployã¨ã¯ ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ•ã‚§ãƒ¼ã‚ºã‚’å®Ÿè¡Œã™ã‚‹ï¼ CodeBuild ãƒ»buildspec.ymlãƒ•ã‚¡ã‚¤ãƒ« CodeBuildã®è¨­å®šã‚’è¡Œã†ï¼ãƒ«ãƒ¼ãƒˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã®ç›´ä¸‹ã«é…ç½®ã—ã¦ãŠãï¼ å‚è€ƒï¼šhttps://docs.aws.amazon.com/ja_jp/codebuild/latest/userguide/build-spec-ref.html version: 0.2 phases: install: runtime-versions: docker: 18 preBuild: commands: # ECRã«ãƒ­ã‚°ã‚¤ãƒ³ - $(aws ecr get-login --no-include-email --region ${AWS_DEFAULT_REGION}) # ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚¿ã‚°ã¯GitHubã‚³ãƒŸãƒƒãƒˆã®ãƒãƒƒã‚·ãƒ¥å€¤ã‚’ä½¿ç”¨ - IMAGE_TAG=$CODEBUILD_RESOLVED_SOURCE_VERSION # ECRã®URLã‚’CodeBuildã®ç’°å¢ƒå¤‰æ•°ã‹ã‚‰ä½œæˆ - REPOSITORY_URI=${AWS_ACCOUNT_ID}.dkr.ecr.${AWS_DEFAULT_REGION}.amazonaws.com/${IMAGE_REPO_NAME} build: commands: # ã‚¿ã‚°ä»˜ã‘ã—ã¦ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’ãƒ“ãƒ«ãƒ‰ - docker build -t REPOSITORY_URI:$IMAGE_TAG -f Dockerfile . postBuild: commands: # ECRã«ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’ãƒ—ãƒƒã‚·ãƒ¥ - docker push $REPOSITORY_URI:$IMAGE_TAG # ECRã«ã‚ã‚‹ãƒ‡ãƒ—ãƒ­ã‚¤å¯¾è±¡ã®ã‚¤ãƒ¡ãƒ¼ã‚¸ã®æƒ…å ±ï¼ˆimageDetail.jsonï¼‰ - printf \"{\"Version\":\"1.0\",\"ImageURI\":\"%s\"}\" $REPOSITORY_URI:$IMAGE_TAG > imageDetail.json # ãƒ‡ãƒ—ãƒ­ã‚¤å¯¾è±¡ã¨ã™ã‚‹ãƒ“ãƒ«ãƒ‰ã®ã‚¢ãƒ¼ãƒ†ã‚£ãƒ•ã‚¡ã‚¯ãƒˆ artifacts: files: imageDetail.json ãƒ»ãƒ“ãƒ«ãƒ‰æ™‚ã«ä½œæˆã™ã¹ããƒ‡ãƒ—ãƒ­ã‚¤è¨­å®šãƒ•ã‚¡ã‚¤ãƒ« ãƒ‡ãƒ—ãƒ­ã‚¤å¯¾è±¡ã¨ãªã‚‹ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’å®šç¾©ã™ã‚‹ãŸã‚ã«ï¼Œæ¨™æº–ãƒ‡ãƒ—ãƒ­ã‚¤ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã®å ´åˆã«ã¯imagedefinitions.jsonãƒ•ã‚¡ã‚¤ãƒ«ï¼Œã¾ãŸã¯Blue/Greenãƒ‡ãƒ—ãƒ­ã‚¤ãƒ¡ãƒ³ãƒˆã®å ´åˆã«ã¯imageDetail.jsonãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç”¨æ„ã™ã‚‹å¿…è¦ãŒã‚ã‚‹ï¼ã“ã‚Œã¯ãƒªãƒã‚¸ãƒˆãƒªã«äº‹å‰ã«é…ç½®ã™ã‚‹ã®ã§ã¯ãªãï¼Œãƒ“ãƒ«ãƒ‰æ™‚ã«è‡ªå‹•çš„ã«ä½œæˆã™ã‚‹ã‚ˆã†ã«ã—ãŸæ–¹ãŒã‚ˆã„ï¼ å‚è€ƒï¼šhttps://docs.aws.amazon.com/ja_jp/codepipeline/latest/userguide/file-reference.html CodeDeployã«ã‚ˆã‚‹Blue/Greenãƒ‡ãƒ—ãƒ­ã‚¤ãƒ¡ãƒ³ãƒˆ ãƒ»Blue/Greenãƒ‡ãƒ—ãƒ­ã‚¤ãƒ¡ãƒ³ãƒˆã¨ã¯ ä»¥ä¸‹ã®æ‰‹é †ã§ãƒ‡ãƒ—ãƒ­ã‚¤ã‚’è¡Œã†ï¼ ECRã®ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’æ›´æ–° ã‚¿ã‚¹ã‚¯å®šç¾©ã®æ–°ã—ã„ãƒªãƒ“ã‚¸ãƒ§ãƒ³ã‚’æ§‹ç¯‰ï¼ ã‚µãƒ¼ãƒ“ã‚¹ã‚’æ›´æ–°ï¼ CodeDeployã«ã‚ˆã£ã¦ï¼Œã‚¿ã‚¹ã‚¯å®šç¾©ã‚’åŸºã«ï¼Œç¾è¡Œã®æœ¬ç•ªç’°å¢ƒï¼ˆProdãƒ–ãƒ«ãƒ¼ï¼‰ã®ã‚¿ã‚¹ã‚¯ã¨ã¯åˆ¥ã«ï¼Œãƒ†ã‚¹ãƒˆç’°å¢ƒï¼ˆTestã‚°ãƒªãƒ¼ãƒ³ï¼‰ãŒæ§‹ç¯‰ã•ã‚Œã‚‹ï¼ãƒ­ãƒ¼ãƒ‰ãƒãƒ©ãƒ³ã‚µãƒ¼ã®æ¥ç¶šå…ˆã‚’ï¼Œæœ¬ç•ªç’°å¢ƒï¼ˆProdãƒ–ãƒ«ãƒ¼ï¼‰ã®ã‚¿ãƒ¼ã‚²ãƒƒãƒˆã‚°ãƒ«ãƒ¼ãƒ—ï¼ˆPrimaryã‚¿ãƒ¼ã‚²ãƒƒãƒˆã‚°ãƒ«ãƒ¼ãƒ—ï¼‰ã«åŠ ãˆã¦ï¼Œãƒ†ã‚¹ãƒˆç’°å¢ƒï¼ˆTestã‚°ãƒªãƒ¼ãƒ³ï¼‰ã«ã‚‚å‘ã‘ã‚‹ï¼ ç¤¾å†…ã‹ã‚‰ãƒ†ã‚¹ãƒˆç’°å¢ƒï¼ˆTestã‚°ãƒªãƒ¼ãƒ³ï¼‰ã®ALBã«ï¼Œç‰¹å®šã®ãƒãƒ¼ãƒˆç•ªå·ã§ã‚¢ã‚¯ã‚»ã‚¹ã—ï¼Œå‹•ä½œã‚’ç¢ºèªã™ã‚‹ï¼ å‹•ä½œç¢ºèªã§å•é¡Œãªã‘ã‚Œã°ï¼ŒConsoleç”»é¢ã‹ã‚‰ã®å…¥åŠ›ã§ï¼Œãƒ­ãƒ¼ãƒ‰ãƒãƒ©ãƒ³ã‚µãƒ¼ã®æ¥ç¶šå…ˆã‚’ãƒ†ã‚¹ãƒˆç’°å¢ƒï¼ˆTestã‚°ãƒªãƒ¼ãƒ³ï¼‰ã®ã¿ã«è¨­å®šã™ã‚‹ï¼ ãƒ†ã‚¹ãƒˆç’°å¢ƒï¼ˆTestã‚°ãƒªãƒ¼ãƒ³ï¼‰ãŒæ–°ã—ã„æœ¬ç•ªç’°å¢ƒã¨ã—ã¦ãƒ¦ãƒ¼ã‚¶ã«å…¬é–‹ã•ã‚Œã‚‹ï¼ å…ƒã€…ã®æœ¬ç•ªç’°å¢ƒï¼ˆProdãƒ–ãƒ«ãƒ¼ï¼‰ã¯å‰Šé™¤ã•ã‚Œã‚‹ï¼ ãƒ»appspec.ymlãƒ•ã‚¡ã‚¤ãƒ« CodeDeployã®è¨­å®šã‚’è¡Œã†ï¼ãƒ«ãƒ¼ãƒˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã®ç›´ä¸‹ã«é…ç½®ã—ã¦ãŠãï¼ä»•æ§˜ã¨ã—ã¦ï¼Œè¤‡æ•°ã®ã‚³ãƒ³ãƒ†ãƒŠã‚’ãƒ‡ãƒ—ãƒ­ã‚¤ã§ããªã„ï¼ã‚¿ã‚¹ã‚¯å®šç¾©åã‚’ã¨ã™ã‚‹ã¨ï¼Œè‡ªå‹•è£œå®Œã—ã¦ãã‚Œã‚‹ï¼ å‚è€ƒï¼šhttps://docs.aws.amazon.com/codedeploy/latest/userguide/reference-appspec-file-structure-resources.html version: 0.0 Resources: - TargetService: # ä½¿ç”¨ã™ã‚‹AWSãƒªã‚½ãƒ¼ã‚¹ Type: AWS::ECS::Service Properties: # ä½¿ç”¨ã™ã‚‹ã‚¿ã‚¹ã‚¯å®šç¾© TaskDefinition: \"\" # ä½¿ç”¨ã™ã‚‹ãƒ­ãƒ¼ãƒ‰ãƒãƒ©ãƒ³ã‚µãƒ¼ LoadBalancerInfo: ContainerName: \"\" ContainerPort: \"80\" PlatformVersion: \"1.4.0\" ãƒ»taskdef.jsonãƒ•ã‚¡ã‚¤ãƒ« ãƒ‡ãƒ—ãƒ­ã‚¤ã•ã‚Œã‚‹ã‚¿ã‚¹ã‚¯å®šç¾©ã‚’å®Ÿè£…ã—ï¼Œãƒ«ãƒ¼ãƒˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã®ç›´ä¸‹ã«é…ç½®ã™ã‚‹ï¼CodeDeployã¯ï¼ŒCodeBuildã‹ã‚‰æ¸¡ã•ã‚ŒãŸimageDetail.jsonãƒ•ã‚¡ã‚¤ãƒ«ã‚’æ¤œçŸ¥ã—ï¼ŒECRã‹ã‚‰ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’å–å¾—ã™ã‚‹ï¼ã“ã®æ™‚ï¼Œtaskdef.jsonãƒ•ã‚¡ã‚¤ãƒ«ã®ã‚¤ãƒ¡ãƒ¼ã‚¸åã‚’ã¨ã—ã¦ãŠãã¨ï¼ŒECRã‹ã‚‰å–å¾—ã—ãŸã‚¤ãƒ¡ãƒ¼ã‚¸åã‚’ä½¿ç”¨ã—ã¦ï¼Œè‡ªå‹•è£œå®Œã—ã¦ãã‚Œã‚‹ï¼ { \"family\": \"\", \"requiresCompatibilities\": [ \"FARGATE\" ], \"networkMode\": \"awsvpc\", \"taskRoleArn\": \"\", \"executionRoleArn\": \"\", \"cpu\": \"512\", \"memory\": \"1024\", \"containerDefinitions\": [ { \"name\": \"\", \"image\": \"\", \"essential\": true, \"portMappings\": [ { \"containerPort\": 80, \"hostPort\": 80, \"protocol\": \"tcp\" } ], \"secrets\": [ { \"name\": \"DB_HOST\", \"valueFrom\": \"/ecs/DB_HOST\" }, { \"name\": \"DB_DATABASE\", \"valueFrom\": \"/ecs/DB_DATABASE\" }, { \"name\": \"DB_PASSWORD\", \"valueFrom\": \"/ecs/DB_PASSWORD\" }, { \"name\": \"DB_USERNAME\", \"valueFrom\": \"/ecs/DB_USERNAME\" }, { \"name\": \"REDIS_HOST\", \"valueFrom\": \"/ecs/REDIS_HOST\" }, { \"name\": \"REDIS_PASSWORD\", \"valueFrom\": \"/ecs/REDIS_PASSWORD\" }, { \"name\": \"REDIS_PORT\", \"valueFrom\": \"/ecs/REDIS_PORT\" } ], \"logConfiguration\": { \"logDriver\": \"awslogs\", \"options\": { \"awslogs-group\": \"\", # ã‚¹ã‚¿ãƒƒã‚¯ãƒˆãƒ¬ãƒ¼ã‚¹ã®ãƒ­ã‚°ã‚’ç´ä»˜ã‘ã‚‰ã‚Œã‚‹ã‚ˆã†ã«ï¼Œæ—¥ä»˜ã§åŒºåˆ‡ã‚‹ã‚ˆã†ã«ã™ã‚‹ï¼ \"awslogs-datetime-format\": \"\\\\[%Y-%m-%d %H:%M:%S\\\\]\", \"awslogs-region\": \"\", \"awslogs-stream-prefix\": \"\" } } } ] } CodeDeployã«ã‚ˆã‚‹ã‚¤ãƒ³ãƒ—ãƒ¬ãƒ¼ã‚¹ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ¡ãƒ³ãƒˆ 11. EBSï¼šElastic Block Storage EBSã¨ã¯ ã‚¯ãƒ©ã‚¦ãƒ‰å†…è”µã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã¨ã—ã¦åƒãï¼ è¨­å®šé …ç›® ãƒ»ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã®ç¨®é¡ã¨ãƒœãƒªãƒ¥ãƒ¼ãƒ ã‚¿ã‚¤ãƒ— ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã®ç¨®é¡ ãƒœãƒªãƒ¥ãƒ¼ãƒ å SSD æ±ç”¨SSD SSD ãƒ—ãƒ­ãƒ“ã‚¸ãƒ§ãƒ³ãƒ‰ IOPS SSD HDD ã‚¹ãƒ«ãƒ¼ãƒ—ãƒƒãƒˆæœ€é©åŒ– HDD HDD Cold HDD ãƒ»æœ€å°ãƒœãƒªãƒ¥ãƒ¼ãƒ  è¸ã¿å°ã‚µãƒ¼ãƒã‚’æ§‹ç¯‰ã™ã‚‹æ™‚ï¼Œã§ãã‚‹ã ã‘æœ€å°é™ã®ãƒœãƒªãƒ¥ãƒ¼ãƒ ã‚’é¸æŠã—ï¼Œã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸åˆè¨ˆã‚’æŠ‘ãˆã‚‹å¿…è¦ãŒã‚ã‚‹ï¼ OS ä»®æƒ³ãƒ¡ãƒ¢ãƒª ãƒœãƒªãƒ¥ãƒ¼ãƒ ã‚µã‚¤ã‚º Amazon Linux t2.micro 8 CentOS t2.micro 10 12. EC2ï¼šElastic Computer Cloud EC2ã¨ã¯ ã‚¯ãƒ©ã‚¦ãƒ‰ã‚µãƒ¼ãƒã¨ã—ã¦åƒãï¼æ³¨æ„ç‚¹ãŒã‚ã‚‹ã‚‚ã®ã ã‘ã¾ã¨ã‚ã‚‹ï¼ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹ã«ã¤ã„ã¦ã¯ï¼Œä»¥ä¸‹ã®ãƒªãƒ³ã‚¯ã‚’å‚è€ƒã«ã›ã‚ˆï¼ å‚è€ƒï¼šhttps://docs.aws.amazon.com/ja_jp/AWSEC2/latest/UserGuide/ec2-best-practices.html è¨­å®šé …ç›® ãƒ»æ¦‚è¦ è¨­å®šé …ç›® èª¬æ˜ è£œè¶³ AMIï¼šAmazonãƒã‚·ãƒ³ã‚¤ãƒ¡ãƒ¼ã‚¸ OSã‚’é¸æŠã™ã‚‹ï¼ ãƒ™ãƒ³ãƒ€ãƒ¼å…¬å¼ã®ã‚‚ã®ã‚’é¸æŠã™ã‚‹ã“ã¨ï¼ï¼ˆä¾‹ï¼šCentOSã®AMIä¸€è¦§ https://wiki.centos.org/Cloud/AWSï¼‰ ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã®è©³ç´°è¨­å®š EC2ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã®è¨­å®šã™ã‚‹ï¼ ãƒ»ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹è‡ªå‹•å‰²ã‚Šå½“ã¦ãƒ‘ãƒ–ãƒªãƒƒã‚¯ã«ã¦ï¼ŒEC2ã«å‹•çš„ãƒ‘ãƒ–ãƒªãƒƒã‚¯IPã‚’å‰²ã‚Šå½“ã¦ã‚‹ï¼EC2ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹æ§‹ç¯‰å¾Œã«æœ‰åŠ¹ã«ã§ããªã„ï¼ãƒ»çµ‚äº†ä¿è­·ã¯å¿…ãšæœ‰åŠ¹ã«ã™ã‚‹ã“ã¨ï¼ ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã®è¿½åŠ  EBSãƒœãƒªãƒ¥ãƒ¼ãƒ ã‚’è¨­å®šã™ã‚‹ï¼ ä¸€èˆ¬çš„ãªã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã§ã‚ã‚Œã°ï¼Œ20ï½30GiBã§ã‚ˆã„ï¼è¸ã¿å°ã‚µãƒ¼ãƒã®å ´åˆï¼Œæœ€ä½é™ã§è‰¯ã„ãŸã‚ï¼ŒOSã®ä¸‹é™ã¾ã§ã‚µã‚¤ã‚ºã‚’ä¸‹ã’ã‚‹ï¼ï¼ˆä¾‹ï¼šAmazonLinuxã®ä¸‹é™ã¯8GiBï¼ŒCentOSã¯10GiBï¼‰ ã‚­ãƒ¼ãƒšã‚¢ EC2ã®ç§˜å¯†éµã«å¯¾å¿œã—ãŸå…¬é–‹éµã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã§ãã‚‹ï¼ ã‚­ãƒ¼ãƒšã‚¢ã«å‰²ã‚Šå½“ã¦ã‚‰ã‚Œã‚‹ãƒ•ã‚£ãƒ³ã‚¬ãƒ¼ãƒ—ãƒªãƒ³ãƒˆå€¤ã‚’èª¿ã¹ã‚‹ã“ã¨ã§ï¼Œå…¬é–‹éµã¨ç§˜å¯†éµã®å¯¾å¿œé–¢ä¿‚ã‚’èª¿ã¹ã‚‹ã“ã¨ãŒã§ãã‚‹ï¼ ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã®ãƒ€ã‚¦ãƒ³ã‚¿ã‚¤ãƒ  ãƒ»ãƒ€ã‚¦ãƒ³ã‚¿ã‚¤ãƒ ã®ç™ºç”Ÿæ¡ä»¶ ä»¥ä¸‹ã®æ¡ä»¶ã®æ™‚ã«EC2ã«ãƒ€ã‚¦ãƒ³ã‚¿ã‚¤ãƒ ãŒç™ºç”Ÿã™ã‚‹ï¼EC2ã‚’å†—é•·åŒ–ã—ã¦ã„ã‚‹å ´åˆã¯ï¼Œãƒ¦ãƒ¼ã‚¶ã«å½±éŸ¿ã‚’ä¸ãˆãšã«å¯¾å‡¦ã§ãã‚‹ï¼ãƒ€ã‚¦ãƒ³ã‚¿ã‚¤ãƒ ãŒç™ºç”Ÿã™ã‚‹æ–¹ã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’äº‹å‰ã«ALBã®ã‚¿ãƒ¼ã‚²ãƒƒãƒˆã‚°ãƒ«ãƒ¼ãƒ—ã‹ã‚‰è§£é™¤ã—ã¦ãŠãï¼Œåœæ­¢ã—ãŸã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ãŒèµ·å‹•ã—ãŸå¾Œã«ï¼Œã‚¿ãƒ¼ã‚²ãƒƒãƒˆã‚°ãƒ«ãƒ¼ãƒ—ã«å†ç™»éŒ²ã™ã‚‹ï¼ å¤‰æ›´ã™ã‚‹é …ç›® ãƒ€ã‚¦ãƒ³ã‚¿ã‚¤ãƒ ã®æœ‰ç„¡ è£œè¶³ ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚¿ã‚¤ãƒ— ã‚ã‚Š ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚¿ã‚¤ãƒ—ã‚’å¤‰æ›´ã™ã‚‹ãŸã‚ã«ã¯EC2ã‚’åœæ­¢ã™ã‚‹å¿…è¦ãŒã‚ã‚‹ï¼ãã®ãŸã‚ï¼Œãƒ€ã‚¦ãƒ³ã‚¿ã‚¤ãƒ ãŒç™ºç”Ÿã™ã‚‹ï¼ ãƒ›ã‚¹ãƒˆç‰©ç†ã‚µãƒ¼ãƒã®ãƒªã‚¿ã‚¤ã‚¢ãƒ¡ãƒ³ãƒˆ ã‚ã‚Š AWSã‹ã‚‰å®šæœŸçš„ã«ãƒªã‚¿ã‚¤ã‚¢ãƒ¡ãƒ³ãƒˆã«é–¢ã™ã‚‹è­¦å‘Šãƒ¡ãƒ¼ãƒ«ãŒå±Šãï¼ãƒ«ãƒ¼ãƒˆãƒ‡ãƒã‚¤ã‚¹ã‚¿ã‚¤ãƒ—ãŒã€EBSã€ã®å ´åˆï¼Œãƒ›ã‚¹ãƒˆç‰©ç†ã‚µãƒ¼ãƒã®å¼•ã£è¶Šã—ã‚’è¡Œã†ãŸã‚ã«EC2ã®åœæ­¢ã¨èµ·å‹•ãŒå¿…è¦ã§ã‚ã‚‹ï¼ãã®ãŸã‚ï¼Œãƒ€ã‚¦ãƒ³ã‚¿ã‚¤ãƒ ãŒç™ºç”Ÿã™ã‚‹ï¼ãªãŠï¼Œå†èµ·å‹•ã§ã¯å¼•ã£è¶Šã—ã§ããªã„ï¼ ã‚¹ãƒšãƒƒã‚¯ ãƒ»ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚¿ã‚¤ãƒ— ã€ä¸–ä»£ã€ã¨ã€å¤§ãã•ã€ã‹ã‚‰ãªã‚‹åå‰ã§æ§‹æˆã•ã‚Œã‚‹ï¼ä¸–ä»£ã®æ•°å­—ãŒä¸ŠãŒã‚‹ã«ã¤ã‚Œã¦ï¼Œã‚ˆã‚Šå°ã•ãªä¸–ä»£ã¨åŒã˜å¤§ãã•ã§ã‚ã£ã¦ã‚‚ï¼Œãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã¨ä½ã‚³ã‚¹ãƒˆã«ãªã‚‹ï¼AMIã®OSã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã«ã‚ˆã£ã¦ã¯ï¼Œæ–°ã—ãç™»å ´ã—ãŸã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚¿ã‚¤ãƒ—ã‚’é©ç”¨ã§ããªã„ã“ã¨ãŒã‚ã‚‹ãŸã‚æ³¨æ„ã™ã‚‹ï¼ä¾‹ãˆã°ï¼ŒCentOS 6ç³»ã®AMIã§ã¯ï¼Œt3.smallã‚’é¸æŠã§ããªã„ï¼ å‚è€ƒï¼šhttps://aws.amazon.com/marketplace/pp/prodview-gkh3rqhqbgzme?ref=cns_srchrow ç¨®é¡ ä¸–ä»£ t2ï¼Œt3ï¼Œt3aï¼Œt4gï¼Œa1 å¤§ãã• nanoï¼Œsmallï¼Œmediumï¼Œlargeï¼Œxlargeï¼Œ2xlarge ãƒ»ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ EBSã®èª¬æ˜ã‚’å‚è€ƒã«ã›ã‚ˆï¼ ãƒ»CPUãƒãƒ¼ã‚¹ãƒˆãƒ¢ãƒ¼ãƒ‰ ãƒãƒ¼ã‚¹ãƒˆãƒ¢ãƒ¼ãƒ‰ã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚¿ã‚¤ãƒ—ã®å ´åˆï¼Œä¸€å®šæ°´æº–ã®ãƒ™ãƒ¼ã‚¹ãƒ©ã‚¤ãƒ³CPUä½¿ç”¨ç‡ã‚’æä¾›ã—ã¤ã¤ï¼Œã“ã‚Œã‚’è¶…éã§ãã‚‹ï¼CPUä½¿ç”¨ç‡ãŒãƒ™ãƒ¼ã‚¹ãƒ©ã‚¤ãƒ³ã‚’è¶…ãˆãŸã¨ãï¼Œè¶…éã—ãŸåˆ†ã ã‘EC2ã¯CPUã‚¯ãƒ¬ã‚¸ãƒƒãƒˆã‚’æ¶ˆè²»ã™ã‚‹ï¼CPUã‚¯ãƒ¬ã‚¸ãƒƒãƒˆã¯ä¸€å®šã®å‰²åˆã§å›å¾©ã™ã‚‹ï¼è“„ç©ã§ãã‚‹æœ€å¤§CPUã‚¯ãƒ¬ã‚¸ãƒƒãƒˆï¼Œã‚¯ãƒ¬ã‚¸ãƒƒãƒˆã®å›å¾©ç‡ï¼Œãƒ™ãƒ¼ã‚¹ãƒ©ã‚¤ãƒ³CPUä½¿ç”¨ç‡ã¯ï¼Œã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚¿ã‚¤ãƒ—ã«ã‚ˆã£ã¦ç•°ãªã‚‹ï¼è©³ã—ãã¯ä»¥ä¸‹ã®ãƒªãƒ³ã‚¯ã‚’å‚è€ƒã«ã›ã‚ˆï¼ å‚è€ƒï¼šhttps://docs.aws.amazon.com/ja_jp/AWSEC2/latest/UserGuide/burstable-performance-instances.html ã‚­ãƒ¼ãƒšã‚¢ ãƒ»ã‚­ãƒ¼ãƒšã‚¢ã®ãƒ•ã‚£ãƒ³ã‚¬ãƒ¼ãƒ—ãƒªãƒ³ãƒˆå€¤ ãƒ­ãƒ¼ã‚«ãƒ«ã«ç½®ã‹ã‚Œã¦ã„ã‚‹ç§˜å¯†éµãŒï¼Œè©²å½“ã™ã‚‹EC2ã«ç½®ã‹ã‚Œã¦ã„ã‚‹å…¬é–‹éµã¨ãƒšã‚¢ãªã®ã‹ã©ã†ã‹ï¼Œãƒ•ã‚£ãƒ³ã‚¬ãƒ¼ãƒ—ãƒªãƒ³ãƒˆå€¤ã‚’ç…§åˆã—ã¦ç¢ºèªã™ã‚‹æ–¹æ³• $ openssl pkcs8 \\ -in .pem \\ -inform PEM \\ -outform DER \\ -topk8 \\ -nocrypt | openssl sha1 -c ãƒ»EC2ã¸ã®SSHæ¥ç¶š ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã®SSHãƒ—ãƒ­ãƒˆã‚³ãƒ«ã®ãƒ‘ã‚±ãƒƒãƒˆã¯ï¼Œã¾ãšã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆã‚’çµŒç”±ã—ã¦ï¼Œã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆã‚²ãƒ¼ãƒˆã‚¦ã‚§ã‚¤ã‚’é€šéã™ã‚‹ï¼ãã®å¾Œï¼ŒRoute53ï¼ŒALBã‚’çµŒç”±ã›ãšï¼Œãã®ã¾ã¾EC2ã¸å‘ã‹ã†ï¼ 13. ECR ECRã¨ã¯ AWSãŒæä¾›ã™ã‚‹Dockerã‚¤ãƒ¡ãƒ¼ã‚¸ã®ãƒ¬ã‚¸ã‚¹ãƒˆãƒªã‚µãƒ¼ãƒ“ã‚¹ è¨­å®šé …ç›® ãƒ»æ¦‚è¦ è¨­å®šé …ç›® èª¬æ˜ è£œè¶³ å¯è¦–æ€§ ãƒªãƒã‚¸ãƒˆãƒªã‚’ãƒ‘ãƒ–ãƒªãƒƒã‚¯ã‚¢ã‚¯ã‚»ã‚¹ï¼ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆã‚¢ã‚¯ã‚»ã‚¹ã«ã™ã‚‹ã‹ã‚’è¨­å®šã™ã‚‹ï¼ æ§˜ã€…ãªãƒ™ãƒ³ãƒ€ãƒ¼ãŒãƒ‘ãƒ–ãƒªãƒƒã‚¯ãƒªãƒã‚¸ãƒˆãƒªã§ECRã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’æä¾›ã—ã¦ã„ã‚‹ï¼å‚è€ƒï¼šhttps://gallery.ecr.aws/ ã‚¿ã‚°ã®ã‚¤ãƒŸãƒ¥ãƒ¼ã‚¿ãƒ“ãƒªãƒ†ã‚£ åŒã˜ã‚¿ã‚°åã§ã‚¤ãƒ¡ãƒ¼ã‚¸ãŒãƒ—ãƒƒã‚·ãƒ¥ã•ã‚ŒãŸå ´åˆã«ï¼Œã‚¤ãƒ¡ãƒ¼ã‚¸ã‚¿ã‚°ã‚’ä¸Šæ›¸ãå¯èƒ½ï¼ä¸å¯èƒ½ã‹ã‚’è¨­å®šã§ãã‚‹ï¼ ãƒ—ãƒƒã‚·ãƒ¥æ™‚ã«ã‚¹ã‚­ãƒ£ãƒ³ ã‚¤ãƒ¡ãƒ¼ã‚¸ãŒãƒ—ãƒƒã‚·ãƒ¥ã•ã‚ŒãŸæ™‚ã«ï¼Œã‚¤ãƒ¡ãƒ¼ã‚¸ã«ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¦ã„ã‚‹ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®è„†å¼±æ€§ã‚’æ¤œè¨¼ã—ï¼Œä¸€è¦§è¡¨ç¤ºã™ã‚‹ï¼ å‚è€ƒï¼šhttps://docs.aws.amazon.com/ja_jp/AmazonECR/latest/userguide/image-scanning.html æš—å·åŒ–è¨­å®š ãƒ©ã‚¤ãƒ•ã‚µã‚¤ã‚¯ãƒ« ãƒ»ãƒ©ã‚¤ãƒ•ã‚µã‚¤ã‚¯ãƒ«ãƒãƒªã‚·ãƒ¼ ECRã®ã‚¤ãƒ¡ãƒ¼ã‚¸ã®æœ‰åŠ¹æœŸé–“ã‚’å®šç¾©ã§ãã‚‹ï¼ è¨­å®šé …ç›® èª¬æ˜ è£œè¶³ ãƒ«ãƒ¼ãƒ«ã®å„ªå…ˆé †ä½ é †ä½ã®å¤§ãã•ã§ï¼Œãƒ«ãƒ¼ãƒ«ã®å„ªå…ˆåº¦ã‚’è¨­å®šã§ãã‚‹ï¼ æ•°å­—ã¯é€£ç¶šã—ã¦ã„ã‚‹å¿…è¦ã¯ãªãï¼Œä¾‹ãˆã°ï¼Œ10ï¼Œ20ï¼Œ90ï¼Œã®ã‚ˆã†ã«è¨­å®šã—ã¦ã‚‚è‰¯ã„ï¼ ã‚¤ãƒ¡ãƒ¼ã‚¸ã®ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ ãƒ«ãƒ¼ãƒ«ã‚’é©ç”¨ã™ã‚‹ã‚¤ãƒ¡ãƒ¼ã‚¸ã®æ¡ä»¶ã¨ã—ã¦ï¼Œã‚¿ã‚°ã®æœ‰ç„¡ã‚„æ–‡å­—åˆ—ã‚’è¨­å®šã§ãã‚‹ï¼ ä¸€è‡´æ¡ä»¶ ã‚¤ãƒ¡ãƒ¼ã‚¸ã®æœ‰åŠ¹æœŸé–“ã¨ã—ã¦ï¼ŒåŒæ¡ä»¶ã«å½“ã¦ã¯ã¾ã‚‹ã‚¤ãƒ¡ãƒ¼ã‚¸ãŒå‰Šé™¤ã•ã‚Œã‚‹é–¾å€¤ã‚’è¨­å®šã§ãã‚‹ï¼ å€‹æ•°ï¼Œãƒ—ãƒƒã‚·ãƒ¥ã•ã‚Œã¦ã‹ã‚‰ã®æœŸé–“ï¼Œãªã©ã‚’é–¾å€¤ã¨ã—ã¦è¨­å®šã§ãã‚‹ï¼ ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚¿ã‚° ãƒ»ã‚¿ã‚°åã®ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹ Dockerã®ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹ã«å‰‡ã‚Šï¼Œã‚¿ã‚°åã«latestã‚’ä½¿ç”¨ã—ãªã„ã‚ˆã†ã«ã™ã‚‹ï¼ãã®ä»£ã‚ã‚Šã«ï¼Œã‚¤ãƒ¡ãƒ¼ã‚¸ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã”ã¨ã«ç•°ãªã‚‹ã‚¿ã‚°åã«ãªã‚‹ã‚ˆã†ãƒãƒƒã‚·ãƒ¥å€¤ï¼ˆä¾‹ï¼šGitHubã®ã‚³ãƒŸãƒƒãƒˆIDï¼‰ã‚’ä½¿ç”¨ã™ã‚‹ï¼ å‚è€ƒï¼šhttps://matsuand.github.io/docs.docker.jp.onthefly/develop/dev-best-practices/ 14-01. ECS ECSã¨ã¯ ã‚³ãƒ³ãƒ†ãƒŠã‚ªãƒ¼ã‚±ã‚¹ãƒˆãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚’å®Ÿè¡Œã™ã‚‹ç’°å¢ƒã‚’æä¾›ã™ã‚‹ï¼VPCã®å¤–ã«å­˜åœ¨ã—ã¦ã„ã‚‹ï¼ECSï¼ŒEKSï¼ŒFargateï¼ŒEC2ã®å¯¾å¿œé–¢ä¿‚ã¯ä»¥ä¸‹ã®é€šã‚Šï¼ Control Planeï¼ˆã‚³ãƒ³ãƒ†ãƒŠã‚ªãƒ¼ã‚±ã‚¹ãƒˆãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ç’°å¢ƒï¼‰ Data Planeï¼ˆã‚³ãƒ³ãƒ†ãƒŠå®Ÿè¡Œç’°å¢ƒï¼‰ èª¬æ˜ ECSï¼šElastic Container Service Fargateï¼ŒEC2 å˜ä¸€ã®OSä¸Šã§ã‚³ãƒ³ãƒ†ãƒŠã‚ªãƒ¼ã‚±ã‚¹ãƒˆãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚’å®Ÿè¡Œã™ã‚‹ï¼ EKSï¼šElastic Kubernetes Service EC2 è¤‡æ•°ã®OSä¸Šãã‚Œãã‚Œã§ã‚³ãƒ³ãƒ†ãƒŠã‚ªãƒ¼ã‚±ã‚¹ãƒˆãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚’å®Ÿè¡Œã™ã‚‹ï¼ 14-02. ECS on EC2 EC2èµ·å‹•ã‚¿ã‚¤ãƒ—ã®ã‚³ãƒ³ãƒ†ãƒŠ ãƒ»ã‚¿ã‚¹ã‚¯é…ç½®æˆ¦ç•¥ ã‚¿ã‚¹ã‚¯ã‚’ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã«é…ç½®ã™ã‚‹æ™‚ã®ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã‚’é¸æŠã§ãã‚‹ï¼ æˆ¦ç•¥ èª¬æ˜ Spread ã‚¿ã‚¹ã‚¯ã‚’å„å ´æ‰€ã«ãƒãƒ©ãƒ³ã‚¹ã‚ˆãé…ç½®ã™ã‚‹ Binpack ã‚¿ã‚¹ã‚¯ã‚’ä¸€ã¤ã®å ´æ‰€ã«ã§ãã‚‹ã ã‘å¤šãé…ç½®ã™ã‚‹ï¼ Random ã‚¿ã‚¹ã‚¯ã‚’ãƒ©ãƒ³ãƒ€ãƒ ã«é…ç½®ã™ã‚‹ï¼ 14-03. ECS on Fargateï¼šElastic Container Service ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ ãƒ»ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ã¨ã¯ ã‚µãƒ¼ãƒ“ã‚¹ ãƒ»ã‚µãƒ¼ãƒ“ã‚¹ã¨ã¯ ã‚¿ã‚¹ã‚¯æ•°ã®ç¶­æŒç®¡ç†ã‚„ï¼Œã‚¿ã‚¹ã‚¯ã¸ã®ãƒ­ãƒ¼ãƒ‰ãƒãƒ©ãƒ³ã‚·ãƒ³ã‚°ï¼Œãƒªãƒªãƒ¼ã‚¹ã®æˆå¦ã®ç®¡ç†ã‚’è¡Œã†æ©Ÿèƒ½ã®ã“ã¨ï¼ å‚è€ƒï¼šhttps://docs.aws.amazon.com/ja_jp/AmazonECS/latest/userguide/service_definition_parameters.html è¨­å®šé …ç›® èª¬æ˜ è£œè¶³ ã‚¿ã‚¹ã‚¯å®šç¾© ã‚µãƒ¼ãƒ“ã‚¹ã§ç¶­æŒç®¡ç†ã™ã‚‹ã‚¿ã‚¹ã‚¯ã®å®šç¾©ãƒ•ã‚¡ãƒŸãƒªãƒ¼åã¨ãƒªãƒ“ã‚¸ãƒ§ãƒ³ç•ªå·ã‚’è¨­å®šã™ã‚‹ï¼ èµ·å‹•ã‚¿ã‚¤ãƒ— ã‚¿ã‚¹ã‚¯å†…ã®ã‚³ãƒ³ãƒ†ãƒŠã®èµ·å‹•ã‚¿ã‚¤ãƒ—ã‚’è¨­å®šã™ã‚‹ï¼ ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ ã‚¿ã‚¹ã‚¯ã®å®Ÿè¡Œç’°å¢ƒã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’è¨­å®šã™ã‚‹ï¼ ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã«ã‚ˆã£ã¦ï¼Œé€£æºã§ãã‚‹AWSãƒªã‚½ãƒ¼ã‚¹ãŒç•°ãªã‚‹ï¼ ã‚µãƒ¼ãƒ“ã‚¹ã‚¿ã‚¤ãƒ— ã‚¿ã‚¹ã‚¯ã®å¿…è¦æ•° éã‚¹ã‚±ãƒ¼ãƒªãƒ³ã‚°æ™‚ã¾ãŸã¯ãƒ‡ãƒ—ãƒ­ã‚¤æ™‚ã®ã‚¿ã‚¹ã‚¯æ•°ã‚’è¨­å®šã™ã‚‹ï¼ æœ€å°ãƒ˜ãƒ«ã‚¹ç‡ã¨æœ€å¤§ç‡ã®è¨­å®šå€¤ã«å½±éŸ¿ã™ã‚‹ï¼ æœ€å°ãƒ˜ãƒ«ã‚¹ç‡ ã‚¿ã‚¹ã‚¯ã®å¿…è¦æ•°ã®è¨­å®šã‚’100%ã¨ã—ï¼Œæ–°ã—ã„ã‚¿ã‚¹ã‚¯ã®ãƒ‡ãƒ—ãƒ­ã‚¤æ™‚ã«ï¼Œç¨¼åƒä¸­ã‚¿ã‚¹ã‚¯ã®æœ€ä½åˆè¨ˆæ•°ã‚’å‰²åˆã§è¨­å®šã™ã‚‹ï¼ ä¾‹ã¨ã—ã¦ï¼Œã‚¿ã‚¹ã‚¯å¿…è¦æ•°ãŒï¼”å€‹ã ã¨ä»®å®šã™ã‚‹ï¼ã‚¿ã‚¹ã‚¯ãƒ˜ãƒ«ã‚¹æœ€å°ç‡ã‚’50%ã¨ã™ã‚Œã°ï¼Œç¨¼åƒä¸­ã‚¿ã‚¹ã‚¯ã®æœ€ä½åˆè¨ˆæ•°ã¯ï¼’å€‹ã¨ãªã‚‹ï¼ãƒ‡ãƒ—ãƒ­ã‚¤æ™‚ã®æ—¢å­˜ã‚¿ã‚¹ã‚¯åœæ­¢ã¨æ–°ã‚¿ã‚¹ã‚¯èµ·å‹•ã§ã¯ï¼Œç¨¼åƒä¸­ã®æ—¢å­˜ã‚¿ã‚¹ã‚¯ï¼æ–°ã‚¿ã‚¹ã‚¯ã®æ•°ãŒæœ€ä½åˆè¨ˆæ•°æœªæº€ã«ãªã‚‰ãªã„ã‚ˆã†ã«åˆ¶å¾¡ã•ã‚Œã‚‹ï¼å‚è€ƒï¼šhttps://toris.io/2021/04/speeding-up-amazon-ecs-container-deployments æœ€å¤§ç‡ ã‚¿ã‚¹ã‚¯ã®å¿…è¦æ•°ã®è¨­å®šã‚’100%ã¨ã—ï¼Œæ–°ã—ã„ã‚¿ã‚¹ã‚¯ã®ãƒ‡ãƒ—ãƒ­ã‚¤æ™‚ã«ï¼Œç¨¼åƒä¸­ï¼åœæ­¢ä¸­ã‚¿ã‚¹ã‚¯ã®æœ€é«˜åˆè¨ˆæ•°ã‚’å‰²åˆã§è¨­å®šã™ã‚‹ï¼ ä¾‹ã¨ã—ã¦ï¼Œã‚¿ã‚¹ã‚¯å¿…è¦æ•°ãŒï¼”å€‹ã ã¨ä»®å®šã™ã‚‹ï¼ã‚¿ã‚¹ã‚¯æœ€å¤§ç‡ã‚’200%ã¨ã™ã‚Œã°ï¼Œç¨¼åƒä¸­ï¼åœæ­¢ä¸­ã‚¿ã‚¹ã‚¯ã®æœ€é«˜åˆè¨ˆæ•°ã¯ï¼˜å€‹ã¨ãªã‚‹ï¼ãƒ‡ãƒ—ãƒ­ã‚¤æ™‚ã®æ—¢å­˜ã‚¿ã‚¹ã‚¯åœæ­¢ã¨æ–°ã‚¿ã‚¹ã‚¯èµ·å‹•ã§ã¯ï¼Œç¨¼åƒä¸­ï¼åœæ­¢ä¸­ã®æ—¢å­˜ã‚¿ã‚¹ã‚¯ï¼æ–°ã‚¿ã‚¹ã‚¯ã®æ•°ãŒæœ€é«˜åˆè¨ˆæ•°ã‚’è¶…éã—ãªã„ã‚ˆã†ã«åˆ¶å¾¡ã•ã‚Œã‚‹ï¼å‚è€ƒï¼šhttps://toris.io/2021/04/speeding-up-amazon-ecs-container-deployments ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯ã®çŒ¶äºˆæœŸé–“ ãƒ‡ãƒ—ãƒ­ã‚¤æ™‚ã®ALBï¼NLBã®ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯ã®çŠ¶æ…‹ã‚’ç¢ºèªã™ã‚‹ã¾ã§ã®å¾…æ©Ÿæ™‚é–“ã‚’è¨­å®šã™ã‚‹ï¼çŒ¶äºˆæœŸé–“ã‚’éãã¦ã‚‚ï¼ŒALBï¼NLBã®ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯ãŒå¤±æ•—ã—ã¦ã„ã‚Œã°ï¼Œã‚µãƒ¼ãƒ“ã‚¹ã¯ã‚¿ã‚¹ã‚¯ã‚’åœæ­¢ã—ï¼Œæ–°ã—ã„ã‚¿ã‚¹ã‚¯ã‚’å†èµ·å‹•ã™ã‚‹ï¼ ALBï¼NLBã§ã¯ã‚¿ãƒ¼ã‚²ãƒƒãƒˆã‚’ç™»éŒ²ã—ï¼Œãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯ã‚’å®Ÿè¡Œã™ã‚‹ãƒ—ãƒ­ã‚»ã‚¹ãŒã‚ã‚‹ï¼ç‰¹ã«NLBã§ã¯ï¼Œã“ã‚Œã«æ™‚é–“ãŒã‹ã‹ã‚‹ï¼ã¾ãŸã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã«ã‚ˆã£ã¦ã¯ï¼Œã‚³ãƒ³ãƒ†ãƒŠã®æ§‹ç¯‰ã«æ™‚é–“ãŒã‹ã‹ã‚‹ï¼ãã®ãŸã‚ï¼ŒNLBã®ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯ãŒå®Œäº†ã™ã‚‹å‰ã«ï¼ŒECSã‚µãƒ¼ãƒ“ã‚¹ãŒNLBã®ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯ã®çµæœã‚’ç¢ºèªã—ã¦ã—ã¾ã†ã“ã¨ãŒã‚ã‚‹ï¼ä¾‹ãˆã°ï¼ŒNLBã¨Laravelã‚’ä½¿ç”¨ã™ã‚‹å ´åˆã¯ï¼Œã‚¿ãƒ¼ã‚²ãƒƒãƒˆç™»éŒ²ã¨Laravelã‚³ãƒ³ãƒ†ãƒŠã®ç¯‰ã®æ™‚é–“ã‚’åŠ å‘³ã—ã¦ï¼Œ330ç§’ä»¥ä¸Šã‚’ç›®å®‰ã¨ã™ã‚‹ï¼ä¾‹ãˆã°ï¼ŒALBã¨Nuxtjsï¼ˆSSRãƒ¢ãƒ¼ãƒ‰ï¼‰ã‚’ä½¿ç”¨ã™ã‚‹å ´åˆã¯ï¼Œ600ç§’ä»¥ä¸Šã‚’ç›®å®‰ã¨ã™ã‚‹ï¼ãªãŠï¼Œã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ã‚³ãƒ³ãƒ†ãƒŠæ§‹ç¯‰ã«ã‹ã‹ã‚‹æ™‚é–“ã¯ï¼Œãƒ­ãƒ¼ã‚«ãƒ«ç’°å¢ƒã§ã®æ‰€è¦æ™‚é–“ã‚’å‚è€ƒã«ã™ã‚‹ï¼ ã‚¿ã‚¹ã‚¯ã®æœ€å°æ•° ã‚¹ã‚±ãƒ¼ãƒªãƒ³ã‚°æ™‚ã®ã‚¿ã‚¹ã‚¯æ•°ã®æœ€å°æ•°ã‚’è¨­å®šã™ã‚‹ï¼ ã‚¿ã‚¹ã‚¯ã®æœ€å¤§æ•° ã‚¹ã‚±ãƒ¼ãƒªãƒ³ã‚°æ™‚ã®ã‚¿ã‚¹ã‚¯æ•°ã®æœ€å¤§æ•°ã‚’è¨­å®šã™ã‚‹ï¼ ãƒ­ãƒ¼ãƒ‰ãƒãƒ©ãƒ³ã‚·ãƒ³ã‚° ALBã§ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã™ã‚‹ã‚³ãƒ³ãƒ†ãƒŠã‚’è¨­å®šã™ã‚‹ï¼ ã‚¿ã‚¹ã‚¯ã®æ•° ã‚¿ã‚¹ã‚¯ã®æ§‹ç¯‰æ•°ã‚’ã„ãã¤ã«ç¶­æŒã™ã‚‹ã‹ã‚’è¨­å®šã™ã‚‹ï¼ ã‚¿ã‚¹ã‚¯ãŒä½•ã‚‰ã‹ã®åŸå› ã§åœæ­¢ã—ãŸå ´åˆï¼Œç©ºã„ã¦ã„ã‚‹AWSã‚µãƒ¼ãƒ“ã‚¹ã‚’ä½¿ç”¨ã—ã¦ï¼Œã‚¿ã‚¹ã‚¯ãŒè‡ªå‹•çš„ã«è£œå¡«ã•ã‚Œã‚‹ï¼ ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ¡ãƒ³ãƒˆ ãƒ­ãƒ¼ãƒªãƒ³ã‚°ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆï¼ŒBlue/Greenãƒ‡ãƒ—ãƒ­ã‚¤ãŒã‚ã‚‹ï¼ ãƒ»ã‚¿ãƒ¼ã‚²ãƒƒãƒˆè¿½è·¡ã‚¹ã‚±ãƒ¼ãƒªãƒ³ã‚°ãƒãƒªã‚·ãƒ¼ è¨­å®šé …ç›® èª¬æ˜ è£œè¶³ ã‚¿ãƒ¼ã‚²ãƒƒãƒˆè¿½è·¡ã‚¹ã‚±ãƒ¼ãƒªãƒ³ã‚°ãƒãƒªã‚·ãƒ¼ ç›£è¦–å¯¾è±¡ã®ãƒ¡ãƒˆãƒªã‚¯ã‚¹ãŒã‚¿ãƒ¼ã‚²ãƒƒãƒˆå€¤ã‚’è¶…éã—ã¦ã„ã‚‹ã‹å¦ã‹ã«åŸºã¥ã„ã¦ï¼Œã‚¿ã‚¹ã‚¯æ•°ã®ã‚¹ã‚±ãƒ¼ãƒªãƒ³ã‚°ãŒå®Ÿè¡Œã•ã‚Œã‚‹ï¼ ECSã‚µãƒ¼ãƒ“ã‚¹ãƒ¡ãƒˆãƒªã‚¯ã‚¹ ç›£è¦–å¯¾è±¡ã®ãƒ¡ãƒˆãƒªã‚¯ã‚¹ã‚’è¨­å®šã™ã‚‹ï¼ ã€å¹³å‡CPUã€ï¼Œã€å¹³å‡ãƒ¡ãƒ¢ãƒªã€ï¼Œã€ã‚¿ã‚¹ã‚¯å½“ãŸã‚Šã®ALBã‹ã‚‰ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆæ•°ã€ã‚’ç›£è¦–ã§ãã‚‹ï¼SLIã«å¯¾å¿œã™ã‚‹CloudWatchãƒ¡ãƒˆãƒªã‚¯ã‚¹ã‚‚å‚è€ƒã«ã›ã‚ˆï¼ ã‚¿ãƒ¼ã‚²ãƒƒãƒˆå€¤ ã‚¿ã‚¹ã‚¯æ•°ã®ã‚¹ã‚±ãƒ¼ãƒªãƒ³ã‚°ãŒå®Ÿè¡Œã•ã‚Œã‚‹åæŸå€¤ã‚’è¨­å®šã™ã‚‹ï¼ ã‚¿ãƒ¼ã‚²ãƒƒãƒˆå€¤ã‚’è¶…éã—ã¦ã„ã‚‹å ´åˆï¼Œã‚¿ã‚¹ã‚¯æ•°ãŒã‚¹ã‚±ãƒ¼ãƒ«ã‚¢ã‚¦ãƒˆã•ã‚Œã‚‹ï¼åå¯¾ã«ï¼Œã‚¿ãƒ¼ã‚²ãƒƒãƒˆå€¤æœªæº€ï¼ˆæ­£ç¢ºã«ã¯ã‚¿ãƒ¼ã‚²ãƒƒãƒˆå€¤ã®ï¼™å‰²æœªæº€ï¼‰ã®å ´åˆï¼Œã‚¿ã‚¹ã‚¯æ•°ãŒã‚¹ã‚±ãƒ¼ãƒ«ã‚¤ãƒ³ã•ã‚Œã‚‹ï¼ ã‚¹ã‚±ãƒ¼ãƒ«ã‚¢ã‚¦ãƒˆã‚¯ãƒ¼ãƒ«ãƒ€ã‚¦ãƒ³æœŸé–“ ã‚¹ã‚±ãƒ¼ãƒ«ã‚¢ã‚¦ãƒˆã‚’ç™ºå‹•ã—ã¦ã‹ã‚‰ï¼Œæ¬¡å›ã®ã‚¹ã‚±ãƒ¼ãƒ«ã‚¢ã‚¦ãƒˆã‚’ç™ºå‹•ã§ãã‚‹ã¾ã§ã®æ™‚é–“ã‚’è¨­å®šã™ã‚‹ï¼ ãƒ»æœŸé–“ã‚’çŸ­ãã—éãã‚‹ã¨ï¼Œã‚¿ãƒ¼ã‚²ãƒƒãƒˆå€¤ã‚’è¶…éã™ã‚‹çŠ¶æ…‹ãŒæ–­ç¶šçš„ã«ç¶šã„ãŸå ´åˆã«ï¼Œä½™åˆ†ãªã‚¹ã‚±ãƒ¼ãƒ«ã‚¢ã‚¦ãƒˆãŒé€£ç¶šã—ã¦å®Ÿè¡Œã•ã‚Œã¦ã—ã¾ã†ãŸã‚æ³¨æ„ã™ã‚‹ï¼ãƒ»æœŸé–“ã‚’é•·ãéãã‚‹ã¨ï¼Œã‚¹ã‚±ãƒ¼ãƒ«ã‚¢ã‚¦ãƒˆãŒä¸ååˆ†ã«ãªã‚Šï¼ŒECSã®è² è·ãŒç·©å’Œã•ã‚Œãªã„ãŸã‚æ³¨æ„ã™ã‚‹ï¼ ã‚¹ã‚±ãƒ¼ãƒ«ã‚¤ãƒ³ã‚¯ãƒ¼ãƒ«ãƒ€ã‚¦ãƒ³æœŸé–“ ã‚¹ã‚±ãƒ¼ãƒ«ã‚¤ãƒ³ã‚’ç™ºå‹•ã—ã¦ã‹ã‚‰ï¼Œæ¬¡å›ã®ã‚¹ã‚±ãƒ¼ãƒ«ã‚¤ãƒ³ã‚’ç™ºå‹•ã§ãã‚‹ã¾ã§ã®æ™‚é–“ã‚’è¨­å®šã™ã‚‹ï¼ ã‚¹ã‚±ãƒ¼ãƒ«ã‚¤ãƒ³ã®ç„¡åŠ¹åŒ– ã‚¿ãƒ¼ã‚²ãƒƒãƒˆå€¤ã®è¨­å®šã«å¿œã˜ã¦ï¼Œè‡ªå‹•çš„ã«ã‚¹ã‚±ãƒ¼ãƒ«ã‚¢ã‚¦ãƒˆã‚„ã‚¹ã‚±ãƒ¼ãƒ«ã‚¤ãƒ³ãŒèµ·ã“ã‚‹ã‚·ãƒŠãƒªã‚ªä¾‹ã‚’ç¤ºã™ï¼ æœ€å°ã‚¿ã‚¹ã‚¯æ•°ã‚’2ï¼Œå¿…è¦ã‚¿ã‚¹ã‚¯æ•°ã‚’4ï¼Œæœ€å¤§æ•°ã‚’6ï¼ŒCPUå¹³å‡ä½¿ç”¨ç‡ã‚’40%ã«è¨­å®šã™ã‚‹ã¨ã™ã‚‹ï¼ å¹³å¸¸æ™‚ï¼ŒCPUä½¿ç”¨ç‡40%ã«ç¶­æŒã•ã‚Œã‚‹ï¼ ãƒªã‚¯ã‚¨ã‚¹ãƒˆãŒå¢—åŠ ã—ï¼ŒCPUä½¿ç”¨ç‡55%ã«ä¸Šæ˜‡ã™ã‚‹ï¼ ã‚¿ã‚¹ã‚¯æ•°ãŒ6ã¤ã«ã‚¹ã‚±ãƒ¼ãƒ«ã‚¢ã‚¦ãƒˆã—ï¼ŒCPUä½¿ç”¨ç‡40%ã«ç¶­æŒã•ã‚Œã‚‹ï¼ ãƒªã‚¯ã‚¨ã‚¹ãƒˆæ•°ãŒæ¸›å°‘ã—ï¼ŒCPUä½¿ç”¨ç‡ãŒ20%ã«ä½ä¸‹ã™ã‚‹ï¼ ã‚¿ã‚¹ã‚¯æ•°ãŒ2ã¤ã«ã‚¹ã‚±ãƒ¼ãƒ«ã‚¤ãƒ³ã—ï¼ŒCPUä½¿ç”¨ç‡40%ã«ç¶­æŒã•ã‚Œã‚‹ï¼ ãƒ»ãƒã‚¤ã‚¯ãƒ­ã‚µãƒ¼ãƒ“ã‚¹ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£é¢¨ ãƒã‚¤ã‚¯ãƒ­ã‚µãƒ¼ãƒ“ã‚¹ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã®ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ç¾¤ã‚’ç¨¼åƒã•ã›ã‚‹æ™‚ï¼ŒKubernetesã‚’ä½¿ç”¨ã—ï¼Œã¾ãŸã‚¤ãƒ³ãƒ•ãƒ©ã¨ã—ã¦EKSã‚’ä½¿ç”¨ã™ã‚‹ã®ãŒåŸºæœ¬ã§ã‚ã‚‹ï¼ãŸã ã—ï¼Œãƒ¢ãƒãƒªã‚¹ãªã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ECSã‚µãƒ¼ãƒ“ã‚¹ã§åˆ†å‰²ã—ï¼ŒFargateã§ç¨¼åƒã•ã›ã‚‹ã“ã¨ã«ã‚ˆã‚Šï¼Œãƒã‚¤ã‚¯ãƒ­ã‚µãƒ¼ãƒ“ã‚¹ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£é¢¨ã®ã‚¤ãƒ³ãƒ•ãƒ©ã‚’æ§‹ç¯‰ã§ãã‚‹ï¼ å‚è€ƒï¼šhttps://tangocode.com/2018/11/when-to-use-lambdas-vs-ecs-docker-containers/ ã‚¿ã‚¹ã‚¯ ãƒ»ã‚¿ã‚¹ã‚¯ ã‚°ãƒ«ãƒ¼ãƒ”ãƒ³ã‚°ã•ã‚ŒãŸã‚³ãƒ³ãƒ†ãƒŠç¾¤ã®ã“ã¨ ãƒ»ã‚¿ã‚¹ã‚¯å®šç¾©ã¨ã¯ å„ã‚¿ã‚¹ã‚¯ã‚’ã©ã®ã‚ˆã†ãªè¨­å®šå€¤ã«åŸºã¥ã„ã¦æ§‹ç¯‰ã™ã‚‹ã‹ã‚’è¨­å®šã§ãã‚‹ï¼ã‚¿ã‚¹ã‚¯å®šç¾©ã¯ï¼Œãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’ç¤ºã™ã€ãƒªãƒ“ã‚¸ãƒ§ãƒ³ãƒŠãƒ³ãƒãƒ¼ã€ã§ç•ªå·ã¥ã‘ã•ã‚Œã‚‹ï¼ã‚¿ã‚¹ã‚¯å®šç¾©ã‚’å‰Šé™¤ã™ã‚‹ã«ã¯ï¼Œå…¨ã¦ã®ãƒªãƒ“ã‚¸ãƒ§ãƒ³ç•ªå·ã®ã‚¿ã‚¹ã‚¯å®šç¾©ã‚’ç™»éŒ²è§£é™¤ã™ã‚‹å¿…è¦ãŒã‚ã‚‹ï¼ ãƒ»ã‚¿ã‚¹ã‚¯ã®ãƒ©ã‚¤ãƒ•ã‚µã‚¤ã‚¯ãƒ« å‚è€ƒï¼šhttps://docs.aws.amazon.com/ja_jp/AmazonECS/latest/developerguide/task-lifecycle.html#lifecycle-states ãƒ»ã‚¿ã‚¹ã‚¯ã‚µã‚¤ã‚º è¨­å®šé …ç›® èª¬æ˜ ã‚¿ã‚¹ã‚¯ãƒ¡ãƒ¢ãƒª ã‚¿ã‚¹ã‚¯å½“ãŸã‚Šã®ã‚³ãƒ³ãƒ†ãƒŠã®åˆè¨ˆãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡ ã‚¿ã‚¹ã‚¯CPU ã‚¿ã‚¹ã‚¯å½“ãŸã‚Šã®ã‚³ãƒ³ãƒ†ãƒŠã®åˆè¨ˆCPUä½¿ç”¨é‡ ãƒ»æ–°ã—ã„ã‚¿ã‚¹ã‚¯ã‚’ä¸€æ™‚çš„ã«å®Ÿè¡Œ ç¾åœ¨èµ·å‹•ä¸­ã®ECSã‚¿ã‚¹ã‚¯ã¨ã¯åˆ¥ã«ï¼Œæ–°ã—ã„ã‚¿ã‚¹ã‚¯ã‚’ä¸€æ™‚çš„ã«èµ·å‹•ã™ã‚‹ï¼CI/CDãƒ„ãƒ¼ãƒ«ã§å®Ÿè¡Œã™ã‚‹ä»¥å¤–ã«ï¼Œãƒ­ãƒ¼ã‚«ãƒ«ã‹ã‚‰æ‰‹å‹•ã§å®Ÿè¡Œã™ã‚‹å ´åˆã‚‚ã‚ã‚‹ï¼èµ·å‹•æ™‚ã«ï¼Œoverridesã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’ä½¿ç”¨ã—ã¦ï¼ŒæŒ‡å®šã—ãŸã‚¿ã‚¹ã‚¯å®šç¾©ã®ã‚³ãƒ³ãƒ†ãƒŠè¨­å®šã‚’ä¸Šæ›¸ãã§ãã‚‹ï¼æ­£è¦è¡¨ç¾ã§è¨­å®šã™ã‚‹å¿…è¦ãŒã‚ã‚Šï¼Œã•ã‚‰ã«JSONã§ã¯ã€\\ã€ã‚’ã€\\\\ã€ã«ã‚¨ã‚¹ã‚±ãƒ¼ãƒ—ã—ãªã‘ã‚Œã°ãªã‚‰ãªã„ï¼ã‚³ãƒãƒ³ãƒ‰ãŒå®Ÿè¡Œã•ã‚ŒãŸå¾Œã«ï¼Œã‚¿ã‚¹ã‚¯ã¯è‡ªå‹•çš„ã«StoppedçŠ¶æ…‹ã«ãªã‚‹ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š Laravelã®Seederã‚³ãƒãƒ³ãƒ‰ã‚„ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯ã‚³ãƒãƒ³ãƒ‰ã‚’ï¼Œãƒ­ãƒ¼ã‚«ãƒ«PCã‹ã‚‰å®Ÿè¡Œã™ã‚‹ï¼ #!/bin/bash set -x echo \"Set Variables\" SERVICE_NAME=\"stg-foo-ecs-service\" CLUSTER_NAME=\"stg-foo-ecs-cluster\" TASK_NAME=\"stg-foo-ecs-task-definition\" SUBNETS_CONFIG=$(aws ecs describe-services \\ --cluster ${CLUSTER_NAME} \\ --services ${SERVICE_NAME} \\ --query \"services[].deployments[].networkConfiguration[].awsvpcConfiguration[].subnets[]\") SGS_CONFIG=$(aws ecs describe-services \\ --cluster ${CLUSTER_NAME} \\ --services ${SERVICE_NAME} \\ --query \"services[].deployments[].networkConfiguration[].awsvpcConfiguration[].securityGroups[]\") # å®Ÿè¡Œã—ãŸã„ã‚³ãƒãƒ³ãƒ‰ã‚’overridesã«è¨­å®šã™ã‚‹ï¼ echo \"Run Task\" TASK_ARN=$(aws ecs run-task \\ --launch-type FARGATE \\ --cluster ${CLUSTER_NAME} \\ --platform-version \"1.4.0\" \\ --network-configuration \"awsvpcConfiguration={subnets=${SUBNETS_CONFIG},securityGroups=${SGS_CONFIG}}\" \\ --task-definition ${TASK_NAME} \\ --overrides '{\\\"containerOverrides\\\": [{\\\"name\\\": \\\"laravel-container\\\",\\\"command\\\": [\\\"php\\\", \\\"artisan\\\", \\\"db:seed\\\", \\\"--class=DummySeeder\\\", \\\"--force\\\"]}]}' \\ --query \"tasks[0].taskArn\" | tr -d \"\"\") echo \"Wait until task stopped\" aws ecs wait tasks-stopped \\ --cluster ${CLUSTER_NAME} \\ --tasks ${TASK_ARN} echo \"Get task result\" RESULT=$(aws ecs describe-tasks \\ --cluster ${CLUSTER_NAME} \\ --tasks ${TASK_ARN}) echo ${RESULT} EXIT_CODE=$(echo ${RESULT} | jq .tasks[0].containers[0].exitCode) echo exitCode ${EXIT_CODE} exit ${EXIT_CODE} ãªãŠï¼Œå®Ÿè¡ŒIAMãƒ¦ãƒ¼ã‚¶ã‚’ä½œæˆã—ï¼ŒECSã‚¿ã‚¹ã‚¯ã‚’èµ·å‹•ã§ãã‚‹æœ€ä½é™ã®æ¨©é™ã‚’ã‚¢ã‚¿ãƒƒãƒã™ã‚‹ï¼ { \"Version\": \"2012-10-17\", \"Statement\": [ { \"Effect\": \"Allow\", \"Action\": [ \"iam:PassRole\", \"ecs:RunTask\", \"ecs:DescribeServices\", \"ecs:DescribeTasks\" ], \"Resource\": [ \"arn:aws:ecs:*::service/*\", \"arn:aws:ecs:*::task/*\", \"arn:aws:ecs:*::task-definition/*\", \"arn:aws:iam:::role/*\" ] } ] } ãƒ»ECS Exec ECSã‚¿ã‚¹ã‚¯ã®ã‚³ãƒ³ãƒ†ãƒŠã«å¯¾ã—ã¦ï¼Œã‚·ã‚§ãƒ«ãƒ­ã‚°ã‚¤ãƒ³ã‚’å®Ÿè¡Œã™ã‚‹ï¼ECSã‚µãƒ¼ãƒ“ã‚¹ã«ãŠã‘ã‚‹ECS-Execã‚ªãƒ—ã‚·ãƒ§ãƒ³ã®æœ‰åŠ¹åŒ–ï¼Œssmmessagesã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã®ä½œæˆï¼ŒSystem Managerã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ãŸã‚ã®IAMãƒãƒªã‚·ãƒ¼ã®ä½œæˆï¼ŒECSã‚¿ã‚¹ã‚¯å®Ÿè¡Œãƒ­ãƒ¼ãƒ«ã¸ã®IAMãƒãƒªã‚·ãƒ¼ã®ä»˜ä¸ï¼ŒIAMãƒ¦ãƒ¼ã‚¶ã¸ã®ãƒãƒªã‚·ãƒ¼ã®ä»˜ä¸ï¼ŒãŒå¿…è¦ã«ãªã‚‹ï¼ å‚è€ƒï¼š https://docs.aws.amazon.com/ja_jp/AmazonECS/latest/userguide/ecs-exec.html https://docs.aws.amazon.com/ja_jp/systems-manager/latest/userguide/systems-manager-setting-up-messageAPIs.html { \"Version\": \"2012-10-17\", \"Statement\": [ { \"Effect\": \"Allow\", \"Action\": [ # ssmmesages APIã¸ã®ã‚¢ã‚¯ã‚»ã‚¹æ¨©é™ \"ssmmessages:CreateControlChannel\", \"ssmmessages:CreateDataChannel\", \"ssmmessages:OpenControlChannel\", \"ssmmessages:OpenDataChannel\" ], \"Resource\": \"*\" } ] } ãªãŠï¼Œäº‹å‰ã®è¨­å®šãŒãªã•ã‚Œã¦ã„ã‚‹ã‹ã©ã†ã‹ã‚’ecs-exec-checkerã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’å®Ÿè¡Œã—ã¦ç¢ºèªã§ãã‚‹ï¼ å‚è€ƒï¼šhttps://github.com/aws-containers/amazon-ecs-exec-checker #!/bin/bash ECS_CLUSTER_NAME=prd-foo-ecs-cluster ECS_TASK_ID=bar bash ECS Execã‚’å®Ÿè¡Œã™ã‚‹ãƒ¦ãƒ¼ã‚¶ã«ï¼Œå®Ÿè¡Œæ¨©é™ã®ãƒãƒªã‚·ãƒ¼ã‚’ä»˜ä¸ã™ã‚‹å¿…è¦ãŒã‚ã‚‹ï¼ { \"Version\": \"2012-10-17\", \"Statement\": [ { \"Effect\": \"Allow\", \"Action\": [ \"ecs:ExecuteCommand\", ], \"Resource\": [ \"arn:aws:ecs:*::cluster/*\", \"arn:aws:ecs:*::task/*\", ] } ] } laravelã‚³ãƒ³ãƒ†ãƒŠã«å¯¾ã—ã¦ï¼Œã‚·ã‚§ãƒ«ãƒ­ã‚°ã‚¤ãƒ³ã‚’å®Ÿè¡Œã™ã‚‹ï¼bashã‚’å®Ÿè¡Œã™ã‚‹æ™‚ã«ï¼Œã€/bin/bashã€ã‚„ã€/bin/shã€ã§æŒ‡å®šã™ã‚‹ã¨ï¼Œbinã‚ˆã‚Šä¸Šã®ãƒ‘ã‚¹ã‚‚ECSã«é€ä¿¡ã•ã‚Œã¦ã—ã¾ã†ï¼ä¾‹ãˆã°ï¼ŒWindowsãªã‚‰ã€C:/Program Files/Git/usr/bin/bashã€ãŒé€ä¿¡ã•ã‚Œã‚‹ï¼ã“ã‚Œã¯CloudTrailã§ExecuteCommandã‚¤ãƒ™ãƒ³ãƒˆã¨ã—ã¦ç¢ºèªã§ãã‚‹ï¼ECSã‚³ãƒ³ãƒ†ãƒŠå†…ã§ã¯bashã¸ã®ãƒ‘ã‚¹ãŒç•°ãªã‚‹ãŸã‚ï¼Œæ¥ç¶šã«å¤±æ•—ã™ã‚‹ï¼ãã®ãŸã‚ï¼Œbashã‚’ç›´æ¥æŒ‡å®šã™ã‚‹ã‚ˆã†ã«ã™ã‚‹ï¼ #!/bin/bash set -xe ECS_CLUSTER_NAME=prd-foo-ecs-cluster ECS_TASK_ID=bar ECS_CONTAINER_NAME=laravel aws ecs execute-command \\ --cluster $ECS_CLUSTER_NAME \\ --task $ECS_TASK_ID \\ --container $ECS_CONTAINER_NAME \\ --interactive \\ --debug \\ --command \"bash\" Fargate ãƒ»Fargateã¨ã¯ ã‚³ãƒ³ãƒ†ãƒŠã®å®Ÿè¡Œç’°å¢ƒã®ã“ã¨ï¼ã€ECS on Fargateã€ã¨ã„ã†å‘¼ã³æ–¹ã¯ï¼ŒFargateãŒç’°å¢ƒã®æ„å‘³åˆã„ã‚’æŒã¤ã‹ã‚‰ã§ã‚ã‚‹ï¼Fargateç’°å¢ƒã§ã¯ãƒ›ã‚¹ãƒˆãŒéš è”½ã•ã‚Œã¦ãŠã‚Šï¼Œå®Ÿä½“ã¨ã—ã¦EC2ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’ãƒ›ã‚¹ãƒˆã¨ã—ã¦ã‚³ãƒ³ãƒ†ãƒŠãŒç¨¼åƒã—ã¦ã„ã‚‹ï¼ˆãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã«è¨˜è¼‰ãŒãªã„ãŒï¼ŒAWSã‚µãƒãƒ¼ãƒˆã«ç¢ºèªæ¸ˆã¿ï¼‰ï¼ å‚è€ƒï¼šhttps://aws.amazon.com/jp/blogs/news/under-the-hood-fargate-data-plane/ ãƒ»ã‚³ãƒ³ãƒ†ãƒŠã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆ ã‚³ãƒ³ãƒ†ãƒŠå†…ã§ç¨¼åƒã—ï¼Œã‚³ãƒ³ãƒ†ãƒŠã®æ“ä½œã‚’è¡Œã†ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã®ã“ã¨ï¼ ãƒ»ã‚³ãƒ³ãƒ†ãƒŠå®šç¾© ã‚¿ã‚¹ã‚¯å†…ã®ã‚³ãƒ³ãƒ†ãƒŠä¸€ã¤ã«å¯¾ã—ã¦ï¼Œç’°å¢ƒã‚’è¨­å®šã™ã‚‹ï¼ å‚è€ƒï¼šhttps://docs.aws.amazon.com/ja_jp/AmazonECS/latest/userguide/task_definition_parameters.html è¨­å®šé …ç›® å¯¾å¿œã™ã‚‹dockerã‚³ãƒãƒ³ãƒ‰ã‚ªãƒ—ã‚·ãƒ§ãƒ³ èª¬æ˜ è£œè¶³ cpu --cpus ã‚¿ã‚¹ã‚¯å…¨ä½“ã«å‰²ã‚Šå½“ã¦ã‚‰ã‚ŒãŸCPUã®ã†ã¡ï¼Œè©²å½“ã®ã‚³ãƒ³ãƒ†ãƒŠã«å‰²ã‚Šå½“ã¦ã‚‹CPUåˆ†ã‚’è¨­å®šã™ã‚‹ï¼ dnsServers --dns ã‚³ãƒ³ãƒ†ãƒŠãŒåå‰è§£æ±ºã«ä½¿ç”¨ã™ã‚‹DNSã‚µãƒ¼ãƒã®\u0010IPã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’è¨­å®šã™ã‚‹ï¼ essential ã‚³ãƒ³ãƒ†ãƒŠãŒå¿…é ˆã‹å¦ã‹ã‚’è¨­å®šã™ã‚‹ï¼ ãƒ»trueã®å ´åˆï¼Œã‚³ãƒ³ãƒ†ãƒŠãŒåœæ­¢ã™ã‚‹ã¨ï¼Œã‚¿ã‚¹ã‚¯ã«å«ã¾ã‚Œã‚‹å…¨ã‚³ãƒ³ãƒ†ãƒŠãŒåœæ­¢ã™ã‚‹ï¼falseã®å ´åˆï¼Œã‚³ãƒ³ãƒ†ãƒŠãŒåœæ­¢ã—ã¦ã‚‚ï¼Œãã®ä»–ã®ã‚³ãƒ³ãƒ†ãƒŠã¯åœæ­¢ã—ãªã„ï¼ healthCheck(command) --health-cmd ãƒ›ã‚¹ãƒˆãƒã‚·ãƒ³ã‹ã‚‰Fargateã«å¯¾ã—ã¦ï¼Œcurlã‚³ãƒãƒ³ãƒ‰ã«ã‚ˆã‚‹ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é€ä¿¡ã—ï¼Œãƒ¬ã‚¹ãƒãƒ³ã‚¹å†…å®¹ã‚’ç¢ºèªï¼ healthCheck(interval) --health-interval ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯ã®é–“éš”ã‚’è¨­å®šã™ã‚‹ï¼ healthCheck(retries) --health-retries ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯ã‚’æˆåŠŸã¨è¦‹ãªã™å›æ•°ã‚’è¨­å®šã™ã‚‹ï¼ hostName --hostname ã‚³ãƒ³ãƒ†ãƒŠã«ãƒ›ã‚¹ãƒˆåã‚’è¨­å®šã™ã‚‹ï¼ image ECRã®URLã‚’è¨­å®šã™ã‚‹ï¼ logConfiguration(logDriver) --log-driver ãƒ­ã‚°ãƒ‰ãƒ©ã‚¤ãƒãƒ¼ã‚’æŒ‡å®šã™ã‚‹ã“ã¨ã«ã‚ˆã‚Šï¼Œãƒ­ã‚°ã®å‡ºåŠ›å…ˆã‚’è¨­å®šã™ã‚‹ï¼ Dockerã®ãƒ­ã‚°ãƒ‰ãƒ©ã‚¤ãƒãƒ¼ã«ãŠãŠã‚ˆãå¯¾å¿œã—ã¦ãŠã‚Šï¼ŒFargateã§ã‚ã‚Œã°ã€awslogsï¼Œawsfirelensï¼Œsplunkã€ã«è¨­å®šã§ãã‚‹ï¼EC2ã§ã‚ã‚Œã°ã€awslogsï¼Œjson-fileï¼Œsyslogï¼Œjournaldï¼Œfluentdï¼Œgelfï¼Œlogentriesã€ã‚’è¨­å®šã§ãã‚‹ï¼ logConfiguration(options) --log-opt ãƒ­ã‚°ãƒ‰ãƒ©ã‚¤ãƒãƒ¼ã«å¿œã˜ã¦ï¼Œè©³ç´°ãªè¨­å®šã‚’è¡Œã†ï¼ portMapping --publish--expose ãƒ›ã‚¹ãƒˆãƒã‚·ãƒ³ã¨Fargateã®ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ãƒãƒ¼ãƒˆç•ªå·ã‚’ãƒãƒƒãƒ”ãƒ³ã‚°ã—ï¼Œãƒãƒ¼ãƒˆãƒ•ã‚©ãƒ¯ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã‚’è¡Œã†ï¼ containerPortã®ã¿ã‚’è¨­å®šã—ï¼ŒhostPortã¯è¨­å®šã—ãªã‘ã‚Œã°ï¼ŒEXPOSEã¨ã—ã¦å®šç¾©ã§ãã‚‹ï¼å‚è€ƒï¼šhttps://docs.aws.amazon.com/ja_jp/AmazonECS/latest/APIReference/API_PortMapping.html secrets(volumesFrom) SSMãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚¹ãƒˆã‚¢ã‹ã‚‰å‡ºåŠ›ã™ã‚‹å¤‰æ•°ã‚’è¨­å®šã™ã‚‹ï¼ memory --memory--memory-reservation ã‚¿ã‚¹ã‚¯å…¨ä½“ã«å‰²ã‚Šå½“ã¦ã‚‰ã‚ŒãŸãƒ¡ãƒ¢ãƒªã®ã†ã¡ï¼Œè©²å½“ã®ã‚³ãƒ³ãƒ†ãƒŠã«å‰²ã‚Šå½“ã¦ã‚‹ãƒ¡ãƒ¢ãƒªåˆ†ã‚’è¨­å®šã™ã‚‹ï¼ mountPoints ulimit Linuxã‚³ãƒãƒ³ãƒ‰ã®--ulimitã«ç›¸å½“ ãƒ»awslogsãƒ‰ãƒ©ã‚¤ãƒãƒ¼ æ¨™æº–å‡ºåŠ›ï¼æ¨™æº–ã‚¨ãƒ©ãƒ¼å‡ºåŠ›ã«å‡ºåŠ›ã•ã‚ŒãŸãƒ­ã‚°ã‚’CloudWatch-APIã«é€ä¿¡ã™ã‚‹ï¼ å‚è€ƒï¼š https://docs.docker.com/config/containers/logging/awslogs/ https://docs.aws.amazon.com/ja_jp/AmazonECS/latest/developerguide/using_awslogs.html#create_awslogs_logdriver_options è¨­å®šé …ç›® èª¬æ˜ è£œè¶³ awslogs-group ãƒ­ã‚°é€ä¿¡å…ˆã®CloudWatchãƒ­ã‚°ã®ãƒ­ã‚°ã‚°ãƒ«ãƒ¼ãƒ—ã‚’è¨­å®šã™ã‚‹ï¼ awslogs-datetime-format æ—¥æ™‚ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã‚’å®šç¾©ã—ï¼Œã¾ãŸã“ã‚Œã‚’ãƒ­ã‚°ã®åŒºåˆ‡ã‚Šå˜ä½ã¨ã—ã¦ãƒ­ã‚°ã‚¹ãƒˆãƒªãƒ¼ãƒ ã«å‡ºåŠ›ã™ã‚‹ï¼ æ­£è¦è¡¨ç¾ã§è¨­å®šã™ã‚‹å¿…è¦ãŒã‚ã‚Šï¼Œã•ã‚‰ã«JSONã§ã¯ã€\\ã€ã‚’ã€\\\\ã€ã«ã‚¨ã‚¹ã‚±ãƒ¼ãƒ—ã—ãªã‘ã‚Œã°ãªã‚‰ãªã„ï¼ä¾‹ãˆã°ã€\\\\[%Y-%m-%d %H:%M:%S\\\\]ã€ã¨ãªã‚‹ï¼å‚è€ƒï¼šhttps://docs.docker.com/config/containers/logging/awslogs/#awslogs-datetime-format awslogs-region ãƒ­ã‚°é€ä¿¡å…ˆã®CloudWatchãƒ­ã‚°ã®ãƒªãƒ¼ã‚¸ãƒ§ãƒ³ã‚’è¨­å®šã™ã‚‹ï¼ awslogs-stream-prefix ãƒ­ã‚°é€ä¿¡å…ˆã®CloudWatchãƒ­ã‚°ã®ãƒ­ã‚°ã‚¹ãƒˆãƒªãƒ¼ãƒ ã®ãƒ—ãƒ¬ãƒ•ã‚£ãƒƒã‚¯ã‚¹åã‚’è¨­å®šã™ã‚‹ï¼ ãƒ­ã‚°ã‚¹ãƒˆãƒªãƒ¼ãƒ ã«ã¯ï¼Œã€//ã€ã®å½¢å¼ã§é€ä¿¡ã•ã‚Œã‚‹ï¼ ãƒ»å‰²ã‚Šå½“ã¦ã‚‰ã‚Œã‚‹ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆIPã‚¢ãƒ‰ãƒ¬ã‚¹ ã‚¿ã‚¹ã‚¯ã”ã¨ã«ç•°ãªã‚‹ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆIPãŒå‰²ã‚Šå½“ã¦ã‚‰ã‚Œã‚‹ï¼ã“ã®IPã‚¢ãƒ‰ãƒ¬ã‚¹ã«å¯¾ã—ã¦ï¼ŒALBã¯ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã‚’è¡Œã†ï¼ ãƒ­ãƒ¼ãƒ« ãƒ»ã‚µãƒ¼ãƒ“ã‚¹ãƒ­ãƒ¼ãƒ« ã‚µãƒ¼ãƒ“ã‚¹æ©Ÿèƒ½ãŒã‚¿ã‚¹ã‚¯ã‚’æ“ä½œã™ã‚‹ãŸã‚ã«å¿…è¦ãªãƒ­ãƒ¼ãƒ«ã®ã“ã¨ï¼ã‚µãƒ¼ãƒ“ã‚¹ãƒªãƒ³ã‚¯ãƒ­ãƒ¼ãƒ«ã«å«ã¾ã‚Œï¼ŒECSã®æ§‹ç¯‰æ™‚ã«è‡ªå‹•çš„ã«ã‚¢ã‚¿ãƒƒãƒã•ã‚Œã‚‹ï¼ ãƒ»ã‚¿ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ« ã‚¿ã‚¹ã‚¯å†…ã®ã‚³ãƒ³ãƒ†ãƒŠã®ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãŒï¼Œä»–ã®ãƒªã‚½ãƒ¼ã‚¹ã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ãŸã‚ã«å¿…è¦ãªãƒ­ãƒ¼ãƒ«ã®ã“ã¨ï¼ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã«S3ã‚„SSMã¸ã®ã‚¢ã‚¯ã‚»ã‚¹æ¨©é™ã‚’ä¸ãˆãŸã„å ´åˆã¯ï¼Œã‚¿ã‚¹ã‚¯å®Ÿè¡Œãƒ­ãƒ¼ãƒ«ã§ã¯ãªãã‚¿ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã«æ¨©é™ã‚’ã‚¢ã‚¿ãƒƒãƒã™ã‚‹ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‹ã‚‰CloudWatchãƒ­ã‚°ã«ãƒ­ã‚°ã‚’é€ä¿¡ã™ã‚‹ãŸã‚ã«ï¼ŒECSã‚¿ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã«ã‚«ã‚¹ã‚¿ãƒãƒ¼ç®¡ç†ãƒãƒªã‚·ãƒ¼ã‚’ã‚¢ã‚¿ãƒƒãƒã™ã‚‹ï¼ { \"Version\": \"2012-10-17\", \"Statement\": [ { \"Effect\": \"Allow\", \"Action\": [ \"logs:CreateLogStream\", \"logs:PutLogEvents\" ], \"Resource\": [ \"arn:aws:logs:*:*:*\" ] } ] } ï¼Šå®Ÿè£…ä¾‹ï¼Š SSMãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚¹ãƒˆã‚¢ã‹ã‚‰å¤‰æ•°ã‚’å–å¾—ã™ã‚‹ãŸã‚ã«ï¼ŒECSã‚¿ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã«ã‚¤ãƒ³ãƒ©ã‚¤ãƒ³ãƒãƒªã‚·ãƒ¼ã‚’ã‚¢ã‚¿ãƒƒãƒã™ã‚‹ï¼ { \"Version\": \"2012-10-17\", \"Statement\": [ { \"Effect\": \"Allow\", \"Action\": [ \"ssm:GetParameters\" ], \"Resource\": \"*\" } ] } ãƒ»ã‚¿ã‚¹ã‚¯å®Ÿè¡Œãƒ­ãƒ¼ãƒ« ã‚¿ã‚¹ã‚¯ä¸Šã«å­˜åœ¨ã™ã‚‹ã‚³ãƒ³ãƒ†ãƒŠã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆãŒï¼Œä»–ã®ãƒªã‚½ãƒ¼ã‚¹ã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ãŸã‚ã«å¿…è¦ãªãƒ­ãƒ¼ãƒ«ã®ã“ã¨ï¼AWSç®¡ç†ãƒãƒªã‚·ãƒ¼ã§ã‚ã‚‹ã€AmazonECSTaskExecutionRolePolicyã€ãŒã‚¢ã‚¿ãƒƒãƒã•ã‚ŒãŸãƒ­ãƒ¼ãƒ«ã‚’ï¼Œã‚¿ã‚¹ã‚¯ã«ã‚¢ã‚¿ãƒƒãƒã™ã‚‹å¿…è¦ãŒã‚ã‚‹ï¼ã“ã®ãƒãƒªã‚·ãƒ¼ã«ã¯ï¼ŒECRã¸ã®ã‚¢ã‚¯ã‚»ã‚¹æ¨©é™ã®ä»–ï¼ŒCloudWatchãƒ­ã‚°ã«ãƒ­ã‚°ã‚’ç”Ÿæˆã™ã‚‹ãŸã‚ã®æ¨©é™ãŒè¨­å®šã•ã‚Œã¦ã„ã‚‹ï¼ã‚¿ã‚¹ã‚¯å†…ã®ã‚³ãƒ³ãƒ†ãƒŠãŒãƒªã‚½ãƒ¼ã‚¹ã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ãŸã‚ã«å¿…è¦ãªã‚¿ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã¨ã¯åŒºåˆ¥ã™ã‚‹ã“ã¨ï¼ { \"Version\": \"2012-10-17\", \"Statement\": [ { \"Effect\": \"Allow\", \"Action\": [ \"ecr:GetAuthorizationToken\", \"ecr:BatchCheckLayerAvailability\", \"ecr:GetDownloadUrlForLayer\", \"ecr:BatchGetImage\", \"logs:CreateLogStream\", \"logs:PutLogEvents\" ], \"Resource\": \"*\" } ] } ï¼Šå®Ÿè£…ä¾‹ï¼Š Datadogã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆãŒã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ã‚„ã‚³ãƒ³ãƒ†ãƒŠã«ã‚¢ã‚¯ã‚»ã‚¹ã§ãã‚‹ã‚ˆã†ã«ï¼ŒECSã‚¿ã‚¹ã‚¯å®Ÿè¡Œãƒ­ãƒ¼ãƒ«ã«ã‚«ã‚¹ã‚¿ãƒãƒ¼ç®¡ç†ãƒãƒªã‚·ãƒ¼ã‚’ã‚¢ã‚¿ãƒƒãƒã™ã‚‹ï¼ { \"Version\": \"2012-10-17\", \"Statement\": [ { \"Action\": [ \"ecs:ListClusters\", \"ecs:ListContainerInstances\", \"ecs:DescribeContainerInstances\" ], \"Effect\": \"Allow\", \"Resource\": \"*\" } ] } ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ãƒ¢ãƒ¼ãƒ‰ã¨ã‚³ãƒ³ãƒ†ãƒŠé–“é€šä¿¡ ãƒ»noneãƒ¢ãƒ¼ãƒ‰ å¤–éƒ¨ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ãŒç„¡ãï¼Œã‚¿ã‚¹ã‚¯ã¨å¤–ã¨é€šä¿¡ã§ããªã„ï¼ ãƒ»hostãƒ¢ãƒ¼ãƒ‰ Dockerã®hostãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã«ç›¸å½“ã™ã‚‹ï¼ ãƒ»bridgeãƒ¢ãƒ¼ãƒ‰ Dockerã®bridgeãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã«ç›¸å½“ã™ã‚‹ï¼ ãƒ»awsvpcãƒ¢ãƒ¼ãƒ‰ awsã®ç‹¬è‡ªãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ãƒ¢ãƒ¼ãƒ‰ï¼ã‚¿ã‚¹ã‚¯ã¯Elastic Networkã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã¨ç´ä»˜ã‘ã‚‰ã‚Œï¼ŒPrimary ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆIPã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’å‰²ã‚Šå½“ã¦ã‚‰ã‚Œã‚‹ï¼åŒã˜ã‚¿ã‚¹ã‚¯ã«å±ã™ã‚‹ã‚³ãƒ³ãƒ†ãƒŠé–“ã¯ï¼Œlocalhostã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ã‚¤ã‚¹ã¨ã„ã†ENIçµŒç”±ã§é€šä¿¡ã§ãã‚‹ã‚ˆã†ã«ãªã‚‹ï¼ˆæ¨æ¸¬ã§ã¯ã‚ã‚‹ãŒï¼ŒFargateç’°å¢ƒã§ã‚³ãƒ³ãƒ†ãƒŠã®ãƒ›ã‚¹ãƒˆã¨ãªã‚‹EC2ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã«localhostã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ãŒç´ä»˜ã‘ã‚‰ã‚Œã‚‹ï¼‰ï¼ã“ã‚Œã«ã‚ˆã‚Šï¼Œã‚³ãƒ³ãƒ†ãƒŠã‹ã‚‰ã‚³ãƒ³ãƒ†ãƒŠã«ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’è»¢é€ã™ã‚‹ã¨ãï¼ˆä¾‹ï¼šNginxã‚³ãƒ³ãƒ†ãƒŠã‹ã‚‰PHP-FPMã‚³ãƒ³ãƒ†ãƒŠã¸ã®è»¢é€ï¼‰ã¯ï¼Œè»¢é€å…ƒã‚³ãƒ³ãƒ†ãƒŠã«ã¦ï¼Œè»¢é€å…ˆã®ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’ã€localhostï¼ˆ127.0.0.1ï¼‰ã€ã§æŒ‡å®šã™ã‚Œã°è‰¯ã„ï¼ã¾ãŸï¼Œawsvpcãƒ¢ãƒ¼ãƒ‰ã®ç‹¬è‡ªã®ä»•çµ„ã¿ã¨ã—ã¦ï¼ŒåŒã˜ã‚¿ã‚¹ã‚¯å†…ã§ã‚ã‚Œã°ï¼Œäº’ã„ã«ã‚³ãƒ³ãƒ†ãƒŠãƒãƒ¼ãƒˆã‚’é–‹æ”¾ã›ãšã¨ã‚‚ï¼Œãƒ—ãƒ­ã‚»ã‚¹ã®ãƒªãƒƒã‚¹ãƒ³ã™ã‚‹ãƒãƒ¼ãƒˆã‚’æŒ‡å®šã™ã‚‹ã ã‘ã§ã‚³ãƒ³ãƒ†ãƒŠé–“é€šä¿¡ãŒå¯èƒ½ã§ã‚ã‚‹ï¼ä¾‹ãˆã°ï¼ŒNginxã‚³ãƒ³ãƒ†ãƒŠã‹ã‚‰PHP-FPMã‚³ãƒ³ãƒ†ãƒŠã«ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’è»¢é€ã™ã‚‹ãŸã‚ã«ã¯ï¼ŒPHP-FPMãƒ—ãƒ­ã‚»ã‚¹ãŒ9000ç•ªãƒãƒ¼ãƒˆã‚’ãƒªãƒƒã‚¹ãƒ³ã—ï¼Œã•ã‚‰ã«ã‚³ãƒ³ãƒ†ãƒŠãŒ9000ç•ªãƒãƒ¼ãƒˆã‚’é–‹æ”¾ã™ã‚‹å¿…è¦ãŒã‚ã‚‹ï¼ã—ã‹ã—ï¼Œawsvpcãƒ¢ãƒ¼ãƒ‰ã§ã¯ã‚³ãƒ³ãƒ†ãƒŠãƒãƒ¼ãƒˆã‚’é–‹æ”¾ã™ã‚‹å¿…è¦ã¯ãªã„ï¼ å‚è€ƒï¼šhttps://docs.aws.amazon.com/ja_jp/AmazonECS/latest/userguide/fargate-task-networking.html ã‚¿ã‚¹ã‚¯ã®ãƒ‡ãƒ—ãƒ­ã‚¤æ–¹æ³•ã®ç¨®é¡ ãƒ»ãƒ­ãƒ¼ãƒªãƒ³ã‚°ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆ å‚è€ƒï¼šhttps://toris.io/2021/04/speeding-up-amazon-ecs-container-deployments/ æœ€å°ãƒ˜ãƒ«ã‚¹ç‡ã®è¨­å®šå€¤ã«åŸºã¥ã„ã¦ï¼Œãƒ­ãƒ¼ãƒªãƒ³ã‚°ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆæ™‚ã®ç¨¼åƒä¸­ã‚¿ã‚¹ã‚¯ã®æœ€ä½åˆè¨ˆæ•°ãŒæ±ºå®šã•ã‚Œã‚‹ï¼ æœ€å¤§ç‡ã®è¨­å®šå€¤ã«åŸºã¥ã„ã¦ï¼Œãƒ­ãƒ¼ãƒªãƒ³ã‚°ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆæ™‚ã®ç¨¼åƒä¸­ï¼åœæ­¢ä¸­ã‚¿ã‚¹ã‚¯ã®æœ€é«˜åˆè¨ˆæ•°ãŒæ±ºã¾ã‚‹ ECSã¯ï¼Œæ—¢å­˜ã‚¿ã‚¹ã‚¯ã‚’ç¨¼åƒä¸­ã®ã¾ã¾ï¼Œæ–°ã‚¿ã‚¹ã‚¯ã‚’æœ€é«˜åˆè¨ˆæ•°ã„ã£ã±ã„ã¾ã§æ§‹ç¯‰ã™ã‚‹ï¼ ECSã¯ï¼ŒçŒ¶äºˆæœŸé–“å¾Œã«ALBï¼NLBã«ã‚ˆã‚‹æ–°ã‚¿ã‚¹ã‚¯ã«å¯¾ã™ã‚‹ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯ã®çµæœã‚’ç¢ºèªã™ã‚‹ï¼ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯ãŒæˆåŠŸã—ã¦ã„ã‚Œã°ï¼Œæ—¢å­˜ã‚¿ã‚¹ã‚¯ã‚’åœæ­¢ã™ã‚‹ï¼ãŸã ã—ï¼Œæœ€å°ãƒ˜ãƒ«ã‚¹ç‡ã«ã‚ˆã‚‹ã‚¿ã‚¹ã‚¯ã®æœ€ä½åˆè¨ˆæ•°ãŒä¿ãŸã‚Œã‚‹ï¼ ã€æ–°ã‚¿ã‚¹ã‚¯ã®èµ·å‹•ã€ã¨ã€ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯ç¢ºèªå¾Œã®æ—¢å­˜ã‚¿ã‚¹ã‚¯ã®åœæ­¢ã€ã®ãƒ—ãƒ­ã‚»ã‚¹ãŒç¹°ã‚Šè¿”ã—å®Ÿè¡Œã•ã‚Œï¼Œå¾ã€…ã«æ—¢å­˜ã‚¿ã‚¹ã‚¯ãŒæ–°ã‚¿ã‚¹ã‚¯ã«ç½®ãæ›ã‚ã‚‹ï¼ å…¨ã¦ã®æ—¢å­˜ã‚¿ã‚¹ã‚¯ãŒæ–°ã‚¿ã‚¹ã‚¯ã«ç½®ãæ›ã‚ã‚‹ï¼ ãƒ»Blue/Greenãƒ‡ãƒ—ãƒ­ã‚¤ãƒ¡ãƒ³ãƒˆ CodeDeployã‚’ä½¿ç”¨ã—ã¦ãƒ‡ãƒ—ãƒ­ã‚¤ã‚’è¡Œã†ï¼æœ¬ãƒãƒ¼ãƒˆå†…ã‚’æ¤œç´¢ã›ã‚ˆï¼ ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆãªECSã‚¿ã‚¹ã‚¯ã®ã‚¢ã‚¦ãƒˆãƒã‚¦ãƒ³ãƒ‰é€šä¿¡ ãƒ»ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆã‚µãƒ–ãƒãƒƒãƒˆã‹ã‚‰ã®é€šä¿¡ ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆã‚µãƒ–ãƒãƒƒãƒˆã«ECSã‚¿ã‚¹ã‚¯ã‚’é…ç½®ã—ãŸå ´åˆï¼Œã‚¢ã‚¦ãƒˆãƒã‚¦ãƒ³ãƒ‰ãªé€šä¿¡ã‚’å®Ÿè¡Œã™ã‚‹ãŸã‚ã«ã¯ï¼ŒNAT Gatewayã¾ãŸã¯VPCã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã‚’é…ç½®ã™ã‚‹å¿…è¦ãŒã‚ã‚‹ï¼ãƒ‘ãƒ–ãƒªãƒƒã‚¯ã‚µãƒ–ãƒãƒƒãƒˆã«é…ç½®ã™ã‚Œã°ã“ã‚Œã‚‰ã¯ä¸è¦ã¨ãªã‚‹ãŒï¼Œãƒ‘ãƒ–ãƒªãƒƒã‚¯ã‚µãƒ–ãƒãƒƒãƒˆã‚ˆã‚Šã‚‚ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆã‚µãƒ–ãƒãƒƒãƒˆã«ECSã‚¿ã‚¹ã‚¯ã‚’é…ç½®ã™ã‚‹æ–¹ãŒæœ›ã¾ã—ã„ï¼ ãƒ»NAT Gatewayã‚’çµŒç”± Fargateã‹ã‚‰ECRã«å¯¾ã™ã‚‹Dockerã‚¤ãƒ¡ãƒ¼ã‚¸ã®ãƒ—ãƒ«ã¯ï¼ŒVPCã®å¤–å´ã«å¯¾ã™ã‚‹ã‚¢ã‚¦ãƒˆãƒã‚¦ãƒ³ãƒ‰é€šä¿¡ï¼ˆã‚°ãƒ­ãƒ¼ãƒãƒ«ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯å‘ãé€šä¿¡ï¼‰ã§ã‚ã‚‹ï¼ä»¥ä¸‹ã®é€šã‚Šï¼ŒNAT Gatewayã‚’è¨­ç½®ã—ãŸã¨ã™ã‚‹ï¼ã“ã®å ´åˆï¼ŒECSã‚„ECRã¨ã®ã‚¢ã‚¦ãƒˆãƒã‚¦ãƒ³ãƒ‰é€šä¿¡ãŒNAT Gatewayã‚’é€šéã™ã‚‹ãŸã‚ï¼Œé«˜é¡æ–™é‡‘ã‚’è«‹æ±‚ã•ã‚Œã¦ã—ã¾ã†ï¼ ãƒ»VPCã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã‚’çµŒç”± VPCã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã‚’è¨­ã‘ï¼Œã“ã‚Œã«å¯¾ã—ã¦ã‚¢ã‚¦ãƒˆãƒã‚¦ãƒ³ãƒ‰é€šä¿¡ã‚’è¡Œã†ã‚ˆã†ã«ã™ã‚‹ã¨ã‚ˆã„ï¼ãªãŠï¼ŒNAT Gatewayã¨VPCã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã®ä¸¡æ–¹ã‚’æ§‹ç¯‰ã—ã¦ã„ã‚‹å ´åˆï¼Œãƒ«ãƒ¼ãƒˆãƒ†ãƒ¼ãƒ–ãƒ«ã§ã¯ï¼ŒVPCã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã¸ã®ã‚¢ã‚¦ãƒˆãƒã‚¦ãƒ³ãƒ‰é€šä¿¡ã®æ–¹ãŒå„ªå…ˆã•ã‚Œã‚‹ï¼æ–™é‡‘çš„ãªè¦³ç‚¹ã‹ã‚‰ï¼ŒNAT Gatewayã‚ˆã‚Šã‚‚VPCã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã‚’çµŒç”±ã—ãŸæ–¹ãŒã‚ˆã„ï¼ VPCã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã®æ¥ç¶šå…ˆ ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆDNSå èª¬æ˜ CloudWatchãƒ­ã‚° logs.ap-northeast-1.amazonaws.com ECSã‚³ãƒ³ãƒ†ãƒŠã®ãƒ­ã‚°ã‚’POSTãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é€ä¿¡ã™ã‚‹ãŸã‚ï¼ ECR api.ecr.ap-northeast-1.amazonaws.com*.dkr.ecr.ap-northeast-1.amazonaws.com ã‚¤ãƒ¡ãƒ¼ã‚¸ã®GETãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é€ä¿¡ã™ã‚‹ãŸã‚ï¼ S3 ãªã— ã‚¤ãƒ¡ãƒ¼ã‚¸ã®ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚’POSTãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é€ä¿¡ã™ã‚‹ãŸã‚ SSMãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚¹ãƒˆã‚¢ ssm.ap-northeast-1.amazonaws.com SSMãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚¹ãƒˆã‚¢ã«GETãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é€ä¿¡ã™ã‚‹ãŸã‚ï¼ SSMã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆãƒãƒãƒ¼ã‚¸ãƒ£ ssmmessage.ap-northeast-1.amazonaws.com ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆãƒãƒãƒ¼ã‚¸ãƒ£ã®æ©Ÿèƒ½ã‚’ä½¿ç”¨ã™ã‚‹ãŸã‚ï¼ FireLensã‚³ãƒ³ãƒ†ãƒŠ ãƒ»FireLensã‚³ãƒ³ãƒ†ãƒŠã¨ã¯ ä»¥ä¸‹ã®ãƒãƒ¼ãƒˆã‚’å‚è€ƒã«ã›ã‚ˆï¼ å‚è€ƒï¼šhttps://hiroki-it.github.io/tech-notebook-gitbook/public/summary.html?q=firelens Tips ãƒ»å‰²ã‚Šå½“ã¦ã‚‰ã‚Œã‚‹ãƒ‘ãƒ–ãƒªãƒƒã‚¯IPã‚¢ãƒ‰ãƒ¬ã‚¹ï¼ŒFargateã®IPã‚¢ãƒ‰ãƒ¬ã‚¹å•é¡Œ Fargateã«ãƒ‘ãƒ–ãƒªãƒƒã‚¯IPã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’æŒãŸã›ãŸã„å ´åˆï¼ŒElastic IPã‚¢ãƒ‰ãƒ¬ã‚¹ã®è¨­å®šé …ç›®ãŒãªãï¼Œå‹•çš„ãƒ‘ãƒ–ãƒªãƒƒã‚¯IPã‚¢ãƒ‰ãƒ¬ã‚¹ã—ã‹è¨­å®šã§ããªã„ï¼ˆFargateã®å†æ§‹ç¯‰å¾Œã«å¤‰åŒ–ã™ã‚‹ï¼‰ï¼ã‚¢ã‚¦ãƒˆãƒã‚¦ãƒ³ãƒ‰é€šä¿¡ã®å…ˆã«ã‚ã‚‹å¤–éƒ¨ã‚µãƒ¼ãƒ“ã‚¹ãŒï¼Œã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ä¸Šã§é™çš„ãªIPã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’è¦æ±‚ã™ã‚‹å ´åˆï¼Œã‚¢ã‚¦ãƒˆãƒã‚¦ãƒ³ãƒ‰é€šä¿¡ï¼ˆã‚°ãƒ­ãƒ¼ãƒãƒ«ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯å‘ãé€šä¿¡ï¼‰æ™‚ã«é€ä¿¡å…ƒãƒ‘ã‚±ãƒƒãƒˆã«ä»˜åŠ ã•ã‚Œã‚‹IPã‚¢ãƒ‰ãƒ¬ã‚¹ãŒå‹•çš„ã«ãªã‚Šï¼Œãƒªã‚¯ã‚¨ã‚¹ãƒˆãŒã§ããªããªã£ã¦ã—ã¾ã†ï¼ ãã“ã§ï¼ŒFargateã®ã‚¢ã‚¦ãƒˆãƒã‚¦ãƒ³ãƒ‰é€šä¿¡ãŒï¼ŒElastic IPã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’æŒã¤NAT Gatewayã‚’çµŒç”±ã™ã‚‹ã‚ˆã†ã«ã™ã‚‹ï¼ˆFargateã¯ï¼Œãƒ‘ãƒ–ãƒªãƒƒã‚¯ã‚µãƒ–ãƒãƒƒãƒˆã¨ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆã‚µãƒ–ãƒãƒƒãƒˆã®ã©ã¡ã‚‰ã«ç½®ã„ã¦ã‚‚è‰¯ã„ï¼‰ï¼ã“ã‚Œã«ã‚ˆã£ã¦ï¼ŒNat Gatewayã®Elastic IPã‚¢ãƒ‰ãƒ¬ã‚¹ãŒé€ä¿¡å…ƒãƒ‘ã‚±ãƒƒãƒˆã«ä»˜åŠ ã•ã‚Œã‚‹ãŸã‚ï¼ŒFargateã®é€ä¿¡å…ƒIPã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’è¦‹ã‹ã‘ä¸Šé™çš„ã«æ‰±ã†ã“ã¨ãŒã§ãã‚‹ã‚ˆã†ã«ãªã‚‹ï¼ å‚è€ƒï¼šhttps://aws.amazon.com/jp/premiumsupport/knowledge-center/ecs-fargate-static-elastic-ip-address/ 15. EFSï¼šElastic File System EFSã¨ã¯ ãƒã‚¦ãƒ³ãƒˆã‚¿ãƒ¼ã‚²ãƒƒãƒˆã¨æ¥ç¶šã•ã‚ŒãŸç‰‡æ–¹ã®EC2ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‹ã‚‰ï¼Œãƒ•ã‚¡ã‚¤ãƒ«ã‚’èª­ã¿è¾¼ã¿ï¼Œã“ã‚Œã‚’ã‚‚ã†ä¸€æ–¹ã«å‡ºåŠ›ã™ã‚‹ï¼ãƒ•ã‚¡ã‚¤ãƒ«ã®å®Ÿä½“ã¯ã„ãšã‚Œã‹ã®EC2ã«å­˜åœ¨ã—ã¦ã„ã‚‹ãŸã‚ï¼Œæ¥ç¶šã‚’åˆ‡æ–­ã—ã¦ã„ã‚‹é–“ï¼Œç‰‡æ–¹ã®EC2ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹å†…ã®ãƒ•ã‚¡ã‚¤ãƒ«ã¯ç„¡ããªã‚‹ï¼å†æ¥ç¶šã™ã‚‹ã¨ï¼Œåˆ‡æ–­ç›´å‰ã®ãƒ•ã‚¡ã‚¤ãƒ«ãŒå†ã³è¡¨ç¤ºã•ã‚Œã‚ˆã†ã«ãªã‚‹ï¼ è¨­å®šé …ç›® ãƒ»æ¦‚è¦ è¨­å®šé …ç›® èª¬æ˜ è£œè¶³ ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ¢ãƒ¼ãƒ‰ ã‚¹ãƒ«ãƒ¼ãƒ—ãƒƒãƒˆãƒ¢ãƒ¼ãƒ‰ EFSã®ã‚¹ãƒ«ãƒ¼ãƒ—ãƒƒãƒˆæ€§èƒ½ã‚’è¨­å®šã™ã‚‹ï¼ ãƒ©ã‚¤ãƒ•ã‚µã‚¤ã‚¯ãƒ«ãƒãƒªã‚·ãƒ¼ ã—ã°ã‚‰ããƒªã‚¯ã‚¨ã‚¹ãƒˆã•ã‚Œã¦ã„ãªã„ãƒ•ã‚¡ã‚¤ãƒ«ãŒä½é »åº¦ã‚¢ã‚¯ã‚»ã‚¹ï¼ˆIAï¼šInfrequent Accessï¼‰ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‚¯ãƒ©ã‚¹ã«ç§»å‹•ä¿å­˜ã™ã‚‹ã¾ã§ã®æœŸé™ã‚’è¨­å®šã™ã‚‹ï¼ ãƒ»ãƒ©ã‚¤ãƒ•ã‚µã‚¤ã‚¯ãƒ«ãƒãƒªã‚·ãƒ¼ã‚’æœ‰åŠ¹ã«ã—ãªã„å ´åˆï¼Œã‚¹ã‚¿ãƒ³ãƒ€ãƒ¼ãƒ‰ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‚¯ãƒ©ã‚¹ã®ã¿ãŒä½¿ç”¨ã•ã‚Œã‚‹ï¼ãƒ»ç”»é¢ã‹ã‚‰ä¸¡ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã®ä½¿ç”¨é‡ã‚’ç¢ºèªã§ãã‚‹ï¼å‚è€ƒï¼šhttps://ap-northeast-1.console.aws.amazon.com/efs/home?region=ap-northeast-1#/file-systems/fs-f77d60d6 ãƒ•ã‚¡ã‚¤ãƒ«ã‚·ã‚¹ãƒ†ãƒ ãƒãƒªã‚·ãƒ¼ ä»–ã®AWSãƒªã‚½ãƒ¼ã‚¹ãŒEFSã‚’åˆ©ç”¨ã™ã‚‹æ™‚ã®ãƒãƒªã‚·ãƒ¼ã‚’è¨­å®šã™ã‚‹ï¼ è‡ªå‹•ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ— AWS Backupã«å®šæœŸçš„ã«ä¿å­˜ã™ã‚‹ã‹ã©ã†ã‹ã‚’è¨­å®šã™ã‚‹ï¼ ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ ãƒã‚¦ãƒ³ãƒˆã‚¿ãƒ¼ã‚²ãƒƒãƒˆã‚’è¨­ç½®ã™ã‚‹ã‚µãƒ–ãƒãƒƒãƒˆï¼Œã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚°ãƒ«ãƒ¼ãƒ—ã‚’è¨­å®šã™ã‚‹ï¼ ãƒ»ã‚µãƒ–ãƒãƒƒãƒˆã¯ï¼Œãƒ•ã‚¡ã‚¤ãƒ«ä¾›çµ¦ã®é€Ÿåº¦ã®è¦³ç‚¹ã‹ã‚‰ï¼Œãƒã‚¦ãƒ³ãƒˆã‚¿ãƒ¼ã‚²ãƒƒãƒˆã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹AWSãƒªã‚½ãƒ¼ã‚¹ã¨åŒã˜ã«ã™ã‚‹ï¼ãƒ»ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚°ãƒ«ãƒ¼ãƒ—ã¯ï¼ŒEC2ã‹ã‚‰ã®NFSãƒ—ãƒ­ãƒˆã‚³ãƒ«ã‚¢ã‚¯ã‚»ã‚¹ã‚’è¨±å¯ã—ãŸã‚‚ã®ã‚’è¨­å®šã™ã‚‹ï¼EC2ã®ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚°ãƒ«ãƒ¼ãƒ—ã‚’é€šéã—ãŸã‚¢ã‚¯ã‚»ã‚¹ã ã‘ã‚’è¨±å¯ã™ã‚‹ãŸã‚ã«ï¼ŒIPã‚¢ãƒ‰ãƒ¬ã‚¹ã§ã¯ï¼ŒEC2ã®ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚°ãƒ«ãƒ¼ãƒ—ã‚’è¨­å®šã™ã‚‹ï¼ ã‚¹ãƒšãƒƒã‚¯ ãƒ»ãƒãƒ¼ã‚¹ãƒˆãƒ¢ãƒ¼ãƒ‰ã®ä»•çµ„ã¿ ã‚¹ãƒ«ãƒ¼ãƒ—ãƒƒãƒˆæ€§èƒ½ã®è‡ªå‹•ã‚¹ã‚±ãƒ¼ãƒªãƒ³ã‚°ã«æ®‹é«˜ãŒã‚ã‚Šï¼Œãƒ™ãƒ¼ã‚¹ãƒ©ã‚¤ãƒ³ã‚’è¶…éã—ãŸåˆ†ã ã‘è‡ªå‹•ã‚¹ã‚±ãƒ¼ãƒªãƒ³ã‚°æ®‹é«˜ãŒæ¸›ã£ã¦ã„ãï¼ã¾ãŸï¼Œãƒ™ãƒ¼ã‚¹ãƒ©ã‚¤ãƒ³æœªæº€ã®åˆ†ã¯æ®‹é«˜ã¨ã—ã¦è“„ç©ã•ã‚Œã¦ã„ãï¼ å…ƒã€…ã®æ®‹é«˜ã¯ï¼Œãƒ•ã‚¡ã‚¤ãƒ«ã‚·ã‚¹ãƒ†ãƒ ã®ã‚¹ã‚¿ãƒ³ãƒ€ãƒ¼ãƒ‰ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‚¯ãƒ©ã‚¹ã®å®¹é‡ã«å¿œã˜ã¦å¤§ãããªã‚‹ï¼ å‚è€ƒï¼šhttps://docs.aws.amazon.com/ja_jp/efs/latest/ug/performance.html#efs-burst-credits æ®‹é«˜ã¯ï¼ŒBurstCreditBalanceãƒ¡ãƒˆãƒªã‚¯ã‚¹ã‹ã‚‰ç¢ºèªã§ãã‚‹ï¼ã“ã®ãƒ¡ãƒˆãƒªã‚¯ã‚¹ãŒå¸¸ã«æ¸›å°‘ã—ç¶šã‘ã¦ã„ã‚‹å ´åˆã¯ãƒ—ãƒ­ãƒ“ã‚¸ãƒ§ãƒ‹ãƒ³ã‚°ãƒ¢ãƒ¼ãƒ‰ã®æ–¹ãŒã‚ˆã‚Šé©åˆ‡ã§ã‚ã‚‹ï¼ å‚è€ƒï¼šhttps://docs.aws.amazon.com/ja_jp/efs/latest/ug/performance.html#using-throughputmode ãƒ»ãƒ—ãƒ­ãƒ“ã‚¸ãƒ§ãƒ‹ãƒ³ã‚°ãƒ¢ãƒ¼ãƒ‰ã®ä»•çµ„ã¿ ã‚¹ãƒ«ãƒ¼ãƒ—ãƒƒãƒˆæ€§èƒ½ã®è‡ªå‹•ã‚¹ã‚±ãƒ¼ãƒªãƒ³ã‚°æ©Ÿèƒ½ã¯ç„¡ã„ãŒï¼Œä¸€å®šã®æ€§èƒ½ã¯ä¿è¨¼ã•ã‚Œã¦ã„ã‚‹ï¼ å‚è€ƒï¼šhttps://docs.aws.amazon.com/ja_jp/efs/latest/ug/performance.html#provisioned-throughput ã‚³ãƒãƒ³ãƒ‰ ãƒ»ãƒã‚¦ãƒ³ãƒˆ DNSçµŒç”±ã§ï¼ŒEFSãƒã‚¦ãƒ³ãƒˆãƒ˜ãƒ«ãƒ‘ãƒ¼ã‚’ä½¿ç”¨ã—ãŸå ´åˆã‚’ç¤ºã™ï¼ $ mount -t -o tls :/ # EFSã§ï¼Œãƒã‚¦ãƒ³ãƒˆãƒã‚¤ãƒ³ãƒˆã‚’ç™»éŒ² $ mount -t efs -o tls fs-xxxxx:/ /var/www/app # ãƒã‚¦ãƒ³ãƒˆãƒã‚¤ãƒ³ãƒˆã‚’è§£é™¤ $ umount /var/www/app # dfã‚³ãƒãƒ³ãƒ‰ã§ãƒã‚¦ãƒ³ãƒˆã—ã¦ã„ã‚‹ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’ç¢ºèªã§ãã‚‹ $ df Filesystem 1K-blocks Used Available Use% Mounted on fs-xxx.efs.ap-northeast-1.amazonaws.com:/ xxx xxx xxx 1% /var/www/cerenavi 16. ElastiCache ElasticCacheã¨ã¯ ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ä»£ã‚ã‚Šã«ï¼Œã‚»ãƒƒã‚·ãƒ§ãƒ³ï¼Œã‚¯ã‚¨ãƒªCacheï¼Œã‚’ç®¡ç†ã™ã‚‹ï¼Redisã¨MemcachedãŒã‚ã‚‹ï¼ Redisã®è¨­å®šé …ç›® è¨­å®šé …ç›® èª¬æ˜ è£œè¶³ ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ã‚¨ãƒ³ã‚¸ãƒ³ ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚¨ãƒ³ã‚¸ãƒ³ã‚’è¨­å®šã™ã‚‹ï¼Redisé€šå¸¸ãƒ¢ãƒ¼ãƒ‰ï¼ŒRedisã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ãƒ¢ãƒ¼ãƒ‰ã‹ã‚‰é¸æŠã™ã‚‹ï¼ Redisã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ãƒ¢ãƒ¼ãƒ‰ã¨åŒæ§˜ã«ï¼ŒRedisé€šå¸¸ãƒ¢ãƒ¼ãƒ‰ã‚‚ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼æ§‹æˆã«ãªã‚‹ï¼ãŸã ï¼Œã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ãƒ¢ãƒ¼ãƒ‰ã¨ã¯ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ã®æ§‹æˆæ–¹æ³•ãŒç•°ãªã‚‹ï¼ ãƒ­ã‚±ãƒ¼ã‚·ãƒ§ãƒ³ ã‚¨ãƒ³ã‚¸ãƒ³ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã®äº’æ›æ€§ é¸ã‚“ã ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚¨ãƒ³ã‚¸ãƒ³ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’è¨­å®šã™ã‚‹ï¼ ãƒã‚¤ãƒŠãƒ¼ãƒãƒ¼ã‚¸ãƒ§ãƒ³ãŒè‡ªå‹•çš„ã«æ›´æ–°ã•ã‚Œãªã„ã‚ˆã†ã«ï¼Œä¾‹ãˆã°ã€6.xã€ã¯è¨­å®šã—ãªã„æ–¹ãŒã‚ˆã„ï¼ ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚°ãƒ«ãƒ¼ãƒ— ã‚°ãƒ­ãƒ¼ãƒãƒ«ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’è¨­å®šã™ã‚‹ï¼ ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã‚’ä½¿ç”¨ã›ãšã«ç‹¬è‡ªå®šç¾©ã™ã‚‹å ´åˆï¼Œäº‹å‰ã«æ§‹ç¯‰ã—ã¦ãŠãå¿…è¦ãŒã‚ã‚‹ï¼ ãƒãƒ¼ãƒ‰ã®ã‚¿ã‚¤ãƒ— ãƒ¬ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³æ•° ãƒ—ãƒ©ã‚¤ãƒãƒªãƒãƒ¼ãƒ‰ã¨ã¯åˆ¥ã«ï¼Œãƒªãƒ¼ãƒ‰ãƒ¬ãƒ—ãƒªã‚«ãƒãƒ¼ãƒ‰ã‚’ã„ãã¤æ§‹ç¯‰ã™ã‚‹ã‹ã‚’è¨­å®šã™ã‚‹ï¼ ãƒãƒ«ãƒAZã«ãƒ—ãƒ©ã‚¤ãƒãƒªãƒãƒ¼ãƒ‰ã¨ãƒªãƒ¼ãƒ‰ãƒ¬ãƒ—ãƒªã‚«ãƒãƒ¼ãƒ‰ã‚’ä¸€ã¤ãšã¤é…ç½®ã•ã›ã‚‹å ´åˆï¼Œã“ã“ã§ã¯ã€ï¼‘å€‹ã€ã‚’è¨­å®šã™ã‚‹ï¼ ãƒãƒ«ãƒAZ ãƒ—ãƒ©ã‚¤ãƒãƒªãƒãƒ¼ãƒ‰ã¨ãƒªãƒ¼ãƒ‰ãƒ¬ãƒ—ãƒªã‚«ã‚’ç•°ãªã‚‹AZã«é…ç½®ã™ã‚‹ã‹ã©ã†ã‹ã‚’è¨­å®šã™ã‚‹ï¼åˆã‚ã›ã¦ï¼Œè‡ªå‹•ãƒ•ã‚§ãƒ¼ãƒ«ã‚ªãƒ¼ãƒãƒ¼ã‚’å®Ÿè¡Œã§ãã‚‹ã‚ˆã†ã«ãªã‚‹ï¼ ã‚µãƒ–ãƒãƒƒãƒˆã‚°ãƒ«ãƒ¼ãƒ— Redisã«ã‚¢ã‚¯ã‚»ã‚¹ã§ãã‚‹ã‚µãƒ–ãƒãƒƒãƒˆã‚’è¨­å®šã™ã‚‹ï¼ ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚°ãƒ«ãƒ¼ãƒ—ã‚’è¨­å®šã™ã‚‹ï¼ ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ã¸ã®ãƒ‡ãƒ¼ã‚¿ã®ã‚¤ãƒ³ãƒãƒ¼ãƒˆ ã‚ã‚‰ã‹ã˜ã‚ä½œæˆã—ã¦ãŠã„ãŸãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã‚’ã‚¤ãƒ³ãƒãƒ¼ãƒˆã—ï¼Œã“ã‚Œã‚’å…ƒã«Redisã‚’æ§‹ç¯‰ã™ã‚‹ï¼ ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãƒ‡ãƒ¼ã‚¿ã‚’å¼•ãç¶™ãã“ã¨ãŒã§ãã‚‹ï¼ãã®ãŸã‚ï¼Œæ–°ã—ã„Redisã¸ã®ã‚»ãƒƒã‚·ãƒ§ãƒ³ãƒ•ã‚¡ã‚¤ãƒ«ã®ç§»è¡Œã«å½¹ç«‹ã¤ï¼æ–°ã—ã„Redisã‚’æ§‹ç¯‰ã™ã‚‹ä¾‹ã¨ã—ã¦ã¯ï¼ŒRedisã®ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰æ™‚ã«ï¼Œã‚»ãƒƒã‚·ãƒ§ãƒ³IDã‚’å¼•ãç¶™ã„ã ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰å¾Œã®Redisã‚’åˆ¥é€”æ§‹ç¯‰ã—ï¼Œã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®å‘ãå…ˆã‚’å¤ã„Redisã‹ã‚‰æ–°ã—ã„Redisã«å¤‰ãˆã‚‹ï¼Œã¨ã„ã£ãŸçŠ¶æ³ãŒã‚ã‚‹ï¼ ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ— ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã®æœ‰åŠ¹åŒ–ï¼Œä¿æŒæœŸé–“ï¼Œæ™‚é–“ã‚’è¨­å®šã™ã‚‹ï¼ ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã‚’å–ã‚‹ã»ã©ã§ã‚‚ãªã„ãŸã‚ï¼Œç„¡åŠ¹åŒ–ã—ã¦ãŠã„ã¦å•é¡Œãªã„ï¼ ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ã®æ™‚é–“ã‚’è¨­å®šã™ã‚‹ï¼ ã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç†æ©Ÿèƒ½ ãƒ»ä»•çµ„ã¿ ã‚µãƒ¼ãƒå†…ã®ã‚»ãƒƒã‚·ãƒ§ãƒ³ãƒ•ã‚¡ã‚¤ãƒ«ã®ä»£ã‚ã‚Šã«ã‚»ãƒƒã‚·ãƒ§ãƒ³IDã‚’ç®¡ç†ã—ï¼Œå†—é•·åŒ–ã•ã‚ŒãŸã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³é–“ã§å…±é€šã®ã‚»ãƒƒã‚·ãƒ§ãƒ³IDã‚’ä½¿ç”¨ã§ãã‚‹ã‚ˆã†ã«ã™ã‚‹ï¼ã‚»ãƒƒã‚·ãƒ§ãƒ³IDã«ã¤ã„ã¦ã¯ï¼Œä»¥ä¸‹ã®ãƒªãƒ³ã‚¯ã‚’å‚è€ƒã«ã›ã‚ˆï¼ å‚è€ƒï¼šhttps://hiroki-it.github.io/tech-notebook-gitbook/public/software/software_application_collaboration_api_restful.html ã‚¯ã‚¨ãƒªCacheç®¡ç†æ©Ÿèƒ½ ãƒ»ä»•çµ„ã¿ RDSã«å¯¾ã™ã‚‹SQLã¨èª­ã¿å‡ºã•ã‚ŒãŸãƒ‡ãƒ¼ã‚¿ã‚’ï¼Œã‚­ãƒ£ãƒƒã‚·ãƒ¥ã¨ã—ã¦ç®¡ç†ã™ã‚‹ï¼ ï¼ˆï¼‘ï¼‰ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã¯ï¼ŒRDSã®å‰ã«ï¼ŒRedisã«å¯¾ã—ã¦SQLã‚’å®Ÿè¡Œã™ã‚‹ï¼ SELECT * FROM users; ï¼ˆï¼’ï¼‰å§‹ã‚ã¦å®Ÿè¡Œã•ã‚ŒãŸSQLã®å ´åˆï¼ŒRedisã¯SQLã‚’ã‚­ãƒ¼ã¨ã—ã¦ä¿å­˜ã—ï¼ŒCacheãŒç„¡ã„ã“ã¨ãŒã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã«è¿”å´ã™ã‚‹ï¼ ï¼ˆï¼“ï¼‰ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã¯RDSã«å¯¾ã—ã¦SQLã‚’å®Ÿè¡Œã™ã‚‹ï¼ ï¼ˆï¼”ï¼‰ãƒ‡ãƒ¼ã‚¿ãŒèª­ã¿å‡ºã•ã‚Œã‚‹ï¼ ï¼ˆï¼•ï¼‰ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã¯Redisã«ãƒ‡ãƒ¼ã‚¿ã‚’ç™»éŒ²ã™ã‚‹ï¼ # ElastiCacheã«ã¯ï¼ŒSQLã®å®Ÿè¡ŒçµæœãŒã¾ã ä¿å­˜ã•ã‚Œã¦ã„ãªã„ *** no cache *** {\"id\"=>\"1\", \"name\"=>\"alice\"} {\"id\"=>\"2\", \"name\"=>\"bob\"} {\"id\"=>\"3\", \"name\"=>\"charles\"} {\"id\"=>\"4\", \"name\"=>\"donny\"} {\"id\"=>\"5\", \"name\"=>\"elie\"} {\"id\"=>\"6\", \"name\"=>\"fabian\"} {\"id\"=>\"7\", \"name\"=>\"gabriel\"} {\"id\"=>\"8\", \"name\"=>\"harold\"} {\"id\"=>\"9\", \"name\"=>\"Ignatius\"} {\"id\"=>\"10\", \"name\"=>\"jonny\"} ï¼ˆï¼–ï¼‰æ¬¡å›ï¼Œã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã¯ï¼ŒRDSã®å‰ã«ï¼ŒRedisã«å¯¾ã—ã¦SQLã‚’å®Ÿè¡Œã™ã‚‹ï¼ SELECT * FROM users; ï¼ˆï¼—ï¼‰Redisã¯ï¼ŒSQLã‚’ã‚­ãƒ¼ã«ã—ã¦ãƒ‡ãƒ¼ã‚¿ã‚’ç‰¹å®šã—ï¼Œã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã«è¿”å´ã™ã‚‹ï¼ # ElastiCacheã«ã¯ï¼ŒSQLã®å®Ÿè¡ŒçµæœãŒæ—¢ã«ä¿å­˜ã•ã‚Œã¦ã„ã‚‹ *** cache hit *** {\"id\"=>\"1\", \"name\"=>\"alice\"} {\"id\"=>\"2\", \"name\"=>\"bob\"} {\"id\"=>\"3\", \"name\"=>\"charles\"} {\"id\"=>\"4\", \"name\"=>\"donny\"} {\"id\"=>\"5\", \"name\"=>\"elie\"} {\"id\"=>\"6\", \"name\"=>\"fabian\"} {\"id\"=>\"7\", \"name\"=>\"gabriel\"} {\"id\"=>\"8\", \"name\"=>\"harold\"} {\"id\"=>\"9\", \"name\"=>\"Ignatius\"} {\"id\"=>\"10\", \"name\"=>\"jonny\"} ãƒ»ã‚¯ã‚¨ãƒªCacheã®æ“ä½œ # Redisæ¥ç¶šã‚³ãƒãƒ³ãƒ‰ $ /usr/local/sbin/redis-stable/src/redis-cli \\ -c -h -p 6379 # Redisæ¥ç¶šä¸­ã®çŠ¶æ…‹ # å…¨ã¦ã®ã‚­ãƒ¼ã‚’è¡¨ç¤º redis xxxxx:6379> keys * # Redisæ¥ç¶šä¸­ã®çŠ¶æ…‹ # ã‚­ãƒ¼ã‚’æŒ‡å®šã—ã¦ï¼Œå¯¾å¿œã™ã‚‹å€¤ã‚’è¡¨ç¤º redis xxxxx:6379> type # Redisæ¥ç¶šä¸­ã®çŠ¶æ…‹ # RedisãŒå—ã‘å–ã£ãŸã‚³ãƒãƒ³ãƒ‰ã‚’ãƒ•ã‚©ã‚¢ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ã§è¡¨ç¤º redis xxxxx:6379> monitor Redisã®éšœå®³å¯¾ç­– ãƒ»ãƒ•ã‚§ã‚¤ãƒ«ã‚ªãƒ¼ãƒãƒ¼ ãƒãƒ¼ãƒ‰ã®éšœå®³ã‚’æ¤œçŸ¥ã—ï¼Œéšœå®³ãŒç™ºç”Ÿã—ãŸãƒãƒ¼ãƒ‰ã‚’æ–°ã—ã„ã‚‚ã®ã«ç½®ãæ›ãˆã‚‹ã“ã¨ãŒã§ãã‚‹ï¼ éšœå®³ã®ç™ºç”Ÿã—ãŸãƒãƒ¼ãƒ‰ æŒ™å‹• ãƒ—ãƒ©ã‚¤ãƒãƒªãƒãƒ¼ãƒ‰ ãƒªãƒ¼ãƒ‰ãƒ¬ãƒ—ãƒªã‚«ã®ä¸€ã¤ãŒãƒ—ãƒ©ã‚¤ãƒãƒªãƒãƒ¼ãƒ‰ã«æ˜‡æ ¼ã—ï¼Œéšœå®³ãŒèµ·ããŸãƒ—ãƒ©ã‚¤ãƒãƒªãƒãƒ¼ãƒ‰ã¨ç½®ãæ›ãˆã‚‰ã‚Œã‚‹ï¼ ãƒªãƒ¼ãƒ‰ãƒ¬ãƒ—ãƒªã‚«ãƒãƒ¼ãƒ‰ éšœå®³ãŒèµ·ããŸãƒªãƒ¼ãƒ‰ãƒ¬ãƒ—ãƒªã‚«ãƒãƒ¼ãƒ‰ãŒï¼Œåˆ¥ã®æ–°ã—ã„ã‚‚ã®ã«ç½®ãæ›ãˆã‚‰ã‚Œã‚‹ï¼ ãƒãƒ¼ãƒ‰ã®ãƒ€ã‚¦ãƒ³ã‚¿ã‚¤ãƒ  ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã¨ã‚¤ãƒ³ãƒãƒ¼ãƒˆæ©Ÿèƒ½ã‚’ä½¿ç”¨ã—ã¦ï¼Œã‚»ãƒƒã‚·ãƒ§ãƒ³IDã‚’å¼•ãç¶™ã„ã ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰å¾Œã®Redisã‚’åˆ¥é€”æ§‹ç¯‰ã™ã‚‹ï¼ãã®å¾Œï¼Œã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®å‘ãå…ˆã‚’å¤ã„Redisã‹ã‚‰æ–°ã—ã„Redisã«å¤‰ãˆã‚‹ã‚ˆã†ã«ã™ã‚‹ã¨ï¼Œãƒ€ã‚¦ãƒ³ã‚¿ã‚¤ãƒ ã‚’æœ€å°é™ã«ã—ã¦ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰ã§ãã‚‹ï¼ çŠ¶æ³ ãƒ€ã‚¦ãƒ³ã‚¿ã‚¤ãƒ  ã‚µãƒ¼ãƒ“ã‚¹ã®ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰ 1åˆ†30ç§’ã»ã©ã®ãƒ€ã‚¦ãƒ³ã‚¿ã‚¤ãƒ ãŒç™ºç”Ÿã™ã‚‹ï¼ 17. EventBridgeï¼ˆCloudWatchã‚¤ãƒ™ãƒ³ãƒˆï¼‰ EventBridgeï¼ˆCloudWatchã‚¤ãƒ™ãƒ³ãƒˆï¼‰ã¨ã¯ AWSãƒªã‚½ãƒ¼ã‚¹ã§èµ·ã“ã£ãŸã‚¤ãƒ™ãƒ³ãƒˆã‚’ï¼Œä»–ã®AWSãƒªã‚½ãƒ¼ã‚¹ã«è»¢é€ã™ã‚‹ï¼ã‚µãƒãƒ¼ãƒˆå¯¾è±¡ã®AWSãƒªã‚½ãƒ¼ã‚¹ã¯ä»¥ä¸‹ã®ãƒªãƒ³ã‚¯ã‚’å‚è€ƒã«ã›ã‚ˆï¼ å‚è€ƒï¼šhttps://docs.aws.amazon.com/eventbridge/latest/userguide/what-is-amazon-eventbridge.html ãƒ‘ã‚¿ãƒ¼ãƒ³ ãƒ»ã‚¤ãƒ™ãƒ³ãƒˆãƒ‘ã‚¿ãƒ¼ãƒ³ æŒ‡å®šã—ãŸAWSãƒªã‚½ãƒ¼ã‚¹ã§ã‚¤ãƒ™ãƒ³ãƒˆãŒèµ·ã“ã‚‹ã¨ï¼Œä»¥ä¸‹ã®ã‚ˆã†ãªJSONãŒé€ä¿¡ã•ã‚Œã‚‹ï¼ã‚¤ãƒ™ãƒ³ãƒˆãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’å®šç¾©ã—ï¼ŒJSONæ§‹é€ ãŒä¸€è‡´ã™ã‚‹ã‚¤ãƒ™ãƒ³ãƒˆã®ã¿ã‚’ã‚¿ãƒ¼ã‚²ãƒƒãƒˆã«è»¢é€ã™ã‚‹ï¼ã‚¤ãƒ™ãƒ³ãƒˆãƒ‘ã‚¿ãƒ¼ãƒ³ã«å®šç¾©ã—ãªã„ã‚­ãƒ¼ã¯ä»»æ„ã®ãƒ‡ãƒ¼ã‚¿ã¨è¦‹ãªã•ã‚Œã‚‹ï¼ å‚è€ƒï¼šhttps://docs.aws.amazon.com/ja_jp/AmazonCloudWatch/latest/events/CloudWatchEventsandEventPatterns.html { \"version\": \"0\", \"id\": \"*****\", \"detail-type\": \"\", \"source\": \"aws.\", \"account\": \"*****\", \"time\": \"2021-01-01T00:00:00Z\", \"region\": \"us-west-1\", \"resources\": [ \"\" ], \"detail\": { // ãã®æ™‚ã€…ã®ã‚¤ãƒ™ãƒ³ãƒˆã”ã¨ã«ç•°ãªã‚‹ãƒ‡ãƒ¼ã‚¿ } } ï¼Šå®Ÿè£…ä¾‹ï¼Š Amplifyã®æŒ‡å®šã—ãŸIDã®ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãŒï¼ŒAmplify Deployment Status Changeã®ã‚¤ãƒ™ãƒ³ãƒˆã‚’é€ä¿¡ã—ï¼Œã“ã‚Œã®jobStatusãŒSUCCEEDï¼FAILEDã ã£ãŸå ´åˆã«ï¼Œã“ã‚Œã‚’è»¢é€ã™ã‚‹ï¼ { \"detail\": { \"appId\": [ \"foo\", \"bar\" ], \"jobStatus\": [ \"SUCCEED\", \"FAILED\" ] }, \"detail-type\": [ \"Amplify Deployment Status Change\" ], \"source\": \"aws.amplify\" } ãƒ»ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ« cronå¼ã¾ãŸã¯rateå¼ã‚’ä½¿ç”¨ã—ï¼Œå®šæœŸã‚¸ãƒ§ãƒ–ã‚’å®šç¾©ã¥ã‘ã‚‹ï¼ã“ã‚Œã¨Lambdaã‚’çµ„ã¿åˆã‚ã›ã‚‹ã“ã¨ã«ã‚ˆã‚Šï¼Œãƒãƒƒãƒå‡¦ç†ã‚’æ§‹ç¯‰ã§ãã‚‹ï¼ å‚è€ƒï¼šhttps://docs.aws.amazon.com/ja_jp/AmazonCloudWatch/latest/events/ScheduledEvents.html ã‚¿ãƒ¼ã‚²ãƒƒãƒˆ ãƒ»ã‚¿ãƒ¼ã‚²ãƒƒãƒˆã®ä¸€è¦§ å‚è€ƒï¼šhttps://docs.aws.amazon.com/ja_jp/eventbridge/latest/userguide/eb-targets.html ãƒ»ãƒ‡ãƒãƒƒã‚° EventBridgeã§ã¯ï¼Œã©ã®ã‚ˆã†ãªJSONã®ã‚¤ãƒ™ãƒ³ãƒˆã‚’ã‚¿ãƒ¼ã‚²ãƒƒãƒˆã«è»¢é€ã—ãŸã‹ã‚’ç¢ºèªã§ããªã„ï¼ãã“ã§ï¼Œãƒ‡ãƒãƒƒã‚°æ™‚ã¯EventBridgeã®ã‚¿ãƒ¼ã‚²ãƒƒãƒˆã«Lambdaã‚’è¨­å®šã—ï¼Œã‚¤ãƒ™ãƒ³ãƒˆæ§‹é€ ã‚’ãƒ­ã‚°ã‹ã‚‰ç¢ºèªã™ã‚‹ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š ã‚ã‚‰ã‹ã˜ã‚ï¼Œã‚¤ãƒ™ãƒ³ãƒˆã®å†…å®¹ã‚’å‡ºåŠ›ã™ã‚‹é–¢æ•°ã‚’Lambdaã«ä½œæˆã—ã¦ãŠãï¼ // Lambdaã«ãƒ‡ãƒãƒƒã‚°ç”¨ã®é–¢æ•°ã‚’ç”¨æ„ã™ã‚‹ exports.handler = async (event) => { console.log(JSON.stringify({event}, null, 2)); }; å¯¾è±¡ã®AWSãƒªã‚½ãƒ¼ã‚¹ã§ä»»æ„ã®ã‚¤ãƒ™ãƒ³ãƒˆãŒèµ·ã“ã£ãŸæ™‚ã«ï¼ŒEventBridgeã‹ã‚‰Lambdaã«è»¢é€ã™ã‚‹ã‚ˆã†ã«è¨­å®šã™ã‚‹ï¼ { \"source\": \"aws.amplify\" } AWSãƒªã‚½ãƒ¼ã‚¹ã§æ„å›³çš„ã«ã‚¤ãƒ™ãƒ³ãƒˆã‚’èµ·ã“ã—ï¼ŒLambdaã®ãƒ­ã‚°ã‚°ãƒ«ãƒ¼ãƒ—ã‹ã‚‰å†…å®¹ã‚’ç¢ºèªã™ã‚‹ï¼detailã‚­ãƒ¼ã«ã‚¤ãƒ™ãƒ³ãƒˆãŒå‰²ã‚Šå½“ã¦ã‚‰ã‚Œã¦ã„ã‚‹ï¼ { \"event\": { \"version\": \"0\", \"id\": \"b4a07570-eda1-9fe1-da5e-b672a1705c39\", \"detail-type\": \"Amplify Deployment Status Change\", \"source\": \"aws.amplify\", \"account\": \"\", \"time\": \"\", \"region\": \"\", \"resources\": [ \"\" ], \"detail\": { \"appId\": \"\", \"branchName\": \"\", \"jobId\": \"\", \"jobStatus\": \"\" } } } å…¥åŠ› ãƒ»å…¥åŠ›ãƒˆãƒ©ãƒ³ã‚¹ãƒ•ã‚©ãƒ¼ãƒãƒ¼ å…¥åŠ›ãƒ‘ã‚¹ã§ä½¿ç”¨ã™ã‚‹å€¤ã‚’æŠ½å‡ºã—ï¼Œå…¥åŠ›ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã§è»¢é€ã™ã‚‹JSONã‚’å®šç¾©ã§ãã‚‹ï¼ã‚¤ãƒ™ãƒ³ãƒˆã®JSONã®å€¤ã‚’å¤‰æ•°ã¨ã—ã¦å‡ºåŠ›ã§ãã‚‹ï¼eventã‚­ãƒ¼ã‚’ãƒ‰ãƒ«ãƒãƒ¼ã‚¯ã¨ã—ã¦ï¼Œãƒ‰ãƒƒãƒˆã§ç¹‹ã„ã§ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š å…¥åŠ›ãƒ‘ã‚¹ã«ã¦ï¼Œä½¿ç”¨ã™ã‚‹å€¤ã‚’æŠ½å‡ºã™ã‚‹ï¼Amplifyã§èµ·ã“ã£ãŸã‚¤ãƒ™ãƒ³ãƒˆã®JSONã‚’å¤‰æ•°ã¨ã—ã¦å–ã‚Šå‡ºã™ï¼JSONã®ã‚­ãƒ¼åãŒå¤‰æ•°åã¨ã—ã¦æ©Ÿèƒ½ã™ã‚‹ï¼ { \"appId\": \"$.detail.appId\", \"branchName\": \"$.detail.branchName\", \"jobId\": \"$.detail.jobId\", \"jobStatus\": \"$.detail.jobStatus\", \"region\": \"$.region\" } å…¥åŠ›ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã«ã¦ï¼Œè»¢é€ã™ã‚‹JSONã‚’å®šç¾©ã™ã‚‹ï¼ä¾‹ãˆã°ã“ã“ã§ã¯ï¼ŒSlackã«é€ä¿¡ã™ã‚‹JSONã«å‡ºåŠ›ã™ã‚‹ï¼å‡ºåŠ›ã™ã‚‹ã¨ãã¯ï¼Œå…¥åŠ›ãƒ‘ã‚¹ã®å¤‰æ•°åã‚’ã€<>ã€ã§å›²ã†ï¼Slackã«é€ä¿¡ã™ã‚‹ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®ä½œæˆãƒ„ãƒ¼ãƒ«ã¯ï¼Œä»¥ä¸‹ã®ãƒªãƒ³ã‚¯ã‚’å‚è€ƒã«ã›ã‚ˆï¼ å‚è€ƒï¼šhttps://app.slack.com/block-kit-builder { \"channel\": \"XXXXXX\", \"text\": \"Amplifyãƒ‡ãƒ—ãƒ­ã‚¤å®Œäº†é€šçŸ¥\", \"blocks\": [ { \"type\": \"section\", \"text\": { \"type\": \"mrkdwn\", \"text\": \":github: ãƒ—ãƒ«ãƒªã‚¯æ¤œè¨¼ç”¨ç’°å¢ƒ\" } }, { \"type\": \"context\", \"elements\": [ { \"type\": \"mrkdwn\", \"text\": \"*çµæœ*: \" } ] }, { \"type\": \"context\", \"elements\": [ { \"type\": \"mrkdwn\", \"text\": \"*ãƒ–ãƒ©ãƒ³ãƒå*: \" } ] }, { \"type\": \"context\", \"elements\": [ { \"type\": \"mrkdwn\", \"text\": \"*æ¤œè¨¼URL*: https://..amplifyapp.com\" } ] }, { \"type\": \"context\", \"elements\": [ { \"type\": \"mrkdwn\", \"text\": \":amplify: .console.aws.amazon.com/amplify/home?region=#///|*Amplifyã‚³ãƒ³ã‚½ãƒ¼ãƒ«ç”»é¢ã¯ã“ã¡ã‚‰*>\" } ] }, { \"type\": \"divider\" } ] } 18. Global Accelerator è¨­å®šé …ç›® ãƒ»åŸºæœ¬çš„è¨­å®š è¨­å®šé …ç›® èª¬æ˜ è£œè¶³ Accelerator ã‚¿ã‚¤ãƒ— ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã‚°ãƒ«ãƒ¼ãƒ—ã¸ã®ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°æ™‚ã®ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã‚’è¨­å®šã™ã‚‹ï¼ Standardï¼šãƒ¦ãƒ¼ã‚¶ã«æœ€ã‚‚è¿‘ã„ãƒªãƒ¼ã‚¸ãƒ§ãƒ³ã«ã‚ã‚‹ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã‚°ãƒ«ãƒ¼ãƒ—ã«ï¼Œãƒªã‚¯ã‚¨ã‚¹ãƒˆãŒãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã•ã‚Œã‚‹ï¼ IPã‚¢ãƒ‰ãƒ¬ã‚¹ãƒ—ãƒ¼ãƒ« Global Acceleratorã«å‰²ã‚Šå½“ã¦ã‚‹é™çš„IPã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’è¨­å®šã™ã‚‹ï¼ ãƒ»ãƒªã‚¹ãƒŠãƒ¼ è¨­å®šé …ç›® èª¬æ˜ è£œè¶³ ãƒãƒ¼ãƒˆ ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°å…ˆã®ãƒãƒ¼ãƒˆç•ªå·ã‚’è¨­å®šã™ã‚‹ï¼ ãƒ—ãƒ­ãƒˆã‚³ãƒ« ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°å…ˆã®ãƒ—ãƒ­ãƒˆã‚³ãƒ«ã‚’è¨­å®šã™ã‚‹ï¼ Client affinity ãƒ¦ãƒ¼ã‚¶ã”ã¨ã«ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°å…ˆã‚’å›ºå®šã™ã‚‹ã‹ã‚’è¨­å®šã™ã‚‹ï¼ ãƒ»Noneï¼šè¤‡æ•°ã®ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°å…ˆãŒã‚ã£ãŸå ´åˆï¼Œå„ãƒ¦ãƒ¼ã‚¶ã®æ¯ãƒªã‚¯ã‚¨ã‚¹ãƒˆæ™‚ã®ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°å…ˆã¯å›ºå®šã•ã‚Œãªããªã‚‹ï¼ãƒ»Source IPï¼šè¤‡æ•°ã®ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°å…ˆãŒã‚ã£ãŸã¨ã—ã¦ã‚‚ï¼Œå„ãƒ¦ãƒ¼ã‚¶ã®æ¯ãƒªã‚¯ã‚¨ã‚¹ãƒˆæ™‚ã®ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°å…ˆã‚’å›ºå®šã§ãã‚‹ã‚ˆã†ã«ãªã‚‹ï¼ ãƒ»ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã‚°ãƒ«ãƒ¼ãƒ— è¨­å®šé …ç›® èª¬æ˜ è£œè¶³ ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã‚°ãƒ«ãƒ¼ãƒ— ç‰¹å®šã®ãƒªãƒ¼ã‚¸ãƒ§ãƒ³ã«ç´ä»˜ãã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã®ã‚°ãƒ«ãƒ¼ãƒ—ã‚’è¨­å®šã™ã‚‹ï¼ ãƒˆãƒ©ãƒ•ã‚£ãƒƒã‚¯ãƒ€ã‚¤ãƒ¤ãƒ«ã«ã¦ï¼Œå„ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã‚°ãƒ«ãƒ¼ãƒ—ã®é‡ã¿ã‚’è¨­å®šã§ãã‚‹ï¼ ãƒˆãƒ©ãƒ•ã‚£ãƒƒã‚¯ãƒ€ã‚¤ãƒ¤ãƒ« è¤‡æ•°ã®ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã‚°ãƒ«ãƒ¼ãƒ—ãŒã‚ã‚‹å ´åˆï¼Œãã‚Œãã‚Œã®é‡ã¿ï¼ˆ%ï¼‰ã‚’è¨­å®šã™ã‚‹ï¼ ãƒ»ä¾‹ãˆã°ï¼Œã‚«ãƒŠãƒªã‚¢ãƒªãƒªãƒ¼ã‚¹ã®ãŸã‚ã«ï¼Œæ–°ã‚¢ãƒ—ãƒªã¨æ—§ã‚¢ãƒ—ãƒªã¸ã®ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã«é‡ã¿ã‚’ä»˜ã‘ã‚‹å ´åˆã«å½¹ç«‹ã¤ï¼ ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯ ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°å…ˆã«å¯¾ã™ã‚‹ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯ã‚’è¨­å®šã™ã‚‹ï¼ ãƒ»ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ è¨­å®šé …ç›® èª¬æ˜ è£œè¶³ ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã‚¿ã‚¤ãƒ— ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°å…ˆã®AWSãƒªã‚½ãƒ¼ã‚¹ã‚’è¨­å®šã™ã‚‹ï¼ ALBï¼ŒNLBï¼ŒEC2ï¼ŒElastic IPã‚’é¸æŠã§ãã‚‹ï¼ é‡ã¿ è¤‡æ•°ã®ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆãŒã‚ã‚‹å ´åˆï¼Œãã‚Œãã‚Œã®é‡ã¿ã‚’è¨­å®šã™ã‚‹ï¼ å„ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã®é‡ã¿ã®åˆè¨ˆå€¤ã‚’256ã¨ã—ï¼Œ1ï½255ã§ç›¸å¯¾å€¤ã‚’è¨­å®šã™ã‚‹ï¼ ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆIPã‚¢ãƒ‰ãƒ¬ã‚¹ã®ä¿æŒ X-Forwarded-Forãƒ˜ãƒƒãƒ€ãƒ¼ã«ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆIPã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’å«ã‚ã¦è»¢é€ã™ã‚‹ã‹ã©ã†ã‹ã‚’è¨­å®šã™ã‚‹ï¼ ç´ æ—©ã„ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã®ç†ç”± æœ€åˆï¼Œã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆPCã‹ã‚‰ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆã¯ã‚¨ãƒƒã‚¸ãƒ­ã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã§å—ä¿¡ã•ã‚Œã‚‹ï¼ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯å†…ã®ã‚¨ãƒƒã‚¸ãƒ­ã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’çµŒç”±ã—ã¦ï¼Œãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°å…ˆã®ãƒªãƒ¼ã‚¸ãƒ§ãƒ³ã¾ã§å±Šãï¼ãƒ‘ãƒ–ãƒªãƒƒã‚¯ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚’ä½¿ç”¨ã—ãªã„ãŸã‚ï¼Œå°ã•ãªãƒ¬ã‚¤ãƒ†ã‚·ãƒ¼ã§ãƒˆãƒ©ãƒ•ã‚£ãƒƒã‚¯ã‚’ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã§ãã‚‹ï¼ Global Acceleratorã‚’ä½¿ç”¨ã—ãªã„å ´åˆï¼Œã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆPCã®ãƒªãƒ¼ã‚¸ãƒ§ãƒ³ã‹ã‚‰æŒ‡å®šã—ãŸãƒªãƒ¼ã‚¸ãƒ§ãƒ³ã«è‡³ã‚‹ã¾ã§ï¼Œã„ãã¤ã‚‚ãƒ‘ãƒ–ãƒªãƒƒã‚¯ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚’çµŒç”±ã™ã‚‹å¿…è¦ãŒã‚ã‚Šï¼Œæ™‚é–“ãŒã‹ã‹ã£ã¦ã—ã¾ã†ï¼ ä»¥ä¸‹ã®ã‚µã‚¤ãƒˆã§ï¼ŒGlobal Acceleratorã‚’ä½¿ç”¨ã—ãŸå ´åˆã¨ã—ãªã‹ã£ãŸå ´åˆã®ãƒ¬ã‚¹ãƒãƒ³ã‚¹é€Ÿåº¦ã‚’æ¯”è¼ƒã§ãã‚‹ï¼ å‚è€ƒï¼šhttps://speedtest.globalaccelerator.aws/#/ 19. IAMï¼šIdentify and Access Management IAM ãƒ»IAMã¨ã¯ AWSãƒªã‚½ãƒ¼ã‚¹ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹ã«é–¢ã™ã‚‹èªè¨¼ã¨èªå¯ã‚’åˆ¶å¾¡ã™ã‚‹ï¼èªè¨¼ã¯ã‚¢ã‚¯ã‚»ã‚¹ã‚­ãƒ¼ã¨ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆã‚¢ã‚¯ã‚»ã‚¹ã‚­ãƒ¼ã«ã‚ˆã£ã¦ï¼Œã¾ãŸèªå¯ã¯IAMãƒ­ãƒ¼ãƒ«ï¼IAMãƒãƒªã‚·ãƒ¼ï¼IAMã‚¹ãƒ†ãƒ¼ãƒˆãƒ¡ãƒ³ãƒˆã«ã‚ˆã£ã¦åˆ¶å¾¡ã•ã‚Œã‚‹ï¼ ãƒ»IAMãƒ­ãƒ¼ãƒ«ã¨ã¯ IAMãƒãƒªã‚·ãƒ¼ã®ã‚»ãƒƒãƒˆã‚’å®šç¾©ã™ã‚‹ï¼ ãƒ»IAMãƒãƒªã‚·ãƒ¼ã¨ã¯ IAMã‚¹ãƒ†ãƒ¼ãƒˆãƒ¡ãƒ³ãƒˆã®ã‚»ãƒƒãƒˆã‚’å®šç¾©ã™ã‚‹ï¼ IAMãƒãƒªã‚·ãƒ¼ã®ç¨®é¡ èª¬æ˜ ã‚¢ã‚¤ãƒ‡ãƒ³ãƒ†ã‚£ãƒ†ã‚£ãƒ™ãƒ¼ã‚¹ã®ãƒãƒªã‚·ãƒ¼ IAMãƒ¦ãƒ¼ã‚¶ï¼ŒIAMã‚°ãƒ«ãƒ¼ãƒ—ï¼ŒIAMãƒ­ãƒ¼ãƒ«ï¼Œã«ã‚¢ã‚¿ãƒƒãƒã™ã‚‹ãŸã‚ã®ãƒãƒªã‚·ãƒ¼ã®ã“ã¨ï¼ ãƒªã‚½ãƒ¼ã‚¹ãƒ™ãƒ¼ã‚¹ã®ã‚¤ãƒ³ãƒ©ã‚¤ãƒ³ãƒãƒªã‚·ãƒ¼ å˜ä¸€ã®AWSãƒªã‚½ãƒ¼ã‚¹ã«ã‚¤ãƒ³ãƒãƒªã‚·ãƒ¼ã®ã“ã¨ï¼ ã‚¢ã‚¯ã‚»ã‚¹ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ãƒãƒªã‚·ãƒ¼ jsonå½¢å¼ã§å®šç¾©ã™ã‚‹å¿…è¦ãŒç„¡ã„ãƒãƒªã‚·ãƒ¼ã®ã“ã¨ï¼ ï¼Šä¾‹ï¼Š ä»¥ä¸‹ã«ï¼ŒEC2ã®èª­ã¿å‡ºã—ã®ã¿æ¨©é™ï¼ˆAmazonEC2ReadOnlyAccessï¼‰ã‚’ã‚¢ã‚¿ãƒƒãƒã§ãã‚‹ãƒãƒªã‚·ãƒ¼ã‚’ç¤ºã™ï¼ã“ã®IAMãƒãƒªã‚·ãƒ¼ã«ã¯ï¼Œä»–ã®AWSãƒªã‚½ãƒ¼ã‚¹ã«å¯¾ã™ã‚‹æ¨©é™ã‚‚å«ã¾ã‚Œã¦ã„ã‚‹ï¼ { \"Version\": \"2012-10-17\", \"Statement\": [ { \"Effect\": \"Allow\", \"Action\": \"ec2:Describe*\", \"Resource\": \"*\" }, { \"Effect\": \"Allow\", \"Action\": \"elasticloadbalancing:Describe*\", \"Resource\": \"*\" }, { \"Effect\": \"Allow\", \"Action\": [ \"cloudwatch:ListMetrics\", \"cloudwatch:GetMetricStatistics\", \"cloudwatch:Describe*\" ], \"Resource\": \"*\" }, { \"Effect\": \"Allow\", \"Action\": \"autoscaling:Describe*\", \"Resource\": \"*\" } ] } ãƒ»IAMã‚¹ãƒ†ãƒ¼ãƒˆãƒ¡ãƒ³ãƒˆã¨ã¯ AWSãƒªã‚½ãƒ¼ã‚¹ã«é–¢ã™ã‚‹èªå¯ã®ã‚¹ã‚³ãƒ¼ãƒ—ã‚’å®šç¾©ã™ã‚‹ï¼å„ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã«ã¤ã„ã¦ã¯ä»¥ä¸‹ã®ãƒªãƒ³ã‚¯ã‚’å‚è€ƒã«ã›ã‚ˆï¼ AWSãƒªã‚½ãƒ¼ã‚¹ã®ç¨®é¡ ãƒªãƒ³ã‚¯ CloudWatchãƒ­ã‚° https://docs.aws.amazon.com/ja_jp/AmazonCloudWatch/latest/logs/permissions-reference-cwl.html ï¼Šä¾‹ï¼Š ä»¥ä¸‹ã®ã‚¤ãƒ³ãƒ©ã‚¤ãƒ³ãƒãƒªã‚·ãƒ¼ãŒã‚¢ã‚¿ãƒƒãƒã•ã‚ŒãŸãƒ­ãƒ¼ãƒ«ã‚’æŒã¤AWSãƒªã‚½ãƒ¼ã‚¹ã¯ï¼Œä»»æ„ã®SSMãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’å–å¾—ã§ãã‚‹ã‚ˆã†ã«ãªã‚‹ï¼ { \"Version\": \"2012-10-17\", \"Statement\": [ { \"Effect\": \"Allow\", \"Action\": [ \"ssm:GetParameters\" ], \"Resource\": \"*\" } ] } Statementã®é …ç›® èª¬æ˜ Sid ä»»æ„ã®ä¸€æ„ãªæ–‡å­—åˆ—ã‚’è¨­å®šã™ã‚‹ï¼ç©ºæ–‡å­—ã§ã‚‚ã‚ˆã„ï¼ Effect è¨±å¯ï¼æ‹’å¦ã‚’è¨­å®šã™ã‚‹ï¼ Action ãƒªã‚½ãƒ¼ã‚¹ã«å¯¾ã—ã¦å®Ÿè¡Œã§ãã‚‹ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚’è¨­å®šã™ã‚‹ï¼ Resource ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã®å®Ÿè¡Œå¯¾è±¡ã«é¸ã¹ã‚‹ãƒªã‚½ãƒ¼ã‚¹ã‚’è¨­å®šã™ã‚‹ï¼ ä»¥ä¸‹ã«ä¸»è¦ãªã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚’ç¤ºã™ï¼ ã‚¢ã‚¯ã‚·ãƒ§ãƒ³å èª¬æ˜ Create ãƒªã‚½ãƒ¼ã‚¹ã‚’æ§‹ç¯‰ã™ã‚‹ï¼ Describe ãƒªã‚½ãƒ¼ã‚¹ã‚’è¡¨ç¤ºã™ã‚‹ï¼ Delete ãƒªã‚½ãƒ¼ã‚¹ã‚’å‰Šé™¤ã™ã‚‹ï¼ Get ãƒªã‚½ãƒ¼ã‚¹ã‚’å–å¾—ã™ã‚‹ï¼ Put ãƒªã‚½ãƒ¼ã‚¹ã‚’ä¸Šæ›¸ãã™ã‚‹ï¼ ãƒ»ARNã¨ã¯ï¼šAmazon Resource Namespace AWSãƒªã‚½ãƒ¼ã‚¹ã®è­˜åˆ¥å­ã®ã“ã¨ï¼ å‚è€ƒï¼šhttps://docs.aws.amazon.com/ja_jp/general/latest/gr/aws-arns-and-namespaces.html { \"Version\": \"2012-10-17\", \"Statement\": [ { \"Resource\": \"arn:::::\" } ] } IAMãƒ­ãƒ¼ãƒ« ãƒ»ã‚µãƒ¼ãƒ“ã‚¹ãƒªãƒ³ã‚¯ãƒ­ãƒ¼ãƒ« AWSãƒªã‚½ãƒ¼ã‚¹ã‚’æ§‹ç¯‰ã—ãŸæ™‚ã«è‡ªå‹•çš„ã«ä½œæˆã•ã‚Œã‚‹ãƒ­ãƒ¼ãƒ«ï¼ä»–ã«ã¯ã‚¢ã‚¿ãƒƒãƒã§ããªã„å°‚ç”¨ã®ãƒãƒªã‚·ãƒ¼ãŒã‚¢ã‚¿ãƒƒãƒã•ã‚Œã¦ã„ã‚‹ï¼ã€AWSServiceRoleFor*****ã€ã¨ã„ã†åå‰ã§è‡ªå‹•çš„ã«æ§‹ç¯‰ã•ã‚Œã‚‹ï¼ç‰¹ã«è¨­å®šã›ãšã¨ã‚‚ï¼Œè‡ªå‹•çš„ã«ãƒªã‚½ãƒ¼ã‚¹ã«ã‚¢ã‚¿ãƒƒãƒã•ã‚Œã‚‹ï¼é–¢é€£ã™ã‚‹ãƒªã‚½ãƒ¼ã‚¹ã‚’å‰Šé™¤ã™ã‚‹ã¾ã§ï¼Œãƒ­ãƒ¼ãƒ«è‡ªä½“ã§ããªã„ï¼ã‚µãƒ¼ãƒ“ã‚¹ãƒªãƒ³ã‚¯ãƒ­ãƒ¼ãƒ«ã®ä¸€è¦§ã«ã¤ã„ã¦ã¯ï¼Œä»¥ä¸‹ã®ãƒªãƒ³ã‚¯ã‚’å‚è€ƒã«ã›ã‚ˆï¼ å‚è€ƒï¼šhttps://docs.aws.amazon.com/IAM/latest/UserGuide/reference_aws-services-that-work-with-iam.html ãƒ»ã‚¯ãƒ­ã‚¹ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã®ã‚¢ã‚¯ã‚»ã‚¹ãƒ­ãƒ¼ãƒ« ãƒ»ãƒ—ãƒ­ãƒã‚¤ãƒ€ã®ã‚¢ã‚¯ã‚»ã‚¹ãƒ­ãƒ¼ãƒ« ã‚¢ã‚¤ãƒ‡ãƒ³ãƒ†ã‚£ãƒ†ã‚£ãƒ™ãƒ¼ã‚¹ã®ãƒãƒªã‚·ãƒ¼ ãƒ»ã‚¢ã‚¤ãƒ‡ãƒ³ãƒ†ã‚£ãƒ†ã‚£ãƒ™ãƒ¼ã‚¹ã®ãƒãƒªã‚·ãƒ¼ã¨ã¯ IAMãƒ¦ãƒ¼ã‚¶ï¼ŒIAMã‚°ãƒ«ãƒ¼ãƒ—ï¼ŒIAMãƒ­ãƒ¼ãƒ«ï¼Œã«ã‚¢ã‚¿ãƒƒãƒã™ã‚‹ãŸã‚ã®ãƒãƒªã‚·ãƒ¼ã®ã“ã¨ï¼ ãƒ»AWSç®¡ç†ãƒãƒªã‚·ãƒ¼ AWSãŒæä¾›ã—ã¦ã„ã‚‹ãƒãƒªã‚·ãƒ¼ã®ã“ã¨ï¼ã‚¢ã‚¿ãƒƒãƒå¼ã®ãƒãƒªã‚·ãƒ¼ã®ãŸã‚ï¼Œã™ã§ã«ã‚¢ã‚¿ãƒƒãƒã•ã‚Œã¦ã„ã¦ã‚‚ï¼Œä»–ã®ã‚‚ã®ã«ã‚‚ã‚¢ã‚¿ãƒƒãƒã§ãã‚‹ï¼ ãƒ»ã‚«ã‚¹ã‚¿ãƒãƒ¼ç®¡ç†ãƒãƒªã‚·ãƒ¼ ãƒ¦ãƒ¼ã‚¶ãŒç‹¬è‡ªã«æ§‹ç¯‰ã—ãŸãƒãƒªã‚·ãƒ¼ã®ã“ã¨ï¼ã™ã§ã«ã‚¢ã‚¿ãƒƒãƒã•ã‚Œã¦ã„ã¦ã‚‚ï¼Œä»–ã®ã‚‚ã®ã«ã‚‚ã‚¢ã‚¿ãƒƒãƒã§ãã‚‹ï¼ ãƒ»ã‚¤ãƒ³ãƒ©ã‚¤ãƒ³ãƒãƒªã‚·ãƒ¼ å˜ä¸€ã®ã‚¢ã‚¤ãƒ‡ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã«ã‚¢ã‚¿ãƒƒãƒã™ã‚‹ãŸã‚ã®ãƒãƒªã‚·ãƒ¼ã®ã“ã¨ï¼çµ„ã¿è¾¼ã¿å¼ã®ãƒãƒªã‚·ãƒ¼ã®ãŸã‚ï¼Œã‚¢ã‚¤ãƒ‡ãƒ³ãƒ†ã‚£ãƒ†ã‚£é–“ã§å…±æœ‰ã—ã¦ã‚¢ã‚¿ãƒƒãƒã™ã‚‹ã“ã¨ã¯ã§ããªã„ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š IAMãƒ­ãƒ¼ãƒ«ã«ã‚¤ãƒ³ãƒ©ã‚¤ãƒ³ãƒãƒªã‚·ãƒ¼ã‚’ã‚¢ã‚¿ãƒƒãƒã™ã‚‹ï¼ã“ã®ãƒ­ãƒ¼ãƒ«ã‚’æŒã¤ãƒ¦ãƒ¼ã‚¶ã¯ï¼Œãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã®ã™ã¹ã¦ã® ACM è¨¼æ˜æ›¸ã‚’ä¸€è¦§è¡¨ç¤ºã§ãã‚‹ã‚ˆã†ã«ãªã‚‹ï¼ { \"Version\":\"2012-10-17\", \"Statement\":[ { \"Effect\":\"Allow\", \"Action\":\"acm:ListCertificates\", \"Resource\":\"*\" } ] } ï¼Šå®Ÿè£…ä¾‹ï¼Š IAMãƒ­ãƒ¼ãƒ«ã«ã‚¤ãƒ³ãƒ©ã‚¤ãƒ³ãƒãƒªã‚·ãƒ¼ã‚’ã‚¢ã‚¿ãƒƒãƒã™ã‚‹ï¼ã“ã®ãƒ­ãƒ¼ãƒ«ã‚’æŒã¤ãƒ¦ãƒ¼ã‚¶ã¯ï¼Œå…¨ã¦ã®AWSãƒªã‚½ãƒ¼ã‚¹ã«ï¼Œä»»æ„ã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚’å®Ÿè¡Œã§ãã‚‹ï¼ { \"Version\":\"2012-10-17\", \"Statement\":[ { \"Effect\":\"Allow\", \"Action\":\"*\", \"Resource\":\"*\" } ] } ãƒªã‚½ãƒ¼ã‚¹ãƒ™ãƒ¼ã‚¹ã®ã‚¤ãƒ³ãƒ©ã‚¤ãƒ³ãƒãƒªã‚·ãƒ¼ ãƒ»ãƒªã‚½ãƒ¼ã‚¹ãƒ™ãƒ¼ã‚¹ã®ã‚¤ãƒ³ãƒ©ã‚¤ãƒ³ãƒãƒªã‚·ãƒ¼ã¨ã¯ å˜ä¸€ã®AWSãƒªã‚½ãƒ¼ã‚¹ã«ã‚¤ãƒ³ãƒãƒªã‚·ãƒ¼ã®ã“ã¨ï¼ã™ã§ã«ã‚¢ã‚¿ãƒƒãƒã•ã‚Œã¦ã„ã‚‹ã¨ï¼Œä»–ã®ã‚‚ã®ã«ã¯ã‚¢ã‚¿ãƒƒãƒã§ããªã„ï¼ ãƒ»ãƒã‚±ãƒƒãƒˆãƒãƒªã‚·ãƒ¼ S3ã«ã‚¢ã‚¿ãƒƒãƒã•ã‚Œã‚‹ï¼Œè‡ªèº«ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹ã‚’åˆ¶å¾¡ã™ã‚‹ãŸã‚ã®ã‚¤ãƒ³ãƒ©ã‚¤ãƒ³ãƒãƒªã‚·ãƒ¼ã®ã“ã¨ï¼ ãƒ»ãƒ©ã‚¤ãƒ•ã‚µã‚¤ã‚¯ãƒ«ãƒãƒªã‚·ãƒ¼ ECRã«ã‚¢ã‚¿ãƒƒãƒã•ã‚Œã‚‹ï¼Œã‚¤ãƒ¡ãƒ¼ã‚¸ã®æœ‰åŠ¹æœŸé–“ã‚’å®šç¾©ã™ã‚‹ãƒãƒªã‚·ãƒ¼ï¼ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ç”»é¢ã‹ã‚‰å…¥åŠ›ã§ãã‚‹ãŸã‚ï¼ŒåŸºæœ¬çš„ã«ãƒãƒªã‚·ãƒ¼ã®å®Ÿè£…ã¯ä¸è¦ã§ã‚ã‚‹ãŒï¼ŒTerraformãªã©ã®IaCãƒ„ãƒ¼ãƒ«ã§ã¯å¿…è¦ã«ãªã‚‹ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š { \"rules\": [ { \"rulePriority\": 1, \"description\": \"Keep last 10 images untagged\", \"selection\": { \"tagStatus\": \"untagged\", \"countType\": \"imageCountMoreThan\", \"countNumber\": 10 }, \"action\": { \"type\": \"expire\" } }, { \"rulePriority\": 2, \"description\": \"Keep last 10 images any\", \"selection\": { \"tagStatus\": \"any\", \"countType\": \"imageCountMoreThan\", \"countNumber\": 10 }, \"action\": { \"type\": \"expire\" } } ] } ãƒ»ä¿¡é ¼ãƒãƒªã‚·ãƒ¼ ãƒ­ãƒ¼ãƒ«ã«ã‚¢ã‚¿ãƒƒãƒã•ã‚Œã‚‹ï¼ŒAssume Roleã‚’è¡Œã†ãŸã‚ã®ã‚¤ãƒ³ãƒ©ã‚¤ãƒ³ãƒãƒªã‚·ãƒ¼ã®ã“ã¨ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š ä¾‹ãˆã°ï¼Œä»¥ä¸‹ã®ä¿¡é ¼ãƒãƒªã‚·ãƒ¼ã‚’ä»»æ„ã®ãƒ­ãƒ¼ãƒ«ã«ã‚¢ã‚¿ãƒƒãƒã—ãŸã¨ã™ã‚‹ï¼ãã®å ´åˆï¼ŒPrincipalã®ecs-tasksãŒä¿¡é ¼ã•ã‚ŒãŸã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã¨è¦‹ãªã•ã‚Œï¼Œãƒ­ãƒ¼ãƒ«ã‚’ã‚¢ã‚¿ãƒƒãƒã§ãã‚‹ã‚ˆã†ã«ãªã‚‹ï¼ { \"Version\": \"2012-10-17\", \"Statement\": [ { \"Effect\": \"Allow\", \"Principal\": { \"Service\": \"ecs-tasks.amazonaws.com\" }, \"Action\": \"sts:AssumeRole\" } ] } ä¿¡é ¼ãƒãƒªã‚·ãƒ¼ã§ã¯ï¼ŒIAMãƒ¦ãƒ¼ã‚¶ã‚’ä¿¡é ¼ã•ã‚ŒãŸã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã¨ã—ã¦è¨­å®šã™ã‚‹ã“ã¨ã‚‚ã§ãã‚‹ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š ä¾‹ãˆã°ï¼Œä»¥ä¸‹ã®ä¿¡é ¼ãƒãƒªã‚·ãƒ¼ã‚’ä»»æ„ã®ãƒ­ãƒ¼ãƒ«ã«ã‚¢ã‚¿ãƒƒãƒã—ãŸã¨ã™ã‚‹ï¼ãã®å ´åˆï¼ŒPrincipalã®IAMãƒ¦ãƒ¼ã‚¶ãŒä¿¡é ¼ã•ã‚ŒãŸã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã¨è¦‹ãªã•ã‚Œï¼Œãƒ­ãƒ¼ãƒ«ã‚’ã‚¢ã‚¿ãƒƒãƒã§ãã‚‹ã‚ˆã†ã«ãªã‚‹ï¼ { \"Version\": \"2012-10-17\", \"Statement\": [ { \"Effect\": \"Allow\", \"Principal\": { \"AWS\": \"arn:aws:iam:::user/\" }, \"Action\": \"sts:AssumeRole\", \"Condition\": { \"StringEquals\": { \"sts:ExternalId\": \"\" } } } ] } IAMãƒãƒªã‚·ãƒ¼ã‚’ã‚¢ã‚¿ãƒƒãƒã§ãã‚‹å¯¾è±¡ ãƒ»IAMãƒ¦ãƒ¼ã‚¶ã«å¯¾ã™ã‚‹ã‚¢ã‚¿ãƒƒãƒ ãƒ»IAMã‚°ãƒ«ãƒ¼ãƒ—ã«å¯¾ã™ã‚‹ã‚¢ã‚¿ãƒƒãƒ ãƒ»IAMãƒ­ãƒ¼ãƒ«ã«å¯¾ã™ã‚‹ã‚¢ã‚¿ãƒƒãƒ ãƒ«ãƒ¼ãƒˆãƒ¦ãƒ¼ã‚¶ï¼ŒIAMãƒ¦ãƒ¼ã‚¶ ãƒ»ãƒ«ãƒ¼ãƒˆãƒ¦ãƒ¼ã‚¶ã¨ã¯ å…¨ã¦ã®æ¨©é™ã‚’ã‚‚ã£ãŸã‚¢ã‚«ã‚¦ãƒ³ãƒˆã®ã“ã¨ï¼ ãƒ»IAMãƒ¦ãƒ¼ã‚¶ã¨ã¯ ç‰¹å®šã®æ¨©é™ã‚’ã‚‚ã£ãŸã‚¢ã‚«ã‚¦ãƒ³ãƒˆã®ã“ã¨ï¼ ãƒ»credentialsãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½¿ç”¨ã—ãŸCLI AWS CLIã§ã‚¯ãƒ©ã‚¦ãƒ‰ã‚¤ãƒ³ãƒ•ãƒ©ã‚’æ“ä½œã™ã‚‹ãŸã‚ã«ã¯ï¼Œcredentialsãƒ•ã‚¡ã‚¤ãƒ«ã«å®šç¾©ã•ã‚ŒãŸã‚¯ãƒ¬ãƒ‡ãƒ³ã‚·ãƒ£ãƒ«æƒ…å ±ãŒå¿…è¦ã§ã‚ã‚‹ï¼ã€aws_regionã€ã§ã¯ãªãã€aws_default_regionã€ã§ã‚ã‚‹ã“ã¨ã«æ³¨æ„ã™ã‚‹ï¼ $ aws configure set aws_access_key_id \"\" $ aws configure set aws_secret_access_key \"\" $ aws configure set aws_default_region \"ãƒªãƒ¼ã‚¸ãƒ§ãƒ³>\" # Linuxï¼ŒUnixã®å ´åˆï¼š$HOME/.aws/ # Windowsã®å ´åˆï¼š%USERPROFILE%\\.aws\\ [default] aws_access_key_id= aws_secret_access_key= [user1] aws_access_key_id= aws_secret_access_key= ãƒ»ç’°å¢ƒå¤‰æ•°ã‚’ä½¿ç”¨ã—ãŸCLI AWS CLIã§ã‚¯ãƒ©ã‚¦ãƒ‰ã‚¤ãƒ³ãƒ•ãƒ©ã‚’æ“ä½œã™ã‚‹ãŸã‚ã«ã¯ï¼Œç’°å¢ƒå¤‰æ•°ã§å®šç¾©ã•ã‚ŒãŸã‚¯ãƒ¬ãƒ‡ãƒ³ã‚·ãƒ£ãƒ«æƒ…å ±ãŒå¿…è¦ã§ã‚ã‚‹ï¼ã€AWS_REGIONã€ã§ã¯ãªãã€AWS_DEFAULT_REGIONã€ã§ã‚ã‚‹ã“ã¨ã«æ³¨æ„ã™ã‚‹ï¼ $ export AWS_ACCESS_KEY_ID= $ export AWS_SECRET_ACCESS_KEY= $ export AWS_DEFAULT_REGION= IAMã‚°ãƒ«ãƒ¼ãƒ— ãƒ»IAMã‚°ãƒ«ãƒ¼ãƒ—ã¨ã¯ IAMãƒ¦ãƒ¼ã‚¶ã‚’ã‚°ãƒ«ãƒ¼ãƒ—åŒ–ã—ãŸã‚‚ã®ï¼IAMã‚°ãƒ«ãƒ¼ãƒ—ã”ã¨ã«IAMãƒ­ãƒ¼ãƒ«ã‚’ã‚¢ã‚¿ãƒƒãƒã™ã‚Œã°ï¼ŒIAMãƒ¦ãƒ¼ã‚¶ã®IAMãƒ­ãƒ¼ãƒ«ã‚’ç®¡ç†ã—ã‚„ã™ããªã‚‹ï¼ ãƒ»IAMã‚°ãƒ«ãƒ¼ãƒ—ã¸ã®IAMãƒ­ãƒ¼ãƒ«ã®ç´ä»˜ã‘ IAMã‚°ãƒ«ãƒ¼ãƒ—ã«å¯¾ã—ã¦ï¼ŒIAMãƒ­ãƒ¼ãƒ«ã‚’ç´ä»˜ã‘ã‚‹ï¼ãã®IAMã‚°ãƒ«ãƒ¼ãƒ—ã«å¯¾ã—ã¦ï¼ŒIAMãƒ­ãƒ¼ãƒ«ã‚’ã‚¢ã‚¿ãƒƒãƒã—ãŸã„IAMãƒ¦ãƒ¼ã‚¶ã‚’è¿½åŠ ã—ã¦ã„ãï¼ ãƒ»ã‚°ãƒ«ãƒ¼ãƒ—ä¸€è¦§ ç¨®é¡ èª¬æ˜ è£œè¶³ Administrator å…¨ã¦ã®æ“ä½œã«æ¨©é™ãŒã‚ã‚‹ï¼ PowerUserAccess IAMä»¥å¤–ã®æ“ä½œæ¨©é™ãŒã‚ã‚‹ï¼ ViewOnlyAccess é–²è¦§ã®ã¿ã®æ“ä½œæ¨©é™ãŒã‚ã‚‹ï¼ CLI ãƒ»CLIã®ç¤¾å†…ã‚¢ã‚¯ã‚»ã‚¹åˆ¶é™ ç‰¹å®šã®é€ä¿¡å…ƒIPã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’åˆ¶é™ã™ã‚‹ãƒãƒªã‚·ãƒ¼ã‚’IAMãƒ¦ãƒ¼ã‚¶ã«ã‚¢ã‚¿ãƒƒãƒã™ã‚‹ã“ã¨ã§ï¼Œãã®IAMãƒ¦ãƒ¼ã‚¶ãŒAWS CLIã®å®Ÿè¡Œã™ã‚‹æ™‚ã«ï¼Œç¤¾å¤–ã‹ã‚‰å®Ÿè¡Œã§ããªã„ã‚ˆã†ã«åˆ¶é™ã‚’ã‹ã‘ã‚‰ã‚Œã‚‹ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š { \"Version\": \"2012-10-17\", \"Statement\": { \"Effect\": \"Deny\", \"Action\": \"*\", \"Resource\": \"*\", \"Condition\": { \"NotIpAddress\": { \"aws:SourceIp\": [ \"nn.nnn.nnn.nnn/32\" ] } } } } ãƒãƒªã‚·ãƒ¼ã®Denyã‚¹ãƒ†ãƒ¼ãƒˆãƒ¡ãƒ³ãƒˆã«ã‚ˆã£ã¦ã‚¢ã‚¯ã‚»ã‚¹ãŒæ‹’å¦ã•ã‚ŒãŸå ´åˆï¼Œã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®æœ€å¾Œã«ã€with an explicit denyã€ã¨ã„ã†æ–‡è¨€ãŒã¤ãï¼ ï¼Šä¾‹ï¼Š Error: An error occurred (AccessDeniedException) when calling the operation: is not authorized to perform: on resource: with an explicit deny ãƒ»ãƒ¦ãƒ¼ã‚¶åã‚’å¤‰æ›´ ãƒ¦ãƒ¼ã‚¶åã¯ï¼Œã‚³ãƒ³ã‚½ãƒ¼ãƒ«ç”»é¢ã‹ã‚‰å¤‰æ›´ã§ããšï¼Œã‚³ãƒãƒ³ãƒ‰ã§å¤‰æ›´ã™ã‚‹å¿…è¦ãŒã‚ã‚‹ï¼ $ aws iam update-user \\ --user-name \\ --new-user-name 20. Kinesis Data Streams Kinesis Data Streamsã¨ã¯ ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ãªã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°ãƒ‡ãƒ¼ã‚¿ï¼ˆå‹•ç”»ãƒ‡ãƒ¼ã‚¿ï¼ŒéŸ³å£°ãƒ‡ãƒ¼ã‚¿ï¼Œãªã©ï¼‰ã‚’ç¶™ç¶šçš„ã«åé›†ã—ï¼Œä¿ç®¡ã™ã‚‹ï¼ å‚è€ƒï¼šhttps://docs.aws.amazon.com/ja_jp/streams/latest/dev/amazon-kinesis-streams.html 20-02. Kinesis Data Firehoseï¼ˆKinesis Delivery Streamï¼‰ Kinesis Data Firehoseã¨ã¯ ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ãªã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°ãƒ‡ãƒ¼ã‚¿ï¼ˆå‹•ç”»ãƒ‡ãƒ¼ã‚¿ï¼ŒéŸ³å£°ãƒ‡ãƒ¼ã‚¿ï¼Œãªã©ï¼‰ã‚’ç¶™ç¶šçš„ã«åé›†ã—ï¼Œä¿ç®¡ï¼å¯è¦–åŒ–ï¼åˆ†æï¼ãƒ¬ãƒãƒ¼ãƒˆä½œæˆï¼ã‚¢ãƒ©ãƒ¼ãƒˆãŒå¯èƒ½ãªå¤–éƒ¨ã‚µãƒ¼ãƒ“ã‚¹ã‚„AWSãƒªã‚½ãƒ¼ã‚¹ã«è»¢é€ã™ã‚‹ï¼è»¢é€æ™‚ã«Lambdaé–¢æ•°ã‚’ä½¿ç”¨ã™ã‚‹ã“ã¨ã§ï¼Œåé›†ã—ãŸãƒ‡ãƒ¼ã‚¿ã‚’åŠ å·¥ã§ãã‚‹ï¼ å‚è€ƒï¼šhttps://docs.aws.amazon.com/ja_jp/firehose/latest/dev/what-is-this-service.html è¨­å®šé …ç›® é …ç›® èª¬æ˜ ãƒ¬ã‚³ãƒ¼ãƒ‰ã®å¤‰æ› è»¢é€å…ˆ è»¢é€å…ˆã¨ã™ã‚‹S3ãƒã‚±ãƒƒãƒˆã‚’è¨­å®šã™ã‚‹ï¼ ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ— åé›†ã—ãŸãƒ‡ãƒ¼ã‚¿ã‚’åŠ å·¥ã™ã‚‹å ´åˆã«ï¼ŒåŠ å·¥å‰ãƒ‡ãƒ¼ã‚¿ã‚’ä¿ç®¡ã—ã¦ãŠãï¼ æš—å·åŒ– ã‚¨ãƒ©ãƒ¼ãƒ­ã‚°ã®åé›† ãƒ‡ãƒ¼ã‚¿ã®è»¢é€æ™‚ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ãŸå ´åˆï¼Œã‚¨ãƒ©ãƒ¼ãƒ­ã‚°ã‚’CloudWatchãƒ­ã‚°ã«é€ä¿¡ã™ã‚‹ï¼ IAMãƒ­ãƒ¼ãƒ« Kinesis Data FirehoseãŒAWSãƒªã‚½ãƒ¼ã‚¹ã«ãƒ‡ãƒ¼ã‚¿ã‚’è»¢é€ã§ãã‚‹ã‚ˆã†ã«ï¼Œæ¨©é™ã‚’è¨­å®šã™ã‚‹ï¼ 20-03. Kinesis Data Analytics Kinesis Data Analyticsã¨ã¯ ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ãªã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°ãƒ‡ãƒ¼ã‚¿ï¼ˆå‹•ç”»ãƒ‡ãƒ¼ã‚¿ï¼ŒéŸ³å£°ãƒ‡ãƒ¼ã‚¿ï¼Œãªã©ï¼‰ã‚’ç¶™ç¶šçš„ã«åé›†ã—ï¼Œåˆ†æã™ã‚‹ï¼ å‚è€ƒï¼šhttps://docs.aws.amazon.com/kinesisanalytics/latest/dev/what-is.html 21. Lambda Lambdaã¨ã¯ ä»–ã®AWSãƒªã‚½ãƒ¼ã‚¹ã®ã‚¤ãƒ™ãƒ³ãƒˆã«ã‚ˆã£ã¦é§†å‹•ã™ã‚‹é–¢æ•°ã‚’ç®¡ç†ã§ãã‚‹ï¼ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹ã«ã¤ã„ã¦ã¯ï¼Œä»¥ä¸‹ã®ãƒªãƒ³ã‚¯ã‚’å‚è€ƒã«ã›ã‚ˆï¼ å‚è€ƒï¼šå‚è€ƒï¼šhttps://docs.aws.amazon.com/ja_jp/lambda/latest/dg/applications-usecases.html è¨­å®šé …ç›® ãƒ»æ¦‚è¦ è¨­å®šé …ç›® èª¬æ˜ è£œè¶³ ãƒ©ãƒ³ã‚¿ã‚¤ãƒ  é–¢æ•°ã®å®Ÿè£…ã«ä½¿ç”¨ã™ã‚‹è¨€èªã‚’è¨­å®šã™ã‚‹ï¼ ã‚³ãƒ³ãƒ†ãƒŠã‚¤ãƒ¡ãƒ¼ã‚¸ã®é–¢æ•°ã§ã¯ä½¿ç”¨ã§ããªã„ï¼ ãƒãƒ³ãƒ‰ãƒ© é–¢æ•°ã®å®Ÿè¡Œæ™‚ã«ã‚³ãƒ¼ãƒ«ã—ãŸã„å…·ä½“çš„ãƒ¡ã‚½ãƒƒãƒ‰åã‚’è¨­å®šã™ã‚‹ï¼ ãƒ»ã‚³ãƒ³ãƒ†ãƒŠã‚¤ãƒ¡ãƒ¼ã‚¸ã®é–¢æ•°ã§ã¯ä½¿ç”¨ã§ããªã„ï¼ãƒ»Node.jsï¼šindex.js ã¨ã„ã†ãƒ•ã‚¡ã‚¤ãƒ«åã§ exports.handler ãƒ¡ã‚½ãƒƒãƒ‰ã‚’å‘¼ã³å‡ºã—ãŸã„å ´åˆï¼Œãƒãƒ³ãƒ‰ãƒ©åã‚’index.handlerã¨ã™ã‚‹ ãƒ¬ã‚¤ãƒ¤ãƒ¼ ç•°ãªã‚‹é–¢æ•°ã®é–“ã§ï¼Œç‰¹å®šã®å‡¦ç†ã‚’å…±é€šåŒ–ã§ãã‚‹ï¼ ã‚³ãƒ³ãƒ†ãƒŠã‚¤ãƒ¡ãƒ¼ã‚¸ã®é–¢æ•°ã§ã¯ä½¿ç”¨ã§ããªã„ï¼ ãƒ¡ãƒ¢ãƒª Lambdaã«å‰²ã‚Šå½“ã¦ã‚‹ãƒ¡ãƒ¢ãƒªé‡ã‚’è¨­å®šã™ã‚‹ï¼ æœ€å¤§10240MBã¾ã§å¢—è¨­ã§ãï¼Œå¢—è¨­ã™ã‚‹ã»ã©ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãŒä¸ŠãŒã‚‹ï¼å‚è€ƒï¼šhttps://www.business-on-it.com/2003-aws-lambda-performance-check/ ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ å®Ÿè¡Œãƒ­ãƒ¼ãƒ« Lambdaå†…ã®ãƒ¡ã‚½ãƒƒãƒ‰ãŒå®Ÿè¡Œã•ã‚Œã‚‹æ™‚ã«å¿…è¦ãªãƒãƒªã‚·ãƒ¼ã‚’æŒã¤ãƒ­ãƒ¼ãƒ«ã‚’è¨­å®šã™ã‚‹ï¼ æ—¢å­˜ãƒ­ãƒ¼ãƒ« Lambdaã«ãƒ­ãƒ¼ãƒ«ã‚’è¨­å®šã™ã‚‹ï¼ ãƒˆãƒªã‚¬ãƒ¼ Lambdaã«ã‚¢ã‚¯ã‚»ã‚¹ã§ãã‚‹ã‚ˆã†ã«ã™ã‚‹AWSãƒªã‚½ãƒ¼ã‚¹ã‚’è¨­å®šã™ã‚‹ï¼ è¨­å®šã•ã‚ŒãŸAWSãƒªã‚½ãƒ¼ã‚¹ã«å¿œã˜ã¦ï¼ŒLambdaã®ãƒãƒªã‚·ãƒ¼ãŒè‡ªå‹•çš„ã«ä¿®æ­£ã•ã‚Œã‚‹ï¼ ã‚¢ã‚¯ã‚»ã‚¹æ¨©é™ Lambdaã®ãƒãƒªã‚·ãƒ¼ã‚’è¨­å®šã™ã‚‹ï¼ ãƒˆãƒªã‚¬ãƒ¼ã®è¨­å®šã«å¿œã˜ã¦ï¼ŒLambdaã®ãƒãƒªã‚·ãƒ¼ãŒè‡ªå‹•çš„ã«ä¿®æ­£ã•ã‚Œã‚‹ï¼ é€ä¿¡å…ˆ Lambdaã‹ã‚‰ã‚¢ã‚¯ã‚»ã‚¹ã§ãã‚‹ã‚ˆã†ã«ã™ã‚‹AWSãƒªã‚½ãƒ¼ã‚¹ã‚’è¨­å®šã™ã‚‹ï¼ é€ä¿¡å…ˆã®AWSãƒªã‚½ãƒ¼ã‚¹ã®ãƒãƒªã‚·ãƒ¼ã¯è‡ªå‹•çš„ã«ä¿®æ­£ã•ã‚Œãªã„ãŸã‚ï¼Œåˆ¥é€”ï¼Œæ‰‹å‹•ã§ä¿®æ­£ã™ã‚‹å¿…è¦ãŒã‚ã‚‹ï¼ ç’°å¢ƒå¤‰æ•° Lambdaã®é–¢æ•°å†…ã«å‡ºåŠ›ã™ã‚‹ç’°å¢ƒå¤‰æ•°ã‚’è¨­å®šã™ã‚‹ï¼ æ¨™æº–ã§ã¯ï¼Œç’°å¢ƒå¤‰æ•°ã¯AWSãƒãƒãƒ¼ã‚¸ãƒ‰å‹KMSã‚­ãƒ¼ã«ã‚ˆã£ã¦æš—å·åŒ–ã•ã‚Œã‚‹ï¼ åŒæ™‚å®Ÿè¡Œæ•° åŒæ™‚å®Ÿè¡Œã®äºˆç´„ã‚’è¨­å®šã™ã‚‹ï¼ ãƒ—ãƒ­ãƒ“ã‚¸ãƒ§ãƒ‹ãƒ³ã‚°ã•ã‚ŒãŸåŒæ™‚å®Ÿè¡Œè¨­å®š ãƒ¢ãƒ‹ã‚¿ãƒªãƒ³ã‚° Lambdaã‚’CloudWatchã¾ãŸã¯X-Rayã‚’ç”¨ã„ã¦ï¼Œãƒ¡ãƒˆãƒªã‚¯ã‚¹ã‚’åé›†ã™ã‚‹ï¼ æ¬¡ã®æ–¹æ³•ãŒã‚ã‚‹ãƒ»CloudWatchã«ã‚ˆã£ã¦ï¼Œãƒ¡ãƒˆãƒªã‚¯ã‚¹ã‚’åé›†ã™ã‚‹ï¼ãƒ»CloudWatchã®Lambda Insightsã«ã‚ˆã£ã¦ï¼Œãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã«é–¢ã™ã‚‹ãƒ¡ãƒˆãƒªã‚¯ã‚¹ã‚’åé›†ã™ã‚‹ï¼ãƒ»X-Rayã«ã‚ˆã£ã¦ï¼ŒAPIã¸ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆï¼ŒLambdaã‚³ãƒ¼ãƒ«ï¼ŒLambdaã®ä¸‹æµã¨ã®ãƒ‡ãƒ¼ã‚¿é€šä¿¡ã‚’ãƒˆãƒ¬ãƒ¼ã‚¹ã—ï¼Œã“ã‚Œã‚‰ã‚’ã‚¹ã‚¿ãƒƒã‚¯ãƒˆãƒ¬ãƒ¼ã‚¹åŒ–ã™ã‚‹ï¼ ãƒ»è¨­å®šã®ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹ å‚è€ƒï¼šhttps://docs.aws.amazon.com/ja_jp/lambda/latest/dg/best-practices.html#function-configuration Lambdaã¨é–¢æ•°ã®é–¢ä¿‚æ€§ ãƒ»Lambdaã‚µãƒ¼ãƒ“ã‚¹ ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ç”»é¢ã®Lamdaã«ç›¸å½“ã™ã‚‹ï¼ ãƒ»é–¢æ•°ã®å®Ÿè¡Œç’°å¢ƒ Lambdaã®å®Ÿè¡Œç’°å¢ƒã¯ï¼ŒAPIï¼ˆãƒ©ãƒ³ã‚¿ã‚¤ãƒ APIï¼Œãƒ­ã‚°APIï¼Œæ‹¡å¼µAPIï¼‰ã¨å®Ÿè¡Œç’°å¢ƒã‹ã‚‰æ§‹æˆã•ã‚Œã¦ã„ã‚‹ï¼é–¢æ•°ã¯å®Ÿè¡Œç’°å¢ƒã«å­˜åœ¨ã—ï¼Œãƒ©ãƒ³ã‚¿ã‚¤ãƒ APIã‚’ä»‹ã—ã¦ï¼ŒLambdaã«ã‚ˆã£ã¦å®Ÿè¡Œã•ã‚Œã‚‹ï¼ å‚è€ƒï¼šhttps://docs.aws.amazon.com/ja_jp/lambda/latest/dg/runtimes-extensions-api.html#runtimes-extensions-api-lifecycle å®Ÿè¡Œç’°å¢ƒã«ã¯ï¼Œï¼“ã¤ã®ãƒ•ã‚§ãƒ¼ã‚ºãŒã‚ã‚‹ï¼ å‚è€ƒï¼šhttps://docs.aws.amazon.com/ja_jp/lambda/latest/dg/runtimes-context.html#runtimes-lifecycle ãƒ»Initãƒ•ã‚§ãƒ¼ã‚º LambdaãŒç™ºç«ã™ã‚‹ï¼å®Ÿè¡Œç’°å¢ƒãŒæ§‹ç¯‰ã•ã‚Œï¼Œé–¢æ•°ã‚’å®Ÿè¡Œã™ã‚‹ãŸã‚ã®æº–å‚™ãŒè¡Œã‚ã‚Œã‚‹ï¼ ãƒ»Invokeãƒ•ã‚§ãƒ¼ã‚º Lambdaã¯é–¢æ•°ã‚’å®Ÿè¡Œã™ã‚‹ï¼å®Ÿè¡Œç’°å¢ƒå´ã®ãƒ©ãƒ³ã‚¿ã‚¤ãƒ ã¯ï¼ŒAPIã‚’ä»‹ã—ã¦Lambdaã‹ã‚‰é–¢æ•°ã«å¼•æ•°ã‚’æ¸¡ã™ï¼ã¾ãŸé–¢æ•°ã®å®Ÿè¡Œå¾Œã«ï¼ŒAPIã‚’ä»‹ã—ã¦è¿”å´å€¤ã‚’Lambdaã«æ¸¡ã™ï¼ ãƒ»Shutdownãƒ•ã‚§ãƒ¼ã‚º ä¸€å®šæœŸé–“ï¼ŒInvokeãƒ•ã‚§ãƒ¼ã‚ºã«ãŠã‘ã‚‹é–¢æ•°å®Ÿè¡ŒãŒè¡Œã‚ã‚Œãªã‹ã£ãŸå ´åˆï¼ŒLambdaã¯ãƒ©ãƒ³ã‚¿ã‚¤ãƒ ã‚’çµ‚äº†ã—ï¼Œå®Ÿè¡Œç’°å¢ƒã‚’å‰Šé™¤ã™ã‚‹ï¼ Lambdaé–¢æ•° on Docker ãƒ»ãƒ™ãƒ¼ã‚¹ã‚¤ãƒ¡ãƒ¼ã‚¸ã®æº–å‚™ å‚è€ƒï¼šhttps://docs.aws.amazon.com/ja_jp/lambda/latest/dg/runtimes-images.html#runtimes-images-lp ãƒ»RICï¼šRuntime Interface Clients é€šå¸¸ã®ãƒ©ãƒ³ã‚¿ã‚¤ãƒ ã¯ã‚³ãƒ³ãƒ†ãƒŠå†…é–¢æ•°ã¨é€šä¿¡ã§ããªã„ãŸã‚ï¼Œãƒ©ãƒ³ã‚¿ã‚¤ãƒ ã®ä»£ã‚ã‚Šã«RICã‚’ä½¿ç”¨ã—ã¦ã‚³ãƒ³ãƒ†ãƒŠå†…é–¢æ•°ã¨é€šä¿¡ã‚’è¡Œã†ï¼è¨€èªåˆ¥ã«RICãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ãŒç”¨æ„ã•ã‚Œã¦ã„ã‚‹ï¼ å‚è€ƒï¼šhttps://docs.aws.amazon.com/ja_jp/lambda/latest/dg/runtimes-images.html#runtimes-api-client ãƒ»RIEï¼šRuntime Interface Emulator é–‹ç™ºç’°å¢ƒã®ã‚³ãƒ³ãƒ†ãƒŠã§ï¼Œæ“¬ä¼¼çš„ã«Lambdaé–¢æ•°ã‚’å†ç¾ã™ã‚‹ï¼å…¨ã¦ã®è¨€èªã§å…±é€šã®RIEãƒ©ã‚¤ãƒ–ãƒ©ãƒªãŒç”¨æ„ã•ã‚Œã¦ã„ã‚‹ï¼ å‚è€ƒï¼šhttps://github.com/aws/aws-lambda-runtime-interface-emulator RIEã§ã‚ã£ã¦ã‚‚ï¼Œç¨¼åƒã•ã›ã‚‹ãŸã‚ã«AWSã®ã‚¯ãƒ¬ãƒ‡ãƒ³ã‚·ãƒ£ãƒ«æƒ…å ±ï¼ˆã‚¢ã‚¯ã‚»ã‚¹ã‚­ãƒ¼ï¼Œã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆã‚¢ã‚¯ã‚»ã‚¹ã‚­ãƒ¼ï¼Œãƒªãƒ¼ã‚¸ãƒ§ãƒ³ï¼‰ãŒå¿…è¦ãªãŸã‚ï¼Œç’°å¢ƒå¤‰æ•°ã‚„credentialsãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½¿ç”¨ã—ã¦ï¼ŒLambdaã«ã“ã‚Œã‚‰ã®å€¤ã‚’å‡ºåŠ›ã™ã‚‹ï¼ å‚è€ƒï¼šhttps://docs.aws.amazon.com/ja_jp/lambda/latest/dg/images-test.html#images-test-env ï¼Šå‚è€ƒï¼Š $ docker run --rm \\ # ã‚¨ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ãƒ¼ã‚’ã‚¨ãƒ³ãƒˆãƒªãƒã‚¤ãƒ³ãƒˆã‚’ãƒã‚¤ãƒ³ãƒ‰ã™ã‚‹ï¼ -v ~/.aws-lambda-rie:/aws-lambda \\ -p 9000:8080 \\ # ã‚¨ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ãƒ¼ã‚’ã‚¨ãƒ³ãƒˆãƒªãƒã‚¤ãƒ³ãƒˆã¨ã—ã¦æŒ‡å®šã™ã‚‹ï¼ --entrypoint /aws-lambda/aws-lambda-rie \\ : /go/bin/cmd # ãƒãƒ³ãƒ‰ãƒ©ãƒ¼é–¢æ•°ã®å¼•æ•°ã«åˆã£ãŸJSONãƒ‡ãƒ¼ã‚¿ã‚’é€ä¿¡ã™ã‚‹ï¼ $ curl \\ -XPOST \"http://localhost:9000/2015-03-31/functions/function/invocations\" \\ -d '{}' ï¼Šå‚è€ƒï¼Š version: \"3.7\" services: lambda: build: context: . dockerfile: ./build/Dockerfile container_name: lambda # ã‚¨ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ãƒ¼ã‚’ã‚¨ãƒ³ãƒˆãƒªãƒã‚¤ãƒ³ãƒˆã¨ã—ã¦æŒ‡å®šã™ã‚‹ï¼ entrypoint: /aws-lambda/aws-lambda-rie env_file: - .docker.env image: : ports: - 9000:8080 # ã‚¨ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ãƒ¼ã‚’ã‚¨ãƒ³ãƒˆãƒªãƒã‚¤ãƒ³ãƒˆã‚’ãƒã‚¤ãƒ³ãƒ‰ã™ã‚‹ï¼ volumes: - ~/.aws-lambda-rie:/aws-lambda $ docker-compose up lambda $ curl \\ -XPOST \"http://localhost:9000/2015-03-31/functions/function/invocations\" \\ -d '{}' Lambdaé–¢æ•° ãƒ»Goã®ä½¿ç”¨ä¾‹ ä»¥ä¸‹ã®ãƒªãƒ³ã‚¯ã‚’å‚è€ƒã«ã›ã‚ˆï¼ å‚è€ƒï¼š https://docs.aws.amazon.com/ja_jp/lambda/latest/dg/lambda-golang.html https://hiroki-it.github.io/tech-notebook-gitbook/public/infrastructure_cloud_computing_aws_lambda_function.html ãƒ»Node.jsã®ä½¿ç”¨ä¾‹ ä»¥ä¸‹ã®ãƒªãƒ³ã‚¯ã‚’å‚è€ƒã«ã›ã‚ˆï¼ å‚è€ƒï¼š https://docs.aws.amazon.com/ja_jp/lambda/latest/dg/lambda-nodejs.html https://hiroki-it.github.io/tech-notebook-gitbook/public/infrastructure_cloud_computing_aws_lambda_function.html åŒæ™‚å®Ÿè¡Œ ãƒ»åŒæ™‚å®Ÿè¡Œã®äºˆç´„ Lambdaã¯ï¼Œé–¢æ•°ã®å®Ÿè¡Œä¸­ã«å†ã³ãƒªã‚¯ã‚¨ã‚¹ãƒˆãŒé€ä¿¡ã•ã‚Œã‚‹ã¨ï¼Œé–¢æ•°ã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’æ–°ã—ãä½œæˆã™ã‚‹ï¼ãã—ã¦ï¼Œå„é–¢æ•°ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’ç”¨ã„ã¦ï¼ŒåŒæ™‚ä¸¦è¡Œçš„ã«ãƒªã‚¯ã‚¨ã‚¹ãƒˆã«å¿œã˜ã‚‹ï¼æ¨™æº–ã§ã¯ï¼Œé–¢æ•°ã®ç¨®é¡ãŒã„ãã¤ã‚ã£ã¦ã‚‚ï¼ŒAWSã‚¢ã‚«ã‚¦ãƒ³ãƒˆå½“ãŸã‚Šï¼Œåˆè¨ˆã§1000å€‹ã¾ã§ã—ã‹ã‚¹ã‚±ãƒ¼ãƒªãƒ³ã‚°ã—ã¦åŒæ™‚å®Ÿè¡Œã§ããªã„ï¼é–¢æ•°ã”ã¨ã«åŒæ™‚å®Ÿè¡Œæ•°ã®ä½¿ç”¨æ ã‚’å‰²ã‚Šå½“ã¦ã‚‹ãŸã‚ã«ã¯ï¼ŒåŒæ™‚å®Ÿè¡Œã®äºˆç´„ã‚’è¨­å®šã™ã‚‹å¿…è¦ãŒã‚ã‚‹ï¼åŒæ™‚å®Ÿè¡Œã®äºˆç´„æ•°ã‚’0å€‹ã¨ã—ãŸå ´åˆï¼ŒLambdãŒã‚¹ã‚±ãƒ¼ãƒªãƒ³ã‚°ã—ãªããªã‚‹ï¼ å‚è€ƒï¼šhttps://docs.aws.amazon.com/ja_jp/lambda/latest/dg/configuration-concurrency.html#configuration-concurrency-reserved VPCå¤–ï¼VPCå†… ãƒ»VPCå¤–ã¸ã®é…ç½® Lambdaã¯æ¨™æº–ã§ã¯VPCå¤–ã«é…ç½®ã•ã‚Œã‚‹ï¼ã“ã®å ´åˆï¼ŒLambdaã«ENIãŒã‚¢ã‚¿ãƒƒãƒã•ã‚Œï¼ŒENIã«å‰²ã‚Šå½“ã¦ã‚‰ã‚ŒãŸIPã‚¢ãƒ‰ãƒ¬ã‚¹ãŒLambdaã«é©ç”¨ã•ã‚Œã‚‹ï¼Lambdaã®å®Ÿè¡Œæ™‚ã«ENIã¯å†ä½œæˆã•ã‚Œã‚‹ãŸã‚ï¼Œå®Ÿè¡Œã”ã¨ã«IPã‚¢ãƒ‰ãƒ¬ã‚¹ã¯å¤‰åŒ–ã™ã‚‹ãŒï¼Œä¸€å®šæ™‚é–“å†…ã®å†å®Ÿè¡Œã§ã‚ã‚Œã°ENIã¯å†åˆ©ç”¨ã•ã‚Œã‚‹ãŸã‚ï¼Œå‰å›ã®å®Ÿè¡Œæ™‚ã¨åŒã˜IPã‚¢ãƒ‰ãƒ¬ã‚¹ã«ãªã‚‹ã“ã¨ã‚‚ã‚ã‚‹ï¼ ãƒ»VPCå†…ã¸ã®é…ç½® Lambdaã‚’VPCå†…ã«é…ç½®ã™ã‚‹ã‚ˆã†ã«è¨­å®šã™ã‚‹ï¼VPCå†…ã«é…ç½®ã—ãŸLambdaã«ã¯ãƒ‘ãƒ–ãƒªãƒƒã‚¯IPã‚¢ãƒ‰ãƒ¬ã‚¹ãŒå‰²ã‚Šå½“ã¦ã‚‰ã‚Œãªã„ãŸã‚ï¼Œã‚¢ã‚¦ãƒˆãƒã‚¦ãƒ³ãƒ‰ãªé€šä¿¡ã‚’è¡Œã†ãŸã‚ã«ã¯ï¼ŒNAT Gatewayã‚’è¨­ç½®ã™ã‚‹å¿…è¦ãŒã‚ã‚‹ï¼ ãƒãƒªã‚·ãƒ¼ ãƒ»å®Ÿè¡Œã®ãŸã‚ã®æœ€ä½é™ã®ãƒãƒªã‚·ãƒ¼ Lambdaã‚’å®Ÿè¡Œã™ã‚‹ãŸã‚ã«ã¯ï¼Œãƒ‡ãƒ—ãƒ­ã‚¤ã•ã‚ŒãŸé–¢æ•°ã‚’ä½¿ç”¨ã™ã‚‹æ¨©é™ãŒå¿…è¦ã§ã‚ã‚‹ï¼ãã®ãŸã‚ï¼Œé–¢æ•°ã‚’å–å¾—ã™ã‚‹ãŸã‚ã®ã‚¹ãƒ†ãƒ¼ãƒˆãƒ¡ãƒ³ãƒˆã‚’è¨­å®šã™ã‚‹ï¼ { \"Version\": \"2012-10-17\", \"Statement\": [ { \"Effect\": \"Allow\", \"Action\": \"lambda:InvokeFunction\", \"Resource\": \"arn:aws:lambda:::function:*\" } ] } ãƒ‡ãƒ—ãƒ­ã‚¤ ãƒ»ç›´æ¥ä¿®æ­£ ãƒ‡ãƒ—ãƒ­ã‚¤ã‚’è¡Œã‚ãšã«ï¼Œé–¢æ•°ã®ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã‚’ç›´æ¥ä¿®æ­£ã—ï¼Œã€Deployã€ãƒœã‚¿ãƒ³ã§ãƒ‡ãƒ—ãƒ­ã‚¤ã™ã‚‹ï¼ ãƒ»S3ã«ãŠã‘ã‚‹zipãƒ•ã‚¡ã‚¤ãƒ« ãƒ“ãƒ«ãƒ‰å¾Œã®ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã‚’zipãƒ•ã‚¡ã‚¤ãƒ«ã«ã—ã¦ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã™ã‚‹ï¼ãƒ­ãƒ¼ã‚«ãƒ«PCã¾ãŸã¯S3ã‹ã‚‰ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã§ãã‚‹ï¼ å‚è€ƒï¼šhttps://docs.aws.amazon.com/ja_jp/lambda/latest/dg/gettingstarted-package.html#gettingstarted-package-zip ãƒ»ECRã«ãŠã‘ã‚‹ã‚¤ãƒ¡ãƒ¼ã‚¸ ã‚³ãƒ³ãƒ†ãƒŠã‚¤ãƒ¡ãƒ¼ã‚¸ã®é–¢æ•°ã§ã®ã¿æœ‰åŠ¹ã§ã‚ã‚‹ï¼ãƒ“ãƒ«ãƒ‰å¾Œã®ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã‚’Dockerã‚¤ãƒ¡ãƒ¼ã‚¸ã—ã¦ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã™ã‚‹ï¼ECRã‹ã‚‰ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã§ãã‚‹ï¼ å‚è€ƒï¼šhttps://docs.aws.amazon.com/ja_jp/lambda/latest/dg/gettingstarted-package.html#gettingstarted-package-images 21-02. Lambda@Edge Lambda@Edgeã¨ã¯ CloudFrontã«çµ±åˆã•ã‚ŒãŸLambdaã‚’ï¼Œç‰¹åˆ¥ã«Lambda@Edgeã¨ã„ã†ï¼ è¨­å®šé …ç›® ãƒ»ãƒˆãƒªã‚¬ãƒ¼ã®ç¨®é¡ CloudFrontã®ãƒ“ãƒ¥ãƒ¼ãƒ¯ãƒ¼ãƒªã‚¯ã‚¨ã‚¹ãƒˆï¼Œã‚ªãƒªã‚¸ãƒ³ãƒªã‚¯ã‚¨ã‚¹ãƒˆï¼Œã‚ªãƒªã‚¸ãƒ³ãƒ¬ã‚¹ãƒãƒ³ã‚¹ï¼Œãƒ“ãƒ¥ãƒ¼ãƒ¯ãƒ¼ãƒ¬ã‚¹ãƒãƒ³ã‚¹ï¼Œã‚’ãƒˆãƒªã‚¬ãƒ¼ã¨ã™ã‚‹ï¼ã‚¨ãƒƒã‚¸ãƒ­ã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®CloudFrontã«ï¼ŒLambdaã®ãƒ¬ãƒ—ãƒªã‚«ãŒæ§‹ç¯‰ã•ã‚Œã‚‹ï¼ ãƒˆãƒªã‚¬ãƒ¼ã®ç¨®é¡ ç™ºç«ã®ã‚¿ã‚¤ãƒŸãƒ³ã‚° ãƒ“ãƒ¥ãƒ¼ãƒ¯ãƒ¼ãƒªã‚¯ã‚¨ã‚¹ãƒˆ CloudFrontãŒï¼Œãƒ“ãƒ¥ãƒ¼ãƒ¯ãƒ¼ã‹ã‚‰ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’å—ä¿¡ã—ãŸå¾Œï¼ˆã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’ç¢ºèªã™ã‚‹å‰ï¼‰ï¼ ã‚ªãƒªã‚¸ãƒ³ãƒªã‚¯ã‚¨ã‚¹ãƒˆ CloudFrontãŒï¼Œãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’ã‚ªãƒªã‚¸ãƒ³ã‚µãƒ¼ãƒãƒ¼ã«è»¢é€ã™ã‚‹å‰ï¼ˆã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’ç¢ºèªã—ãŸå¾Œï¼‰ï¼ ã‚ªãƒªã‚¸ãƒ³ãƒ¬ã‚¹ãƒãƒ³ã‚¹ CloudFrontãŒï¼Œã‚ªãƒªã‚¸ãƒ³ã‹ã‚‰ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’å—ä¿¡ã—ãŸå¾Œï¼ˆã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’ç¢ºèªã™ã‚‹å‰ï¼‰ï¼ ãƒ“ãƒ¥ãƒ¼ãƒ¯ãƒ¼ãƒ¬ã‚¹ãƒãƒ³ã‚¹ CloudFrontãŒï¼Œãƒ“ãƒ¥ãƒ¼ãƒ¯ãƒ¼ã«ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’è»¢é€ã™ã‚‹å‰ï¼ˆã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’ç¢ºèªã—ãŸå¾Œï¼‰ï¼ ãƒ»å„ãƒˆãƒªã‚¬ãƒ¼ã®eventã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã¸ã®ãƒãƒƒãƒ”ãƒ³ã‚° å„ãƒˆãƒªã‚¬ãƒ¼ã®eventã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã¸ã®ãƒãƒƒãƒ”ãƒ³ã‚°ã¯ï¼Œãƒªãƒ³ã‚¯ã‚’å‚è€ƒã«ã›ã‚ˆï¼ å‚è€ƒï¼šhttps://docs.aws.amazon.com/ja_jp/AmazonCloudFront/latest/DeveloperGuide/lambda-event-structure.html ãƒãƒªã‚·ãƒ¼ ãƒ»å®Ÿè¡Œã®ãŸã‚ã®æœ€ä½é™ã®ãƒãƒªã‚·ãƒ¼ Lambda@Edgeã‚’å®Ÿè¡Œã™ã‚‹ãŸã‚ã«ã¯ï¼Œæœ€ä½é™ï¼Œä»¥ä¸‹ã®æ¨©é™ãŒå¿…è¦ã§ã‚ã‚‹ï¼ { \"Version\": \"2012-10-17\", \"Statement\": [ { \"Effect\": \"Allow\", \"Action\": [ \"iam:CreateServiceLinkedRole\" ], \"Resource\": \"*\" }, { \"Effect\": \"Allow\", \"Action\": [ \"lambda:GetFunction\", \"lambda:EnableReplication*\" ], \"Resource\": \"arn:aws:lambda:::function::\" }, { \"Effect\": \"Allow\", \"Action\": [ \"cloudfront:UpdateDistribution\" ], \"Resource\": \"arn:aws:cloudfront:::distribution/\" } ] } Node.jsã‚’ç”¨ã„ãŸé–¢æ•°ä¾‹ ãƒ»ã‚ªãƒªã‚¸ãƒ³ã®å‹•çš„ãªåˆ‡ã‚Šæ›¿ãˆ ï¼Šå®Ÿè£…ä¾‹ï¼Š eventã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®domainNameã¨host.valueã«ä»£å…¥ã•ã‚ŒãŸãƒã‚±ãƒƒãƒˆã®ãƒ‰ãƒ¡ã‚¤ãƒ³åã«ã‚ˆã£ã¦ï¼Œãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°å…ˆã®ãƒã‚±ãƒƒãƒˆãŒæ±ºã¾ã‚‹ï¼ãã®ãŸã‚ï¼Œã“ã®å€¤ã‚’åˆ‡ã‚Šæ›¿ãˆã‚Œã°ï¼Œå‹•çš„ã‚ªãƒªã‚¸ãƒ³ã‚’å®Ÿç¾ã§ãã‚‹ï¼ãªãŠï¼Œå„ãƒã‚±ãƒƒãƒˆã«ã¯åŒã˜OAIã‚’è¨­å®šã™ã‚‹å¿…è¦ãŒã‚ã‚‹ï¼ \"use strict\"; exports.handler = (event, context, callback) => { const request = event.Records[0].cf.request; // ãƒ­ã‚°ã‚¹ãƒˆãƒªãƒ¼ãƒ ã«å¤‰æ•°ã‚’å‡ºåŠ›ã™ã‚‹ï¼ console.log(JSON.stringify({request}, null, 2)); const headers = request.headers; const s3Backet = getBacketBasedOnDeviceType(headers); request.origin.s3.domainName = s3Backet request.headers.host[0].value = s3Backet // ãƒ­ã‚°ã‚¹ãƒˆãƒªãƒ¼ãƒ ã«å¤‰æ•°ã‚’å‡ºåŠ›ã™ã‚‹ï¼ console.log(JSON.stringify({request}, null, 2)); return callback(null, request); }; /** * ãƒ‡ãƒã‚¤ã‚¹ã‚¿ã‚¤ãƒ—ã«åŸºã¥ã„ã¦ï¼Œã‚ªãƒªã‚¸ãƒ³ã‚’åˆ‡ã‚Šæ›¿ãˆã‚‹ï¼ * * @param {Object} headers * @param {string} env * @returns {string} pcBucket|spBucket */ const getBacketBasedOnDeviceType = (headers) => { const pcBucket = env + \"-bucket.s3.amazonaws.com\"; const spBucket = env + \"-bucket.s3.amazonaws.com\"; if (headers[\"cloudfront-is-desktop-viewer\"] && headers[\"cloudfront-is-desktop-viewer\"][0].value === \"true\") { return pcBucket; } if (headers[\"cloudfront-is-tablet-viewer\"] && headers[\"cloudfront-is-tablet-viewer\"][0].value === \"true\") { return pcBucket; } if (headers[\"cloudfront-is-mobile-viewer\"] && headers[\"cloudfront-is-mobile-viewer\"][0].value === \"true\") { return spBucket; } return spBucket; }; ã‚ªãƒªã‚¸ãƒ³ãƒªã‚¯ã‚¨ã‚¹ãƒˆã¯ï¼Œä»¥ä¸‹ã®eventã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®JSONãƒ‡ãƒ¼ã‚¿ã«ãƒãƒƒãƒ”ãƒ³ã‚°ã•ã‚Œã¦ã„ã‚‹ï¼ãªãŠï¼Œä¸€éƒ¨ã®ã‚­ãƒ¼ã¯çœç•¥ã—ã¦ã„ã‚‹ï¼ { \"Records\": [ { \"cf\": { \"request\": { \"body\": { \"action\": \"read-only\", \"data\": \"\", \"encoding\": \"base64\", \"inputTruncated\": false }, \"clientIp\": \"nnn.n.nnn.nnn\", \"headers\": { \"host\": [ { \"key\": \"Host\", \"value\": \"prd-sp-bucket.s3.ap-northeast-1.amazonaws.com\" } ], \"cloudfront-is-mobile-viewer\": [ { \"key\": \"CloudFront-Is-Mobile-Viewer\", \"value\": true } ], \"cloudfront-is-tablet-viewer\": [ { \"key\": \"loudFront-Is-Tablet-Viewer\", \"value\": false } ], \"cloudfront-is-smarttv-viewer\": [ { \"key\": \"CloudFront-Is-SmartTV-Viewer\", \"value\": false } ], \"cloudfront-is-desktop-viewer\": [ { \"key\": \"CloudFront-Is-Desktop-Viewer\", \"value\": false } ], \"user-agent\": [ { \"key\": \"User-Agent\", \"value\": \"Amazon CloudFront\" } ] }, \"method\": \"GET\", \"origin\": { \"s3\": { \"authMethod\": \"origin-access-identity\", \"customHeaders\": { \"env\": [ { \"key\": \"env\", \"value\": \"prd\" } ] }, \"domainName\": \"prd-sp-bucket.s3.amazonaws.com\", \"path\": \"\", \"port\": 443, \"protocol\": \"https\", \"region\": \"ap-northeast-1\" } }, \"querystring\": \"\", \"uri\": \"/images/12345\" } } } ] } 22. RDSï¼šRelational Database Service è¨­å®šé …ç›® è¨­å®šé …ç›® èª¬æ˜ è£œè¶³ ã‚¨ãƒ³ã‚¸ãƒ³ã®ã‚ªãƒ—ã‚·ãƒ§ãƒ³ ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚¨ãƒ³ã‚¸ãƒ³ã®ç¨®é¡ã‚’è¨­å®š ã‚¨ãƒ‡ã‚£ã‚·ãƒ§ãƒ³ Amazon Auroraã‚’é¸ã‚“ã å ´åˆã®äº’æ›æ€§ã‚’è¨­å®šã™ã‚‹ï¼ ã‚­ãƒ£ãƒ‘ã‚·ãƒ†ã‚£ã‚¿ã‚¤ãƒ— ã‚¨ãƒ³ã‚¸ãƒ³ãƒãƒ¼ã‚¸ãƒ§ãƒ³ ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚¨ãƒ³ã‚¸ãƒ³ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’æŒ‡å®šã™ã‚‹ï¼ ãƒ»SELECT AURORA_VERSION()ã‚’ä½¿ç”¨ã—ã¦ï¼Œã‚¨ãƒ³ã‚¸ãƒ³ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’ç¢ºèªã§ãã‚‹ï¼ ãƒ¬ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³æ©Ÿèƒ½ DBã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼è­˜åˆ¥å­ ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼åã‚’è¨­å®šã™ã‚‹ï¼ ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹åã¯ï¼Œæœ€åˆã«è¨­å®šã§ããšï¼ŒRDSã®æ§‹ç¯‰å¾Œã«è¨­å®šã§ãã‚‹ï¼ ãƒã‚¹ã‚¿ãƒ¦ãƒ¼ã‚¶å ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®rootãƒ¦ãƒ¼ã‚¶ã‚’è¨­å®š ãƒã‚¹ã‚¿ãƒ¼ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®rootãƒ¦ãƒ¼ã‚¶ã®ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’è¨­å®š DBã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚µã‚¤ã‚º ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã®ã‚¹ãƒšãƒƒã‚¯ã‚’è¨­å®šã™ã‚‹ï¼ ãƒãƒ¼ã‚¹ãƒˆå¯èƒ½ã‚¯ãƒ©ã‚¹ã‚’é¸ã¶ã“ã¨ï¼ã¡ãªã¿ã«ï¼ŒAmazon Auroraã®ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹å®¹é‡ã¯è‡ªå‹•ã§ã‚¹ã‚±ãƒ¼ãƒªãƒ³ã‚°ã™ã‚‹ãŸã‚ï¼Œè¨­å®šã™ã‚‹å¿…è¦ãŒãªã„ï¼ ãƒãƒ«ãƒAZé…ç½® ãƒ—ãƒ©ã‚¤ãƒãƒªã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã¨ã¯åˆ¥ã«ï¼Œãƒªãƒ¼ãƒ€ãƒ¼ãƒ¬ãƒ—ãƒªã‚«ã‚’ãƒãƒ«ãƒAZé…ç½®ã§è¿½åŠ ã™ã‚‹ã‹ã©ã†ã‹ã‚’è¨­å®šã™ã‚‹ï¼ æœ€åˆã®ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹å ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã«è‡ªå‹•çš„ã«æ§‹ç¯‰ã•ã‚Œã‚‹ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹åã‚’è¨­å®š ã‚µãƒ–ãƒãƒƒãƒˆã‚°ãƒ«ãƒ¼ãƒ— ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã«ã‚¢ã‚¯ã‚»ã‚¹ã§ãã‚‹ã‚µãƒ–ãƒãƒƒãƒˆã‚’è¨­å®šã™ã‚‹ï¼ ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚°ãƒ«ãƒ¼ãƒ— ã‚°ãƒ­ãƒ¼ãƒãƒ«ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’è¨­å®šã™ã‚‹ï¼ ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã‚’ä½¿ç”¨ã›ãšã«ç‹¬è‡ªå®šç¾©ã™ã‚‹å ´åˆï¼Œäº‹å‰ã«æ§‹ç¯‰ã—ã¦ãŠãå¿…è¦ãŒã‚ã‚‹ï¼ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚°ãƒ«ãƒ¼ãƒ—ã¨ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚°ãƒ«ãƒ¼ãƒ—ãŒã‚ã‚‹ãŒï¼Œã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’è¨­å®šã™ã‚Œã°ã‚ˆã„ï¼å„ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã«é©ç”¨ã‚¿ã‚¤ãƒ—ï¼ˆdynamic/staticï¼‰ãŒã‚ã‚Šï¼Œdynamicã‚¿ã‚¤ãƒ—ã¯è¨­å®šã®é©ç”¨ã«å†èµ·å‹•ãŒå¿…è¦ã§ã‚ã‚‹ï¼æ–°ã—ãä½œæˆã—ãŸã‚¯ãƒ©ã‚¹ã‚¿ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚°ãƒ«ãƒ¼ãƒ—ã«ã¦ä»¥ä¸‹ã®å€¤ã‚’è¨­å®šã™ã‚‹ã¨ã‚ˆã„ï¼ãƒ»time_zone=Asia/Tokyoãƒ»character_set_client=utf8mb4ãƒ»character_set_connection=utf8mb4ãƒ»character_set_database=utf8mb4ãƒ»character_set_results=utf8mb4ãƒ»character_set_server=utf8mb4ãƒ»server_audit_logging=1ï¼ˆç›£æŸ»ãƒ­ã‚°ã‚’CloudWatchã«é€ä¿¡ã™ã‚‹ã‹ã©ã†ã‹ï¼‰ãƒ»server_audit_logs_upload=1ãƒ»general_log=1ï¼ˆé€šå¸¸ã‚¯ã‚¨ãƒªãƒ­ã‚°ã‚’CloudWatchã«é€ä¿¡ã™ã‚‹ã‹ã©ã†ã‹ï¼‰ãƒ»slow_query_log=1ï¼ˆã‚¹ãƒ­ãƒ¼ã‚¯ã‚¨ãƒªãƒ­ã‚°ã‚’CloudWatchã«é€ä¿¡ã™ã‚‹ã‹ã©ã†ã‹ï¼‰ãƒ»long_query_time=3ï¼ˆã‚¹ãƒ­ãƒ¼ã‚¯ã‚¨ãƒªã¨è¦‹ãªã™æœ€çŸ­ç§’æ•°ï¼‰ ãƒ­ã‚°ã®ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ å¿…ãšï¼Œå…¨ã¦ã®ãƒ­ã‚°ã‚’é¸æŠã™ã‚‹ã“ã¨ï¼ ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ä¿æŒæœŸé–“ RDSãŒãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã‚’ä¿æŒã™ã‚‹æœŸé–“ã‚’è¨­å®šã™ã‚‹ï¼ 7æ—¥é–“ã«ã—ã¦ãŠãï¼ ãƒã‚¤ãƒŠãƒ¼ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã®è‡ªå‹•ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰ ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚¨ãƒ³ã‚¸ãƒ³ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’è‡ªå‹•çš„ã«æ›´æ–°ã™ã‚‹ã‹ã‚’è¨­å®šã™ã‚‹ï¼ é–‹ç™ºç’°å¢ƒã§ã¯æœ‰åŠ¹åŒ–ï¼Œæœ¬ç•ªç’°å¢ƒã¨ã‚¹ãƒ†ãƒ¼ã‚¸ãƒ³ã‚°ç’°å¢ƒã§ã¯ç„¡åŠ¹åŒ–ã—ã¦ãŠãï¼é–‹ç™ºç’°å¢ƒã§æ–°ã—ã„ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã«å•é¡ŒãŒãªã‘ã‚Œã°ï¼Œã‚¹ãƒ†ãƒ¼ã‚¸ãƒ³ã‚°ç’°å¢ƒã¨æœ¬ç•ªç’°å¢ƒã«ã‚‚é©ç”¨ã™ã‚‹ï¼ ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ ãƒ»ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚¨ãƒ³ã‚¸ãƒ³ï¼ŒRDBï¼ŒDBMSã®å¯¾å¿œé–¢ä¿‚ RDSã§ã¯ï¼ŒDBMSï¼ŒRDBã‚’é¸ã¹ã‚‹ï¼ DBMSã®ç¨®é¡ RDBã®ç¨®é¡ MySQLï¼PostgreSQL Amazon Aurora MariaDB MariaDBãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ MySQL MySQLãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ PostgreSQL PostgreSQLãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ ãƒ»ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã®ç¨®é¡ èª­ã¿å‡ºã—ï¼æ›¸ãè¾¼ã¿ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ èª­ã¿å‡ºã—ã‚ªãƒ³ãƒªãƒ¼ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ åˆ¥å ãƒ—ãƒ©ã‚¤ãƒãƒªã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ ãƒªãƒ¼ãƒ‰ãƒ¬ãƒ—ãƒªã‚«ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ CRUDåˆ¶é™ åˆ¶é™ãªã—ï¼ãƒ¦ãƒ¼ã‚¶æ¨©é™ã«ä¾å­˜ã™ã‚‹ï¼ ãƒ¦ãƒ¼ã‚¶æ¨©é™ã®æ¨©é™ã«é–¢ä¿‚ãªãï¼ŒREADã—ã‹å®Ÿè¡Œã§ããªã„ï¼ ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ å„ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã«ï¼Œãƒªãƒ¼ã‚¸ãƒ§ãƒ³ã®ã‚¤ãƒ‹ã‚·ãƒ£ãƒ«ã«åˆã‚ã›ãŸã‚¨ãƒ³ãƒ‚ãƒã‚¤ãƒ³ãƒˆãŒå‰²ã‚ŠæŒ¯ã‚‰ã‚Œã‚‹ï¼ å„ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã«ï¼Œãƒªãƒ¼ã‚¸ãƒ§ãƒ³ã®ã‚¤ãƒ‹ã‚·ãƒ£ãƒ«ã«åˆã‚ã›ãŸã‚¨ãƒ³ãƒ‚ãƒã‚¤ãƒ³ãƒˆãŒå‰²ã‚ŠæŒ¯ã‚‰ã‚Œã‚‹ï¼ ãƒ‡ãƒ¼ã‚¿åŒæœŸ RDSã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ã«å¯¾ã™ã‚‹ãƒ‡ãƒ¼ã‚¿å¤‰æ›´ã‚’å—ã‘ã¤ã‘ã‚‹ï¼ èª­ã¿å‡ºã—ï¼æ›¸ãè¾¼ã¿ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã®ãƒ‡ãƒ¼ã‚¿ã®å¤‰æ›´ãŒåŒæœŸã•ã‚Œã‚‹ï¼ ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã®ãƒ€ã‚¦ãƒ³ã‚¿ã‚¤ãƒ  ãƒ»ãƒ€ã‚¦ãƒ³ã‚¿ã‚¤ãƒ ã®ç™ºç”Ÿæ¡ä»¶ ãã®ä»–ã®å…¨ã¦ã®é …ç›®ã¯ï¼Œä»¥ä¸‹ã®ãƒªãƒ³ã‚¯ã‚’å‚è€ƒã«ã›ã‚ˆï¼ å‚è€ƒï¼šhttps://docs.aws.amazon.com/ja_jp/AmazonRDS/latest/UserGuide/Overview.DBInstance.Modifying.html#USER_ModifyInstance.Settings å¤‰æ›´ã™ã‚‹é …ç›® ãƒ€ã‚¦ãƒ³ã‚¿ã‚¤ãƒ ã®æœ‰ç„¡ è£œè¶³ ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚¯ãƒ©ã‚¹ ã‚ã‚Š ã‚µãƒ–ãƒãƒƒãƒˆã‚°ãƒ«ãƒ¼ãƒ— ã‚ã‚Š ã‚¨ãƒ³ã‚¸ãƒ³ãƒãƒ¼ã‚¸ãƒ§ãƒ³ ã‚ã‚Š 20ï½30ç§’ã®ãƒ€ã‚¦ãƒ³ã‚¿ã‚¤ãƒ ãŒç™ºç”Ÿã™ã‚‹ï¼å‚è€ƒï¼šhttps://docs.aws.amazon.com/ja_jp/AmazonRDS/latest/AuroraUserGuide/AuroraMySQL.Updates.html ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ æ¡ä»¶ä»˜ãã§ãªã— ãƒ€ã‚¦ãƒ³ã‚¿ã‚¤ãƒ ãŒç™ºç”Ÿã™ã‚‹æ“ä½œãŒä¿ç•™ä¸­ã«ãªã£ã¦ã„ã‚‹çŠ¶æ…‹ã§ï¼Œãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹æ™‚é–“ã‚’ç¾åœ¨ãŒå«ã¾ã‚Œã‚‹ã‚ˆã†ã«å¤‰æ›´ã™ã‚‹ã¨ï¼Œä¿ç•™ä¸­ã®æ“ä½œãŒã™ãã«é©ç”¨ã•ã‚Œã‚‹ï¼ãã®ãŸã‚ï¼Œãƒ€ã‚¦ãƒ³ã‚¿ã‚¤ãƒ ãŒç™ºç”Ÿã™ã‚‹ï¼ ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã‚¦ã‚¤ãƒ³ãƒ‰ã‚¦ æ¡ä»¶ä»˜ãã§ãªã— 0ã‹ã‚‰0ä»¥å¤–ã®å€¤ï¼Œ0ä»¥å¤–ã®å€¤ã‹ã‚‰0ã«å¤‰æ›´ã—ãŸå ´åˆï¼Œãƒ€ã‚¦ãƒ³ã‚¿ã‚¤ãƒ ãŒç™ºç”Ÿã™ã‚‹ï¼ ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚°ãƒ«ãƒ¼ãƒ— ãªã— ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚°ãƒ«ãƒ¼ãƒ—ã®å¤‰æ›´ã§ã¯ãƒ€ã‚¦ãƒ³ã‚¿ã‚¤ãƒ ã¯ç™ºç”Ÿã—ãªã„ï¼ãŸã ã—ï¼Œãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚°ãƒ«ãƒ¼ãƒ—ã®å¤‰æ›´ã‚’ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã«åæ˜ ã•ã›ã‚‹ä¸Šã§å†èµ·å‹•ãŒå¿…è¦ãªãŸã‚ï¼Œã“ã“ã§ãƒ€ã‚¦ãƒ³ã‚¿ã‚¤ãƒ ãŒç™ºç”Ÿã™ã‚‹ï¼ ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚°ãƒ«ãƒ¼ãƒ— ãªã— ãƒã‚¤ãƒŠãƒ¼ãƒãƒ¼ã‚¸ãƒ§ãƒ³è‡ªå‹•ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰ ãªã— ã‚¨ãƒ³ã‚¸ãƒ³ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã®å¤‰æ›´ã«ã¯ãƒ€ã‚¦ãƒ³ã‚¿ã‚¤ãƒ ãŒç™ºç”Ÿã™ã‚‹ãŒï¼Œè‡ªå‹•ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰ã®è¨­å®šã«ã¯ãƒ€ã‚¦ãƒ³ã‚¿ã‚¤ãƒ ãŒç™ºç”Ÿã—ãªã„ï¼ ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã‚¤ãƒ³ã‚µã‚¤ãƒˆ æ¡ä»¶ä»˜ãã§ãªã— ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã‚¤ãƒ³ã‚µã‚¤ãƒˆã®æœ‰åŠ¹åŒ–ã§ã¯ãƒ€ã‚¦ãƒ³ã‚¿ã‚¤ãƒ ãŒç™ºç”Ÿã—ãªã„ï¼ãŸã ã—ï¼Œæœ‰åŠ¹åŒ–ã®ãŸã‚ã«ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚°ãƒ«ãƒ¼ãƒ—ã®performance_schemaã‚’æœ‰åŠ¹åŒ–ã™ã‚‹å¿…è¦ãŒã‚ã‚‹ï¼ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚°ãƒ«ãƒ¼ãƒ—ã®å¤‰æ›´ã‚’ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã«åæ˜ ã•ã›ã‚‹ä¸Šã§å†èµ·å‹•ãŒå¿…è¦ãªãŸã‚ï¼Œã“ã“ã§ãƒ€ã‚¦ãƒ³ã‚¿ã‚¤ãƒ ãŒç™ºç”Ÿã™ã‚‹ï¼ ãƒ»å†èµ·å‹•ãƒ€ã‚¦ãƒ³ã‚¿ã‚¤ãƒ ã®çŸ­ç¸® éãƒãƒ«ãƒAZæ§‹æˆã®å ´åˆï¼Œã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®å‘ãå…ˆã‚’ãƒ—ãƒ©ã‚¤ãƒãƒªãƒ¼ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã«ã—ãŸã¾ã¾ï¼Œå¤‰æ›´å¯¾è±¡ã®ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‹ã‚‰ãƒªãƒ¼ãƒ‰ãƒ¬ãƒ—ãƒªã‚«ã‚’æ–°ã—ãä½œæˆã—ï¼Œã“ã‚Œã‚’æ›´æ–°ã—ãŸå¾Œã«ï¼Œãƒªãƒ¼ãƒ‰ãƒ¬ãƒ—ãƒªã‚«ã‚’æ‰‹å‹•ãƒ•ã‚§ã‚¤ãƒ«ã‚ªãƒ¼ãƒãƒ¼ã•ã›ã‚‹ï¼ãƒ•ã‚§ã‚¤ãƒ«ã‚ªãƒ¼ãƒãƒ¼æ™‚ã«ç´„1ï½2åˆ†ã®ãƒ€ã‚¦ãƒ³ã‚¿ã‚¤ãƒ ãŒç™ºç”Ÿã™ã‚‹ãŒï¼Œã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã®å†èµ·å‹•ã‚ˆã‚Šã‚‚æ™‚é–“ãŒçŸ­ã„ãŸã‚ï¼Œç›¸å¯¾çš„ã«ãƒ€ã‚¦ãƒ³ã‚¿ã‚¤ãƒ ã‚’çŸ­ç¸®ã§ãã‚‹ï¼ å‚è€ƒï¼šhttps://docs.aws.amazon.com/ja_jp/AmazonRDS/latest/UserGuide/USER_UpgradeDBInstance.MySQL.html#USER_UpgradeDBInstance.MySQL.ReducedDowntime ãƒãƒ«ãƒAZæ§‹æˆã®å ´åˆï¼Œã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®å‘ãå…ˆã‚’ãƒ—ãƒ©ã‚¤ãƒãƒªãƒ¼ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã«ã—ãŸã¾ã¾ï¼Œæ—¢å­˜ã®ãƒªãƒ¼ãƒ‰ãƒ¬ãƒ—ãƒªã‚«ã‚’æ›´æ–°ã—ï¼Œãƒªãƒ¼ãƒ‰ãƒ¬ãƒ—ãƒªã‚«ã‚’è‡ªå‹•ãƒ•ã‚§ã‚¤ãƒ«ã‚ªãƒ¼ãƒãƒ¼ã•ã›ã‚‹ï¼ãƒ•ã‚§ã‚¤ãƒ«ã‚ªãƒ¼ãƒãƒ¼æ™‚ã«ç´„1ï½2åˆ†ã®ãƒ€ã‚¦ãƒ³ã‚¿ã‚¤ãƒ ãŒç™ºç”Ÿã™ã‚‹ãŒï¼Œã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã®å†èµ·å‹•ã‚ˆã‚Šã‚‚æ™‚é–“ãŒçŸ­ã„ãŸã‚ï¼Œç›¸å¯¾çš„ã«ãƒ€ã‚¦ãƒ³ã‚¿ã‚¤ãƒ ã‚’çŸ­ç¸®ã§ãã‚‹ï¼ ãƒ»ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ã‚¦ã‚¤ãƒ³ãƒ‰ã‚¦ ãƒ¡ãƒ³ãƒ†ãƒŠã‚¹ã‚¦ã‚¤ãƒ³ãƒ‰ã‚¦ã«ã¯ï¼Œä»¥ä¸‹ã®çŠ¶æ…‹ãŒã‚ã‚‹ï¼ çŠ¶æ…‹ èª¬æ˜ åˆ©ç”¨å¯èƒ½ ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã¯å®Ÿè¡Œå¯èƒ½ã§ã‚ã‚‹ï¼ã¾ãŸï¼Œä»¥é™ã®ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã®é–“ã«è‡ªå‹•çš„ã«å®Ÿè¡Œã™ã‚‹ã“ã¨ã¯ãªã„ï¼ æ¬¡ã®ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã¯å®Ÿè¡Œå¯èƒ½ã§ã‚ã‚‹ï¼ã¾ãŸï¼Œæ¬¡å›ã®ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã®é–“ã«ï¼Œã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚’è‡ªå‹•çš„ã«å®Ÿè¡Œã™ã‚‹ï¼å¾Œã§ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰ã‚’é¸æŠã™ã‚‹ã“ã¨ã§ï¼Œã€åˆ©ç”¨å¯èƒ½ã€ã®çŠ¶æ…‹ã«æˆ»ã™ã“ã¨ã‚‚å¯èƒ½ï¼ å¿…é ˆ ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã¯å®Ÿè¡Œå¯èƒ½ã§ã‚ã‚‹ï¼ã¾ãŸï¼ŒæŒ‡å®šã•ã‚ŒãŸãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã®é–“ã«å¿…ãšå®Ÿè¡Œã•ã‚Œï¼Œã“ã‚Œã¯å»¶æœŸã§ããªã„ï¼ é€²è¡Œä¸­ ç¾åœ¨æ™‚åˆ»ãŒãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã«å«ã¾ã‚Œã¦ãŠã‚Šï¼Œã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚’å®Ÿè¡Œä¸­ã§ã‚ã‚‹ï¼ ãƒ»ãƒ€ã‚¦ãƒ³ã‚¿ã‚¤ãƒ ã®è¨ˆæ¸¬ ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ç›®è¦–ã§ã¯ãªãï¼ŒRDSã«ç›´æ¥ã‚¯ã‚¨ãƒªã‚’é€ä¿¡ã—ï¼Œãƒ¬ã‚¹ãƒãƒ³ã‚¹ã¨RDSã‚¤ãƒ™ãƒ³ãƒˆãƒ­ã‚°ã‹ã‚‰ï¼Œãƒ€ã‚¦ãƒ³ã‚¿ã‚¤ãƒ ã‚’è¨ˆæ¸¬ã™ã‚‹ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š è¸ã¿å°ã‚µãƒ¼ãƒã‚’çµŒç”±ã—ã¦RDSã«æ¥ç¶šã—ï¼Œç¾åœ¨æ™‚åˆ»ã‚’å–å¾—ã™ã‚‹SQLã‚’é€ä¿¡ã™ã‚‹ï¼å¹³å¸¸ã‚¢ã‚¯ã‚»ã‚¹æ™‚ã®å†ç¾ãƒ†ã‚¹ãƒˆã‚‚åŒæ™‚ã«å®Ÿè¡Œã™ã‚‹ã“ã¨ã§ï¼Œã‚ˆã‚Šæ­£ç¢ºãªãƒ€ã‚¦ãƒ³ã‚¿ã‚¤ãƒ ã‚’å–å¾—ã™ã‚‹ã‚ˆã†ã«ã™ã‚‹ï¼ã¾ãŸï¼Œãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯ã®æ™‚åˆ»ã‚’æ­£ã—ããƒ­ã‚®ãƒ³ã‚°ã§ãã‚‹ã‚ˆã†ã«ï¼Œãƒ­ãƒ¼ã‚«ãƒ«PCã‹ã‚‰æ™‚åˆ»ã‚’å–å¾—ã™ã‚‹ï¼ #!/bin/bash set -x BASTION_HOST=\"\" BASTION_USER=\"\" DB_HOST=\"\" DB_PASSWORD=\"\" DB_USER=\"\" SECRET_KEY=\"~/.ssh/xxx.pem\" SQL=\"SELECT NOW();\" ssh -o serveraliveinterval=60 -f -N -L 3306:${DB_HOST}:3306 -i ${SECRET_KEY} ${BASTION_USER}@${BASTION_HOST} -p 22 for i in {1..900}; do LOCAL_DATETIME=$(date +\"%Y-%m-%d %H:%M:%S\") echo \"---------- No. ${i} Local PC: ${LOCAL_DATETIME} ------------\" >> health_check.txt echo ${SQL} | mysql -u ${DB_USER} -P 3306 -p${DB_PASSWORD} >> health_check.txt 2>&1 & sleep 1 done ä¸Šè¨˜ã®ã‚·ã‚§ãƒ«ã‚¹ã‚¯ãƒªãƒ—ãƒˆã«ã‚ˆã‚Šï¼Œä¾‹ãˆã°æ¬¡ã®ã‚ˆã†ãªãƒ­ã‚°ã‚’å–å¾—ã§ãã‚‹ï¼ã“ã®ãƒ­ã‚°ã‹ã‚‰ã¯ï¼Œ15:23:09 ~ 15:23:14ã®é–“ã§ï¼Œæ¥ç¶šã«å¤±æ•—ã—ã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèªã§ãã‚‹ï¼ ---------- No. 242 Local PC: 2021-04-21 15:23:06 ------------ mysql: [Warning] Using a password on the command line interface can be insecure. NOW() 2021-04-21 06:23:06 ---------- No. 243 Local PC: 2021-04-21 15:23:07 ------------ mysql: [Warning] Using a password on the command line interface can be insecure. NOW() 2021-04-21 06:23:08 ---------- No. 244 Local PC: 2021-04-21 15:23:08 ------------ mysql: [Warning] Using a password on the command line interface can be insecure. ERROR 2026 (HY000): SSL connection error: error:00000000:lib(0):func(0):reason(0) ---------- No. 245 Local PC: 2021-04-21 15:23:09 ------------ mysql: [Warning] Using a password on the command line interface can be insecure. ERROR 2013 (HY000): Lost connection to MySQL server at 'reading initial communication packet', system error: 0 ---------- No. 246 Local PC: 2021-04-21 15:23:10 ------------ mysql: [Warning] Using a password on the command line interface can be insecure. ERROR 2013 (HY000): Lost connection to MySQL server at 'reading initial communication packet', system error: 0 ---------- No. 247 Local PC: 2021-04-21 15:23:11 ------------ mysql: [Warning] Using a password on the command line interface can be insecure. ERROR 2013 (HY000): Lost connection to MySQL server at 'reading initial communication packet', system error: 0 ---------- No. 248 Local PC: 2021-04-21 15:23:13 ------------ mysql: [Warning] Using a password on the command line interface can be insecure. ERROR 2013 (HY000): Lost connection to MySQL server at 'reading initial communication packet', system error: 0 ---------- No. 249 Local PC: 2021-04-21 15:23:14 ------------ mysql: [Warning] Using a password on the command line interface can be insecure. ERROR 2013 (HY000): Lost connection to MySQL server at 'reading initial communication packet', system error: 0 ---------- No. 250 Local PC: 2021-04-21 15:23:15 ------------ mysql: [Warning] Using a password on the command line interface can be insecure. NOW() 2021-04-21 06:23:16 ---------- No. 251 Local PC: 2021-04-21 15:23:16 ------------ mysql: [Warning] Using a password on the command line interface can be insecure. NOW() 2021-04-21 06:23:17 ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰æ™‚ã®ãƒ—ãƒ©ã‚¤ãƒãƒªã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã®RDSã‚¤ãƒ™ãƒ³ãƒˆãƒ­ã‚°ã¯ä»¥ä¸‹ã®é€šã‚Šã§ï¼Œãƒ­ã‚°ã«ã‚ˆã‚‹ãƒ€ã‚¦ãƒ³ã‚¿ã‚¤ãƒ ã¯ï¼Œå†èµ·å‹•ã‹ã‚‰ã‚·ãƒ£ãƒƒãƒˆãƒ€ã‚¦ãƒ³ã¾ã§ã®æœŸé–“ã¨ä¸€è‡´ã™ã‚‹ã“ã¨ã‚’ç¢ºèªã™ã‚‹ï¼ ã¡ãªã¿ã«ï¼Œãƒªãƒ¼ãƒ‰ãƒ¬ãƒ—ãƒªã‚«ã¯å†èµ·å‹•ã®ã¿ã‚’å®Ÿè¡Œã—ã¦ã„ã‚‹ã“ã¨ãŒã‚ã‹ã‚‹ï¼ è² è·å¯¾ç­– ãƒ»ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã®ä½¿ã„åˆ†ã‘ ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã«å¿œã˜ãŸã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆãŒç”¨æ„ã•ã‚Œã¦ã„ã‚‹ï¼ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‹ã‚‰ã®CRUDã®ç¨®é¡ã«å¿œã˜ã¦ï¼Œã‚¢ã‚¯ã‚»ã‚¹å…ˆã‚’æŒ¯ã‚Šåˆ†ã‘ã‚‹ã“ã¨ã«ã‚ˆã‚Šï¼Œè² è·ã‚’åˆ†æ•£ã•ã›ã‚‰ã‚Œã‚‹ï¼èª­ã¿å‡ºã—ã‚ªãƒ³ãƒªãƒ¼ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã«å¯¾ã—ã¦ï¼ŒREADä»¥å¤–ã®å‡¦ç†ã‚’è¡Œã†ã¨ï¼Œä»¥ä¸‹ã®é€šã‚Šï¼Œã‚¨ãƒ©ãƒ¼ã¨ãªã‚‹ï¼ /* SQL Error (1290): The MySQL server is running with the --read-only option so it cannot execute this statement */ ç¨®é¡ ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ ã‚¯ã‚¨ãƒªã®ç¨®é¡ èª¬æ˜ ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ .cluster-.ap-northeast-1.rds.amazonaws.com æ›¸ãè¾¼ã¿ï¼èª­ã¿å‡ºã— ãƒ—ãƒ©ã‚¤ãƒãƒªã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã«æ¥ç¶šã§ãã‚‹ï¼ èª­ã¿å‡ºã—ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ .cluster-ro-.ap-northeast-1.rds.amazonaws.com èª­ã¿å‡ºã— ãƒªãƒ¼ãƒ‰ãƒ¬ãƒ—ãƒªã‚«ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã«æ¥ç¶šã§ãã‚‹ï¼ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ãŒè¤‡æ•°ã‚ã‚‹å ´åˆï¼Œã‚¯ã‚¨ãƒªãŒè‡ªå‹•çš„ã«å‰²ã‚ŠæŒ¯ã‚‰ã‚Œã‚‹ï¼ ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ .cwgrq25vlygf.ap-northeast-1.rds.amazonaws.com é¸æŠã—ãŸã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã«æ¥ç¶šã§ãã‚‹ï¼ãƒ•ã‚§ã‚¤ãƒ«ã‚ªãƒ¼ãƒãƒ¼ã«ã‚ˆã£ã¦èª­ã¿æ›¸ãã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã¨èª­ã¿å‡ºã—ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ãŒå…¥ã‚Œæ›¿ã‚ã£ã¦ã—ã¾ã†ãŸã‚ï¼Œã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã‚’æŒ‡å®šã—ãªã„æ–¹ãŒè‰¯ã„ï¼ã“ã‚Œã¯ï¼ŒRedisã‚‚åŒã˜ã§ã‚ã‚‹ï¼ ãƒ»ã‚¯ã‚¨ãƒªã‚­ãƒ£ãƒƒã‚·ãƒ¥ã®åˆ©ç”¨ MySQLã‚„Redisã®ã‚¯ã‚¨ãƒªã‚­ãƒ£ãƒƒã‚·ãƒ¥æ©Ÿèƒ½ã‚’åˆ©ç”¨ã™ã‚‹ï¼ãŸã ã—ï¼ŒMySQLã®ã‚¯ã‚¨ãƒªã‚­ãƒ£ãƒƒã‚·ãƒ¥æ©Ÿèƒ½ã¯ï¼Œãƒãƒ¼ã‚¸ãƒ§ãƒ³8ã§å»ƒæ­¢ã•ã‚Œã‚‹ã“ã¨ã«ãªã£ã¦ã„ã‚‹ï¼ ãƒ»ãƒ¦ãƒ‹ãƒ¼ã‚¯ã‚­ãƒ¼ã¾ãŸã¯ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã®åˆ©ç”¨ ã‚¹ãƒ­ãƒ¼ã‚¯ã‚¨ãƒªã‚’æ¤œå‡ºã—ï¼Œãã®SQLã§å¯¾è±¡ã¨ã—ã¦ã„ã‚‹ã‚«ãƒ©ãƒ ã«ãƒ¦ãƒ‹ãƒ¼ã‚¯ã‚­ãƒ¼ã‚„ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã‚’è¨­å®šã™ã‚‹ï¼ã‚¹ãƒ­ãƒ¼ã‚¯ã‚¨ãƒªã‚’æ¤œå‡ºã™ã‚‹æ–¹æ³•ã¨ã—ã¦ï¼ŒRDSã®long_query_timeãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã«åŸºã¥ã„ãŸæ¤œå‡ºã‚„ï¼ŒEXPLAINå¥ã«ã‚ˆã‚‹äºˆæƒ³å®Ÿè¡Œæ™‚é–“ã®æ¯”è¼ƒãªã©ãŒã‚ã‚‹ï¼ãƒ¦ãƒ‹ãƒ¼ã‚¯ã‚­ãƒ¼ï¼Œã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ï¼ŒEXPLAINå¥ï¼Œã«ã¤ã„ã¦ã¯ä»¥ä¸‹ã®ãƒªãƒ³ã‚¯ã‚’å‚è€ƒã«ã›ã‚ˆï¼ å‚è€ƒï¼šhttps://hiroki-it.github.io/tech-notebook-gitbook/public/backend_database_mysql.html ãƒ»ãƒ†ãƒ¼ãƒ–ãƒ«ã‚’æ­£è¦åŒ–ã—éããªã„ ãƒ†ãƒ¼ãƒ–ãƒ«ã‚’æ­£è¦åŒ–ã™ã‚‹ã¨ä¿å®ˆæ€§ãŒé«˜ã¾ã‚‹ãŒï¼Œã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®SQLã§JOINå¥ãŒå¿…è¦ã«ãªã‚‹ï¼ã—ã‹ã—ï¼ŒJOINå¥ã‚’å«ã‚€SQLã¯ï¼Œå«ã¾ãªã„SQLã¨æ¯”è¼ƒã—ã¦ï¼Œå®Ÿè¡Œé€Ÿåº¦ãŒé…ããªã‚‹ï¼ãã“ã§ï¼Œæˆ¦ç•¥çš„ã«æ­£è¦åŒ–ã—éããªã„ã‚ˆã†ã«ã™ã‚‹ï¼ ãƒ»ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚¿ã‚¤ãƒ—ã®ã‚¹ã‚±ãƒ¼ãƒ«ã‚¢ãƒƒãƒ— ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚¿ã‚¤ãƒ—ã‚’ã‚¹ã‚±ãƒ¼ãƒ«ã‚¢ãƒƒãƒ—ã•ã›ã‚‹ã“ã¨ã§ï¼Œæ¥ç¶šéå¤šã®ã‚¨ãƒ©ãƒ¼ï¼ˆERROR 1040 (HY000): Too many connectionsï¼‰ã«å¯¾å‡¦ã™ã‚‹ï¼ã¡ãªã¿ã«ç¾åœ¨ã®æœ€å¤§æ¥ç¶šæ•°ã¯ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚°ãƒ«ãƒ¼ãƒ—ã®å€¤ã‹ã‚‰ç¢ºèªã§ãã‚‹ï¼ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ç”»é¢ã‹ã‚‰ã¯ãŠãŠã‚ˆãã®å€¤ã—ã‹ã‚ã‹ã‚‰ãªã„ãŸã‚ï¼ŒSQLã§ç¢ºèªã—ãŸæ–¹ãŒè‰¯ã„ï¼ MySQL > SHOW GLOBAL VARIABLES LIKE 'max_connections'; +-----------------+-------+ | Variable_name | Value | +-----------------+-------+ | max_connections | 640 | +-----------------+-------+ 1 row in set (0.00 sec) éšœå®³å¯¾ç­– ãƒ»ãƒ•ã‚§ã‚¤ãƒ«ã‚ªãƒ¼ãƒãƒ¼ RDSã®ãƒ•ã‚§ã‚¤ãƒ«ã‚ªãƒ¼ãƒãƒ¼ã«ã¯ï¼Œãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®ç¨®é¡ã«å¿œã˜ã¦ï¼Œä»¥ä¸‹ã®ç¨®é¡ã®ã‚‚ã®ãŒã‚ã‚‹ï¼ãƒ•ã‚§ã‚¤ãƒ«ã‚ªãƒ¼ãƒãƒ¼æ™‚ã«ç´„1ï½2åˆ†ã®ãƒ€ã‚¦ãƒ³ã‚¿ã‚¤ãƒ ãŒç™ºç”Ÿã™ã‚‹ï¼ å‚è€ƒï¼šhttps://docs.aws.amazon.com/ja_jp/AmazonRDS/latest/UserGuide/Concepts.MultiAZ.html#Concepts.MultiAZ.Failover ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ ãƒ•ã‚§ã‚¤ãƒ«ã‚ªãƒ¼ãƒãƒ¼ã®ä»•çµ„ã¿ è£œè¶³ Aurora ãƒªãƒ¼ãƒ‰ãƒ¬ãƒ—ãƒªã‚«ãŒãƒ—ãƒ©ã‚¤ãƒãƒªã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã«æ˜‡æ ¼ã™ã‚‹ï¼ å‚è€ƒï¼šhttps://docs.aws.amazon.com/ja_jp/AmazonRDS/latest/AuroraUserGuide/Concepts.AuroraHighAvailability.html Auroraä»¥å¤– ã‚¹ã‚¿ãƒ³ãƒã‚¤ãƒ¬ãƒ—ãƒªã‚«ãŒãƒ—ãƒ©ã‚¤ãƒãƒªã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã«æ˜‡æ ¼ã™ã‚‹ï¼ å‚è€ƒï¼šhttps://docs.aws.amazon.com/ja_jp/AmazonRDS/latest/UserGuide/Concepts.MultiAZ.html Auroraã®å ´åˆï¼Œãƒ•ã‚§ã‚¤ãƒ«ã‚ªãƒ¼ãƒãƒ¼ã«ã‚ˆã£ã¦æ˜‡æ ¼ã™ã‚‹ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã¯æ¬¡ã®é †ç•ªã§æ±ºå®šã•ã‚Œã‚‹ï¼åŸºæœ¬çš„ã«ã¯ï¼Œå„ªå…ˆåº¦ã®æ•°å€¤ã®å°ã•ã„ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ãŒæ˜‡æ ¼å¯¾è±¡ã«ãªã‚‹ï¼å„ªå…ˆåº¦ãŒåŒã˜ã ã¨ï¼Œã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚¯ãƒ©ã‚¹ãŒå¤§ãã„ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ãŒæ˜‡æ ¼å¯¾è±¡ã«ãªã‚‹ï¼ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚¯ãƒ©ã‚¹ãŒåŒã˜ã ã¨ï¼ŒåŒã˜ã‚µãƒ–ãƒãƒƒãƒˆã«ã‚ã‚‹ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ãŒæ˜‡æ ¼å¯¾è±¡ã«ãªã‚‹ï¼ å„ªå…ˆåº¦ã®é †ç•ª ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚¯ãƒ©ã‚¹ã®å¤§ãã• åŒã˜ã‚µãƒ–ãƒãƒƒãƒˆ ãƒ»ã‚¨ãƒ³ã‚¸ãƒ³ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰æ™‚ã®äº‹å‰èª¿æŸ» ã‚¨ãƒ³ã‚¸ãƒ³ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã®ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰æ™‚ï¼Œãƒ€ã‚¦ãƒ³ã‚¿ã‚¤ãƒ ãŒç™ºç”Ÿã™ã‚‹ï¼ãã®ãŸã‚ï¼Œä»¥ä¸‹ã®ã‚ˆã†ãªå ±å‘Šæ›¸ã®ã‚‚ã¨ï¼Œèª¿æŸ»ã¨å¯¾å¿œã‚’è¡Œã†ï¼ å‚è€ƒï¼šhttps://docs.aws.amazon.com/ja_jp/AmazonRDS/latest/AuroraUserGuide/AuroraMySQL.Updates.html ã¾ãŸãƒãƒ¼ã‚¸ã•ã‚Œã‚‹å†…å®¹ã®èª¿æŸ»ã®ãŸã‚ï¼Œãƒªãƒªãƒ¼ã‚¹ãƒãƒ¼ãƒˆã®ç¢ºèªãŒå¿…è¦ã«ãªã‚‹ï¼ å‚è€ƒï¼šhttps://docs.aws.amazon.com/ja_jp/AmazonRDS/latest/AuroraUserGuide/AuroraMySQL.Updates.11Updates.html # èª¿æŸ» ## ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã®é•ã„ ã€SELECT AURORA_VERSION()ã€ã‚’ä½¿ç”¨ã—ã¦ï¼Œæ­£ç¢ºãªãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’å–å¾—ã™ã‚‹ï¼ ## ãƒãƒ¼ã‚¸ã•ã‚Œã‚‹å†…å®¹ ãƒ™ãƒ³ãƒ€ãƒ¼ã®ãƒªãƒªãƒ¼ã‚¹ãƒãƒ¼ãƒˆã‚’ç¢ºèªã—ï¼Œã©ã®ã‚ˆã†ãªã€æ©Ÿèƒ½è¿½åŠ ã€ã€ãƒã‚°ä¿®æ­£ã€ã€æ©Ÿèƒ½å»ƒæ­¢ã€ã€éæ¨å¥¨æ©Ÿèƒ½ã€ãŒãƒãƒ¼ã‚¸ã•ã‚Œã‚‹ã‹ã‚’èª¿æŸ»ã™ã‚‹ï¼ æ©Ÿèƒ½å»ƒæ­¢ã‚„éæ¨å¥¨æ©Ÿèƒ½ãŒã‚ã‚‹å ´åˆï¼Œã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å†…ã®SQLæ–‡ã«å½±éŸ¿ãŒå‡ºã‚‹å¯èƒ½æ€§ãŒã‚ã‚‹ï¼ ## æƒ³å®šã•ã‚Œã‚‹ãƒ€ã‚¦ãƒ³ã‚¿ã‚¤ãƒ  ãƒ†ã‚¹ãƒˆç’°å¢ƒã§ãƒ€ã‚¦ãƒ³ã‚¿ã‚¤ãƒ ã‚’è¨ˆæ¸¬ã—ï¼Œãƒ€ã‚¦ãƒ³ã‚¿ã‚¤ãƒ ã‚’æƒ³å®šã™ã‚‹ï¼ # æœ¬ç•ªç’°å¢ƒå¯¾å¿œ ## æ—¥æ™‚ã¨å‘¨çŸ¥ å¯¾å¿œæ—¥æ™‚ã¨å‘¨çŸ¥å†…å®¹ã‚’æ±ºå®šã™ã‚‹ï¼ ## æƒ³å®šå¤–ã®çµæœ æœ¬ç•ªç’°å¢ƒã§ã®å¯¾å¿œã§èµ·ã“ã£ãŸæƒ³å®šå¤–ã®çµæœã‚’è¨˜è¼‰ã™ã‚‹ï¼ ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ ãƒ»é…ç½®ã•ã‚Œã‚‹ã‚µãƒ–ãƒãƒƒãƒˆ ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãŒé…ç½®ã•ã‚Œã‚‹ã‚µãƒ–ãƒãƒƒãƒˆã¯ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆã‚µãƒ–ãƒãƒƒãƒˆã«ã™ã‚‹ï¼Œã“ã‚Œã«ã¯ï¼Œdata storeã‚µãƒ–ãƒãƒƒãƒˆã¨åä»˜ã‘ã‚‹ï¼ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ä»¥å¤–ã¯ï¼Œè¸ã¿å°ã‚µãƒ¼ãƒçµŒç”±ã§ã—ã‹ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã«ã‚¢ã‚¯ã‚»ã‚¹ã§ããªã„ã‚ˆã†ã«ã™ã‚‹ï¼ ãƒ»ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚°ãƒ«ãƒ¼ãƒ— ã‚³ãƒ³ãƒ”ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã‹ã‚‰ã®ã‚¤ãƒ³ãƒã‚¦ãƒ³ãƒ‰é€šä¿¡ã®ã¿ã‚’è¨±å¯ã™ã‚‹ã‚ˆã†ã«ï¼Œã“ã‚Œã‚‰ã®ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆIPã‚¢ãƒ‰ãƒ¬ã‚¹ï¼ˆn.n.n.n/32ï¼‰ã‚’è¨­å®šã™ã‚‹ï¼ 23. Regionã¨Zone Region ãƒ»Regionã¨ã¯ ç‰©ç†ã‚µãƒ¼ãƒã®ã‚ã‚‹ãƒ‡ãƒ¼ã‚¿ã‚»ãƒ³ã‚¿ãƒ¼ã®åœ°åŸŸåã®ã“ã¨ï¼ ãƒ»Globalã¨ã‚¨ãƒƒã‚¸ãƒ­ã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã¨ã¯ Regionã¨ã¯åˆ¥ã«ï¼Œç‰©ç†ã‚µãƒ¼ãƒãŒä¸–ç•Œä¸­ã«ã‚ã‚Šï¼Œã“ã‚Œã‚‰ã®é–“ã§ã¯ã‚°ãƒ­ãƒ¼ãƒãƒ«ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ãŒæ§‹ç¯‰ã•ã‚Œã¦ã„ã‚‹ï¼ãã®ãŸã‚ï¼ŒGlobalãªã‚µãƒ¼ãƒ“ã‚¹ã¯ï¼Œç‰¹å®šã®Regionã«ä¾å­˜ã›ãšã«ï¼Œå…¨ã¦ã®Regionã¨é€£æºã§ãã‚‹ï¼ 24. Route53 Route53ã¨ã¯ ã‚¯ãƒ©ã‚¦ãƒ‰DNSã‚µãƒ¼ãƒãƒ¼ã¨ã—ã¦åƒãï¼ãƒªã‚¯ã‚¨ã‚¹ãƒˆã•ã‚ŒãŸå®Œå…¨ä¿®é£¾ãƒ‰ãƒ¡ã‚¤ãƒ³åã¨EC2ã®ã‚°ãƒ­ãƒ¼ãƒãƒ«IPã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’ãƒãƒƒãƒ”ãƒ³ã‚°ã—ã¦ã„ã‚‹ï¼ è¨­å®šé …ç›® ãƒ»æ¦‚è¦ è¨­å®šé …ç›® èª¬æ˜ ãƒ›ã‚¹ãƒˆã‚¾ãƒ¼ãƒ³ ãƒ‰ãƒ¡ã‚¤ãƒ³åã‚’è¨­å®šã™ã‚‹ï¼ ãƒ¬ã‚³ãƒ¼ãƒ‰ã‚»ãƒƒãƒˆ åå‰è§£æ±ºæ™‚ã®ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°æ–¹æ³•ã‚’è¨­å®šã™ã‚‹ï¼ã‚µãƒ–ãƒ‰ãƒ¡ã‚¤ãƒ³åã‚’æ‰±ã†ã“ã¨ã‚‚å¯èƒ½ï¼ ãƒ›ã‚¹ãƒˆã‚¾ãƒ¼ãƒ³ ãƒ»ãƒ¬ã‚³ãƒ¼ãƒ‰ã‚¿ã‚¤ãƒ—ã®è¨­å®šå€¤ã®é•ã„ ãƒ¬ã‚³ãƒ¼ãƒ‰ã‚¿ã‚¤ãƒ— è£œè¶³ NS IPã‚¢ãƒ‰ãƒ¬ã‚¹ã®å•ã„åˆã‚ã›ã«å¿œãˆã‚‰ã‚Œã‚‹æ¨©å¨DNSã‚µãƒ¼ãƒã®åå‰ãŒå®šç¾©ã•ã‚Œã¦ã„ã‚‹ï¼ A ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’è»¢é€ã—ãŸã„AWSãƒªã‚½ãƒ¼ã‚¹ã®ï¼ŒIPv4ã‚¢ãƒ‰ãƒ¬ã‚¹ã¾ãŸã¯DNSåã‚’è¨­å®šã™ã‚‹ï¼ AAAA ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’è»¢é€ã—ãŸã„AWSãƒªã‚½ãƒ¼ã‚¹ã®ï¼ŒIPv6ã‚¢ãƒ‰ãƒ¬ã‚¹ã¾ãŸã¯DNSåã‚’è¨­å®šã™ã‚‹ï¼ CNAME ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’è»¢é€ã—ãŸã„ä»»æ„ã®ã‚µãƒ¼ãƒã®ãƒ‰ãƒ¡ã‚¤ãƒ³åã‚’è¨­å®šã™ã‚‹ï¼ è»¢é€å…ˆã¯AWSãƒªã‚½ãƒ¼ã‚¹ã§ãªãã¨ã‚‚ã‚ˆã„ï¼ MX ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’è»¢é€ã—ãŸã„ãƒ¡ãƒ¼ãƒ«ã‚µãƒ¼ãƒã®ãƒ‰ãƒ¡ã‚¤ãƒ³åã‚’è¨­å®šã™ã‚‹ï¼ TXT ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’è»¢é€ã—ãŸã„ã‚µãƒ¼ãƒã®ãƒ‰ãƒ¡ã‚¤ãƒ³åã«ç´ä»˜ã‘ã‚‰ã‚ŒãŸæ–‡å­—åˆ—ã‚’è¨­å®šã™ã‚‹ï¼ ãƒ»ãƒªã‚½ãƒ¼ã‚¹ã®DNSåï¼Œãƒ‰ãƒ¡ã‚¤ãƒ³åï¼Œã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆå ãƒªã‚½ãƒ¼ã‚¹ã®DNSåã¯ï¼Œä»¥ä¸‹ã®æ§˜ã«æ±ºå®šã•ã‚Œã‚‹ï¼ ç¨®åˆ¥ ãƒªã‚½ãƒ¼ã‚¹ ä¾‹ DNSå ALB -..elb.amazonaws.com EC2 ec2-..compute.amazonaws.com ãƒ‰ãƒ¡ã‚¤ãƒ³å CloudFront .cloudfront.net ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆå S3 ..amazonaws.com ãƒ»ãƒ¬ã‚³ãƒ¼ãƒ‰ã‚¿ã‚¤ãƒ—ã®åå‰è§£æ±ºæ–¹æ³•ã®é•ã„ ãƒ¬ã‚³ãƒ¼ãƒ‰ã‚¿ã‚¤ãƒ— åå‰è§£æ±ºæ–¹æ³•ï¼ˆ1ï¼‰ ï¼ˆ2ï¼‰ ï¼ˆ3ï¼‰ A å®Œå…¨ä¿®é£¾ãƒ‰ãƒ¡ã‚¤ãƒ³å â†’ ãƒ‘ãƒ–ãƒªãƒƒã‚¯IPv4 â†’ - AAAA å®Œå…¨ä¿®é£¾ãƒ‰ãƒ¡ã‚¤ãƒ³å â†’ ãƒ‘ãƒ–ãƒªãƒƒã‚¯IPv6 â†’ - CNAME å®Œå…¨ä¿®é£¾ãƒ‰ãƒ¡ã‚¤ãƒ³å â†’ ï¼ˆãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆï¼‰ â†’ ãƒ‘ãƒ–ãƒªãƒƒã‚¯IPv4 ãƒ»CloudFrontã¸ã®ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚° CloudFrontã«ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã™ã‚‹å ´åˆï¼ŒCloudFrontã®CNAMEã‚’ãƒ¬ã‚³ãƒ¼ãƒ‰åã¨ã™ã‚‹ã¨ï¼ŒCloudFrontã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆãƒ‰ãƒ¡ã‚¤ãƒ³åï¼ˆxxxxx.cloudfront.net.ï¼‰ãŒï¼Œå…¥åŠ›ãƒ•ã‚©ãƒ¼ãƒ ã«è¡¨ç¤ºã•ã‚Œã‚‹ã‚ˆã†ã«ãªã‚‹ï¼ ãƒ»Route53ã‚’å«ã‚€å¤šæ•°ã®DNSã‚µãƒ¼ãƒã«ã‚ˆã£ã¦åå‰è§£æ±ºã•ã‚Œã‚‹ä»•çµ„ã¿ === ï¼ˆ1ï¼‰å®Œå…¨ä¿®é£¾ãƒ‰ãƒ¡ã‚¤ãƒ³åã«å¯¾å¿œã™ã‚‹IPã‚¢ãƒ‰ãƒ¬ã‚¹ã®ãƒ¬ã‚¹ãƒãƒ³ã‚¹ === ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆPCã¯ï¼Œè‡ªèº«ã«ä¿å­˜ã•ã‚Œã‚‹www.example.jpï¼ˆå®Œå…¨ä¿®é£¾ãƒ‰ãƒ¡ã‚¤ãƒ³åï¼‰ã®ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’æ¤œç´¢ã™ã‚‹ï¼ ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãŒç„¡ã‘ã‚Œã°ï¼Œã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆPCã¯www.example.jpã‚’ï¼Œãƒ•ã‚©ãƒ¯ãƒ¼ãƒ‰ãƒ—ãƒ­ã‚­ã‚·ã‚µãƒ¼ãƒï¼ˆã‚­ãƒ£ãƒƒã‚·ãƒ¥DNSã‚µãƒ¼ãƒï¼‰ã«ãƒªã‚¯ã‚¨ã‚¹ãƒˆï¼ ãƒ•ã‚©ãƒ¯ãƒ¼ãƒ‰ãƒ—ãƒ­ã‚­ã‚·ã‚µãƒ¼ãƒã¯ï¼ŒDNSã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’æ¤œç´¢ã™ã‚‹ï¼ ãƒ•ã‚©ãƒ¯ãƒ¼ãƒ‰ãƒ—ãƒ­ã‚­ã‚·ã‚µãƒ¼ãƒã¯ï¼Œãƒ«ãƒ¼ãƒˆDNSã‚µãƒ¼ãƒã«www.example.jpã®IPã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’å•ã„åˆã‚ã›ã‚‹ï¼ ãƒ«ãƒ¼ãƒˆDNSã‚µãƒ¼ãƒã¯ï¼ŒNSãƒ¬ã‚³ãƒ¼ãƒ‰ã¨ã—ã¦å®šç¾©ã•ã‚ŒãŸæ¨©å¨DNSã‚µãƒ¼ãƒåã‚’ãƒ¬ã‚¹ãƒãƒ³ã‚¹ï¼ ãƒ•ã‚©ãƒ¯ãƒ¼ãƒ‰ãƒ—ãƒ­ã‚­ã‚·ã‚µãƒ¼ãƒã¯ï¼Œwww.example.jpã‚’ï¼Œãƒªãƒãƒ¼ã‚¹ãƒ—ãƒ­ã‚­ã‚·ã‚µãƒ¼ãƒã«ä»£ç†ãƒªã‚¯ã‚¨ã‚¹ãƒˆï¼æ¬¡ã„ã§ï¼Œãƒªãƒãƒ¼ã‚¹ãƒ—ãƒ­ã‚­ã‚·ã‚µãƒ¼ãƒã¯ï¼ŒDNSã‚µãƒ¼ãƒï¼ˆãƒãƒ¼ãƒ ã‚µãƒ¼ãƒï¼‰ã«www.example.jpã®IPã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’å•ã„åˆã‚ã›ã‚‹ï¼ DNSã‚µãƒ¼ãƒã¯ï¼ŒNSãƒ¬ã‚³ãƒ¼ãƒ‰ã¨ã—ã¦å®šç¾©ã•ã‚ŒãŸæ¨©å¨DNSã‚µãƒ¼ãƒåã‚’ãƒ¬ã‚¹ãƒãƒ³ã‚¹ï¼ ãƒ•ã‚©ãƒ¯ãƒ¼ãƒ‰ãƒ—ãƒ­ã‚­ã‚·ã‚µãƒ¼ãƒã¯ï¼Œwww.example.jpã‚’ï¼Œãƒªãƒãƒ¼ã‚¹ãƒ—ãƒ­ã‚­ã‚·ã‚µãƒ¼ãƒã«ä»£ç†ãƒªã‚¯ã‚¨ã‚¹ãƒˆï¼æ¬¡ã„ã§ï¼Œãƒªãƒãƒ¼ã‚¹ãƒ—ãƒ­ã‚­ã‚·ã‚µãƒ¼ãƒã¯ï¼Œã‚°ãƒ­ãƒ¼ãƒãƒ«ãƒªãƒ¼ã‚¸ãƒ§ãƒ³Route53ã«www.example.jpã®IPã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’å•ã„åˆã‚ã›ã‚‹ï¼ ã‚°ãƒ­ãƒ¼ãƒãƒ«ãƒªãƒ¼ã‚¸ãƒ§ãƒ³Route53ã¯DNSã‚µãƒ¼ãƒã¨ã—ã¦æ©Ÿèƒ½ã—ï¼Œãƒªãƒãƒ¼ã‚¹ãƒ—ãƒ­ã‚­ã‚·ã‚µãƒ¼ãƒã«æ±äº¬ãƒªãƒ¼ã‚¸ãƒ§ãƒ³ALBã®IPã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’ãƒ¬ã‚¹ãƒãƒ³ã‚¹ï¼æ¬¡ã„ã§ï¼Œãƒªãƒãƒ¼ã‚¹ãƒ—ãƒ­ã‚­ã‚·ã‚µãƒ¼ãƒã¯ï¼Œæ±äº¬ãƒªãƒ¼ã‚¸ãƒ§ãƒ³ALBã®IPã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’ï¼Œãƒ•ã‚©ãƒ¯ãƒ¼ãƒ‰ãƒ—ãƒ­ã‚­ã‚·ã‚µãƒ¼ãƒã«ä»£ç†ãƒ¬ã‚¹ãƒãƒ³ã‚¹ï¼ï¼ˆâ€» NATã«ã‚ˆã‚‹IPã‚¢ãƒ‰ãƒ¬ã‚¹ã®ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯é–“å¤‰æ›ãŒèµ·ã“ã‚‹ï¼‰ å®Œå…¨ä¿®é£¾ãƒ‰ãƒ¡ã‚¤ãƒ³å Route53 IPv4ã‚¢ãƒ‰ãƒ¬ã‚¹ http://www.example.com â‡„ 203.142.205.139 ãƒ•ã‚©ãƒ¯ãƒ¼ãƒ‰ãƒ—ãƒ­ã‚­ã‚·ã‚µãƒ¼ãƒã¯ï¼Œæ±äº¬ãƒªãƒ¼ã‚¸ãƒ§ãƒ³ALBã®IPã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’ï¼Œã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆPCã«ä»£ç†ãƒ¬ã‚¹ãƒãƒ³ã‚¹ï¼ ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆPCã¯æ±äº¬ãƒªãƒ¼ã‚¸ãƒ§ãƒ³ALBã®IPã‚¢ãƒ‰ãƒ¬ã‚¹ã«ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é€ä¿¡ã™ã‚‹ï¼ === ï¼ˆ2ï¼‰æ±äº¬ãƒªãƒ¼ã‚¸ãƒ§ãƒ³ALBã®IPã‚¢ãƒ‰ãƒ¬ã‚¹ã«å¯¾å¿œã™ã‚‹Webãƒšãƒ¼ã‚¸ã®ãƒ¬ã‚¹ãƒãƒ³ã‚¹ === ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆPCã¯ï¼Œãƒ¬ã‚¹ãƒãƒ³ã‚¹ã•ã‚ŒãŸæ±äº¬ãƒªãƒ¼ã‚¸ãƒ§ãƒ³ALBã®IPã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’åŸºã«ï¼ŒWebãƒšãƒ¼ã‚¸ã‚’ï¼Œãƒªãƒãƒ¼ã‚¹ãƒ—ãƒ­ã‚­ã‚·ã‚µãƒ¼ãƒã«ãƒªã‚¯ã‚¨ã‚¹ãƒˆï¼ ãƒªãƒãƒ¼ã‚¹ãƒ—ãƒ­ã‚­ã‚·ã‚µãƒ¼ãƒã¯ï¼ŒWebãƒšãƒ¼ã‚¸ã‚’ï¼Œæ±äº¬ãƒªãƒ¼ã‚¸ãƒ§ãƒ³ALBã«ä»£ç†ãƒªã‚¯ã‚¨ã‚¹ãƒˆï¼ æ±äº¬ãƒªãƒ¼ã‚¸ãƒ§ãƒ³ALBã¯ï¼ŒEC2ã‚„Fargateã«ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’è»¢é€ã™ã‚‹ï¼ EC2ã‚„Fargateã¯ï¼ŒWebãƒšãƒ¼ã‚¸ã‚’ãƒªãƒãƒ¼ã‚¹ãƒ—ãƒ­ã‚­ã‚·ã‚µãƒ¼ãƒã«ãƒ¬ã‚¹ãƒãƒ³ã‚¹ï¼ ãƒªãƒãƒ¼ã‚¹ãƒ—ãƒ­ã‚­ã‚·ã‚µãƒ¼ãƒã¯ï¼ŒWebãƒšãƒ¼ã‚¸ã‚’ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆPCã«ä»£ç†ãƒ¬ã‚¹ãƒãƒ³ã‚¹ï¼ ãƒ»AWSä»¥å¤–ã§ãƒ‰ãƒ¡ã‚¤ãƒ³ã‚’è³¼å…¥ã—ãŸå ´åˆ DNSã‚µãƒ¼ãƒã«ã‚ˆã‚‹åå‰è§£æ±ºã¯ï¼Œãƒ‰ãƒ¡ã‚¤ãƒ³ã‚’è³¼å…¥ã—ãŸãƒ‰ãƒ¡ã‚¤ãƒ³ãƒ¬ã‚¸ã‚¹ãƒˆãƒ©ã§è¡Œã‚ã‚Œã‚‹ï¼ãã®ãŸã‚ï¼ŒAWSä»¥å¤–ã§ãƒ‰ãƒ¡ã‚¤ãƒ³ã‚’è³¼å…¥ã—ãŸå ´åˆï¼ŒRoute53ã®NSãƒ¬ã‚³ãƒ¼ãƒ‰å€¤ã‚’ï¼Œãƒ‰ãƒ¡ã‚¤ãƒ³ãƒ¬ã‚¸ã‚¹ãƒˆãƒ©ã«ç™»éŒ²ã™ã‚‹å¿…è¦ãŒã‚ã‚‹ï¼ã“ã‚Œã«ã‚ˆã‚Šï¼Œãƒ‰ãƒ¡ã‚¤ãƒ³ãƒ¬ã‚¸ã‚¹ãƒˆãƒ©ã«å¯¾ã—ã¦IPã‚¢ãƒ‰ãƒ¬ã‚¹ã®å•ã„åˆã‚ã›ãŒã‚ã£ãŸå ´åˆã¯ï¼ŒRoute53ã®NSãƒ¬ã‚³ãƒ¼ãƒ‰å€¤ãŒãƒ¬ã‚¹ãƒãƒ³ã‚¹ã•ã‚Œã‚‹ã‚ˆã†ã«ãªã‚‹ï¼NSãƒ¬ã‚³ãƒ¼ãƒ‰å€¤ã‚’å…ƒã«ï¼Œã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã¯Route53ã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ï¼ ãƒ»Route53ã«ãŠã‘ã‚‹DNSã‚­ãƒ£ãƒƒã‚·ãƒ¥ ãƒ«ãƒ¼ãƒˆã‚µãƒ¼ãƒã¯ä¸–ç•Œã«13æ©Ÿã—ã‹å­˜åœ¨ã—ã¦ãŠã‚‰ãšï¼Œä¸–ç•Œä¸­ã®åå‰è§£æ±ºã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’å…¨ã¦å‡¦ç†ã™ã‚‹ã“ã¨ã¯ç¾å®Ÿçš„ã«ä¸å¯èƒ½ã§ã‚ã‚‹ï¼ãã“ã§ï¼ŒIPã‚¢ãƒ‰ãƒ¬ã‚¹ã¨ãƒ‰ãƒ¡ã‚¤ãƒ³åã®é–¢ä¿‚ã‚’ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã™ã‚‹ãƒ—ãƒ­ã‚­ã‚·ã‚µãƒ¼ãƒï¼ˆã‚­ãƒ£ãƒƒã‚·ãƒ¥DNSã‚µãƒ¼ãƒï¼‰ãŒä½¿ç”¨ã•ã‚Œã¦ã„ã‚‹ï¼åŸºæœ¬çš„ã«ã¯ï¼Œãƒ—ãƒ­ã‚­ã‚·ã‚µãƒ¼ãƒã¨DNSã‚µãƒ¼ãƒã¯åŒºåˆ¥ã•ã‚Œã‚‹ãŒï¼ŒRoute53ã¯ãƒ—ãƒ­ã‚­ã‚·ã‚µãƒ¼ãƒã¨DNSã‚µãƒ¼ãƒã®æ©Ÿèƒ½ã‚’ä¸¡ç«‹ã—ã¦ã„ã‚‹ï¼ ãƒªã‚¾ãƒ«ãƒãƒ¼ ãƒ»ãƒªã‚¾ãƒ«ãƒãƒ¼ã¨ã¯ è¦å‹‰å¼·ï¼ 25. S3ï¼šSimple Storage Service S3ã¨ã¯ ã‚¯ãƒ©ã‚¦ãƒ‰å¤–ä»˜ã‘ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã¨ã—ã¦åƒãï¼S3ã«ä¿å­˜ã™ã‚‹CSSãƒ•ã‚¡ã‚¤ãƒ«ã‚„ç”»åƒãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç®¡ç†ã§ãã‚‹ï¼ è¨­å®šé …ç›® ãƒ»æ¦‚è¦ è¨­å®šé …ç›® èª¬æ˜ ãƒã‚±ãƒƒãƒˆ ãƒã‚±ãƒƒãƒˆã«é–¢ã—ã¦è¨­å®šã™ã‚‹ï¼ ãƒãƒƒãƒã‚ªãƒšãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ ã‚¢ã‚¯ã‚»ã‚¹ã‚¢ãƒŠãƒ©ã‚¤ã‚¶ãƒ¼ ãƒ»ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ è¨­å®šé …ç›® èª¬æ˜ è£œè¶³ ãƒãƒ¼ã‚¸ãƒ§ãƒ‹ãƒ³ã‚° ã‚µãƒ¼ãƒã‚¢ã‚¯ã‚»ã‚¹ã®ãƒ­ã‚°è¨˜éŒ² é™çš„ã‚µã‚¤ãƒˆãƒ›ã‚¹ãƒ†ã‚£ãƒ³ã‚° ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆãƒ¬ãƒ™ãƒ«ã®ãƒ­ã‚°è¨˜éŒ² ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆæš—å·åŒ– ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®ãƒ­ãƒƒã‚¯ Transfer acceleration ã‚¤ãƒ™ãƒ³ãƒˆ ãƒªã‚¯ã‚¨ã‚¹ã‚¿æ”¯æ‰•ã„ ãƒ»å¤–éƒ¨ï¼å†…éƒ¨ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‹ã‚‰ã®ã‚¢ã‚¯ã‚»ã‚¹åˆ¶é™ è¨­å®šé …ç›® èª¬æ˜ è£œè¶³ ãƒ–ãƒ­ãƒƒã‚¯ãƒ‘ãƒ–ãƒªãƒƒã‚¯ã‚¢ã‚¯ã‚»ã‚¹ ãƒ‘ãƒ–ãƒªãƒƒã‚¯ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ãŒS3ã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹æ™‚ã®è¨±å¦ã‚’è¨­å®šã™ã‚‹ï¼ ãƒ»ãƒ‘ãƒ–ãƒªãƒƒã‚¯ã‚¢ã‚¯ã‚»ã‚¹ã‚’æœ‰åŠ¹ã«ã™ã‚‹ã¨ï¼Œãƒ‘ãƒ–ãƒªãƒƒã‚¯ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‹ã‚‰ã€https://.s3.amazonaws.comã€ã¨ã„ã†ã‚ˆã†ã«URLã‚’æŒ‡å®šã—ã¦ï¼ŒS3ã«ã‚¢ã‚¯ã‚»ã‚¹ã§ãã‚‹ã‚ˆã†ã«ãªã‚‹ï¼ãŸã ã—éæ¨å¥¨ï¼ãƒ»ãƒ‘ãƒ–ãƒªãƒƒã‚¯ã‚¢ã‚¯ã‚»ã‚¹ã‚’å…¨ã¦ç„¡åŠ¹ã«ã™ã‚‹ã¨ï¼Œãƒ‘ãƒ–ãƒªãƒƒã‚¯ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‹ã‚‰ã®å…¨ã‚¢ã‚¯ã‚»ã‚¹ã‚’é®æ–­ã§ãã‚‹ï¼ãƒ»ç‰¹å®šã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã§ï¼Œã‚¢ã‚¯ã‚»ã‚¹ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ãƒªã‚¹ãƒˆã‚’åˆ¶é™ã—ãŸå ´åˆï¼Œãã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã ã‘ã¯ãƒ‘ãƒ–ãƒªãƒƒã‚¯ã‚¢ã‚¯ã‚»ã‚¹ã«ãªã‚‰ãªã„ï¼ ãƒã‚±ãƒƒãƒˆãƒãƒªã‚·ãƒ¼ IAMãƒ¦ãƒ¼ã‚¶ï¼ˆã‚¯ãƒ­ã‚¹ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚‚å¯ï¼‰ã¾ãŸã¯AWSãƒªã‚½ãƒ¼ã‚¹ãŒS3ã¸ã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ãŸã‚ã®ãƒãƒªã‚·ãƒ¼ã§ç®¡ç†ã™ã‚‹ï¼ ãƒ»IAMãƒ¦ãƒ¼ã‚¶ï¼ˆã‚¯ãƒ­ã‚¹ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚‚å¯ï¼‰ã‚„AWSãƒªã‚½ãƒ¼ã‚¹ãŒS3ã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ãŸã‚ã«å¿…è¦ã§ã‚ã‚‹ï¼ãŸã ã—ä»£ã‚ã‚Šã«ï¼ŒIAMãƒãƒªã‚·ãƒ¼ã‚’AWSãƒªã‚½ãƒ¼ã‚¹ã«ã‚¢ã‚¿ãƒƒãƒã™ã‚‹ã“ã¨ã§ã‚‚ï¼Œã‚¢ã‚¯ã‚»ã‚¹ã‚’è¨±å¯ã§ãã‚‹ï¼ãƒ»ãƒãƒªã‚·ãƒ¼ã‚’ã‚¢ã‚¿ãƒƒãƒã§ããªã„CloudFrontã‚„ALBãªã©ã§ã¯ï¼Œè‡ªèº«ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹ãƒ­ã‚°ã‚’ç”Ÿæˆã™ã‚‹ãŸã‚ã«å¿…é ˆã§ã‚ã‚‹ï¼ ã‚¢ã‚¯ã‚»ã‚¹ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ãƒªã‚¹ãƒˆ IAMãƒ¦ãƒ¼ã‚¶ï¼ˆã‚¯ãƒ­ã‚¹ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚‚å¯ï¼‰ãŒS3ã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹æ™‚ã®è¨±å¦ã‚’è¨­å®šã™ã‚‹ï¼ ãƒ»ãƒã‚±ãƒƒãƒˆãƒãƒªã‚·ãƒ¼ã¨æ©Ÿèƒ½ãŒé‡è¤‡ã™ã‚‹ï¼ãƒ»ä»®ã«ãƒã‚±ãƒƒãƒˆè‡ªä½“ã®ãƒ–ãƒ­ãƒƒã‚¯ãƒ‘ãƒ–ãƒªãƒƒã‚¯ã‚¢ã‚¯ã‚»ã‚¹ã‚’ç„¡åŠ¹åŒ–ã—ãŸã¨ã—ã¦ã‚‚ï¼Œç‰¹å®šã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã§ã‚¢ã‚¯ã‚»ã‚¹ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ãƒªã‚¹ãƒˆã‚’åˆ¶é™ã—ãŸå ´åˆï¼Œãã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã ã‘ã¯ãƒ‘ãƒ–ãƒªãƒƒã‚¯ã‚¢ã‚¯ã‚»ã‚¹ã«ãªã‚‰ãªã„ï¼ CORSã®è¨­å®š ãƒ¬ã‚¹ãƒãƒ³ã‚¹ãƒ˜ãƒƒãƒ€ãƒ¼ ãƒ»ãƒ¬ã‚¹ãƒãƒ³ã‚¹ãƒ˜ãƒƒãƒ€ãƒ¼ã®è¨­å®š ãƒ¬ã‚¹ãƒãƒ³ã‚¹ãƒ˜ãƒƒãƒ€ãƒ¼ã«åŸ‹ã‚è¾¼ã‚€HTTPãƒ˜ãƒƒãƒ€ãƒ¼ã‚’ï¼Œãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã¨ã—ã¦è¨­å®šã™ã‚‹ï¼ è¨­å®šå¯èƒ½ãªãƒ˜ãƒƒãƒ€ãƒ¼ èª¬æ˜ è£œè¶³ ETag ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã®ä¸€æ„ãªè­˜åˆ¥å­ï¼ãƒ–ãƒ©ã‚¦ã‚¶ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã®æ¤œè¨¼ã«ä½¿ç”¨ã•ã‚Œã‚‹ï¼ å…¨ã¦ã®ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã«ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§è¨­å®šã•ã‚Œã¦ã„ã‚‹ï¼ Cache-Control Expiresã¨åŒæ§˜ã«ï¼Œãƒ–ãƒ©ã‚¦ã‚¶ã«ãŠã‘ã‚‹ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã®æœ‰åŠ¹æœŸé™ã‚’è¨­å®šã™ã‚‹ï¼ å…¨ã¦ã®ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã«ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§è¨­å®šã•ã‚Œã¦ã„ã‚‹ï¼ Content-Type ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã®MIMEã‚¿ã‚¤ãƒ—ã‚’è¨­å®šã™ã‚‹ï¼ å…¨ã¦ã®ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã«ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§è¨­å®šã•ã‚Œã¦ã„ã‚‹ï¼ Expires Cache-Controlã¨åŒæ§˜ã«ï¼Œãƒ–ãƒ©ã‚¦ã‚¶ã«ãŠã‘ã‚‹ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã®æœ‰åŠ¹æœŸé™ã‚’è¨­å®šã™ã‚‹ï¼ãŸã ã—ï¼ŒCache-Controlã®æ–¹ãŒå„ªå…ˆåº¦ãŒé«˜ã„ï¼ Content-Disposition Content-Encoding x-amz-website-redirect-location ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã®ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆå…ˆã‚’è¨­å®šã™ã‚‹ï¼ ãƒã‚±ãƒƒãƒˆãƒãƒªã‚·ãƒ¼ã®ä¾‹ ãƒ»S3ã®ARNã«ã¤ã„ã¦ ãƒãƒªã‚·ãƒ¼ã«ãŠã„ã¦ï¼ŒS3ã®ARã§ã¯ï¼Œã€arn:aws:s3:::/*ã€ã®ã‚ˆã†ã«ï¼Œæœ€å¾Œã«ãƒãƒƒã‚¯ã‚¹ãƒ©ãƒƒã‚·ãƒ¥ã‚¢ã‚¹ã‚¿ãƒªã‚¹ã‚¯ãŒå¿…è¦ï¼ ãƒ»ALBã®ã‚¢ã‚¯ã‚»ã‚¹ãƒ­ã‚°ã®ä¿å­˜ã‚’è¨±å¯ ãƒ‘ãƒ–ãƒªãƒƒã‚¯ã‚¢ã‚¯ã‚»ã‚¹ãŒç„¡åŠ¹åŒ–ã•ã‚ŒãŸS3ã«å¯¾ã—ã¦ï¼ŒALBã¸ã®ã‚¢ã‚¯ã‚»ã‚¹ãƒ­ã‚°ã‚’ä¿å­˜ã—ãŸã„å ´åˆï¼Œãƒã‚±ãƒƒãƒˆãƒãƒªã‚·ãƒ¼ã‚’è¨­å®šã™ã‚‹å¿…è¦ãŒã‚ã‚‹ï¼ãƒã‚±ãƒƒãƒˆãƒãƒªã‚·ãƒ¼ã«ã¯ï¼ŒALBã‹ã‚‰S3ã¸ã®ãƒ­ã‚°æ›¸ãè¾¼ã¿æ¨©é™ã‚’å®Ÿè£…ã™ã‚‹ï¼ã€\"AWS\": \"arn:aws:iam::582318560864:root\"ã€ã«ãŠã„ã¦ï¼Œ582318560864ã¯ï¼ŒALBã‚¢ã‚«ã‚¦ãƒ³ãƒˆIDã¨å‘¼ã°ã‚Œï¼Œãƒªãƒ¼ã‚¸ãƒ§ãƒ³ã”ã¨ã«å€¤ãŒæ±ºã¾ã£ã¦ã„ã‚‹ï¼ã“ã‚Œã¯ï¼Œæ±äº¬ãƒªãƒ¼ã‚¸ãƒ§ãƒ³ã®ã‚¢ã‚«ã‚¦ãƒ³ãƒˆIDã§ã‚ã‚‹ï¼ãã®ä»–ã®ãƒªãƒ¼ã‚¸ãƒ§ãƒ³ã®ã‚¢ã‚«ã‚¦ãƒ³ãƒˆIDã«ã¤ã„ã¦ã¯ï¼Œä»¥ä¸‹ã®ãƒªãƒ³ã‚¯ã‚’å‚è€ƒã«ã›ã‚ˆï¼ å‚è€ƒï¼šhttps://docs.aws.amazon.com/ja_jp/elasticloadbalancing/latest/application/load-balancer-access-logs.html#access-logging-bucket-permissions ï¼Šå®Ÿè£…ä¾‹ï¼Š { \"Version\": \"2012-10-17\", \"Statement\": [ { \"Effect\": \"Allow\", \"Principal\": { \"AWS\": \"arn:aws:iam::582318560864:root\" }, \"Action\": \"s3:PutObject\", \"Resource\": \"arn:aws:s3:::/*\" } ] } ãƒ»CloudFrontã®ãƒ•ã‚¡ã‚¤ãƒ«èª­ã¿å‡ºã—ã‚’è¨±å¯ ãƒ‘ãƒ–ãƒªãƒƒã‚¯ã‚¢ã‚¯ã‚»ã‚¹ãŒç„¡åŠ¹åŒ–ã•ã‚ŒãŸS3ã«å¯¾ã—ã¦ï¼ŒCloudFrontã‹ã‚‰ã®ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã§é™çš„ãƒ•ã‚¡ã‚¤ãƒ«ã‚’èª­ã¿å‡ºã—ãŸã„å ´åˆï¼Œãƒã‚±ãƒƒãƒˆãƒãƒªã‚·ãƒ¼ã‚’è¨­å®šã™ã‚‹å¿…è¦ãŒã‚ã‚‹ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š { \"Version\": \"2008-10-17\", \"Id\": \"PolicyForCloudFrontPrivateContent\", \"Statement\": [ { \"Effect\": \"Allow\", \"Principal\": { \"AWS\": \"arn:aws:iam::cloudfront:user/CloudFront Origin Access Identity \" }, \"Action\": \"s3:GetObject\", \"Resource\": \"arn:aws:s3:::/*\" } ] } ãƒ»CloudFrontã®ã‚¢ã‚¯ã‚»ã‚¹ãƒ­ã‚°ã®ä¿å­˜ã‚’è¨±å¯ 2020-10-08æ™‚ç‚¹ã®ä»•æ§˜ã§ã¯ï¼Œãƒ‘ãƒ–ãƒªãƒƒã‚¯ã‚¢ã‚¯ã‚»ã‚¹ãŒç„¡åŠ¹åŒ–ã•ã‚ŒãŸS3ã«å¯¾ã—ã¦ï¼ŒCloudFrontã¸ã®ã‚¢ã‚¯ã‚»ã‚¹ãƒ­ã‚°ã‚’ä¿å­˜ã™ã‚‹ã“ã¨ã¯ã§ããªã„ï¼ã‚ˆã£ã¦ï¼Œå±é™ºã§ã¯ã‚ã‚‹ãŒï¼Œãƒ‘ãƒ–ãƒªãƒƒã‚¯ã‚¢ã‚¯ã‚»ã‚¹ã‚’æœ‰åŠ¹åŒ–ã™ã‚‹å¿…è¦ãŒã‚ã‚‹ï¼ // ãƒãƒªã‚·ãƒ¼ã¯ä¸è¦ ãƒ»Lambdaã‹ã‚‰ã®ã‚¢ã‚¯ã‚»ã‚¹ã‚’è¨±å¯ ãƒã‚±ãƒƒãƒˆãƒãƒªã‚·ãƒ¼ã¯ä¸è¦ã§ã‚ã‚‹ï¼ä»£ã‚ã‚Šã«ï¼ŒAWSç®¡ç†ãƒãƒªã‚·ãƒ¼ã®ã€AWSLambdaExecuteã€ãŒã‚¢ã‚¿ãƒƒãƒã•ã‚ŒãŸãƒ­ãƒ¼ãƒ«ã‚’Lambdaã«ã‚¢ã‚¿ãƒƒãƒã™ã‚‹å¿…è¦ãŒã‚ã‚‹ï¼ã“ã®ãƒãƒªã‚·ãƒ¼ã«ã¯ï¼ŒS3ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹æ¨©é™ã®ä»–ï¼ŒCloudWatchãƒ­ã‚°ã«ãƒ­ã‚°ã‚’ç”Ÿæˆã™ã‚‹ãŸã‚ã®æ¨©é™ãŒè¨­å®šã•ã‚Œã¦ã„ã‚‹ï¼ { \"Version\": \"2012-10-17\", \"Statement\": [ { \"Effect\": \"Allow\", \"Action\": [ \"logs:*\" ], \"Resource\": \"arn:aws:logs:*:*:*\" }, { \"Effect\": \"Allow\", \"Action\": [ \"s3:GetObject\", \"s3:PutObject\" ], \"Resource\": \"arn:aws:s3:::*\" } ] } ãƒ»ç‰¹å®šã®IPã‚¢ãƒ‰ãƒ¬ã‚¹ã‹ã‚‰ã®ã‚¢ã‚¯ã‚»ã‚¹ã‚’è¨±å¯ ãƒ‘ãƒ–ãƒªãƒƒã‚¯ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ä¸Šã®ç‰¹å®šã®IPã‚¢ãƒ‰ãƒ¬ã‚¹ã‹ã‚‰ã®ã‚¢ã‚¯ã‚»ã‚¹ã‚’è¨±å¯ã—ãŸã„å ´åˆï¼Œãã®IPã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’ãƒãƒªã‚·ãƒ¼ã«è¨­å®šã™ã‚‹å¿…è¦ãŒã‚ã‚‹ï¼ { \"Version\": \"2012-10-17\", \"Id\": \"S3PolicyId1\", \"Statement\": [ { \"Effect\": \"Allow\", \"Principal\": \"*\", \"Action\": \"s3:GetObject\", \"Resource\": \"arn:aws:s3:::/*\", \"Condition\": { \"IpAddress\": { \"aws:SourceIp\": \"/32\" } } } ] } CORSè¨­å®š ãƒ»æŒ‡å®šã—ãŸãƒ‰ãƒ¡ã‚¤ãƒ³ã‹ã‚‰ã®GETé€ä¿¡ã‚’è¨±å¯ [ { \"AllowedHeaders\": [ \"Content-*\" ], \"AllowedMethods\": [ \"GET\" ], \"AllowedOrigins\": [ \"https://example.jp\" ], \"ExposeHeaders\": [], \"MaxAgeSeconds\": 3600 } ] CLI ãƒ»ãƒã‚±ãƒƒãƒˆå†…ãƒ•ã‚¡ã‚¤ãƒ«ã‚’è¡¨ç¤º ï¼Šã‚³ãƒãƒ³ãƒ‰ä¾‹ï¼Š æŒ‡å®šã—ãŸãƒã‚±ãƒƒãƒˆå†…ã®ãƒ•ã‚¡ã‚¤ãƒ«åã‚’è¡¨ç¤ºã™ã‚‹ï¼ $ aws s3 ls s3:// ãƒ»ãƒã‚±ãƒƒãƒˆå†…å®¹é‡ã‚’åˆè¨ˆ ï¼Šã‚³ãƒãƒ³ãƒ‰ä¾‹ï¼Š æŒ‡å®šã—ãŸãƒã‚±ãƒƒãƒˆå†…ã®ãƒ•ã‚¡ã‚¤ãƒ«å®¹é‡ã‚’åˆè¨ˆã™ã‚‹ï¼ $ aws s3 ls s3:// --summarize --recursive --human-readable 26. Security Group Security Groupã¨ã¯ ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ã‚¯ãƒ©ã‚¦ãƒ‰ãƒ‘ã‚±ãƒƒãƒˆãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°å‹ãƒ•ã‚¡ã‚¤ã‚¢ã‚¦ã‚©ãƒ¼ãƒ«ã¨ã—ã¦åƒãï¼ã‚¤ãƒ³ãƒã‚¦ãƒ³ãƒ‰é€šä¿¡ï¼ˆãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯å‘ãé€šä¿¡ï¼‰ã§ã¯ï¼Œãƒ—ãƒ­ãƒˆã‚³ãƒ«ã‚„å—ä¿¡å…ƒIPã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’è¨­å®šã§ãï¼Œã‚¢ã‚¦ãƒˆãƒã‚¦ãƒ³ãƒ‰é€šä¿¡ï¼ˆã‚°ãƒ­ãƒ¼ãƒãƒ«ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯å‘ãé€šä¿¡ï¼‰ã§ã¯ï¼Œãƒ—ãƒ­ãƒˆã‚³ãƒ«ã‚„é€ä¿¡å…ˆãƒ—ãƒ­ãƒˆã‚³ãƒ«ã‚’è¨­å®šã§ãã‚‹ï¼ è¨­å®šé …ç›® ãƒ»æ¦‚è¦ ã‚¤ãƒ³ãƒã‚¦ãƒ³ãƒ‰ãƒ«ãƒ¼ãƒ«ã¨ã‚¢ã‚¦ãƒˆãƒã‚¦ãƒ³ãƒ‰ãƒ«ãƒ¼ãƒ«ã‚’è¨­å®šã§ãã‚‹ï¼ ã‚¤ãƒ³ãƒã‚¦ãƒ³ãƒ‰ãƒ«ãƒ¼ãƒ« ãƒ»ãƒ‘ã‚±ãƒƒãƒˆãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°å‹ãƒ•ã‚¡ã‚¤ã‚¢ã‚¦ã‚©ãƒ¼ãƒ« ãƒ‘ã‚±ãƒƒãƒˆã®ãƒ˜ãƒƒãƒ€æƒ…å ±ã«è¨˜è¼‰ã•ã‚ŒãŸé€ä¿¡å…ƒIPã‚¢ãƒ‰ãƒ¬ã‚¹ã‚„ãƒãƒ¼ãƒˆç•ªå·ãªã©ã«ã‚ˆã£ã¦ï¼Œãƒ‘ã‚±ãƒƒãƒˆã‚’è¨±å¯ã™ã‚‹ã¹ãã‹ã©ã†ã‹ã‚’æ±ºå®šã™ã‚‹ï¼é€Ÿåº¦ã‚’é‡è¦–ã™ã‚‹å ´åˆã¯ã“ã¡ã‚‰ï¼ãƒ•ã‚¡ã‚¤ã‚¢ã‚¦ã‚©ãƒ¼ãƒ«ã¨Webã‚µãƒ¼ãƒã®é–“ã«ã¯ï¼ŒNATãƒ«ãƒ¼ã‚¿ã‚„NAPTãƒ«ãƒ¼ã‚¿ãŒè¨­ç½®ã•ã‚Œã¦ã„ã‚‹ï¼ã“ã‚Œã‚‰ã«ã‚ˆã‚‹é€ä¿¡å…ƒãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆIPã‚¢ãƒ‰ãƒ¬ã‚¹ã‹ã‚‰é€ä¿¡å…ƒã‚°ãƒ­ãƒ¼ãƒãƒ«IPã‚¢ãƒ‰ãƒ¬ã‚¹ã¸ã®å¤‰æ›ã«ã¤ã„ã¦ã‚‚å‚è€ƒã«ã›ã‚ˆï¼ ãƒ»ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚°ãƒ«ãƒ¼ãƒ—IDã®ç´ä»˜ã‘ ã‚½ãƒ¼ã‚¹ã«å¯¾ã—ã¦ï¼Œã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚°ãƒ«ãƒ¼ãƒ—IDã‚’è¨­å®šã—ãŸå ´åˆï¼Œãã®ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚°ãƒ«ãƒ¼ãƒ—ãŒã‚¢ã‚¿ãƒƒãƒã•ã‚Œã¦ã„ã‚‹ENIã¨ï¼Œã“ã®ENIã«ç´ä»˜ã‘ã‚‰ã‚ŒãŸãƒªã‚½ãƒ¼ã‚¹ã‹ã‚‰ã®ãƒˆãƒ©ãƒ•ã‚£ãƒƒã‚¯ã‚’è¨±å¯ã§ãã‚‹ï¼ãƒªã‚½ãƒ¼ã‚¹ã®IPã‚¢ãƒ‰ãƒ¬ã‚¹ãŒå‹•çš„ã«å¤‰åŒ–ã™ã‚‹å ´åˆï¼Œæœ‰åŠ¹ãªæ–¹æ³•ã§ã‚ã‚‹ï¼ å‚è€ƒï¼šhttps://docs.aws.amazon.com/ja_jp/vpc/latest/userguide/VPC_SecurityGroups.html#DefaultSecurityGroup ãƒ»ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³EC2ã®ä¾‹ ALBã«å‰²ã‚ŠæŒ¯ã‚‰ã‚Œã‚‹å¯èƒ½æ€§ã®ã‚ã‚‹IPã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’è¨±å¯ã™ã‚‹ãŸã‚ã«ï¼ŒALBã®Security Groupã®IDï¼Œã¾ãŸã¯ã‚µãƒ–ãƒãƒƒãƒˆã®IPã‚¢ãƒ‰ãƒ¬ã‚¹ç¯„å›²ã‚’è¨­å®šã™ã‚‹ï¼ ã‚¿ã‚¤ãƒ— ãƒ—ãƒ­ãƒˆã‚³ãƒ« ãƒãƒ¼ãƒˆ ã‚½ãƒ¼ã‚¹ èª¬æ˜ HTTP TCP 80 ALBã®Security Group ID HTTP access from ALB HTTPS TCP 443 è¸ã¿å°EC2ã®Security Group ID SSH access from bastion EC2 ãƒ»è¸ã¿å°EC2ã®ä¾‹ ã‚¿ã‚¤ãƒ— ãƒ—ãƒ­ãƒˆã‚³ãƒ« ãƒãƒ¼ãƒˆ ã‚½ãƒ¼ã‚¹ èª¬æ˜ SSH TCP 22 ç¤¾å†…ã®ã‚°ãƒ­ãƒ¼ãƒãƒ«IPã‚¢ãƒ‰ãƒ¬ã‚¹ SSH access from global ip addess ãƒ»EFSã®ä¾‹ EC2ã«å‰²ã‚ŠæŒ¯ã‚‰ã‚Œã‚‹å¯èƒ½æ€§ã®ã‚ã‚‹IPã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’è¨±å¯ã™ã‚‹ãŸã‚ã«ï¼ŒEC2ã®Security Groupã®IDï¼Œã¾ãŸã¯ã‚µãƒ–ãƒãƒƒãƒˆã®IPã‚¢ãƒ‰ãƒ¬ã‚¹ç¯„å›²ã‚’è¨­å®šã™ã‚‹ï¼ ã‚¿ã‚¤ãƒ— ãƒ—ãƒ­ãƒˆã‚³ãƒ« ãƒãƒ¼ãƒˆ ã‚½ãƒ¼ã‚¹ èª¬æ˜ NFS TCP 2049 ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³EC2ã®Security Group ID NFS access from app EC2 ãƒ»RDSã®ä¾‹ EC2ã«å‰²ã‚ŠæŒ¯ã‚‰ã‚Œã‚‹å¯èƒ½æ€§ã®ã‚ã‚‹IPã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’è¨±å¯ã™ã‚‹ãŸã‚ã«ï¼ŒEC2ã®Security Groupã®IDï¼Œã¾ãŸã¯ã‚µãƒ–ãƒãƒƒãƒˆã®IPã‚¢ãƒ‰ãƒ¬ã‚¹ç¯„å›²ã‚’è¨­å®šã™ã‚‹ï¼ ã‚¿ã‚¤ãƒ— ãƒ—ãƒ­ãƒˆã‚³ãƒ« ãƒãƒ¼ãƒˆ ã‚½ãƒ¼ã‚¹ èª¬æ˜ MYSQL/Aurora TCP 3306 ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³EC2ã®Security Group ID MYSQL access from app EC2 ãƒ»Redisã®ä¾‹ EC2ã«å‰²ã‚ŠæŒ¯ã‚‰ã‚Œã‚‹å¯èƒ½æ€§ã®ã‚ã‚‹IPã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’è¨±å¯ã™ã‚‹ãŸã‚ã«ï¼ŒEC2ã®Security Groupã®IDï¼Œã¾ãŸã¯ã‚µãƒ–ãƒãƒƒãƒˆã®IPã‚¢ãƒ‰ãƒ¬ã‚¹ç¯„å›²ã‚’è¨­å®šã™ã‚‹ï¼ ã‚¿ã‚¤ãƒ— ãƒ—ãƒ­ãƒˆã‚³ãƒ« ãƒãƒ¼ãƒˆ ã‚½ãƒ¼ã‚¹ èª¬æ˜ ã‚«ã‚¹ã‚¿ãƒ TCP TCP 6379 ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³EC2ã®Security Group ID TCP access from app EC2 ãƒ»ALBã®ä¾‹ CloudFrontã¨é€£æºã™ã‚‹å ´åˆï¼ŒCloudFrontã«å‰²ã‚ŠæŒ¯ã‚‰ã‚Œã‚‹å¯èƒ½æ€§ã®ã‚ã‚‹IPã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’è¨±å¯ã™ã‚‹ãŸã‚ã«ï¼Œå…¨ã¦ã®IPã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’è¨±å¯ã™ã‚‹ï¼ãã®ä»£ã‚ã‚Šã«ï¼ŒCloudFrontã«WAFã‚’ç´ä»˜ã‘ï¼ŒALBã®å‰ã§IPã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’åˆ¶é™ã™ã‚‹ã‚ˆã†ã«ã™ã‚‹ï¼CloudFrontã¨ã¯é€£æºã—ãªã„å ´åˆï¼ŒALBã®Security Groupã§IPã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’åˆ¶é™ã™ã‚‹ã‚ˆã†ã«ã™ã‚‹ï¼ ã‚¿ã‚¤ãƒ— ãƒ—ãƒ­ãƒˆã‚³ãƒ« ãƒãƒ¼ãƒˆ ã‚½ãƒ¼ã‚¹ èª¬æ˜ HTTP TCP 80 0.0.0.0/0 HTTP access from CloudFront HTTPS TCP 443 0.0.0.0/0 HTTPS access from CloudFront ã‚¢ã‚¦ãƒˆãƒã‚¦ãƒ³ãƒ‰ãƒ«ãƒ¼ãƒ« ãƒ»ä»»æ„AWSãƒªã‚½ãƒ¼ã‚¹ã®ä¾‹ ã‚¿ã‚¤ãƒ— ãƒ—ãƒ­ãƒˆã‚³ãƒ« ãƒãƒ¼ãƒˆ é€ä¿¡å…ˆ èª¬æ˜ ã™ã¹ã¦ã®ãƒˆãƒ©ãƒ•ã‚£ãƒƒã‚¯ ã™ã¹ã¦ ã™ã¹ã¦ 0.0.0.0/0 Full access Zone ãƒ»Availability Zoneã¨ã¯ Regionã¯ï¼Œã•ã‚‰ã«ï¼Œå„ãƒ‡ãƒ¼ã‚¿ã‚»ãƒ³ã‚¿ãƒ¼ã¯ç‰©ç†çš„ã«ç‹¬ç«‹ã—ãŸAvailability Zoneã¨ã„ã†ãƒ­ã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‹ã‚‰æ§‹æˆã•ã‚Œã¦ã„ã‚‹ï¼ä¾‹ãˆã°ï¼Œæ±äº¬Regionã«ã¯ï¼Œ3ã¤ã®Availability ZoneãŒã‚ã‚‹ï¼AZã®ä¸­ã«ï¼ŒVPCã‚µãƒ–ãƒãƒƒãƒˆã‚’ä½œã‚‹ã“ã¨ãŒã§ãï¼Œãã“ã«EC2ã‚’æ§‹ç¯‰ã§ãã‚‹ï¼ 27. SESï¼šSimple Email Service SESã¨ã¯ ã‚¯ãƒ©ã‚¦ãƒ‰ãƒ¡ãƒ¼ãƒ«ã‚µãƒ¼ãƒã¨ã—ã¦åƒãï¼ãƒ¡ãƒ¼ãƒ«å—ä¿¡ã‚’ãƒˆãƒªã‚¬ãƒ¼ã¨ã—ã¦ï¼Œã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚’å®Ÿè¡Œã™ã‚‹ï¼ è¨­å®šé …ç›® ãƒ»æ¦‚è¦ è¨­å®šé …ç›® èª¬æ˜ è£œè¶³ Domain SESã®ãƒ‰ãƒ¡ã‚¤ãƒ³åã‚’è¨­å®šã™ã‚‹ï¼ è¨­å®šã—ãŸãƒ‰ãƒ¡ã‚¤ãƒ³åã«ã¯ï¼Œã€10 inbound-smtp.us-east-1.amazonaws.comã€ã¨ã„ã†MXãƒ¬ã‚³ãƒ¼ãƒ‰ã‚¿ã‚¤ãƒ—ã®å€¤ãŒç´ä»˜ãï¼ Email Addresses é€ä¿¡å…ˆã¨ã—ã¦èªè¨¼ã™ã‚‹ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’è¨­å®šã™ã‚‹ï¼è¨­å®šã™ã‚‹ã¨AWSã‹ã‚‰ãƒ¡ãƒ¼ãƒ«ãŒå±Šãã®ã§ï¼ŒæŒ‡å®šã•ã‚ŒãŸãƒªãƒ³ã‚¯ã‚’ã‚¯ãƒªãƒƒã‚¯ã™ã‚‹ï¼ Sandboxãƒ¢ãƒ¼ãƒ‰ã®æ™‚ã ã‘æ©Ÿèƒ½ã™ã‚‹ï¼ Sending Statistics SESã§åé›†ã•ã‚ŒãŸãƒ‡ãƒ¼ã‚¿ã‚’ãƒ¡ãƒˆãƒªã‚¯ã‚¹ã§ç¢ºèªã§ãã‚‹ï¼ Request Increased Sending Limitsã®ãƒªãƒ³ã‚¯ã«ã¦ï¼ŒSandboxãƒ¢ãƒ¼ãƒ‰ã®è§£é™¤ã‚’ç”³è«‹ã§ãã‚‹ï¼ SMTP Settings SMTP-AUTHã®æ¥ç¶šæƒ…å ±ã‚’ç¢ºèªã§ãã‚‹ï¼ ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®25ç•ªãƒãƒ¼ãƒˆã¯é€ä¿¡åˆ¶é™ãŒã‚ã‚‹ãŸã‚ï¼Œ465ç•ªã‚’ä½¿ç”¨ã™ã‚‹ï¼ã“ã‚Œã«åˆã‚ã›ã¦ï¼ŒSESã‚‚å—ä¿¡ã§465ç•ªãƒãƒ¼ãƒˆã‚’ä½¿ç”¨ã™ã‚‹ã‚ˆã†ã«ã™ã‚‹ï¼ Rule Sets ãƒ¡ãƒ¼ãƒ«ã®å—ä¿¡ã—ãŸãƒˆãƒªã‚¬ãƒ¼ã¨ã—ã¦å®Ÿè¡Œã™ã‚‹ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚’è¨­å®šã§ãã‚‹ï¼ IP Address Filters ãƒ»Rule Sets è¨­å®šé …ç›® èª¬æ˜ Recipiet å—ä¿¡ã—ãŸãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã§ï¼Œä½•ã®å®›å…ˆã®æ™‚ã«ã“ã‚Œã‚’è¨±å¯ã™ã‚‹ã‹ã‚’è¨­å®šã™ã‚‹ï¼ Actions å—ä¿¡ã‚’è¨±å¯ã—ãŸå¾Œã«ï¼Œã“ã‚Œã‚’ãƒˆãƒªã‚¬ãƒ¼ã¨ã—ã¦å®Ÿè¡Œã™ã‚‹ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚’è¨­å®šã™ã‚‹ï¼ ä»•æ§˜ä¸Šã®åˆ¶ç´„ ãƒ»æ§‹ç¯‰ãƒªãƒ¼ã‚¸ãƒ§ãƒ³ã®åˆ¶ç´„ SESã¯é€£æºã™ã‚‹AWSãƒªã‚½ãƒ¼ã‚¹ã¨åŒã˜ãƒªãƒ¼ã‚¸ãƒ§ãƒ³ã«æ§‹ç¯‰ã—ãªã‘ã‚Œã°ãªã‚‰ãªã„ï¼ ãƒ»Sandboxãƒ¢ãƒ¼ãƒ‰ã®è§£é™¤ SESã¯ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ã¯Sandboxãƒ¢ãƒ¼ãƒ‰ã«ãªã£ã¦ã„ã‚‹ï¼Sandboxãƒ¢ãƒ¼ãƒ‰ã§ã¯ä»¥ä¸‹ã®åˆ¶é™ãŒã‹ã‹ã£ã¦ãŠã‚Šï¼ã‚µãƒãƒ¼ãƒˆã‚»ãƒ³ã‚¿ãƒ¼ã«è§£é™¤ç”³è«‹ãŒå¿…è¦ã§ã‚ã‚‹ï¼ åˆ¶é™ èª¬æ˜ é€ä¿¡åˆ¶é™ SESã§èªè¨¼ã—ãŸãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã®ã¿ã«é€ä¿¡ã§ãã‚‹ï¼ å—ä¿¡åˆ¶é™ 1æ—¥ã«200ãƒ¡ãƒ¼ãƒ«ã®ã¿å—ä¿¡ã§ãã‚‹ï¼ SMTP-AUTH ãƒ»AWSã«ãŠã‘ã‚‹SMTP-AUTHã®ä»•çµ„ã¿ ä¸€èˆ¬çš„ãªSMTP-AUTHã§ã¯ï¼Œã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆãƒ¦ãƒ¼ã‚¶ã®èªè¨¼ãŒå¿…è¦ã§ã‚ã‚‹ï¼åŒæ§˜ã«ã—ã¦ï¼ŒAWSã«ãŠã„ã¦ã‚‚ã“ã‚ŒãŒå¿…è¦ã§ã‚ã‚Šï¼ŒIAMãƒ¦ãƒ¼ã‚¶ã‚’ç”¨ã„ã¦ã“ã‚Œã‚’å®Ÿç¾ã™ã‚‹ï¼é€ä¿¡å…ƒã¨ãªã‚‹ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã«IAMãƒ¦ãƒ¼ã‚¶ã‚’ç´ä»˜ã‘ï¼Œã“ã®IAMãƒ¦ãƒ¼ã‚¶ã«ã¯ãƒ¦ãƒ¼ã‚¶åã¨ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’è¨­å®šã™ã‚‹ï¼ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãŒSESã‚’ä»‹ã—ã¦ãƒ¡ãƒ¼ãƒ«ã‚’é€ä¿¡ã™ã‚‹æ™‚ï¼Œã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã«å¯¾ã—ã¦ï¼ŒSESãŒãƒ¦ãƒ¼ã‚¶åã¨ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’ç”¨ã„ãŸèªè¨¼ã‚’å®Ÿè¡Œã™ã‚‹ï¼ãƒ¦ãƒ¼ã‚¶åã¨ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã¯å¾Œã‹ã‚‰ç¢ºèªã§ããªã„ãŸã‚ï¼Œãƒ¡ãƒ¢ã—ã¦ãŠãã“ã¨ï¼SMTP-AUTHã®ä»•çµ„ã¿ã«ã¤ã„ã¦ã¯ï¼Œä»¥ä¸‹ã®ãƒªãƒ³ã‚¯ã‚’å‚è€ƒã«ã›ã‚ˆï¼ å‚è€ƒï¼šhhttps://hiroki-it.github.io/tech-notebook-gitbook/public/network/network_osi_tcp_model.html.html?h=smtp 28. SNSï¼šSimple Notification Service SNSã¨ã¯ ãƒ‘ãƒ–ãƒªãƒƒã‚·ãƒ£ãƒ¼ã‹ã‚‰ç™ºä¿¡ã•ã‚ŒãŸãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã§å—ä¿¡ã—ï¼Œã‚µãƒ–ã‚¹ã‚¯ãƒ©ã‚¤ãƒãƒ¼ã«è»¢é€ã™ã‚‹AWSãƒªã‚½ãƒ¼ã‚¹ï¼ è¨­å®šé …ç›® ãƒ»æ¦‚è¦ è¨­å®šé …ç›® èª¬æ˜ ãƒˆãƒ”ãƒƒã‚¯ è¤‡æ•°ã®ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ã‚’ã‚°ãƒ«ãƒ¼ãƒ—åŒ–ã—ãŸã‚‚ã®ï¼ ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã§å—ä¿¡ã™ã‚‹ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®ç¨®é¡ã‚’è¨­å®šã™ã‚‹ï¼ ãƒ»ãƒˆãƒ”ãƒƒã‚¯ è¨­å®šé …ç›® èª¬æ˜ ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ã‚’ç™»éŒ²ã™ã‚‹ï¼ ã‚¢ã‚¯ã‚»ã‚¹ãƒãƒªã‚·ãƒ¼ ãƒˆãƒ”ãƒƒã‚¯ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹æ¨©é™ã‚’è¨­å®šã™ã‚‹ï¼ é…ä¿¡å†è©¦è¡Œãƒãƒªã‚·ãƒ¼ ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ã®HTTP/Sã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆãŒå¤±æ•—ã—ãŸæ™‚ã®ãƒªãƒˆãƒ©ã‚¤æ–¹æ³•ã‚’è¨­å®šã™ã‚‹ï¼å‚è€ƒï¼šhttps://docs.aws.amazon.com/ja_jp/sns/latest/dg/sns-message-delivery-retries.html é…ä¿¡ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã®ãƒ­ã‚°è¨˜éŒ² ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ã¸ã®ç™ºä¿¡ã®ãƒ­ã‚°ã‚’CloudWatchLogsã«è»¢é€ã™ã‚‹ã‚ˆã†ã«è¨­å®šã™ã‚‹ï¼ æš—å·åŒ– ãƒ»ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®ç¨®é¡ è»¢é€å…ˆ è£œè¶³ Kinesis Data Firehose Kinesis Data Firehose SQS SQS Lambda Lambda Eãƒ¡ãƒ¼ãƒ« ä»»æ„ã®ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ HTTP/S ä»»æ„ã®ãƒ‰ãƒ¡ã‚¤ãƒ³å Chatbotã®ãƒ‰ãƒ¡ã‚¤ãƒ³åã¯ã€https://global.sns-api.chatbot.amazonaws.comã€ JSONå½¢å¼ã®ãƒ¡ãƒ¼ãƒ« ä»»æ„ã®ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ SMS SMS å—ä¿¡è€…ã®é›»è©±ç•ªå·ã‚’è¨­å®šã™ã‚‹ï¼ 29. SQSï¼šSimple Queue Service SQSã¨ã¯ ã‚¯ãƒ©ã‚¦ãƒ‰ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚­ãƒ¥ãƒ¼ã¨ã—ã¦åƒãï¼ãƒ‘ãƒ–ãƒªãƒƒã‚·ãƒ£ãƒ¼ãŒé€ä¿¡ã—ãŸãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã¯ï¼Œä¸€æ—¦SQSã«è¿½åŠ ã•ã‚Œã‚‹ï¼ãã®å¾Œï¼Œã‚µãƒ–ã‚¹ã‚¯ãƒ©ã‚¤ãƒãƒ¼ã¯ï¼ŒSQSã«å¯¾ã—ã¦ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é€ä¿¡ã—ï¼Œãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å–ã‚Šå‡ºã™ï¼ç•°ãªã‚‹VPCé–“ã§ã‚‚ï¼Œãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚­ãƒ¥ãƒ¼ã‚’åŒæœŸã§ãã‚‹ï¼ è¨­å®šé …ç›® ãƒ»SQSã®ç¨®é¡ è¨­å®šé …ç›® èª¬æ˜ ã‚¹ã‚¿ãƒ³ãƒ€ãƒ¼ãƒ‰æ–¹å¼ ã‚µãƒ–ã‚¹ã‚¯ãƒ©ã‚¤ãƒãƒ¼ã®å–å¾—ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’å¾…ãŸãšã«ï¼Œæ¬¡ã®ã‚­ãƒ¥ãƒ¼ã‚’éåŒæœŸçš„ã«è»¢é€ã™ã‚‹ï¼ FIFOæ–¹å¼ ã‚µãƒ–ã‚¹ã‚¯ãƒ©ã‚¤ãƒãƒ¼ã®å–å¾—ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’å¾…ã¡ï¼Œã‚­ãƒ¥ãƒ¼ã‚’åŒæœŸçš„ã«è»¢é€ã™ã‚‹ï¼ CLI ãƒ»ã‚­ãƒ¥ãƒ¼URLã‚’å–å¾— ã‚­ãƒ¥ãƒ¼ã®URLã‚’å–å¾—ã™ã‚‹ï¼ $ aws sqs get-queue-url --queue-name ãƒ»ã‚­ãƒ¥ãƒ¼ã«å—ä¿¡ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é€ä¿¡ ã‚­ãƒ¥ãƒ¼ã«å—ä¿¡ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é€ä¿¡ã—ï¼Œãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å—ä¿¡ã™ã‚‹ï¼ $ SQS_QUEUE_URL=$(aws sqs get-queue-url --queue-name ) $ aws sqs receive-message --queue-url ${SQS_QUEUE_URL} ã‚­ãƒ¥ãƒ¼ã«å—ä¿¡ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é€ä¿¡ã—ï¼Œãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å—ä¿¡ã™ã‚‹ï¼ã¾ãŸï¼Œãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®å†…å®¹ã‚’ãƒ•ã‚¡ã‚¤ãƒ«ã«æ›¸ãå‡ºã™ï¼ $ SQS_QUEUE_URL=$(aws sqs get-queue-url --queue-name ) $ aws sqs receive-message --queue-url ${SQS_QUEUE_URL} > receiveOutput.json { \"Messages\": [ { \"Body\": \"\", \"ReceiptHandle\": \"AQEBUo4y+XVuRSe4jMv0QM6Ob1viUnPbZ64WI01+Kmj6erhv192m80m+wgyob+zBgL4OMT+bps4KR/q5WK+W3tnno6cCFuwKGRM4OQGM9omMkK1F+ZwBC49hbl7UlzqAqcSrHfxyDo5x+xEyrEyL+sFK2MxNV6d0mF+7WxXTboyAu7JxIiKLG6cUlkhWfk3W4/Kghagy5erwRhwTaKtmF+7hw3Y99b55JLFTrZjW+/Jrq9awLCedce0kBQ3d2+7pnlpEcoY42+7T1dRI2s7um+nj5TIUpx2oSd9BWBHCjd8UQjmyye645asrWMAl1VCvHZrHRIG/v3vgq776e1mmi9pGxN96IW1aDZCQ1CSeqTFASe4=\", \"MD5OfBody\": \"6699d5711c044a109a6aff9fc193aada\", \"MessageId\": \"xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx\" } ] } 30. STSï¼šSecurity Token Service STSã¨ã¯ AWSãƒªã‚½ãƒ¼ã‚¹ã«ä¸€æ™‚çš„ã«ã‚¢ã‚¯ã‚»ã‚¹ã§ãã‚‹èªè¨¼æƒ…å ±ï¼ˆã‚¢ã‚¯ã‚»ã‚¹ã‚­ãƒ¼ï¼Œã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆã‚¢ã‚¯ã‚»ã‚¹ã‚­ãƒ¼ï¼Œã‚»ãƒƒã‚·ãƒ§ãƒ³ãƒˆãƒ¼ã‚¯ãƒ³ï¼‰ã‚’ç™ºè¡Œã™ã‚‹ï¼ã“ã®èªè¨¼æƒ…å ±ã¯ï¼Œä¸€æ™‚çš„ãªã‚¢ã‚«ã‚¦ãƒ³ãƒˆæƒ…å ±ã¨ã—ã¦ä½¿ç”¨ã§ãã‚‹ï¼ STSã®è¨­å®šæ‰‹é † 1. IAMãƒ­ãƒ¼ãƒ«ã«ä¿¡é ¼ãƒãƒªã‚·ãƒ¼ã‚’ã‚¢ã‚¿ãƒƒãƒ å¿…è¦ãªãƒãƒªã‚·ãƒ¼ãŒè¨­å®šã•ã‚ŒãŸIAMãƒ­ãƒ¼ãƒ«ã‚’æ§‹ç¯‰ã™ã‚‹ï¼ãã®æ™‚ï¼Œä¿¡é ¼ãƒãƒªã‚·ãƒ¼ã«ãŠã„ã¦ï¼Œãƒ¦ãƒ¼ã‚¶ã®ARNã‚’ä¿¡é ¼ã•ã‚ŒãŸã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã¨ã—ã¦è¨­å®šã—ã¦ãŠãï¼ã“ã‚Œã«ã‚ˆã‚Šï¼Œãã®ãƒ¦ãƒ¼ã‚¶ã«å¯¾ã—ã¦ï¼Œãƒ­ãƒ¼ãƒ«ã‚’ã‚¢ã‚¿ãƒƒãƒã§ãã‚‹ã‚ˆã†ã«ãªã‚‹ï¼ { \"Version\": \"2012-10-17\", \"Statement\": [ { \"Effect\": \"Allow\", \"Principal\": { \"AWS\": \"arn:aws:iam:::user/\" }, \"Action\": \"sts:AssumeRole\", \"Condition\": { \"StringEquals\": { \"sts:ExternalId\": \"\" } } } ] } 2. ãƒ­ãƒ¼ãƒ«ã‚’å¼•ãå—ã‘ãŸã‚¢ã‚«ã‚¦ãƒ³ãƒˆæƒ…å ±ã‚’ãƒªã‚¯ã‚¨ã‚¹ãƒˆ ä¿¡é ¼ã•ã‚ŒãŸã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ï¼ˆãƒ¦ãƒ¼ã‚¶ï¼‰ã‹ã‚‰ï¼ŒSTSï¼ˆhttps://sts.amazonaws.comï¼‰ã«å¯¾ã—ã¦ï¼Œãƒ­ãƒ¼ãƒ«ã®ã‚¢ã‚¿ãƒƒãƒã‚’ãƒªã‚¯ã‚¨ã‚¹ãƒˆã™ã‚‹ï¼ #!/bin/bash set -xeuo pipefail set -u # äº‹å‰ã«ç’°å¢ƒå¤‰æ•°ã«ã‚¤ãƒ³ãƒ•ãƒ©ç’°å¢ƒåã‚’ä»£å…¥ã™ã‚‹ï¼ case $ENV in \"test\") aws_account_id=\"\" aws_access_key_id=\"\" aws_secret_access_key=\"\" aws_iam_role_external_id=\"\" ;; \"stg\") aws_account_id=\"\" aws_access_key_id=\"\" aws_secret_access_key=\"\" aws_iam_role_external_id=\"\" ;; \"prd\") aws_account_id=\"\" aws_access_key_id=\"\" aws_secret_access_key=\"\" aws_iam_role_external_id=\"\" ;; *) echo \"The parameter ${ENV} is invalid.\" exit 1 ;; esac # ä¿¡é ¼ã•ã‚ŒãŸã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã®ã‚¢ã‚«ã‚¦ãƒ³ãƒˆæƒ…å ±ã‚’è¨­å®šã™ã‚‹ï¼ aws configure set aws_access_key_id \"$aws_account_id\" aws configure set aws_secret_access_key \"$aws_secret_access_key\" aws configure set aws_default_region \"ap-northeast-1\" # https://sts.amazonaws.com ã«ï¼Œãƒ­ãƒ¼ãƒ«ã®ã‚¢ã‚¿ãƒƒãƒã‚’ãƒªã‚¯ã‚¨ã‚¹ãƒˆã™ã‚‹ï¼ aws_sts_credentials=\"$(aws sts assume-role \\ --role-arn \"arn:aws:iam::${aws_access_key_id}:role/${ENV}-\" \\ --role-session-name \"\" \\ --external-id \"$aws_iam_role_external_id\" \\ --duration-seconds \"\" \\ --query \"Credentials\" \\ --output \"json\")\" STSã¸ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆã®çµæœï¼Œãƒ­ãƒ¼ãƒ«ãŒã‚¢ã‚¿ãƒƒãƒã•ã‚ŒãŸæ–°ã—ã„IAMãƒ¦ãƒ¼ã‚¶æƒ…å ±ã‚’å–å¾—ã§ãã‚‹ï¼ã“ã®æƒ…å ±ã«ã¯æœ‰åŠ¹ç§’æ•°ãŒå­˜åœ¨ã—ï¼ŒæœŸé™ãŒéãã‚‹ã¨æ–°ã—ã„IAMãƒ¦ãƒ¼ã‚¶ã«ãªã‚‹ï¼ç§’æ•°ã®æœ€å¤§å€¤ã¯ï¼Œè©²å½“ã™ã‚‹IAMãƒ­ãƒ¼ãƒ«ã®æ¦‚è¦ã®æœ€å¤§ã‚»ãƒƒã‚·ãƒ§ãƒ³æ™‚é–“ã‹ã‚‰å¤‰æ›´ã§ãã‚‹ï¼ ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã•ã‚Œã‚‹ãƒ‡ãƒ¼ã‚¿ã¯ä»¥ä¸‹ã®é€šã‚Šï¼ { \"AssumeRoleUser\": { \"AssumedRoleId\": \":\", \"Arn\": \"arn:aws:sts::assumed-role//\" }, \"Credentials\": { \"SecretAccessKey\": \"\", \"SessionToken\": \"\", \"Expiration\": \"\", \"AccessKeyId\": \"\" } } 3-1. ã‚¢ã‚«ã‚¦ãƒ³ãƒˆæƒ…å ±ã‚’å–å¾—ï¼ˆï¼‘ï¼‰ jqã‚’ä½¿ç”¨ã—ã¦ï¼Œãƒ¬ã‚¹ãƒãƒ³ã‚¹ã•ã‚ŒãŸJSONãƒ‡ãƒ¼ã‚¿ã‹ã‚‰ã‚¢ã‚«ã‚¦ãƒ³ãƒˆæƒ…å ±ã‚’æŠ½å‡ºã™ã‚‹ï¼ç’°å¢ƒå¤‰æ•°ã¨ã—ã¦å‡ºåŠ›ã—ï¼Œä½¿ç”¨ã§ãã‚‹ã‚ˆã†ã«ã™ã‚‹ï¼ã‚ã‚‹ã„ã¯ï¼ŒAWSã®credentialsãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã—ã¦ã‚‚ã‚ˆã„ï¼ å‚è€ƒï¼šhttps://stedolan.github.io/jq/ #!/bin/bash cat assumed_user.sh export AWS_ACCESS_KEY_ID=\"$(echo \"$aws_sts_credentials\" | jq -r \".AccessKeyId\")\" export AWS_SECRET_ACCESS_KEY=\"$(echo \"$aws_sts_credentials\" | jq -r \".SecretAccessKey\")\" export AWS_SESSION_TOKEN=\"$(echo \"$aws_sts_credentials\" | jq -r \".SessionToken\")\" export AWS_ACCOUNT_ID=\"$aws_account_id\" export AWS_DEFAULT_REGION=\"ap-northeast-1\" EOF 3-2. ã‚¢ã‚«ã‚¦ãƒ³ãƒˆæƒ…å ±ã‚’å–å¾—ï¼ˆï¼’ï¼‰ jqã‚’ä½¿ç”¨ã—ã¦ï¼Œãƒ¬ã‚¹ãƒãƒ³ã‚¹ã•ã‚ŒãŸJSONãƒ‡ãƒ¼ã‚¿ã‹ã‚‰ã‚¢ã‚«ã‚¦ãƒ³ãƒˆæƒ…å ±ã‚’æŠ½å‡ºã™ã‚‹ï¼ãƒ­ãƒ¼ãƒ«ã‚’å¼•ãå—ã‘ãŸæ–°ã—ã„ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã®æƒ…å ±ã‚’ï¼Œcredentialsãƒ•ã‚¡ã‚¤ãƒ«ã«æ›¸ãè¾¼ã‚€ï¼ #!/bin/bash aws configure --profile ${ENV}-repository > ~/.aws/credentials 4. æ¥ç¶šç¢ºèª ãƒ­ãƒ¼ãƒ«ã‚’å¼•ãå—ã‘ãŸæ–°ã—ã„ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’ä½¿ç”¨ã—ã¦ï¼ŒAWSãƒªã‚½ãƒ¼ã‚¹ã«æ¥ç¶šã§ãã‚‹ã‹ã‚’ç¢ºèªã™ã‚‹ï¼ã‚¢ã‚«ã‚¦ãƒ³ãƒˆæƒ…å ±ã®å–å¾—æ–¹æ³•ã¨ã—ã¦credentialsãƒ•ã‚¡ã‚¤ãƒ«ã®ä½œæˆã‚’é¸ã‚“ã å ´åˆï¼Œprofileã‚ªãƒ—ã‚·ãƒ§ãƒ³ãŒå¿…è¦ã§ã‚ã‚‹ï¼ #!/bin/bash # 3-2ã‚’é¸ã‚“ã å ´åˆï¼Œcredentialsãƒ•ã‚¡ã‚¤ãƒ«ã‚’å‚ç…§ã™ã‚‹ã‚ªãƒ—ã‚·ãƒ§ãƒ³ãŒå¿…è¦ãŒã‚ã‚‹ï¼ aws s3 ls --profile 2020-xx-xx xx:xx:xx 31. Step Functions Step Functionsã¨ã¯ AWSã‚µãƒ¼ãƒ“ã‚¹ã‚’çµ„ã¿åˆã‚ã›ã¦ï¼Œã‚¤ãƒ™ãƒ³ãƒˆé§†å‹•å‹ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’æ§‹ç¯‰ã§ãã‚‹ï¼ AWSãƒªã‚½ãƒ¼ã‚¹ã®APIã‚³ãƒ¼ãƒ« ãƒ»APIã‚³ãƒ¼ãƒ«ã§ãã‚‹ãƒªã‚½ãƒ¼ã‚¹ å‚è€ƒï¼šhttps://docs.aws.amazon.com/step-functions/latest/dg/connect-supported-services.html ãƒ»Lambda ï¼Šå®Ÿè£…ä¾‹ï¼Š { \"StartAt\": \"Call Lambda\", \"States\": { \"Call Lambda\": { \"Type\": \"Task\", \"Resource\": \"arn:aws:states:::lambda:invoke.waitForTaskToken\", \"Parameters\": { \"FunctionName\": \"arn:aws:lambda:ap-northeast-1:xxxxx:foo-function:1\" }, \"Retry\": [ { \"ErrorEquals\": [ \"\" ], \"MaxAttempts\": 0 } ], \"End\": true, \"Comment\": \"The state that call Lambda\" } } } 32. VPCï¼šVirtual Private Cloud VPCã¨ã¯ ã‚¯ãƒ©ã‚¦ãƒ‰ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã¨ã—ã¦åƒãï¼ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆIPã‚¢ãƒ‰ãƒ¬ã‚¹ãŒå‰²ã‚Šå½“ã¦ã‚‰ã‚ŒãŸï¼ŒVPCã¨å‘¼ã°ã‚Œã‚‹ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚’ä»®æƒ³çš„ã«æ§‹ç¯‰ã§ãã‚‹ï¼ç•°ãªã‚‹Availability Zoneã«æ¸¡ã£ã¦EC2ã‚’ç«‹ã¡ä¸Šã’ã‚‹ã“ã¨ã«ã‚ˆã£ã¦ï¼Œã‚¯ãƒ©ã‚¦ãƒ‰ã‚µãƒ¼ãƒã‚’ãƒ‡ãƒ¥ã‚¢ãƒ«åŒ–ã™ã‚‹ã“ã¨ã§ãã‚‹ï¼VPCã®ãƒ‘ã‚±ãƒƒãƒˆé€šä¿¡ã®ä»•çµ„ã¿ã«ã¤ã„ã¦ã¯ï¼Œä»¥ä¸‹ã®ãƒªãƒ³ã‚¯ã‚’å‚è€ƒã«ã›ã‚ˆï¼ å‚è€ƒï¼šhttps://pages.awscloud.com/rs/112-TZM-766/images/AWS-08_AWS_Summit_Online_2020_NET01.pdf Internet Gatewayï¼ŒNAT Gateway ãƒ»Internet Gatewayã¨ã¯ VPCã®å‡ºå…¥ã‚Šå£ã«è¨­ç½®ã•ã‚Œï¼Œã‚°ãƒ­ãƒ¼ãƒãƒ«ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã¨ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯é–“ï¼ˆã“ã“ã§ã¯VPCï¼‰ã«ãŠã‘ã‚‹NATï¼ˆé™çš„NATï¼‰ã®æ©Ÿèƒ½ã‚’æŒã¤ï¼ä¸€ã¤ã®ãƒ‘ãƒ–ãƒªãƒƒã‚¯IPã«å¯¾ã—ã¦ï¼Œä¸€ã¤ã®EC2ã®ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆIPã‚’ç´ä»˜ã‘ã‚‰ã‚Œã‚‹ï¼NATï¼ˆé™çš„NATï¼‰ã«ã¤ã„ã¦ã¯ï¼Œä»¥ä¸‹ã®ãƒªãƒ³ã‚¯ã‚’å‚è€ƒã«ã›ã‚ˆï¼ å‚è€ƒï¼šhhttps://hiroki-it.github.io/tech-notebook-gitbook/public/network/network_osi_tcp_model.html.html ãƒ»NAT Gatewayã¨ã¯ NAPTï¼ˆå‹•çš„NATï¼‰ã®æ©Ÿèƒ½ã‚’æŒã¤ï¼ä¸€ã¤ã®ãƒ‘ãƒ–ãƒªãƒƒã‚¯IPã«å¯¾ã—ã¦ï¼Œè¤‡æ•°ã®EC2ã®ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆIPã‚’ç´ä»˜ã‘ã‚‰ã‚Œã‚‹ï¼ãƒ‘ãƒ–ãƒªãƒƒã‚¯ã‚µãƒ–ãƒãƒƒãƒˆã«ç½®ãï¼Œãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆã‚µãƒ–ãƒãƒƒãƒˆã®EC2ã‹ã‚‰ã®ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’å—ã‘ä»˜ã‘ã‚‹ï¼NAPTï¼ˆå‹•çš„NATï¼‰ã«ã¤ã„ã¦ã¯ï¼Œä»¥ä¸‹ã®ãƒªãƒ³ã‚¯ã‚’å‚è€ƒã«ã›ã‚ˆï¼ å‚è€ƒï¼šhhttps://hiroki-it.github.io/tech-notebook-gitbook/public/network/network_osi_tcp_model.html.html ãƒ»æ¯”è¼ƒè¡¨ Internet Gateway NAT Gateway æ©Ÿèƒ½ ã‚°ãƒ­ãƒ¼ãƒãƒ«ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã¨ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯é–“ï¼ˆã“ã“ã§ã¯VPCï¼‰ã«ãŠã‘ã‚‹NATï¼ˆé™çš„NATï¼‰ NAPTï¼ˆå‹•çš„NATï¼‰ è¨­ç½®å ´æ‰€ VPCä¸Š ãƒ‘ãƒ–ãƒªãƒƒã‚¯ã‚µãƒ–ãƒãƒƒãƒˆå†… Route Tableï¼ˆ= ãƒãƒƒãƒ”ãƒ³ã‚°ãƒ†ãƒ¼ãƒ–ãƒ«ï¼‰ ãƒ»ãƒ«ãƒ¼ãƒˆãƒ†ãƒ¼ãƒ–ãƒ«ã¨ã¯ ã‚¯ãƒ©ã‚¦ãƒ‰ãƒ«ãƒ¼ã‚¿ã®ãƒãƒƒãƒ”ãƒ³ã‚°ãƒ†ãƒ¼ãƒ–ãƒ«ã¨ã—ã¦åƒãï¼ãƒ«ãƒ¼ã‚¿ã«ã¤ã„ã¦ã¯ï¼Œåˆ¥ãƒãƒ¼ãƒˆã®NATã¨NAPTã‚’å‚è€ƒã«ã›ã‚ˆï¼ Destinationï¼ˆãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆIPã®ç¯„å›²ï¼‰ Target xx.x.x.x/xx Destinationã®ç¯„å›²å†…ã ã£ãŸå ´åˆã®é€ä¿¡å…ˆ ãƒ»ãƒ«ãƒ¼ãƒˆãƒ†ãƒ¼ãƒ–ãƒ«ã®ç¨®é¡ ç¨®é¡ èª¬æ˜ ãƒ¡ã‚¤ãƒ³ãƒ«ãƒ¼ãƒˆãƒ†ãƒ¼ãƒ–ãƒ« VPCã®æ§‹ç¯‰æ™‚ã«è‡ªå‹•ã§æ§‹ç¯‰ã•ã‚Œã‚‹ï¼ã©ã®ãƒ«ãƒ¼ãƒˆãƒ†ãƒ¼ãƒ–ãƒ«ã«ã‚‚ç´ä»˜ã‘ã‚‰ã‚Œã¦ã„ãªã„ã‚µãƒ–ãƒãƒƒãƒˆã®ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã‚’è¨­å®šã™ã‚‹ï¼ ã‚«ã‚¹ã‚¿ãƒ ãƒ«ãƒ¼ãƒˆãƒ†ãƒ¼ãƒ–ãƒ« ç‰¹å®šã®ã‚µãƒ–ãƒãƒƒãƒˆã®ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã‚’è¨­å®šã™ã‚‹ï¼ ãƒ»ä¾‹1 ä¸Šã®å›³ä¸­ã§ï¼Œã‚µãƒ–ãƒãƒƒãƒˆ2ã«ã¯ãƒ«ãƒ¼ãƒˆãƒ†ãƒ¼ãƒ–ãƒ«1ãŒç´ä»˜ã‘ã‚‰ã‚Œã¦ã„ã‚‹ï¼ã‚µãƒ–ãƒãƒƒãƒˆ2å†…ã®EC2ã®é€ä¿¡å…ˆã®ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆIPã‚¢ãƒ‰ãƒ¬ã‚¹ãŒï¼Œ10.0.0.0/16ã®ç¯„å›²å†…ã«ã‚ã‚Œã°ï¼Œã‚¤ãƒ³ãƒã‚¦ãƒ³ãƒ‰é€šä¿¡ã¨è¦‹ãªã—ï¼Œlocalï¼ˆVPCå†…ã®ä»–ã‚µãƒ–ãƒãƒƒãƒˆï¼‰ã‚’é€ä¿¡å…ˆã«é¸ã³ï¼Œç¯„å›²å¤–ã«ã‚ã‚Œã°é€šä¿¡ã‚’ç ´æ£„ã™ã‚‹ï¼ Destinationï¼ˆãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆIPã‚¢ãƒ‰ãƒ¬ã‚¹ç¯„å›²ï¼‰ Target 10.0.0.0/16 local æŒ‡å®šç¯„å›²ä»¥å¤–ã®å ´åˆ é€šä¿¡ç ´æ£„ ãƒ»ä¾‹2 ä¸Šã®å›³ä¸­ã§ï¼Œã‚µãƒ–ãƒãƒƒãƒˆ3ã«ã¯ãƒ«ãƒ¼ãƒˆãƒ†ãƒ¼ãƒ–ãƒ«2ãŒç´ä»˜ã‘ã‚‰ã‚Œã¦ã„ã‚‹ï¼ã‚µãƒ–ãƒãƒƒãƒˆ3å†…ã®EC2ã®é€ä¿¡å…ˆã®ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆIPã‚¢ãƒ‰ãƒ¬ã‚¹ãŒï¼Œ10.0.0.0/16ã®ç¯„å›²å†…ã«ã‚ã‚Œã°ï¼Œã‚¤ãƒ³ãƒã‚¦ãƒ³ãƒ‰é€šä¿¡ã¨è¦‹ãªã—ï¼Œlocalï¼ˆVPCå†…ã®ä»–ã‚µãƒ–ãƒãƒƒãƒˆï¼‰ã‚’é€ä¿¡å…ˆã«é¸ã³ï¼Œ0.0.0.0/0ï¼ˆlocalä»¥å¤–ã®å…¨IPã‚¢ãƒ‰ãƒ¬ã‚¹ï¼‰ã®ç¯„å›²å†…ã«ã‚ã‚Œã°ï¼Œã‚¢ã‚¦ãƒˆãƒã‚¦ãƒ³ãƒ‰é€šä¿¡ã¨è¦‹ãªã—ï¼Œã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆã‚²ãƒ¼ãƒˆã‚¦ã‚§ã‚¤ã‚’é€ä¿¡å…ˆã«é¸ã¶ï¼ Destinationï¼ˆãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆIPã‚¢ãƒ‰ãƒ¬ã‚¹ç¯„å›²ï¼‰ Target 10.0.0.0/16 local 0.0.0.0/0 Internet Gateway Network ACLï¼šNetwork Access Control List ãƒ»Network ACLã¨ã¯ ã‚µãƒ–ãƒãƒƒãƒˆã®ã‚¯ãƒ©ã‚¦ãƒ‰ãƒ‘ã‚±ãƒƒãƒˆãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°å‹ãƒ•ã‚¡ã‚¤ã‚¢ã‚¦ã‚©ãƒ¼ãƒ«ã¨ã—ã¦åƒãï¼ãƒ«ãƒ¼ãƒˆãƒ†ãƒ¼ãƒ–ãƒ«ã¨ã‚µãƒ–ãƒãƒƒãƒˆã®é–“ã«è¨­ç½®ã•ã‚Œï¼ŒåŒæ–¹å‘ã®ã‚¤ãƒ³ãƒã‚¦ãƒ³ãƒ‰ãƒ«ãƒ¼ãƒ«ã¨ã‚¢ã‚¦ãƒˆãƒã‚¦ãƒ³ãƒ‰ãƒ«ãƒ¼ãƒ«ã‚’æ±ºå®šã™ã‚‹ï¼ ãƒ»ACLãƒ«ãƒ¼ãƒ« ãƒ«ãƒ¼ãƒ«ã¯ä¸Šã‹ã‚‰é †ã«é©ç”¨ã•ã‚Œã‚‹ï¼ä¾‹ãˆã°ï¼Œã‚¤ãƒ³ãƒã‚¦ãƒ³ãƒ‰ãƒ«ãƒ¼ãƒ«ãŒä»¥ä¸‹ã ã£ãŸå ´åˆï¼Œãƒ«ãƒ¼ãƒ«100ãŒæœ€åˆã«é©ç”¨ã•ã‚Œï¼Œã‚µãƒ–ãƒãƒƒãƒˆã«å¯¾ã™ã‚‹ï¼Œå…¨IPã‚¢ãƒ‰ãƒ¬ã‚¹ï¼ˆ0.0.0.0/0ï¼‰ã‹ã‚‰ã®ã‚¤ãƒ³ãƒã‚¦ãƒ³ãƒ‰é€šä¿¡ã‚’è¨±å¯ã—ã¦ã„ã‚‹ã“ã¨ã«ãªã‚‹ï¼ ãƒ«ãƒ¼ãƒ« # ã‚¿ã‚¤ãƒ— ãƒ—ãƒ­ãƒˆã‚³ãƒ« ãƒãƒ¼ãƒˆç¯„å›² / ICMP ã‚¿ã‚¤ãƒ— ã‚½ãƒ¼ã‚¹ è¨±å¯ / æ‹’å¦ 100 ã™ã¹ã¦ã® ãƒˆãƒ©ãƒ•ã‚£ãƒƒã‚¯ ã™ã¹ã¦ ã™ã¹ã¦ 0.0.0.0/0 ALLOW * ã™ã¹ã¦ã® ãƒˆãƒ©ãƒ•ã‚£ãƒƒã‚¯ ã™ã¹ã¦ ã™ã¹ã¦ 0.0.0.0/0 DENY VPCã‚µãƒ–ãƒãƒƒãƒˆ ã‚¯ãƒ©ã‚¦ãƒ‰ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã«ãŠã‘ã‚‹ã‚»ã‚°ãƒ¡ãƒ³ãƒˆã¨ã—ã¦åƒãï¼ ãƒ»ãƒ‘ãƒ–ãƒªãƒƒã‚¯ã‚µãƒ–ãƒãƒƒãƒˆã¨ã¯ éæ­¦è£…åœ°å¸¯ã«ç›¸å½“ã™ã‚‹ï¼æ”»æ’ƒã®å½±éŸ¿ãŒå†…éƒ¨ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã«åºƒãŒã‚‹å¯èƒ½æ€§ã‚’é˜²ããŸã‚ã«ï¼Œå¤–éƒ¨ã‹ã‚‰ç›´æ¥ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’å—ã‘ã‚‹ï¼Œ ãƒ»ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆã‚µãƒ–ãƒãƒƒãƒˆã¨ã¯ å†…éƒ¨ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã«ç›¸å½“ã™ã‚‹ï¼å¤–éƒ¨ã‹ã‚‰ç›´æ¥ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’å—ã‘ãšã«ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’è¿”ã›ã‚‹ã‚ˆã†ã«ï¼Œå†…ã®NATã‚’çµŒç”±ã•ã›ã‚‹å¿…è¦ãŒã‚ã‚‹ï¼ ãƒ»ã‚µãƒ–ãƒãƒƒãƒˆã®ç¨®é¡ ã‚µãƒ–ãƒãƒƒãƒˆã«ã¯ï¼Œå½¹å‰²ã”ã¨ã«ã„ãã¤ã‹ç¨®é¡ãŒã‚ã‚‹ï¼ åå‰ å½¹å‰² Public subnet (Frontend Subnet) NATGatewayã‚’é…ç½®ã™ã‚‹ï¼ Private app subnet ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ï¼ŒNginxãªã©ã‚’é…ç½®ã™ã‚‹ï¼ Private datastore subnet RDSï¼ŒRedisãªã©ã‚’é…ç½®ã™ã‚‹ VPCã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ ãƒ»æ¦‚è¦ VPCã®ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆã‚µãƒ–ãƒãƒƒãƒˆå†…ã®ãƒªã‚½ãƒ¼ã‚¹ãŒï¼ŒVPCå¤–ã®ãƒªã‚½ãƒ¼ã‚¹ã«å¯¾ã—ã¦ï¼Œã‚¢ã‚¦ãƒˆãƒã‚¦ãƒ³ãƒ‰é€šä¿¡ã‚’å®Ÿè¡Œã§ãã‚‹ã‚ˆã†ã«ã™ã‚‹ï¼Gatewayå‹ã¨Interfaceå‹ãŒã‚ã‚‹ï¼VPCã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã‚’ä½¿ç”¨ã—ãªã„å ´åˆï¼Œãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆã‚µãƒ–ãƒãƒƒãƒˆå†…ã‹ã‚‰ã®ã‚¢ã‚¦ãƒˆãƒã‚¦ãƒ³ãƒ‰é€šä¿¡ã«ã¯ï¼Œã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆã‚²ãƒ¼ãƒˆã‚¦ã‚§ã‚¤ã¨NAT Gatewayã‚’ä½¿ç”¨ã™ã‚‹å¿…è¦ãŒã‚ã‚‹ï¼ ï¼Šï¼ˆä¾‹ï¼‰ï¼Š ECS Fargateã‚’ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆã‚µãƒ–ãƒãƒƒãƒˆã«ç½®ã„ãŸå ´åˆã«ï¼ŒECS Fargateã‹ã‚‰VPCå¤–ã«ã‚ã‚‹AWSãƒªã‚½ãƒ¼ã‚¹ã«å¯¾ã™ã‚‹ã‚¢ã‚¦ãƒˆãƒã‚¦ãƒ³ãƒ‰ãªé€šä¿¡ã®ãŸã‚ã«å¿…è¦ï¼ï¼ˆä¾‹ï¼šCloudWatchãƒ­ã‚°ï¼ŒECRï¼ŒS3ï¼ŒSSMï¼‰ ãƒ»ãƒ¡ãƒªãƒƒãƒˆ ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆã‚²ãƒ¼ãƒˆã‚¦ã‚§ã‚¤ã¨NAT Gatewayã®ä»£ã‚ã‚Šã«ï¼ŒVPCã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã‚’ä½¿ç”¨ã™ã‚‹ã¨ï¼Œæ–™é‡‘ãŒå°‘ã—ã ã‘å®‰ããªã‚Šï¼Œã¾ãŸï¼ŒVPCå¤–ã®ãƒªã‚½ãƒ¼ã‚¹ã¨ã®é€šä¿¡ãŒã‚ˆã‚Šå®‰å…¨ã«ãªã‚‹ï¼ ãƒ»ã‚¿ã‚¤ãƒ— ã‚¿ã‚¤ãƒ— èª¬æ˜ ãƒªã‚½ãƒ¼ã‚¹ä¾‹ Interfaceå‹ ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆãƒªãƒ³ã‚¯ã¨ã‚‚ã„ã†ï¼ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆIPã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’æŒã¤ENIã¨ã—ã¦æ©Ÿèƒ½ã—ï¼ŒAWSãƒªã‚½ãƒ¼ã‚¹ã‹ã‚‰ã‚¢ã‚¦ãƒˆãƒã‚¦ãƒ³ãƒ‰ãªé€šä¿¡ã‚’å—ä¿¡ã™ã‚‹ï¼ S3ï¼ŒDynamoDBä»¥å¤–ã®å…¨ã¦ã®ãƒªã‚½ãƒ¼ã‚¹ Gatewayå‹ ãƒ«ãƒ¼ãƒˆãƒ†ãƒ¼ãƒ–ãƒ«ã«ãŠã‘ã‚‹å®šç¾©ã«å¾“ã†ï¼VPCã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã¨ã—ã¦æ©Ÿèƒ½ã—ï¼ŒAWSãƒªã‚½ãƒ¼ã‚¹ã‹ã‚‰ã‚¢ã‚¦ãƒˆãƒã‚¦ãƒ³ãƒ‰ãªé€šä¿¡ã‚’å—ä¿¡ã™ã‚‹ï¼ S3ï¼ŒDynamoDBã®ã¿ ENIï¼šElastic Network Interface ãƒ»ENIã¨ã¯ ã‚¯ãƒ©ã‚¦ãƒ‰ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã¨ã—ã¦åƒãï¼ç‰©ç†ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã«ãŠã‘ã‚‹NICã«ã¤ã„ã¦ã¯ä»¥ä¸‹ã‚’å‚è€ƒã«ã›ã‚ˆï¼ å‚è€ƒï¼šhhttps://hiroki-it.github.io/tech-notebook-gitbook/public/network/network_osi_tcp_model.html.html ãƒ»ç´ä»˜ã‘ã‚‰ã‚Œã‚‹ãƒªã‚½ãƒ¼ã‚¹ ãƒªã‚½ãƒ¼ã‚¹ã®ç¨®é¡ å½¹å‰² è£œè¶³ ALB ENIã«ç´ä»˜ã‘ã‚‰ã‚ŒãŸãƒ‘ãƒ–ãƒªãƒƒã‚¯IPã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’ALBã«å‰²ã‚Šå½“ã¦ã‚‰ã‚Œã‚‹ï¼ EC2 ENIã«ç´ä»˜ã‘ã‚‰ã‚ŒãŸãƒ‘ãƒ–ãƒªãƒƒã‚¯IPã‚¢ãƒ‰ãƒ¬ã‚¹ãŒEC2ã«å‰²ã‚Šå½“ã¦ã‚‰ã‚Œã‚‹ï¼ å‚è€ƒï¼šhttps://docs.aws.amazon.com/ja_jp/AWSEC2/latest/UserGuide/using-eni.html#eni-basics Fargateç’°å¢ƒã®EC2 æ˜è¨€ã•ã‚Œã¦ã„ãªã„ãŸã‚æ¨æ¸¬ã§ã¯ã‚ã‚‹ãŒï¼ŒENIã«ç´ä»˜ã‘ã‚‰ã‚ŒãŸlocalã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ãŒFargateç’°å¢ƒã§ã‚³ãƒ³ãƒ†ãƒŠã®ãƒ›ã‚¹ãƒˆã¨ãªã‚‹EC2ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã«å‰²ã‚Šå½“ã¦ã‚‰ã‚Œã‚‹ï¼ Fargateç’°å¢ƒã®ãƒ›ã‚¹ãƒˆãŒEC2ã¨ã¯æ˜è¨€ã•ã‚Œã¦ã„ãªã„ï¼å‚è€ƒï¼šhttps://aws.amazon.com/jp/blogs/news/under-the-hood-fargate-data-plane/ Elastic IP ENIã«Elastic IPã‚¢ãƒ‰ãƒ¬ã‚¹ãŒç´ä»˜ã‘ã‚‰ã‚Œã‚‹ï¼ã“ã®ENIã‚’ä»–ã®AWSãƒªã‚½ãƒ¼ã‚¹ã«ç´ä»˜ã‘ã‚‹ã“ã¨ã«ã‚ˆã‚Šï¼ŒENIã‚’ä»‹ã—ã¦ï¼ŒElastic IPã‚’ç´ä»˜ã‘ã‚‰ã‚Œã‚‹ï¼ å‚è€ƒï¼šhttps://docs.aws.amazon.com/ja_jp/AWSEC2/latest/UserGuide/using-eni.html#managing-network-interface-ip-addresses GlobalAccelerator NAT Gateway ENIã«ç´ä»˜ã‘ã‚‰ã‚ŒãŸãƒ‘ãƒ–ãƒªãƒƒã‚¯IPã‚¢ãƒ‰ãƒ¬ã‚¹ãŒNAT Gatewayã«å‰²ã‚Šå½“ã¦ã‚‰ã‚Œã‚‹ï¼ RDS Security Group ENIã«ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚°ãƒ«ãƒ¼ãƒ—ãŒç´ä»˜ã‘ã‚Œã‚‹ï¼ã“ã®ENIã‚’ä»–ã®AWSãƒªã‚½ãƒ¼ã‚¹ã«ç´ä»˜ã‘ã‚‹ã“ã¨ã«ã‚ˆã‚Šï¼ŒENIã‚’ä»‹ã—ã¦ï¼Œã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚°ãƒ«ãƒ¼ãƒ—ã‚’ç´ä»˜ã‘ã‚‰ã‚Œã‚‹ï¼ VPCã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ Interfaceå‹ã®VPCã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã¨ã—ã¦æ©Ÿèƒ½ã™ã‚‹ï¼ IPã‚¢ãƒ‰ãƒ¬ã‚¹ ãƒ»ç¨®é¡ IPã‚¢ãƒ‰ãƒ¬ã‚¹ã®ç¨®é¡ èª¬æ˜ è‡ªå‹•å‰²ã‚Šå½“ã¦ãƒ‘ãƒ–ãƒªãƒƒã‚¯IPã‚¢ãƒ‰ãƒ¬ã‚¹ï¼ˆå‹•çš„IPã‚¢ãƒ‰ãƒ¬ã‚¹ï¼‰ å‹•çš„ãªIPã‚¢ãƒ‰ãƒ¬ã‚¹ã§ï¼ŒEC2ã®å†æ§‹ç¯‰å¾Œã«å¤‰åŒ–ã™ã‚‹ï¼ Elastic IPï¼ˆé™çš„IPã‚¢ãƒ‰ãƒ¬ã‚¹ï¼‰ é™çš„ãªIPã‚¢ãƒ‰ãƒ¬ã‚¹ã§ï¼Œå†æ§‹ç¯‰å¾Œã‚‚ä¿æŒã•ã‚Œã‚‹ï¼ ãƒ»ç´ä»˜ã‘ ç¨®é¡ è£œè¶³ ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã¨ã®ç´ä»˜ã‘ éæ¨å¥¨ã®æ–¹æ³•ã§ã‚ã‚‹ï¼å‚è€ƒï¼šhttps://docs.aws.amazon.com/ja_jp/vpc/latest/userguide/vpc-eips.html#vpc-eip-overview ENIã¨ã®ç´ä»˜ã‘ æ¨å¥¨ã•ã‚Œã‚‹æ–¹æ³•ã§ã‚ã‚‹ï¼å‚è€ƒï¼šhttps://docs.aws.amazon.com/ja_jp/vpc/latest/userguide/vpc-eips.html#vpc-eip-overview VPCã®CIDRè¨­è¨ˆã®æ‰‹é † ä¸€ã¤ã®VPCå†…ã«ã¯è¤‡æ•°ã®ã‚µãƒ–ãƒãƒƒãƒˆãŒå…¥ã‚‹ï¼ãã®ãŸã‚ï¼Œã‚µãƒ–ãƒãƒƒãƒˆã®IPã‚¢ãƒ‰ãƒ¬ã‚¹ç¯„å›²ã¯ï¼Œã‚µãƒ–ãƒãƒƒãƒˆã®å€‹æ•°ã ã‘å«ã‚ãªã‘ã‚Œã°ãªã‚‰ãªã„ï¼ã¾ãŸï¼ŒVPCãŒã‚‚ã¤IPã‚¢ãƒ‰ãƒ¬ã‚¹ç¯„å›²ã‹ã‚‰ï¼ŒVPCå†…ã®å„AWSãƒªã‚½ãƒ¼ã‚¹ã«IPã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’å‰²ã‚Šå½“ã¦ã¦ã„ã‹ãªã‘ã‚Œã°ãªã‚‰ãªã„ï¼VPCå†…ã§IPã‚¢ãƒ‰ãƒ¬ã‚¹ãŒæ¯æ¸‡ã—ãªã„ã‚ˆã†ã«ï¼Œä»¥ä¸‹ã®æ‰‹é †ã§ï¼Œå‰²ã‚Šå½“ã¦ã‚’è€ƒãˆã‚‹ï¼ å‚è€ƒï¼šhttps://note.com/takashi_sakurada/n/n502fb0299938 ï¼ˆï¼‘ï¼‰RFC1918ã®æ¨å¥¨ã™ã‚‹10.0.0.0/8ï¼Œ172.16.0.0/12ï¼Œ192.168.0.0/16ã‚’ä½¿ç”¨ã™ã‚‹ï¼VPCã®CIDRè¨­è¨ˆã§ã¯ï¼Œã“ã‚Œã‚‰ã®ç¯„å›²ã«å«ã¾ã‚Œã‚‹IPã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’ä½¿ç”¨ã™ã‚‹ã‚ˆã†ã«ã™ã‚‹ï¼ RFC1918æ¨å¥¨ã®IPã‚¢ãƒ‰ãƒ¬ã‚¹ç¯„å›² IPã‚¢ãƒ‰ãƒ¬ã‚¹ å€‹æ•° 10.0.0.0/8 10.0.0.0 ~ 10.255.255.255 16777216 172.16.0.0/12 172.16.0.0 ~ 172.31.255.255 1048576 192.168.0.0/16 192.168.0.0 ~ 192.168.255.255 65536 ï¼ˆï¼’ï¼‰ã‚ã‚‰ã‹ã˜ã‚ï¼Œä¼šç¤¾å†…ã®å…¨ã¦ã®ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®CIDRã‚’ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆãªã©ã§ä¸€æ‹¬ã§ç®¡ç†ã—ã¦ãŠãï¼ ï¼ˆï¼“ï¼‰å„ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³é–“ã§Transit Gatewayã‚„ãƒ”ã‚¢ãƒªãƒ³ã‚°æ¥ç¶šã‚’å®Ÿè¡Œã™ã‚‹å¯èƒ½æ€§ãŒã‚ã‚‹å ´åˆã¯ï¼æ‹¡å¼µæ€§ã‚’è€ƒæ…®ã—ã¦ï¼Œã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³é–“ã®CIDRã¯é‡ãªã‚‰ãªã„ã‚ˆã†ã«ã—ã¦ãŠãå¿…è¦ãŒã‚ã‚‹ï¼ä¾‹ãˆã°ï¼Œä»¥å‰ã«é–‹ç™ºã—ãŸã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãŒ10.200.47.0ã¾ã§ã‚’ä½¿ç”¨ã—ã¦ã„ãŸå ´åˆï¼Œ10.200.48.0ã‹ã‚‰ä½¿ç”¨ã‚’å§‹ã‚ã‚‹ï¼ã¾ãŸï¼ŒVPCã§è¨±å¯ã•ã‚Œã‚‹IPã‚¢ãƒ‰ãƒ¬ã‚¹ã®å€‹æ•°ã¯æœ€å¤š65536å€‹ï¼ˆ/16ï¼‰ã§æœ€å°‘16å€‹ï¼ˆ/28ï¼‰ã§ã‚ã‚Šï¼Œå®Ÿéš›ã¯512å€‹ï¼ˆ/23ï¼‰ã»ã©ã‚ã‚Œã°å•é¡Œãªã„ãŸã‚ï¼Œ10.200.48.0/23ã‚’è¨­å®šã™ã‚‹ï¼ å‚è€ƒï¼šhttps://docs.aws.amazon.com/ja_jp/vpc/latest/userguide/VPC_Subnets.html#SubnetRouting ï¼ˆï¼”ï¼‰VPCã®IPã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’ãƒ‘ãƒ–ãƒªãƒƒã‚¯ã‚µãƒ–ãƒãƒƒãƒˆã¨ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆã‚µãƒ–ãƒãƒƒãƒˆã‚’å‰²ã‚Šå½“ã¦ã‚‹ï¼ãƒ‘ãƒ–ãƒªãƒƒã‚¯ã‚µãƒ–ãƒãƒƒãƒˆã¨ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆã‚µãƒ–ãƒãƒƒãƒˆã‚’å†—é•·åŒ–ã™ã‚‹å ´åˆã¯ï¼ŒVPCã®IPã‚¢ãƒ‰ãƒ¬ã‚¹æ•°ã‚’ã‚µãƒ–ãƒãƒƒãƒˆæ•°ã§å‰²ã£ã¦å„ã‚µãƒ–ãƒãƒƒãƒˆã®IPã‚¢ãƒ‰ãƒ¬ã‚¹æ•°ã‚’ç®—å‡ºã—ï¼ŒCIDRãƒ–ãƒ­ãƒƒã‚¯ã‚’è¨­å®šã™ã‚‹ï¼ä¾‹ãˆã°ï¼ŒVPCã®ã‚µãƒ–ãƒãƒƒãƒˆãƒã‚¹ã‚¯ã‚’/16 ã¨ã—ã¦ã„ã‚‹å ´åˆã¯ï¼Œå„ã‚µãƒ–ãƒãƒƒãƒˆã®ã‚µãƒ–ãƒãƒƒãƒˆãƒã‚¹ã‚¯ã¯/24ã¨ã™ã‚‹ï¼ä¸€æ–¹ã§ï¼ŒVPCã‚’/23ã¨ã—ã¦ã„ã‚‹å ´åˆã¯ï¼Œå„ã‚µãƒ–ãƒãƒƒãƒˆã¯/27ã¨ã™ã‚‹ï¼ã¾ãŸï¼Œå„ã‚µãƒ–ãƒãƒƒãƒˆã®CIDRãƒ–ãƒ­ãƒƒã‚¯ã‚’åŒã˜ã«ã™ã‚‹å¿…è¦ã¯ãªãï¼Œã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãŒç¨¼åƒã™ã‚‹ã‚µãƒ–ãƒãƒƒãƒˆã«IPã‚¢ãƒ‰ãƒ¬ã‚¹æ•°ãŒã‚„ã‚„å¤šããªã‚‹ã‚ˆã†ã«ã—ï¼Œãã®åˆ†DBã®ç¨¼åƒã™ã‚‹ã‚µãƒ–ãƒãƒƒãƒˆã®IPã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’å°‘ãªãã™ã‚‹ã‚ˆã†ãªè¨­è¨ˆã§ã‚‚ã‚ˆã„ï¼ å‚è€ƒï¼šhttps://d0.awsstatic.com/events/jp/2017/summit/slide/D2T3-5.pdf ï¼ˆï¼•ï¼‰VPCå†…ã®å„AWSãƒªã‚½ãƒ¼ã‚¹ã®ç‰¹å¾´ã«åˆã‚ã›ã¦ï¼ŒIPã‚¢ãƒ‰ãƒ¬ã‚¹ç¯„å›²ã‚’å‰²ã‚Šå½“ã¦ã‚‹ï¼ å‚è€ƒï¼šhttps://dev.classmethod.jp/articles/amazon-vpc-5-tips/ AWSã‚µãƒ¼ãƒ“ã‚¹ã®ç¨®é¡ æœ€ä½é™ã®IPã‚¢ãƒ‰ãƒ¬ã‚¹æ•° ALB ALB1ã¤å½“ãŸã‚Šï¼Œ8å€‹ ã‚ªãƒ¼ãƒˆã‚¹ã‚±ãƒ¼ãƒªãƒ³ã‚° æ°´å¹³ã‚¹ã‚±ãƒ¼ãƒªãƒ³ã‚°æ™‚ã®EC2æœ€å¤§æ•°ã¨åŒã˜å€‹æ•° VPCã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ VPCã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ1ã¤å½“ãŸã‚Šï¼Œ1å€‹ ECSï¼ŒEKS Elastic Network Interface æ•°ã¨åŒã˜å€‹æ•° Lambda Elastic Network Interface æ•°ã¨åŒã˜å€‹æ•° 32-02. VPCé–“ï¼ŒVPC-ã‚ªãƒ³ãƒ—ãƒ¬é–“ã®é€šä¿¡ VPCãƒ”ã‚¢ãƒªãƒ³ã‚°æ¥ç¶š ãƒ»VPCãƒ”ã‚¢ãƒªãƒ³ã‚°æ¥ç¶šã¨ã¯ ã€ä¸€å¯¾ä¸€ã€ã®é–¢ä¿‚ã§ï¼Œã€ç•°ãªã‚‹VPCé–“ã€ã®åŒæ–¹å‘é€šä¿¡ã‚’å¯èƒ½ã«ã™ã‚‹ï¼ ãƒ»VPCãƒ”ã‚¢ãƒªãƒ³ã‚°æ¥ç¶šã®å¯å¦ ã‚¢ã‚«ã‚¦ãƒ³ãƒˆ VPCã®ã‚ã‚‹ãƒªãƒ¼ã‚¸ãƒ§ãƒ³ VPCå†…ã®CIDRãƒ–ãƒ­ãƒƒã‚¯ æ¥ç¶šã®å¯å¦ åŒã˜ï¼ç•°ãªã‚‹ åŒã˜ï¼ç•°ãªã‚‹ å…¨ã¦ç•°ãªã‚‹ ã€‡ åŒã˜ã‚‚ã®ãŒä¸€ã¤ã§ã‚‚ã‚ã‚‹ âœ• VPC ã«è¤‡æ•°ã® IPv4 CIDR ãƒ–ãƒ­ãƒƒã‚¯ãŒã‚ã‚Šï¼Œä¸€ã¤ã§ã‚‚ åŒã˜CIDR ãƒ–ãƒ­ãƒƒã‚¯ãŒã‚ã‚‹å ´åˆã¯ï¼ŒVPC ãƒ”ã‚¢ãƒªãƒ³ã‚°æ¥ç¶šã¯ã§ããªã„ï¼ ãŸã¨ãˆï¼ŒIPv6ãŒç•°ãªã£ã¦ã„ã¦ã‚‚ï¼ŒåŒæ§˜ã§ã‚ã‚‹ï¼ VPCã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã‚µãƒ¼ãƒ“ã‚¹ ãƒ»VPCã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã‚µãƒ¼ãƒ“ã‚¹ã¨ã¯ VPCã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã¨ã¯ç•°ãªã‚‹æ©Ÿèƒ½ãªã®ã§æ³¨æ„ï¼Interfaceå‹ã®VPCã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆï¼ˆãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆãƒªãƒ³ã‚¯ï¼‰ã‚’NLBã«ç´ä»˜ã‘ã‚‹ã“ã¨ã«ã‚ˆã‚Šï¼Œã€ä¸€å¯¾å¤šã€ã®é–¢ä¿‚ã§ï¼Œã€ç•°ãªã‚‹VPCé–“ã€ã®åŒæ–¹å‘é€šä¿¡ã‚’å¯èƒ½ã«ã™ã‚‹ï¼ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã®ã‚µãƒ¼ãƒ“ã‚¹åã¯ï¼Œã€com.amazonaws.vpce.ap-northeast-1.vpce-svc-xxxxxã€ã«ãªã‚‹ï¼API Gatewayã®VPCãƒªãƒ³ã‚¯ã¯ï¼ŒVPCã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã‚µãƒ¼ãƒ“ã‚¹ã«ç›¸å½“ã™ã‚‹ï¼ Transit Gateway ãƒ»Transit Gatewayã¨ã¯ ã€å¤šå¯¾å¤šã€ã®é–¢ä¿‚ã§ï¼Œã€ç•°ãªã‚‹VPCé–“ã€ã‚„ã€ã‚ªãƒ³ãƒ—ãƒ¬-VPCé–“ã€ã®åŒæ–¹å‘é€šä¿¡ã‚’å¯èƒ½ã«ã™ã‚‹ï¼ã‚¯ãƒ©ã‚¦ãƒ‰ãƒ«ãƒ¼ã‚¿ãƒ¼ã¨ã—ã¦åƒãï¼ å„ã‚µãƒ¼ãƒ“ã‚¹ã¨ã®æ¯”è¼ƒ æ©Ÿèƒ½ VPCãƒ”ã‚¢ãƒªãƒ³ã‚°æ¥ç¶š VPCã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã‚µãƒ¼ãƒ“ã‚¹ Transit gateway é€šä¿¡å¯èƒ½ãªVPCæ•° ä¸€å¯¾ä¸€ ä¸€å¯¾ä¸€ï¼Œä¸€å¯¾å¤š ä¸€å¯¾ä¸€ï¼Œä¸€å¯¾å¤šï¼Œå¤šå¯¾å¤š é€šä¿¡å¯èƒ½ãªIPã‚¢ãƒ‰ãƒ¬ã‚¹ã®ç¨®é¡ IPv4ï¼ŒIPv6 IPv4 IPv4ï¼ŒIPv6 æ¥ç¶šå¯èƒ½ãªãƒªã‚½ãƒ¼ã‚¹ åˆ¶é™ãªã— NLBã§ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã§ãã‚‹ãƒªã‚½ãƒ¼ã‚¹ã®ã¿ åˆ¶é™ãªã— CIDRãƒ–ãƒ­ãƒƒã‚¯ãŒVPCé–“ã§è¢«ã‚‹ã“ã¨ã«ã‚ˆã‚‹é€šä¿¡ã®å¯å¦ Ã— â—¯ Ã— ã‚¯ãƒ­ã‚¹ã‚¢ã‚«ã‚¦ãƒ³ãƒˆ â—¯ â—¯ â—¯ ã‚¯ãƒ­ã‚¹ãƒªãƒ¼ã‚¸ãƒ§ãƒ³ â—¯ Ã— â—¯ VPCé–“ â—¯ â—¯ â—¯ VPC-ã‚ªãƒ³ãƒ—ãƒ¬é–“ Ã— Ã— â—¯ 33. WAFï¼šWeb Applicarion Firewall è¨­å®šé …ç›® å®šç¾©ã§ãã‚‹ãƒ«ãƒ¼ãƒ«æ•°ã‚„æ–‡å­—æ•°ã«åˆ¶é™ãŒã‚ã‚‹ï¼ä»¥ä¸‹ã®ãƒªãƒ³ã‚¯ã‚’å‚è€ƒã«ã›ã‚ˆï¼ å‚è€ƒï¼šhttps://docs.aws.amazon.com/ja_jp/waf/latest/developerguide/limits.html è¨­å®šé …ç›® èª¬æ˜ è£œè¶³ Web ACLsï¼šWeb Access Control List å„ãƒˆãƒªã‚¬ãƒ¼ã¨è¨±å¯ï¼æ‹’å¦ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã®ç´ä»˜ã‘ã‚’ã€ãƒ«ãƒ¼ãƒ«ã€ã¨ã—ï¼Œã“ã‚Œã‚’ã‚»ãƒƒãƒˆã§è¨­å®šã™ã‚‹ï¼ ã‚¢ã‚¿ãƒƒãƒã™ã‚‹AWSãƒªã‚½ãƒ¼ã‚¹ã«åˆã‚ã›ã¦ï¼Œãƒªãƒ¼ã‚¸ãƒ§ãƒ³ãŒç•°ãªã‚‹ï¼ IP sets ã‚¢ã‚¯ã‚·ãƒ§ãƒ³å®Ÿè¡Œã®ãƒˆãƒªã‚¬ãƒ¼ã¨ãªã‚‹IPã‚¢ãƒ‰ãƒ¬ã‚¹ ãƒ»è¨±å¯ã™ã‚‹IPã‚¢ãƒ‰ãƒ¬ã‚¹ã¯ï¼Œæ„å‘³åˆã„ã«æ²¿ã£ã¦ç•°ãªã‚‹ã‚»ãƒƒãƒˆã¨ã—ã¦æ§‹ç¯‰ã™ã‚‹ã¹ãï¼ä¾‹ãˆã°ï¼Œç¤¾å†…IPã‚¢ãƒ‰ãƒ¬ã‚¹ã‚»ãƒƒãƒˆï¼Œå”åŠ›ä¼šç¤¾IPã‚¢ãƒ‰ãƒ¬ã‚¹ã‚»ãƒƒãƒˆï¼Œãªã©ãƒ»æ‹’å¦ã™ã‚‹IPã‚¢ãƒ‰ãƒ¬ã‚¹ã¯ã²ã¨ã¾ã¨ã‚ã«ã—ã¦ã‚‚ã‚ˆã„ï¼ Regex pattern sets ã‚¢ã‚¯ã‚·ãƒ§ãƒ³å®Ÿè¡Œã®ãƒˆãƒªã‚¬ãƒ¼ã¨ãªã‚‹URLãƒ‘ã‚¹ã®æ–‡å­—åˆ— ãƒ»è¨±å¯ï¼æ‹’å¦ã™ã‚‹æ–‡å­—åˆ—ã¯ï¼Œæ„å‘³åˆã„ã«æ²¿ã£ã¦ç•°ãªã‚‹æ–‡å­—åˆ—ã‚»ãƒƒãƒˆã¨ã—ã¦æ§‹ç¯‰ã™ã‚‹ã¹ãï¼ä¾‹ãˆã°ï¼Œãƒ¦ãƒ¼ã‚¶ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚»ãƒƒãƒˆï¼Œãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒ‘ã‚¹ã‚»ãƒƒãƒˆï¼Œãªã© Rule groups AWS Markets AWSãƒªã‚½ãƒ¼ã‚¹ vs. ã‚µã‚¤ãƒãƒ¼æ”»æ’ƒ ã‚µã‚¤ãƒãƒ¼æ”»æ’ƒã®ç¨®é¡ å¯¾æŠ—ã™ã‚‹AWSãƒªã‚½ãƒ¼ã‚¹ã®ç¨®é¡ ãƒãƒ«ã‚¦ã‚§ã‚¢ ãªã— å‚å—ï¼Œç›—è´ VPCå†…ã®ç‰¹ã«ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆã‚µãƒ–ãƒãƒƒãƒˆé–“ã®ãƒ”ã‚¢ãƒªãƒ³ã‚°æ¥ç¶šï¼VPCå¤–ã‚’ä»‹ã•ãšã«ãƒ‡ãƒ¼ã‚¿ã‚’é€å—ä¿¡ã§ãã‚‹ï¼ ãƒãƒ¼ãƒˆã‚¹ã‚­ãƒ£ãƒ³ ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚°ãƒ«ãƒ¼ãƒ— DDoS Shield ã‚¼ãƒ­ãƒ‡ã‚£ WAF ã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³ WAF XSS WAF ãƒ‡ãƒ¼ã‚¿æ¼æ´© KMSï¼ŒCloudHSM çµ„ç¹”å†…éƒ¨ã§ã®è£åˆ‡ã‚Š IAM è¨­å®šé …ç›® ãƒ»æ¦‚è¦ è¨­å®šé …ç›® èª¬æ˜ è£œè¶³ Web ACLs ã‚¢ã‚¯ã‚»ã‚¹è¨±å¯ã¨æ‹’å¦ã®ãƒ«ãƒ¼ãƒ«ã‚’å®šç¾©ã™ã‚‹ï¼ Bot Control Botã«é–¢ã™ã‚‹ã‚¢ã‚¯ã‚»ã‚¹è¨±å¯ã¨æ‹’å¦ã®ãƒ«ãƒ¼ãƒ«ã‚’å®šç¾©ã™ã‚‹ï¼ IP Sets IPã‚¢ãƒ‰ãƒ¬ã‚¹ã®å…±é€šéƒ¨å“ã‚’ç®¡ç†ã™ã‚‹ï¼ ã‚¢ã‚¯ã‚»ã‚¹ã‚’è¨±å¯ã—ãŸã„IPã‚¢ãƒ‰ãƒ¬ã‚¹ã‚»ãƒƒãƒˆã‚’ä½œæˆã™ã‚‹æ™‚ï¼Œå…¨ã¦ã®IPã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’ä¸€ã¤ã®ã‚»ãƒƒãƒˆã§ç®¡ç†ã—ã¦ã—ã¾ã†ã¨ï¼Œä½•ã®IPã‚¢ãƒ‰ãƒ¬ã‚¹ã‹ã‚ã‚‰ãªã‚ããªã£ã¦ã—ã¾ã†ï¼ãã“ã§ï¼Œè¨±å¯ã™ã‚‹IPã‚¢ãƒ‰ãƒ¬ã‚¹ã®ã‚»ãƒƒãƒˆã‚’ç¨®é¡ï¼ˆè‡ªç¤¾ï¼Œå¤–éƒ¨ã®Aç¤¾ï¼Bç¤¾ï¼Œãªã©ï¼‰ã§åˆ†å‰²ã™ã‚‹ã¨ã‚ˆã„ï¼ Regex pattern sets æ­£è¦è¡¨ç¾ãƒ‘ã‚¿ãƒ¼ãƒ³ã®å…±é€šéƒ¨å“ã‚’ç®¡ç†ã™ã‚‹ï¼ Rule groups ãƒ«ãƒ¼ãƒ«ã®å…±é€šéƒ¨å“ã‚’ç®¡ç†ã™ã‚‹ï¼ å„WAFã«åŒã˜ãƒ«ãƒ¼ãƒ«ã‚’è¨­å®šã™ã‚‹å ´åˆï¼Œãƒ«ãƒ¼ãƒ«ã‚°ãƒ«ãƒ¼ãƒ—ã‚’ä½¿ç”¨ã™ã‚‹ã¹ãã§ã‚ã‚‹ï¼ãŸã ï¼Œãƒ«ãƒ¼ãƒ«ã‚°ãƒ«ãƒ¼ãƒ—ã‚’ä½¿ç”¨ã™ã‚‹ã¨ï¼Œã“ã‚Œã‚‰ã®ãƒ«ãƒ¼ãƒ«ã‚’å…±é€šã®ãƒ¡ãƒˆãƒªã‚¯ã‚¹ã§ç›£è¦–ã—ãªã‘ã‚Œã°ãªã‚‰ãªããªã‚‹ï¼ãã®ãŸã‚ï¼Œã‚‚ã—ãƒ¡ãƒˆãƒªã‚¯ã‚¹ã‚’åˆ†ã‘ã‚‹ã®ã§ã‚ã‚Œã°ï¼Œãƒ«ãƒ¼ãƒ«ã‚°ãƒ«ãƒ¼ãƒ—ã‚’ä½¿ç”¨ã—ãªã„ã‚ˆã†ã«ã™ã‚‹ï¼ ãƒ»Web ACLs è¨­å®šé …ç›® èª¬æ˜ è£œè¶³ Overview WAFã«ã‚ˆã£ã¦è¨±å¯ï¼æ‹’å¦ã•ã‚ŒãŸãƒªã‚¯ã‚¨ã‚¹ãƒˆã®ã‚¢ã‚¯ã‚»ã‚¹ãƒ­ã‚°ã‚’ç¢ºèªã§ãã‚‹ï¼ Rules é †ç•ªã«ãƒ«ãƒ¼ãƒ«ã‚’åˆ¤å®šã—ï¼Œä¸€è‡´ã™ã‚‹ãƒ«ãƒ¼ãƒ«ãŒã‚ã‚Œã°ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚’å®Ÿè¡Œã™ã‚‹ï¼ã“ã®æ™‚ï¼Œä¸€è‡´ã™ã‚‹ãƒ«ãƒ¼ãƒ«ã®å¾Œã«ã‚ã‚‹ãƒ«ãƒ¼ãƒ«ã¯ï¼åˆ¤å®šã•ã‚Œãªã„ï¼ AWSãƒãƒãƒ¼ã‚¸ãƒ‰ãƒ«ãƒ¼ãƒ«ã«ã¤ã„ã¦ã¯ï¼Œä»¥ä¸‹ã®ãƒªãƒ³ã‚¯ã‚’å‚è€ƒã«ã›ã‚ˆï¼å‚è€ƒï¼šhttps://docs.aws.amazon.com/ja_jp/waf/latest/developerguide/aws-managed-rule-groups-list.html Associated AWS resources WAFã‚’ã‚¢ã‚¿ãƒƒãƒã™ã‚‹AWSãƒªã‚½ãƒ¼ã‚¹ã‚’è¨­å®šã™ã‚‹ï¼ CloudFrontï¼ŒALBãªã©ã«ã‚¢ã‚¿ãƒƒãƒã§ãã‚‹ï¼ Logging and metrics ã‚¢ã‚¯ã‚»ã‚¹ãƒ­ã‚°ã‚’Kinesis Data Firehoseã«å‡ºåŠ›ã™ã‚‹ã‚ˆã†ã«è¨­å®šã™ã‚‹ï¼ ãƒ»Overviewã«ãŠã‘ã‚‹Sampled requestsã®è¦‹æ–¹ ã€å…¨ã¦ã®ãƒ«ãƒ¼ãƒ«ã€ã¾ãŸã¯ã€å€‹åˆ¥ã®ãƒ«ãƒ¼ãƒ«ã€ã«ãŠã‘ã‚‹ã‚¢ã‚¯ã‚»ã‚¹è¨±å¯ï¼æ‹’å¦ã®å±¥æ­´ã‚’ç¢ºèªã§ãã‚‹ï¼ALBã‚„CloudFrontã®ã‚¢ã‚¯ã‚»ã‚¹ãƒ­ã‚°ã‚ˆã‚Šã‚‚è§£ã‚Šã‚„ã™ãï¼Œæ§˜ã€…ãªãƒ‡ãƒãƒƒã‚°ã«å½¹ç«‹ã¤ï¼ãŸã ã—ï¼Œï¼“æ™‚é–“åˆ†ã—ã‹æ®‹ã‚‰ãªã„ï¼ä¸€ä¾‹ã¨ã—ã¦ï¼ŒCloudFrontã«ã‚¢ã‚¿ãƒƒãƒã—ãŸWAFã§å–å¾—ã§ãã‚‹ãƒ­ã‚°ã‚’ä»¥ä¸‹ã«ç¤ºã™ï¼ GET /foo/ # ãƒ›ã‚¹ãƒˆ Host: example.jp Upgrade-Insecure-Requests: 1 # ãƒ¦ãƒ¼ã‚¶ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆ User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/87.0.4280.88 Safari/537.36 Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9 Sec-Fetch-Mode: navigate Sec-Fetch-User: ?1 Sec-Fetch-Dest: document # CORSã§ã‚ã‚‹ã‹å¦ã‹ Sec-Fetch-Site: same-origin Accept-Encoding: gzip, deflate, br Accept-Language: ja,en;q=0.9 # Cookieãƒ˜ãƒƒãƒ€ãƒ¼ Cookie: sessionid=; _gid=; __ulfpc=; _ga= ãƒ«ãƒ¼ãƒ« ãƒ»ãƒ«ãƒ¼ãƒ«ã®ç¨®é¡ å‚è€ƒï¼šhttps://docs.aws.amazon.com/ja_jp/waf/latest/developerguide/classic-web-acl-rules-creating.html ç¨®é¡ èª¬æ˜ ãƒ¬ãƒ¼ãƒˆãƒ™ãƒ¼ã‚¹ åŒã˜é€ä¿¡å…ƒIPã‚¢ãƒ‰ãƒ¬ã‚¹ã‹ã‚‰ã®ï¼•åˆ†é–“å½“ãŸã‚Šã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆæ•°åˆ¶é™ã‚’ãƒ«ãƒ¼ãƒ«ã«ä»˜ä¸ã™ã‚‹ï¼ ãƒ¬ã‚®ãƒ¥ãƒ©ãƒ¼ ãƒªã‚¯ã‚¨ã‚¹ãƒˆæ•°ã¯åˆ¶é™ã—ãªã„ï¼ ãƒ»ãƒ«ãƒ¼ãƒ«ã®ç²’åº¦ã®ã‚³ãƒ„ ã‚ã‹ã‚Šã‚„ã™ã•ã®è¦³ç‚¹ã‹ã‚‰ï¼Œå¯èƒ½ãªé™ã‚Šè¨­å®šã™ã‚‹ã‚¹ãƒ†ãƒ¼ãƒˆãƒ¡ãƒ³ãƒˆã‚’å°‘ãªãã—ï¼Œä¸€ã¤ã®ãƒ«ãƒ¼ãƒ«ã«ä¸€ã¤ã®æ„å‘³åˆã„ã ã‘ã‚’æŒãŸã›ã‚‹ã‚ˆã†ã«å‘½åã™ã‚‹ï¼ ãƒ»Countï¼ˆæ¤œçŸ¥ï¼‰ãƒ¢ãƒ¼ãƒ‰ ãƒ«ãƒ¼ãƒ«ã«è©²å½“ã™ã‚‹ãƒªã‚¯ã‚¨ã‚¹ãƒˆæ•°ã‚’æ•°ãˆï¼Œè¨±å¯ï¼æ‹’å¦ã›ãšã«æ¬¡ã®ãƒ«ãƒ¼ãƒ«ã‚’æ¤œè¨¼ã™ã‚‹ï¼è¨ˆæ¸¬çµæœã«å¿œã˜ã¦ï¼ŒCountãƒ¢ãƒ¼ãƒ‰ã‚’ç„¡åŠ¹åŒ–ã—ï¼Œæ‹’å¦ã§ãã‚‹ã‚ˆã†ã«ã™ã‚‹ï¼ å‚è€ƒï¼šhttps://oji-cloud.net/2020/09/18/post-5501/ ãƒ»ãƒ«ãƒ¼ãƒ«ã‚°ãƒ«ãƒ¼ãƒ—ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã®ä¸Šæ›¸ã ãƒ«ãƒ¼ãƒ«ã®Countãƒ¢ãƒ¼ãƒ‰ãŒæœ‰åŠ¹ã«ãªã£ã¦ã„ã‚‹å ´åˆã«ï¼ŒCountã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã«ç¶šã‘ã¦ï¼Œãã®ãƒ«ãƒ¼ãƒ«ã®å…ƒã€…ã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚’å®Ÿè¡Œã™ã‚‹ï¼ãã®ãŸã‚ï¼ŒCountã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã—ã¤ã¤ï¼ŒBlockã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚’å®Ÿè¡Œã§ãã‚‹ï¼ˆä»•æ§˜ãŒã‚„ã‚„ã“ã—ã™ãã‚‹ã®ã§ï¼Œãªã‚“ã¨ã‹ã—ã¦ã»ã—ã„ï¼‰ï¼ å‚è€ƒï¼šhttps://docs.aws.amazon.com/ja_jp/waf/latest/developerguide/web-acl-rule-group-override-options.html ãƒãƒãƒ¼ã‚¸ãƒ‰ãƒ«ãƒ¼ãƒ«ã®å…ƒã€…ã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ Countãƒ¢ãƒ¼ãƒ‰ ä¸Šæ›¸ãã‚ªãƒ—ã‚·ãƒ§ãƒ³ çµæœ Block ON ON Countã—ï¼Œãã®å¾ŒBlockãŒå®Ÿè¡Œã™ã‚‹ï¼ãã®ãŸã‚ï¼Œãã®å¾Œã®ãƒ«ãƒ¼ãƒ«ã¯æ¤œè¨¼ã›ãšã«çµ‚äº†ã™ã‚‹ï¼ Block ON OFF Countã®ã¿ãŒå®Ÿè¡Œã•ã‚Œã‚‹ï¼ãã®ãŸã‚ï¼Œãã®å¾Œã®ãƒ«ãƒ¼ãƒ«ã‚‚æ¤œè¨¼ã™ã‚‹ï¼ Block OFF ON ãã‚‚ãã‚‚Countãƒ¢ãƒ¼ãƒ‰ãŒç„¡åŠ¹ãªãŸã‚ï¼Œä¸Šæ›¸ãã‚ªãƒ—ã‚·ãƒ§ãƒ³ã¯æ©Ÿèƒ½ã›ãšã«ï¼ŒBlockãŒå®Ÿè¡Œã•ã‚Œã‚‹ï¼ Block OFF OFF ãã‚‚ãã‚‚Countãƒ¢ãƒ¼ãƒ‰ãŒç„¡åŠ¹ãªãŸã‚ï¼Œãƒãƒãƒ¼ã‚¸ãƒ‰ãƒ«ãƒ¼ãƒ«ã®BlockãŒå®Ÿè¡Œã•ã‚Œã‚‹ï¼ï¼ˆã¨æ€ã£ã¦ã„ãŸãŒï¼Œçµæœã¨ã—ã¦Countã¨ã—ã¦æ©Ÿèƒ½ã™ã‚‹æ¨¡æ§˜...ï¼‰ ãƒãƒãƒ¼ã‚¸ãƒ‰ãƒ«ãƒ¼ãƒ«ã‚’ä½¿ç”¨ã™ã‚‹ã‹ã©ã†ã‹ã®åˆ¤æ–­åŸºæº– ãƒ»ãƒãƒãƒ¼ã‚¸ãƒ‰ãƒ«ãƒ¼ãƒ«ã®å‹•ä½œç¢ºèªã®å¿…è¦æ€§ ãƒãƒãƒ¼ã‚¸ãƒ‰ãƒ«ãƒ¼ãƒ«ã‚’å°å…¥ã™ã‚‹æ™‚ã¯ï¼Œäº‹å‰ã«ãƒ«ãƒ¼ãƒ«ã®ã‚«ã‚¦ãƒ³ãƒˆæ©Ÿèƒ½ã‚’ä½¿ç”¨ã™ã‚‹ã“ã¨ãŒæ¨å¥¨ã•ã‚Œã¦ã„ã‚‹ï¼ã‚«ã‚¦ãƒ³ãƒˆã§æ¤œçŸ¥ã•ã‚ŒãŸãƒªã‚¯ã‚¨ã‚¹ãƒˆã®ã»ã¨ã‚“ã©ãŒæ‚ªæ„ã®ãªã„ã‚‚ã®ã§ã‚ã‚Œã°ï¼Œè¨­å®šã—ãŸãƒãƒãƒ¼ã‚¸ãƒ‰ãƒ«ãƒ¼ãƒ«ã®ä½¿ç”¨ã‚’ã‚„ã‚ã‚‹å¿…è¦ãŒã‚ã‚‹ï¼ ãƒ»ãƒ–ãƒ©ã‚¦ã‚¶ã‚’é€ä¿¡å…ƒã¨ã—ãŸå ´åˆ ãƒ–ãƒ©ã‚¦ã‚¶ã‚’é€ä¿¡å…ƒã¨ã—ãŸå ´åˆï¼Œãƒªã‚¯ã‚¨ã‚¹ãƒˆã®ãƒ˜ãƒƒãƒ€ãƒ¼ã‚„ãƒœãƒ‡ã‚£ã¯ãƒ–ãƒ©ã‚¦ã‚¶ã«ã‚ˆã£ã¦ç”Ÿæˆã•ã‚Œã‚‹ãŸã‚ï¼Œã“ã‚Œã«åŸºã¥ã„ãŸåˆ¤æ–­ãŒå¿…è¦ã§ã‚ã‚‹ï¼ ãƒ–ãƒ©ã‚¦ã‚¶ã‹ã‚‰ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆè‡ªä½“ãŒæ‚ªæ„åˆ¤å®šã•ã‚Œã¦ã„ã‚‹ã‹ã©ã†ã‹ ã‚µã‚¤ãƒˆã®URLã®è¨˜æ³•ã«ã‚ˆã£ã¦ï¼Œæ‚ªæ„åˆ¤å®šã•ã‚Œã¦ã„ã‚‹ã‹ã©ã†ã‹ é€ä¿¡å…ƒã®å›½åãŒã€æ—¥æœ¬ã€ã§ã‚ã‚‹ã®ã«ã‚‚ã‹ã‹ã‚ã‚‰ãšï¼Œæ‚ªæ„åˆ¤å®šã•ã‚Œã¦ã„ã‚‹ã‹ã©ã†ã‹ ã‚µã‚¤ãƒˆã«é€ä¿¡ã•ã‚ŒãŸå…¨ãƒªã‚¯ã‚¨ã‚¹ãƒˆã®ã†ã¡ï¼Œã‚«ã‚¦ãƒ³ãƒˆã§æ¤œçŸ¥ã•ã‚ŒãŸãƒªã‚¯ã‚¨ã‚¹ãƒˆã®æ•°ãŒå¤šã™ããªã„ã‹ã©ã†ã‹ ãƒ»é€£æºã™ã‚‹ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’é€ä¿¡å…ƒã¨ã—ãŸå ´åˆ ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’é€ä¿¡å…ƒã¨ã—ãŸå ´åˆï¼Œãƒªã‚¯ã‚¨ã‚¹ãƒˆã®ãƒ˜ãƒƒãƒ€ãƒ¼ã‚„ãƒœãƒ‡ã‚£ã¯é€£æºã™ã‚‹ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã«ã‚ˆã£ã¦ç”Ÿæˆã•ã‚Œã‚‹ãŸã‚ï¼Œã“ã‚Œã«åŸºã¥ã„ãŸåˆ¤æ–­ãŒå¿…è¦ã§ã‚ã‚‹ï¼ ãƒ«ãƒ¼ãƒ«ã®ä¾‹ ãƒ»ãƒ¦ãƒ¼ã‚¶ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆæ‹’å¦ ï¼Šä¾‹ï¼Š æ‚ªæ„ã®ã‚ã‚‹ãƒ¦ãƒ¼ã‚¶ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚’æ‹’å¦ã™ã‚‹ï¼ ãƒ«ãƒ¼ãƒ«ï¼šblock-user-agents Statementã®é †ç•ª If a request Inspect Match type Regex pattern set Then æŒ™å‹• 0 matches URI path Matches pattern from regex pattern set æ–‡å­—åˆ—ã‚»ãƒƒãƒˆ Block æŒ‡å®šã—ãŸæ–‡å­—åˆ—ã‚’å«ã‚€ãƒ¦ãƒ¼ã‚¶ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã®å ´åˆï¼Œã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ã“ã¨ã‚’æ‹’å¦ã™ã‚‹ï¼ Default Action èª¬æ˜ Allow æŒ‡å®šã—ãŸãƒ¦ãƒ¼ã‚¶ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã§ãªã„å ´åˆï¼Œå…¨ã¦ã®ãƒ•ã‚¡ã‚¤ãƒ«ãƒ‘ã‚¹ã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ã“ã¨ã‚’è¨±å¯ã™ã‚‹ï¼ ãƒ»CI/CDãƒ„ãƒ¼ãƒ«ã®ã‚¢ã‚¯ã‚»ã‚¹ã‚’è¨±å¯ ï¼Šä¾‹ï¼Š ç¤¾å†…ã®é€ä¿¡å…ƒIPã‚¢ãƒ‰ãƒ¬ã‚¹ã®ã¿è¨±å¯ã—ãŸçŠ¶æ…‹ã§ï¼ŒCircleCIãªã©ã®ã‚µãƒ¼ãƒ“ã‚¹ãŒç¤¾å†…ã‚µãƒ¼ãƒ“ã‚¹ã«ã‚¢ã‚¯ã‚»ã‚¹ã§ãã‚‹ã‚ˆã†ã«ã™ã‚‹ï¼ ãƒ«ãƒ¼ãƒ«ï¼šallow-request-including-access-token Statementã®é †ç•ª If a request Inspect Header field name Match type String to match Then æŒ™å‹• 0 matches Header authorization Exactly matched string ã€Bearer ã€ã§æ–‡å­—åˆ—ã‚’è¨­å®šã™ã‚‹ Allow authorizationãƒ˜ãƒƒãƒ€ãƒ¼ã«æŒ‡å®šã—ãŸæ–‡å­—åˆ—ã‚’å«ã‚€ãƒªã‚¯ã‚¨ã‚¹ãƒˆã®å ´åˆï¼Œã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ã“ã¨ã‚’æ‹’å¦ã™ã‚‹ï¼ Default Action èª¬æ˜ Block æ­£ã—ã„ãƒˆãƒ¼ã‚¯ãƒ³ã‚’æŒãŸãªã„ã‚¢ã‚¯ã‚»ã‚¹ã®å ´åˆï¼Œå…¨ã¦ã®ãƒ•ã‚¡ã‚¤ãƒ«ãƒ‘ã‚¹ã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ã“ã¨ã‚’æ‹’å¦ã™ã‚‹ï¼ ãƒ»ç‰¹å®šã®ãƒ‘ã‚¹ã‚’ç¤¾å†…ã‚¢ã‚¯ã‚»ã‚¹ã«é™å®š ï¼Šä¾‹ï¼Š ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã«ãŠã„ã¦ï¼Œç‰¹å®šã®URLãƒ‘ã‚¹ã«ã‚¢ã‚¯ã‚»ã‚¹ã§ãã‚‹é€ä¿¡å…ƒIPã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’ï¼Œç¤¾å†…ã ã‘ã«åˆ¶é™ã™ã‚‹ï¼äºŒã¤ã®ãƒ«ãƒ¼ãƒ«ã‚’æ§‹ç¯‰ã™ã‚‹å¿…è¦ãŒã‚ã‚‹ï¼ ãƒ«ãƒ¼ãƒ«ï¼šallow-access--to-url-path Statementã®é †ç•ª If a request Inspect IP set Match type Regex pattern set Then æŒ™å‹• 0 matches (AND) Originates from an IP address in ç¤¾å†…IPã‚»ãƒƒãƒˆ - - - ç¤¾å†…ã®é€ä¿¡å…ƒIPã‚¢ãƒ‰ãƒ¬ã‚¹ã®å ´åˆï¼ŒæŒ‡å®šã—ãŸãƒ•ã‚¡ã‚¤ãƒ«ãƒ‘ã‚¹ã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ã“ã¨ã‚’è¨±å¯ã™ã‚‹ï¼ 1 matches URI path - Matches pattern from regex pattern set æ–‡å­—åˆ—ã‚»ãƒƒãƒˆ Allow 0ç•ªç›®ã‹ã¤ï¼ŒæŒ‡å®šã—ãŸæ–‡å­—åˆ—ã‚’å«ã‚€URLãƒ‘ã‚¹ã‚¢ã‚¯ã‚»ã‚¹ã®å ´åˆï¼Œã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ã“ã¨ã‚’è¨±å¯ã™ã‚‹ï¼ ãƒ«ãƒ¼ãƒ«ï¼šblock-access-to-url-path Statementã®é †ç•ª If a request Inspect Match type Regex pattern set Then æŒ™å‹• 0 matches URI path Matches pattern from regex pattern set æ–‡å­—åˆ—ã‚»ãƒƒãƒˆ Block æŒ‡å®šã—ãŸæ–‡å­—åˆ—ã‚’å«ã‚€URLãƒ‘ã‚¹ã‚¢ã‚¯ã‚»ã‚¹ã®å ´åˆï¼Œã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ã“ã¨ã‚’æ‹’å¦ã™ã‚‹ï¼ Default Action èª¬æ˜ Allow æŒ‡å®šã—ãŸURLãƒ‘ã‚¹ä»¥å¤–ã®ã‚¢ã‚¯ã‚»ã‚¹ã®å ´åˆï¼Œãã®ãƒ‘ã‚¹ã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ã“ã¨ã‚’è¨±å¯ã™ã‚‹ï¼ ãƒ»ç¤¾å†…ã‚¢ã‚¯ã‚»ã‚¹ã«é™å®š ï¼Šä¾‹ï¼Š ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å…¨ä½“ã«ã‚¢ã‚¯ã‚»ã‚¹ã§ãã‚‹é€ä¿¡å…ƒIPã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’ï¼Œç‰¹å®šã®IPã‚¢ãƒ‰ãƒ¬ã‚¹ã ã‘ã«åˆ¶é™ã™ã‚‹ï¼ ãƒ«ãƒ¼ãƒ«ï¼šallow-global-ip-addresses Statementã®é †ç•ª If a request Inspect IP set Originating address Then æŒ™å‹• 0 matches (OR) Originates from an IP address in ç¤¾å†…IPã‚»ãƒƒãƒˆ Source IP address - ç¤¾å†…ã®é€ä¿¡å…ƒIPã‚¢ãƒ‰ãƒ¬ã‚¹ã®å ´åˆï¼Œå…¨ã¦ã®ãƒ•ã‚¡ã‚¤ãƒ«ãƒ‘ã‚¹ã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ã“ã¨ã‚’è¨±å¯ã™ã‚‹ï¼ 1 matches Originates from an IP address in å”åŠ›ä¼šç¤¾IPã‚»ãƒƒãƒˆ Source IP address Allow 0ç•ªç›®ã‚ã‚‹ã„ã¯ï¼Œå”åŠ›ä¼šç¤¾ã®é€ä¿¡å…ƒIPã‚¢ãƒ‰ãƒ¬ã‚¹ã®å ´åˆï¼Œå…¨ã¦ã®ãƒ•ã‚¡ã‚¤ãƒ«ãƒ‘ã‚¹ã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ã“ã¨ã‚’è¨±å¯ã™ã‚‹ï¼ Default Action èª¬æ˜ Block æŒ‡å®šã—ãŸé€ä¿¡å…ƒIPã‚¢ãƒ‰ãƒ¬ã‚¹ä»¥å¤–ã®å ´åˆï¼Œå…¨ã¦ã®ãƒ•ã‚¡ã‚¤ãƒ«ãƒ‘ã‚¹ã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ã“ã¨ã‚’æ‹’å¦ã™ã‚‹ï¼ 34. WorkMail WorkMailã¨ã¯ Gmailï¼Œã‚µãƒ³ãƒ€ãƒ¼ãƒãƒ¼ãƒ‰ï¼ŒYahooãƒ¡ãƒ¼ãƒ«ãªã©ã¨åŒé¡ã®ãƒ¡ãƒ¼ãƒ«ç®¡ç†ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ï¼ è¨­å®šé …ç›® è¨­å®šé …ç›® èª¬æ˜ è£œè¶³ Users WorkMailã§ç®¡ç†ã™ã‚‹ãƒ¦ãƒ¼ã‚¶ã‚’è¨­å®šã™ã‚‹ï¼ Domains ãƒ¦ãƒ¼ã‚¶ã«å‰²ã‚Šå½“ã¦ã‚‹ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã®ãƒ‰ãƒ¡ã‚¤ãƒ³åã‚’è¨­å®šã™ã‚‹ï¼ @{çµ„ç¹”å}.awsapps.comã‚’ãƒ‰ãƒ¡ã‚¤ãƒ³åã¨ã—ã¦ã‚‚ã‚‰ãˆã‚‹ï¼ãƒ‰ãƒ¡ã‚¤ãƒ³åã®æ¤œè¨¼ãŒå®Œäº†ã—ãŸç‹¬è‡ªãƒ‰ãƒ¡ã‚¤ãƒ³åã‚’è¨­å®šã™ã‚‹ã“ã¨ã‚‚ã§ãã‚‹ï¼ Access Controle rules å—ä¿¡ã™ã‚‹ãƒ¡ãƒ¼ãƒ«ï¼Œå—ä¿¡ã‚’é®æ–­ã™ã‚‹ãƒ¡ãƒ¼ãƒ«ï¼Œã®æ¡ä»¶ã‚’è¨­å®šã™ã‚‹ï¼ 35. è² è·ãƒ†ã‚¹ãƒˆ Distributed Load Testingï¼ˆåˆ†æ•£è² è·ãƒ†ã‚¹ãƒˆï¼‰ ãƒ»åˆ†æ•£è² è·ãƒ†ã‚¹ãƒˆã¨ã¯ AWSã‹ã‚‰æä¾›ã•ã‚Œã¦ã„ã‚‹è² è·ã‚’ç™ºç”Ÿã•ã›ã‚‹ã‚¤ãƒ³ãƒ•ãƒ©ç’°å¢ƒã®ã“ã¨ï¼CloudFormationã§æ§‹ç¯‰ã§ãï¼ŒFargateã‚’ä½¿ç”¨ã—ã¦ï¼Œãƒ¦ãƒ¼ã‚¶ã‹ã‚‰ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’æ“¬ä¼¼çš„ã«å†ç¾ã§ãã‚‹ï¼ å‚è€ƒï¼šhttps://d1.awsstatic.com/Solutions/ja_JP/distributed-load-testing-on-aws.pdf ãƒ»ã‚¤ãƒ³ãƒ•ãƒ©æ§‹æˆ 36. ã‚¿ã‚° ã‚¿ã‚°ä»˜ã‘æˆ¦ç•¥ ãƒ»ã‚ˆãã‚ã‚‹ã‚¿ã‚° ã‚¿ã‚°å ç”¨é€” Name ãƒªã‚½ãƒ¼ã‚¹è‡ªä½“ã«åå‰ã‚’ä»˜ã‘ã‚‰ã‚Œãªã„å ´åˆï¼Œä»£ã‚ã‚Šã«ã‚¿ã‚°ã§åä»˜ã‘ã‚‹ãŸã‚ï¼ Environment åŒä¸€ã®AWSç’°å¢ƒå†…ã«ç•°ãªã‚‹å®Ÿè¡Œç’°å¢ƒãŒå­˜åœ¨ã—ã¦ã„ã‚‹å ´åˆï¼Œãã‚Œã‚‰ã‚’åŒºåˆ¥ã™ã‚‹ãŸã‚ï¼ User åŒä¸€ã®AWSç’°å¢ƒå†…ã«ãƒªã‚½ãƒ¼ã‚¹åˆ¥ã«æ‰€æœ‰è€…ãŒå­˜åœ¨ã—ã¦ã„ã‚‹å ´åˆï¼Œãã‚Œã‚‰ã‚’åŒºåˆ¥ã™ã‚‹ãŸã‚ï¼ ãƒ»ã‚¿ã‚°ä»˜ã‘ã«ã‚ˆã‚‹ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚° AWSã®å„ãƒªã‚½ãƒ¼ã‚¹ã«ã¯ï¼Œã‚¿ã‚°ã‚’ã¤ã‘ã‚‹ã“ã¨ãŒã§ãã‚‹ï¼ä¾‹ãˆã°ï¼ŒAWSã‚³ã‚¹ãƒˆã‚¨ã‚¯ã‚¹ãƒ—ãƒ­ãƒ¼ãƒ©ãƒ¼ã«ã¦ï¼Œã“ã®ã‚¿ã‚°ã§ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°ã™ã‚‹ã“ã¨ã«ã‚ˆã‚Šï¼Œä»»æ„ã®ã‚¿ã‚°ãŒä»˜ã„ãŸãƒªã‚½ãƒ¼ã‚¹ã®è«‹æ±‚åˆè¨ˆé¡ã‚’ç¢ºèªã§ãã‚‹ï¼ "},"public/cloud_computing/cloud_computing_aws_api_gateway_import.html":{"url":"public/cloud_computing/cloud_computing_aws_api_gateway_import.html","title":"ğŸ“– ï¸API Gatewayã¸ã®ymlã‚¤ãƒ³ãƒãƒ¼ãƒˆ","keywords":"","body":"API Gatewayã¸ã®ymlã‚¤ãƒ³ãƒãƒ¼ãƒˆ ã¯ã˜ã‚ã« æœ¬ã‚µã‚¤ãƒˆã«ã¤ãã¾ã—ã¦ï¼Œä»¥ä¸‹ã‚’ã”èªè­˜ã®ã»ã©å®œã—ããŠé¡˜ã„ã„ãŸã—ã¾ã™ï¼ å‚è€ƒï¼šhttps://hiroki-it.github.io/tech-notebook-gitbook/ 01. APIGatewayæ‹¡å¼µæ©Ÿèƒ½ ãƒ»å¿…è¦ãªã‚­ãƒ¼ APIGatewayã®ã‚¤ãƒ³ãƒãƒ¼ãƒˆã«å½“ãŸã‚Šï¼ŒOpenAPIã®YAMLãƒ•ã‚¡ã‚¤ãƒ«ã«ã‚­ãƒ¼ã‚’æ–°ãŸã«å®Ÿè£…ã™ã‚‹å¿…è¦ãŒã‚ã‚‹ï¼ å‚è€ƒï¼šhttps://docs.aws.amazon.com/ja_jp/apigateway/latest/developerguide/api-gateway-swagger-extensions.html x-amazon-apigateway-integrationã‚­ãƒ¼ ãƒ»x-amazon-apigateway-integrationã‚­ãƒ¼ã¨ã¯ è©²å½“ã™ã‚‹HTTPãƒ¡ã‚½ãƒƒãƒ‰ã§çµ±åˆãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚„çµ±åˆãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’å®šç¾©ã™ã‚‹ãŸã‚ã« x-amazon-apigateway-integrationã‚­ãƒ¼ ãŒå¿…è¦ã§ã‚ã‚‹ï¼å„é …ç›®ã®èª¬æ˜ã¯ä»¥ä¸‹ã‚’å‚è€ƒã«ã›ã‚ˆï¼ å‚è€ƒï¼šhttps://docs.aws.amazon.com/ja_jp/apigateway/latest/developerguide/api-gateway-swagger-extensions-integration.html å„ç¨®ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã®ãƒãƒƒãƒ”ãƒ³ã‚°ã‚‚å¯èƒ½ã§ã‚ã‚‹ï¼ãƒ¡ã‚½ãƒƒãƒ‰ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‹ã‚‰çµ±åˆãƒªã‚¯ã‚¨ã‚¹ãƒˆã¸ã®ãƒãƒƒãƒ”ãƒ³ã‚°ã«ã¤ã„ã¦ã¯ï¼Œä»¥ä¸‹ã‚’å‚è€ƒã«ã›ã‚ˆï¼ å‚è€ƒï¼šhttps://docs.aws.amazon.com/ja_jp/apigateway/latest/developerguide/api-gateway-swagger-extensions-integration-requestParameters.html çµ±åˆãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‹ã‚‰ãƒ¡ã‚½ãƒƒãƒ‰ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã¸ã®ãƒãƒƒãƒ”ãƒ³ã‚°ã«ã¤ã„ã¦ã¯ï¼Œä»¥ä¸‹ã‚’å‚è€ƒã«ã›ã‚ˆï¼ å‚è€ƒï¼šhttps://docs.aws.amazon.com/ja_jp/apigateway/latest/developerguide/api-gateway-swagger-extensions-integration-responseParameters.html ãƒ»è¨­å®šé …ç›®ï¼ˆVPCãƒªãƒ³ã‚¯&ãƒ—ãƒ­ã‚­ã‚·çµ±åˆï¼‰ paths: /users: get: # ï½ ä¸­ç•¥ ï½ #=========================== # çµ±åˆ #=========================== x-amazon-apigateway-integration: httpMethod: \"GET\" # è»¢é€ã™ã‚‹HTTPãƒ¡ã‚½ãƒƒãƒ‰ uri: \"http:///api/v1/users/\" # è»¢é€å…ˆã®ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰URL requestParameters: integration.request.header.X-API-Key: \"'XXXXX'\" # è»¢é€ã™ã‚‹ã‚«ã‚¹ã‚¿ãƒ ãƒ˜ãƒƒãƒ€ãƒ¼ã¨APIã‚­ãƒ¼ integration.request.querystring.userId: method.request.querystring.userId # ãƒãƒƒãƒ”ãƒ³ã‚°ã™ã‚‹ã‚¯ã‚¨ãƒªãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ # ãƒ‘ã‚¹ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿é–“ã®ãƒãƒƒãƒ”ãƒ³ã‚°ã§ã‚ã‚Œã°ï¼Œintegration.request.path.userId: method.request.path.userId # ä»–ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‹ã‚‰ãƒœãƒ‡ã‚£ã¸ã®ãƒãƒƒãƒ”ãƒ³ã‚°ã§ã‚ã‚Œã°ï¼Œintegration.request.header.userId: method.request.body.userId connectionType: VPC_LINK # VPCãƒªãƒ³ã‚¯ã‚’ä½¿ç”¨ connectionId: # VPCãƒªãƒ³ã‚¯ã®ID passthroughBehavior: when_no_match # ãƒ—ãƒ­ã‚­ã‚·çµ±åˆã®å ´åˆã¯è¨­å®šã®å¤‰æ›´ä¸å¯ã§å›ºå®š type: http_proxy # ãƒ—ãƒ­ã‚­ã‚·çµ±åˆã‚’ä½¿ç”¨ responses: # ãƒ—ãƒ­ã‚­ã‚·çµ±åˆã®å ´åˆã¯è¨­å®šã®å¤‰æ›´ä¸å¯ã§å›ºå®š default: statusCode: 200 ãƒ»è¨­å®šé …ç›®ï¼ˆVPCãƒªãƒ³ã‚¯&éãƒ—ãƒ­ã‚­ã‚·çµ±åˆã®å ´åˆï¼‰ ãƒ‘ã‚¹ã‚¹ãƒ«ãƒ¼æ¡ä»¶ã‚„responseã‚­ãƒ¼ä»¥ä¸‹ã®çµ±åˆãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’è¨­å®šã§ãã‚‹ï¼ paths: /users: post: x-amazon-apigateway-integration: httpMethod: POST uri: \"http:///api/v1/users/\" requestParameters: integration.request.header.X-API-Key: \"'XXXXX'\" requestTemplates: application/json: '{\"body\" : $input.json(\"$\")}' passthroughBehavior: when_no_templates # çµ±åˆãƒªã‚¯ã‚¨ã‚¹ãƒˆã®ãƒãƒƒãƒ”ãƒ³ã‚°ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã®ãƒ‘ã‚¹ã‚¹ãƒ«ãƒ¼æ¡ä»¶ã‚’é¸æŠ connectionType: VPC_LINK connectionId: type: http # éãƒ—ãƒ­ã‚­ã‚·çµ±åˆ responses: # çµ±åˆãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’è¨­å®š 200: statusCode: 200 responseTemplates: application/json: '{\"body\" : $input.json(\"$\")}' # ãƒ¬ã‚¹ãƒãƒ³ã‚¹çµ±åˆã®ãƒãƒƒãƒ”ãƒ³ã‚°ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ 400: statusCode: 400 401: statusCode: 401 ãƒ»è¨­å®šé …ç›®ï¼ˆãƒ¢ãƒƒã‚¯çµ±åˆï¼‰ ãƒ‘ã‚¹ã‚¹ãƒ«ãƒ¼æ¡ä»¶ã‚’è¨­å®šã§ãã‚‹ï¼ãƒ¢ãƒƒã‚¯ã«å‡¦ç†ã‚’å®šç¾©ã™ã‚‹å¿…è¦ãŒã‚ã‚‹ paths: /users: post: x-amazon-apigateway-integration: type: mock # ãƒ¢ãƒƒã‚¯çµ±åˆã‚’ä½¿ç”¨ requestTemplates: application/json: '{\"statusCode\": 200}' # ãƒªã‚¯ã‚¨ã‚¹ãƒˆã®å‡¦ç† passthroughBehavior: when_no_templates # çµ±åˆãƒªã‚¯ã‚¨ã‚¹ãƒˆã®ãƒãƒƒãƒ”ãƒ³ã‚°ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã®ãƒ‘ã‚¹ã‚¹ãƒ«ãƒ¼æ¡ä»¶ã‚’é¸æŠ responses: 200: statusCode: 200 responseTemplates: application/json: '{\"id\": 1}' # ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã®å‡¦ç† 400: statusCode: 400 401: statusCode: 401 x-amazon-apigateway-request-validatorsã‚­ãƒ¼ ãƒ»x-amazon-apigateway-request-validatorsã‚­ãƒ¼ã¨ã¯ ãƒ¡ã‚½ãƒƒãƒ‰ãƒªã‚¯ã‚¨ã‚¹ãƒˆã§å„ç¨®ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã®ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’å®šç¾©ã™ã‚‹ãŸã‚ã«ï¼Œx-amazon-apigateway-request-validatorsã‚­ãƒ¼ãŒå¿…è¦ã§ã‚ã‚‹ï¼å®Ÿéš›ã«å®šç¾©ã—ãŸã‚‚ã®ã‚’ä½¿ç”¨ã™ã‚‹æ™‚ã¯ï¼Œå¾Œè¿°ã®x-amazon-apigateway-request-validatorã‚­ãƒ¼ãŒå¿…è¦ã§ã‚ã‚‹ï¼ ãƒ»è¨­å®šé …ç›® å„ç¨®ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã®ã„ãšã‚Œã‚’ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã®å¯¾è±¡ã¨ã™ã‚‹ã‹ã‚’æŒ‡å®šã—ãŸã†ãˆã§ï¼Œã‚¨ã‚¤ãƒªã‚¢ã‚¹åã‚’å®šç¾©ã™ã‚‹ï¼ãƒ«ãƒ¼ãƒˆã§å®šç¾©ã™ã‚‹ï¼ paths: /users: # ï½ ä¸­ç•¥ ï½ #=========================== # ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚»ãƒƒãƒˆã®å®šç¾© #=========================== x-amazon-apigateway-request-validators: æœ¬æ–‡ã€ã‚¯ã‚¨ãƒªæ–‡å­—åˆ—ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã€ãŠã‚ˆã³ãƒ˜ãƒƒãƒ€ãƒ¼ã®æ¤œè¨¼: validateRequestParameters: true # ã‚¯ã‚¨ãƒªãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã¨ãƒ˜ãƒƒãƒ€ãƒ¼ validateRequestBody: true # ãƒœãƒ‡ã‚£ ã‚¯ã‚¨ãƒªæ–‡å­—åˆ—ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãŠã‚ˆã³ãƒ˜ãƒƒãƒ€ãƒ¼ã®æ¤œè¨¼: validateRequestParameters: true validateRequestBody: false x-amazon-apigateway-request-validatorã‚­ãƒ¼ ãƒ»x-amazon-apigateway-request-validatorã‚­ãƒ¼ã¨ã¯ ãƒ¡ã‚½ãƒƒãƒ‰ãƒªã‚¯ã‚¨ã‚¹ãƒˆã§å„ç¨®ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã®ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’å®Ÿè¡Œã™ã‚‹ãŸã‚ã«ï¼Œx-amazon-apigateway-request-validatorã‚­ãƒ¼ãŒå¿…è¦ã§ã‚ã‚‹ï¼ ãƒ»è¨­å®šé …ç›® äº‹å‰ã«å®šç¾©ã—ãŸx-amazon-apigateway-request-validatorsã‚­ãƒ¼ã®ä¸­ã‹ã‚‰ï¼Œä½¿ç”¨ã™ã‚‹ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã®ã‚¨ã‚¤ãƒªã‚¢ã‚¹åã‚’å®£è¨€ã™ã‚‹ï¼ paths: /users: post: # ï½ ä¸­ç•¥ ï½ #=========================== # ãƒ¡ã‚½ãƒƒãƒ‰ãƒªã‚¯ã‚¨ã‚¹ãƒˆ #=========================== x-amazon-apigateway-request-validator: æœ¬æ–‡ã€ã‚¯ã‚¨ãƒªæ–‡å­—åˆ—ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã€ãŠã‚ˆã³ãƒ˜ãƒƒãƒ€ãƒ¼ã®æ¤œè¨¼ # ã‚¨ã‚¤ãƒªã‚¢ã‚¹åã‚’å®£è¨€ # ï½ ä¸­ç•¥ ï½ #=========================== # ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚»ãƒƒãƒˆã®å®šç¾© #=========================== x-amazon-apigateway-request-validators: æœ¬æ–‡ã€ã‚¯ã‚¨ãƒªæ–‡å­—åˆ—ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã€ãŠã‚ˆã³ãƒ˜ãƒƒãƒ€ãƒ¼ã®æ¤œè¨¼: validateRequestParameters: true # ã‚¯ã‚¨ãƒªãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã¨ãƒ˜ãƒƒãƒ€ãƒ¼ validateRequestBody: true # ãƒœãƒ‡ã‚£ ã‚¯ã‚¨ãƒªæ–‡å­—åˆ—ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãŠã‚ˆã³ãƒ˜ãƒƒãƒ€ãƒ¼ã®æ¤œè¨¼: validateRequestParameters: true validateRequestBody: false 02. ã‚µãƒ³ãƒ—ãƒ«YAML ã‚µãƒ³ãƒ—ãƒ«ã«ã¤ã„ã¦ ãƒ»æ³¨æ„ç‚¹ ã‚¤ãƒ³ãƒãƒ¼ãƒˆã«ã‚ãŸã‚Šï¼Œä»¥ä¸‹ã«æ³¨æ„ã™ã‚‹ï¼Swagger Editorã§APIã®ä»•æ§˜æ›¸ã®HTMLãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç¢ºèªã§ãã‚‹ï¼ å‚è€ƒï¼šhttps://editor.swagger.io/ OpenAPIä»•æ§˜ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³2.0ã¨3.0ã«å¯¾å¿œã—ã¦ã„ã‚‹ï¼ x-amazon-apigateway-integrationã‚­ãƒ¼ã‚’å„HTTPãƒ¡ã‚½ãƒƒãƒ‰ã«å®šç¾©ã™ã‚‹ï¼ API GatewayãŒsecurityã‚­ãƒ¼ã®ãƒ«ãƒ¼ãƒˆå®šç¾©ã«éå¯¾å¿œã®ãŸã‚ï¼Œå†—é•·ã§ã¯ã‚ã‚‹ãŒï¼Œå„HTTPãƒ¡ã‚½ãƒƒãƒ‰ã«å€‹åˆ¥ã«å®šç¾©ã™ã‚‹ï¼ ãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒ¡ã‚½ãƒƒãƒ‰ã§å—ä¿¡ã™ã‚‹APIã‚­ãƒ¼ã®ãƒ˜ãƒƒãƒ€ãƒ¼åã¯ï¼Œå°æ–‡å­—ã§ã€Œx-api-keyã€ä»¥å¤–ã¯è¨­å®šã§ããªã„ï¼ãŸã ã—ï¼Œçµ±åˆãƒªã‚¯ã‚¨ã‚¹ãƒˆã§è»¢é€ã™ã‚‹æ™‚ã«ä»˜ä¸ã™ã‚‹ãƒ˜ãƒƒãƒ€ãƒ¼åã¯ã€ŒX-API-Keyã€ã¨è¨­å®šã§ãã‚‹ï¼ çµ±åˆãƒªã‚¯ã‚¨ã‚¹ãƒˆã§ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã«è»¢é€ã™ã‚‹APIã‚­ãƒ¼ã¯ï¼Œã‚·ãƒ³ã‚°ãƒ«ã‚¯ã‚ªãƒ¼ãƒˆã§å›²ã†å¿…è¦ãŒã‚ã‚‹ï¼ APIã‚­ãƒ¼ã®ä½œæˆã¯æ‰‹å‹•ã§è¡Œã†å¿…è¦ãŒã‚ã‚‹ï¼ ã‚¹ãƒ†ãƒ¼ã‚¸ã®ä½œæˆã¯æ‰‹å‹•ã§è¡Œã†å¿…è¦ãŒã‚ã‚‹ï¼ serversã‚­ãƒ¼ã®å®Ÿè£…ã¯ã‚¤ãƒ³ãƒãƒ¼ãƒˆã—ã¦ã‚‚åæ˜ ã§ããªã„ï¼ ãƒãƒƒãƒ”ãƒ³ã‚°ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã¯VTLã«ã‚ˆã‚‹å®šç¾©ãŒå¯èƒ½ã§ã‚ã‚‹ï¼ ãƒ»ãã®ä»–éå¯¾å¿œãªè¨˜æ³• ãã®ä»–ã®éå¯¾å¿œã®è¨˜è¿°ã«ã¤ã„ã¦ã¯ï¼Œä»¥ä¸‹ã‚’å‚è€ƒã«ã›ã‚ˆï¼ å‚è€ƒï¼šhttps://docs.aws.amazon.com/ja_jp/apigateway/latest/developerguide/api-gateway-known-issues.html#api-gateway-known-issues-rest-apis VPCãƒªãƒ³ã‚¯ï¼†ãƒ—ãƒ­ã‚­ã‚·çµ±åˆ å®Ÿè£…ä¾‹ openapi: 3.0.0 info: title: example-api-with-proxy-integration # APIå description: The API for example with proxy integration # APIã®èª¬æ˜ termsOfService: https://www.example.com/terms/ # åˆ©ç”¨è¦ç´„ contact: name: API support # é€£çµ¡å…ˆå url: https://www.example.com/support # é€£çµ¡å…ˆã«é–¢ã™ã‚‹URL email: support@example.com # ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ license: name: Apache 2.0 # ãƒ©ã‚¤ã‚»ãƒ³ã‚¹ url: https://www.apache.org/licenses/LICENSE-2.0.html # URL version: 1.0.0 # APIãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ servers: - url: https://{env}.example.com/api/v1 description: | variables: env: default: stg description: API environment enum: - stg - www paths: #=========================== # pathsã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ #=========================== /users: #=========================== # path itemã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ #=========================== get: tags: - ãƒ¦ãƒ¼ã‚¶æƒ…å ±å–å¾—ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ summary: ãƒ¦ãƒ¼ã‚¶æƒ…å ±å–å¾— description: å…¨ãƒ¦ãƒ¼ã‚¶æƒ…å ±ã‚’å–å¾—ã™ã‚‹ï¼ #=========================== # ãƒ¡ã‚½ãƒƒãƒ‰ãƒªã‚¯ã‚¨ã‚¹ãƒˆ #=========================== x-amazon-apigateway-request-validator: ã‚¯ã‚¨ãƒªæ–‡å­—åˆ—ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãŠã‚ˆã³ãƒ˜ãƒƒãƒ€ãƒ¼ã®æ¤œè¨¼ security: - apiKeyAuth: [ ] # APIã‚­ãƒ¼ã®å¿…é ˆåŒ– parameters: - in: query # ãƒ‘ã‚¹ã«ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’å‰²ã‚Šå½“ã¦ã‚‹ï¼ name: userId required: true description: ãƒ¦ãƒ¼ã‚¶ID schema: type: string example: # ãƒ‘ã‚¹ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ä¾‹ userId=1 #=========================== # ãƒ¡ã‚½ãƒƒãƒ‰ãƒ¬ã‚¹ãƒãƒ³ã‚¹ #=========================== responses: '200': description: OK ãƒ¬ã‚¹ãƒãƒ³ã‚¹ content: application/json: # MIME type example: # ãƒ¬ã‚¹ãƒãƒ³ã‚¹ãƒœãƒ‡ã‚£ä¾‹ Users: User: userId: 1 name: Hiroki schema: $ref: \"#/components/schemas/user\" # Userãƒ¢ãƒ‡ãƒ«ã‚’å‚ç…§ã™ã‚‹ï¼ '400': description: Bad Request ãƒ¬ã‚¹ãƒãƒ³ã‚¹ content: application/json: # MIME type example: # ãƒ¬ã‚¹ãƒãƒ³ã‚¹ãƒœãƒ‡ã‚£ä¾‹ status: 400 title: Bad Request errors: messages: [ \"ä¸æ­£ãªãƒªã‚¯ã‚¨ã‚¹ãƒˆã§ã™ï¼\" ] schema: $ref: \"#/components/schemas/error\" # ç•°å¸¸ç³»ãƒ¢ãƒ‡ãƒ«ã‚’å‚ç…§ã™ã‚‹ï¼ '401': $ref: \"#/components/responses/unauthorized\" # èªè¨¼ã‚¨ãƒ©ãƒ¼ã‚’å‚ç…§ã™ã‚‹ï¼ #=========================== # çµ±åˆ #=========================== x-amazon-apigateway-integration: httpMethod: GET uri: \"http:///api/v1/users/\" requestParameters: integration.request.header.X-API-Key: \"'XXXXX'\" integration.request.querystring.userId: method.request.querystring.userId # ãƒãƒƒãƒ”ãƒ³ã‚°ã™ã‚‹ã‚¯ã‚¨ãƒªãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ connectionType: VPC_LINK connectionId: type: http_proxy passthroughBehavior: when_no_match responses: default: statusCode: 200 #=========================== # path itemã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ #=========================== post: tags: - ãƒ¦ãƒ¼ã‚¶æƒ…å ±ä½œæˆã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ summary: ãƒ¦ãƒ¼ã‚¶æƒ…å ±ä½œæˆ description: ãƒ¦ãƒ¼ã‚¶æƒ…å ±ã‚’ä½œæˆã™ã‚‹ï¼ #=========================== # ãƒ¡ã‚½ãƒƒãƒ‰ãƒªã‚¯ã‚¨ã‚¹ãƒˆ #=========================== x-amazon-apigateway-request-validator: æœ¬æ–‡ã€ã‚¯ã‚¨ãƒªæ–‡å­—åˆ—ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã€ãŠã‚ˆã³ãƒ˜ãƒƒãƒ€ãƒ¼ã®æ¤œè¨¼ security: - apiKeyAuth: [ ] # APIã‚­ãƒ¼ã®å¿…é ˆåŒ– parameters: [ ] requestBody: # ãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒœãƒ‡ã‚£ã«ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’å‰²ã‚Šå½“ã¦ã‚‹ï¼ description: ãƒ¦ãƒ¼ã‚¶ID content: application/json: # MIME type example: # ãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒœãƒ‡ã‚£ä¾‹ userId: 1 schema: # ã‚¹ã‚­ãƒ¼ãƒ $ref: \"#/components/schemas/user\" # Userãƒ¢ãƒ‡ãƒ«ã‚’å‚ç…§ã™ã‚‹ï¼ #=========================== # ãƒ¡ã‚½ãƒƒãƒ‰ãƒ¬ã‚¹ãƒãƒ³ã‚¹ #=========================== responses: '200': description: OK ãƒ¬ã‚¹ãƒãƒ³ã‚¹ content: application/json: # MIME type example: # ãƒ¬ã‚¹ãƒãƒ³ã‚¹ãƒœãƒ‡ã‚£ä¾‹ userId: 1 schema: $ref: \"#/components/schemas/normal\" # æ­£å¸¸ç³»ãƒ¢ãƒ‡ãƒ«ã‚’å‚ç…§ã™ã‚‹ï¼ '400': description: Bad Request ãƒ¬ã‚¹ãƒãƒ³ã‚¹ content: application/json: # MIME type example: # ãƒ¬ã‚¹ãƒãƒ³ã‚¹ãƒœãƒ‡ã‚£ä¾‹ status: 400 title: Bad Request errors: messages: [ \"ãƒ¦ãƒ¼ã‚¶IDã¯å¿…ãšæŒ‡å®šã—ã¦ãã ã•ã„ï¼\" ] schema: $ref: \"#/components/schemas/error\" # ç•°å¸¸ç³»ãƒ¢ãƒ‡ãƒ«ã‚’å‚ç…§ã™ã‚‹ï¼ '401': $ref: \"#/components/responses/unauthorized\" # èªè¨¼ã‚¨ãƒ©ãƒ¼ã‚’å‚ç…§ã™ã‚‹ï¼ #=========================== # çµ±åˆ #=========================== x-amazon-apigateway-integration: httpMethod: POST uri: \"http:///api/v1/users/\" requestParameters: integration.request.header.X-API-Key: \"'XXXXX'\" connectionType: VPC_LINK connectionId: type: http_proxy passthroughBehavior: when_no_match responses: default: statusCode: 200 #=========================== # pathsã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ #=========================== /users/{userId}: #=========================== # path itemã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ #=========================== get: tags: - ãƒ¦ãƒ¼ã‚¶æƒ…å ±å–å¾—ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ summary: æŒ‡å®šãƒ¦ãƒ¼ã‚¶æƒ…å ±å–å¾— description: æŒ‡å®šã—ãŸãƒ¦ãƒ¼ã‚¶æƒ…å ±ã‚’å–å¾—ã™ã‚‹ï¼ #=========================== # ãƒ¡ã‚½ãƒƒãƒ‰ãƒªã‚¯ã‚¨ã‚¹ãƒˆ #=========================== x-amazon-apigateway-request-validator: ã‚¯ã‚¨ãƒªæ–‡å­—åˆ—ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãŠã‚ˆã³ãƒ˜ãƒƒãƒ€ãƒ¼ã®æ¤œè¨¼ security: - apiKeyAuth: [ ] # APIã‚­ãƒ¼ã®å¿…é ˆåŒ– parameters: - in: path # ãƒ‘ã‚¹ã«ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’å‰²ã‚Šå½“ã¦ã‚‹ï¼ name: userId required: true description: ãƒ¦ãƒ¼ã‚¶ID schema: type: string example: # ãƒ‘ã‚¹ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ä¾‹ userId=1 #=========================== # ãƒ¡ã‚½ãƒƒãƒ‰ãƒ¬ã‚¹ãƒãƒ³ã‚¹ #=========================== responses: '200': description: OK ãƒ¬ã‚¹ãƒãƒ³ã‚¹ content: application/json: # MIME type example: # ãƒœãƒ‡ã‚£ä¾‹ userId: 1 name: Hiroki schema: # ã‚¹ã‚­ãƒ¼ãƒ $ref: \"#/components/schemas/user\" # Userãƒ¢ãƒ‡ãƒ«ã‚’å‚ç…§ã™ã‚‹ï¼ '400': description: Bad Request ãƒ¬ã‚¹ãƒãƒ³ã‚¹ content: application/json: # MIME type example: # ãƒœãƒ‡ã‚£ä¾‹ status: 400 title: Bad Request errors: messages: [ \"ãƒ¦ãƒ¼ã‚¶IDã¯å¿…ãšæŒ‡å®šã—ã¦ãã ã•ã„ï¼\" ] schema: $ref: \"#/components/schemas/error\" # ç•°å¸¸ç³»ãƒ¢ãƒ‡ãƒ«ã‚’å‚ç…§ã™ã‚‹ï¼ '401': $ref: \"#/components/responses/unauthorized\" # èªè¨¼ã‚¨ãƒ©ãƒ¼ã‚’å‚ç…§ã™ã‚‹ï¼ '404': description: Not Found ãƒ¬ã‚¹ãƒãƒ³ã‚¹ content: application/json: # MIME type example: # ãƒœãƒ‡ã‚£ä¾‹ status: 404 title: Not Found errors: messages: [ \"å¯¾è±¡ã®ãƒ¦ãƒ¼ã‚¶ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸï¼\" ] schema: $ref: \"#/components/schemas/error\" # ç•°å¸¸ç³»ãƒ¢ãƒ‡ãƒ«ã‚’å‚ç…§ã™ã‚‹ï¼ #=========================== # çµ±åˆ #=========================== x-amazon-apigateway-integration: httpMethod: GET uri: \"http:///api/v1/users/{userId}\" requestParameters: integration.request.header.X-API-Key: \"'XXXXX'\" integration.request.path.userId: method.request.path.userId connectionType: VPC_LINK connectionId: type: http_proxy passthroughBehavior: when_no_match responses: default: statusCode: 200 #=========================== # path itemã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ #=========================== put: tags: - ãƒ¦ãƒ¼ã‚¶æƒ…å ±æ›´æ–°ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ summary: æŒ‡å®šãƒ¦ãƒ¼ã‚¶æ›´æ–° description: æŒ‡å®šã—ãŸãƒ¦ãƒ¼ã‚¶æƒ…å ±ã‚’æ›´æ–°ã™ã‚‹ï¼ #=========================== # ãƒ¡ã‚½ãƒƒãƒ‰ãƒªã‚¯ã‚¨ã‚¹ãƒˆ #=========================== x-amazon-apigateway-request-validator: æœ¬æ–‡ã€ã‚¯ã‚¨ãƒªæ–‡å­—åˆ—ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã€ãŠã‚ˆã³ãƒ˜ãƒƒãƒ€ãƒ¼ã®æ¤œè¨¼ security: - apiKeyAuth: [ ] # APIã‚­ãƒ¼ã®å¿…é ˆåŒ– parameters: - in: path # ãƒ‘ã‚¹ã«ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’å‰²ã‚Šå½“ã¦ã‚‹ï¼ name: userId required: true description: ãƒ¦ãƒ¼ã‚¶ID schema: type: string example: # ãƒ‘ã‚¹ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ä¾‹ userId=1 #=========================== # ãƒ¡ã‚½ãƒƒãƒ‰ãƒ¬ã‚¹ãƒãƒ³ã‚¹ #=========================== responses: '200': description: OK ãƒ¬ã‚¹ãƒãƒ³ã‚¹ content: application/json: # MIME type example: # ãƒœãƒ‡ã‚£ä¾‹ userId: 1 name: Hiroki schema: # ã‚¹ã‚­ãƒ¼ãƒ $ref: \"#/components/schemas/user\" # Userãƒ¢ãƒ‡ãƒ«ã‚’å‚ç…§ã™ã‚‹ï¼ '400': description: Bad Request ãƒ¬ã‚¹ãƒãƒ³ã‚¹ content: application/json: # MIME type example: # ãƒœãƒ‡ã‚£ä¾‹ status: 400 title: Bad Request errors: messages: [ \"ãƒ¦ãƒ¼ã‚¶IDã¯å¿…ãšæŒ‡å®šã—ã¦ãã ã•ã„ï¼\" ] schema: $ref: \"#/components/schemas/error\" # ç•°å¸¸ç³»ãƒ¢ãƒ‡ãƒ«ã‚’å‚ç…§ã™ã‚‹ï¼ '401': $ref: \"#/components/responses/unauthorized\" # èªè¨¼ã‚¨ãƒ©ãƒ¼ã‚’å‚ç…§ã™ã‚‹ï¼ '404': description: Not Found ãƒ¬ã‚¹ãƒãƒ³ã‚¹ content: application/json: # MIME type example: # ãƒœãƒ‡ã‚£ä¾‹ status: 404 title: Not Found errors: messages: [ \"å¯¾è±¡ã®ãƒ¦ãƒ¼ã‚¶ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸï¼\" ] schema: $ref: \"#/components/schemas/error\" # ç•°å¸¸ç³»ãƒ¢ãƒ‡ãƒ«ã‚’å‚ç…§ã™ã‚‹ï¼ #=========================== # çµ±åˆ #=========================== x-amazon-apigateway-integration: httpMethod: PUT uri: \"http:///api/v1/users/{userId}\" requestParameters: integration.request.header.X-API-Key: \"'XXXXX'\" integration.request.path.userId: method.request.path.userId connectionType: VPC_LINK connectionId: type: http_proxy passthroughBehavior: when_no_match responses: default: statusCode: 200 #=========================== # ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚»ãƒƒãƒˆã®å®šç¾© #=========================== x-amazon-apigateway-request-validators: æœ¬æ–‡ã€ã‚¯ã‚¨ãƒªæ–‡å­—åˆ—ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã€ãŠã‚ˆã³ãƒ˜ãƒƒãƒ€ãƒ¼ã®æ¤œè¨¼: validateRequestParameters: true # ã‚¯ã‚¨ãƒªãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã¨ãƒ˜ãƒƒãƒ€ãƒ¼ validateRequestBody: true # ãƒœãƒ‡ã‚£ ã‚¯ã‚¨ãƒªæ–‡å­—åˆ—ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãŠã‚ˆã³ãƒ˜ãƒƒãƒ€ãƒ¼ã®æ¤œè¨¼: validateRequestParameters: true validateRequestBody: false components: #=========================== # callbackã‚­ãƒ¼ã®å…±é€šåŒ– #=========================== callbacks: { } #=========================== # linkã‚­ãƒ¼ã®å…±é€šåŒ– #=========================== links: { } #=========================== # responseã‚­ãƒ¼ã®å…±é€šåŒ– #=========================== responses: unauthorized: description: Unauthorized ãƒ¬ã‚¹ãƒãƒ³ã‚¹ content: application/json: # MIME type example: # ãƒœãƒ‡ã‚£ä¾‹ status: 401 title: Unauthorized errors: messages: [ \"èªè¨¼ã«å¤±æ•—ã—ã¾ã—ãŸï¼\" ] schema: $ref: \"#/components/schemas/error\" # ç•°å¸¸ç³»ãƒ¢ãƒ‡ãƒ«ã‚’å‚ç…§ã™ã‚‹ï¼ #=========================== # schemaã‚­ãƒ¼ã®å…±é€šåŒ– #=========================== schemas: # ãƒ¦ãƒ¼ã‚¶ user: type: object properties: userId: type: string name: type: string # æ­£å¸¸ç³» normal: type: object properties: userId: type: string # ç•°å¸¸ç³» error: type: object properties: messages: type: array items: type: string #=========================== # securityãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®å…±é€šåŒ– #=========================== securitySchemes: # APIã‚­ãƒ¼èªè¨¼ apiKeyAuth: description: APIã‚­ãƒ¼èªè¨¼ type: apiKey name: x-api-key # ã‚«ã‚¹ã‚¿ãƒ ãƒ˜ãƒƒãƒ€ãƒ¼å in: header VPCãƒªãƒ³ã‚¯ï¼†éãƒ—ãƒ­ã‚­ã‚·çµ±åˆ å®Ÿè£…ä¾‹ openapi: 3.0.0 info: title: example-api-with-non-proxy-integration # APIå description: The API for example with non-proxy integration. # APIã®èª¬æ˜ termsOfService: https://www.example.com/terms/ # åˆ©ç”¨è¦ç´„ contact: name: API support # é€£çµ¡å…ˆå url: https://www.example.com/support # é€£çµ¡å…ˆã«é–¢ã™ã‚‹URL email: support@example.com # ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ license: name: Apache 2.0 # ãƒ©ã‚¤ã‚»ãƒ³ã‚¹ url: https://www.apache.org/licenses/LICENSE-2.0.html # URL version: 1.0.0 # APIãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ servers: - url: https://{env}.example.com/api/v1 description: | variables: env: default: stg description: API environment enum: - stg - www paths: #=========================== # pathsã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ #=========================== /users: #=========================== # path itemã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ #=========================== get: tags: - ãƒ¦ãƒ¼ã‚¶æƒ…å ±å–å¾—ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ summary: ãƒ¦ãƒ¼ã‚¶æƒ…å ±å–å¾— description: å…¨ãƒ¦ãƒ¼ã‚¶æƒ…å ±ã‚’å–å¾—ã™ã‚‹ï¼ #=========================== # ãƒ¡ã‚½ãƒƒãƒ‰ãƒªã‚¯ã‚¨ã‚¹ãƒˆ #=========================== x-amazon-apigateway-request-validator: ã‚¯ã‚¨ãƒªæ–‡å­—åˆ—ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãŠã‚ˆã³ãƒ˜ãƒƒãƒ€ãƒ¼ã®æ¤œè¨¼ security: - apiKeyAuth: [ ] # APIã‚­ãƒ¼ã®å¿…é ˆåŒ– parameters: - in: query # ãƒ‘ã‚¹ã«ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’å‰²ã‚Šå½“ã¦ã‚‹ï¼ name: userId required: true description: ãƒ¦ãƒ¼ã‚¶ID schema: type: string example: # ãƒ‘ã‚¹ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ä¾‹ userId=1 #=========================== # ãƒ¡ã‚½ãƒƒãƒ‰ãƒ¬ã‚¹ãƒãƒ³ã‚¹ #=========================== responses: '200': description: OK ãƒ¬ã‚¹ãƒãƒ³ã‚¹ content: application/json: # MIME type example: # ãƒ¬ã‚¹ãƒãƒ³ã‚¹ãƒœãƒ‡ã‚£ä¾‹ Users: User: userId: 1 name: Hiroki schema: $ref: \"#/components/schemas/user\" # Userãƒ¢ãƒ‡ãƒ«ã‚’å‚ç…§ã™ã‚‹ï¼ '400': description: Bad Request ãƒ¬ã‚¹ãƒãƒ³ã‚¹ content: application/json: # MIME type example: # ãƒ¬ã‚¹ãƒãƒ³ã‚¹ãƒœãƒ‡ã‚£ä¾‹ status: 400 title: Bad Request errors: messages: [ \"ä¸æ­£ãªãƒªã‚¯ã‚¨ã‚¹ãƒˆã§ã™ï¼\" ] schema: $ref: \"#/components/schemas/error\" # ç•°å¸¸ç³»ãƒ¢ãƒ‡ãƒ«ã‚’å‚ç…§ã™ã‚‹ï¼ '401': $ref: \"#/components/responses/unauthorized\" # èªè¨¼ã‚¨ãƒ©ãƒ¼ã‚’å‚ç…§ã™ã‚‹ï¼ #=========================== # çµ±åˆ #=========================== x-amazon-apigateway-integration: httpMethod: GET uri: \"http:///api/v1/users/\" requestParameters: integration.request.header.X-API-Key: \"'XXXXX'\" integration.request.querystring.userId: method.request.querystring.userId # ãƒãƒƒãƒ”ãƒ³ã‚°ã™ã‚‹ã‚¯ã‚¨ãƒªãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ passthroughBehavior: when_no_templates connectionType: VPC_LINK connectionId: type: http responses: 200: statusCode: 200 responseTemplates: application/json: '{\"body\" : $input.json(\"$\")}' 400: statusCode: 400 401: statusCode: 401 #=========================== # path itemã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ #=========================== post: tags: - ãƒ¦ãƒ¼ã‚¶æƒ…å ±ä½œæˆã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ summary: ãƒ¦ãƒ¼ã‚¶æƒ…å ±ä½œæˆ description: ãƒ¦ãƒ¼ã‚¶æƒ…å ±ã‚’ä½œæˆã™ã‚‹ï¼ #=========================== # ãƒ¡ã‚½ãƒƒãƒ‰ãƒªã‚¯ã‚¨ã‚¹ãƒˆ #=========================== x-amazon-apigateway-request-validator: æœ¬æ–‡ã€ã‚¯ã‚¨ãƒªæ–‡å­—åˆ—ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã€ãŠã‚ˆã³ãƒ˜ãƒƒãƒ€ãƒ¼ã®æ¤œè¨¼ security: - apiKeyAuth: [ ] # APIã‚­ãƒ¼ã®å¿…é ˆåŒ– parameters: [ ] requestBody: # ãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒœãƒ‡ã‚£ã«ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’å‰²ã‚Šå½“ã¦ã‚‹ï¼ description: ãƒ¦ãƒ¼ã‚¶ID content: application/json: # MIME type example: # ãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒœãƒ‡ã‚£ä¾‹ userId: 1 schema: # ã‚¹ã‚­ãƒ¼ãƒ $ref: \"#/components/schemas/user\" # Userãƒ¢ãƒ‡ãƒ«ã‚’å‚ç…§ã™ã‚‹ï¼ #=========================== # ãƒ¡ã‚½ãƒƒãƒ‰ãƒ¬ã‚¹ãƒãƒ³ã‚¹ #=========================== responses: '200': description: OK ãƒ¬ã‚¹ãƒãƒ³ã‚¹ content: application/json: # MIME type example: # ãƒ¬ã‚¹ãƒãƒ³ã‚¹ãƒœãƒ‡ã‚£ä¾‹ userId: 1 schema: $ref: \"#/components/schemas/normal\" # æ­£å¸¸ç³»ãƒ¢ãƒ‡ãƒ«ã‚’å‚ç…§ã™ã‚‹ï¼ '400': description: Bad Request ãƒ¬ã‚¹ãƒãƒ³ã‚¹ content: application/json: # MIME type example: # ãƒ¬ã‚¹ãƒãƒ³ã‚¹ãƒœãƒ‡ã‚£ä¾‹ status: 400 title: Bad Request errors: messages: [ \"ãƒ¦ãƒ¼ã‚¶IDã¯å¿…ãšæŒ‡å®šã—ã¦ãã ã•ã„ï¼\" ] schema: $ref: \"#/components/schemas/error\" # ç•°å¸¸ç³»ãƒ¢ãƒ‡ãƒ«ã‚’å‚ç…§ã™ã‚‹ï¼ '401': $ref: \"#/components/responses/unauthorized\" # èªè¨¼ã‚¨ãƒ©ãƒ¼ã‚’å‚ç…§ã™ã‚‹ï¼ #=========================== # çµ±åˆ #=========================== x-amazon-apigateway-integration: httpMethod: POST uri: \"http:///api/v1/users/\" requestParameters: integration.request.header.X-API-Key: \"'XXXXX'\" requestTemplates: application/json: '{\"body\" : $input.json(\"$\")}' passthroughBehavior: when_no_templates connectionType: VPC_LINK connectionId: type: http responses: 200: statusCode: 200 responseTemplates: application/json: '{\"body\" : $input.json(\"$\")}' 400: statusCode: 400 401: statusCode: 401 # type: http #=========================== # pathsã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ #=========================== /users/{userId}: #=========================== # path itemã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ #=========================== get: tags: - ãƒ¦ãƒ¼ã‚¶æƒ…å ±å–å¾—ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ summary: æŒ‡å®šãƒ¦ãƒ¼ã‚¶æƒ…å ±å–å¾— description: æŒ‡å®šã—ãŸãƒ¦ãƒ¼ã‚¶æƒ…å ±ã‚’å–å¾—ã™ã‚‹ï¼ #=========================== # ãƒ¡ã‚½ãƒƒãƒ‰ãƒªã‚¯ã‚¨ã‚¹ãƒˆ #=========================== x-amazon-apigateway-request-validator: ã‚¯ã‚¨ãƒªæ–‡å­—åˆ—ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãŠã‚ˆã³ãƒ˜ãƒƒãƒ€ãƒ¼ã®æ¤œè¨¼ security: - apiKeyAuth: [ ] # APIã‚­ãƒ¼ã®å¿…é ˆåŒ– parameters: - in: path # ãƒ‘ã‚¹ã«ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’å‰²ã‚Šå½“ã¦ã‚‹ï¼ name: userId required: true description: ãƒ¦ãƒ¼ã‚¶ID schema: type: string example: # ãƒ‘ã‚¹ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ä¾‹ userId=1 #=========================== # ãƒ¡ã‚½ãƒƒãƒ‰ãƒ¬ã‚¹ãƒãƒ³ã‚¹ #=========================== responses: '200': description: OK ãƒ¬ã‚¹ãƒãƒ³ã‚¹ content: application/json: # MIME type example: # ãƒœãƒ‡ã‚£ä¾‹ userId: 1 name: Hiroki schema: # ã‚¹ã‚­ãƒ¼ãƒ $ref: \"#/components/schemas/user\" # Userãƒ¢ãƒ‡ãƒ«ã‚’å‚ç…§ã™ã‚‹ï¼ '400': description: Bad Request ãƒ¬ã‚¹ãƒãƒ³ã‚¹ content: application/json: # MIME type example: # ãƒœãƒ‡ã‚£ä¾‹ status: 400 title: Bad Request errors: messages: [ \"ãƒ¦ãƒ¼ã‚¶IDã¯å¿…ãšæŒ‡å®šã—ã¦ãã ã•ã„ï¼\" ] schema: $ref: \"#/components/schemas/error\" # ç•°å¸¸ç³»ãƒ¢ãƒ‡ãƒ«ã‚’å‚ç…§ã™ã‚‹ï¼ '401': $ref: \"#/components/responses/unauthorized\" # èªè¨¼ã‚¨ãƒ©ãƒ¼ã‚’å‚ç…§ã™ã‚‹ï¼ '404': description: Not Found ãƒ¬ã‚¹ãƒãƒ³ã‚¹ content: application/json: # MIME type example: # ãƒœãƒ‡ã‚£ä¾‹ status: 404 title: Not Found errors: messages: [ \"å¯¾è±¡ã®ãƒ¦ãƒ¼ã‚¶ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸï¼\" ] schema: $ref: \"#/components/schemas/error\" # ç•°å¸¸ç³»ãƒ¢ãƒ‡ãƒ«ã‚’å‚ç…§ã™ã‚‹ï¼ #=========================== # çµ±åˆ #=========================== x-amazon-apigateway-integration: httpMethod: GET uri: \"http:///api/v1/users/{userId}\" requestParameters: integration.request.header.X-API-Key: \"'XXXXX'\" integration.request.path.userId: method.request.path.userId passthroughBehavior: when_no_templates connectionType: VPC_LINK connectionId: type: http responses: 200: statusCode: 200 responseTemplates: application/json: '{\"body\" : $input.json(\"$\")}' 400: statusCode: 400 401: statusCode: 401 404: statusCode: 404 #=========================== # path itemã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ #=========================== put: tags: - ãƒ¦ãƒ¼ã‚¶æƒ…å ±æ›´æ–°ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ summary: æŒ‡å®šãƒ¦ãƒ¼ã‚¶æ›´æ–° description: æŒ‡å®šã—ãŸãƒ¦ãƒ¼ã‚¶æƒ…å ±ã‚’æ›´æ–°ã™ã‚‹ï¼ #=========================== # ãƒ¡ã‚½ãƒƒãƒ‰ãƒªã‚¯ã‚¨ã‚¹ãƒˆ #=========================== x-amazon-apigateway-request-validator: æœ¬æ–‡ã€ã‚¯ã‚¨ãƒªæ–‡å­—åˆ—ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã€ãŠã‚ˆã³ãƒ˜ãƒƒãƒ€ãƒ¼ã®æ¤œè¨¼ security: - apiKeyAuth: [ ] # APIã‚­ãƒ¼ã®å¿…é ˆåŒ– parameters: - in: path # ãƒ‘ã‚¹ã«ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’å‰²ã‚Šå½“ã¦ã‚‹ï¼ name: userId required: true description: ãƒ¦ãƒ¼ã‚¶ID schema: type: string example: # ãƒ‘ã‚¹ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ä¾‹ userId=1 #=========================== # ãƒ¡ã‚½ãƒƒãƒ‰ãƒ¬ã‚¹ãƒãƒ³ã‚¹ #=========================== responses: '200': description: OK ãƒ¬ã‚¹ãƒãƒ³ã‚¹ content: application/json: # MIME type example: # ãƒœãƒ‡ã‚£ä¾‹ userId: 1 name: Hiroki schema: # ã‚¹ã‚­ãƒ¼ãƒ $ref: \"#/components/schemas/user\" # Userãƒ¢ãƒ‡ãƒ«ã‚’å‚ç…§ã™ã‚‹ï¼ '400': description: Bad Request ãƒ¬ã‚¹ãƒãƒ³ã‚¹ content: application/json: # MIME type example: # ãƒœãƒ‡ã‚£ä¾‹ status: 400 title: Bad Request errors: messages: [ \"ãƒ¦ãƒ¼ã‚¶IDã¯å¿…ãšæŒ‡å®šã—ã¦ãã ã•ã„ï¼\" ] schema: $ref: \"#/components/schemas/error\" # ç•°å¸¸ç³»ãƒ¢ãƒ‡ãƒ«ã‚’å‚ç…§ã™ã‚‹ï¼ '401': $ref: \"#/components/responses/unauthorized\" # èªè¨¼ã‚¨ãƒ©ãƒ¼ã‚’å‚ç…§ã™ã‚‹ï¼ '404': description: Not Found ãƒ¬ã‚¹ãƒãƒ³ã‚¹ content: application/json: # MIME type example: # ãƒœãƒ‡ã‚£ä¾‹ status: 404 title: Not Found errors: messages: [ \"å¯¾è±¡ã®ãƒ¦ãƒ¼ã‚¶ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸï¼\" ] schema: $ref: \"#/components/schemas/error\" # ç•°å¸¸ç³»ãƒ¢ãƒ‡ãƒ«ã‚’å‚ç…§ã™ã‚‹ï¼ #=========================== # çµ±åˆ #=========================== x-amazon-apigateway-integration: httpMethod: PUT uri: \"http:///api/v1/users/{userId}\" requestParameters: integration.request.header.X-API-Key: \"'XXXXX'\" integration.request.path.userId: method.request.path.userId passthroughBehavior: when_no_templates connectionType: VPC_LINK connectionId: type: http responses: 200: statusCode: 200 responseTemplates: application/json: '{\"body\" : $input.json(\"$\")}' 400: statusCode: 400 401: statusCode: 401 #=========================== # ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚»ãƒƒãƒˆã®å®šç¾© #=========================== x-amazon-apigateway-request-validators: æœ¬æ–‡ã€ã‚¯ã‚¨ãƒªæ–‡å­—åˆ—ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã€ãŠã‚ˆã³ãƒ˜ãƒƒãƒ€ãƒ¼ã®æ¤œè¨¼: validateRequestParameters: true # ã‚¯ã‚¨ãƒªãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã¨ãƒ˜ãƒƒãƒ€ãƒ¼ validateRequestBody: true # ãƒœãƒ‡ã‚£ ã‚¯ã‚¨ãƒªæ–‡å­—åˆ—ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãŠã‚ˆã³ãƒ˜ãƒƒãƒ€ãƒ¼ã®æ¤œè¨¼: validateRequestParameters: true validateRequestBody: false components: #=========================== # callbackã‚­ãƒ¼ã®å…±é€šåŒ– #=========================== callbacks: { } #=========================== # linkã‚­ãƒ¼ã®å…±é€šåŒ– #=========================== links: { } #=========================== # responseã‚­ãƒ¼ã®å…±é€šåŒ– #=========================== responses: unauthorized: description: Unauthorized ãƒ¬ã‚¹ãƒãƒ³ã‚¹ content: application/json: # MIME type example: # ãƒœãƒ‡ã‚£ä¾‹ status: 401 title: Unauthorized errors: messages: [ \"èªè¨¼ã«å¤±æ•—ã—ã¾ã—ãŸï¼\" ] schema: $ref: \"#/components/schemas/error\" # ç•°å¸¸ç³»ãƒ¢ãƒ‡ãƒ«ã‚’å‚ç…§ã™ã‚‹ï¼ #=========================== # schemaã‚­ãƒ¼ã®å…±é€šåŒ– #=========================== schemas: # ãƒ¦ãƒ¼ã‚¶ user: type: object properties: userId: type: string name: type: string # æ­£å¸¸ç³» normal: type: object properties: userId: type: string # ç•°å¸¸ç³» error: type: object properties: messages: type: array items: type: string #=========================== # securityãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®å…±é€šåŒ– #=========================== securitySchemes: # APIã‚­ãƒ¼èªè¨¼ apiKeyAuth: description: APIã‚­ãƒ¼èªè¨¼ type: apiKey name: x-api-key # ã‚«ã‚¹ã‚¿ãƒ ãƒ˜ãƒƒãƒ€ãƒ¼å in: header ãƒ¢ãƒƒã‚¯çµ±åˆ API Gatewayã®ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã«å¯¾ã—ã¦ï¼Œä»¥ä¸‹ã®ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã§ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é€ä¿¡ã™ã‚‹ã¨ï¼Œãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’ç¢ºèªã§ãã‚‹ï¼ GET https://xxxxx.execute-api.ap-northeast-1.amazonaws.com/dev/users/?userId=1 X-API-Keyï¼šXXXXX å®Ÿè£…ä¾‹ openapi: 3.0.0 info: title: example-api-with-mock-integration # APIå description: The API for example with mock integration # APIã®èª¬æ˜ termsOfService: https://www.example.com/terms/ # åˆ©ç”¨è¦ç´„ contact: name: API support # é€£çµ¡å…ˆå url: https://www.example.com/support # é€£çµ¡å…ˆã«é–¢ã™ã‚‹URL email: support@example.com # ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ license: name: Apache 2.0 # ãƒ©ã‚¤ã‚»ãƒ³ã‚¹ url: https://www.apache.org/licenses/LICENSE-2.0.html # URL version: 1.0.0 # APIãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ servers: - url: https://{env}.example.com/api/v1 description: | variables: env: default: stg description: API environment enum: - stg - www paths: #=========================== # pathsã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ #=========================== /users: #=========================== # path itemã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ #=========================== get: tags: - ãƒ¦ãƒ¼ã‚¶æƒ…å ±å–å¾—ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ summary: ãƒ¦ãƒ¼ã‚¶æƒ…å ±å–å¾— description: å…¨ãƒ¦ãƒ¼ã‚¶æƒ…å ±ã‚’å–å¾—ã™ã‚‹ï¼ #=========================== # ãƒ¡ã‚½ãƒƒãƒ‰ãƒªã‚¯ã‚¨ã‚¹ãƒˆ #=========================== x-amazon-apigateway-request-validator: ã‚¯ã‚¨ãƒªæ–‡å­—åˆ—ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãŠã‚ˆã³ãƒ˜ãƒƒãƒ€ãƒ¼ã®æ¤œè¨¼ security: - apiKeyAuth: [ ] # APIã‚­ãƒ¼ã®å¿…é ˆåŒ– parameters: - in: query # ãƒ‘ã‚¹ã«ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’å‰²ã‚Šå½“ã¦ã‚‹ï¼ name: userId required: true description: ãƒ¦ãƒ¼ã‚¶ID schema: type: string example: # ãƒ‘ã‚¹ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ä¾‹ userId=1 #=========================== # ãƒ¡ã‚½ãƒƒãƒ‰ãƒ¬ã‚¹ãƒãƒ³ã‚¹ #=========================== responses: '200': description: OK ãƒ¬ã‚¹ãƒãƒ³ã‚¹ content: application/json: # MIME type example: # ãƒ¬ã‚¹ãƒãƒ³ã‚¹ãƒœãƒ‡ã‚£ä¾‹ Users: User: userId: 1 name: Hiroki schema: $ref: \"#/components/schemas/user\" # Userãƒ¢ãƒ‡ãƒ«ã‚’å‚ç…§ã™ã‚‹ï¼ '400': description: Bad Request ãƒ¬ã‚¹ãƒãƒ³ã‚¹ content: application/json: # MIME type example: # ãƒ¬ã‚¹ãƒãƒ³ã‚¹ãƒœãƒ‡ã‚£ä¾‹ status: 400 title: Bad Request errors: messages: [ \"ä¸æ­£ãªãƒªã‚¯ã‚¨ã‚¹ãƒˆã§ã™ï¼\" ] schema: $ref: \"#/components/schemas/error\" # ç•°å¸¸ç³»ãƒ¢ãƒ‡ãƒ«ã‚’å‚ç…§ã™ã‚‹ï¼ '401': $ref: \"#/components/responses/unauthorized\" # èªè¨¼ã‚¨ãƒ©ãƒ¼ã‚’å‚ç…§ã™ã‚‹ï¼ #=========================== # çµ±åˆ #=========================== x-amazon-apigateway-integration: requestTemplates: application/json: '{\"statusCode\": 200}' passthroughBehavior: when_no_templates type: mock responses: 200: statusCode: 200 responseTemplates: application/json: '{[{\"id\": 1,\"name\": test}]}' 400: statusCode: 400 401: statusCode: 401 #=========================== # path itemã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ #=========================== post: tags: - ãƒ¦ãƒ¼ã‚¶æƒ…å ±ä½œæˆã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ summary: ãƒ¦ãƒ¼ã‚¶æƒ…å ±ä½œæˆ description: ãƒ¦ãƒ¼ã‚¶æƒ…å ±ã‚’ä½œæˆã™ã‚‹ï¼ #=========================== # ãƒ¡ã‚½ãƒƒãƒ‰ãƒªã‚¯ã‚¨ã‚¹ãƒˆ #=========================== x-amazon-apigateway-request-validator: æœ¬æ–‡ã€ã‚¯ã‚¨ãƒªæ–‡å­—åˆ—ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã€ãŠã‚ˆã³ãƒ˜ãƒƒãƒ€ãƒ¼ã®æ¤œè¨¼ security: - apiKeyAuth: [ ] # APIã‚­ãƒ¼ã®å¿…é ˆåŒ– parameters: [ ] requestBody: # ãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒœãƒ‡ã‚£ã«ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’å‰²ã‚Šå½“ã¦ã‚‹ï¼ description: ãƒ¦ãƒ¼ã‚¶ID content: application/json: # MIME type example: # ãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒœãƒ‡ã‚£ä¾‹ userId: 1 schema: # ã‚¹ã‚­ãƒ¼ãƒ $ref: \"#/components/schemas/user\" # Userãƒ¢ãƒ‡ãƒ«ã‚’å‚ç…§ã™ã‚‹ï¼ #=========================== # ãƒ¡ã‚½ãƒƒãƒ‰ãƒ¬ã‚¹ãƒãƒ³ã‚¹ #=========================== responses: '200': description: OK ãƒ¬ã‚¹ãƒãƒ³ã‚¹ content: application/json: # MIME type example: # ãƒ¬ã‚¹ãƒãƒ³ã‚¹ãƒœãƒ‡ã‚£ä¾‹ userId: 1 schema: $ref: \"#/components/schemas/normal\" # æ­£å¸¸ç³»ãƒ¢ãƒ‡ãƒ«ã‚’å‚ç…§ã™ã‚‹ï¼ '400': description: Bad Request ãƒ¬ã‚¹ãƒãƒ³ã‚¹ content: application/json: # MIME type example: # ãƒ¬ã‚¹ãƒãƒ³ã‚¹ãƒœãƒ‡ã‚£ä¾‹ status: 400 title: Bad Request errors: messages: [ \"ãƒ¦ãƒ¼ã‚¶IDã¯å¿…ãšæŒ‡å®šã—ã¦ãã ã•ã„ï¼\" ] schema: $ref: \"#/components/schemas/error\" # ç•°å¸¸ç³»ãƒ¢ãƒ‡ãƒ«ã‚’å‚ç…§ã™ã‚‹ï¼ '401': $ref: \"#/components/responses/unauthorized\" # èªè¨¼ã‚¨ãƒ©ãƒ¼ã‚’å‚ç…§ã™ã‚‹ï¼ #=========================== # çµ±åˆ #=========================== x-amazon-apigateway-integration: requestTemplates: application/json: '{\"statusCode\": 200}' passthroughBehavior: when_no_templates type: mock responses: 200: statusCode: 200 responseTemplates: application/json: '{\"id\": 1}' 400: statusCode: 400 401: statusCode: 401 # type: mock #=========================== # pathsã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ #=========================== /users/{userId}: #=========================== # path itemã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ #=========================== get: tags: - ãƒ¦ãƒ¼ã‚¶æƒ…å ±å–å¾—ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ summary: æŒ‡å®šãƒ¦ãƒ¼ã‚¶æƒ…å ±å–å¾— description: æŒ‡å®šã—ãŸãƒ¦ãƒ¼ã‚¶æƒ…å ±ã‚’å–å¾—ã™ã‚‹ï¼ #=========================== # ãƒ¡ã‚½ãƒƒãƒ‰ãƒªã‚¯ã‚¨ã‚¹ãƒˆ #=========================== x-amazon-apigateway-request-validator: ã‚¯ã‚¨ãƒªæ–‡å­—åˆ—ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãŠã‚ˆã³ãƒ˜ãƒƒãƒ€ãƒ¼ã®æ¤œè¨¼ security: - apiKeyAuth: [ ] # APIã‚­ãƒ¼ã®å¿…é ˆåŒ– parameters: - in: path # ãƒ‘ã‚¹ã«ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’å‰²ã‚Šå½“ã¦ã‚‹ï¼ name: userId required: true description: ãƒ¦ãƒ¼ã‚¶ID schema: type: string example: # ãƒ‘ã‚¹ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ä¾‹ userId=1 #=========================== # ãƒ¡ã‚½ãƒƒãƒ‰ãƒ¬ã‚¹ãƒãƒ³ã‚¹ #=========================== responses: '200': description: OK ãƒ¬ã‚¹ãƒãƒ³ã‚¹ content: application/json: # MIME type example: # ãƒœãƒ‡ã‚£ä¾‹ userId: 1 name: Hiroki schema: # ã‚¹ã‚­ãƒ¼ãƒ $ref: \"#/components/schemas/user\" # Userãƒ¢ãƒ‡ãƒ«ã‚’å‚ç…§ã™ã‚‹ï¼ '400': description: Bad Request ãƒ¬ã‚¹ãƒãƒ³ã‚¹ content: application/json: # MIME type example: # ãƒœãƒ‡ã‚£ä¾‹ status: 400 title: Bad Request errors: messages: [ \"ãƒ¦ãƒ¼ã‚¶IDã¯å¿…ãšæŒ‡å®šã—ã¦ãã ã•ã„ï¼\" ] schema: $ref: \"#/components/schemas/error\" # ç•°å¸¸ç³»ãƒ¢ãƒ‡ãƒ«ã‚’å‚ç…§ã™ã‚‹ï¼ '401': $ref: \"#/components/responses/unauthorized\" # èªè¨¼ã‚¨ãƒ©ãƒ¼ã‚’å‚ç…§ã™ã‚‹ï¼ '404': description: Not Found ãƒ¬ã‚¹ãƒãƒ³ã‚¹ content: application/json: # MIME type example: # ãƒœãƒ‡ã‚£ä¾‹ status: 404 title: Not Found errors: messages: [ \"å¯¾è±¡ã®ãƒ¦ãƒ¼ã‚¶ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸï¼\" ] schema: $ref: \"#/components/schemas/error\" # ç•°å¸¸ç³»ãƒ¢ãƒ‡ãƒ«ã‚’å‚ç…§ã™ã‚‹ï¼ #=========================== # çµ±åˆ #=========================== x-amazon-apigateway-integration: requestTemplates: application/json: '{\"statusCode\": 200}' passthroughBehavior: when_no_templates type: mock responses: 200: statusCode: 200 responseTemplates: application/json: '{[{\"id\": 1,\"name\": test}]}' 400: statusCode: 400 401: statusCode: 401 404: statusCode: 404 #=========================== # path itemã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ #=========================== put: tags: - ãƒ¦ãƒ¼ã‚¶æƒ…å ±æ›´æ–°ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ summary: æŒ‡å®šãƒ¦ãƒ¼ã‚¶æ›´æ–° description: æŒ‡å®šã—ãŸãƒ¦ãƒ¼ã‚¶æƒ…å ±ã‚’æ›´æ–°ã™ã‚‹ï¼ #=========================== # ãƒ¡ã‚½ãƒƒãƒ‰ãƒªã‚¯ã‚¨ã‚¹ãƒˆ #=========================== x-amazon-apigateway-request-validator: æœ¬æ–‡ã€ã‚¯ã‚¨ãƒªæ–‡å­—åˆ—ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã€ãŠã‚ˆã³ãƒ˜ãƒƒãƒ€ãƒ¼ã®æ¤œè¨¼ security: - apiKeyAuth: [ ] # APIã‚­ãƒ¼ã®å¿…é ˆåŒ– parameters: - in: path # ãƒ‘ã‚¹ã«ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’å‰²ã‚Šå½“ã¦ã‚‹ï¼ name: userId required: true description: ãƒ¦ãƒ¼ã‚¶ID schema: type: string example: # ãƒ‘ã‚¹ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ä¾‹ userId=1 #=========================== # ãƒ¡ã‚½ãƒƒãƒ‰ãƒ¬ã‚¹ãƒãƒ³ã‚¹ #=========================== responses: '200': description: OK ãƒ¬ã‚¹ãƒãƒ³ã‚¹ content: application/json: # MIME type example: # ãƒœãƒ‡ã‚£ä¾‹ userId: 1 name: Hiroki schema: # ã‚¹ã‚­ãƒ¼ãƒ $ref: \"#/components/schemas/user\" # Userãƒ¢ãƒ‡ãƒ«ã‚’å‚ç…§ã™ã‚‹ï¼ '400': description: Bad Request ãƒ¬ã‚¹ãƒãƒ³ã‚¹ content: application/json: # MIME type example: # ãƒœãƒ‡ã‚£ä¾‹ status: 400 title: Bad Request errors: messages: [ \"ãƒ¦ãƒ¼ã‚¶IDã¯å¿…ãšæŒ‡å®šã—ã¦ãã ã•ã„ï¼\" ] schema: $ref: \"#/components/schemas/error\" # ç•°å¸¸ç³»ãƒ¢ãƒ‡ãƒ«ã‚’å‚ç…§ã™ã‚‹ï¼ '401': $ref: \"#/components/responses/unauthorized\" # èªè¨¼ã‚¨ãƒ©ãƒ¼ã‚’å‚ç…§ã™ã‚‹ï¼ '404': description: Not Found ãƒ¬ã‚¹ãƒãƒ³ã‚¹ content: application/json: # MIME type example: # ãƒœãƒ‡ã‚£ä¾‹ status: 404 title: Not Found errors: messages: [ \"å¯¾è±¡ã®ãƒ¦ãƒ¼ã‚¶ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸï¼\" ] schema: $ref: \"#/components/schemas/error\" # ç•°å¸¸ç³»ãƒ¢ãƒ‡ãƒ«ã‚’å‚ç…§ã™ã‚‹ï¼ #=========================== # çµ±åˆ #=========================== x-amazon-apigateway-integration: requestTemplates: application/json: '{\"statusCode\": 200}' passthroughBehavior: when_no_templates type: mock responses: 200: statusCode: 200 responseTemplates: application/json: '{\"id\": 1}' 400: statusCode: 400 401: statusCode: 401 #=========================== # ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚»ãƒƒãƒˆã®å®šç¾© #=========================== x-amazon-apigateway-request-validators: æœ¬æ–‡ã€ã‚¯ã‚¨ãƒªæ–‡å­—åˆ—ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã€ãŠã‚ˆã³ãƒ˜ãƒƒãƒ€ãƒ¼ã®æ¤œè¨¼: validateRequestParameters: true # ã‚¯ã‚¨ãƒªãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã¨ãƒ˜ãƒƒãƒ€ãƒ¼ validateRequestBody: true # ãƒœãƒ‡ã‚£ ã‚¯ã‚¨ãƒªæ–‡å­—åˆ—ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãŠã‚ˆã³ãƒ˜ãƒƒãƒ€ãƒ¼ã®æ¤œè¨¼: validateRequestParameters: true validateRequestBody: false components: #=========================== # callbackã‚­ãƒ¼ã®å…±é€šåŒ– #=========================== callbacks: { } #=========================== # linkã‚­ãƒ¼ã®å…±é€šåŒ– #=========================== links: { } #=========================== # responseã‚­ãƒ¼ã®å…±é€šåŒ– #=========================== responses: unauthorized: description: Unauthorized ãƒ¬ã‚¹ãƒãƒ³ã‚¹ content: application/json: # MIME type example: # ãƒœãƒ‡ã‚£ä¾‹ status: 401 title: Unauthorized errors: messages: [ \"èªè¨¼ã«å¤±æ•—ã—ã¾ã—ãŸï¼\" ] schema: $ref: \"#/components/schemas/error\" # ç•°å¸¸ç³»ãƒ¢ãƒ‡ãƒ«ã‚’å‚ç…§ã™ã‚‹ï¼ #=========================== # schemaã‚­ãƒ¼ã®å…±é€šåŒ– #=========================== schemas: # ãƒ¦ãƒ¼ã‚¶ user: type: object properties: userId: type: string name: type: string # æ­£å¸¸ç³» normal: type: object properties: userId: type: string # ç•°å¸¸ç³» error: type: object properties: messages: type: array items: type: string #=========================== # securityãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®å…±é€šåŒ– #=========================== securitySchemes: # APIã‚­ãƒ¼èªè¨¼ apiKeyAuth: description: APIã‚­ãƒ¼èªè¨¼ type: apiKey name: x-api-key # ã‚«ã‚¹ã‚¿ãƒ ãƒ˜ãƒƒãƒ€ãƒ¼å in: header "},"public/cloud_computing/cloud_computing_aws_lambda_function.html":{"url":"public/cloud_computing/cloud_computing_aws_lambda_function.html","title":"ğŸ“– ï¸Lambdaé–¢æ•°ã®å®Ÿè£…","keywords":"","body":"Lambdaé–¢æ•°ã®å®Ÿè£… ã¯ã˜ã‚ã« æœ¬ã‚µã‚¤ãƒˆã«ã¤ãã¾ã—ã¦ï¼Œä»¥ä¸‹ã‚’ã”èªè­˜ã®ã»ã©å®œã—ããŠé¡˜ã„ã„ãŸã—ã¾ã™ï¼ å‚è€ƒï¼šhttps://hiroki-it.github.io/tech-notebook-gitbook/ 01. ãƒãƒ³ãƒ‰ãƒ©é–¢æ•° ãƒãƒ³ãƒ‰ãƒ©é–¢æ•°ã¨ã¯ è‡ªèº«ã‹ã‚‰èµ·å‹•ã™ã‚‹ã“ã¨ã¯ãªãï¼Œå¤–éƒ¨ã‹ã‚‰è¦æ±‚ã•ã‚Œã¦å®Ÿè¡Œã•ã‚Œã‚‹é–¢æ•°ã®ã“ã¨ï¼ å‚è€ƒï¼šhttps://garop.com/36/ Lambdaãƒãƒ³ãƒ‰ãƒ©é–¢æ•° ãƒ»éåŒæœŸãƒãƒ³ãƒ‰ãƒ©é–¢æ•°ï¼ˆAsync handlersï¼‰ Lambdaã¯ãƒãƒ³ãƒ‰ãƒ©é–¢æ•°ã‚’éåŒæœŸé–¢æ•°ã¨ã—ã¦ã‚³ãƒ¼ãƒ«ã—ï¼Œå¼•æ•°ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆï¼ˆeventï¼‰ã«å€¤ã‚’ã‚ãŸã™ï¼ãƒãƒ³ãƒ‰ãƒ©é–¢æ•°ã®åˆæœŸåã¯handlerãƒ¡ã‚½ãƒƒãƒ‰ã§ã‚ã‚‹ãŒåˆ¥åã§ã‚‚ã‚ˆã„ï¼returnã¾ãŸã¯throwã‚’ä½¿ç”¨ã—ã¦ï¼ŒLambdaã®ã‚³ãƒ¼ãƒ«å…ƒã«ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’é€ä¿¡ã™ã‚‹ï¼ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã¨ã—ã¦ï¼ŒPromiseã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’é€ä¿¡ã™ã‚‹ã“ã¨ã‚‚ã§ãã‚‹ï¼ å‚è€ƒï¼šhttps://docs.aws.amazon.com/lambda/latest/dg/nodejs-handler.html#nodejs-handler-async ï¼Šå®Ÿè£…ä¾‹ï¼Š Node.jsã®å ´åˆã‚’ç¤ºã™ï¼ exports.handler = async (event) => { const response = { \"statusCode\": null, \"body\" : null }; response.statusCode = 200; response.body = \"Hello World!\" // ã‚‚ã—ãã¯throwã‚’ä½¿ç”¨ã—ã¦ï¼Œãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’é€ä¿¡ã™ã‚‹ï¼ return response; } const aws = require(\"aws-sdk\"); const s3 = new aws.S3(); exports.handler = async function(event) { // Promiseã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã¨ã—ã¦é€ä¿¡ã™ã‚‹ï¼ return s3.listBuckets().promise(); } exports.handler = async (event) => { // Promiseã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã¨ã—ã¦é€ä¿¡ã™ã‚‹ï¼ return new Promise((resolve, reject) => { // ä½•ã‚‰ã‹ã®å‡¦ç† } } ãƒ»åŒæœŸãƒãƒ³ãƒ‰ãƒ©é–¢æ•°ï¼ˆNon-async handlersï¼‰ Lambdaã¯ãƒãƒ³ãƒ‰ãƒ©é–¢æ•°ã‚’åŒæœŸé–¢æ•°ã¨ã—ã¦ã‚³ãƒ¼ãƒ«ã—ï¼Œå¼•æ•°ï¼ˆeventã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆï¼Œcontextã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆï¼Œcallbacké–¢æ•°ï¼‰ã«å€¤ã‚’ã‚ãŸã™ï¼ã“ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã«ã¯ãƒ¡ã‚½ãƒƒãƒ‰ã¨ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã‚’æŒã¤ï¼ãƒãƒ³ãƒ‰ãƒ©é–¢æ•°ã®åˆæœŸåã¯handlerã§ã‚ã‚‹ãŒåˆ¥åã§ã‚‚ã‚ˆã„ï¼callbackãƒ¡ã‚½ãƒƒãƒ‰ã‚’ä½¿ç”¨ã—ã¦ï¼ŒLambdaã®ã‚³ãƒ¼ãƒ«å…ƒã«Promiseã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’é€ä¿¡ã™ã‚‹ï¼ å‚è€ƒï¼šhttps://docs.aws.amazon.com/lambda/latest/dg/nodejs-handler.html#nodejs-handler-sync ï¼ˆâ€»ã€Nonã€ãŒç¿»è¨³ã‚’ãŠã‹ã—ãã—ã¦ã„ã‚‹ãŸã‚ï¼Œè‹±èªç‰ˆã‚’æ¨å¥¨ï¼‰ ï¼Šå®Ÿè£…ä¾‹ï¼Š Node.jsã®å ´åˆã‚’ç¤ºã™ï¼ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’è¿”ä¿¡ã™ã‚‹ã«ã¯ï¼Œdoneãƒ¡ã‚½ãƒƒãƒ‰ï¼Œsucceedãƒ¡ã‚½ãƒƒãƒ‰ï¼Œcallbackãƒ¡ã‚½ãƒƒãƒ‰ãŒå¿…è¦ã§ã‚ã‚‹ï¼ã¾ãŸï¼Œå‡¦ç†ã‚’çµ‚ãˆã‚‹å ´åˆã¯returnã§è¿”å´ã™ã‚‹å¿…è¦ãŒã‚ã‚‹ï¼ exports.handler = (event, context, callback) => { // ãªã‚“ã‚‰ã‹ã®å‡¦ç† // contextä»¥å‰ã®å‡¦ç†ã‚’å¾…æ©Ÿã¯ã—ãªã„ context.done(null, /*ãƒ¬ã‚¹ãƒãƒ³ã‚¹*/); // å‡¦ç†ã‚’çµ‚ãˆã‚‹å ´åˆ // return context.done(null, /*ãƒ¬ã‚¹ãƒãƒ³ã‚¹*/) } exports.handler = (event, context, callback) => { // ãªã‚“ã‚‰ã‹ã®å‡¦ç† // contextä»¥å‰ã®å‡¦ç†ã‚’å¾…æ©Ÿã¯ã—ãªã„ context.succeed( /*ãƒ¬ã‚¹ãƒãƒ³ã‚¹*/ ); // å‡¦ç†ã‚’çµ‚ãˆã‚‹å ´åˆ // return context.succeed( /*ãƒ¬ã‚¹ãƒãƒ³ã‚¹*/ ) } exports.handler = (event, context, callback) => { // ãªã‚“ã‚‰ã‹ã®å‡¦ç† // callbackä»¥å‰ã®å‡¦ç†ã‚’å¾…æ©Ÿã™ã‚‹ï¼ callback(null, /*ãƒ¬ã‚¹ãƒãƒ³ã‚¹*/); // å‡¦ç†ã‚’çµ‚ãˆã‚‹å ´åˆ // return callback(null, /*ãƒ¬ã‚¹ãƒãƒ³ã‚¹*/) } ãƒ»äºˆç´„ã•ã‚ŒãŸå¼•æ•°ã®èª¬æ˜ å¼•æ•° èª¬æ˜ è£œè¶³ eventã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ HTTPãƒªã‚¯ã‚¨ã‚¹ãƒˆã«é–¢ã™ã‚‹ãƒ‡ãƒ¼ã‚¿ãŒä»£å…¥ã•ã‚Œã¦ã„ã‚‹ï¼ Lambdaã«ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é€ä¿¡ã™ã‚‹AWSãƒªã‚½ãƒ¼ã‚¹ã”ã¨ã«ï¼Œã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®æ§‹é€ ãŒç•°ãªã‚‹ï¼æ§‹é€ ã¯ä»¥ä¸‹ã®é€šã‚Šï¼å‚è€ƒï¼šhttps://docs.aws.amazon.com/ja_jp/lambda/latest/dg/lambda-services.html contextã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ Lambdaã«é–¢ã™ã‚‹ãƒ‡ãƒ¼ã‚¿ï¼ˆåå‰ï¼Œãƒãƒ¼ã‚¸ãƒ§ãƒ³ãªã©ï¼‰ã‚’å–å¾—ã§ãã‚‹ãƒ¡ã‚½ãƒƒãƒ‰ã¨ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ãŒä»£å…¥ã•ã‚Œã¦ã„ã‚‹ï¼ ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®æ§‹é€ ã¯ä»¥ä¸‹ã®é€šã‚Šå‚è€ƒï¼šhttps://docs.aws.amazon.com/ja_jp/lambda/latest/dg/nodejs-context.html callbacké–¢æ•° ä»£å…¥ã•ã‚Œã¦ã„ã‚‹é–¢æ•°ã®å®Ÿä½“ã¯ä¸æ˜ã§ã‚ã‚‹ï¼å…¨ã¦ã®å‡¦ç†ãŒçµ‚ã‚ã‚‹ã¾ã§å®Ÿè¡ŒãŒå¾…æ©Ÿã•ã‚Œï¼ŒLambdaã®ã‚³ãƒ¼ãƒ«å…ƒã«ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’é€ä¿¡ã™ã‚‹ï¼ å‚è€ƒï¼šhttps://docs.aws.amazon.com/ja_jp/lambda/latest/dg/nodejs-handler.html ãƒ»ãƒ†ã‚¹ãƒˆã¨ãƒ‡ãƒãƒƒã‚° Lambdaã§é–¢æ•°ã‚’ä½œæˆã™ã‚‹ã¨ï¼ŒCloudWatchãƒ­ã‚°ã®ãƒ­ã‚°ã‚°ãƒ«ãƒ¼ãƒ—ã«ï¼Œã€/aws/lambda/ã€ã¨ã„ã†ã‚°ãƒ«ãƒ¼ãƒ—ãŒè‡ªå‹•çš„ã«ä½œæˆã•ã‚Œã‚‹ï¼Lambdaã®é–¢æ•°å†…ã§ç™ºç”Ÿã—ãŸã‚¨ãƒ©ãƒ¼ã‚„console.logãƒ¡ã‚½ãƒƒãƒ‰ã®ãƒ­ã‚°ã¯ã“ã“ã«å‡ºåŠ›ã•ã‚Œã‚‹ãŸã‚ï¼Œéƒ½åº¦ç¢ºèªã™ã‚‹ã“ã¨ï¼ ãƒ»ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹ å‚è€ƒï¼šhttps://docs.aws.amazon.com/ja_jp/lambda/latest/dg/best-practices.html#function-code 02. Goã«ã‚ˆã‚‹å®Ÿè£… ç™ºè¡¨ã‚¹ãƒ©ã‚¤ãƒ‰ aws-lambda-go ãƒ»aws-lambda-goã¨ã¯ Goã‚’ä½¿ç”¨ã—ã¦ï¼ŒLambda-APIã«å¯¾ã—ã¦ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é€ä¿¡ã—ï¼ŒAWSãƒªã‚½ãƒ¼ã‚¹ã‚’æ“ä½œã§ãã‚‹ï¼ ãƒ»Starté–¢æ•° Lamdaé–¢æ•°ã‚’å®Ÿè¡Œã™ã‚‹ãŸã‚ã®é–¢æ•°ï¼Starté–¢æ•°ã«æ¸¡ã™ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã«ã¯ï¼Œå¿…ãšä¸€ã¤ã§ã‚‚errorã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã®å®Ÿè£…ãŒå«ã¾ã‚Œã¦ã„ã‚‹å¿…è¦ãŒã‚ã‚‹ï¼ã‚‚ã—å«ã¾ã‚Œã¦ã„ãªã„å ´åˆã¯ï¼ŒLambdaã§å†…éƒ¨ã‚¨ãƒ©ãƒ¼ãŒèµ·ã“ã‚‹ï¼ å‚è€ƒï¼šhttps://docs.aws.amazon.com/ja_jp/lambda/latest/dg/golang-handler.html package main import ( \"context\" \"fmt\" \"github.com/aws/aws-lambda-go/lambda\" ) type MyEvent struct { Name string `json:\"name\"` } // HandleRequest ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã—ã¾ã™ï¼ func HandleRequest(ctx context.Context, name MyEvent) (string, error) { return fmt.Sprintf(\"Hello %s!\", name.Name), nil } func main() { // Lambdaé–¢æ•°ã‚’å®Ÿè¡Œã—ã¾ã™ï¼ lambda.Start(HandleRequest) } ãƒ»ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ contextã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã¨eventã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã¨ã—ã¦ä½¿ç”¨ã§ãã‚‹ï¼ å‚è€ƒï¼šhttps://docs.aws.amazon.com/ja_jp/lambda/latest/dg/golang-context.html eventã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®ç¨®é¡ ãƒ»å…¨ç¨®é¡ å‚è€ƒï¼šhttps://github.com/aws/aws-lambda-go/tree/master/events#overview ãƒ»SNSã‚¤ãƒ™ãƒ³ãƒˆã®å ´åˆ package main import ( \"context\" \"github.com/aws/aws-lambda-go/events\" \"github.com/aws/aws-lambda-go/lambda\" \"github.com/aws/aws-lambda-go/lambdacontext\" ) /** * Lambdaãƒãƒ³ãƒ‰ãƒ©ãƒ¼é–¢æ•° */ func HandleRequest(context context.Context, event events.SNSEvent) (string, error) { } func main() { lambda.Start(HandleRequest) } ãƒ»CloudWatchã‚¤ãƒ™ãƒ³ãƒˆã®å ´åˆ package main import ( \"context\" \"github.com/aws/aws-lambda-go/events\" \"github.com/aws/aws-lambda-go/lambda\" \"github.com/aws/aws-lambda-go/lambdacontext\" ) /** * Lambdaãƒãƒ³ãƒ‰ãƒ©ãƒ¼é–¢æ•° */ func HandleRequest(context context.Context, event events.CloudWatchEvent) (string, error) { } func main() { lambda.Start(HandleRequest) } ãƒ»APIGatewayã‚¤ãƒ™ãƒ³ãƒˆã®å ´åˆ package main import ( \"context\" \"github.com/aws/aws-lambda-go/events\" \"github.com/aws/aws-lambda-go/lambda\" \"github.com/aws/aws-lambda-go/lambdacontext\" ) /** * Lambdaãƒãƒ³ãƒ‰ãƒ©ãƒ¼é–¢æ•° */ func HandleRequest(context context.Context, event events.APIGatewayProxyRequest) (events.APIGatewayProxyResponse, error) { } func main() { lambda.Start(HandleRequest) } ãƒ¬ã‚¹ãƒãƒ³ã‚¹ ãƒ»æ­£å¸¸ç³» æ­£å¸¸ç³»ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã®æ§‹æˆè¦ç´ ã«ã¤ã„ã¦ã¯ä»¥ä¸‹ã®ãƒªãƒ³ã‚¯ã‚’å‚è€ƒã«ã›ã‚ˆï¼ å‚è€ƒï¼šhttps://docs.aws.amazon.com/ja_jp/lambda/latest/dg/API_Invoke.html#API_Invoke_ResponseElements æ–‡å­—åˆ—ã‚’è¿”å´ã™ã‚‹ã¨ï¼ŒLambdaã¯ãã®æ–‡å­—åˆ—ã‚’ãã®ã¾ã¾è¿”ä¿¡ã™ã‚‹ï¼ã¾ãŸï¼ŒJSONã‚’ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã™ã‚‹ã“ã¨ã‚‚ã§ãã‚‹ï¼ å‚è€ƒï¼šhttps://docs.aws.amazon.com/ja_jp/lambda/latest/dg/golang-handler.html#golang-handler-structs ãƒ»ç•°å¸¸ç³» Lambdaã®ã‚¨ãƒ©ãƒ¼ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã®ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚³ãƒ¼ãƒ‰ã«ã¤ã„ã¦ã¯ä»¥ä¸‹ã®ãƒªãƒ³ã‚¯ã‚’å‚è€ƒã«ã›ã‚ˆï¼ å‚è€ƒï¼šhttps://docs.aws.amazon.com/ja_jp/lambda/latest/dg/API_Invoke.html#API_Invoke_Errors ã‚¨ãƒ©ãƒ¼ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãƒœãƒ‡ã‚£ã«ã¯ä»¥ä¸‹ã®JSONãŒå‰²ã‚Šå½“ã¦ã‚‰ã‚Œã‚‹ï¼ å‚è€ƒï¼šhttps://docs.aws.amazon.com/ja_jp/lambda/latest/dg/golang-exceptions.html#go-exceptions-createfunction { \"errorMessage\": \"\", \"errorType\": \"\" } errorsãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®Newé–¢æ•°ã‚’ä½¿ç”¨ã™ã‚‹ã¨ï¼Œå†…éƒ¨ã§ç™ºç”Ÿã—ãŸã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’ã‚ªãƒ¼ãƒãƒ¼ãƒ©ã‚¤ãƒ‰ã§ãã‚‹ï¼ package main import ( \"errors\" \"github.com/aws/aws-lambda-go/lambda\" ) func HandleRequest() (string, error) { return \"\", errors.New(\"something went wrong!\") } func main() { lambda.Start(OnlyErrors) } /* çµæœ { \"errorMessage\": \"something went wrong!\", \"errorType\": \"errorString\" } */ ãƒ­ã‚° ãƒ»ãƒ¬ãƒãƒ¼ãƒˆãƒ­ã‚° ç¨®é¡ RequestId ãƒªã‚¯ã‚¨ã‚¹ãƒˆID Duration ã‚¤ãƒ™ãƒ³ãƒˆã®å‡¦ç†æ™‚é–“ Billed Duration Lambdaã®èª²é‡‘å¯¾è±¡ã®æ™‚é–“ Memory Size Lambdaã®ãƒ¡ãƒ¢ãƒªã‚µã‚¤ã‚º Max Memory Used LambdaãŒå®Ÿéš›ã«ä½¿ç”¨ã™ã‚‹ãƒ¡ãƒ¢ãƒªã®æœ€å¤§é‡ ãƒ»ãƒ­ã‚°ã®å‡ºåŠ›æ–¹æ³• æ¨™æº–ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®fmtï¼Œã¾ãŸã¯ä»»æ„ã®ãƒ­ã‚®ãƒ³ã‚°ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’ä½¿ç”¨ã—ï¼Œæ¨™æº–å‡ºåŠ›ï¼æ¨™æº–ã‚¨ãƒ©ãƒ¼å‡ºåŠ›ã«å‡ºåŠ›ã™ã‚‹ï¼CloudWatchãƒ­ã‚°ã«ã¦ã“ã‚Œã‚’ç¢ºèªã™ã‚‹ï¼ å‚è€ƒï¼šhttps://docs.aws.amazon.com/ja_jp/lambda/latest/dg/golang-logging.html 02-02. é–¢æ•°ä¾‹ Amplify -> EventBridge -> Lambda ->Slack-API å‚è€ƒï¼šhttps://github.com/hiroki-it/notify-slack-of-amplify-events 03. Node.jsã«ã‚ˆã‚‹å®Ÿè£… æ¨™æº–ã§ä½¿ç”¨å¯èƒ½ãªãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ ä»¥ä¸‹ã®ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã§ã¯ï¼Œnpmã‚’ä½¿ç”¨ã™ã‚‹å¿…è¦ã¯ãªã„ï¼ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‹ã‚‰æä¾›ã•ã‚Œã‚‹ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®é–¢æ•°ã®ã»ã¨ã‚“ã©ãŒéåŒæœŸå‡¦ç†ã¨ã—ã¦å®Ÿè£…ã•ã‚Œã¦ã„ã‚‹ï¼ã‚‚ã—å¾Œç¶šã®å‡¦ç†ã§éåŒæœŸå‡¦ç†ã®çµæœã‚’ä½¿ç”¨ã—ãŸã„å ´åˆï¼ŒéåŒæœŸå‡¦ç†ã®çŠ¶æ…‹ã‚’Promiseã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã§ç®¡ç†ã™ã‚‹å¿…è¦ãŒã‚ã‚‹ï¼ ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸å èª¬æ˜ è£œè¶³ Node.jsã®æ¨™æº–ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ Node.jsã«æ¨™æº–ã§çµ„ã¿è¾¼ã¾ã‚Œã¦ã„ã‚‹é–¢æ•°ã‚’ä½¿ç”¨ã§ãã‚‹ å‚è€ƒï¼šhttps://nodejs.org/api/index.html aws-sdk.js JavaScriptã‚’ä½¿ç”¨ã—ã¦ï¼ŒAWS-APIã«å¯¾ã—ã¦ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é€ä¿¡ã—ï¼ŒAWSãƒªã‚½ãƒ¼ã‚¹ã‚’æ“ä½œã§ãã‚‹ï¼ å‚è€ƒï¼šhttps://docs.aws.amazon.com/AWSJavaScriptSDK/v3/latest/index.html éåŒæœŸå‡¦ç†ã®çŠ¶æ…‹ç®¡ç† ãƒ»Node.jsã®æ¨™æº–ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®å ´åˆ ãƒ»aws-sdk.jsã®å ´åˆ å„AWSã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®ãƒ¡ã‚½ãƒƒãƒ‰ã®å¾Œã«ï¼Œpromiseãƒ¡ã‚½ãƒƒãƒ‰ã‚’ãƒã‚§ãƒ¼ãƒ³ã§ãã‚‹ï¼ã“ã‚Œã«ã‚ˆã‚Šï¼Œå„ãƒ¡ã‚½ãƒƒãƒ‰ã®éåŒæœŸå‡¦ç†ã®çŠ¶æ…‹ã‚’Promiseã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã§ç®¡ç†ã§ãã‚‹ã‚ˆã†ã«ãªã‚‹ï¼ å‚è€ƒï¼šhttps://docs.aws.amazon.com/ja_jp/sdk-for-javascript/v2/developer-guide/using-promises.html \"use strict\"; const aws = require(\"aws-sdk\"); /** * @param event * @returns Promise */ exports.handler = async (event) => { const ec2 = new aws.EC2({apiVersion: '2014-10-01'}); // Promiseã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’è¿”å´ã™ã‚‹ const ec2Instances = ec2.describeInstances().promise(); ec2Instances.then( (data) => { // éåŒæœŸå‡¦ç†ãŒæˆåŠŸã—ãŸæ™‚ã®å¾Œç¶šå‡¦ç† }, (error) => { // éåŒæœŸå‡¦ç†ãŒå¤±æ•—ã—ãŸæ™‚ã®å¾Œç¶šå‡¦ç† } ) }; 03-02. é–¢æ•°ä¾‹ Amplify -> EventBridge -> Lambda -> Slack-API ï¼Šå®Ÿè£…ä¾‹ï¼Š Amplifyã®ã‚¤ãƒ™ãƒ³ãƒˆã‚’EventBridgeã§ã‚­ãƒ£ãƒƒãƒã—ï¼Œã“ã‚Œã‚’Lambdaã«è»¢é€ã™ã‚‹ï¼Lambdaã§ã¯ï¼Œãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’æ§‹æˆã—ï¼ŒSlack-APIã«é€ä¿¡ã™ã‚‹ï¼ å‚è€ƒï¼š https://stackoverflow.com/questions/38533580/nodejs-how-to-promisify-http-request-reject-got-called-two-times https://gist.github.com/ktheory/df3440b01d4b9d3197180d5254d7fb65#file-httppromise-js \"use strict\"; const aws = require(\"aws-sdk\"); const https = require(\"https\"); const {format} = require(\"util\"); /** * @param event * @returns Promise */ exports.handler = async (event) => { console.log(JSON.stringify({event}, null, 2)); const amplify = new aws.Amplify({apiVersion: \"2017-07-25\"}); const option = { appId: event.detail.appId, branchName: event.detail.branchName }; let result; try { // Amplifyã®ãƒ–ãƒ©ãƒ³ãƒæƒ…å ±ã‚’å–å¾—ã—ã¾ã™ï¼ const app = await amplify.getBranch(option).promise(); console.log(JSON.stringify({app}, null, 2)); const message = buildMessage(event, app); console.log(message); result = await postMessageToSlack(message); } catch (error) { console.error(error); } console.log(JSON.stringify({result}, null, 2)); return result; }; /** * ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’ä½œæˆã—ã¾ã™ï¼ * * @param event * @param app * @returns string */ const buildMessage = (event, app) => { return JSON.stringify({ channel: process.env.SLACK_CHANNEL_ID, text: \"developç’°å¢ƒ é€šçŸ¥\", attachments: [{ color: event.detail.jobStatus === \"SUCCEED\" ? \"#00FF00\" : \"#ff0000\", blocks: [ { type: \"section\", text: { type: \"mrkdwn\", text: format( \"%sç’°å¢ƒ\", event.detail.appId === process.env.AMPLIFY_APP_ID_PC ? \":computer: PC\" : \":iphone: SP\" ) } }, { type: \"context\", elements: [{ type: \"mrkdwn\", text: format( \"*çµæœ*: %s\", event.detail.jobStatus === \"SUCCEED\" ? \"æˆåŠŸ\" : \"å¤±æ•—\", ) }] }, { type: \"context\", elements: [{ type: \"mrkdwn\", text: format( \"*ãƒ–ãƒ©ãƒ³ãƒå*: %s\", event.detail.branchName ) }] }, { type: \"context\", elements: [{ type: \"mrkdwn\", text: format( \"*ãƒ—ãƒ«ãƒªã‚¯URL*: https://github.com/foo-repository/compare/%s\", event.detail.branchName ) }] }, { type: \"context\", elements: [{ type: \"mrkdwn\", text: format( \"*æ¤œè¨¼URL*: https://%s.%s.amplifyapp.com\", app.branch.displayName, event.detail.appId ) }] }, { type: \"context\", elements: [{ type: \"mrkdwn\", text: format( \":amplify: \", event.region, event.region, event.detail.appId, app.branch.displayName, event.detail.jobId ) }] }, { type: \"divider\" } ] }] }); }; /** * ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’é€ä¿¡ã—ã¾ã™ï¼ * * @param message * @returns Promise */ const postMessageToSlack = (message) => { // éåŒæœŸå‡¦ç†ã‚’æŒã¤é–¢æ•°ã‚’ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ã«æ¸¡ã—ï¼ŒéåŒæœŸå‡¦ç†ã‚’ç®¡ç†ã—ã¾ã™ï¼ return new Promise((resolve, reject) => { const options = { host: \"slack.com\", path: \"/api/chat.postMessage\", method: \"POST\", headers: { \"Content-Type\": \"application/json\", \"Authorization\": \"Bearer \" + process.env.SLACK_API_TOKEN, \"Content-Length\": Buffer.byteLength(message) } }; // éåŒæœŸå‡¦ç† const request = https.request(options, (response) => { console.info({response}, null, 2); let tmp; // æ­£å¸¸ãªãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‹ã‚‰ãƒ‡ãƒ¼ã‚¿ã‚’å–ã‚Šå‡ºã—ã¾ã™ï¼ response.on(\"data\", (data) => { tmp = data; }); // ç•°å¸¸ãªãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‹ã‚‰ã‚¨ãƒ©ãƒ¼ã‚’å–ã‚Šå‡ºã—ã¾ã™ï¼ response.on(\"error\", (error) => { tmp = error; }); // dataï¼Œerrorï¼Œendï¼Œã®é–“ã§awaitã®åŠ¹åŠ›ã¯æ¨ªæ–­ã§ããªã„ï¼ // ãã®ãŸã‚ï¼Œã§ãã‚‹ã ã‘endã§äº‹å¾Œå‡¦ç†ã‚’å®Ÿè£…ã—ï¼Œawaitã‚’ä½¿ç”¨ã™ã‚‹ã‚ˆã†ã«ã™ã‚‹ï¼ response.on(\"end\", async () => { tmp = param.toString(tmp); const body = JSON.parse(tmp); const result = { statusCode: response.statusCode, body: body }; if (!response.statusCode === 200 || !body.ok) { return reject(result); } return resolve(result); }); }); request.on(\"error\", (error) => { console.error(JSON.stringify({error}, null, 2)); }); // ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãƒœãƒ‡ã‚£ã‚’è¨­å®šã—ã¦ï¼Œãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é€ä¿¡ã—ã¾ã™ï¼ request.write(message); request.end(); console.log(JSON.stringify({request}, null, 2)); }); }; API Gateway -> Lambda -> S3 ï¼Šå®Ÿè£…ä¾‹ï¼Š API Gatewayã§ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’å—ä¿¡ã—ï¼Œãã‚Œã«å¿œã˜ã¦ç‰¹å®šã®ãƒ‡ãƒ¼ã‚¿ã‚’S3ã«ä¿å­˜ã™ã‚‹ï¼LambdaãŒS3ã«å¯¾ã—ã¦ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚’å®Ÿè¡Œã§ãã‚‹ã‚ˆã†ã«ï¼Œäº‹å‰ã«ï¼ŒAWSç®¡ç†ãƒãƒªã‚·ãƒ¼ã®ã€AWSLambdaExecuteã€ãŒã‚¢ã‚¿ãƒƒãƒã•ã‚ŒãŸãƒ­ãƒ¼ãƒ«ã‚’Lambdaã«ã‚¢ã‚¿ãƒƒãƒã—ã¦ãŠãå¿…è¦ãŒã‚ã‚‹ï¼ \"use strict\"; const aws = require(\"aws-sdk\"); const s3 = new aws.S3(); exports.handler = (event, context, callback) => { // API Gatewayã¨ã®ãƒ—ãƒ­ã‚­ã‚·çµ±åˆã‚’æ„è­˜ã—ãŸJSONæ§‹é€ ã«ã™ã‚‹ // ãƒ¬ã‚¹ãƒãƒ³ã‚¹ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®åˆæœŸå€¤ const response = { \"statusCode\": null, \"body\": null }; // èªè¨¼ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ if (event.headers[\"X-API-Key\"] !== process.env.X_API_KEY) { response.statusCode = 401; response.body = \"An API key is invalid.\"; return callback(null, response); } // ãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ if (!event.headers || !event.body) { response.statusCode = 400; response.body = \"Parameters are not found.\"; return callback(null, response); } s3.putObject({ Bucket: \"\", Key: \"\", Body: \"\", }, (err, data) => { if (err) { response.statusCode = 500; response.body = \"[ERROR] \" + err; return callback(null, response); } response.statusCode = 200; response.body = \"OK\"; return callback(null, response); }); }; "},"public/cloud_computing/cloud_computing_aws_cost_management.html":{"url":"public/cloud_computing/cloud_computing_aws_cost_management.html","title":"ğŸ“– ï¸ã‚³ã‚¹ãƒˆç®¡ç†","keywords":"","body":"ã‚³ã‚¹ãƒˆç®¡ç† 01. ã‚³ã‚¹ãƒˆç®¡ç†ã®è¦³ç‚¹ ã‚¹ãƒšãƒƒã‚¯ï¼Œæ™‚é–“å˜ä¾¡ï¼Œæ•°é‡ï¼Œæœˆé¡æ–™é‡‘ 02. Service Quotas Service Quotastã¨ã¯ å„ç¨®AWSãƒªã‚½ãƒ¼ã‚¹ã®è¨­å®šã®ä¸Šé™å€¤ã‚’ä¸Šã’ã‚‰ã‚Œã‚‹ï¼ å‚è€ƒï¼šhttps://docs.aws.amazon.com/ja_jp/servicequotas/latest/userguide/intro.html å„ç¨®AWSãƒªã‚½ãƒ¼ã‚¹ã®ä¸Šé™å€¤ å‚è€ƒï¼šhttps://docs.aws.amazon.com/ja_jp/general/latest/gr/aws-service-information.html æ–¹æ³• å‚è€ƒï¼šhttps://docs.aws.amazon.com/ja_jp/servicequotas/latest/userguide/request-quota-increase.html 03. ãƒªã‚½ãƒ¼ã‚¹åˆ¥ã‚³ã‚¹ãƒˆ CloudFront ãƒ»è»¢é€ ã‚ªãƒªã‚¸ãƒ³ã«è»¢é€ã™ã‚‹å‰ã«ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’ç”¨ã„ã¦ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’è¿”ä¿¡ã§ãã‚‹ãŸã‚ï¼Œã‚ªãƒªã‚¸ãƒ³ã§ã‹ã‹ã‚‹æ–™é‡‘ã‚’æŠ‘ãˆã‚‰ã‚Œã‚‹ï¼ EBS ãƒ»ãƒœãƒªãƒ¥ãƒ¼ãƒ ã‚µã‚¤ã‚º ãƒœãƒªãƒ¥ãƒ¼ãƒ ã®ä½¿ç”¨ç‡ã«ã‹ã‹ã‚ã‚‰ãšï¼Œæ§‹ç¯‰ã•ã‚ŒãŸãƒœãƒªãƒ¥ãƒ¼ãƒ ã®åˆè¨ˆã‚µã‚¤ã‚ºã«åŸºã¥ã„ã¦ï¼Œæ–™é‡‘ãŒç™ºç”Ÿã™ã‚‹ï¼ãã®ãŸã‚ï¼Œå®‰æ˜“ã«500GiBã‚’é¸ã‚“ã§ã¯ã„ã‘ãªã„ï¼ EC2 ãƒ»æ–™é‡‘ä½“ç³»ã®é¸æŠ ä½¿ã„æ–¹ã«å¿œã˜ãŸæ–™é‡‘ä½“ç³»ã‚’é¸ã¹ã‚‹ï¼ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã®è¿”ä¿¡æ™‚ã«æ–™é‡‘ãŒç™ºç”Ÿã™ã‚‹ï¼ å‚è€ƒï¼šhttps://docs.aws.amazon.com/ja_jp/AWSEC2/latest/UserGuide/concepts.html#ec2-pricing ç¨®é¡ èª¬æ˜ è£œè¶³ ã‚ªãƒ³ãƒ‡ãƒãƒ³ãƒ‰ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ å‚è€ƒï¼šhttps://aws.amazon.com/jp/ec2/pricing/on-demand/ Savings Plans ãƒªã‚¶ãƒ¼ãƒ–ãƒ‰ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ EC2ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã®ä¸€å®šæœŸé–“åˆ†ã®ä½¿ç”¨æ–™é‡‘ã‚’å‰æ‰•ã„ã—ï¼Œãã®ä»£ã‚ã‚Šã«å®‰ãåˆ©ç”¨ã§ãã‚‹ã‚ˆã†ã«ãªã‚‹ï¼ ã‚¹ãƒãƒƒãƒˆã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ ãƒ»æ–™é‡‘ç™ºç”Ÿã®æ¡ä»¶ ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã®ãƒ©ã‚¤ãƒ•ã‚µã‚¤ã‚¯ãƒ«ã®çŠ¶æ…‹ã«å¿œã˜ã¦ï¼Œæ–™é‡‘ãŒç™ºç”Ÿã™ã‚‹ï¼ å‚è€ƒï¼šhttps://docs.aws.amazon.com/ja_jp/AWSEC2/latest/UserGuide/ec2-instance-lifecycle.html ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã®çŠ¶æ…‹ æ–™é‡‘ç™ºç”Ÿã®æœ‰ç„¡ è£œè¶³ pending ãªã— running ã‚ã‚Š stopping æ¡ä»¶ä»˜ãã§ãªã— åœæ­¢æº–å‚™ä¸­ã®é–“ã¯æ–™é‡‘ãŒç™ºç”Ÿã—ï¼Œä¼‘æ­¢æº–å‚™ä¸­ã®é–“ã¯ç™ºç”Ÿã—ãªã„ï¼ stopped ãªã— shutting-down ãªã— terminated ãªã— ECS ãƒ»ECRã®å®¹é‡ 500MBã‚’è¶…ãˆã‚‹ã¨ï¼Œè«‹æ±‚ãŒç™ºç”Ÿã™ã‚‹ãŸã‚ï¼Œå¤ã„ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’å®šæœŸçš„ã«å‰Šé™¤ã™ã‚‹å¿…è¦ãŒã‚ã‚‹ï¼ Lambda ãƒ»å®Ÿè¡Œæ™‚é–“ã®å¾“é‡èª²é‡‘åˆ¶ é–¢æ•°ã‚’å®Ÿè¡Œã—ã¦ã„ã‚‹æ™‚é–“åˆ†ã ã‘æ–™é‡‘ãŒã‹ã‹ã‚‹ï¼é–¢æ•°ã‚’ä½¿ç”¨ã›ãšã«è¨­ç½®ã—ã¦ã„ã‚‹ã ã‘ã§ã‚ã‚Œã°ï¼Œæ–™é‡‘ã¯ã‹ã‹ã‚‰ãªã„ï¼ RDS ãƒ»æ–™é‡‘ä½“ç³» ä»¥ä¸‹ã®ãƒªãƒ³ã‚¯ã‚’å‚è€ƒã«ã›ã‚ˆï¼ å‚è€ƒï¼šhttps://docs.aws.amazon.com/ja_jp/AmazonRDS/latest/UserGuide/User_DBInstanceBilling.html ç¨®é¡ èª¬æ˜ ã‚ªãƒ³ãƒ‡ãƒãƒ³ãƒ‰ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ å‚è€ƒï¼šhttps://docs.aws.amazon.com/ja_jp/AmazonRDS/latest/UserGuide/USER_OnDemandDBInstances.html ãƒªã‚¶ãƒ¼ãƒ–ãƒ‰ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ RDSã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã®ä¸€å®šæœŸé–“åˆ†ã®ä½¿ç”¨æ–™é‡‘ã‚’å‰æ‰•ã„ã—ï¼Œãã®ä»£ã‚ã‚Šã«å®‰ãåˆ©ç”¨ã§ãã‚‹ã‚ˆã†ã«ãªã‚‹ï¼å‚è€ƒï¼šhttps://docs.aws.amazon.com/ja_jp/AmazonRDS/latest/UserGuide/USER_WorkingWithReservedDBInstances.html SES ãƒ»é€å—ä¿¡æ•° å—ä¿¡ã¯1000ä»¶/æœˆã¾ã§ï¼Œé€ä¿¡ã¯62000/æœˆã¾ã§ç„¡æ–™ã§ã‚ã‚‹ï¼ "},"public/cloud_computing/cloud_computing_gcp.html":{"url":"public/cloud_computing/cloud_computing_gcp.html","title":"ğŸ“– ï¸GCP","keywords":"","body":"GCPï¼šGoogle Cloud Platform ã¯ã˜ã‚ã« æœ¬ã‚µã‚¤ãƒˆã«ã¤ãã¾ã—ã¦ï¼Œä»¥ä¸‹ã‚’ã”èªè­˜ã®ã»ã©å®œã—ããŠé¡˜ã„ã„ãŸã—ã¾ã™ï¼ å‚è€ƒï¼šhttps://hiroki-it.github.io/tech-notebook-gitbook/ 01. GCPã«ã‚ˆã‚‹Webã‚µãƒ¼ãƒ“ã‚¹ã®ãƒªãƒªãƒ¼ã‚¹ GCPã‹ã‚‰ï¼Œã‚°ãƒ­ãƒ¼ãƒãƒ«IPã‚¢ãƒ‰ãƒ¬ã‚¹ã¨å®Œå…¨ä¿®é£¾ãƒ‰ãƒ¡ã‚¤ãƒ³åãŒæä¾›ã•ã‚Œï¼ŒWebã‚µãƒ¼ãƒ“ã‚¹ãŒãƒªãƒªãƒ¼ã‚¹ã•ã‚Œã‚‹ï¼ ã‚¯ãƒ©ã‚¦ãƒ‰ãƒ‡ã‚¶ã‚¤ãƒ³ä¾‹ ä»¥ä¸‹ã®ãƒ‡ã‚¶ã‚¤ãƒ³ä¾‹ã§ã¯ï¼ŒDualã‚·ã‚¹ãƒ†ãƒ ãŒæ¡ç”¨ã•ã‚Œã¦ã„ã‚‹ï¼ GAEï¼šGoogle App Engineï¼šGAE ã‚¯ãƒ©ã‚¦ãƒ‰ãƒ‡ãƒ—ãƒ­ã‚¤ã‚µãƒ¼ãƒã¨ã—ã¦åƒãï¼AWSã«ãŠã‘ã‚‹Elastic Beanstalkã«ç›¸å½“ã™ã‚‹ï¼ GCEï¼šGoogle Compute Engine ã‚¯ãƒ©ã‚¦ãƒ‰Webã‚µãƒ¼ãƒã¨ã—ã¦åƒãï¼AWSã«ãŠã‘ã‚‹EC2ã«ç›¸å½“ã™ã‚‹ï¼ SSLã‚µãƒ¼ãƒè¨¼æ˜æ›¸ã®è¨­ç½®å ´æ‰€ ãƒ»èªè¨¼å±€ ã‚µãƒ¼ãƒæä¾›è€… è‡ªç¤¾ã®ä¸­é–“èªè¨¼å±€å ãƒ«ãƒ¼ãƒˆèªè¨¼å±€å GCP Google Trust Services "},"public/infrastructure_as_code/infrastructure_as_code.html":{"url":"public/infrastructure_as_code/infrastructure_as_code.html","title":"ğŸ“– ï¸Infrastructure as Code","keywords":"","body":"Infrastructure as Code ã¯ã˜ã‚ã« æœ¬ã‚µã‚¤ãƒˆã«ã¤ãã¾ã—ã¦ï¼Œä»¥ä¸‹ã‚’ã”èªè­˜ã®ã»ã©å®œã—ããŠé¡˜ã„ã„ãŸã—ã¾ã™ï¼ å‚è€ƒï¼šhttps://hiroki-it.github.io/tech-notebook-gitbook/ 01. ä»®æƒ³ã‚µãƒ¼ãƒ(ä»®æƒ³ãƒã‚·ãƒ³)ã®ã‚³ãƒ¼ãƒ‰åŒ– ä»®æƒ³ã‚µãƒ¼ãƒã®æ§‹æˆç®¡ç† ãƒ»ã‚³ãƒ¼ãƒ‰åŒ–ãƒ„ãƒ¼ãƒ«ã®ç¨®é¡ ãƒ„ãƒ¼ãƒ«å å¯¾è±¡ã®Provider Ansible è¦å‹‰å¼· Puppet è¦å‹‰å¼· Chef è¦å‹‰å¼· ãƒ»Ansible Ansibleã§ã¯ï¼Œymlã®æ–‡æ³•ã‚’ç”¨ã„ã¦é–¢æ•°å‡¦ç†ã‚’å®Ÿè¡Œã§ãã‚‹ï¼ ãƒ•ã‚¡ã‚¤ãƒ«å å½¹å‰² playbook.yml ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã‚¿ã‚¹ã‚¯ã®æ‰‹é † inventory/* åæ˜ å…ˆã®ã‚µãƒ¼ãƒã®æƒ…å ± group_vars/* è¤‡æ•°ã®ã‚µãƒ¼ãƒã¸ã®è¨­å®š host_vars/* å˜ä¸€ã®ã‚µãƒ¼ãƒã¸ã®è¨­å®š 02. ã‚³ãƒ³ãƒ†ãƒŠã®ã‚³ãƒ¼ãƒ‰åŒ– ã‚³ãƒ³ãƒ†ãƒŠã®æ§‹æˆç®¡ç† ãƒ»ã‚³ãƒ¼ãƒ‰åŒ–ãƒ„ãƒ¼ãƒ«ã®ç¨®é¡ åå‰ å¯¾è±¡ã®Provider Dockerfile Docker Ansible Container è¦å‹‰å¼· 03. ã‚¯ãƒ©ã‚¦ãƒ‰ã‚¤ãƒ³ãƒ•ãƒ©ã‚¹ãƒˆãƒ©ã‚¯ãƒãƒ£ã®ã‚³ãƒ¼ãƒ‰åŒ– ã‚¯ãƒ©ã‚¦ãƒ‰ã‚¤ãƒ³ãƒ•ãƒ©ã‚¹ãƒˆãƒ©ã‚¯ãƒãƒ£ã‚ªãƒ¼ã‚±ã‚¹ãƒˆãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ ãƒ»ã‚³ãƒ¼ãƒ‰åŒ–ãƒ„ãƒ¼ãƒ«ã®ç¨®é¡ åå‰ å¯¾è±¡ã®ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼ Terraform ã„ã‚ã„ã‚ AWS CloudFormation AWS Azure Resource Manager Azure ãƒ¡ãƒªãƒƒãƒˆ ãƒ»å¤‰æ›´ã‚’ã‚³ãƒ¼ãƒ‰ãƒ¬ãƒ“ãƒ¥ãƒ¼å¯èƒ½ ç”»é¢ä¸Šã‹ã‚‰ã‚¤ãƒ³ãƒ•ãƒ©ã‚’å¤‰æ›´ã™ã‚‹å ´åˆï¼Œç”»é¢å…±æœ‰ã—ãªãŒã‚‰æ“ä½œã—ï¼Œãƒ¬ãƒ“ãƒ¥ãƒ¼ã¨å¤‰æ›´ã‚’åŒæ™‚ã«è¡Œã†ã“ã¨ã«ãªã‚‹ï¼ã‚³ãƒ¼ãƒ‰åŒ–ã«ã‚ˆã‚Šï¼Œãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚’äº‹å‰ã«è¡Œã£ãŸã†ãˆã§å¤‰æ›´ã™ã‚‹ï¼Œã¨ã„ã†æ‰‹é †ã‚’è¸ã‚ã‚‹ï¼ ãƒ»ãƒ’ãƒ¥ãƒ¼ãƒãƒ³ã‚¨ãƒ©ãƒ¼ãŒæ¸›ã‚‹ ç”»é¢ä¸Šã‹ã‚‰ã®å¤‰æ›´ã§ã‚ã‚‹ã¨ï¼Œãƒ’ãƒ¥ãƒ¼ãƒãƒ³ã‚¨ãƒ©ãƒ¼ãŒèµ·ã“ã£ã¦ã—ã¾ã†ï¼ã‚³ãƒ¼ãƒ‰åŒ–ã™ã‚Œã°ï¼Œã“ã‚ŒãŒæ¸›ã‚‹ï¼ ãƒ»å†åˆ©ç”¨ã‚„å†—é•·åŒ–ãŒç°¡å˜ è¤‡æ•°ã®ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ãŸã‚ã«ï¼ŒåŒæ§˜ã®è¨­å®šã§åŒæ§˜ã®ã‚¤ãƒ³ãƒ•ãƒ©ã‚’æ§‹ç¯‰ã™ã‚‹å ´åˆã‚„ï¼Œä¸€ã¤ã®ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ãŸã‚ã«ï¼Œã‚¤ãƒ³ãƒ•ãƒ©ã‚’å†—é•·åŒ–ã™ã‚‹å ´åˆï¼Œã„ãã¤ã‚‚æ‰‹å‹•ã§æ§‹ç¯‰ã™ã‚‹å¿…è¦ãŒã‚ã‚Šï¼ŒåŠ´åŠ›ãŒã‹ã‹ã‚‹ï¼ã‚³ãƒ¼ãƒ‰åŒ–ã™ã‚Œã°ï¼Œã“ã‚ŒãŒæ¥½ã«ãªã‚‹ï¼ ãƒ»éå»ã®å¤‰æ›´ãŒè¨˜éŒ²ã«æ®‹ã‚‹ ç”»é¢ä¸Šã‹ã‚‰ã®å¤‰æ›´ã§ã‚ã‚‹ã¨ï¼Œéå»ã®å¤‰æ›´å±¥æ­´ãŒæ®‹ã‚‰ãªã„ï¼ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã‚’ãƒãƒ¼ã‚¸ãƒ§ãƒ³ç®¡ç†ã™ã‚Œã°ï¼ŒIssueã¨ç´ä»˜ã‘ã¦ï¼Œå±¥æ­´ã‚’æ®‹ã›ã‚‹ï¼ ãƒ‡ãƒ¡ãƒªãƒƒãƒˆ ãƒ»é‹ç”¨ã®ã‚¹ãƒ”ãƒ¼ãƒ‰ãŒè½ã¡ã‚‹ é‹ç”¨æ™‚ã«ï¼Œç”»é¢ä¸Šã‹ã‚‰ã®æ“ä½œã§ã‚ã‚Œã°ã™ãã«çµ‚ã‚ã‚‹å¤‰æ›´ã§ã‚ã‚‹ã®ã«ã‚‚ã‹ã‹ã‚ã‚‰ãšï¼Œã‚³ãƒ¼ãƒ‰åŒ–ã«ã‚ˆã‚Šï¼Œå¤‰æ›´ã¾ã§ã«æ™‚é–“ãŒã‹ã‹ã‚‹ï¼ãã®ãŸã‚ä¾‹ãˆã°AWSã¨ã™ã‚‹ã¨ï¼Œé‹ç”¨æ™‚ã«å¤‰æ›´ã™ã‚‹é »åº¦ãŒå¤šã„ã‚¤ãƒ³ãƒ•ãƒ©ï¼ˆä¾‹ï¼šAPI Gatewayï¼ˆVPCãƒªãƒ³ã‚¯ã‚’å«ã‚€ï¼‰ï¼ŒIAMãƒ¦ãƒ¼ã‚¶ï¼ˆç´ä»˜ã‘ã‚‹ãƒ­ãƒ¼ãƒ«ã‚„ãƒãƒªã‚·ãƒ¼ã‚’å«ã‚€ï¼‰ï¼‰ã¯ã‚³ãƒ¼ãƒ‰åŒ–ã›ãšï¼Œã‚ãˆã¦ç”»é¢ä¸Šã‹ã‚‰æ§‹ç¯‰ã™ã‚‹ï¼ ãƒ»ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼ã®æ©Ÿèƒ½è¿½åŠ ã«è¿½å¾“ã—ã«ãã„ ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼ã¯æ—¥ã€…æ©Ÿèƒ½ã‚’è¿½åŠ ã—ã¦ã„ã‚‹ï¼ç”»é¢ä¸Šã‹ã‚‰ã®æ“ä½œã§ã‚ã‚Œã°ã™ãã«ã“ã®æ©Ÿèƒ½ã‚’æ”¯ãˆã‚‹ãŒï¼Œã‚³ãƒ¼ãƒ‰åŒ–ã«ã‚ˆã‚Šï¼Œãƒ„ãƒ¼ãƒ«ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰ã—ãªã‘ã‚Œã°ï¼Œã“ã®æ©Ÿèƒ½ã‚’ä½¿ãˆãªã„ï¼é‹ç”¨æ™‚ã«ä¾¿åˆ©ãªæ©Ÿèƒ½ã‚’ã™ãã«ä½¿ãˆãªã„ãŸã‚ï¼Œã‚¤ãƒ³ãƒ•ãƒ©ã‚’æ”¹å–„ã§ããªã„ã“ã¨ã«ç¹‹ãŒã‚‹ï¼ã¾ãŸï¼Œã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ã®ã€æ–°æ©Ÿèƒ½ã‚’ä½¿ã£ã¦ã¿ãŸã„æ¬²ã€ãŒè¡Œãå ´ã‚’å¤±ã†ï¼ ãƒ»ãƒªãƒªãƒ¼ã‚¹ã®å¿ƒç†çš„ãƒãƒ¼ãƒ‰ãƒ«ãŒé«˜ã„ ç”»é¢ä¸Šã‹ã‚‰å¤‰æ›´ã™ã‚Œã°ï¼Œã‚¤ãƒ³ãƒ•ãƒ©å¤‰æ›´ã®ãƒªãƒªãƒ¼ã‚¹ä¸­ã«äºˆæœŸã›ã¬ã‚¨ãƒ©ãƒ¼ãŒèµ·ã“ã‚‹ã“ã¨ã¯ã¾ãšãªã„ï¼ã—ã‹ã—ï¼Œã‚³ãƒ¼ãƒ‰åŒ–ãƒ„ãƒ¼ãƒ«ã§ã¯ï¼Œå¤‰æ›´ã®ãƒªãƒªãƒ¼ã‚¹ä¸­ã«äºˆæœŸã›ã¬ã‚¨ãƒ©ãƒ¼ãŒèµ·ã“ã‚‹å¯èƒ½æ€§ã¯æ±ºã—ã¦ä½ããªã„ãŸã‚ï¼Œãƒªãƒªãƒ¼ã‚¹ã®å¿ƒç†çš„ãƒãƒ¼ãƒ‰ãƒ«ãŒé«˜ããªã‚‹ï¼ "},"public/infrastructure_as_code/infrastructure_as_code_terraform.html":{"url":"public/infrastructure_as_code/infrastructure_as_code_terraform.html","title":"ğŸ“– ï¸Terraform","keywords":"","body":"Terraform ã¯ã˜ã‚ã« æœ¬ã‚µã‚¤ãƒˆã«ã¤ãã¾ã—ã¦ï¼Œä»¥ä¸‹ã‚’ã”èªè­˜ã®ã»ã©å®œã—ããŠé¡˜ã„ã„ãŸã—ã¾ã™ï¼ å‚è€ƒï¼šhttps://hiroki-it.github.io/tech-notebook-gitbook/ 01. ã‚³ãƒãƒ³ãƒ‰ global option å‚è€ƒï¼šhttps://www.terraform.io/docs/cli/commands/index.html#switching-working-directory-with-chdir init ãƒ»-backend=false ãƒ­ãƒ¼ã‚«ãƒ«ã«stateãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã™ã‚‹ï¼ å‚è€ƒï¼šhttps://www.terraform.io/docs/language/settings/backends/index.html $ terraform init -backend=false # ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’æŒ‡å®šã™ã‚‹ã“ã¨ã‚‚å¯èƒ½ $ terraform -chdir= init -backend=false ãƒ»-backend=true, -backend-config å®Ÿã‚¤ãƒ³ãƒ•ãƒ©ã«stateãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã™ã‚‹ï¼ä»£ã‚ã‚Šã«ï¼Œterraform settingsãƒ–ãƒ­ãƒƒã‚¯å†…ã®backendã§æŒ‡å®šã—ã¦ã‚‚è‰¯ã„ï¼ãŸã ã—ï¼Œterraform settingãƒ–ãƒ­ãƒƒã‚¯å†…ã§ã¯å¤‰æ•°ã‚’ä½¿ç”¨ã§ããªã„ãŸã‚ï¼Œã“ã¡ã‚‰ã®ã‚ªãƒ—ã‚·ãƒ§ãƒ³ãŒæ¨å¥¨ã§ã‚ã‚‹ï¼ $ terraform init \\ -backend=true \\ -reconfigure \\ # ãƒã‚±ãƒƒãƒˆå -backend-config=\"bucket=foo-tfstate-bucket\" \\ # tfstateãƒ•ã‚¡ã‚¤ãƒ«å -backend-config=\"key=terraform.tfstate\" \\ # credentialsãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«å -backend-config=\"profile=bar\" \\ -backend-config=\"encrypt=true\" ãƒ»-reconfigure Terraformã‚’åˆæœŸåŒ–ã™ã‚‹ï¼ å‚è€ƒï¼šhttps://www.terraform.io/docs/cli/commands/init.html#backend-initialization $ terraform init -reconfigure ãƒ»-upgrade ç¾åœ¨ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã«åŸºã¥ã„ã¦ï¼Œlockãƒ•ã‚¡ã‚¤ãƒ«ï¼Œãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ï¼Œãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã®ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰ï¼ãƒ€ã‚¦ãƒ³ã‚°ãƒ¬ãƒ¼ãƒ‰ã‚’è¡Œã†ï¼ å‚è€ƒï¼šhttps://www.terraform.io/docs/cli/commands/init.html#upgrade $ terraform init -upgrade validate ãƒ»ã‚ªãƒ—ã‚·ãƒ§ãƒ³ç„¡ã— è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã®æ¤œè¨¼ã‚’è¡Œã†ï¼ $ terraform validate Success! The configuration is valid. # ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’æŒ‡å®šã™ã‚‹ã“ã¨ã‚‚å¯èƒ½ $ terraform -chdir= validate fmt ãƒ»-check ã‚¤ãƒ³ãƒ‡ãƒ³ãƒˆã‚’æƒãˆã‚‹ã¹ãç®‡æ‰€ãŒå­˜åœ¨ã™ã‚‹ã‹ã©ã†ã‹ã‚’åˆ¤å®šã™ã‚‹ï¼ã‚‚ã—å­˜åœ¨ã™ã‚‹å ´åˆã€Œ1ã€ï¼Œå­˜åœ¨ã—ãªã„å ´åˆã¯ã€Œ0ã€ã‚’è¿”å´ã™ã‚‹ï¼ $ terraform fmt -check ãƒ»-recursive è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã®ã‚¤ãƒ³ãƒ‡ãƒ³ãƒˆã‚’æƒãˆã‚‹ï¼å‡¦ç†ã‚’è¡Œã£ãŸãƒ•ã‚¡ã‚¤ãƒ«ãŒè¡¨ç¤ºã•ã‚Œã‚‹ï¼ # -recursive: ã‚µãƒ–ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’å«ã‚€å…¨ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ $ terraform fmt -recursive main.tf graph rosourceé–“ã®ä¾å­˜é–¢ä¿‚ã‚’ã‚°ãƒ©ãƒ•åŒ–ã™ã‚‹ï¼ã“ã‚Œã«ã‚ˆã‚Šï¼Œã©ã®resourceãŒä»–ã®ã©ã®resourceã‚’ä½¿ç”¨ã—ã¦ã„ã‚‹ã‹ãŒã‚ã‹ã‚‹ï¼Graphvizã®ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ãŒå¿…è¦ã§ã‚ã‚‹ï¼ å‚è€ƒï¼šhttps://graphviz.org/download/ $ terraform graph | dot -Tsvg > graph.svg import ãƒ»-var-file terraformã«ã‚ˆã‚‹æ§‹ç¯‰ã§ã¯ãªã„æ–¹æ³•ã§ï¼Œã™ã§ã«ã‚¯ãƒ©ã‚¦ãƒ‰ä¸Šã«ãƒªã‚½ãƒ¼ã‚¹ãŒæ§‹ç¯‰ã•ã‚Œã¦ã„ã‚‹å ´åˆï¼Œã“ã‚Œã‚’terraformã®ç®¡ç†ä¸‹ã«ãŠãå¿…è¦ãŒã‚ã‚‹ï¼ãƒªã‚½ãƒ¼ã‚¹ã‚¿ã‚¤ãƒ—ã¨ãƒªã‚½ãƒ¼ã‚¹åã‚’æŒ‡å®šã—ï¼Œstateãƒ•ã‚¡ã‚¤ãƒ«ã«å®Ÿã‚¤ãƒ³ãƒ•ãƒ©ã®çŠ¶æ…‹ã‚’æ›¸ãè¾¼ã‚€ï¼ç¾çŠ¶ï¼Œå…¨ã¦ã®ãƒªã‚½ãƒ¼ã‚¹ã‚’ä¸€æ‹¬ã—ã¦importã™ã‚‹æ–¹æ³•ã¯ç„¡ã„ï¼ãƒªã‚½ãƒ¼ã‚¹IDã¯ï¼Œãƒªã‚½ãƒ¼ã‚¹ã«ã‚ˆã£ã¦ç•°ãªã‚‹ãŸã‚ï¼Œãƒªãƒ•ã‚¡ãƒ¬ãƒ³ã‚¹ã®ã€ŒImportã€ã¾ãŸã¯ã€ŒAttributes Referenceã®idã€ã‚’ç¢ºèªã™ã‚‹ã“ã¨ï¼ˆä¾‹ãˆã°ï¼ŒACMã«ã¨ã£ã¦ã®IDã¯ARNã ãŒï¼ŒS3ãƒã‚±ãƒƒãƒˆã«ã¨ã£ã¦ã®IDã¯ãƒã‚±ãƒƒãƒˆåã§ã‚ã‚‹ï¼‰ï¼ $ terraform import \\ -var-file=foo.tfvars \\ . ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’ä½¿ç”¨ã—ã¦ã„ã‚‹å ´åˆï¼ŒæŒ‡å®šã®æ–¹æ³•ãŒç•°ãªã‚‹ï¼ $ terraform import \\ -var-file=foo.tfvars \\ module... ä¾‹ãˆã°ï¼ŒAWSä¸Šã«ã™ã§ã«ECRãŒå­˜åœ¨ã—ã¦ã„ã‚‹ã¨ã—ã¦ï¼Œã“ã‚Œã‚’terraformã®ç®¡ç†ä¸‹ã«ãŠãï¼ $ terraform import \\ -var-file=foo.tfvars \\ module.ecr.aws_ecr_repository.www xxxxxxxxx ãã—ã¦ï¼Œãƒ­ãƒ¼ã‚«ãƒ«ã®stateãƒ•ã‚¡ã‚¤ãƒ«ã¨å®Ÿã‚¤ãƒ³ãƒ•ãƒ©ã®å·®åˆ†ãŒç„¡ããªã‚‹ã¾ã§ï¼Œimportã‚’ç¹°ã‚Šè¿”ã™ï¼ $ terraform plan -var-file=foo.tfvars No changes. Infrastructure is up-to-date. ãƒ»importã‚’è¡Œã‚ãªã‹ã£ãŸå ´åˆã®ã‚¨ãƒ©ãƒ¼ ã‚‚ã—importã‚’è¡Œã‚ãªã„ã¨ï¼Œã™ã§ã«ã‚¯ãƒ©ã‚¦ãƒ‰ä¸Šã«ãƒªã‚½ãƒ¼ã‚¹ãŒå­˜åœ¨ã—ã¦ã„ã‚‹ãŸã‚ã«ãƒªã‚½ãƒ¼ã‚¹ã‚’æ§‹ç¯‰ã§ããªã„ï¼Œã¨ã„ã†ã‚¨ãƒ©ãƒ¼ã«ãªã‚‹ï¼ ï¼ˆã‚¨ãƒ©ãƒ¼ä¾‹1ï¼‰ Error: InvalidParameterException: Creation of service was not idempotent. ï¼ˆã‚¨ãƒ©ãƒ¼ä¾‹2ï¼‰ Error: error creating ECR repository: RepositoryAlreadyExistsException: The repository with name 'tech-notebook_www' already exists in the registry with id 'XXXXXXXXXXXX' refresh ãƒ»-var-file ã‚¯ãƒ©ã‚¦ãƒ‰ã«å¯¾ã—ã¦ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’è¡Œã„ï¼Œç¾åœ¨ã®ãƒªã‚½ãƒ¼ã‚¹ã®çŠ¶æ…‹ã‚’tfstateãƒ•ã‚¡ã‚¤ãƒ«ã«åæ˜ ã™ã‚‹ï¼ $ terraform refresh -var-file=foo.tfvars plan ãƒ»ã‚·ãƒ³ãƒœãƒ«ã®è¦‹æ–¹ æ§‹ç¯‰ï¼ˆ+ï¼‰ï¼Œæ›´æ–°ï¼ˆ~ï¼‰ï¼Œå‰Šé™¤ï¼ˆ-ï¼‰ï¼Œå†æ§‹ç¯‰ï¼ˆ-/+ï¼‰ã§è¡¨ç¾ã•ã‚Œã‚‹ï¼ + create ~ update in-place - destroy -/+ destroy and then create replacement ãƒ»å‡ºåŠ›å†…å®¹ã®èª­ã¿æ–¹ å‰åŠéƒ¨åˆ†ã¨å¾ŒåŠéƒ¨åˆ†ã«åŒºåˆ¥ã•ã‚Œã¦ã„ã‚‹ï¼å‰åŠéƒ¨åˆ†ã¯ï¼ŒTerraformç®¡ç†å¤–ã®æ–¹æ³•ï¼ˆç”»é¢ä¸Šï¼Œä»–ãƒ„ãƒ¼ãƒ«ï¼‰ã«ã‚ˆã‚‹å®Ÿã‚¤ãƒ³ãƒ•ãƒ©ã®å¤‰æ›´ã«ã¤ã„ã¦ï¼Œãã®å¤‰æ›´å‰å¾Œã‚’æ¤œå‡ºã™ã‚‹ï¼ãŸã ã®æ¤œå‡ºã®ãŸã‚ï¼Œapplyã«ã‚ˆã£ã¦å¤‰æ›´ã•ã‚Œã‚‹å®Ÿã‚¤ãƒ³ãƒ•ãƒ©ã‚’è¡¨ã—ã¦ã„ã‚‹ã‚ã‘ã§ã¯ãªã„ï¼ãã—ã¦å¾ŒåŠéƒ¨åˆ†ã¯ï¼ŒTerraformã®ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã®å¤‰æ›´ã«ã‚ˆã£ã¦ï¼Œå®Ÿã‚¤ãƒ³ãƒ•ãƒ©ãŒã©ã®ã‚ˆã†ã«å¤‰æ›´ã•ã‚Œã‚‹ã‹ï¼Œã‚’è¡¨ã—ã¦ã„ã‚‹ï¼çµæœã®æœ€å¾Œã«è¡¨ç¤ºã•ã‚Œã‚‹å¯¾è±¡ãƒªã‚½ãƒ¼ã‚¹ã®æ•°ã‚’ç¢ºèªã—ã¦ã‚‚ï¼Œå‰åŠéƒ¨åˆ†ã®ãƒªã‚½ãƒ¼ã‚¹ã¯å«ã¾ã‚Œã¦ã„ãªã„ã“ã¨ãŒã‚ã‹ã‚‹ï¼ Note: Objects have changed outside of Terraform Terraform detected the following changes made outside of Terraform since the last \"terraform apply\": # Terraformç®¡ç†å¤–ã®æ–¹æ³•ï¼ˆç”»é¢ä¸Šï¼Œä»–ãƒ„ãƒ¼ãƒ«ï¼‰ã«ã‚ˆã‚‹å®Ÿã‚¤ãƒ³ãƒ•ãƒ©ã®å¤‰æ›´ã«ã¤ã„ã¦ï¼Œãã®å¤‰æ›´å‰å¾Œã‚’æ¤œå‡ºï¼ Unless you have made equivalent changes to your configuration, or ignored the relevant attributes using ignore_changes, the following plan may include actions to undo or respond to these changes. â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Terraform used the selected providers to generate the following execution plan. Resource actions are indicated with the following symbols: ~ update in-place Terraform will perform the following actions: # Terraformã®ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã®å¤‰æ›´ã«ã‚ˆã£ã¦ï¼Œå®Ÿã‚¤ãƒ³ãƒ•ãƒ©ãŒã©ã®ã‚ˆã†ã«å¤‰æ›´ã•ã‚Œã‚‹ã‹ï¼ Plan: 0 to add, 1 to change, 0 to destroy. ãƒ»å·®åˆ†èªè­˜ã•ã‚Œã‚‹ï¼ã•ã‚Œãªã„å¤‰æ›´ å¤‰æ›´å†…å®¹ ã•ã‚Œã‚‹ï¼ã•ã‚Œãªã„ ãƒªã‚½ãƒ¼ã‚¹åã®å¤‰æ›´ ã•ã‚Œã‚‹ ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«åã®å¤‰æ›´ ã•ã‚Œã‚‹ ãƒ•ã‚¡ã‚¤ãƒ«ã‚„ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’æŒ‡å®šã™ã‚‹ãƒ‘ã‚¹ã®å¤‰æ›´ ã•ã‚Œãªã„ ãƒªã‚½ãƒ¼ã‚¹ã«ãƒãƒ¼ãƒ‰ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã•ã‚ŒãŸå€¤ã‚’ç’°å¢ƒå¤‰æ•°ã«å¤‰æ›´ï¼ˆtfvarsãƒ•ã‚¡ã‚¤ãƒ«ã«ç§»è¡Œï¼‰ ã•ã‚Œãªã„ ãƒ»-var-file ã‚¯ãƒ©ã‚¦ãƒ‰ã«å¯¾ã—ã¦ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’è¡Œã„ï¼Œç¾åœ¨ã®ãƒªã‚½ãƒ¼ã‚¹ã®çŠ¶æ…‹ã‚’tfstateãƒ•ã‚¡ã‚¤ãƒ«ã«ã¯åæ˜ ã›ãšã«ï¼Œè¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã®è¨˜è¿°ã¨ã®å·®åˆ†ã‚’æ¤œè¨¼ã™ã‚‹ï¼ã‚¹ã‚¯ãƒªãƒ—ãƒˆå®Ÿè¡Œæ™‚ã«ï¼Œå¤‰æ•°ãŒå®šç¾©ã•ã‚ŒãŸãƒ•ã‚¡ã‚¤ãƒ«ã‚’å®Ÿè¡Œã™ã‚‹ã¨ï¼Œvariableã§å®£è¨€ã—ãŸå¤‰æ•°ã«ï¼Œå€¤ãŒæ ¼ç´ã•ã‚Œã‚‹ï¼ $ terraform plan -var-file=foo.tfvars # ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’æŒ‡å®šã™ã‚‹ã“ã¨ã‚‚å¯èƒ½ # ç¬¬ä¸€å¼•æ•°ã§å¤‰æ•°ãƒ•ã‚¡ã‚¤ãƒ«ã®ç›¸å¯¾ãƒ‘ã‚¹ï¼Œç¬¬äºŒå¼•æ•°ã§ã‚’ãƒ«ãƒ¼ãƒˆãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã®ç›¸å¯¾ãƒ‘ã‚¹ $ terraform plan -chdir= \\ -var-file=/foo.tfvars å·®åˆ†ãŒãªã‘ã‚Œã°ï¼Œä»¥ä¸‹ã®é€šã‚Šã«ãªã‚‹ï¼ No changes. Infrastructure is up-to-date. This means that Terraform did not detect any differences between your configuration and real physical resources that exist. As a result, no actions need to be performed. ãƒ»-target ç‰¹å®šã®ãƒªã‚½ãƒ¼ã‚¹ã«å¯¾ã—ã¦ï¼Œplanã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã™ã‚‹ï¼ $ terraform plan \\ -var-file=foo.tfvars \\ -target=. ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’ä½¿ç”¨ã—ã¦ã„ã‚‹å ´åˆï¼ŒæŒ‡å®šã®æ–¹æ³•ãŒç•°ãªã‚‹ï¼ $ terraform plan \\ -var-file=foo.tfvars \\ -target=module... ãƒ»-refresh ã“ã®ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’ã¤ã‘ã‚Œã°ï¼Œrefreshã‚³ãƒãƒ³ãƒ‰ã‚’åŒæ™‚ã«å®Ÿè¡Œã—ã¦ãã‚Œã‚‹ï¼ãŸã ï¼Œæ¨™æº–ã§trueãªã®ã§ï¼Œä¸è¦ã§ã‚ã‚‹ï¼ $ terraform plan \\ -var-file=foo.tfvars \\ -refresh=true https://github.com/hashicorp/terraform/issues/17311 ãƒ»-parallelism ä¸¦åˆ—å‡¦ç†æ•°ã‚’è¨­å®šã§ãã‚‹ï¼æ¨™æº–å€¤ã¯10ã§ã‚ã‚‹ï¼ $ terraform plan \\ -var-file=foo.tfvars \\ -parallelism=30 ãƒ»-out å®Ÿè¡Œãƒ—ãƒ©ãƒ³ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç”Ÿæˆã™ã‚‹ï¼applyã‚³ãƒãƒ³ãƒ‰ã®ãŸã‚ã«ä½¿ç”¨ã§ãã‚‹ï¼ $ terraform plan \\ -var-file=foo.tfvars \\ # å®Ÿè¡Œãƒ—ãƒ©ãƒ³ãƒ•ã‚¡ã‚¤ãƒ«å -out=foo.tfplan apply ãƒ»-var-file AWSä¸Šã«ã‚¯ãƒ©ã‚¦ãƒ‰ã‚¤ãƒ³ãƒ•ãƒ©ã‚¹ãƒˆãƒ©ã‚¯ãƒãƒ£ã‚’æ§‹ç¯‰ã™ã‚‹ï¼ $ terraform apply -var-file foo.tfvars # ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’æŒ‡å®šã™ã‚‹ã“ã¨ã‚‚å¯èƒ½ $ terraform -chdir= apply \\ -var-file=/foo.tfvars æˆåŠŸã™ã‚‹ã¨ï¼Œä»¥ä¸‹ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒè¡¨ç¤ºã•ã‚Œã‚‹ï¼ Apply complete! Resources: 1 added, 0 changed, 0 destroyed. ãƒ»-target ç‰¹å®šã®ãƒªã‚½ãƒ¼ã‚¹ã«å¯¾ã—ã¦ï¼Œapplyã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã™ã‚‹ï¼ $ terraform apply \\ -var-file=foo.tfvars \\ -target=. ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’ä½¿ç”¨ã—ã¦ã„ã‚‹å ´åˆï¼ŒæŒ‡å®šã®æ–¹æ³•ãŒç•°ãªã‚‹ï¼ $ terraform apply \\ -var-file=foo.tfvars \\ -target=module... ãƒ»-parallelism ä¸¦åˆ—å‡¦ç†æ•°ã‚’è¨­å®šã§ãã‚‹ï¼æ¨™æº–å€¤ã¯10ã§ã‚ã‚‹ï¼ $ terraform apply \\ -var-file=foo.tfvars \\ -parallelism=30 ãƒ»å®Ÿè¡Œãƒ—ãƒ©ãƒ³ãƒ•ã‚¡ã‚¤ãƒ« äº‹å‰ã«ï¼Œplanã‚³ãƒãƒ³ãƒ‰ã«ã‚ˆã£ã¦ç”Ÿæˆã•ã‚ŒãŸå®Ÿè¡Œãƒ—ãƒ©ãƒ³ãƒ•ã‚¡ã‚¤ãƒ«ã‚’å…ƒã«ï¼Œapplyã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã™ã‚‹ï¼å®Ÿè¡Œãƒ—ãƒ©ãƒ³ã‚’æ¸¡ã™å ´åˆã¯ï¼Œå¤‰æ•°ã‚’ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã«è¨­å®šã™ã‚‹å¿…è¦ã¯ãªã„ï¼ $ terraform apply foo.tfplan taint ãƒ»-var-file stateãƒ•ã‚¡ã‚¤ãƒ«ã«ãŠã‘ã‚‹æŒ‡å®šã•ã‚ŒãŸãƒªã‚½ãƒ¼ã‚¹ã®taintedãƒ•ãƒ©ã‚°ã‚’ç«‹ã¦ã‚‹ï¼ä¾‹ãˆã°ï¼Œapplyã—ãŸãŒï¼Œé€”ä¸­ã§ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¦ã—ã¾ã„ï¼Œå®Ÿã‚¤ãƒ³ãƒ•ãƒ©ã«ä¸­é€”åŠç«¯ã¯ãƒªã‚½ãƒ¼ã‚¹ãŒæ§‹ç¯‰ã•ã‚Œã¦ã—ã¾ã†ã“ã¨ãŒã‚ã‚‹ï¼ã“ã“ã§ï¼Œtaintedã‚’ç«‹ã¦ã¦ãŠãã¨ï¼Œå®Ÿã‚¤ãƒ³ãƒ•ãƒ©ã®ãƒªã‚½ãƒ¼ã‚¹ã‚’å‰Šé™¤ã—ãŸã¨æƒ³å®šã—ãŸplanã‚’å®Ÿè¡Œã§ãã‚‹ï¼ $ terraform taint \\ -var-file=foo.tfvars \\ module... ã“ã®å¾Œã®planã‚³ãƒãƒ³ãƒ‰ã®ãƒ­ã‚°ã‹ã‚‰ã‚‚ï¼Œ-/+ã§å‰Šé™¤ãŒè¡Œã‚ã‚Œã‚‹æƒ³å®šã§ï¼Œå·®åˆ†ã‚’æ¯”è¼ƒã—ã¦ã„ã‚‹ã“ã¨ãŒã‚ã‹ã‚‹ï¼ $ terraform plan -var-file=foo.tfvars An execution plan has been generated and is shown below. Resource actions are indicated with the following symbols: -/+ destroy and then create replacement Terraform will perform the following actions: -/+ . (tainted) (new resource required) id: '1492336661259070634' => (forces new resource) Plan: 1 to add, 0 to change, 1 to destroy. state list ãƒ»ã‚ªãƒ—ã‚·ãƒ§ãƒ³ç„¡ã— ãƒ•ã‚¡ã‚¤ãƒ«å†…ã§å®šç¾©ã—ã¦ã„ã‚‹ãƒªã‚½ãƒ¼ã‚¹ã®ä¸€è¦§ã‚’è¡¨ç¤ºã™ã‚‹ï¼ $ terraform state list ä»¥ä¸‹ã®é€šã‚Šï¼Œãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚‚å«ã‚ã¦ï¼Œãƒªã‚½ãƒ¼ã‚¹ãŒè¡¨ç¤ºã•ã‚Œã‚‹ï¼ aws_instance.www-1a aws_instance.www-1c aws_key_pair.key_pair module.alb_module.aws_alb.alb module.ami_module.data.aws_ami.amazon_linux_2 module.route53_module.aws_route53_record.r53_record module.route53_module.aws_route53_zone.r53_zone module.security_group_module.aws_security_group.security_group_alb module.security_group_module.aws_security_group.security_group_ecs module.security_group_module.aws_security_group.security_group_instance module.vpc_module.aws_internet_gateway.internet_gateway module.vpc_module.aws_route_table.route_table_public module.vpc_module.aws_route_table_association.route_table_association_public_1a module.vpc_module.aws_route_table_association.route_table_association_public_1c module.vpc_module.aws_subnet.subnet_public_1a module.vpc_module.aws_subnet.subnet_public_1c module.vpc_module.aws_vpc.vpc 01-02. ãƒãƒ¼ã‚¸ãƒ§ãƒ³ ãƒãƒ¼ã‚¸ãƒ§ãƒ³ç®¡ç† ãƒ»lockãƒ•ã‚¡ã‚¤ãƒ« ç¾åœ¨ä½¿ç”¨ä¸­ã®ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ãŒå®šç¾©ã•ã‚Œã‚‹ï¼ã“ã‚Œã«ã‚ˆã‚Šï¼Œä»–ã®äººãŒãƒªãƒã‚¸ãƒˆãƒªã‚’ä½¿ç”¨ã™ã‚‹æ™‚ã«ï¼Œç•°ãªã‚‹ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã®ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼ã‚’å®£è¨€ã§ããªã„ã‚ˆã†ã«ã™ã‚‹ï¼ã‚‚ã—ï¼Œç•°ãªã‚‹ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’ä½¿ç”¨ã—ãŸã„å ´åˆã¯ï¼Œä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã™ã‚‹ï¼ã“ã‚Œã«ã‚ˆã‚Šï¼Œlockãƒ•ã‚¡ã‚¤ãƒ«ã®ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰ï¼ãƒ€ã‚¦ãƒ³ã‚°ãƒ¬ãƒ¼ãƒ‰ãŒå®Ÿè¡Œã•ã‚Œã‚‹ï¼ $ terraform init -upgrade Terraformï¼ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼ã®ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰ 1. ç¾åœ¨ã®Terraformã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã§applyã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œ ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰ã¨åŒæ™‚ã«æ–°ã—ã„AWSãƒªã‚½ãƒ¼ã‚¹ã‚’ãƒ‡ãƒ—ãƒ­ã‚¤ã›ãšã«ï¼Œã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰ã®ã¿ã«å°‚å¿µã™ã‚‹ï¼ãã®ãŸã‚ã«ï¼Œç¾åœ¨ã®Terraformã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã§applyã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ï¼Œå·®åˆ†ãŒç„¡ã„ã‚ˆã†ã«ã—ã¦ãŠãï¼ 2. ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰ä»¥å¤–ã®ä½œæ¥­ã‚’æ¸ˆã¾ã›ã¦ãŠã ä½ã„ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã®Terraformã«å¯¾ã—ã¦ï¼Œã‚ˆã‚Šé«˜ã„ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’ãƒ‡ãƒ—ãƒ­ã‚¤ã™ã‚‹ã“ã¨ã¯å¯èƒ½ã§ã‚ã‚‹ï¼åå¯¾ã«ï¼Œé«˜ã„ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã®Terraoformã«å¯¾ã—ã¦ï¼Œã‚ˆã‚Šä½ã„ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’ãƒ‡ãƒ—ãƒ­ã‚¤ã§ããªã„ï¼ãã®ãŸã‚ï¼Œã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰ã—ã¦ã—ã¾ã†ã¨ï¼Œãã‚Œä»¥å¤–ã®Teraformãƒãƒ¼ã‚¸ãƒ§ãƒ³ã®ç•°ãªã‚‹ä½œæ¥­ã«å½±éŸ¿ãŒå‡ºã‚‹ï¼ 3. ãƒ¡ã‚¸ãƒ£ãƒ¼ãƒãƒ¼ã‚¸ãƒ§ãƒ³å˜ä½ã§ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰ Terraformã§ã¯ï¼Œãƒ¡ã‚¸ãƒ£ãƒ¼ãƒãƒ¼ã‚¸ãƒ§ãƒ³å˜ä½ã§ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰ã‚’è¡Œã†ã“ã¨ãŒæ¨å¥¨ã•ã‚Œã¦ã„ã‚‹ï¼ãã®ãŸã‚ï¼Œç¾åœ¨ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã¨æœ€æ–°ãƒãƒ¼ã‚¸ãƒ§ãƒ³ãŒã©ã‚“ãªã«é›¢ã‚Œã¦ã„ã¦ã‚‚ï¼Œå¿…ãšä¸€ã¤ãšã¤ãƒ¡ã‚¸ãƒ£ãƒ¼ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰ã™ã‚‹ã‚ˆã†ã«æ°—ã‚’ã¤ã‘ã‚‹ï¼ å‚è€ƒï¼šhttps://www.terraform.io/upgrade-guides/1-0.html 4. planã‚³ãƒãƒ³ãƒ‰ã®è­¦å‘Šï¼ã‚¨ãƒ©ãƒ¼ã‚’è§£æ¶ˆ ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰ã«ä¼´ã£ã¦ï¼Œéæ¨å¥¨ï¼å»ƒæ­¢ã®æ©Ÿèƒ½ãŒãƒªãƒªãƒ¼ã‚¹ã•ã‚Œï¼Œè­¦å‘Šï¼ã‚¨ãƒ©ãƒ¼ãŒå‡ºåŠ›ã•ã‚Œã‚‹å ´åˆãŒã‚ã‚‹ï¼è­¦å‘Šï¼ã‚¨ãƒ©ãƒ¼ã‚’è§£æ¶ˆã§ãã‚‹ã‚ˆã†ã«ï¼Œè¨˜æ³•ã‚„ã‚ªãƒ—ã‚·ãƒ§ãƒ³å€¤ã‚’ä¿®æ­£ã™ã‚‹ï¼å ´åˆã«ã‚ˆã£ã¦ã¯tfstateãƒ•ã‚¡ã‚¤ãƒ«ã®å·®åˆ†ã¨ã—ã¦è¡¨ç¤ºã•ã‚Œã¦ã„ã‚‹ã ã‘ã§ï¼Œå®Ÿã‚¤ãƒ³ãƒ•ãƒ©ã¨ã®å·®åˆ†ã§ã¯ãªã„å ´åˆã‚‚ã‚ã‚‹ãŸã‚ï¼Œplanã§å·®åˆ†ãŒã‚ã£ãŸã¨ã—ã¦ã‚‚ï¼Œå®Ÿã‚¤ãƒ³ãƒ•ãƒ©ã«å½±éŸ¿ãŒãªã‘ã‚Œã°å•é¡Œãªã„ï¼ 5. Terraformã®å¾Œã«ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼ã‚’ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰ Terraformã¨ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã¯ç‹¬ç«‹ã—ã¦ç®¡ç†ã•ã‚Œã¦ã„ã‚‹ï¼ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼ã¯TerraformãŒåœŸå°ã«ãªã£ã¦ç¨¼åƒã™ã‚‹ãŸã‚ï¼Œä¸€æ—¦ï¼ŒTerraformã®ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰ã‚’æ¸ˆã¾ã›ã¦ã‹ã‚‰ï¼Œãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼ã‚’ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰ã™ã‚‹ï¼ 01-03. ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹æˆ ãƒ«ãƒ¼ãƒˆãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã®æ§‹æˆ ãƒ»ç¨¼åƒç’°å¢ƒåˆ¥ ç¨¼åƒç’°å¢ƒåˆ¥ã«ï¼Œfoo.tfvarsãƒ•ã‚¡ã‚¤ãƒ«ã§å€¤ã‚’å®šç¾©ã™ã‚‹ï¼ terraform_project/ â”œâ”€â”€ modules â”‚ â”œâ”€â”€ route53 # Route53 â”‚ â”‚ â”œâ”€â”€ dev # é–‹ç™º â”‚ | â”œâ”€â”€ prd # æœ¬ç•ª â”‚ | â””â”€â”€ stg # ã‚¹ãƒ†ãƒ¼ã‚¸ãƒ³ã‚° â”‚ | â”‚ â”œâ”€â”€ ssm # SSM | | â”œâ”€â”€ dev â”‚ | â”œâ”€â”€ prd â”‚ | â””â”€â”€ stg â”‚ | â”‚ â””â”€â”€ waf # WAF | â”œâ”€â”€ dev â”‚ â”œâ”€â”€ prd â”‚ â””â”€â”€ stg | â”œâ”€â”€ dev # é–‹ç™ºç’°å¢ƒãƒ«ãƒ¼ãƒˆãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ« â”‚ â”œâ”€â”€ dev.tfvars â”‚ â”œâ”€â”€ main.tf â”‚ â”œâ”€â”€ providers.tf â”‚ â”œâ”€â”€ tfnotify.yml â”‚ â””â”€â”€ variables.tf â”‚ â”œâ”€â”€ prd # æœ¬ç•ªç’°å¢ƒãƒ«ãƒ¼ãƒˆãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ« â”‚ â”œâ”€â”€ prd.tfvars â”‚ â”œâ”€â”€ main.tf â”‚ â”œâ”€â”€ providers.tf â”‚ â”œâ”€â”€ tfnotify.yml â”‚ â””â”€â”€ variables.tf â”‚ â””â”€â”€ stg # ã‚¹ãƒ†ãƒ¼ã‚¸ãƒ³ã‚°ç’°å¢ƒãƒ«ãƒ¼ãƒˆãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ« â”œâ”€â”€ stg.tfvars â”œâ”€â”€ main.tf â”œâ”€â”€ providers.tf â”œâ”€â”€ tfnotify.yml â””â”€â”€ variables.tf ãƒªã‚½ãƒ¼ã‚¹ã®ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã®æ§‹æˆ ã€€ãƒ»å¯¾è±¡ãƒªã‚½ãƒ¼ã‚¹åˆ¥ ä¸€ã¤ã®ãƒªã‚½ãƒ¼ã‚¹ã®è¨­å®šãŒå¯¾è±¡ã®ãƒªã‚½ãƒ¼ã‚¹ã”ã¨ã«ç•°ãªã‚‹å ´åˆï¼Œå†—é•·æ€§ã‚ˆã‚Šã‚‚ä¿å®ˆæ€§ã‚’é‡è¦–ã—ã¦ï¼Œãƒªã‚½ãƒ¼ã‚¹ã«å¿œã˜ãŸãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«åˆ†å‰²ã™ã‚‹ï¼ terraform_project/ â””â”€â”€ modules â”œâ”€â”€ cloudwatch # CloudWatch â”‚ â”œâ”€â”€ alb # ALB | â”œâ”€â”€ cloudfront # CloudFront | â”œâ”€â”€ ecs # ECS | â”œâ”€â”€ lambda # Lambda | â””â”€â”€ rds # RDS | â””â”€â”€ waf # WAF â”œâ”€â”€ alb # ALB â”œâ”€â”€ api_gateway # API Gateway â””â”€â”€ cloudfront # CloudFront ãƒ»ç¨¼åƒç’°å¢ƒåˆ¥ ä¸€ã¤ã®ãƒªã‚½ãƒ¼ã‚¹ã®è¨­å®šãŒç¨¼åƒç’°å¢ƒã”ã¨ã«ç•°ãªã‚‹å ´åˆï¼Œå†—é•·æ€§ã‚ˆã‚Šã‚‚ä¿å®ˆæ€§ã‚’é‡è¦–ã—ã¦ï¼Œç¨¼åƒç’°å¢ƒã«å¿œã˜ãŸãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«åˆ†å‰²ã™ã‚‹ï¼ terraform_project/ â””â”€â”€ modules â”œâ”€â”€ route53 # Route53 â”‚ â”œâ”€â”€ dev # é–‹ç™º | â”œâ”€â”€ prd # æœ¬ç•ª | â””â”€â”€ stg # ã‚¹ãƒ†ãƒ¼ã‚¸ãƒ³ã‚° | â”œâ”€â”€ ssm # SSM | â”œâ”€â”€ dev | â”œâ”€â”€ prd | â””â”€â”€ stg | â””â”€â”€ waf # WAF â””â”€â”€ alb â”œâ”€â”€ dev â”œâ”€â”€ prd â””â”€â”€ stg ãƒ»ãƒªãƒ¼ã‚¸ãƒ§ãƒ³åˆ¥ ä¸€ã¤ã®ãƒªã‚½ãƒ¼ã‚¹ã®è¨­å®šãŒãƒªãƒ¼ã‚¸ãƒ§ãƒ³ã”ã¨ã«ç•°ãªã‚‹å ´åˆï¼Œå†—é•·æ€§ã‚ˆã‚Šã‚‚ä¿å®ˆæ€§ã‚’é‡è¦–ã—ã¦ï¼Œãƒªãƒ¼ã‚¸ãƒ§ãƒ³ã«å¿œã˜ãŸãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«åˆ†å‰²ã™ã‚‹ï¼ terraform_project/ â””â”€â”€ modules â””â”€â”€ acm # ACM â”œâ”€â”€ ap-northeast-1 # æ±äº¬ãƒªãƒ¼ã‚¸ãƒ§ãƒ³ â””â”€â”€ us-east-1 # ãƒãƒ¼ã‚¸ãƒ‹ã‚¢ãƒªãƒ¼ã‚¸ãƒ§ãƒ³ ãƒ»å…±é€šã‚»ãƒƒãƒˆåˆ¥ WAFã§ä½¿ç”¨ã™ã‚‹IPãƒ‘ã‚¿ãƒ¼ãƒ³ã‚»ãƒƒãƒˆã¨æ­£è¦è¡¨ç¾ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚»ãƒƒãƒˆã«ã¯ï¼ŒCloudFrontã‚¿ã‚¤ãƒ—ã¨Regionalã‚¿ã‚¤ãƒ—ãŒã‚ã‚‹ï¼Regionalã‚¿ã‚¤ãƒ—ã¯ï¼ŒåŒã˜ãƒªãƒ¼ã‚¸ãƒ§ãƒ³ã®ç•°ãªã‚‹AWSãƒªã‚½ãƒ¼ã‚¹é–“ã§å…±é€šã—ã¦ä½¿ç”¨ã§ãã‚‹ãŸã‚ï¼Œå…±é€šã‚»ãƒƒãƒˆã¨ã—ã¦ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªåˆ†å‰²ã‚’è¡Œã†ï¼ terraform_project/ â””â”€â”€ modules â””â”€â”€ waf # WAF â”œâ”€â”€ alb â”œâ”€â”€ api_gateway â”œâ”€â”€ cloudfront â””â”€â”€ regional_sets # Regionalã‚¿ã‚¤ãƒ—ã®ã‚»ãƒƒãƒˆ â”œâ”€â”€ ip_sets # IPã‚»ãƒƒãƒˆ | â”œâ”€â”€ prd | â””â”€â”€ stg | â””â”€â”€ regex_pattern_sets # æ­£è¦è¡¨ç¾ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚»ãƒƒãƒˆ â”œâ”€â”€ prd â””â”€â”€ stg ãƒ»ãƒ•ã‚¡ã‚¤ãƒ«ã®åˆ‡ã‚Šåˆ†ã‘ ãƒãƒªã‚·ãƒ¼ã®ãŸã‚ã«JSONã‚’å®šç¾©ã™ã‚‹å ´åˆï¼ŒTerraformã®ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã«ãƒãƒ¼ãƒ‰ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã›ãšã«ï¼Œåˆ‡ã‚Šåˆ†ã‘ã‚‹ã‚ˆã†ã«ã™ã‚‹ï¼ã¾ãŸï¼Œã€Œã‚«ã‚¹ã‚¿ãƒãƒ¼ç®¡ç†ãƒãƒªã‚·ãƒ¼ã€ã€Œã‚¤ãƒ³ãƒ©ã‚¤ãƒ³ãƒãƒªã‚·ãƒ¼ã€ã€Œä¿¡é ¼ãƒãƒªã‚·ãƒ¼ã€ã‚‚åŒºåˆ¥ã—ï¼Œãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’åˆ†å‰²ã—ã¦ã„ã‚‹ï¼ãªãŠï¼Œtemplatefileãƒ¡ã‚½ãƒƒãƒ‰ã§ã“ã‚Œã‚’èª­ã¿ã“ã‚€æ™‚ï¼Œbashãƒ•ã‚¡ã‚¤ãƒ«ã§ã¯ãªãï¼Œtplãƒ•ã‚¡ã‚¤ãƒ«ã¨ã—ã¦å®šç¾©ã—ã¦ãŠãå¿…è¦ã‚ã‚‹ãŸã‚ï¼Œæ³¨æ„ã™ã‚‹ï¼ terraform_project/ â””â”€â”€ modules â”œâ”€â”€ ecr #ECR â”‚ â””â”€â”€ ecr_lifecycle_policy.tpl # ECRãƒ©ã‚¤ãƒ•ã‚µã‚¤ã‚¯ãƒ« â”‚ â”œâ”€â”€ ecs # ECS â”‚ â””â”€â”€ container_definitions.tpl # ã‚³ãƒ³ãƒ†ãƒŠå®šç¾© â”‚ â”œâ”€â”€ iam # IAM â”‚ â””â”€â”€ policies | â”œâ”€â”€ customer_managed_policies # ã‚«ã‚¹ã‚¿ãƒ ç®¡ç†ãƒãƒªã‚·ãƒ¼ | | â”œâ”€â”€ aws_cli_executor_access_policy.tpl | | â”œâ”€â”€ aws_cli_executor_access_address_restriction_policy.tpl | | â”œâ”€â”€ cloudwatch_logs_access_policy.tpl | | â””â”€â”€ lambda_edge_execution_policy.tpl | | | â”œâ”€â”€ inline_policies # ã‚¤ãƒ³ãƒ©ã‚¤ãƒ³ãƒãƒªã‚·ãƒ¼ | | â””â”€â”€ ecs_task_policy.tpl | | | â””â”€â”€ trust_policies # ä¿¡é ¼ãƒãƒªã‚·ãƒ¼ | â”œâ”€â”€ cloudwatch_events_policy.tpl | â”œâ”€â”€ ecs_task_policy.tpl | â”œâ”€â”€ lambda_policy.tpl | â””â”€â”€ rds_policy.tpl | â””â”€â”€ s3 # S3 â””â”€â”€ policies # ãƒã‚±ãƒƒãƒˆãƒãƒªã‚·ãƒ¼ â””â”€â”€ alb_bucket_policy.tpl CI/CDãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª ãƒ»opsãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª Terraformã®CI/CDã§å¿…è¦ãªã‚·ã‚§ãƒ«ã‚¹ã‚¯ãƒªãƒ—ãƒˆã¯ï¼Œopsãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã§ç®¡ç†ã™ã‚‹ï¼ terraform_project/ â”œâ”€â”€ .circleci # CI/CDãƒ„ãƒ¼ãƒ«ã®è¨­å®šãƒ•ã‚¡ã‚¤ãƒ« â””â”€â”€ ops # Terraformã®CI/CDã®è‡ªå‹•åŒ–ã‚·ã‚§ãƒ«ã‚¹ã‚¯ãƒªãƒ—ãƒˆ 02. ãƒ«ãƒ¼ãƒˆãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã«ãŠã‘ã‚‹å®Ÿè£… tfstateãƒ•ã‚¡ã‚¤ãƒ« ãƒ»tfstateãƒ•ã‚¡ã‚¤ãƒ«ã¨ã¯ å®Ÿã‚¤ãƒ³ãƒ•ãƒ©ã®ã‚¤ãƒ³ãƒ•ãƒ©ã®çŠ¶æ…‹ãŒå®šç¾©ã•ã‚ŒãŸjsonãƒ•ã‚¡ã‚¤ãƒ«ã®ã“ã¨ï¼åˆå›æ™‚ï¼Œapplyã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ï¼ŒæˆåŠŸã‚‚ã—ãã¯å¤±æ•—ã—ãŸã‚¿ã‚¤ãƒŸãƒ³ã‚°ã§ç”Ÿæˆã•ã‚Œã‚‹ï¼ terraform settings ãƒ»terraform settingsã¨ã¯ terraformã®å®Ÿè¡Œæ™‚ã«ï¼Œã‚¨ãƒ³ãƒˆãƒªãƒã‚¤ãƒ³ãƒˆã¨ã—ã¦æ©Ÿèƒ½ã™ã‚‹ãƒ•ã‚¡ã‚¤ãƒ«ï¼ ãƒ»required_providers AWSã‚„GCPãªã©ï¼Œä½¿ç”¨ã™ã‚‹ãƒ—ãƒ­ãƒã‚¤ãƒ€ã‚’å®šç¾©ã™ã‚‹ï¼ãƒ—ãƒ­ãƒã‚¤ãƒ€ã«ã‚ˆã£ã¦ï¼Œç•°ãªã‚‹ãƒªã‚½ãƒ¼ã‚¹ã‚¿ã‚¤ãƒ—ãŒæä¾›ã•ã‚Œã‚‹ï¼ä¸€ç•ªæœ€åˆã«èª­ã¿ã“ã¾ã‚Œã‚‹ãƒ•ã‚¡ã‚¤ãƒ«ã®ãŸã‚ï¼Œå¤‰æ•°ã‚„ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«åŒ–ãªã©ãŒè¡Œãˆãªã„ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š terraform { required_providers { # awsãƒ—ãƒ­ãƒã‚¤ãƒ€ã‚’å®šç¾© aws = { # ã‚°ãƒ­ãƒ¼ãƒãƒ«ã‚½ãƒ¼ã‚¹ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’æŒ‡å®š source = \"hashicorp/aws\" # ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³å¤‰æ›´æ™‚ã¯ initã‚’å®Ÿè¡Œ version = \"3.0\" } } } ãƒ»backend stateãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç®¡ç†ã™ã‚‹å ´æ‰€ã‚’è¨­å®šã™ã‚‹ï¼S3ãªã©ã®å®Ÿã‚¤ãƒ³ãƒ•ãƒ©ã§ç®¡ç†ã™ã‚‹å ´åˆï¼Œã‚¢ã‚«ã‚¦ãƒ³ãƒˆæƒ…å ±ã‚’è¨­å®šã™ã‚‹å¿…è¦ãŒã‚ã‚‹ï¼ä»£ã‚ã‚Šã«ï¼Œinitã‚³ãƒãƒ³ãƒ‰å®Ÿè¡Œæ™‚ã«æŒ‡å®šã—ã¦ã‚‚è‰¯ã„ï¼æ¨™æº–å€¤ã¯localã§ã‚ã‚‹ï¼å¤‰æ•°ã‚’ä½¿ç”¨ã§ããšï¼Œãƒãƒ¼ãƒ‰ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã™ã‚‹å¿…è¦ãŒã‚ã‚‹ãŸã‚ï¼Œã‚‚ã—å€¤ã‚’å‹•çš„ã«å¤‰æ›´ã—ãŸã„å ´åˆã¯ï¼Œinitã‚³ãƒãƒ³ãƒ‰ã®ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’ä½¿ç”¨ã—ã¦å€¤ã‚’æ¸¡ã™ã‚ˆã†ã«ã™ã‚‹ï¼ å‚è€ƒï¼šhttps://www.terraform.io/docs/language/settings/backends/s3.html#credentials-and-shared-configuration ï¼Šå®Ÿè£…ä¾‹ï¼Š terraform { # ãƒ­ãƒ¼ã‚«ãƒ«PCã§ç®¡ç†ã™ã‚‹ã‚ˆã†ã«è¨­å®š backend \"local\" { path = \"${path.module}/terraform.tfstate\" } } terraform { # S3ã§ç®¡ç†ã™ã‚‹ã‚ˆã†ã«è¨­å®š backend \"s3\" { # ãƒã‚±ãƒƒãƒˆå bucket = \"foo-tfstate-bucket\" # stateãƒ•ã‚¡ã‚¤ãƒ«å key = \"terraform.tfstate\" region = \"ap-northeast-1\" # credentialsãƒ•ã‚¡ã‚¤ãƒ«ã®å ´æ‰€ shared_credentials_file = \"$HOME/.aws/credentials\" # credentialsãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«å profile = \"bar-profile\" } } ã©ã®ãƒ¦ãƒ¼ã‚¶ã‚‚ãƒã‚±ãƒƒãƒˆå†…ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’å‰Šé™¤ã§ããªã„ã‚ˆã†ã«ï¼Œãƒãƒªã‚·ãƒ¼ã‚’è¨­å®šã—ã¦ãŠãã¨ã‚ˆã„ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š { \"Version\": \"2008-10-17\", \"Statement\": [ { \"Effect\": \"Deny\", \"Principal\": \"*\", \"Action\": \"s3:DeleteObject\", \"Resource\": \"arn:aws:s3:::foo-tfstate-bucket/*\" } ] } provider ãƒ»providerã¨ã¯ TerraformãŒãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é€ä¿¡ã™ã‚‹ãƒ—ãƒ­ãƒã‚¤ãƒ€ï¼ˆAWSï¼ŒGCPï¼ŒAzureï¼Œãªã©ï¼‰ã‚’é¸æŠã—ï¼Œãã®ãƒ—ãƒ­ãƒã‚¤ãƒ€ã«ãŠã‘ã‚‹ã‚¢ã‚«ã‚¦ãƒ³ãƒˆèªè¨¼ã‚’è¡Œã†ï¼terraform settingsã§å®šç¾©ã—ãŸãƒ—ãƒ­ãƒã‚¤ãƒ€åã‚’æŒ‡å®šã™ã‚‹å¿…è¦ãŒã‚ã‚‹ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š terraform { required_version = \"0.13.5\" required_providers { # awsãƒ—ãƒ­ãƒã‚¤ãƒ€ã‚’å®šç¾© aws = { # ä½•ã‚‰ã‹ã®è¨­å®š } } backend \"s3\" { # ä½•ã‚‰ã‹ã®è¨­å®š } } # awsãƒ—ãƒ­ãƒã‚¤ãƒ€ã‚’æŒ‡å®š provider \"aws\" { # ã‚¢ã‚«ã‚¦ãƒ³ãƒˆèªè¨¼ã®è¨­å®š } multiple providers ãƒ»multiple providersã¨ã¯ è¤‡æ•°ã®providerã‚’å®Ÿè£…ã—ï¼Œã‚¨ã‚¤ãƒªã‚¢ã‚¹ã‚’ä½¿ç”¨ã—ã¦ï¼Œã“ã‚Œã‚‰ã‚’å‹•çš„ã«åˆ‡ã‚Šæ›¿ãˆã‚‹æ–¹æ³•ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š terraform { required_version = \"0.13.5\" required_providers { aws = { source = \"hashicorp/aws\" version = \"3.0\" } } } provider \"aws\" { # æ¨™æº–å€¤ã¨ã™ã‚‹ãƒªãƒ¼ã‚¸ãƒ§ãƒ³ region = \"ap-northeast-1\" } provider \"aws\" { # åˆ¥ãƒªãƒ¼ã‚¸ãƒ§ãƒ³ alias = \"ue1\" region = \"us-east-1\" } ãƒ»å­ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã§providerã‚’åˆ‡ã‚Šæ›¿ãˆã‚‹ å­ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã§providerã‚’åˆ‡ã‚Šæ›¿ãˆã‚‹ã«ã¯ï¼Œãƒ«ãƒ¼ãƒˆãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã§providerã®å€¤ã‚’æ˜ç¤ºçš„ã«æ¸¡ã™å¿…è¦ãŒã‚ã‚‹ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š module \"route53\" { source = \"../modules/route53\" providers = { aws = aws.ue1 } # ãã®ä»–ã®è¨­å®šå€¤ } ã•ã‚‰ã«å­ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã§ï¼Œproviderã®å€¤ã‚’è¨­å®šã™ã‚‹å¿…è¦ãŒã‚ã‚‹ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š ############################################### # Route53 ############################################### resource \"aws_acm_certificate\" \"example\" { # CloudFrontã®ä»•æ§˜ã®ãŸã‚ï¼Œus-east-1ãƒªãƒ¼ã‚¸ãƒ§ãƒ³ã§SSLè¨¼æ˜æ›¸ã‚’ä½œæˆã—ã¾ã™ï¼ provider = aws domain_name = \"example.co.jp\" subject_alternative_names = [\"*.example.co.jp\"] validation_method = \"DNS\" tags = { Name = \"prd-foo-example-cert\" } lifecycle { create_before_destroy = true } } ã‚¢ã‚«ã‚¦ãƒ³ãƒˆæƒ…å ±ã®è¨­å®šæ–¹æ³• ãƒ»ãƒãƒ¼ãƒ‰ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã«ã‚ˆã‚‹è¨­å®š ãƒªãƒ¼ã‚¸ãƒ§ãƒ³ã®ä»–ï¼Œã‚¢ã‚¯ã‚»ã‚¹ã‚­ãƒ¼ã¨ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆã‚­ãƒ¼ã‚’ãƒãƒ¼ãƒ‰ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã§è¨­å®šã™ã‚‹ï¼èª¤ã£ã¦ã‚³ãƒŸãƒƒãƒˆã—ã¦ã—ã¾ã†å¯èƒ½æ€§ãŒã‚ã‚‹ãŸã‚ï¼Œãƒãƒ¼ãƒ‰ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã—ãªã„ã‚ˆã†ã«ã™ã‚‹ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š terraform { required_version = \"0.13.5\" required_providers { aws = { source = \"hashicorp/aws\" version = \"3.0\" } } backend \"s3\" { bucket = \"foo-tfstate-bucket\" key = \"terraform.tfstate\" region = \"ap-northeast-1\" # ã‚¢ã‚¯ã‚»ã‚¹ã‚­ãƒ¼ access_key = \"*****\" # ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆã‚¢ã‚¯ã‚»ã‚¹ã‚­ãƒ¼ secret_key = \"*****\" } } provider \"aws\" { region = \"ap-northeast-1\" # ã‚¢ã‚¯ã‚»ã‚¹ã‚­ãƒ¼ access_key = \"*****\" # ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆã‚¢ã‚¯ã‚»ã‚¹ã‚­ãƒ¼ secret_key = \"*****\" } ãƒ»credentialsãƒ•ã‚¡ã‚¤ãƒ«ã«ã‚ˆã‚‹è¨­å®š ã€€AWSã‚¢ã‚«ã‚¦ãƒ³ãƒˆæƒ…å ±ã¯ï¼Œ~/.aws/credentialsãƒ•ã‚¡ã‚¤ãƒ«ã«è¨˜è¼‰ã•ã‚Œã¦ã„ã‚‹ï¼ # æ¨™æº–ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ« [default] aws_access_key_id=***** aws_secret_access_key=***** # ç‹¬è‡ªãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ« [bar-profile] aws_access_key_id=***** aws_secret_access_key=***** credentialsãƒ•ã‚¡ã‚¤ãƒ«ã‚’èª­ã¿å‡ºã—ï¼Œãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«åã‚’è¨­å®šã™ã‚‹ã“ã¨ã«ã‚ˆã‚Šï¼Œã‚¢ã‚«ã‚¦ãƒ³ãƒˆæƒ…å ±ã‚’å‚ç…§ã§ãã‚‹ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š terraform { required_version = \"0.13.5\" required_providers { aws = { source = \"hashicorp/aws\" version = \"3.0\" } } # credentialsãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰ï¼Œã‚¢ã‚¯ã‚»ã‚¹ã‚­ãƒ¼ï¼Œã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆã‚¢ã‚¯ã‚»ã‚¹ã‚­ãƒ¼ã‚’èª­ã¿è¾¼ã‚€ backend \"s3\" { # ãƒã‚±ãƒƒãƒˆå bucket = \"foo-tfstate-bucket\" # stateãƒ•ã‚¡ã‚¤ãƒ«å key = \"terraform.tfstate\" region = \"ap-northeast-1\" # credentialsãƒ•ã‚¡ã‚¤ãƒ«ã®å ´æ‰€ shared_credentials_file = \"$HOME/.aws/credentials\" # credentialsãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«å profile = \"bar-profile\" } } # credentialsãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰ï¼Œã‚¢ã‚¯ã‚»ã‚¹ã‚­ãƒ¼ï¼Œã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆã‚¢ã‚¯ã‚»ã‚¹ã‚­ãƒ¼ã‚’èª­ã¿è¾¼ã‚€ provider \"aws\" { region = \"ap-northeast-1\" profile = \"foo\" shared_credentials_file = \"$HOME/.aws/\" } ãƒ»ç’°å¢ƒå¤‰æ•°ã«ã‚ˆã‚‹è¨­å®š Credentialsãƒ•ã‚¡ã‚¤ãƒ«ã§ã¯ãªãï¼Œexportã‚’ä½¿ç”¨ã—ã¦ï¼Œå¿…è¦ãªæƒ…å ±ã‚’è¨­å®šã—ã¦ãŠãã“ã¨ã‚‚å¯èƒ½ã§ã‚ã‚‹ï¼å‚ç…§ã§ãã‚‹ç’°å¢ƒå¤‰æ•°åã¯æ±ºã¾ã£ã¦ã„ã‚‹ï¼ # regionã®ä»£ã‚ã‚Š $ export AWS_DEFAULT_REGION=\"ap-northeast-1\" # access_keyã®ä»£ã‚ã‚Š $ export AWS_ACCESS_KEY_ID=\"*****\" # secret_keyã®ä»£ã‚ã‚Š $ export AWS_SECRET_ACCESS_KEY=\"*****\" # profileã®ä»£ã‚ã‚Š $ export AWS_PROFILE=\"bar-profile\" #tokenã®ä»£ã‚ã‚Šï¼ˆAmazonSTSã‚’ä½¿ç”¨ã™ã‚‹å ´åˆï¼‰ $ export AWS_SESSION_TOKEN=\"*****\" ç’°å¢ƒå¤‰æ•°ã‚’è¨­å®šã—ãŸä¸Šã§teraformã‚’å®Ÿè¡Œã™ã‚‹ã¨ï¼Œå€¤ãŒproviderã«è‡ªå‹•çš„ã«å‡ºåŠ›ã•ã‚Œã‚‹ï¼CircleCIã®ã‚ˆã†ãªï¼Œä¸€æ™‚çš„ã«ç’°å¢ƒå¤‰æ•°ãŒå¿…è¦ã«ãªã‚‹ã‚ˆã†ãªçŠ¶æ³ã§ã¯æœ‰åŠ¹ãªæ–¹æ³•ã§ã‚ã‚‹ï¼ terraform { required_version = \"0.13.5\" required_providers { aws = { source = \"hashicorp/aws\" version = \"3.0\" } } # ãƒªãƒ¼ã‚¸ãƒ§ãƒ³ï¼Œã‚¢ã‚¯ã‚»ã‚¹ã‚­ãƒ¼ï¼Œã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆã‚¢ã‚¯ã‚»ã‚¹ã‚­ãƒ¼ã¯ä¸è¦ backend \"s3\" { bucket = \"\" key = \"\" } } # ãƒªãƒ¼ã‚¸ãƒ§ãƒ³ï¼Œã‚¢ã‚¯ã‚»ã‚¹ã‚­ãƒ¼ï¼Œã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆã‚¢ã‚¯ã‚»ã‚¹ã‚­ãƒ¼ã¯ä¸è¦ provider \"aws\" {} module ãƒ»moduleã¨ã¯ ãƒ«ãƒ¼ãƒˆãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã§å­ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«èª­ã¿è¾¼ã¿ï¼Œå­ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã«å¯¾ã—ã¦å¤‰æ•°ã‚’æ¸¡ã™ï¼ ãƒ»å®Ÿè£…æ–¹æ³• ï¼Šå®Ÿè£…ä¾‹ï¼Š ############################### # ALB ############################### module \"alb\" { # ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã®Resourceã‚’å‚ç…§ source = \"../modules/alb\" # ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã«ä»–ã®ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã®ã‚¢ã‚¦ãƒˆãƒ—ãƒƒãƒˆå€¤ã‚’æ¸¡ã™ï¼ acm_certificate_api_arn = module.acm.acm_certificate_api_arn } 03. å¤‰æ•° ç’°å¢ƒå¤‰æ•° ãƒ»å„ªå…ˆé †ä½ ä¸Šã®é …ç›®ã»ã©å„ªå…ˆã•ã‚Œã‚‹ï¼ å‚è€ƒï¼šhttps://www.terraform.io/docs/language/values/variables.html#variable-definition-precedence ãƒ»-varï¼Œ-var-file $ terraform plan -var=\"foo=foo\" $ terraform plan -var=\"foo=foo\" -var=\"bar=bar\" $ terraform plan -var-file=xxxxx.tfvars ãƒ»*.auto.tfvarsãƒ•ã‚¡ã‚¤ãƒ«ï¼Œ*.auto.tfvars.jsonãƒ•ã‚¡ã‚¤ãƒ« ãƒ»terraform.tfvars.jsonãƒ•ã‚¡ã‚¤ãƒ« ãƒ»terraform.tfvarsãƒ•ã‚¡ã‚¤ãƒ« #ã€€ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æŒ‡å®šã—ãªãã¨ã‚‚èª­ã¿è¾¼ã¾ã‚Œã‚‹ $ terraform plan ãƒ»TF_VAR_XXXXX ç’°å¢ƒå¤‰æ•°ã¨ã—ã¦ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã—ã¦ãŠãã¨è‡ªå‹•çš„ã«èª­ã¿è¾¼ã¾ã‚Œã‚‹ï¼XXXXXã®éƒ¨åˆ†ãŒå¤‰æ•°åã¨ã—ã¦Terraformã«æ¸¡ã•ã‚Œã‚‹ï¼ $ printenv TF_VAR_ecr_image_tag=foo tfvarsãƒ•ã‚¡ã‚¤ãƒ« ãƒ»tfvarsãƒ•ã‚¡ã‚¤ãƒ«ã®ç”¨é€” å®Ÿè¡Œãƒ•ã‚¡ã‚¤ãƒ«ã«å…¥åŠ›ã—ãŸã„ç’°å¢ƒå¤‰æ•°ã‚’å®šç¾©ã™ã‚‹ï¼ã€terraform.tfvarsã€ã¨ã„ã†åå‰ã«ã™ã‚‹ã¨ï¼Œterraformã‚³ãƒãƒ³ãƒ‰ã®å®Ÿè¡Œæ™‚ã«è‡ªå‹•çš„ã«èª­ã¿è¾¼ã¾ã‚Œã‚‹ï¼å„ã‚µãƒ¼ãƒ“ã‚¹ã®é–“ã§å®Ÿè£…æ–¹æ³•ãŒåŒã˜ãŸã‚ï¼ŒVPCã®ã¿ä¾‹ã‚’ç¤ºã™ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š ############################### # VPC ############################### vpc_cidr_block = \"n.n.n.n/n\" # IPv4ã‚¢ãƒ‰ãƒ¬ã‚¹ç¯„å›² ãƒ»å€¤ã®ãƒ‡ãƒ¼ã‚¿å‹ å˜ä¸€å€¤ï¼Œlistå‹ï¼Œmapå‹ã§å®šç¾©ã§ãã‚‹ï¼AZï¼Œã‚µãƒ–ãƒãƒƒãƒˆã®CIDRï¼ŒRDSã®ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚°ãƒ«ãƒ¼ãƒ—å€¤ï¼Œãªã©ã¯mapå‹ã¨ã—ã¦ä¿æŒã—ã¦ãŠãã¨ã‚ˆã„ï¼ã¾ãŸï¼ŒIPã‚¢ãƒ‰ãƒ¬ã‚¹ã®ã‚»ãƒƒãƒˆï¼Œãƒ¦ãƒ¼ã‚¶ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆï¼Œãªã©ã¯listå‹ã¨ã—ã¦ä¿æŒã—ã¦ãŠãã¨ã‚ˆã„ï¼ãªãŠï¼ŒRDSã®ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚°ãƒ«ãƒ¼ãƒ—ã®é©æ­£å€¤ã«ã¤ã„ã¦ã¯ï¼Œä»¥ä¸‹ã‚’å‚è€ƒã«ã›ã‚ˆï¼ å‚è€ƒï¼šhttps://hiroki-it.github.io/tech-notebook-gitbook/public/cloud_computing/cloud_computing_aws.html ï¼Šå®Ÿè£…ä¾‹ï¼Š ############################################### # RDS ############################################### variable \"rds_parameter_group_values\" { type = map(string) } ############################################### # VPC ############################################### variable \"vpc_availability_zones\" { type = map(string) } variable \"vpc_cidr\" { type = string } variable \"vpc_endpoint_port_https\" { type = number } variable \"vpc_subnet_private_datastore_cidrs\" { type = map(string) } variable \"vpc_subnet_private_app_cidrs\" { type = map(string) } variable \"vpc_subnet_public_cidrs\" { type = map(string) } ############################################### # WAF ############################################### variable \"waf_allowed_global_ip_addresses\" { type = list(string) } variable \"waf_blocked_user_agents\" { type = list(string) } ############################################### # RDS ############################################### rds_parameter_group_values = { time_zone = \"asia/tokyo\" character_set_client = \"utf8mb4\" character_set_connection = \"utf8mb4\" character_set_database = \"utf8mb4\" character_set_results = \"utf8mb4\" character_set_server = \"utf8mb4\" server_audit_events = \"connect,query,query_dcl,query_ddl,query_dml,table\" server_audit_logging = 1 server_audit_logs_upload = 1 general_log = 1 slow_query_log = 1 long_query_time = 3 } ############################################### # VPC ############################################### vpc_availability_zones = { a = \"a\", c = \"c\" } vpc_cidr = \"n.n.n.n/23\" vpc_subnet_private_datastore_cidrs = { a = \"n.n.n.n/27\", c = \"n.n.n.n/27\" } vpc_subnet_private_app_cidrs = { a = \"n.n.n.n/25\", c = \"n.n.n.n/25\" } vpc_subnet_public_cidrs = { a = \"n.n.n.n/27\", c = \"n.n.n.n/27\" } ############################################### # WAF ############################################### waf_allowed_global_ip_addresses = [ \"n.n.n.n/32\", \"n.n.n.n/32\", ] waf_blocked_user_agents = [ \"XXXXX\", \"YYYYY\" ] variable ãƒ»variableã¨ã¯ ãƒªã‚½ãƒ¼ã‚¹ã§ä½¿ç”¨ã™ã‚‹å¤‰æ•°ã®ãƒ‡ãƒ¼ã‚¿å‹ã‚’å®šç¾©ã™ã‚‹ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š ############################################### # ECS ############################################### variable \"ecs_container_laravel_port_http\" { type = number } variable \"ecs_container_nginx_port_http\" { type = number } ############################################### # RDS ############################################### variable \"rds_auto_minor_version_upgrade\" { type = bool } variable \"rds_instance_class\" { type = string } variable \"rds_parameter_group_values\" { type = map(string) } 04. ãƒªã‚½ãƒ¼ã‚¹ã®å®Ÿè£… resource ãƒ»resourceã¨ã¯ AWSã®APIã«å¯¾ã—ã¦ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é€ä¿¡ã—ï¼Œã‚¯ãƒ©ã‚¦ãƒ‰ã‚¤ãƒ³ãƒ•ãƒ©ã®æ§‹ç¯‰ã‚’è¡Œã†ï¼ ãƒ»å®Ÿè£…æ–¹æ³• ï¼Šå®Ÿè£…ä¾‹ï¼Š ############################################### # ALB ############################################### resource \"aws_lb\" \"this\" { name = \"prd-foo-alb\" load_balancer_type = \"application\" security_groups = [\"*****\"] subnets = [\"*****\",\"*****\"] } data ãƒ»dataã¨ã¯ AWSã®APIã«å¯¾ã—ã¦ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é€ä¿¡ã—ï¼Œã‚¯ãƒ©ã‚¦ãƒ‰ã‚¤ãƒ³ãƒ•ãƒ©ã«é–¢ã™ã‚‹ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ã™ã‚‹ï¼ãƒ«ãƒ¼ãƒˆãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã«å®Ÿè£…ã™ã‚‹ã“ã¨ã‚‚å¯èƒ½ã§ã‚ã‚‹ãŒï¼Œå„ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã«å®Ÿè£…ã—ãŸæ–¹ãŒåˆ†ã‹ã‚Šã‚„ã™ã„ï¼ ãƒ»å®Ÿè£…æ–¹æ³• ï¼Šå®Ÿè£…ä¾‹ï¼Š ä¾‹ã¨ã—ã¦ï¼Œã‚¿ã‚¹ã‚¯å®šç¾©åã‚’æŒ‡å®šã—ã¦ï¼ŒAWSã‹ã‚‰ ############################################### # ECS task definition ############################################### data \"aws_ecs_task_definition\" \"this\" { task_definition = \"prd-foo-ecs-task-definition\" } ï¼Šå®Ÿè£…ä¾‹ï¼Š ä¾‹ã¨ã—ã¦ï¼ŒAMIã‚’ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°ã—ãŸä¸Šã§ï¼ŒAWSã‹ã‚‰ç‰¹å®šã®AMIã®å€¤ã‚’å–å¾—ã™ã‚‹ï¼ ############################################### # AMI ############################################### data \"aws_ami\" \"bastion\" { most_recent = true owners = [\"amazon\"] filter { name = \"architecture\" values = [\"x86_64\"] } filter { name = \"root-device-type\" values = [\"ebs\"] } filter { name = \"name\" values = [\"amzn-ami-hvm-*\"] } filter { name = \"virtualization-type\" values = [\"hvm\"] } filter { name = \"block-device-mapping.volume-type\" values = [\"gp2\"] } } output ãƒ»outputã¨ã¯ ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã§æ§‹ç¯‰ã•ã‚ŒãŸãƒªã‚½ãƒ¼ã‚¹ãŒã‚‚ã¤ç‰¹å®šã®å€¤ã‚’å‡ºåŠ›ã™ã‚‹ï¼å¯èª­æ€§ã®è¦³ç‚¹ã‹ã‚‰ï¼Œãƒªã‚½ãƒ¼ã‚¹ä¸€æ‹¬ã§ã¯ãªãï¼Œå…·ä½“çš„ãªattributeã‚’ã‚¢ã‚¦ãƒˆãƒ—ãƒƒãƒˆã™ã‚‹ï¼ ãƒ»å®Ÿè£…æ–¹æ³• ï¼Šå®Ÿè£…ä¾‹ï¼Š ä¾‹ã¨ã—ã¦ï¼ŒALBã‚’ç¤ºã™ï¼resourceãƒ–ãƒ­ãƒƒã‚¯ã¨dataãƒ–ãƒ­ãƒƒã‚¯ã§ã‚¢ã‚¦ãƒˆãƒ—ãƒƒãƒˆã®æ–¹æ³•ãŒç•°ãªã‚‹ï¼ ############################################### # ALB ############################################### output \"alb_zone_id\" { value = aws_lb.this.zone_id } output \"elb_service_account_arn\" { value = data.aws_elb_service_account.this.arn } ãƒ»counté–¢æ•°ã®ã‚¢ã‚¦ãƒˆãƒ—ãƒƒãƒˆ å¾Œè¿°ã®èª¬æ˜ã‚’å‚è€ƒã«ã›ã‚ˆï¼ ãƒ»for_eaché–¢æ•°ã®ã‚¢ã‚¦ãƒˆãƒ—ãƒƒãƒˆ å¾Œè¿°ã®èª¬æ˜ã‚’å‚è€ƒã«ã›ã‚ˆï¼ 05. ãƒ¡ã‚¿å¼•æ•° ãƒ¡ã‚¿å¼•æ•°ã¨ã¯ å…¨ã¦ã®ãƒªã‚½ãƒ¼ã‚¹ã§ä½¿ç”¨ã§ãã‚‹ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã®ã“ã¨ï¼ depends_on ãƒ»depends_onã¨ã¯ ãƒªã‚½ãƒ¼ã‚¹é–“ã®ä¾å­˜é–¢ä¿‚ã‚’æ˜ç¤ºçš„ã«å®šç¾©ã™ã‚‹ï¼Terraformã§ã¯ï¼ŒåŸºæœ¬çš„ã«ãƒªã‚½ãƒ¼ã‚¹é–“ã®ä¾å­˜é–¢ä¿‚ãŒæš—é»™çš„ã«å®šç¾©ã•ã‚Œã¦ã„ã‚‹ï¼ã—ã‹ã—ï¼Œè¤‡æ•°ã®ãƒªã‚½ãƒ¼ã‚¹ãŒé–¢ã‚ã‚‹ã¨ï¼Œãƒªã‚½ãƒ¼ã‚¹ã‚’é©åˆ‡ãªé †ç•ªã§æ§‹ç¯‰ã§ããªã„å ´åˆãŒã‚ã‚‹ãŸã‚ï¼Œãã†ã„ã£ãŸã¨ãã«ä½¿ç”¨ã™ã‚‹ï¼ ãƒ»ALB target group vs. ALBï¼ŒECS ä¾‹ã¨ã—ã¦ï¼ŒALB target groupã‚’ç¤ºã™ï¼ALB Target groupã¨ALBã®ãƒªã‚½ãƒ¼ã‚¹ã‚’é©åˆ‡ãªé †ç•ªã§æ§‹ç¯‰ã§ããªã„ãŸã‚ï¼ŒECSã®æ§‹ç¯‰æ™‚ã«ã‚¨ãƒ©ãƒ¼ãŒèµ·ã“ã‚‹ï¼ALBã®å¾Œã«ALB target groupã‚’æ§‹ç¯‰ã™ã‚‹å¿…è¦ãŒã‚ã‚‹ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š ############################################### # ALB target group ############################################### resource \"aws_lb_target_group\" \"this\" { name = \"prd-foo-alb-tg\" port = 80 protocol = \"HTTP\" vpc_id = \"*****\" deregistration_delay = \"60\" target_type = \"ip\" slow_start = \"60\" health_check { interval = 30 path = \"/healthcheck\" protocol = \"HTTP\" timeout = 5 unhealthy_threshold = 2 matcher = 200 } depends_on = [aws_lb.this] } ãƒ»Internet Gateway vs. EC2ï¼ŒElastic IPï¼ŒNAT Gateway ä¾‹ã¨ã—ã¦ï¼ŒNAT Gatewayã‚’ç¤ºã™ï¼NAT Gatewayï¼ŒInternet Gatewayï¼Œã®ãƒªã‚½ãƒ¼ã‚¹ã‚’é©åˆ‡ãªé †ç•ªã§æ§‹ç¯‰ã§ããªã„ãŸã‚ï¼ŒInternet Gatewayã®æ§‹ç¯‰å¾Œã«ï¼ŒNAT Gatewayã‚’æ§‹ç¯‰ã™ã‚‹ã‚ˆã†ã«å®šç¾©ã™ã‚‹å¿…è¦ãŒã‚ã‚‹ï¼ ############################################### # EC2 ############################################### resource \"aws_instance\" \"bastion\" { ami = \"*****\" instance_type = \"t2.micro\" vpc_security_group_ids = [\"*****\"] subnet_id = \"*****\" key_name = \"prd-foo-bastion\" associate_public_ip_address = true disable_api_termination = true tags = { Name = \"prd-foo-bastion\" } depends_on = [var.internet_gateway] } ############################################### # Elastic IP ############################################### resource \"aws_eip\" \"nat_gateway\" { for_each = var.vpc_availability_zones vpc = true tags = { Name = format( \"prd-foo-ngw-%s-eip\", each.value ) } depends_on = [aws_internet_gateway.this] } ############################################### # NAT Gateway ############################################### resource \"aws_nat_gateway\" \"this\" { for_each = var.vpc_availability_zones subnet_id = aws_subnet.public[each.key].id allocation_id = aws_eip.nat_gateway[each.key].id tags = { Name = format( \"prd-foo-%s-ngw\", each.value ) } depends_on = [aws_internet_gateway.this] } ãƒ»S3ãƒã‚±ãƒƒãƒˆãƒãƒªã‚·ãƒ¼ vs. ãƒ‘ãƒ–ãƒªãƒƒã‚¯ã‚¢ã‚¯ã‚»ã‚¹ãƒ–ãƒ­ãƒƒã‚¯ãƒãƒªã‚·ãƒ¼ ä¾‹ã¨ã—ã¦ï¼ŒS3ã‚’ç¤ºã™ï¼ãƒã‚±ãƒƒãƒˆãƒãƒªã‚·ãƒ¼ã¨ãƒ‘ãƒ–ãƒªãƒƒã‚¯ã‚¢ã‚¯ã‚»ã‚¹ãƒ–ãƒ­ãƒƒã‚¯ãƒãƒªã‚·ãƒ¼ã‚’åŒæ™‚ã«æ§‹ç¯‰ã§ããªã„ãŸã‚ï¼Œæ§‹ç¯‰ã®ã‚¿ã‚¤ãƒŸãƒ³ã‚°ãŒé‡ãªã‚‰ãªã„ã‚ˆã†ã«ã™ã‚‹å¿…è¦ãŒã‚ã‚‹ï¼ ############################################### # S3 ############################################### # foo bucket resource \"aws_s3_bucket\" \"foo\" { bucket = \"prd-foo-foo-bucket\" acl = \"private\" } # Public access block resource \"aws_s3_bucket_public_access_block\" \"foo\" { bucket = aws_s3_bucket.foo.id block_public_acls = true block_public_policy = true ignore_public_acls = true restrict_public_buckets = true } # Bucket policy attachment resource \"aws_s3_bucket_policy\" \"foo\" { bucket = aws_s3_bucket.foo.id policy = templatefile( \"${path.module}/policies/foo_bucket_policy.tpl\", { foo_s3_bucket_arn = aws_s3_bucket.foo.arn s3_cloudfront_origin_access_identity_iam_arn = var.s3_cloudfront_origin_access_identity_iam_arn } ) depends_on = [aws_s3_bucket_public_access_block.foo] } count ãƒ»countã¨ã¯ æŒ‡å®šã—ãŸæ•°ã ã‘ï¼Œãƒªã‚½ãƒ¼ã‚¹ã®æ§‹ç¯‰ã‚’ç¹°ã‚Šè¿”ã™ï¼count.indexã§ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹æ•°ã‚’å‡ºåŠ›ã™ã‚‹ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š ############################################### # EC2 ############################################### resource \"aws_instance\" \"server\" { count = 4 ami = \"ami-a1b2c3d4\" instance_type = \"t2.micro\" tags = { Name = \"ec2-${count.index}\" } } ãƒ»listå‹ã§ã‚¢ã‚¦ãƒˆãƒ—ãƒƒãƒˆ ãƒªã‚½ãƒ¼ã‚¹ã®æ§‹ç¯‰ã«counté–¢æ•°ã‚’ä½¿ç”¨ã—ãŸå ´åˆï¼Œãã®ãƒªã‚½ãƒ¼ã‚¹ã¯listå‹ã¨ã—ã¦æ‰±ã‚ã‚Œã‚‹ï¼ãã®ãŸã‚ï¼Œã‚­ãƒ¼åã‚’æŒ‡å®šã—ã¦ã‚¢ã‚¦ãƒˆãƒ—ãƒƒãƒˆã§ãã‚‹ï¼ã“ã®æ™‚ï¼Œã‚¢ã‚¦ãƒˆãƒ—ãƒƒãƒˆã¯listå‹ã«ãªã‚‹ï¼ã¡ãªã¿ã«ï¼Œfor_eaché–¢æ•°ã§æ§‹ç¯‰ã—ãŸãƒªã‚½ãƒ¼ã‚¹ã¯ã‚¢ã‚¹ã‚¿ãƒªã‚¹ã‚¯ã§ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹åã‚’æŒ‡å®šã§ããªã„ã®ã§ï¼Œæ³¨æ„ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š ä¾‹ã¨ã—ã¦ï¼ŒVPCã®ã‚µãƒ–ãƒãƒƒãƒˆã‚’ç¤ºã™ï¼ã“ã“ã§ã¯ï¼Œãƒ‘ãƒ–ãƒªãƒƒã‚¯ã‚µãƒ–ãƒãƒƒãƒˆï¼Œapplicationã‚µãƒ–ãƒãƒƒãƒˆï¼Œdatastoreã‚µãƒ–ãƒãƒƒãƒˆï¼Œã‚’counté–¢æ•°ã§æ§‹ç¯‰ã—ãŸã¨ã™ã‚‹ï¼ ############################################### # Public subnet ############################################### resource \"aws_subnet\" \"public\" { count = 2 # ï½ ä¸­ç•¥ ï½ } ############################################### # Private subnet ############################################### resource \"aws_subnet\" \"private_app\" { count = 2 # ï½ ä¸­ç•¥ ï½ } resource \"aws_subnet\" \"private_datastore\" { count = 2 # ï½ ä¸­ç•¥ ï½ } ############################################### # Output VPC ############################################### output \"public_subnet_ids\" { value = aws_subnet.public[*].id } output \"private_app_subnet_ids\" { value = aws_subnet.private_app[*].id } output \"private_datastore_subnet_ids\" { value = aws_subnet.private_datastore[*].id } for_each ãƒ»for_eachã¨ã¯ äº‹å‰ã«for_eachã«æ ¼ç´ã—ãŸmapå‹ã®keyã®æ•°ã ã‘ï¼Œãƒªã‚½ãƒ¼ã‚¹ã‚’ç¹°ã‚Šè¿”ã—å®Ÿè¡Œã™ã‚‹ï¼ç¹°ã‚Šè¿”ã—å‡¦ç†ã‚’è¡Œã†æ™‚ã«ï¼Œcountã¨ã¯é•ã„ï¼Œè¦ç´ åã‚’æŒ‡å®šã—ã¦å‡ºåŠ›ã§ãã‚‹ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š ä¾‹ã¨ã—ã¦ï¼Œsubnetã‚’ç¹°ã‚Šè¿”ã—æ§‹ç¯‰ã™ã‚‹ï¼ ############################################### # Variables ############################################### vpc_availability_zones = { a = \"a\", c = \"c\" } vpc_cidr = \"n.n.n.n/23\" vpc_subnet_private_datastore_cidrs = { a = \"n.n.n.n/27\", c = \"n.n.n.n/27\" } vpc_subnet_private_app_cidrs = { a = \"n.n.n.n/25\", c = \"n.n.n.n/25\" } vpc_subnet_public_cidrs = { a = \"n.n.n.n/27\", c = \"n.n.n.n/27\" } ############################################### # Public subnet ############################################### resource \"aws_subnet\" \"public\" { for_each = var.vpc_availability_zones vpc_id = aws_vpc.this.id cidr_block = var.vpc_subnet_public_cidrs[each.key] availability_zone = \"${var.region}${each.value}\" map_public_ip_on_launch = true tags = { Name = format( \"prd-foo-pub-%s-subnet\", each.value ) } } ãƒ»å†—é•·åŒ–ã•ã‚ŒãŸAZã«ãŠã‘ã‚‹è¨­å®š å†—é•·åŒ–ã•ã‚ŒãŸAZã§å…±é€šã®ãƒ«ãƒ¼ãƒˆãƒ†ãƒ¼ãƒ–ãƒ«ã‚’æ§‹ç¯‰ã™ã‚‹å ´åˆï¼Œãã“ã§ï¼Œfor_eaché–¢æ•°ã‚’ä½¿ç”¨ã™ã‚‹ã¨ï¼Œå°‘ãªã„å®Ÿè£…ã§æ§‹ç¯‰ã§ãã‚‹ï¼for_eaché–¢æ•°ã§æ§‹ç¯‰ã•ã‚ŒãŸãƒªã‚½ãƒ¼ã‚¹ã¯applyä¸­ã«mapæ§‹é€ ã¨ã—ã¦æ‰±ã‚ã‚Œï¼Œãƒªã‚½ãƒ¼ã‚¹åã®ä¸‹å±¤ã«ã‚­ãƒ¼åã§ãƒªã‚½ãƒ¼ã‚¹ãŒä¸¦ã¶æ§‹é€ ã«ãªã£ã¦ã„ã‚‹ï¼ã“ã‚Œã‚’å‚ç…§ã™ã‚‹ãŸã‚ã«ï¼Œã€.[each.key].ã€ã¨ã™ã‚‹ ï¼Šå®Ÿè£…ä¾‹ï¼Š ãƒ‘ãƒ–ãƒªãƒƒã‚¯ã‚µãƒ–ãƒãƒƒãƒˆï¼Œãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆã‚µãƒ–ãƒãƒƒãƒˆï¼Œãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆã‚µãƒ–ãƒãƒƒãƒˆã«ç´ä»˜ãNAT Gatewayã®è¨­å®šãŒå†—é•·åŒ–ã•ã‚ŒãŸAZã§å…±é€šã®å ´åˆï¼Œfor_eaché–¢æ•°ã§æ§‹ç¯‰ã™ã‚‹ï¼ ############################################### # Variables ############################################### vpc_availability_zones = { a = \"a\", c = \"c\" } ############################################### # Internet Gateway ############################################### resource \"aws_internet_gateway\" \"this\" { vpc_id = aws_vpc.this.id tags = { Name = \"prd-foo-igw\" } } ############################################### # Route table (public) ############################################### resource \"aws_route_table\" \"public\" { vpc_id = aws_vpc.this.id route { cidr_block = \"0.0.0.0/0\" gateway_id = aws_internet_gateway.this.id } tags = { Name = \"prd-foo-pub-rtb\" } } ############################################### # Route table (private) ############################################### resource \"aws_route_table\" \"private_app\" { for_each = var.vpc_availability_zones vpc_id = aws_vpc.this.id route { cidr_block = \"0.0.0.0/0\" nat_gateway_id = aws_nat_gateway.this[each.key].id } tags = { Name = format( \"prd-foo-pvt-%s-app-rtb\", each.value ) } } ############################################### # NAT Gateway ############################################### resource \"aws_nat_gateway\" \"this\" { for_each = var.vpc_availability_zones subnet_id = aws_subnet.public[each.key].id allocation_id = aws_eip.nat_gateway[each.key].id tags = { Name = format( \"prd-foo-%s-ngw\", each.value ) } depends_on = [aws_internet_gateway.this] } ãƒ»å˜ä¸€å€¤ã§ã‚¢ã‚¦ãƒˆãƒ—ãƒƒãƒˆ ãƒªã‚½ãƒ¼ã‚¹ã®æ§‹ç¯‰ã«for_eaché–¢æ•°ã‚’ä½¿ç”¨ã—ãŸå ´åˆï¼Œãã®ãƒªã‚½ãƒ¼ã‚¹ã¯mapå‹ã¨ã—ã¦æ‰±ã‚ã‚Œã‚‹ï¼ãã®ãŸã‚ï¼Œã‚­ãƒ¼åã‚’æŒ‡å®šã—ã¦ã‚¢ã‚¦ãƒˆãƒ—ãƒƒãƒˆã§ãã‚‹ï¼ ############################################### # Variables ############################################### vpc_availability_zones = { a = \"a\", c = \"c\" } ############################################### # Output VPC ############################################### output \"public_a_subnet_id\" { value = aws_subnet.public[var.vpc_availability_zones.a].id } output \"public_c_subnet_id\" { value = aws_subnet.public[var.vpc_availability_zones.c].id } ãƒ»mapå‹ã§ã‚¢ã‚¦ãƒˆãƒ—ãƒƒãƒˆ ï¼Šå®Ÿè£…ä¾‹ï¼Š ############################################### # Variables ############################################### vpc_availability_zones = { a = \"a\", c = \"c\" } ############################################### # Output VPC ############################################### output \"public_subnet_ids\" { value = { a = aws_subnet.public[var.vpc_availability_zones.a].id, c = aws_subnet.public[var.vpc_availability_zones.c].id } } output \"private_app_subnet_ids\" { value = { a = aws_subnet.private_app[var.vpc_availability_zones.a].id, c = aws_subnet.private_app[var.vpc_availability_zones.c].id } } output \"private_datastore_subnet_ids\" { value = { a = aws_subnet.private_datastore[var.vpc_availability_zones.a].id, c = aws_subnet.private_datastore[var.vpc_availability_zones.c].id } } ############################################### # ALB ############################################### resource \"aws_lb\" \"this\" { name = \"prd-foo-alb\" subnets = values(private_app_subnet_ids) security_groups = [var.alb_security_group_id] internal = false idle_timeout = 120 enable_deletion_protection = true access_logs { enabled = true bucket = var.alb_s3_bucket_id } } dynamic ãƒ»dynamicã¨ã¯ æŒ‡å®šã—ãŸãƒ–ãƒ­ãƒƒã‚¯ã‚’ç¹°ã‚Šè¿”ã—æ§‹ç¯‰ã™ã‚‹ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š ä¾‹ã¨ã—ã¦ï¼ŒRDSãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚°ãƒ«ãƒ¼ãƒ—ã®parameterãƒ–ãƒ­ãƒƒã‚¯ã‚’ï¼Œmapå‹å¤‰æ•°ã‚’ä½¿ç”¨ã—ã¦ç¹°ã‚Šè¿”ã—æ§‹ç¯‰ã™ã‚‹ï¼ ############################################### # Variables ############################################### rds_parameter_group_values = { time_zone = \"asia/tokyo\" character_set_client = \"utf8mb4\" character_set_connection = \"utf8mb4\" character_set_database = \"utf8mb4\" character_set_results = \"utf8mb4\" character_set_server = \"utf8mb4\" server_audit_events = \"connect,query,query_dcl,query_ddl,query_dml,table\" server_audit_logging = 1 server_audit_logs_upload = 1 general_log = 1 slow_query_log = 1 long_query_time = 3 } ############################################### # RDS Cluster Parameter Group ############################################### resource \"aws_rds_cluster_parameter_group\" \"this\" { name = \"prd-foo-cluster-pg\" description = \"The cluster parameter group for prd-foo-rds\" family = \"aurora-mysql5.7\" dynamic \"parameter\" { for_each = var.rds_parameter_group_values content { name = parameter.key value = parameter.value } } } ï¼Šå®Ÿè£…ä¾‹ï¼Š ä¾‹ã¨ã—ã¦ï¼ŒWAFã®æ­£è¦è¡¨ç¾ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚»ãƒƒãƒˆã®regular_expressionãƒ–ãƒ­ãƒƒã‚¯ã‚’ï¼Œlistå‹å¤‰æ•°ã‚’ä½¿ç”¨ã—ã¦ç¹°ã‚Šè¿”ã—æ§‹ç¯‰ã™ã‚‹ï¼ ############################################### # Variables ############################################### waf_blocked_user_agents = [ \"FooCrawler\", \"BarSpider\", \"BazBot\", ] ############################################### # WAF Regex Pattern Sets ############################################### resource \"aws_wafv2_regex_pattern_set\" \"cloudfront\" { name = \"blocked-user-agents\" description = \"Blocked user agents\" scope = \"CLOUDFRONT\" dynamic \"regular_expression\" { for_each = var.waf_blocked_user_agents content { regex_string = regular_expression.value } } } lifecycle ãƒ»lifecycleã¨ã¯ ãƒªã‚½ãƒ¼ã‚¹ã®æ§‹ç¯‰ï¼Œæ›´æ–°ï¼Œãã—ã¦å‰Šé™¤ã®ãƒ—ãƒ­ã‚»ã‚¹ã‚’ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºã™ã‚‹ï¼ ãƒ»create_before_destroy ãƒªã‚½ãƒ¼ã‚¹ã‚’æ–°ã—ãæ§‹ç¯‰ã—ãŸå¾Œã«å‰Šé™¤ã™ã‚‹ã‚ˆã†ã«ï¼Œå¤‰æ›´ã§ãã‚‹ï¼é€šå¸¸æ™‚ï¼ŒTerraformã®å‡¦ç†é †åºã¨ã—ã¦ï¼Œãƒªã‚½ãƒ¼ã‚¹ã®å‰Šé™¤å¾Œã«æ§‹ç¯‰ãŒè¡Œã‚ã‚Œã‚‹ï¼ã—ã‹ã—ï¼Œä»–ã®ãƒªã‚½ãƒ¼ã‚¹ã¨ä¾å­˜é–¢ä¿‚ãŒå­˜åœ¨ã™ã‚‹å ´åˆï¼Œå…ˆã«å‰Šé™¤ãŒè¡Œã‚ã‚Œã‚‹ã“ã¨ã«ã‚ˆã£ã¦ï¼Œä»–ã®ãƒªã‚½ãƒ¼ã‚¹ã«å½±éŸ¿ãŒå‡ºã¦ã—ã¾ã†ï¼ã“ã‚Œã«å¯¾å‡¦ã™ã‚‹ãŸã‚ã«ï¼Œå…ˆã«æ–°ã—ã„ãƒªã‚½ãƒ¼ã‚¹ã‚’æ§‹ç¯‰ã—ï¼Œç´ä»˜ã‘ã—ç›´ã—ã¦ã‹ã‚‰ï¼Œå‰Šé™¤ã™ã‚‹å¿…è¦ãŒã‚ã‚‹ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š ä¾‹ã¨ã—ã¦ï¼ŒACMè¨¼æ˜æ›¸ã‚’ç¤ºã™ï¼ACMè¨¼æ˜æ›¸ã¯ï¼ŒALBã‚„CloudFrontã«ç´ä»˜ã„ã¦ãŠã‚Šï¼Œæ–°ã—ã„è¨¼æ˜æ›¸ã«ç´ä»˜ã‘ç›´ã—ãŸå¾Œã«ï¼Œæ—¢å­˜ã®ã‚‚ã®ã‚’å‰Šé™¤ã™ã‚‹å¿…è¦ãŒã‚ã‚‹ï¼ ############################################### # For foo domain ############################################### resource \"aws_acm_certificate\" \"foo\" { # ï½ ä¸­ç•¥ ï½ # æ–°ã—ã„è¨¼æ˜æ›¸ã‚’æ§‹ç¯‰ã—ãŸå¾Œã«å‰Šé™¤ã™ã‚‹ï¼ lifecycle { create_before_destroy = true } } ï¼Šå®Ÿè£…ä¾‹ï¼Š ä¾‹ã¨ã—ã¦ï¼ŒRDSã®ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚°ãƒ«ãƒ¼ãƒ—ã¨ã‚µãƒ–ãƒãƒƒãƒˆã‚°ãƒ«ãƒ¼ãƒ—ã‚’ç¤ºã™ï¼ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚°ãƒ«ãƒ¼ãƒ—ã¨ã‚µãƒ–ãƒãƒƒãƒˆã‚°ãƒ«ãƒ¼ãƒ—ã¯ï¼ŒRDSã«ç´ä»˜ã„ã¦ãŠã‚Šï¼Œæ–°ã—ã„ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚°ãƒ«ãƒ¼ãƒ—ã«ç´ä»˜ã‘ç›´ã—ãŸå¾Œã«ï¼Œæ—¢å­˜ã®ã‚‚ã®ã‚’å‰Šé™¤ã™ã‚‹å¿…è¦ãŒã‚ã‚‹ï¼ ############################################### # RDS Cluster Parameter Group ############################################### resource \"aws_rds_cluster_parameter_group\" \"this\" { # ï½ ä¸­ç•¥ ï½ lifecycle { create_before_destroy = true } } ############################################### # RDS Subnet Group ############################################### resource \"aws_db_subnet_group\" \"this\" { # ï½ ä¸­ç•¥ ï½ lifecycle { create_before_destroy = true } ï¼Šå®Ÿè£…ä¾‹ï¼Š ä¾‹ã¨ã—ã¦ï¼ŒRedisã®ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚°ãƒ«ãƒ¼ãƒ—ã¨ã‚µãƒ–ãƒãƒƒãƒˆã‚°ãƒ«ãƒ¼ãƒ—ã‚’ç¤ºã™ï¼ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚°ãƒ«ãƒ¼ãƒ—ã¨ã‚µãƒ–ãƒãƒƒãƒˆã‚°ãƒ«ãƒ¼ãƒ—ã¯ï¼ŒRDSã«ç´ä»˜ã„ã¦ãŠã‚Šï¼Œæ–°ã—ã„ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚°ãƒ«ãƒ¼ãƒ—ã¨ã‚µãƒ–ãƒãƒƒãƒˆã‚°ãƒ«ãƒ¼ãƒ—ã«ç´ä»˜ã‘ç›´ã—ãŸå¾Œã«ï¼Œæ—¢å­˜ã®ã‚‚ã®ã‚’å‰Šé™¤ã™ã‚‹å¿…è¦ãŒã‚ã‚‹ï¼ ############################################### # Redis Parameter Group ############################################### resource \"aws_elasticache_parameter_group\" \"redis\" { # ï½ ä¸­ç•¥ ï½ lifecycle { create_before_destroy = true } } ############################################### # Redis Subnet Group ############################################### resource \"aws_elasticache_subnet_group\" \"redis\" { # ï½ ä¸­ç•¥ ï½ lifecycle { create_before_destroy = true } } ãƒ»ignore_changes å®Ÿã‚¤ãƒ³ãƒ•ãƒ©ã®ã¿ã§èµ·ã“ã£ãŸãƒªã‚½ãƒ¼ã‚¹ã®æ§‹ç¯‰ãƒ»æ›´æ–°ãƒ»å‰Šé™¤ã‚’ç„¡è¦–ã—ï¼Œtfstateãƒ•ã‚¡ã‚¤ãƒ«ã«åæ˜ ã—ãªã„ã‚ˆã†ã«ã™ã‚‹ï¼ã“ã‚Œã«ã‚ˆã‚Šï¼Œã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’ignore_changesã—ãŸã‚¿ã‚¤ãƒŸãƒ³ã‚°ä»¥é™ï¼Œå®Ÿã‚¤ãƒ³ãƒ•ãƒ©ã¨tfstateãƒ•ã‚¡ã‚¤ãƒ«ã«å·®åˆ†ãŒã‚ã£ã¦ã‚‚ï¼Œtfstateãƒ•ã‚¡ã‚¤ãƒ«ã®å€¤ãŒæ›´æ–°ã•ã‚Œãªããªã‚‹ï¼ä¸€ã¤ã®ãƒ†ã‚¯ãƒ‹ãƒƒã‚¯ã¨ã—ã¦ï¼Œæ©Ÿå¯†æƒ…å ±ã‚’ignore_changesã«æŒ‡å®šã—ï¼Œtfstateãƒ•ã‚¡ã‚¤ãƒ«ã¸ã®æ›¸ãè¾¼ã¿ã‚’é˜²ãæ–¹æ³•ãŒã‚ã‚‹ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š ä¾‹ã¨ã—ã¦ï¼ŒECSã‚’ç¤ºã™ï¼ECSã§ã¯ï¼ŒAutoScalingã«ã‚ˆã£ã¦ã‚¿ã‚¹ã‚¯æ•°ãŒå¢—åŠ ã™ã‚‹ï¼ãã®ãŸã‚ï¼Œã“ã‚Œã‚‰ã‚’ç„¡è¦–ã™ã‚‹å¿…è¦ãŒã‚ã‚‹ï¼ ############################################### # ECS Service ############################################### resource \"aws_ecs_service\" \"this\" { # ï½ ä¸­ç•¥ ï½ lifecycle { ignore_changes = [ # AutoScalingã«ã‚ˆã‚‹ã‚¿ã‚¹ã‚¯æ•°ã®å¢—æ¸›ã‚’ç„¡è¦–ï¼ desired_count, ] } } ï¼Šå®Ÿè£…ä¾‹ï¼Š ä¾‹ã¨ã—ã¦ï¼ŒRedisã‚’ç¤ºã™ï¼Redisã§ã¯ï¼ŒAutoScalingã«ã‚ˆã£ã¦ãƒ—ãƒ©ã‚¤ãƒãƒªæ•°ã¨ãƒ¬ãƒ—ãƒªã‚«æ•°ãŒå¢—æ¸›ã™ã‚‹ï¼ãã®ãŸã‚ï¼Œã“ã‚Œã‚‰ã‚’ç„¡è¦–ã™ã‚‹å¿…è¦ãŒã‚ã‚‹ï¼ ############################################### # Redis Cluster ############################################### resource \"aws_elasticache_replication_group\" \"redis\" { # ï½ ä¸­ç•¥ ï½ lifecycle { ignore_changes = [ # ãƒ—ãƒ©ã‚¤ãƒãƒªæ•°ã¨ãƒ¬ãƒ—ãƒªã‚«æ•°ã®å¢—æ¸›ã‚’ç„¡è¦–ã—ã¾ã™ï¼ number_cache_clusters ] } } } ï¼Šå®Ÿè£…ä¾‹ï¼Š ä½¿ç”¨ä¾‹ã¯ã™ããªã„ãŒï¼Œã¡ãªã¿ã«ãƒªã‚½ãƒ¼ã‚¹å…¨ä½“ã‚’ç„¡è¦–ã™ã‚‹å ´åˆã¯allã‚’è¨­å®šã™ã‚‹ï¼ resource \"aws_foo\" \"foo\" { # ï½ ä¸­ç•¥ ï½ lifecycle { ignore_changes = all } } 06. tplå½¢å¼ã®åˆ‡ã‚Šå‡ºã—ã¨èª­ã¿å‡ºã— templatefileé–¢æ•° ãƒ»templatefileé–¢æ•°ã¨ã¯ ç¬¬ä¸€å¼•æ•°ã§ãƒãƒªã‚·ãƒ¼ãŒå®šç¾©ã•ã‚ŒãŸãƒ•ã‚¡ã‚¤ãƒ«ã‚’èª­ã¿å‡ºã—ï¼Œç¬¬äºŒå¼•æ•°ã§ãƒ•ã‚¡ã‚¤ãƒ«ã«å¤‰æ•°ã‚’æ¸¡ã™ï¼ãƒ•ã‚¡ã‚¤ãƒ«ã®æ‹¡å¼µå­ã¯tplã¨ã™ã‚‹ã®ãŒã‚ˆã„ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š ä¾‹ã¨ã—ã¦ï¼ŒS3ã‚’ç¤ºã™ï¼ ############################################### # S3 bucket policy ############################################### resource \"aws_s3_bucket_policy\" \"alb\" { bucket = aws_s3_bucket.alb_logs.id policy = templatefile( \"${path.module}/policies/alb_bucket_policy.tpl\", { aws_elb_service_account_arn = var.aws_elb_service_account_arn aws_s3_bucket_alb_logs_arn = aws_s3_bucket.alb_logs.arn } ) } ãƒã‚±ãƒƒãƒˆãƒãƒªã‚·ãƒ¼ã‚’å®šç¾©ã™ã‚‹tplå½¢å¼ãƒ•ã‚¡ã‚¤ãƒ«ã§ã¯ï¼Œstringå‹ã§å‡ºåŠ›ã™ã‚‹å ´åˆã¯\"${}\"ã§ï¼Œintå‹ã§å‡ºåŠ›ã™ã‚‹å ´åˆã¯${}ã§å‡ºåŠ›ã™ã‚‹ï¼ã“ã“ã§æ‹¡å¼µå­ã‚’jsonã«ã—ã¦ã—ã¾ã†ã¨ï¼Œintå‹ã®å‡ºåŠ›ã‚’jsonã®æ§‹æ–‡ã‚¨ãƒ©ãƒ¼ã¨ã—ã¦æ‰±ã‚ã‚Œã¦ã—ã¾ã†ï¼ { \"Version\": \"2012-10-17\", \"Statement\": [ { \"Effect\": \"Allow\", \"Principal\": { \"AWS\": \"${aws_elb_service_account_arn}/*\" }, \"Action\": \"s3:PutObject\", \"Resource\": \"${aws_s3_bucket_alb_logs_arn}/*\" } ] } ãƒãƒªã‚·ãƒ¼ã®ã‚¢ã‚¿ãƒƒãƒ containerDefinitionsã®è¨­å®š ãƒ»containerDefinitionsã¨ã¯ ã‚¿ã‚¹ã‚¯å®šç¾©ã®ã†ã¡ï¼Œã‚³ãƒ³ãƒ†ãƒŠã‚’å®šç¾©ã™ã‚‹éƒ¨åˆ†ã®ã“ã¨ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š { \"ipcMode\": null, \"executionRoleArn\": \"\", \"containerDefinitions\": [ ], ~ ~ ~ ãã®ä»–ã®è¨­å®š ~ ~ ~ } ãƒ»è¨­å®šæ–¹æ³• intå‹ã‚’å¤‰æ•°ã¨ã—ã¦æ¸¡ã›ã‚‹ã‚ˆã†ã«ï¼Œæ‹¡å¼µå­ã‚’jsonã§ã¯ãªãtplã¨ã™ã‚‹ã®ãŒè‰¯ã„ï¼imageã‚­ãƒ¼ã§ã¯ï¼ŒECRã‚¤ãƒ¡ãƒ¼ã‚¸ã®URLã‚’æŒ‡å®šã™ã‚‹ï¼ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚¿ã‚°ã¯ä»»æ„ã§æŒ‡å®šã§ãï¼Œã‚‚ã—æŒ‡å®šã—ãªã„å ´åˆã¯ï¼Œã€latestã€ã¨ã„ã†åå‰ã®ã‚¿ã‚°ãŒè‡ªå‹•çš„ã«å‰²ã‚Šå½“ã¦ã‚‰ã‚Œã‚‹ï¼ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚¿ã‚°ã«ãƒãƒƒã‚·ãƒ¥å€¤ãŒå‰²ã‚Šå½“ã¦ã‚‰ã‚Œã¦ã„ã‚‹å ´åˆï¼ŒTerraformã§ã¯æ™‚ç³»åˆ—ã§æœ€æ–°ã®ã‚¿ã‚°åã‚’å–å¾—ã™ã‚‹æ–¹æ³•ãŒãªã„ãŸã‚ï¼Œï¼Œsecretsã‚­ãƒ¼ã§ã¯ï¼ŒSSMã®ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚¹ãƒˆã‚¢ã®å€¤ã‚’å‚ç…§ã§ãã‚‹ï¼ãƒ­ã‚°åˆ†å‰²ã®ç›®å°ã‚’è¨­å®šã™ã‚‹awslogs-datetime-formatã‚­ãƒ¼ã§ã¯ï¼Œã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—ã‚’è¡¨ã™\\\\[%Y-%m-%d %H:%M:%S\\\\]ã‚’è¨­å®šã™ã‚‹ã¨è‰¯ã„ï¼ã“ã‚Œã«ã‚ˆã‚Šï¼ŒåŒã˜æ™‚é–“ã«ç™ºç”Ÿã—ãŸãƒ­ã‚°ã‚’ä¸€ã¤ã®ãƒ­ã‚°ã¨ã—ã¦ã¾ã¨ã‚ã‚‹ã“ã¨ãŒã§ãã‚‹ãŸã‚ï¼Œã‚¹ã‚¿ãƒƒã‚¯ãƒˆãƒ¬ãƒ¼ã‚¹ãŒè¦‹ã‚„ã™ããªã‚‹ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š [ { # ã‚³ãƒ³ãƒ†ãƒŠå \"name\": \"laravel\", # ECRã®URLï¼ã‚¿ã‚°ã‚’æŒ‡å®šã—ãªã„å ´åˆã¯latestãŒå‰²ã‚Šå½“ã¦ã‚‰ã‚Œã‚‹ï¼ \"image\": \"*****.dkr.ecr.ap-northeast-1.amazonaws.com/prd-foo-laravel-repository\", \"essential\": true, \"portMappings\": [ { \"containerPort\": 80, \"hostPort\": 80, \"protocol\": \"tcp\" } ], \"secrets\": [ { # ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ç’°å¢ƒå¤‰æ•°å \"name\": \"DB_HOST\", # SSMã®ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿å \"valueFrom\": \"/prd-foo/DB_HOST\" }, { \"name\": \"DB_DATABASE\", \"valueFrom\": \"/prd-foo/DB_DATABASE\" }, { \"name\": \"DB_PASSWORD\", \"valueFrom\": \"/prd-foo/DB_PASSWORD\" }, { \"name\": \"DB_USERNAME\", \"valueFrom\": \"/prd-foo/DB_USERNAME\" }, { \"name\": \"REDIS_HOST\", \"valueFrom\": \"/prd-foo/REDIS_HOST\" }, { \"name\": \"REDIS_PASSWORD\", \"valueFrom\": \"/prd-foo/REDIS_PASSWORD\" }, { \"name\": \"REDIS_PORT\", \"valueFrom\": \"/prd-foo/REDIS_PORT\" } ], \"logConfiguration\": { \"logDriver\": \"awslogs\", \"options\": { # ãƒ­ã‚°ã‚°ãƒ«ãƒ¼ãƒ—å \"awslogs-group\": \"/prd-foo/laravel/log\", # ã‚¹ã‚¿ãƒƒã‚¯ãƒˆãƒ¬ãƒ¼ã‚¹ã®ã‚°ãƒ«ãƒ¼ãƒ—åŒ–ï¼ˆåŒæ™‚åˆ»ãƒ­ã‚°ã®ã‚°ãƒ«ãƒ¼ãƒ—åŒ–ï¼‰ \"awslogs-datetime-format\": \"\\\\[%Y-%m-%d %H:%M:%S\\\\]\", # ãƒªãƒ¼ã‚¸ãƒ§ãƒ³ \"awslogs-region\": \"ap-northeast-1\", # ãƒ­ã‚°ã‚¹ãƒˆãƒªãƒ¼ãƒ åã®ãƒ—ãƒ¬ãƒ•ã‚£ã‚¯ã‚¹ \"awslogs-stream-prefix\": \"/container\" } } } ] 07. å‘½åè¦å‰‡ module AWSãƒªã‚½ãƒ¼ã‚¹ã®ã‚¢ãƒ«ãƒ•ã‚¡ãƒ™ãƒƒãƒˆé †ã«moduleã‚’ä¸¦ã¹ã‚‹ï¼ã¾ãŸï¼Œå¤‰æ•°ã‚„ã‚¢ã‚¦ãƒˆãƒ—ãƒƒãƒˆå€¤ã‚’ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã«æ¸¡ã™æ™‚ã‚‚AWSãƒªã‚½ãƒ¼ã‚¹ã®ã‚¢ãƒ«ãƒ•ã‚¡ãƒ™ãƒƒãƒˆé †ã¨ã™ã‚‹ï¼ å¤‰æ•°ã®å‘½å ãƒ»å˜æ•°å½¢ã¨è¤‡æ•°å½¢ã®å‘½ååˆ†ã‘ è¤‡æ•°ã®å€¤ã‚’æŒã¤listå‹ã®å¤‰æ•°ã§ã‚ã‚Œã°è¤‡æ•°å½¢ã§å‘½åã™ã‚‹ï¼ä¸€æ–¹ã§ï¼Œstringå‹ãªã©å€¤ãŒä¸€ã¤ã—ã‹ãªã‘ã‚Œã°å˜æ•°å½¢ã¨ã™ã‚‹ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š ä¾‹ã¨ã—ã¦ï¼ŒVPCã‚’ç¤ºã™ï¼ ############################################### # VPC variables ############################################### vpc_availability_zones = { a = \"a\", c = \"c\" } vpc_cidr = \"n.n.n.n/23\" vpc_subnet_private_datastore_cidrs = { a = \"n.n.n.n/27\", c = \"n.n.n.n/27\" } vpc_subnet_private_app_cidrs = { a = \"n.n.n.n/25\", c = \"n.n.n.n/25\" } vpc_subnet_public_cidrs = { a = \"n.n.n.n/27\", c = \"n.n.n.n/27\" } ç’°å¢ƒå¤‰æ•°ã®å‘½å AWSãƒªã‚½ãƒ¼ã‚¹ã®ã‚¢ãƒ«ãƒ•ã‚¡ãƒ™ãƒƒãƒˆé †ã«ç’°å¢ƒå¤‰æ•°ã‚’ä¸¦ã¹ã‚‹ï¼Œç’°å¢ƒå¤‰æ•°ã®åå‰ã¯ï¼Œä½¿ç”¨ã™ã‚‹AWSãƒªã‚½ãƒ¼ã‚¹ã®åå‰ã‚’æœ€åˆã«ã¤ã‘ã‚‹ã‚ˆã†ã«ã™ã‚‹ï¼listå‹ã¾ãŸã¯mapå‹ã§ã‚ã‚Œã°è¤‡æ•°å½¢ï¼Œãã‚Œä»¥å¤–ã§ã‚ã‚Œã°å˜æ•°å½¢ã¨ã™ã‚‹ï¼ ############################################### # Route53 ############################################### # ï½ ä¸­ç•¥ ï½ ############################################### # VPC ############################################### # ï½ ä¸­ç•¥ ï½ ############################################### # WAF ############################################### waf_blocked_user_agents = [ \"AdCrawler\", ] è¤‡æ•°ã®AWSãƒªã‚½ãƒ¼ã‚¹ã§ä½¿ç”¨ã™ã‚‹å ´åˆã¯ï¼Œã€Generalã€ã¨ã—ï¼Œã‚°ãƒ­ãƒ¼ãƒãƒ«ãªåå‰ã«ã™ã‚‹ï¼ ############################################### # General ############################################### camel_case_prefix = \"Bar\" region = \"ap-northeast-1\" environment = \"stg\" service = \"bar\" ãƒªã‚½ãƒ¼ã‚¹ã¨ãƒ‡ãƒ¼ã‚¿ãƒªã‚½ãƒ¼ã‚¹ã®å‘½å ãƒ»ãƒªã‚½ãƒ¼ã‚¹åã§ç¨®é¡ã‚’è¡¨ç¾ ãƒªã‚½ãƒ¼ã‚¹åã«ãŠã„ã¦ï¼Œãƒªã‚½ãƒ¼ã‚¹ã‚¿ã‚¤ãƒ—ã‚’ç¹°ã‚Šè¿”ã•ãªã„ã‚ˆã†ã«ã™ã‚‹ï¼ã‚‚ã—ç¨®é¡ãŒã‚ã‚‹å ´åˆï¼Œãƒªã‚½ãƒ¼ã‚¹åã§ãã®ç¨®é¡ã‚’è¡¨ç¾ã™ã‚‹ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š ä¾‹ã¨ã—ã¦ï¼ŒVPCã‚’ç¤ºã™ï¼ ############################################### # VPC route table ############################################### # è‰¯ã„ä¾‹ resource \"aws_route_table\" \"public\" { } resource \"aws_route_table\" \"private\" { } ############################################### # VPC route table ############################################### # æ‚ªã„ä¾‹ resource \"aws_route_table\" \"route_table_public\" { } resource \"aws_route_table\" \"route_table_private\" { } ãƒ»this ä¸€ã¤ã®ãƒªã‚½ãƒ¼ã‚¹ã‚¿ã‚¤ãƒ—ã«ï¼Œä¸€ã¤ã®ãƒªã‚½ãƒ¼ã‚¹ã—ã‹ç¨®é¡ãŒå­˜åœ¨ã—ãªã„å ´åˆï¼Œthisã§å‘½åã™ã‚‹ï¼ãŸã ã—ï¼Œå¾Œã‹ã‚‰ç¨®é¡ãŒå¢—ãˆã‚‹ã“ã¨ãŒã‚ˆãã‚ã‚‹ãŸã‚ï¼Œéæ¨å¥¨ã§ã‚ã‚‹ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š resource \"aws_internet_gateway\" \"this\" { } ãƒ»AWSãƒªã‚½ãƒ¼ã‚¹å --ã¨ã™ã‚‹ï¼ æ¥é ­è¾ã¯ï¼Œ -ã¨ã™ã‚‹ï¼ æ¥å°¾è¾ã¯ï¼ŒAWSãƒªã‚½ãƒ¼ã‚¹åã¨ã™ã‚‹ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š ä¾‹ã¨ã—ã¦ï¼ŒCloudWatchã‚’ç¤ºã™ï¼ã“ã®æ™‚ï¼Œä»–ã®resourceã¨æ¯”è¼ƒã—ã¦ï¼Œç¨®é¡ã¯ALBã®HTTPCode_TARGET_4XX_Countãƒ¡ãƒˆãƒªã‚¯ã‚¹ã«é–¢ã™ã‚‹ã‚¢ãƒ©ãƒ¼ãƒ ã¨è¦‹ãªã›ã‚‹ï¼ãã®ãŸã‚ï¼Œalb_httpcode_4xx_countã¨åä»˜ã‘ã¦ã„ã‚‹ï¼ resource \"aws_cloudwatch_metric_alarm\" \"alb_httpcode_target_4xx_count\" { alarm_name = \"prd-foo-alb-httpcode-target-4xx-count-alarm\" } ãƒ»è¨­å®šã®é †åºï¼Œè¡Œé–“ æœ€åˆã«countã‚„for_eachã‚’è¨­å®šã—æ”¹è¡Œã™ã‚‹ï¼ãã®å¾Œï¼Œå„ãƒªã‚½ãƒ¼ã‚¹åˆ¥ã®è¨­å®šã‚’è¡Œé–“ã‚’ç©ºã‘ãšã«è¨˜è¿°ã™ã‚‹ï¼ˆã“ã®é †ç•ªã«ãƒ«ãƒ¼ãƒ«ã¯ãªã—ï¼‰ï¼æœ€å¾Œã«å…±é€šã®è¨­å®šã¨ã—ã¦ï¼Œtagsï¼Œdepends_onï¼Œlifecycleï¼Œã®é †ã§é…ç½®ã™ã‚‹ï¼ãŸã ã—å®Ÿéš›ï¼Œã“ã‚Œã‚‰ã®å…¨ã¦ã®è¨­å®šãŒå¿…è¦ãªãƒªã‚½ãƒ¼ã‚¹ã¯ãªã„ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š ############################################### # EXAMPLE ############################################### resource \"aws_baz\" \"this\" { for_each = var.vpc_availability_zones # æœ€åˆã«for_each # ã‚¹ãƒšãƒ¼ã‚¹ subnet_id = aws_subnet.public[*].id # å„è¨­å®šï¼ˆé †ç•ªã«ãƒ«ãƒ¼ãƒ«ãªã—ï¼‰ # ã‚¹ãƒšãƒ¼ã‚¹ tags = { Name = format( \"prd-foo-%d-baz\", each.value ) } # ã‚¹ãƒšãƒ¼ã‚¹ depends_on = [] # ã‚¹ãƒšãƒ¼ã‚¹ lifecycle { create_before_destroy = true } } ã‚¢ã‚¦ãƒˆãƒ—ãƒƒãƒˆå€¤ã®å‘½å ãƒ»åŸºæœ¬ãƒ«ãƒ¼ãƒ« ã‚¢ã‚¦ãƒˆãƒ—ãƒƒãƒˆå€¤ã®åå‰ã¯ï¼Œã€__ã€ã§å‘½åã™ã‚‹ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š ä¾‹ã¨ã—ã¦ï¼ŒCloudWatchã‚’ç¤ºã™ï¼ãƒªã‚½ãƒ¼ã‚¹åã¯ecs_container_nginxï¼Œãƒªã‚½ãƒ¼ã‚¹ã‚¿ã‚¤ãƒ—ã¯aws_cloudwatch_log_groupï¼Œattributeã¯nameã‚ªãƒ—ã‚·ãƒ§ãƒ³ã§ã‚ã‚‹ï¼ output \"ecs_container_nginx_cloudwatch_log_group_name\" { value = aws_cloudwatch_log_group.ecs_container_nginx.name } ï¼Šå®Ÿè£…ä¾‹ï¼Š ä¾‹ã¨ã—ã¦ï¼ŒIAM Roleã‚’ç¤ºã™ï¼ ############################################### # Output IAM Role ############################################### output \"ecs_task_execution_iam_role_arn\" { value = aws_iam_role.ecs_task_execution.arn } output \"lambda_execute_iam_role_arn\" { value = aws_iam_role.lambda_execute.arn } output \"rds_enhanced_monitoring_iam_role_arn\" { value = aws_iam_role.rds_enhanced_monitoring.arn } ãƒ»thisã¯çœç•¥ ãƒªã‚½ãƒ¼ã‚¹åãŒthisã§ã‚ã‚‹å ´åˆï¼Œã‚¢ã‚¦ãƒˆãƒ—ãƒƒãƒˆå€¤åã§ã¯ã“ã‚Œã‚’çœç•¥ã—ã¦ã‚‚ã‚ˆã„ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š ä¾‹ã¨ã—ã¦ï¼ŒALBã‚’ç¤ºã™ï¼ ############################################### # Output ALB ############################################### output \"alb_zone_id\" { value = aws_lb.this.zone_id } output \"alb_dns_name\" { value = aws_lb.this.dns_name } ãƒ»å†—é•·ãªattributeåã¯çœç•¥ ï¼Šå®Ÿè£…ä¾‹ï¼Š ä¾‹ã¨ã—ã¦ï¼ŒECRã‚’ç¤ºã™ï¼ ############################################### # Output ECR ############################################### output \"laravel_ecr_repository_url\" { value = aws_ecr_repository.laravel.repository_url } output \"nginx_ecr_repository_url\" { value = aws_ecr_repository.nginx.repository_url } "},"public/infrastructure_as_code/infrastructure_as_code_terraform_aws_tips.html":{"url":"public/infrastructure_as_code/infrastructure_as_code_terraform_aws_tips.html","title":"ğŸ“– ï¸Terraformã‚’ç”¨ã„ãŸAWSæ§‹ç¯‰Tips","keywords":"","body":"Terraformã‚’ç”¨ã„ãŸAWSæ§‹ç¯‰Tips ã¯ã˜ã‚ã« æœ¬ã‚µã‚¤ãƒˆã«ã¤ãã¾ã—ã¦ï¼Œä»¥ä¸‹ã‚’ã”èªè­˜ã®ã»ã©å®œã—ããŠé¡˜ã„ã„ãŸã—ã¾ã™ï¼ å‚è€ƒï¼šhttps://hiroki-it.github.io/tech-notebook-gitbook/ 01. AMI ã¾ã¨ã‚ ï¼Šå®Ÿè£…ä¾‹ï¼Š ############################################### # For bastion ############################################### data \"aws_ami\" \"bastion\" { # å¾Œè¿°ã®èª¬æ˜ã‚’å‚è€ƒã«ã›ã‚ˆï¼ï¼ˆï¼‘ï¼‰ most_recent = false # å¾Œè¿°ã®èª¬æ˜ã‚’å‚è€ƒã«ã›ã‚ˆï¼ï¼ˆï¼‘ï¼‰ owners = [\"amazon\"] filter { name = \"name\" values = [\"amzn-ami-hvm-2018.03.0.20201028.0-x86_64-gp2\"] } filter { name = \"image-id\" values = [\"ami-040c9333a9c90b2b6\"] } } ï¼ˆï¼‘ï¼‰å–å¾—ã™ã‚‹AMIã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’å›ºå®š å–å¾—ã™ã‚‹AMIãŒå¸¸ã«æœ€æ–°ã«ãªã£ã¦ã„ã‚‹ã¨ï¼ŒEC2ãŒå†æ§‹ç¯‰ã•ã‚Œãªã­ãªã„ï¼ãã“ã§ï¼Œç‰¹å®šã®AMIã‚’å–å¾—ã§ãã‚‹ã‚ˆã†ã«ã—ã¦ãŠãï¼most_recentã¯ç„¡åŠ¹åŒ–ã—ã¦ãŠãï¼Œç‰¹å®šã®AMã‚’ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°ã™ã‚‹ï¼ 02. API Gateway ã¾ã¨ã‚ ï¼Šå®Ÿè£…ä¾‹ï¼Š ############################################### # REST API ############################################### resource \"aws_api_gateway_rest_api\" \"foo\" { name = \"prd-foo-api-for-foo\" description = \"The API that enables two-way communication with prd-foo\" # VPCãƒªãƒ³ã‚¯ã®ãƒ—ãƒ­ã‚­ã‚·çµ±åˆã®APIã‚’å®šç¾©ã—ãŸOpenAPIä»•æ§˜ # å¾Œè¿°ã®èª¬æ˜ã‚’å‚è€ƒã«ã›ã‚ˆï¼ï¼ˆï¼‘ï¼‰ body = templatefile( \"${path.module}/open_api.yaml\", { api_gateway_vpc_link_foo_id = aws_api_gateway_vpc_link.foo.id nlb_dns_name = var.nlb_dns_name } ) endpoint_configuration { types = [\"REGIONAL\"] } lifecycle { ignore_changes = [ policy ] } } ############################################### # Deployment ############################################### resource \"aws_api_gateway_deployment\" \"foo\" { rest_api_id = aws_api_gateway_rest_api.foo.id # å¾Œè¿°ã®èª¬æ˜ã‚’å‚è€ƒã«ã›ã‚ˆï¼ï¼ˆï¼‘ï¼‰ triggers = { redeployment = sha1(aws_api_gateway_rest_api.foo.body) } lifecycle { create_before_destroy = true } } ############################################### # Stage ############################################### resource \"aws_api_gateway_stage\" \"foo\" { deployment_id = aws_api_gateway_deployment.foo.id rest_api_id = aws_api_gateway_rest_api.foo.id stage_name = var.environment } ï¼ˆï¼‘ï¼‰OpenAPIä»•æ§˜ã®ã‚¤ãƒ³ãƒãƒ¼ãƒˆã¨å·®åˆ†èªè­˜ ã‚ã‚‰ã‹ã˜ã‚ç”¨æ„ã—ãŸOpenAPIä»•æ§˜ã®YAMLãƒ•ã‚¡ã‚¤ãƒ«ã‚’bodyã‚ªãƒ—ã‚·ãƒ§ãƒ³ã®ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã¨ã—ï¼Œã“ã‚Œã‚’ã‚¤ãƒ³ãƒãƒ¼ãƒˆã™ã‚‹ã“ã¨ã«ã‚ˆã‚Šï¼ŒAPIã‚’å®šç¾©ã§ãã‚‹ï¼YAMLãƒ•ã‚¡ã‚¤ãƒ«ã«å¤‰æ•°ã‚’æ¸¡ã™ã“ã¨ã‚‚ã§ãã‚‹ï¼APIã®å†ãƒ‡ãƒ—ãƒ­ã‚¤ã®ãƒˆãƒªã‚¬ãƒ¼ã¨ã—ã¦ï¼Œredeploymentãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã«bodyãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã®ãƒãƒƒã‚·ãƒ¥å€¤ã‚’æ¸¡ã™ã‚ˆã†ã«ã™ã‚‹ï¼ã“ã‚Œã«ã‚ˆã‚Šï¼Œã‚¤ãƒ³ãƒãƒ¼ãƒˆå…ƒã®YAMLãƒ•ã‚¡ã‚¤ãƒ«ã«å·®åˆ†ãŒã‚ã£ãŸå ´åˆã«ï¼ŒTerraformãŒredeploymentãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã®å€¤ã®å¤‰åŒ–ã‚’èªè­˜ã§ãã‚‹ã‚ˆã†ã«ãªã‚Šï¼Œå†ãƒ‡ãƒ—ãƒ­ã‚¤ã‚’å®Ÿè¡Œã§ãã‚‹ï¼ ï¼ˆâ€»ï¼‰ã‚¹ãƒ†ãƒ¼ã‚¸åã‚’å–å¾—ã™ã‚‹æ–¹æ³•ã¯ãªã„ API Gatewayã®ã‚¹ãƒ†ãƒ¼ã‚¸åã‚’å‚ç…§ã™ã‚‹ãŸã‚ã«ã¯ï¼Œresourceã‚’ä½¿ç”¨ã™ã‚‹å¿…è¦ãŒã‚ã‚Šï¼Œdataã§ã¯ã“ã‚Œã‚’å–å¾—ã™ã‚‹ã“ã¨ãŒã§ããªã„ï¼ã‚‚ã—ã‚¹ãƒ†ãƒ¼ã‚¸ã‚’ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ç”»é¢ä¸Šã‹ã‚‰æ§‹ç¯‰ã—ã¦ã„ã‚‹å ´åˆï¼Œã‚¹ãƒ†ãƒ¼ã‚¸ã®ARNã‚’å‚ç…§ã™ã‚‹ã“ã¨ãŒã§ããªã„ãŸã‚ï¼ŒARNã‚’è‡ªåŠ›ã§ä½œã‚‹å¿…è¦ãŒã‚ã‚‹ï¼API Gatewayã®å„ARNã«ã¤ã„ã¦ã¯ï¼Œä»¥ä¸‹ã‚’å‚è€ƒã«ã›ã‚ˆï¼ å‚è€ƒï¼šhttps://docs.aws.amazon.com/ja_jp/apigateway/latest/developerguide/arn-format-reference.html ï¼Šå®Ÿè£…ä¾‹ï¼Š WAFã«API Gatewayã‚’ç´ä»˜ã‘ã‚‹ãŸã‚ã«ï¼Œã‚¹ãƒ†ãƒ¼ã‚¸ã®ARNãŒå¿…è¦ã§ã‚ã‚‹ï¼ã“ã‚Œã¯è‡ªåŠ›ã§ä½œã‚‹ï¼ ############################################### # Web ACL Association ############################################### resource \"aws_wafv2_web_acl_association\" \"api_gateway\" { resource_arn = \"${var.api_gateway_rest_arn}/stages/prd\" web_acl_arn = aws_wafv2_web_acl.api_gateway.arn } 03. CloudFront ã¾ã¨ã‚ ï¼Šå®Ÿè£…ä¾‹ï¼Š resource \"aws_cloudfront_distribution\" \"this\" { price_class = \"PriceClass_200\" web_acl_id = var.cloudfront_wafv2_web_acl_arn aliases = [var.route53_domain_foo] comment = \"prd-foo-cf-distribution\" enabled = true # å¾Œè¿°ã®èª¬æ˜ã‚’å‚è€ƒã«ã›ã‚ˆï¼ï¼ˆï¼‘ï¼‰ retain_on_delete = true viewer_certificate { acm_certificate_arn = var.foo_acm_certificate_arn ssl_support_method = \"sni-only\" minimum_protocol_version = \"TLSv1.2_2019\" } logging_config { bucket = var.cloudfront_s3_bucket_regional_domain_name include_cookies = true } restrictions { geo_restriction { restriction_type = \"none\" } } # ï½ ä¸­ç•¥ ï½ } ï¼ˆï¼‘ï¼‰å‰Šé™¤ä¿æŒæ©Ÿèƒ½ Terraformã§ã¯ï¼Œretain_on_deleteã§è¨­å®šã§ãã‚‹ï¼å›ºæœ‰ã®è¨­å®šã§ï¼ŒAWSã«å¯¾å¿œã™ã‚‹ã‚‚ã®ã¯ç„¡ã„ï¼ originãƒ–ãƒ­ãƒƒã‚¯ Originsç”»é¢ã«è¨­å®šã™ã‚‹ã‚ªãƒªã‚¸ãƒ³ã‚’å®šç¾©ã™ã‚‹ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š resource \"aws_cloudfront_distribution\" \"this\" { # ï½ ä¸­ç•¥ ï½ # ã‚ªãƒªã‚¸ãƒ³ï¼ˆã“ã“ã§ã¯S3ã¨ã—ã¦ã„ã‚‹ï¼‰ origin { domain_name = var.s3_bucket_regional_domain_name origin_id = \"S3-${var.s3_bucket_id}\" s3_origin_config { origin_access_identity = aws_cloudfront_origin_access_identity.s3_foo.cloudfront_access_identity_path } } # ï½ ä¸­ç•¥ ï½ } resource \"aws_cloudfront_distribution\" \"this\" { # ï½ ä¸­ç•¥ ï½ # ã‚ªãƒªã‚¸ãƒ³ï¼ˆã“ã“ã§ã¯ALBã¨ã—ã¦ã„ã‚‹ï¼‰ origin { domain_name = var.alb_dns_name origin_id = \"ELB-${var.alb_name}\" custom_origin_config { origin_ssl_protocols = [\"TLSv1.2\"] origin_protocol_policy = \"match-viewer\" origin_read_timeout = 30 origin_keepalive_timeout = 5 http_port = var.alb_listener_port_http https_port = var.alb_listener_port_https } } # ï½ ä¸­ç•¥ ï½ } ordered_cache_behaviorãƒ–ãƒ­ãƒƒã‚¯ Behaviorç”»é¢ã«è¨­å®šã™ã‚‹ã‚ªãƒªã‚¸ãƒ³ã«ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã™ã‚‹ãƒ‘ã‚¹ã‚’å®šç¾©ã™ã‚‹ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š resource \"aws_cloudfront_distribution\" \"this\" { # ï½ ä¸­ç•¥ ï½ ordered_cache_behavior { path_pattern = \"/images/*\" target_origin_id = \"S3-${var.s3_bucket_id}\" viewer_protocol_policy = \"redirect-to-https\" allowed_methods = [\"GET\", \"HEAD\", \"OPTIONS\", \"PUT\", \"POST\", \"PATCH\", \"DELETE\"] cached_methods = [\"GET\", \"HEAD\"] min_ttl = 0 max_ttl = 31536000 default_ttl = 86400 compress = true forwarded_values { query_string = true cookies { forward = \"none\" } } } # ï½ ä¸­ç•¥ ï½ } default_cache_behavior Behaviorç”»é¢ã«è¨­å®šã™ã‚‹ã‚ªãƒªã‚¸ãƒ³ã«ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã™ã‚‹æ¨™æº–ãƒ‘ã‚¹ã‚’å®šç¾©ã™ã‚‹ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š resource \"aws_cloudfront_distribution\" \"this\" { default_cache_behavior { target_origin_id = \"ELB-${var.alb_name}\" viewer_protocol_policy = \"redirect-to-https\" allowed_methods = [\"GET\", \"HEAD\", \"OPTIONS\", \"PUT\", \"POST\", \"PATCH\", \"DELETE\"] cached_methods = [\"GET\", \"HEAD\"] min_ttl = 0 max_ttl = 31536000 default_ttl = 86400 compress = true forwarded_values { query_string = true headers = [\"*\"] cookies { forward = \"all\" } } } # ï½ ä¸­ç•¥ ï½ } 04. ECR ãƒ©ã‚¤ãƒ•ã‚µã‚¤ã‚¯ãƒ«ãƒãƒªã‚·ãƒ¼ ECRã«ã‚¢ã‚¿ãƒƒãƒã•ã‚Œã‚‹ï¼Œã‚¤ãƒ¡ãƒ¼ã‚¸ã®æœ‰åŠ¹æœŸé–“ã‚’å®šç¾©ã™ã‚‹ãƒãƒªã‚·ãƒ¼ï¼ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ç”»é¢ã‹ã‚‰å…¥åŠ›ã§ãã‚‹ãŸã‚ï¼ŒåŸºæœ¬çš„ã«ãƒãƒªã‚·ãƒ¼ã®å®Ÿè£…ã¯ä¸è¦ã§ã‚ã‚‹ãŒï¼ŒTerraformãªã©ã®IaCãƒ„ãƒ¼ãƒ«ã§ã¯å¿…è¦ã«ãªã‚‹ï¼ { \"rules\": [ { \"rulePriority\": 1, \"description\": \"Keep last 10 images untagged\", \"selection\": { \"tagStatus\": \"untagged\", \"countType\": \"imageCountMoreThan\", \"countNumber\": 10 }, \"action\": { \"type\": \"expire\" } }, { \"rulePriority\": 2, \"description\": \"Keep last 10 images any\", \"selection\": { \"tagStatus\": \"any\", \"countType\": \"imageCountMoreThan\", \"countNumber\": 10 }, \"action\": { \"type\": \"expire\" } } ] } 05. ECS ã¾ã¨ã‚ ï¼Šå®Ÿè£…ä¾‹ï¼Š ############################################### # ECS Service ############################################### resource \"aws_ecs_service\" \"this\" { name = \"prd-foo-ecs-service\" cluster = aws_ecs_cluster.this.id launch_type = \"FARGATE\" platform_version = \"1.4.0\" desired_count = var.ecs_service_desired_count deployment_maximum_percent = 200 deployment_minimum_healthy_percent = 100 # å¾Œè¿°ã®èª¬æ˜ã‚’å‚è€ƒã«ã›ã‚ˆï¼ï¼ˆï¼‘ï¼‰ health_check_grace_period_seconds = 330 # å¾Œè¿°ã®èª¬æ˜ã‚’å‚è€ƒã«ã›ã‚ˆï¼ï¼ˆï¼’ï¼‰ task_definition = \"${aws_ecs_task_definition.this.family}:${max(aws_ecs_task_definition.this.revision, data.aws_ecs_task_definition.this.revision)}\" network_configuration { security_groups = [var.ecs_security_group_id] subnets = [var.private_a_app_subnet_id, var.private_c_app_subnet_id] assign_public_ip = false } load_balancer { target_group_arn = var.alb_target_group_arn container_name = \"nginx\" container_port = 80 } load_balancer { target_group_arn = var.nlb_target_group_arn container_name = \"nginx\" container_port = 80 } depends_on = [ # å¾Œè¿°ã®èª¬æ˜ã‚’å‚è€ƒã«ã›ã‚ˆï¼ï¼ˆï¼“ï¼‰ var.alb_listener_https, var.nlb_listener ] lifecycle { ignore_changes = [ # â€»å¾Œè¿°ã®èª¬æ˜ã‚’å‚è€ƒã«ã›ã‚ˆï¼ˆï¼”ï¼‰ desired_count, ] } } ï¼ˆï¼‘ï¼‰ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯çŒ¶äºˆæœŸé–“ ã‚¿ã‚¹ã‚¯ã®èµ·å‹•ãŒå®Œäº†ã™ã‚‹å‰ã«ã‚µãƒ¼ãƒ“ã‚¹ãŒãƒ­ãƒ¼ãƒ‰ãƒãƒ©ãƒ³ã‚µï¼ã®ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯ã‚’æ¤œè¨¼ã—ï¼ŒUnhealthyã¨èª¤èªã—ã¦ã—ã¾ã†ãŸã‚ï¼Œã‚¿ã‚¹ã‚¯ã®èµ·å‹•å®Œäº†ã‚’å¾…æ©Ÿã™ã‚‹ï¼ä¾‹ãˆã°ï¼Œãƒ­ãƒ¼ãƒ‰ãƒãƒ©ãƒ³ã‚µï¼ãŒ30ç§’é–“éš”ã§ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯ã‚’å®Ÿè¡Œã™ã‚‹å ´åˆã¯ï¼Œ30ç§’å˜ä½ã§å¾…æ©Ÿæ™‚é–“ã‚’å¢—ã‚„ã—ï¼Œé©åˆ‡ãªå¾…æ©Ÿæ™‚é–“ã‚’è¦‹ã¤ã‘ã‚‹ã‚ˆã†ã«ã™ã‚‹ï¼ ï¼ˆï¼’ï¼‰å®Ÿã‚¤ãƒ³ãƒ•ãƒ©ã®ãƒªãƒ“ã‚¸ãƒ§ãƒ³ç•ªå·ã®è¿½è·¡ ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ãƒ‡ãƒ—ãƒ­ã‚¤ã«ã‚ˆã£ã¦ï¼Œå®Ÿã‚¤ãƒ³ãƒ•ãƒ©ã®ã‚¿ã‚¹ã‚¯å®šç¾©ã®ãƒªãƒ“ã‚¸ãƒ§ãƒ³ç•ªå·ãŒå¢—åŠ ã™ã‚‹ãŸã‚ï¼Œã“ã‚Œã‚’è¿½è·¡ã§ãã‚‹ã‚ˆã†ã«ã™ã‚‹ï¼ å‚è€ƒï¼šhttps://registry.terraform.io/providers/hashicorp/aws/latest/docs/data-sources/ecs_task_definition ï¼ˆï¼“ï¼‰ALB/NLBãƒªã‚¹ãƒŠãƒ¼ã®æ§‹ç¯‰ã‚’å¾…æ©Ÿ Teraformã¯ï¼Œç‰¹ã«ä¾å­˜é–¢ä¿‚ã‚’å®Ÿè£…ã—ãªã„å ´åˆã«ï¼Œã€ã‚¿ãƒ¼ã‚²ãƒƒãƒˆã‚°ãƒ«ãƒ¼ãƒ— â†’ ALB/NLB â†’ ãƒªã‚¹ãƒŠãƒ¼ã€ã®é †ã§ãƒªã‚½ãƒ¼ã‚¹ã‚’æ§‹ç¯‰ã™ã‚‹ï¼å•é¡Œã¨ã—ã¦ï¼ŒALB/NLBã‚„ãƒªã‚¹ãƒŠãƒ¼ã®æ§‹ç¯‰ãŒçµ‚ã‚ã‚‹å‰ã«ï¼ŒECSã‚µãƒ¼ãƒ“ã‚¹ã®æ§‹ç¯‰ãŒå§‹ã¾ã£ã¦ã—ã¾ã†ï¼ALB/NLBã®æ§‹ç¯‰ï¼ˆâ€»ãƒªã‚¹ãƒŠãƒ¼ã‚‚å«ã‚€å¯èƒ½æ€§ï¼‰ãŒå®Œå…¨ã«å®Œäº†ã—ãªã„çŠ¶æ…‹ã§ã¯ï¼Œã‚¿ãƒ¼ã‚²ãƒƒãƒˆã‚°ãƒ«ãƒ¼ãƒ—ã¯ECSã‚µãƒ¼ãƒ“ã‚¹ã«ç´ä»˜ã‘ã‚‰ãšï¼Œã“ã‚ŒãŒå®Œäº†ã™ã‚‹å‰ã«ECSã‚µãƒ¼ãƒ“ã‚¹ãŒã‚¿ãƒ¼ã‚²ãƒƒãƒˆã‚°ãƒ«ãƒ¼ãƒ—ã‚’å‚ç…§ã—ã‚ˆã†ã¨ã™ã‚‹ãŸã‚ï¼Œã‚¨ãƒ©ãƒ¼ã«ãªã‚‹ï¼ãƒªã‚¹ãƒŠãƒ¼ã®å¾Œã«ECSã‚µãƒ¼ãƒ“ã‚¹ã‚’æ§‹ç¯‰ã™ã‚‹ã‚ˆã†ã«ã—ï¼Œã€ã‚¿ãƒ¼ã‚²ãƒƒãƒˆã‚°ãƒ«ãƒ¼ãƒ— â†’ ALB/NLB â†’ ãƒªã‚¹ãƒŠãƒ¼ â†’ ECSã‚µãƒ¼ãƒ“ã‚¹ã€ã®é †ã§ãƒªã‚½ãƒ¼ã‚¹ã‚’æ§‹ç¯‰ã§ãã‚‹ã‚ˆã†ã«ã™ã‚‹ï¼ å‚è€ƒï¼šhttps://github.com/hashicorp/terraform/issues/12634#issuecomment-313215022 ï¼ˆï¼”ï¼‰AutoScalingã«ã‚ˆã‚‹ã‚¿ã‚¹ã‚¯æ•°ã®å¢—æ¸›ã‚’ç„¡è¦– AutoScalingã«ã‚ˆã£ã¦ï¼Œã‚¿ã‚¹ã‚¯æ•°ãŒå¢—æ¸›ã™ã‚‹ãŸã‚ï¼Œã“ã‚Œã‚’ç„¡è¦–ã™ã‚‹ï¼ ï¼ˆâ€»ï¼‰ã‚¿ã‚¹ã‚¯å®šç¾©ã®æ›´æ–° Terraformã§ã‚¿ã‚¹ã‚¯å®šç¾©ã‚’æ›´æ–°ã™ã‚‹ã¨ï¼Œç¾åœ¨å‹•ã„ã¦ã„ã‚‹ECSã§ç¨¼åƒã—ã¦ã„ã‚‹ã‚¿ã‚¹ã‚¯ã¯ãã®ã¾ã¾ã«ï¼Œæ–°ã—ã„ãƒªãƒ“ã‚¸ãƒ§ãƒ³ç•ªå·ã®ã‚¿ã‚¹ã‚¯å®šç¾©ãŒä½œæˆã•ã‚Œã‚‹ï¼ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ç”»é¢ã®ã€Œæ–°ã—ã„ãƒªãƒ“ã‚¸ãƒ§ãƒ³ã®ä½œæˆã€ã¨åŒã˜æŒ™å‹•ã§ã‚ã‚‹ï¼å®Ÿéš›ã«ã‚¿ã‚¹ã‚¯ãŒå¢—ãˆã¦ã„ã‚‹ã“ã¨ã¯ï¼Œã‚µãƒ¼ãƒ“ã‚¹ã«ç´ä»˜ãã‚¿ã‚¹ã‚¯å®šç¾©ä¸€è¦§ã‹ã‚‰ç¢ºèªã§ãã‚‹ï¼æ¬¡ã®ãƒ‡ãƒ—ãƒ­ã‚¤æ™‚ã«ï¼Œã“ã®ã‚¿ã‚¹ã‚¯ãŒç”¨ã„ã‚‰ã‚Œã‚‹ï¼ ï¼ˆâ€»ï¼‰ã‚µãƒ¼ãƒ“ã‚¹ã®ãƒ‡ãƒ—ãƒ­ã‚¤ã®å‰Šé™¤æ™‚é–“ ECSã‚µãƒ¼ãƒ“ã‚¹ã®å‰Šé™¤ã«ã¯ã€ãƒ‰ãƒ¬ã‚¤ãƒ‹ãƒ³ã‚°ã€ã®æ™‚é–“ãŒç™ºç”Ÿã™ã‚‹ï¼ç´„2åˆ†30ç§’ã‹ã‹ã‚‹ãŸã‚ï¼Œæ°—é•·ã«å¾…ã¤ã“ã¨ï¼ ï¼ˆâ€»ï¼‰ãƒ­ãƒ¼ãƒªãƒ³ã‚°ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆ applyã§ï¼Œæ–°ã—ã„ãƒªãƒ“ã‚¸ãƒ§ãƒ³ç•ªå·ã®ã‚¿ã‚¹ã‚¯å®šç¾©ã‚’ä½œæˆã™ã‚‹ã¨ï¼Œã“ã‚Œã‚’ç”¨ã„ã¦ãƒ­ãƒ¼ãƒªãƒ³ã‚°ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆãŒè‡ªå‹•ã§å®Ÿè¡Œã•ã‚Œã‚‹ã“ã¨ã«æ³¨æ„ã™ã‚‹ï¼ãŸã ï¼Œãƒ­ãƒ¼ãƒªãƒ³ã‚°ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆã®ä»•çµ„ã¿ä¸Šï¼Œæ–°ã—ã„ã‚¿ã‚¹ã‚¯ã®ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯ãŒå¤±æ•—ã™ã‚Œã°ï¼Œæ—¢å­˜ã®ã‚¿ã‚¹ã‚¯ã¯åœæ­¢ã›ãšã«ãã®ã¾ã¾ç¨¼åƒã™ã‚‹ãŸã‚ï¼Œå®‰å¿ƒã§ã¯ã‚ã‚‹ãŒï¼ 06. EC2 ã¾ã¨ã‚ ï¼Šå®Ÿè£…ä¾‹ï¼Š ############################################### # For bastion ############################################### resource \"aws_instance\" \"bastion\" { ami = \"*****\" instance_type = \"t2.micro\" vpc_security_group_ids = [\"*****\"] subnet_id = \"*****\" associate_public_ip_address = true # â€»å¾Œè¿°ã®èª¬æ˜ã‚’å‚è€ƒã«ã›ã‚ˆï¼ˆï¼‘ï¼‰ key_name = \"prd-foo-bastion\" disable_api_termination = true tags = { Name = \"prd-foo-bastion\" } # â€»å¾Œè¿°ã®èª¬æ˜ã‚’å‚è€ƒã«ã›ã‚ˆï¼ˆï¼’ï¼‰ depends_on = [var.internet_gateway] } ï¼ˆï¼‘ï¼‰ã‚­ãƒ¼ãƒšã‚¢ã¯ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ä¸Šã§è¨­å®š èª¤ã£ã¦å‰Šé™¤ã—ãªã„ã‚ˆã†ã«ï¼Œã¾ãŸã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã«æ©Ÿå¯†æƒ…å ±ã‚’ãƒãƒ¼ãƒ‰ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã—ãªã„ã‚ˆã†ã«ï¼Œã‚­ãƒ¼ãƒšã‚¢ã¯ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ç”»é¢ã§ä½œæˆã—ãŸå¾Œï¼Œkey_nameã§ã‚­ãƒ¼åã‚’æŒ‡å®šã™ã‚‹ã‚ˆã†ã«ã™ã‚‹ï¼ ï¼ˆï¼’ï¼‰ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆã‚²ãƒ¼ãƒˆã‚¦ã‚§ã‚¤ã®å¾Œã«æ§‹ç¯‰ ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆã‚²ãƒ¼ãƒˆã‚¦ã‚§ã‚¤ã®å¾Œã«EC2ã‚’æ§‹ç¯‰ã§ãã‚‹ã‚ˆã†ã«ã™ã‚‹ï¼ å‚è€ƒï¼šhttps://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/internet_gateway#argument-reference 07. IAMãƒ¦ãƒ¼ã‚¶ ã‚«ã‚¹ã‚¿ãƒãƒ¼ç®¡ç†ãƒãƒªã‚·ãƒ¼ã‚’æŒã¤ãƒ­ãƒ¼ãƒ« äº‹å‰ã«ï¼Œtplå½¢å¼ã®ã‚«ã‚¹ã‚¿ãƒãƒ¼ç®¡ç†ãƒãƒªã‚·ãƒ¼ã‚’å®šç¾©ã—ã¦ãŠãï¼æ§‹ç¯‰æ¸ˆã¿ã®IAMãƒ­ãƒ¼ãƒ«ã«ï¼Œaws_iam_policyãƒªã‚½ãƒ¼ã‚¹ã‚’ä½¿ç”¨ã—ã¦ï¼ŒAWSç®¡ç†ãƒãƒªã‚·ãƒ¼ã‚’IAMãƒ¦ãƒ¼ã‚¶ã«ã‚¢ã‚¿ãƒƒãƒã™ã‚‹ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š ãƒ­ãƒ¼ã‚«ãƒ«ã‹ã‚‰AWS CLIã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã™ã‚‹å¿…è¦ãŒã‚ã‚‹å ´åˆã«ï¼Œã‚³ãƒãƒ³ãƒ‰ã‚’ç‰¹å®šã®é€ä¿¡å…ƒIPã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’ç‰¹å®šã®ã‚‚ã®ã«é™å®šã™ã‚‹ï¼äº‹å‰ã«ï¼Œlistå‹ã§IPã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’å®šç¾©ã™ã‚‹ï¼ ############################################### # IP addresses ############################################### global_ip_addresses = [ \"nn.nnn.nnn.nnn/32\", \"nn.nnn.nnn.nnn/32\" ] ã¾ãŸäº‹å‰ã«ï¼ŒæŒ‡å®šã—ãŸé€ä¿¡å…ƒIPã‚¢ãƒ‰ãƒ¬ã‚¹ä»¥å¤–ã‚’æ‹’å¦ã™ã‚‹ã‚«ã‚¹ã‚¿ãƒãƒ¼ç®¡ç†ãƒãƒªã‚·ãƒ¼ã‚’å®šç¾©ã™ã‚‹ï¼ { \"Version\": \"2012-10-17\", \"Statement\": { \"Effect\": \"Deny\", \"Action\": \"*\", \"Resource\": \"*\", \"Condition\": { \"NotIpAddress\": { \"aws:SourceIp\": ${global_ip_addresses} } } } } ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ç”»é¢ã§ä½œæˆæ¸ˆã¿ã®IAMãƒ¦ãƒ¼ã‚¶ã®åå‰ã‚’å–å¾—ã™ã‚‹ï¼tplå½¢å¼ã®ãƒãƒªã‚·ãƒ¼ã«listå‹ã®å€¤ã‚’æ¸¡ã™æ™‚ï¼Œjsonencodeé–¢æ•°ã‚’ä½¿ç”¨ã™ã‚‹å¿…è¦ãŒã‚ã‚‹ï¼ ############################################### # For IAM User ############################################### data \"aws_iam_user\" \"aws_cli_command_executor\" { user_name = \"aws_cli_command_executor\" } resource \"aws_iam_policy\" \"aws_cli_command_executor_ip_address_restriction\" { name = \"prd-aws-cli-command-executor-ip-address-restriction-policy\" description = \"Allow global IP addresses\" policy = templatefile( \"${path.module}/policies/customer_managed_policies/aws_cli_command_executor_ip_address_restriction_policy.tpl\", { global_ip_addresses = jsonencode(var.global_ip_addresses) } ) } AWSç®¡ç†ãƒãƒªã‚·ãƒ¼ IAMãƒ¦ãƒ¼ã‚¶ã«AWSç®¡ç†ãƒãƒªã‚·ãƒ¼ã‚’ã‚¢ã‚¿ãƒƒãƒã™ã‚‹ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š ############################################### # For IAM User ############################################### resource \"aws_iam_user_policy_attachment\" \"aws_cli_command_executor_s3_read_only_access\" { user = data.aws_iam_user.aws_cli_command_executor.user_name policy_arn = \"arn:aws:iam::aws:policy/AmazonS3ReadOnlyAccess\" } 08. IAMãƒ­ãƒ¼ãƒ« ä¿¡é ¼ãƒãƒªã‚·ãƒ¼ã‚’æŒã¤ãƒ­ãƒ¼ãƒ« ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ç”»é¢ã§ãƒ­ãƒ¼ãƒ«ã‚’ä½œæˆã™ã‚‹å ´åˆã¯æ„è­˜ã™ã‚‹ã“ã¨ã¯ãªã„ãŒï¼Œç‰¹å®šã®ãƒªã‚½ãƒ¼ã‚¹ã«ãƒ­ãƒ¼ãƒ«ã‚’ã‚¢ã‚¿ãƒƒãƒã™ã‚‹ãŸã‚ã«ã¯ï¼Œãƒ­ãƒ¼ãƒ«ã«ä¿¡é ¼ãƒãƒªã‚·ãƒ¼ã‚’çµ„ã¿è¾¼ã‚€å¿…è¦ãŒã‚ã‚‹ï¼äº‹å‰ã«ï¼Œtplå½¢å¼ã®ä¿¡é ¼ãƒãƒªã‚·ãƒ¼ã‚’å®šç¾©ã—ã¦ãŠãï¼aws_iam_roleãƒªã‚½ãƒ¼ã‚¹ã‚’ä½¿ç”¨ã—ã¦ï¼ŒIAMãƒ­ãƒ¼ãƒ«ã‚’æ§‹ç¯‰ã™ã‚‹ã¨åŒæ™‚ã«ï¼Œã“ã‚Œã«ä¿¡é ¼ãƒãƒªã‚·ãƒ¼ã‚’ã‚¢ã‚¿ãƒƒãƒã™ã‚‹ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š äº‹å‰ã«ï¼ŒECSã‚¿ã‚¹ã‚¯ã®ãŸã‚ã®ä¿¡é ¼ãƒãƒªã‚·ãƒ¼ã‚’å®šç¾©ã™ã‚‹ï¼ { \"Version\": \"2012-10-17\", \"Statement\": [ { \"Effect\": \"Allow\", \"Principal\": { \"Service\": \"ecs-tasks.amazonaws.com\" }, \"Action\": \"sts:AssumeRole\" } ] } ECSã‚¿ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã¨ECSã‚¿ã‚¹ã‚¯å®Ÿè¡Œãƒ­ãƒ¼ãƒ«ã«ä¿¡é ¼ãƒãƒªã‚·ãƒ¼ã‚¢ã‚¿ãƒƒãƒã™ã‚‹ï¼ ############################################### # IAM Role For ECS Task Execution ############################################### resource \"aws_iam_role\" \"ecs_task_execution\" { name = \"prd-foo-ecs-task-execution-role\" description = \"The role for prd-foo-ecs-task\" assume_role_policy = templatefile( \"${path.module}/policies/trust_policies/ecs_task_policy.tpl\", {} ) } ############################################### # IAM Role For ECS Task ############################################### resource \"aws_iam_role\" \"ecs_task\" { name = \"prd-foo-ecs-task-role\" description = \"The role for prd-foo-ecs-task\" assume_role_policy = templatefile( \"${path.module}/policies/trust_policies/ecs_task_policy.tpl\", {} ) } ï¼Šå®Ÿè£…ä¾‹ï¼Š äº‹å‰ã«ï¼ŒLambda@Edgeã®ãŸã‚ã®ä¿¡é ¼ãƒãƒªã‚·ãƒ¼ã‚’å®šç¾©ã™ã‚‹ï¼ { \"Version\": \"2012-10-17\", \"Statement\": [ { \"Sid\": \"\", \"Effect\": \"Allow\", \"Principal\": { \"Service\": [ \"lambda.amazonaws.com\", \"edgelambda.amazonaws.com\" ] }, \"Action\": \"sts:AssumeRole\" } ] } Lambdaå®Ÿè¡Œãƒ­ãƒ¼ãƒ«ã«ä¿¡é ¼ãƒãƒªã‚·ãƒ¼ã‚¢ã‚¿ãƒƒãƒã™ã‚‹ï¼ ############################################### # IAM Role For Lambda@Edge ############################################### # ãƒ­ãƒ¼ãƒ«ã«ä¿¡é ¼ãƒãƒªã‚·ãƒ¼ã‚’ã‚¢ã‚¿ãƒƒãƒã—ã¾ã™ï¼ resource \"aws_iam_role\" \"lambda_execute\" { name = \"prd-foo-lambda-execute-role\" assume_role_policy = templatefile( \"${path.module}/policies/lambda_execute_role_trust_policy.tpl\", {} ) } ã‚¤ãƒ³ãƒ©ã‚¤ãƒ³ãƒãƒªã‚·ãƒ¼ã‚’æŒã¤ãƒ­ãƒ¼ãƒ« äº‹å‰ã«ï¼Œtplå½¢å¼ã®ã‚¤ãƒ³ãƒ©ã‚¤ãƒ³ãƒãƒªã‚·ãƒ¼ã‚’å®šç¾©ã—ã¦ãŠãï¼aws_iam_role_policyãƒªã‚½ãƒ¼ã‚¹ã‚’ä½¿ç”¨ã—ã¦ï¼Œã‚¤ãƒ³ãƒ©ã‚¤ãƒ³ãƒãƒªã‚·ãƒ¼ã‚’æ§‹ç¯‰ã™ã‚‹ã¨åŒæ™‚ã«ï¼Œã“ã‚Œã«ã‚¤ãƒ³ãƒ©ã‚¤ãƒ³ãƒãƒªã‚·ãƒ¼ã‚’ã‚¢ã‚¿ãƒƒãƒã™ã‚‹ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š äº‹å‰ã«ï¼ŒECSã‚¿ã‚¹ã‚¯ã«å¿…è¦æœ€ä½é™ã®æ¨©é™ã‚’ä¸ãˆã‚‹ã‚¤ãƒ³ãƒ©ã‚¤ãƒ³ãƒãƒªã‚·ãƒ¼ã‚’å®šç¾©ã™ã‚‹ï¼ { \"Version\": \"2012-10-17\", \"Statement\": [ { \"Effect\": \"Allow\", \"Action\": [ \"ssm:GetParameters\" ], \"Resource\": \"*\" } ] } ECSã‚¿ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã¨ECSã‚¿ã‚¹ã‚¯å®Ÿè¡Œãƒ­ãƒ¼ãƒ«ã«ã‚¤ãƒ³ãƒ©ã‚¤ãƒ³ãƒãƒªã‚·ãƒ¼ã‚¢ã‚¿ãƒƒãƒã™ã‚‹ï¼ ############################################### # IAM Role For ECS Task ############################################### resource \"aws_iam_role_policy\" \"ecs_task\" { name = \"prd-foo-ssm-read-only-access-policy\" role = aws_iam_role.ecs_task_execution.id policy = templatefile( \"${path.module}/policies/inline_policies/ecs_task_policy.tpl\", {} ) } AWSç®¡ç†ãƒãƒªã‚·ãƒ¼ã‚’æŒã¤ãƒ­ãƒ¼ãƒ« äº‹å‰ã«ï¼Œtplå½¢å¼ã®AWSç®¡ç†ãƒãƒªã‚·ãƒ¼ã‚’å®šç¾©ã—ã¦ãŠãï¼aws_iam_role_policy_attachmentãƒªã‚½ãƒ¼ã‚¹ã‚’ä½¿ç”¨ã—ã¦ï¼Œå®Ÿã‚¤ãƒ³ãƒ•ãƒ©ã«ã‚ã‚‹AWSç®¡ç†ãƒãƒªã‚·ãƒ¼ã‚’æ§‹ç¯‰æ¸ˆã¿ã®IAMãƒ­ãƒ¼ãƒ«ã«ã‚¢ã‚¿ãƒƒãƒã™ã‚‹ï¼ãƒãƒªã‚·ãƒ¼ã®ARNã¯ï¼ŒAWSã®ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ç”»é¢ã‚’ç¢ºèªã™ã‚‹ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š ############################################### # IAM Role For ECS Task Execution ############################################### resource \"aws_iam_role_policy_attachment\" \"ecs_task_execution\" { role = aws_iam_role.ecs_task_execution.name policy_arn = \"arn:aws:iam::aws:policy/service-role/AmazonECSTaskExecutionRolePolicy\" } ã‚«ã‚¹ã‚¿ãƒãƒ¼ç®¡ç†ãƒãƒªã‚·ãƒ¼ã‚’æŒã¤ãƒ­ãƒ¼ãƒ« äº‹å‰ã«ï¼Œtplå½¢å¼ã®ã‚¤ãƒ³ãƒ©ã‚¤ãƒ³ãƒãƒªã‚·ãƒ¼ã‚’å®šç¾©ã—ã¦ãŠãï¼aws_iam_role_policyãƒªã‚½ãƒ¼ã‚¹ã‚’ä½¿ç”¨ã—ã¦ï¼Œã‚«ã‚¹ã‚¿ãƒãƒ¼ç®¡ç†ãƒãƒªã‚·ãƒ¼ã‚’æ§‹ç¯‰ã™ã‚‹ï¼aws_iam_role_policy_attachmentãƒªã‚½ãƒ¼ã‚¹ã‚’ä½¿ç”¨ã—ã¦ï¼Œã‚«ã‚¹ã‚¿ãƒãƒ¼ç®¡ç†ãƒãƒªã‚·ãƒ¼ã‚’æ§‹ç¯‰æ¸ˆã¿ã®IAMãƒ­ãƒ¼ãƒ«ã«ã‚¢ã‚¿ãƒƒãƒã™ã‚‹ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š äº‹å‰ã«ï¼ŒECSã‚¿ã‚¹ã‚¯ã«å¿…è¦æœ€ä½é™ã®æ¨©é™ã‚’ä¸ãˆã‚‹ã‚«ã‚¹ã‚¿ãƒãƒ¼ç®¡ç†ãƒãƒªã‚·ãƒ¼ã‚’å®šç¾©ã™ã‚‹ï¼ { \"Version\": \"2012-10-17\", \"Statement\": [ { \"Effect\": \"Allow\", \"Action\": [ \"logs:CreateLogStream\", \"logs:PutLogEvents\" ], \"Resource\": [ \"arn:aws:logs:*:*:*\" ] } ] } ECSã‚¿ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã«ã‚«ã‚¹ã‚¿ãƒãƒ¼ç®¡ç†ãƒãƒªã‚·ãƒ¼ã‚¢ã‚¿ãƒƒãƒã™ã‚‹ï¼ ############################################### # IAM Role For ECS Task ############################################### resource \"aws_iam_policy\" \"ecs_task\" { name = \"prd-foo-cloudwatch-logs-access-policy\" description = \"Provides access to CloudWatch Logs\" policy = templatefile( \"${path.module}/policies/customer_managed_policies/cloudwatch_logs_access_policy.tpl\", {} ) } resource \"aws_iam_role_policy_attachment\" \"ecs_task\" { role = aws_iam_role.ecs_task.name policy_arn = aws_iam_policy.ecs_task.arn } ã‚µãƒ¼ãƒ“ã‚¹ãƒªãƒ³ã‚¯ãƒ­ãƒ¼ãƒ« ã‚µãƒ¼ãƒ“ã‚¹ãƒªãƒ³ã‚¯ãƒ­ãƒ¼ãƒ«ã¯ï¼ŒAWSãƒªã‚½ãƒ¼ã‚¹ã®æ§‹ç¯‰æ™‚ã«è‡ªå‹•çš„ã«ä½œæˆã•ã‚Œï¼Œã‚¢ã‚¿ãƒƒãƒã•ã‚Œã‚‹ï¼ãã®ãŸã‚ï¼ŒTerraformã®ç®¡ç†å¤–ã§ã‚ã‚‹ï¼aws_iam_service_linked_roleãƒªã‚½ãƒ¼ã‚¹ã‚’ä½¿ç”¨ã—ã¦ï¼Œæ‰‹å‹•ã§æ§‹ç¯‰ã™ã‚‹ã“ã¨ãŒå¯èƒ½ã§ã‚ã‚‹ãŒï¼Œæ•°ãŒå¤šãå®Ÿè£…ã®è² æ‹…ã«ã‚‚ãªã‚‹ãŸã‚ï¼Œã‚ãˆã¦ç®¡ç†å¤–ã¨ã—ã¦ã‚‚å•é¡Œãªã„ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š ã‚µãƒ¼ãƒ“ã‚¹åã‚’æŒ‡å®šã—ã¦ï¼ŒApplication Auto Scalingã®ã‚µãƒ¼ãƒ“ã‚¹ãƒªãƒ³ã‚¯ãƒ­ãƒ¼ãƒ«ã‚’æ§‹ç¯‰ã™ã‚‹ï¼ ############################################### # IAM Role For ECS Service ############################################### # Service Linked Role resource \"aws_iam_service_linked_role\" \"ecs_service_auto_scaling\" { aws_service_name = \"ecs.application-autoscaling.amazonaws.com\" } ############################################### # Output IAM Role ############################################### output \"ecs_service_auto_scaling_iam_service_linked_role_arn\" { value = aws_iam_service_linked_role.ecs_service_auto_scaling.arn } Application Auto Scalingã«ã‚µãƒ¼ãƒ“ã‚¹ãƒªãƒ³ã‚¯ãƒ­ãƒ¼ãƒ«ã‚’ã‚¢ã‚¿ãƒƒãƒã™ã‚‹ï¼æ‰‹å‹•ã§è¨­å®šã™ã‚‹ã“ã¨ã‚‚å¯èƒ½ã§ã‚ã‚‹ãŒï¼ŒTerraformã®ç®¡ç†å¤–ã§è‡ªå‹•çš„ã«ã‚¢ã‚¿ãƒƒãƒã•ã‚Œã‚‹ãŸã‚ï¼Œã‚ãˆã¦å¦¥å”ã—ã¦ã‚‚è‰¯ã„ï¼ ######################################### # Application Auto Scaling For ECS ######################################### resource \"aws_appautoscaling_target\" \"ecs\" { service_namespace = \"ecs\" resource_id = \"service/prd-foo-ecs-cluster/prd-foo-ecs-service\" scalable_dimension = \"ecs:service:DesiredCount\" max_capacity = 4 min_capacity = 2 # ã“ã®è¨­å®šãŒãªãã¨ã‚‚ï¼Œã‚µãƒ¼ãƒ“ã‚¹ãƒªãƒ³ã‚¯ãƒ­ãƒ¼ãƒ«ãŒè‡ªå‹•çš„ã«æ§‹ç¯‰ã•ã‚Œï¼ŒAutoScalingã«ã‚¢ã‚¿ãƒƒãƒã•ã‚Œã‚‹ï¼ role_arn = var.ecs_service_auto_scaling_iam_service_linked_role_arn } 10. LBãƒªã‚¹ãƒŠãƒ¼ã¨ã‚¿ãƒ¼ã‚²ãƒƒãƒˆã‚°ãƒ«ãƒ¼ãƒ— ã¾ã¨ã‚ ï¼Šå®Ÿè£…ä¾‹ï¼Š ############################################### # NLB target group ############################################### resource \"aws_lb_target_group\" \"this\" { name = \"prd-foo-nlb-tg\" port = 80 protocol = \"TCP\" vpc_id = \"*****\" deregistration_delay = \"60\" target_type = \"ip\" # â€»å¾Œè¿°ã®èª¬æ˜ã‚’å‚è€ƒã«ã›ã‚ˆï¼ˆï¼‘ï¼‰ slow_start = \"0\" # â€»å¾Œè¿°ã®èª¬æ˜ã‚’å‚è€ƒã«ã›ã‚ˆï¼ˆï¼’ï¼‰ health_check { protocol = \"HTTP\" healthy_threshold = 3 path = \"/healthcheck\" } # stickiness â€»å¾Œè¿°ã®èª¬æ˜ã‚’å‚è€ƒã«ã›ã‚ˆï¼ˆï¼“ï¼‰ # https://registry.terraform.io/providers/hashicorp/aws/3.16.0/docs/resources/lb_target_group#stickiness lifecycle { create_before_destroy = false } } ï¼ˆï¼‘ï¼‰NLBã¯ã‚¹ãƒ­ãƒ¼ã‚¹ã‚¿ãƒ¼ãƒˆã«éå¯¾å¿œ NLBã«ç´ä»˜ãã‚¿ãƒ¼ã‚²ãƒƒãƒˆã‚°ãƒ«ãƒ¼ãƒ—ã¯ã‚¹ãƒ­ãƒ¼ã‚¹ã‚¿ãƒ¼ãƒˆã«éå¯¾å¿œã®ãŸã‚ï¼Œã“ã‚Œã‚’æ˜ç¤ºçš„ã«ç„¡åŠ¹åŒ–ã™ã‚‹å¿…è¦ãŒã‚ã‚‹ï¼ ï¼ˆï¼’ï¼‰NLBãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯ã«ã¯è¨­å®šå¯èƒ½ãªé …ç›®ãŒå°‘ãªã„ ã‚¿ãƒ¼ã‚²ãƒƒãƒˆã‚°ãƒ«ãƒ¼ãƒ—ã®è»¢é€ãƒ—ãƒ­ãƒˆã‚³ãƒ«ãŒTCPã®å ´åˆã¯ï¼Œè¨­å®šã§ããªã„ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯ã‚ªãƒ—ã‚·ãƒ§ãƒ³ãŒã„ãã¤ã‹ã‚ã‚‹ï¼ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯ãƒ—ãƒ­ãƒˆã‚³ãƒ«ãŒHTTPã¾ãŸã¯HTTPSã®æ™‚ã®ã¿ï¼Œãƒ‘ã‚¹ã‚’è¨­å®šã§ãã‚‹ï¼ å‚è€ƒï¼šhttps://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/lb_target_group#health_check ï¼ˆï¼“ï¼‰NLBã‚¹ãƒ†ã‚£ãƒƒã‚­ãƒ¼ãƒã‚¹ã¯æ˜ç¤ºçš„ã«ç„¡åŠ¹åŒ– ã‚¹ãƒ†ã‚£ãƒƒã‚­ãƒã‚¹æ©Ÿèƒ½ã‚’ç„¡åŠ¹åŒ–ã™ã‚‹å ´åˆï¼ŒAWSãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼ã®ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰æ™‚ã«å•é¡ŒãŒèµ·ã“ã‚‰ãªã„ã‚ˆã†ã«ï¼Œã“ã®ãƒ–ãƒ­ãƒƒã‚¯ã‚’å®Ÿè£…ã—ãªã„ã‚ˆã†ã«ã™ã‚‹ï¼ãƒªãƒ³ã‚¯å…ˆã®NOTEæ–‡ã‚’å‚è€ƒã«ã›ã‚ˆï¼ å‚è€ƒï¼šhttps://registry.terraform.io/providers/hashicorp/aws/3.16.0/docs/resources/lb_target_group#stickiness ï¼ˆâ€»ï¼‰ã‚¿ãƒ¼ã‚²ãƒƒãƒˆã‚°ãƒ«ãƒ¼ãƒ—ã®å‰Šé™¤æ™‚ã«ãƒªã‚¹ãƒŠãƒ¼ã‚’å…ˆã«å‰Šé™¤ã§ããªã„ï¼ LBãƒªã‚¹ãƒŠãƒ¼ãŒã‚¿ãƒ¼ã‚²ãƒƒãƒˆã‚°ãƒ«ãƒ¼ãƒ—ã«ä¾å­˜ã—ã¦ã„ã‚‹ãŒï¼ŒTerraformãŒã‚¿ãƒ¼ã‚²ãƒƒãƒˆã‚°ãƒ«ãƒ¼ãƒ—ã®å‰Šé™¤æ™‚ã«ãƒªã‚¹ãƒŠãƒ¼ã‚’å…ˆã«å‰Šé™¤ã—ã‚ˆã†ã¨ã—ãªã„ãŸã‚ï¼Œä»¥ä¸‹ã®ã‚ˆã†ãªã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã™ã‚‹ï¼ Error deleting Target Group: ResourceInUse: Target group 'arn:aws:elasticloadbalancing:ap-northeast-1:123456789:targetgroup/xxxxx-tg/xxxxx' is currently in use by a listener or a rule status code: 400, request id: xxxxx ã“ã®ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ãŸå ´åˆï¼Œã‚³ãƒ³ã‚½ãƒ¼ãƒ«ç”»é¢ä¸Šã§LBãƒªã‚¹ãƒŠãƒ¼ã‚’å‰Šé™¤ã—ãŸã†ãˆã§ï¼Œã‚‚ã†ä¸€åº¦applyã™ã‚‹ï¼ å‚è€ƒï¼šhttps://github.com/hashicorp/terraform-provider-aws/issues/1315#issuecomment-415423529 11. RDS ã¾ã¨ã‚ ï¼Šå®Ÿè£…ä¾‹ï¼Š ######################################### # RDS Cluster ######################################### resource \"aws_rds_cluster\" \"this\" { engine = \"aurora-mysql\" engine_version = \"5.7.mysql_aurora.2.08.3\" cluster_identifier = \"prd-foo-rds-cluster\" # å¾Œè¿°ã®èª¬æ˜ã‚’å‚è€ƒã«ã›ã‚ˆï¼ï¼ˆï¼‘ï¼‰ master_username = var.rds_db_master_username_ssm_parameter_value master_password = var.rds_db_master_password_ssm_parameter_value port = var.rds_db_port_ssm_parameter_value database_name = var.rds_db_name_ssm_parameter_value vpc_security_group_ids = [var.rds_security_group_id] db_subnet_group_name = aws_db_subnet_group.this.name db_cluster_parameter_group_name = aws_rds_cluster_parameter_group.this.id storage_encrypted = true backup_retention_period = 7 preferred_backup_window = \"00:00-00:30\" copy_tags_to_snapshot = true final_snapshot_identifier = \"final-db-snapshot\" skip_final_snapshot = false enabled_cloudwatch_logs_exports = [\"audit\", \"error\", \"general\", \"slowquery\"] preferred_maintenance_window = \"sun:01:00-sun:01:30\" # å¾Œè¿°ã®èª¬æ˜ã‚’å‚è€ƒã«ã›ã‚ˆï¼ï¼ˆï¼’ï¼‰ apply_immediately = true # å¾Œè¿°ã®èª¬æ˜ã‚’å‚è€ƒã«ã›ã‚ˆï¼ï¼ˆï¼“ï¼‰ availability_zones = [\"${var.region}${var.vpc_availability_zones.a}\", \"${var.region}${var.vpc_availability_zones.c}\"] deletion_protection = true lifecycle { ignore_changes = [ # å¾Œè¿°ã®èª¬æ˜ã‚’å‚è€ƒã«ã›ã‚ˆï¼ï¼ˆï¼”ï¼‰ availability_zones ] } } ############################################### # RDS Cluster Instance ############################################### resource \"aws_rds_cluster_instance\" \"this\" { for_each = var.vpc_availability_zones engine = \"aurora-mysql\" engine_version = \"5.7.mysql_aurora.2.08.3\" identifier = \"prd-foo-rds-instance-${each.key}\" cluster_identifier = aws_rds_cluster.this.id instance_class = var.rds_instance_class db_subnet_group_name = aws_db_subnet_group.this.id db_parameter_group_name = aws_db_parameter_group.this.id monitoring_interval = 60 monitoring_role_arn = var.rds_iam_role_arn auto_minor_version_upgrade = var.rds_auto_minor_version_upgrade preferred_maintenance_window = \"sun:01:00-sun:01:30\" apply_immediately = true # å¾Œè¿°ã®èª¬æ˜ã‚’å‚è€ƒã«ã›ã‚ˆï¼ï¼ˆï¼•ï¼‰ # preferred_backup_window } ï¼ˆï¼‘ï¼‰SSMãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚¹ãƒˆã‚¢ Terraformã«å€¤ã‚’ãƒãƒ¼ãƒ‰ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã—ãŸããªã„å ´åˆã¯ï¼ŒSSMãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚¹ãƒˆã‚¢ã§å€¤ã‚’ç®¡ç†ã—ï¼Œã“ã‚Œã‚’ãƒ‡ãƒ¼ã‚¿ãƒªã‚½ãƒ¼ã‚¹ã§å–å¾—ã™ã‚‹ã‚ˆã†ã«ã™ã‚‹ï¼ ï¼ˆï¼’ï¼‰ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ã‚¦ã‚¤ãƒ³ãƒ‰ã‚¦æ™‚ã«å¤‰æ›´é©ç”¨ ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ã‚¦ã‚¤ãƒ³ãƒ‰ã‚¦æ™‚ã®å¤‰æ›´é©ç”¨ã‚’Terraformã§è¡Œã†å ´åˆï¼Œä¸€æ®µéšç›®ã«apply_immediatelyã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’falseã«å¤‰æ›´ã—ã¦applyã—ï¼ŒäºŒæ®µéšç›®ã«ä¿®æ­£ã‚’applyã™ã‚‹ï¼ ï¼ˆï¼“ï¼‰ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ã«ã¯AZãŒï¼“ã¤å¿…è¦ ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ã§ã¯ï¼Œãƒ¬ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ãŸã‚ã«ï¼Œï¼“ã¤ã®AZãŒå¿…è¦ã§ã‚ã‚‹ï¼ãã®ãŸã‚ï¼ŒæŒ‡å®šã—ãŸAZãŒï¼’ã¤ã§ã‚ã£ã¦ã‚‚ï¼Œã‚³ãƒ³ã‚½ãƒ¼ãƒ«ç”»é¢ä¸Šã§ï¼“ã¤ã®AZãŒè‡ªå‹•çš„ã«è¨­å®šã•ã‚Œã‚‹ï¼TerraformãŒã“ã‚Œã‚’èªè­˜ã—ãªã„ã‚ˆã†ã«ï¼Œignore_changesã§AZã‚’æŒ‡å®šã—ã¦ãŠãå¿…è¦ãŒã‚ã‚‹ï¼ å‚è€ƒï¼š https://github.com/hashicorp/terraform-provider-aws/issues/7307#issuecomment-457441633 https://github.com/hashicorp/terraform-provider-aws/issues/1111 ï¼ˆï¼”ï¼‰ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’é…ç½®ã™ã‚‹AZã¯é¸ã¹ãªã„ äº‹å‰ã«ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã«AZã‚’è¡¨ã™è­˜åˆ¥å­ã‚’å…¥ã‚ŒãŸã¨ã—ã¦ã‚‚ï¼ŒTerraformã¯ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’é…ç½®ã™ã‚‹AZã‚’é¸ã¹ãªã„ï¼ãã®ãŸã‚ï¼ŒAZã¨è­˜åˆ¥å­ã®é–¢ä¿‚ãŒé€†ã«ãªã£ã¦ã—ã¾ã†ã“ã¨ãŒã‚ã‚‹ï¼å¤šãã®å ´åˆï¼Œ Cã‚¾ãƒ¼ãƒ³ã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ãŒæœ€åˆã«æ§‹ç¯‰ã•ã‚Œã‚‹ãŸã‚ï¼Œã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã®ã‚¾ãƒ¼ãƒ³åã¨é…ç½®ã•ã‚Œã‚‹A/Cã‚¾ãƒ¼ãƒ³ãŒé€†ã«ãªã‚‹ï¼ãã®å ´åˆã¯ï¼Œãƒ‡ãƒ—ãƒ­ã‚¤å¾Œã«æ‰‹å‹•ã§åå‰ã‚’å¤‰æ›´ã™ã‚Œã°ã‚ˆã„ï¼ã“ã®å¤‰æ›´ã¯ï¼ŒTerraformãŒå·®åˆ†ã¨ã—ã¦èªè­˜ã—ãªã„ã®ã§å•é¡Œãªã„ï¼ ï¼ˆï¼•ï¼‰ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã«ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã‚¦ã‚¤ãƒ³ãƒ‰ã‚¦ã¯è¨­å®šã—ãªã„ ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ã¨ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã®ä¸¡æ–¹ã«ï¼Œpreferred_backup_windowã‚’è¨­å®šã§ãã‚‹ãŒï¼ŒRDSã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã«è¨­å®šã—ã¦ã¯ã„ã‘ãªã„ï¼ 12. Route53 ã¾ã¨ã‚ ï¼Šå®Ÿè£…ä¾‹ï¼Š ############################################### # For foo domain ############################################### resource \"aws_route53_zone\" \"foo\" { name = var.route53_domain_foo } resource \"aws_route53_record\" \"foo\" { zone_id = aws_route53_zone.foo.id name = var.route53_domain_foo type = \"A\" alias { name = var.alb_dns_name zone_id = var.alb_zone_id evaluate_target_health = false } } 13. Route Table ãƒ¡ã‚¤ãƒ³ãƒ«ãƒ¼ãƒˆãƒ†ãƒ¼ãƒ–ãƒ«ã¯è‡ªå‹•æ§‹ç¯‰ Terraformã‚’ç”¨ã„ã¦VPCã‚’æ§‹ç¯‰ã—ãŸæ™‚ï¼Œãƒ¡ã‚¤ãƒ³ãƒ«ãƒ¼ãƒˆãƒ†ãƒ¼ãƒ–ãƒ«ãŒè‡ªå‹•çš„ã«æ§‹ç¯‰ã•ã‚Œã‚‹ï¼ãã®ãŸã‚ï¼Œã“ã‚Œã¯Terraformã®ç®¡ç†å¤–ã§ã‚ã‚‹ï¼ 14. S3 ãƒã‚±ãƒƒãƒˆãƒãƒªã‚·ãƒ¼ S3ã‚¢ã‚¿ãƒƒãƒã•ã‚Œã‚‹ï¼Œè‡ªèº«ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹ã‚’åˆ¶å¾¡ã™ã‚‹ãŸã‚ã«ã‚¤ãƒ³ãƒ©ã‚¤ãƒ³ãƒãƒªã‚·ãƒ¼ã®ã“ã¨ï¼è©³ã—ãã¯ï¼ŒAWSã®ãƒãƒ¼ãƒˆã‚’å‚ç…§ã›ã‚ˆï¼å®šç¾©ã—ãŸãƒã‚±ãƒƒãƒˆãƒãƒªã‚·ãƒ¼ã¯ï¼Œaws_s3_bucket_policyã§ãƒ­ãƒ¼ãƒ«ã«ã‚¢ã‚¿ãƒƒãƒã§ãã‚‹ï¼ ALBã‚¢ã‚¯ã‚»ã‚¹ãƒ­ã‚° ALBãŒãƒã‚±ãƒƒãƒˆã«ãƒ­ã‚°ã‚’æ›¸ãè¾¼ã‚ã‚‹ã‚ˆã†ã«ï¼Œã€ELBã®ã‚µãƒ¼ãƒ“ã‚¹ã‚¢ã‚«ã‚¦ãƒ³ãƒˆIDã€ã‚’è¨±å¯ã™ã‚‹å¿…è¦ãŒã‚ã‚‹ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š ############################################### # S3 bucket policy ############################################### # S3ã«ãƒã‚±ãƒƒãƒˆãƒãƒªã‚·ãƒ¼ã‚’ã‚¢ã‚¿ãƒƒãƒã—ã¾ã™ï¼ resource \"aws_s3_bucket_policy\" \"alb\" { bucket = aws_s3_bucket.alb_logs.id policy = templatefile( \"${path.module}/policies/alb_bucket_policy.tpl\", {} ) } ALBã®ã‚¢ã‚¯ã‚»ã‚¹ãƒ­ã‚°ã‚’é€ä¿¡ã™ã‚‹ãƒã‚±ãƒƒãƒˆå†…ã«ã¯ï¼Œè‡ªå‹•çš„ã«ã€/AWSLogs/ã€ã®åå‰ã§ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªãŒç”Ÿæˆã•ã‚Œã‚‹ï¼ãã®ãŸã‚ï¼Œã€arn:aws:s3:::/*ã€ã®éƒ¨åˆ†ã‚’æœ€å°æ¨©é™ã¨ã—ã¦ï¼Œã€arn:aws:s3:::/AWSLogs//;*ã€ã«ã—ã¦ã‚‚ã‚ˆã„ï¼æ±äº¬ãƒªãƒ¼ã‚¸ãƒ§ãƒ³ã®ELBã‚µãƒ¼ãƒ“ã‚¹ã‚¢ã‚«ã‚¦ãƒ³ãƒˆIDã¯ï¼Œã€582318560864ã€ã§ã‚ã‚‹ï¼ å‚è€ƒï¼šhttps://docs.aws.amazon.com/ja_jp/elasticloadbalancing/latest/application/load-balancer-access-logs.html#access-logging-bucket-permissions { \"Version\": \"2012-10-17\", \"Statement\": [ { \"Effect\": \"Allow\", \"Principal\": { \"AWS\": \"arn:aws:iam::582318560864:root\" }, \"Action\": \"s3:PutObject\", \"Resource\": \"arn:aws:s3:::/*\" } ] } NLBã‚¢ã‚¯ã‚»ã‚¹ãƒ­ã‚° ALBãŒãƒã‚±ãƒƒãƒˆã«ãƒ­ã‚°ã‚’æ›¸ãè¾¼ã‚ã‚‹ã‚ˆã†ã«ï¼Œã€delivery.logs.amazonaws.comã€ã‹ã‚‰ã®ã‚¢ã‚¯ã‚»ã‚¹ã‚’è¨±å¯ã™ã‚‹å¿…è¦ãŒã‚ã‚‹ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š ############################################### # S3 bucket policy ############################################### # S3ã«ãƒã‚±ãƒƒãƒˆãƒãƒªã‚·ãƒ¼ã‚’ã‚¢ã‚¿ãƒƒãƒã—ã¾ã™ï¼ resource \"aws_s3_bucket_policy\" \"nlb\" { bucket = aws_s3_bucket.nlb_logs.id policy = templatefile( \"${path.module}/policies/nlb_bucket_policy.tpl\", {} ) } NLBã®ã‚¢ã‚¯ã‚»ã‚¹ãƒ­ã‚°ã‚’é€ä¿¡ã™ã‚‹ãƒã‚±ãƒƒãƒˆå†…ã«ã¯ï¼Œè‡ªå‹•çš„ã«ã€/AWSLogs/ã€ã®åå‰ã§ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªãŒç”Ÿæˆã•ã‚Œã‚‹ï¼ãã®ãŸã‚ï¼Œã€arn:aws:s3:::/*ã€ã®éƒ¨åˆ†ã‚’æœ€å°æ¨©é™ã¨ã—ã¦ï¼Œã€arn:aws:s3:::/AWSLogs//;*ã€ã«ã—ã¦ã‚‚ã‚ˆã„ï¼ { \"Version\": \"2012-10-17\", \"Statement\": [ { \"Sid\": \"AWSLogDeliveryWrite\", \"Effect\": \"Allow\", \"Principal\": { \"Service\": \"delivery.logs.amazonaws.com\" }, \"Action\": \"s3:PutObject\", \"Resource\": \"arn:aws:s3:::/*\", \"Condition\": { \"StringEquals\": { \"s3:x-amz-acl\": \"bucket-owner-full-control\" } } }, { \"Sid\": \"AWSLogDeliveryAclCheck\", \"Effect\": \"Allow\", \"Principal\": { \"Service\": \"delivery.logs.amazonaws.com\" }, \"Action\": \"s3:GetBucketAcl\", \"Resource\": \"arn:aws:s3:::\" } ] } 15. WAF ruleãƒ–ãƒ­ãƒƒã‚¯ ï¼Šå®Ÿè£…ä¾‹ï¼Š API Gatewayç”¨ã®WAFã«ï¼Œç‰¹å®šã®ãƒ¦ãƒ¼ã‚¶ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚’æ‹’å¦ã™ã‚‹ãƒ«ãƒ¼ãƒ«ã‚’è¨­å®šã™ã‚‹ï¼ resource \"aws_wafv2_web_acl\" \"api_gateway\" { rule { name = \"block-user-agents\" priority = 0 statement { regex_pattern_set_reference_statement { # åˆ¥ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã®main.tfãƒ•ã‚¡ã‚¤ãƒ«ã«åˆ†å‰²ã—ãŸæ­£è¦è¡¨ç¾ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚»ãƒƒãƒˆã‚’å‚ç…§ã™ã‚‹ï¼ arn = var.wafv2_regex_pattern_set_regional_block_user_agents_arn field_to_match { # ãƒ˜ãƒƒãƒ€ãƒ¼ã‚’æ¤œè¨¼ã™ã‚‹ï¼ single_header { name = \"user-agent\" } } text_transformation { priority = 0 type = \"NONE\" } } } action { block {} } visibility_config { cloudwatch_metrics_enabled = true metric_name = \"APIGatewayWAFBlockUserAgentsRule\" sampled_requests_enabled = true } } default_action { allow {} } visibility_config { cloudwatch_metrics_enabled = true metric_name = \"APIGatewayALBWAFRules\" sampled_requests_enabled = true } # ï½ ä¸­ç•¥ ï½ } ï¼Šå®Ÿè£…ä¾‹ï¼Š API Gatewayç”¨ã®WAFã«ï¼Œç‰¹å®šã®ã‚°ãƒ­ãƒ¼ãƒãƒ«IPã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’æ‹’å¦ã™ã‚‹ãƒ«ãƒ¼ãƒ«ã‚’è¨­å®šã™ã‚‹ï¼ resource \"aws_wafv2_web_acl\" \"api_gateway\" { rule { name = \"block-global-ip-addresses\" priority = 0 statement { ip_set_reference_statement { # åˆ¥ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã®main.tfãƒ•ã‚¡ã‚¤ãƒ«ã«åˆ†å‰²ã—ãŸIPã‚¢ãƒ‰ãƒ¬ã‚¹ã‚»ãƒƒãƒˆã‚’å‚ç…§ã™ã‚‹ï¼ arn = var.waf_blocked_global_ip_addresses } } action { block {} } visibility_config { cloudwatch_metrics_enabled = true metric_name = \"APIGatewayWAFBlockGlobalIPAddressesRule\" sampled_requests_enabled = true } } default_action { allow {} } visibility_config { cloudwatch_metrics_enabled = true metric_name = \"APIGatewayWAFRules\" sampled_requests_enabled = true } # ï½ ä¸­ç•¥ ï½ } ï¼Šå®Ÿè£…ä¾‹ï¼Š API Gatewayç”¨ã®WAFã«ï¼ŒSQLã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³ã‚’æ‹’å¦ã™ã‚‹ãƒãƒãƒ¼ã‚¸ãƒ‰ãƒ«ãƒ¼ãƒ«ã‚’è¨­å®šã™ã‚‹ï¼ resource \"aws_wafv2_web_acl\" \"api_gateway\" { rule { name = \"block-sql-injection\" priority = 0 statement { # ãƒãƒãƒ¼ã‚¸ãƒ‰ãƒ«ãƒ¼ãƒ«ã‚’ä½¿ç”¨ã™ã‚‹ï¼ managed_rule_group_statement { vendor_name = \"AWS\" name = \"AWSManagedRulesSQLiRuleSet\" } } override_action { count {} } visibility_config { cloudwatch_metrics_enabled = true metric_name = \"APIGatewayWAFBlockSQLInjectionRule\" sampled_requests_enabled = true } } default_action { allow {} } visibility_config { cloudwatch_metrics_enabled = true metric_name = \"APIGatewayWAFRules\" sampled_requests_enabled = true } # ï½ ä¸­ç•¥ ï½ } ï¼Šå®Ÿè£…ä¾‹ï¼Š ALBç”¨ã®WAFã«ï¼ŒAPIã‚­ãƒ¼ã¾ãŸã¯Bearerãƒˆãƒ¼ã‚¯ãƒ³ã‚’ORæ¡ä»¶ãƒ«ãƒ¼ãƒ«ã‚’è¨­å®šã™ã‚‹ï¼ã‚ãã¾ã§ä¾‹ã¨ã—ã¦ã§ï¼Œæœ¬æ¥ã§ã‚ã‚Œã°ï¼Œåˆ¥ã€…ã®ãƒ«ãƒ¼ãƒ«ã¨ã—ãŸæ–¹ãŒè‰¯ã„ï¼ resource \"aws_wafv2_web_acl\" \"api_gateway\" { # x-api-keyãƒ˜ãƒƒãƒ€ãƒ¼ã«APIã‚­ãƒ¼ã‚’å«ã‚€ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’è¨±å¯ã—ã¾ã™ï¼ rule { name = \"allow-request-including-api-key\" priority = 3 statement { or_statement { # APIã‚­ãƒ¼ã‚’æŒã¤ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’è¨±å¯ã—ã¾ã™ï¼ statement { byte_match_statement { positional_constraint = \"EXACTLY\" search_string = var.waf_api_key_ssm_parameter_value field_to_match { single_header { name = \"x-api-key\" } } text_transformation { priority = 0 type = \"NONE\" } } } # Bearerãƒˆãƒ¼ã‚¯ãƒ³ã‚’æŒã¤ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’è¨±å¯ã—ã¾ã™ï¼ statement { byte_match_statement { positional_constraint = \"EXACTLY\" search_string = var.waf_bearer_token_ssm_parameter_value field_to_match { single_header { name = \"authorization\" } } text_transformation { priority = 0 type = \"NONE\" } } } } } action { allow {} } visibility_config { cloudwatch_metrics_enabled = true metric_name = \"APIGatewayWAFAllowRequestIncludingAPIKeyRule\" sampled_requests_enabled = true } } # ï½ ä¸­ç•¥ ï½ } IPã‚»ãƒƒãƒˆã®ä¾å­˜é–¢ä¿‚ WAFã®IPã‚»ãƒƒãƒˆã¨ä»–è¨­å®šã®ä¾å­˜é–¢ä¿‚ã«ç™–ãŒã‚ã‚‹ï¼æ–°ã—ã„IPã‚»ãƒƒãƒˆã¸ã®ä»˜ã‘æ›ãˆã¨å¤ã„IPã‚»ãƒƒãƒˆã®å‰Šé™¤ã‚’åŒæ™‚ã«ãƒ‡ãƒ—ãƒ­ã‚¤ã—ãªã„ã‚ˆã†ã«ã™ã‚‹ï¼ã‚‚ã—åŒæ™‚ã«è¡Œã£ãŸå ´åˆï¼ŒTerraformã¯å¤ã„IPã‚»ãƒƒãƒˆã®å‰Šé™¤å‡¦ç†ã‚’å…ˆã«å®Ÿè¡Œã™ã‚‹ãŒï¼Œã“ã‚Œã¯WAFã«ç´ä»˜ã„ã¦ã„ã‚‹ãŸã‚ï¼Œã“ã“ã§ã‚¨ãƒ©ãƒ¼ãŒèµ·ã“ã£ã¦ã—ã¾ã†ï¼ãã®ãŸã‚ï¼ŒIPã‚»ãƒƒãƒˆã‚’æ–°ã—ãè¨­å®šã—ç›´ã™å ´åˆã¯ï¼Œä»¥ä¸‹ã®é€šã‚ŠäºŒã¤ã®æ®µéšã«åˆ†ã‘ã¦ãƒ‡ãƒ—ãƒ­ã‚¤ã™ã‚‹ã‚ˆã†ã«ã™ã‚‹ï¼ã¡ãªã¿ã«ï¼ŒIPã‚»ãƒƒãƒˆã®åå‰ã‚’å¤‰æ›´ã™ã‚‹å ´åˆã¯ï¼Œæ›´æ–°å‡¦ç†ã§ã¯ãªãå‰Šé™¤ã‚’ä¼´ã†å†æ§‹ç¯‰å‡¦ç†ãŒå®Ÿè¡Œã•ã‚Œã‚‹ãŸã‚æ³¨æ„ã™ã‚‹ï¼ æ–°ã—ã„IPã‚»ãƒƒãƒˆã®resourceã‚’å®Ÿè£…ã—ï¼ŒACLã«ç´ä»˜ã‘ï¼Œãƒ‡ãƒ—ãƒ­ã‚¤ã™ã‚‹ï¼ å¤ã„IPã‚»ãƒƒãƒˆã®resourceã‚’å‰Šé™¤ã—ï¼Œãƒ‡ãƒ—ãƒ­ã‚¤ã™ã‚‹ï¼ ã‚‚ã—ï¼Œã“ã‚Œã‚’å¿˜ã‚Œã¦ã—ã¾ã£ãŸå ´åˆã¯ï¼Œç”»é¢ä¸Šã§é©å½“ãªIPã‚»ãƒƒãƒˆã«ä»˜ã‘æ›ãˆã¦ï¼Œå‰Šé™¤å‡¦ç†ã‚’å®Ÿè¡Œã§ãã‚‹ã‚ˆã†ã«ã™ã‚‹ï¼ 16. å…±é€šã®è¨­å®š Terraformç®¡ç†å¤–ã®AWSãƒªã‚½ãƒ¼ã‚¹ ä»¥ä¸‹ã®AWSãƒªã‚½ãƒ¼ã‚¹ã¯Terraformã§ç®¡ç†ã—ãªã„æ–¹ãŒä¾¿åˆ©ã§ã‚ã‚‹ï¼ã¾ãŸï¼ŒAWSã®ä»•æ§˜ä¸Šã®ç†ç”±ã§ï¼Œç®¡ç†å¤–ã«ãªã£ã¦ã—ã¾ã†ã‚‚ã®ã‚‚ã‚ã‚‹ï¼Terraformã®ç®¡ç†å¤–ã®ãƒªã‚½ãƒ¼ã‚¹ã«ã¯ï¼Œã‚³ãƒ³ã‚½ãƒ¼ãƒ«ç”»é¢ä¸Šã‹ã‚‰ï¼Œã€ŒNot managed by = Terraformã€ã¨ã„ã†ã‚¿ã‚°ã‚’ã¤ã‘ãŸæ–¹ãŒè‰¯ã„ï¼ AWSãƒªã‚½ãƒ¼ã‚¹ ç®¡ç†å¤–ã®éƒ¨åˆ† ç®¡ç†å¤–ã®ç†ç”± API Gatewayï¼Œç´ä»˜ãVPCãƒªãƒ³ã‚¯ å…¨ã¦ ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ãƒãƒ¼ãƒ ãŒã‚¹ãƒ ãƒ¼ã‚ºã«APIã‚’æ§‹ç¯‰ã§ãã‚‹ã‚ˆã†ã«ã™ã‚‹ãŸã‚ï¼ Chatbot å…¨ã¦ AWSãŒAPIã‚’å…¬é–‹ã—ã¦ã„ãªã„ãŸã‚ï¼ŒTerraformã§æ§‹ç¯‰ã§ããªã„ï¼ EC2 ç§˜å¯†éµ Terraformã§æ§‹ç¯‰ã™ã‚‹æ™‚ã«GitHubã§ç§˜å¯†éµã‚’ç®¡ç†ã™ã‚‹å¿…è¦ãŒã‚ã‚‹ãŸã‚ï¼Œã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ä¸Šã®ç†ç”±ã§å´ä¸‹ã™ã‚‹ï¼ Global Accelerator ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚°ãƒ«ãƒ¼ãƒ— ãƒªã‚½ãƒ¼ã‚¹ã‚’æ§‹ç¯‰ã™ã‚‹ã¨ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚°ãƒ«ãƒ¼ãƒ—ãŒè‡ªå‹•ç”Ÿæˆã•ã‚Œã‚‹ãŸã‚ï¼Œã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚°ãƒ«ãƒ¼ãƒ—ã®ã¿Terraformã§ç®¡ç†ã§ããªã„ï¼ IAMãƒ¦ãƒ¼ã‚¶ å…¨ã¦ IAMãƒ¦ãƒ¼ã‚¶ã‚°ãƒ«ãƒ¼ãƒ— å…¨ã¦ IAMãƒ­ãƒ¼ãƒ« ãƒ»ãƒ¦ãƒ¼ã‚¶ã«ç´ä»˜ããƒ­ãƒ¼ãƒ«ãƒ»ã‚µãƒ¼ãƒ“ã‚¹ãƒªãƒ³ã‚¯ãƒ­ãƒ¼ãƒ« ã‚µãƒ¼ãƒ“ã‚¹ãƒªãƒ³ã‚¯ãƒ­ãƒ¼ãƒ«ã¯ï¼ŒAWSãƒªã‚½ãƒ¼ã‚¹ã®æ§‹ç¯‰ã«ä¼´ã£ã¦ï¼Œè‡ªå‹•çš„ã«ä½œã‚‰ã‚Œã‚‹ãŸã‚ï¼ŒTerraformã§ç®¡ç†ã§ããªã„ï¼ãŸã ã—ï¼Œæ•°ãŒå¤šã„ãŸã‚ã‚ãˆã¦è¡Œã‚ãªã„ãŒï¼ŒTerraformã§æ§‹ç¯‰ã—ã¦AWSãƒªã‚½ãƒ¼ã‚¹ã«ç´ä»˜ã‘ã‚‹ã“ã¨ã‚‚ã“ã¨ã‚‚å¯èƒ½ã§ã‚ã‚‹ï¼ Network Interface å…¨ã¦ ä»–ã®AWSãƒªã‚½ãƒ¼ã‚¹ã®æ§‹ç¯‰ã«ä¼´ã£ã¦ï¼Œè‡ªå‹•çš„ã«æ§‹ç¯‰ã•ã‚Œã‚‹ãŸã‚ï¼ŒTerraformã§ç®¡ç†ã§ããªã„ï¼ RDS adminä»¥å¤–ã®ãƒ¦ãƒ¼ã‚¶ å€‹åˆ¥ã®ãƒ¦ãƒ¼ã‚¶ä½œæˆã®ãŸã‚ã«ï¼Œmysql providerã¨ã„ã†æ©Ÿèƒ½ã‚’ä½¿ç”¨ã™ã‚‹å¿…è¦ãŒã‚ã‚‹ï¼ã—ã‹ã—ï¼Œä½¿ç”¨ã™ã‚‹ä¸Šã§ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹æˆæˆ¦ç•¥ã¨ç›¸æ€§ãŒæ‚ªã„ï¼ Route53 ãƒãƒ¼ãƒ ã‚µãƒ¼ãƒãƒ¼ãƒ¬ã‚³ãƒ¼ãƒ‰ ãƒ›ã‚¹ãƒˆã‚¾ãƒ¼ãƒ³ã‚’ä½œæˆã™ã‚‹ã¨ï¼Œãƒ¬ã‚³ãƒ¼ãƒ‰ã¨ã—ã¦ï¼Œãƒãƒ¼ãƒ ã‚µãƒ¼ãƒãƒ¬ã‚³ãƒ¼ãƒ‰ã®æƒ…å ±ãŒè‡ªå‹•çš„ã«è¨­å®šã•ã‚Œã‚‹ï¼ã“ã‚Œã¯ï¼ŒTerraformã®ç®¡ç†å¤–ã§ã‚ã‚‹ï¼ S3 tfstateã®ç®¡ç†ãƒã‚±ãƒƒãƒˆ tfstateãƒ•ã‚¡ã‚¤ãƒ«ã‚’æ ¼ç´ã™ã‚‹ãŸã‚ï¼ŒTerraformã®ãƒ‡ãƒ—ãƒ­ã‚¤ã‚ˆã‚Šå…ˆã«å­˜åœ¨ã—ã¦ã„ã‚‹å¿…è¦ãŒã‚ã‚‹ï¼ SSMãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚¹ãƒˆã‚¢ å…¨ã¦ ECSã«æ©Ÿå¯†ãªç’°å¢ƒå¤‰æ•°ã‚’å‡ºåŠ›ã™ã‚‹ãŸã‚ï¼ å‰Šé™¤ä¿è­·æ©Ÿèƒ½ã®ã‚ã‚‹AWSãƒªã‚½ãƒ¼ã‚¹ å‰Šé™¤ä¿è­·è¨­å®šã®ã‚ã‚‹AWSãƒªã‚½ãƒ¼ã‚¹ã«ç™–ãŒã‚ã‚‹ï¼å‰Šé™¤ä¿è­·ã®ç„¡åŠ¹åŒ–ã¨ãƒªã‚½ãƒ¼ã‚¹ã‚’å‰Šé™¤ã‚’åŒæ™‚ã«ãƒ‡ãƒ—ãƒ­ã‚¤ã—ãªã„ã‚ˆã†ã«ã™ã‚‹ï¼ã‚‚ã—åŒæ™‚ã«è¡Œã£ãŸå ´åˆï¼Œå‰Šé™¤å‡¦ç†ã‚’å…ˆã«å®Ÿè¡Œã™ã‚‹ãŒï¼Œå‰Šé™¤ã¯ä¿è­·ã•ã‚ŒãŸã¾ã¾ãªã®ã§ï¼Œã‚¨ãƒ©ãƒ¼ã«ãªã‚‹ï¼ã‚¨ãƒ©ãƒ¼ã«ãªã‚‹ï¼ãã®ãŸã‚ï¼Œã“ã®AWSãƒªã‚½ãƒ¼ã‚¹ã‚’å‰Šé™¤ã™ã‚‹æ™‚ã¯ï¼Œä»¥ä¸‹ã®é€šã‚ŠäºŒã¤ã®æ®µéšã«åˆ†ã‘ã¦ãƒ‡ãƒ—ãƒ­ã‚¤ã™ã‚‹ã‚ˆã†ã«ã™ã‚‹ï¼ å‰Šé™¤ä¿è­·ã‚’ç„¡åŠ¹åŒ–ï¼ˆfalseï¼‰ã«å¤‰æ›´ã—ï¼Œãƒ‡ãƒ—ãƒ­ã‚¤ã™ã‚‹ï¼ ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã‚’å‰Šé™¤ã—ï¼Œãƒ‡ãƒ—ãƒ­ã‚¤ã™ã‚‹ï¼ ã‚‚ã—ï¼Œã“ã‚Œã‚’å¿˜ã‚Œã¦ã—ã¾ã£ãŸå ´åˆã¯ï¼Œç”»é¢ä¸Šã§å‰Šé™¤å‡¦ç†ã‚’ç„¡åŠ¹åŒ–ã—ï¼Œå‰Šé™¤å‡¦ç†ã‚’å®Ÿè¡Œã§ãã‚‹ã‚ˆã†ã«ã™ã‚‹ï¼ AWSãƒªã‚½ãƒ¼ã‚¹å Terraformä¸Šã§ã®è¨­å®šå ALB enable_deletion_protection EC2 disable_api_termination RDS deletion_protection "},"public/infrastructure_as_code/infrastructure_as_code_terraform_ci_cd.html":{"url":"public/infrastructure_as_code/infrastructure_as_code_terraform_ci_cd.html","title":"ğŸ“– ï¸Terraformã®CICDãƒ•ãƒ­ãƒ¼","keywords":"","body":"Terraformã®CICDãƒ•ãƒ­ãƒ¼ ã¯ã˜ã‚ã« æœ¬ã‚µã‚¤ãƒˆã«ã¤ãã¾ã—ã¦ï¼Œä»¥ä¸‹ã‚’ã”èªè­˜ã®ã»ã©å®œã—ããŠé¡˜ã„ã„ãŸã—ã¾ã™ï¼ å‚è€ƒï¼šhttps://hiroki-it.github.io/tech-notebook-gitbook/ 01. ã‚·ã‚§ãƒ«ã‚¹ã‚¯ãƒªãƒ—ãƒˆ assume_role.sh å‚è€ƒï¼š terraform_apply.sh #!/bin/bash set -xeuo pipefail # credentialsã®æƒ…å ±ã‚’å‡ºåŠ›ã—ã¾ã™ï¼ source ./aws_envs.sh terraform -chdir=./${ENV} apply \\ -parallelism=30 \\ ${ENV}.tfplan | ./ops/tfnotify --config ./${ENV}/tfnotify.yml apply terraform_fmt.sh #!/bin/bash set -xeuo pipefail terraform fmt \\ -recursive \\ -check terraform_init.sh #!/bin/bash set -xeuo pipefail # credentialsã®æƒ…å ±ã‚’å‡ºåŠ›ã—ã¾ã™ï¼ source ./aws_envs.sh terraform -chdir=./${ENV} init \\ -upgrade \\ -reconfigure \\ -backend=true \\ -backend-config=\"bucket=${ENV}-tfstate-bucket\" \\ -backend-config=\"key=terraform.tfstate\" \\ -backend-config=\"encrypt=true\" terraform_plan.sh #!/bin/bash set -xeuo pipefail # credentialsã®æƒ…å ±ã‚’å‡ºåŠ›ã—ã¾ã™ï¼ source ./aws_envs.sh terraform -chdir=./${ENV} plan \\ -var-file=./${ENV}/foo.tfvars \\ -out=${ENV}.tfplan \\ -parallelism=30 | ./ops/tfnotify --config ./${ENV}/tfnotify.yml plan terraform_validate.sh #!/bin/bash set -xeuo pipefail terraform -chdir=./${ENV} validate 02. CircleCIã‚’ç”¨ã„ãŸCICD è¦ç´  ãƒ»ç’°å¢ƒ env èª¬æ˜ dev ãƒ—ãƒ«ãƒªã‚¯ã®ãƒ¬ãƒ“ãƒ¥ãƒ¼æ™‚ã«ï¼Œã‚³ãƒ¼ãƒ‰ã®å¤‰æ›´ã‚’æ¤œè¨¼ã™ã‚‹ãŸã‚ã®ã‚¤ãƒ³ãƒ•ãƒ©ç’°å¢ƒ stg ã‚¹ãƒ†ãƒ¼ã‚¸ãƒ³ã‚°ç’°å¢ƒ prd æœ¬ç•ªç’°å¢ƒ ãƒ»ã‚¸ãƒ§ãƒ– jobs èª¬æ˜ plan aws-cliã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã‹ã‚‰terraform plan -outã‚³ãƒãƒ³ãƒ‰ã¾ã§ã®ä¸€é€£ã®å‡¦ç†ã‚’å®Ÿè¡Œã™ã‚‹ï¼ æ‰¿èªã‚¸ãƒ§ãƒ– apply stgç’°å¢ƒã¾ãŸã¯prdç’°å¢ƒã«ãƒ‡ãƒ—ãƒ­ã‚¤ ãƒ»ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ workflows èª¬æ˜ feature featureãƒ–ãƒ©ãƒ³ãƒã‹ã‚‰devç’°å¢ƒã«ãƒ‡ãƒ—ãƒ­ã‚¤ develop developãƒ–ãƒ©ãƒ³ãƒã‹ã‚‰stgç’°å¢ƒã«ãƒ‡ãƒ—ãƒ­ã‚¤ main mainãƒ–ãƒ©ãƒ³ãƒã‹ã‚‰prdç’°å¢ƒã«ãƒ‡ãƒ—ãƒ­ã‚¤ config.ymlãƒ•ã‚¡ã‚¤ãƒ« version: 2.1 executors: primary_container: parameters: env: type: enum enum: [ \"dev\", \"stg\", \"prd\" ] docker: - image: hashicorp/terraform:x.xx.x working_directory: ~/foo_infrastructure environment: ENV: > commands: # AWSã«ãƒ‡ãƒ—ãƒ­ã‚¤ã™ã‚‹ãŸã‚ã®ç’°å¢ƒã‚’æ§‹ç¯‰ã—ã¾ã™ï¼ aws_setup: steps: - run: name: Install jq command: | apk add curl curl -o /usr/bin/jq -L https://github.com/stedolan/jq/releases/download/jq-1.5/jq-linux64 chmod +x /usr/bin/jq - run: name: Install aws-cli command: | apk add python3 apk add py-pip pip3 install awscli aws --version - run: name: Assume role command: | set -x source ./ops/assume.sh # terraform initã‚’è¡Œã„ã¾ã™ï¼ terraform_init: steps: - run: name: Terraform init command: | set -x source ./ops/terraform_init.sh # terraform fmtã‚’è¡Œã„ã¾ã™ï¼ terraform_fmt: steps: - run: name: Terraform fmt command: | set -x source ./ops/terraform_fmt.sh # terraform validateã‚’è¡Œã„ã¾ã™ï¼ terraform_validate: steps: - run: name: Terraform validate command: | set -x source ./ops/terraform_validate.sh # terraform planã‚’è¡Œã„ã¾ã™ï¼ terraform_plan: steps: - run: name: Terraform plan command: | set -x source ./ops/terraform_plan.sh ls -la # terraform applyã‚’è¡Œã„ã¾ã™ï¼ terraform_apply: steps: - run: name: Terraform apply command: | set -x ls -la source ./ops/terraform_apply.sh jobs: plan: parameters: exr: type: executor executor: > steps: - checkout - aws_setup - terraform_init - terraform_fmt - terraform_validate - terraform_plan - persist_to_workspace: root: . paths: - . apply: parameters: exr: type: executor executor: > steps: - attach_workspace: at: . - terraform_apply workflows: # Dev env feature: jobs: - plan: name: plan_dev exr: name: primary_container env: dev filters: branches: only: - /feature.*/ - apply: name: apply_dev exr: name: primary_container env: dev requires: - plan_dev # Staging env develop: jobs: - plan: name: plan_stg exr: name: primary_container env: stg filters: branches: only: - develop - hold_apply: name: hold_apply_stg type: approval requires: - plan_stg - apply: name: apply_stg exr: name: primary_container env: stg requires: - hold_apply_stg # Production env main: jobs: - plan: name: plan_prd exr: name: primary_container env: prd filters: branches: ignore: /.*/ tags: only: /release\\/.*/ - hold_apply: name: hold_apply_prd type: approval requires: - plan_prd filters: branches: ignore: /.*/ tags: only: /release\\/.*/ - apply: name: apply_prd exr: name: primary_container env: prd requires: - hold_apply_prd filters: branches: ignore: /.*/ tags: only: /release\\/.*/ 03. tfnotify tfnotifyã¨ã¯ terraformã®planã¾ãŸã¯applyã®å‡¦ç†çµæœã‚’ï¼ŒPOSTã§é€ä¿¡ã™ã‚‹ãƒã‚¤ãƒŠãƒªãƒ•ã‚¡ã‚¤ãƒ«ã®ã“ã¨ï¼URLã‚„é€ä¿¡å†…å®¹ã‚’è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã§å®šç¾©ã™ã‚‹ï¼ ã‚³ãƒãƒ³ãƒ‰ CircleCIã§åˆ©ç”¨ã™ã‚‹å ´åˆã¯ï¼Œcommandã®ä¸­ã§ï¼Œä»¥ä¸‹ã‹ã‚‰ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ãŸtfnotifyã®ãƒã‚¤ãƒŠãƒªãƒ•ã‚¡ã‚¤ãƒ«ã‚’å®Ÿè¡Œã™ã‚‹ï¼ç’°å¢ƒåˆ¥ã«tfnotifyã‚’é…ç½®ã—ã¦ãŠãã¨ã‚ˆã„ï¼ https://github.com/mercari/tfnotify/releases/tag/v0.7.0 #!/bin/bash set -xeuo pipefail terraform -chdir=./${ENV} plan | ./ops/tfnotify --config ./${ENV}/tfnotify.yml plan è¨­å®šãƒ•ã‚¡ã‚¤ãƒ« ã‚ã‚‰ã‹ã˜ã‚ï¼ŒGitHubã®ã‚¢ã‚¯ã‚»ã‚¹ãƒˆãƒ¼ã‚¯ãƒ³ã‚’ç™ºè¡Œã—ï¼ŒCIãƒ„ãƒ¼ãƒ«ã®ç’°å¢ƒå¤‰æ•°ã«ç™»éŒ²ã—ã¦ãŠãï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š ä¾‹ã¨ã—ã¦ï¼ŒGitHubã®ç‰¹å®šã®ãƒªãƒã‚¸ãƒˆãƒªã®ãƒ—ãƒ«ãƒªã‚¯ã‚¨ã‚¹ãƒˆã«POSTã§é€ä¿¡ã™ã‚‹ï¼ # https://github.com/mercari/tfnotify --- ci: circleci notifier: github: # ç’°å¢ƒå¤‰æ•°ã«ç™»éŒ²ã—ãŸãƒ‘ãƒ¼ã‚½ãƒŠãƒ«ã‚¢ã‚¯ã‚»ã‚¹ãƒˆãƒ¼ã‚¯ãƒ³ token: $GITHUB_TOKEN repository: # é€ä¿¡å…ˆã®ãƒ¦ãƒ¼ã‚¶åã‚‚ã—ãã¯çµ„ç¹”å owner: \"foo-company\" name: \"foo-repository\" terraform: plan: template: | {{ .Title }} for staging [CI link]( {{ .Link }} ) {{ .Message }} {{if .Result}} {{ .Result }} {{end}} Details (Click me) {{ .Body }} apply: template: | {{ .Title }} {{ .Message }} {{if .Result}} {{ .Result }} {{end}} Details (Click me) {{ .Body }} "},"public/virtualization/virtualization.html":{"url":"public/virtualization/virtualization.html","title":"ğŸ“– ï¸ä»®æƒ³åŒ–","keywords":"","body":"ä»®æƒ³åŒ– ã¯ã˜ã‚ã« æœ¬ã‚µã‚¤ãƒˆã«ã¤ãã¾ã—ã¦ï¼Œä»¥ä¸‹ã‚’ã”èªè­˜ã®ã»ã©å®œã—ããŠé¡˜ã„ã„ãŸã—ã¾ã™ï¼ å‚è€ƒï¼šhttps://hiroki-it.github.io/tech-notebook-gitbook/ 01. ä»®æƒ³åŒ– ä»®æƒ³åŒ–ã¨ã¯ è‡ªèº«ã®é–‹ç™ºç’°å¢ƒã§Webã‚µã‚¤ãƒˆã‚’å‹•ã‹ã—ãŸã„å ´åˆï¼Œã¾ãšï¼Œãƒ‘ã‚½ã‚³ãƒ³å†…ã«Linuxç’°å¢ƒã®Webã‚µãƒ¼ãƒï¼ŒAppã‚µãƒ¼ãƒï¼ŒDBã‚µãƒ¼ãƒãªã©ã®ç‰©ç†ã‚µãƒ¼ãƒã‚’ä»®æƒ³çš„ã«æ§‹ç¯‰ã™ã‚‹ï¼ãã—ã¦ï¼Œè‡ªèº«ã®ãƒ‘ã‚½ã‚³ãƒ³ã‚’ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆï¼Œå„ä»®æƒ³ã‚µãƒ¼ãƒã‚’ãƒªã‚¯ã‚¨ã‚¹ãƒˆå…ˆã«è¦‹ç«‹ã¦ã¦ï¼ŒSSHãƒ—ãƒ­ãƒˆã‚³ãƒ«ã‚’ç”¨ã„ã¦ã“ã‚Œã‚‰ã®ã‚µãƒ¼ãƒã«ãƒªãƒ¢ãƒ¼ãƒˆãƒ­ã‚°ã‚¤ãƒ³ã™ã‚‹ï¼ä»®æƒ³ç’°å¢ƒã®æ§‹ç¯‰æ–¹æ³•ã«ã¯ã„ãã¤ã‹ç¨®é¡ãŒã‚ã‚‹ï¼ ãƒ›ã‚¹ãƒˆå‹ä»®æƒ³åŒ– ãƒ»ãƒ›ã‚¹ãƒˆå‹ä»®æƒ³åŒ–ã¨ã¯ ãƒ›ã‚¹ãƒˆOSä¸Šã§ï¼Œå„ã‚µãƒ¼ãƒã‚’ä»®æƒ³çš„ã«æ§‹ç¯‰ã™ã‚‹ï¼ ãƒ»Providerä¾‹ VMware Workstationï¼ŒOracle VM VirtualBoxï¼Œãªã© ãƒã‚¤ãƒ‘ãƒ¼ãƒã‚¤ã‚¶ãƒ¼å‹ä»®æƒ³åŒ– ãƒ»ãƒã‚¤ãƒ‘ãƒ¼ãƒã‚¤ã‚¶ãƒ¼å‹ä»®æƒ³åŒ–ã¨ã¯ BIOSã‹ã‚‰èµ·å‹•ã—ãŸãƒã‚¤ãƒ‘ãƒ¼ãƒã‚¤ã‚¶ãƒ¼ä¸Šã§ï¼Œå„ã‚µãƒ¼ãƒã‚’ä»®æƒ³çš„ã«æ§‹ç¯‰ã™ã‚‹ï¼ˆâ€»ãƒ›ã‚¹ãƒˆOSã¯ç”¨ã„ãªã„ï¼‰ï¼ ãƒ»Providerä¾‹ VMware vSphere Hypervisorï¼ŒXenï¼ŒKVMï¼Œãªã© ã‚³ãƒ³ãƒ†ãƒŠå‹ä»®æƒ³åŒ– ãƒ»ã‚³ãƒ³ãƒ†ãƒŠå‹ä»®æƒ³åŒ–ã¨ã¯ ãƒ›ã‚¹ãƒˆOSä¸Šã§ï¼Œã‚µãƒ¼ãƒã§ã¯ãªãï¼Œã‚µãƒ¼ãƒã¨ã—ã¦ã®æ©Ÿèƒ½ã‚’æŒã¤ã‚³ãƒ³ãƒ†ãƒŠã‚’ä»®æƒ³çš„ã«æ§‹ç¯‰ã™ã‚‹ï¼ã‚«ãƒ¼ãƒãƒ«ã®ãƒªã‚½ãƒ¼ã‚¹ã‚’åˆ†å‰²ã§ãã‚‹Namespaceï¼ˆPID namespaceï¼ŒNetwork namespaceï¼ŒUID namespaceï¼‰ã¨Control Groupsã‚’ç”¨ã„ã¦ï¼Œå˜ä¸€ã®OSä¸Šã«ç‹¬ç«‹ã—ãŸã‚³ãƒ³ãƒ†ãƒŠã‚’æ§‹ç¯‰ã™ã‚‹ï¼ â†’ DockerToolboxãŒã¡ã‚‡ã„é•ã† ãƒ»Providerä¾‹ Dockerï¼ŒLXCï¼ŒOpenVZï¼Œãªã© 01-02. å„ä»®æƒ³åŒ–ã®ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã®æ¯”è¼ƒ èµ·å‹•é€Ÿåº¦ã®é•ã„ ãƒ›ã‚¹ãƒˆå‹ã¨ãƒã‚¤ãƒ‘ãƒ¼ãƒã‚¤ã‚¶å‹ã§ã¯ï¼Œãƒãƒ¼ãƒ‰ã‚¦ã‚§ã‚¢ï¼ˆCPUï¼Œãƒ¡ãƒ¢ãƒªï¼Œãƒãƒ¼ãƒ‰ãƒ‡ã‚£ã‚¹ã‚¯ï¼‰ã¨ã‚²ã‚¹ãƒˆOSã‚’ä»®æƒ³åŒ–ã™ã‚‹ã“ã¨ãŒå¿…è¦ã§ã‚ã‚‹ï¼ä¸€æ–¹ã§ï¼Œã‚³ãƒ³ãƒ†ãƒŠå‹ã§ã¯ï¼Œãƒãƒ¼ãƒ‰ã‚¦ã‚§ã‚¢ã¨ã‚²ã‚¹ãƒˆOSã®ä»®æƒ³åŒ–ã¯è¡Œã‚ãšï¼Œnamespaceã‚’ç”¨ã„ã¦ã‚³ãƒ³ãƒ†ãƒŠã‚’æ§‹æˆã™ã‚‹ãŸã‚ï¼Œãã®åˆ†èµ·å‹•ãŒé€Ÿã„ï¼ å‡¦ç†é€Ÿåº¦ã®é•ã„ ãƒ»Overheadã®å°ã•ã• ã‚²ã‚¹ãƒˆOSä¸Šã®ã‚¢ãƒ—ãƒªã‚’æ“ä½œã™ã‚‹å ´åˆï¼Œãƒ›ã‚¹ãƒˆå‹ã¨ãƒã‚¤ãƒ‘ãƒ¼ãƒã‚¤ã‚¶å‹ã§ã¯ï¼Œãƒãƒ¼ãƒ‰ã‚¦ã‚§ã‚¢ã‚„ãƒã‚¤ãƒ‘ãƒ¼ãƒã‚¤ã‚¶ãƒ¼ã‚’çµŒç”±ã™ã‚‹å¿…è¦ãŒã‚ã‚‹ï¼ã“ã®åˆ†ã ã‘ï¼Œæ™‚é–“ï¼ˆOverheadï¼‰ã‚’è¦ã™ã‚‹ï¼ä¸€æ–¹ã§ï¼Œã‚³ãƒ³ãƒ†ãƒŠå‹ã§ã¯ï¼Œå„ã‚³ãƒ³ãƒ†ãƒŠãŒãƒ›ã‚¹ãƒˆOSã¨ã‚«ãƒ¼ãƒãƒ«ã‚’å…±æœ‰ã™ã‚‹ãŸã‚ï¼ŒOverheadãŒå°ã•ã„ï¼ ãƒ»Overheadã®æ¯”è¼ƒ sysbenchã¨ã„ã†ãƒ™ãƒ³ãƒãƒãƒ¼ã‚¯ãƒ„ãƒ¼ãƒ«ã‚’ç”¨ã„ã¦ï¼ŒCPUãƒ»ãƒ¡ãƒ¢ãƒªãƒ»ãƒ•ã‚¡ã‚¤ãƒ«I/Oã«ç€ç›®ã—ï¼Œç‰©ç†ãƒã‚·ãƒ³ãƒ»ã‚³ãƒ³ãƒ†ãƒŠå‹ä»®æƒ³åŒ–ï¼ˆDockerï¼‰ãƒ»ãƒ›ã‚¹ãƒˆå‹ä»®æƒ³åŒ–ï¼ˆVirtualBoxï¼‰ã®ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã‚’æ¯”è¼ƒã™ã‚‹ã¨ï¼Œã‚³ãƒ³ãƒ†ãƒŠå‹ã§ã‚ã‚‹Dockerã¯æœ€ã‚‚OverheadãŒå°ã•ã„ï¼ "},"public/virtualization/virtualization_container_docker_command.html":{"url":"public/virtualization/virtualization_container_docker_command.html","title":"ğŸ“– ï¸dockerã‚³ãƒãƒ³ãƒ‰","keywords":"","body":"dockerã‚³ãƒãƒ³ãƒ‰ ã¯ã˜ã‚ã« æœ¬ã‚µã‚¤ãƒˆã«ã¤ãã¾ã—ã¦ï¼Œä»¥ä¸‹ã‚’ã”èªè­˜ã®ã»ã©å®œã—ããŠé¡˜ã„ã„ãŸã—ã¾ã™ï¼ å‚è€ƒï¼šhttps://hiroki-it.github.io/tech-notebook-gitbook/ 01. Dockerã‚³ãƒãƒ³ãƒ‰ã®ä»•çµ„ã¿ Dockerã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ ãƒ»Dockerã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã¨ã¯ Dockerã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã¯ï¼Œæ¥ç¶šã«ã‚ˆã£ã¦ï¼ŒDockerãƒ‡ãƒ¼ãƒ¢ãƒ³ã‚’æ“ä½œã§ãã‚‹ï¼ Dockerãƒ‡ãƒ¼ãƒ¢ãƒ³ ãƒ»Dockerãƒ‡ãƒ¼ãƒ¢ãƒ³ã¨ã¯ ãƒ›ã‚¹ãƒˆOSä¸Šã§ç¨¼åƒã—ï¼ŒDockerã®æ“ä½œã‚’æ‹…ã†ï¼Dockerã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã¯ï¼ŒDockerãƒ‡ãƒ¼ãƒ¢ãƒ³ã‚’é€šã—ã¦ï¼ŒDockerå…¨ä½“ã‚’æ“ä½œã§ãã‚‹ï¼ å‚è€ƒï¼šhttps://www.slideshare.net/zembutsu/docker-underlying-and-containers-lifecycle 02. ã‚³ãƒãƒ³ãƒ‰ attach ãƒ»ã‚ªãƒ—ã‚·ãƒ§ãƒ³ãªã— ï¼Šã‚³ãƒãƒ³ãƒ‰ä¾‹ï¼Š ãƒ‡ã‚¿ãƒƒãƒãƒ‰ãƒ¢ãƒ¼ãƒ‰ã«ã‚ˆã£ã¦ï¼Œèµ·å‹•ä¸­ã®ã‚³ãƒ³ãƒ†ãƒŠã«æ¥ç¶šã™ã‚‹ï¼ $ docker attach build ãƒ»-force-rmï¼Œ--no-cache ï¼Šã‚³ãƒãƒ³ãƒ‰ä¾‹ï¼Š ã‚­ãƒ£ãƒƒã‚·ãƒ¥ç„¡ã—ã§ï¼ŒæŒ‡å®šã®Dockerfileã‚’åŸºã«ï¼Œã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’ãƒ“ãƒ«ãƒ‰ã™ã‚‹ï¼å¤±æ•—ã—ãŸæ™‚ã¯å‰Šé™¤ã™ã‚‹ã‚ˆã†ã«ï¼Œ--force-rmã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’æœ‰åŠ¹åŒ–ã™ã‚‹ï¼ $ docker build --file Dockerfile --tag : --force-rm=true --no-cache . commit ãƒ»ã‚ªãƒ—ã‚·ãƒ§ãƒ³ãªã— åœæ­¢ä¸­ã®ã‚³ãƒ³ãƒ†ãƒŠã‹ã‚‰ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’ä½œæˆã™ã‚‹ï¼ ï¼Šã‚³ãƒãƒ³ãƒ‰ä¾‹ï¼Š $ docker commit $ docker commit /: container ãƒ»prune åœæ­¢ä¸­ã®ã‚³ãƒ³ãƒ†ãƒŠã®ã¿ã‚’å…¨ã¦å‰Šé™¤ã™ã‚‹ï¼ ï¼Šã‚³ãƒãƒ³ãƒ‰ä¾‹ï¼Š $ docker container prune cp ãƒ»ã‚ªãƒ—ã‚·ãƒ§ãƒ³ãªã— Dockerfileã®COPYã‚³ãƒãƒ³ãƒ‰ã‚’ä½¿ç”¨ã—ã¦ã‚³ãƒ³ãƒ†ãƒŠå†…ã«é…ç½®ã—ã¦ã„ã‚‹ãƒ•ã‚¡ã‚¤ãƒ«ã«é–¢ã—ã¦ï¼Œå¤‰æ›´ã®ãŸã³ã«ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’ãƒ“ãƒ«ãƒ‰ã‚’è¡Œã†ã“ã¨ã¯é¢å€’ã®ãŸã‚ï¼Œãƒ›ã‚¹ãƒˆOSã‹ã‚‰ã‚³ãƒ³ãƒ†ãƒŠã«ã‚³ãƒ”ãƒ¼ã—ï¼Œå†èª­ã¿è¾¼ã¿ã‚’è¡Œã†ï¼ãŸã ã—ï¼Œã‚³ãƒ³ãƒ†ãƒŠã‚’å†æ§‹ç¯‰ã™ã‚‹ã¨å…ƒã«æˆ»ã£ã¦ã—ã¾ã†ã“ã¨ã«æ³¨æ„ï¼ ï¼Šã‚³ãƒãƒ³ãƒ‰ä¾‹ï¼Š # ãƒ›ã‚¹ãƒˆã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚³ãƒ³ãƒ†ãƒŠã«ã‚³ãƒ”ãƒ¼ $ docker cp ./docker/www/nginx.conf :/etc/nginx/nginx.conf # ã‚³ãƒ³ãƒ†ãƒŠã«æ¥ç¶šå¾Œã«ï¼Œnginxã®è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã‚’å†èª­ã¿è¾¼ã¿ï¼ $ docker exec -it bin/bash # ã‚‚ã—ãã¯bin/sh [root@:~] $ nginx -s reload [root@:~] $ exit # ã‚¢ã‚¯ã‚»ã‚¹ãƒ­ã‚°ã‚’ç¢ºèª $ docker logs create ãƒ»ã‚ªãƒ—ã‚·ãƒ§ãƒ³ãªã— ï¼Šã‚³ãƒãƒ³ãƒ‰ä¾‹ï¼Š ã‚³ãƒ³ãƒ†ãƒŠãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚’ç”Ÿæˆã—ï¼Œã‚³ãƒ³ãƒ†ãƒŠã‚’æ§‹ç¯‰ï¼èµ·å‹•ã¯ã—ãªã„ï¼ $ docker create : exec ãƒ»-it ï¼Šã‚³ãƒãƒ³ãƒ‰ä¾‹ï¼Š ãƒ‡ã‚¿ãƒƒãƒãƒ‰ãƒ¢ãƒ¼ãƒ‰ã«ã‚ˆã£ã¦ï¼Œèµ·å‹•ä¸­ã®ã‚³ãƒ³ãƒ†ãƒŠå†…ã§ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã™ã‚‹ï¼å®Ÿè¡Œã™ã‚‹ã‚³ãƒãƒ³ãƒ‰ãŒbashã‚„bashã®å ´åˆï¼Œã‚³ãƒ³ãƒ†ãƒŠã«æ¥ç¶šã§ãã‚‹ï¼ # iï¼šinteractiveï¼Œtï¼šttyï¼ˆå¯¾è©±ãƒ¢ãƒ¼ãƒ‰ï¼‰ $ docker exec -it /bin/bash # ã‚¤ãƒ¡ãƒ¼ã‚¸å†…ã«/bin/bash ãŒãªã„å ´åˆ $ docker exec -it /bin/sh ãƒ»attachï¼Œexecã®é•ã„ ã¾ãšattachã‚³ãƒãƒ³ãƒ‰ã§ã¯ï¼Œèµ·å‹•ä¸­ã®ã‚³ãƒ³ãƒ†ãƒŠã«æ¥ç¶šã™ã‚‹ï¼exitã‚³ãƒãƒ³ãƒ‰ã‚’ä½¿ç”¨ã—ã¦ï¼Œã‚³ãƒ³ãƒ†ãƒŠã¨ã®æ¥ç¶šã‚’åˆ‡æ–­ã—ãŸå¾Œï¼Œã‚³ãƒ³ãƒ†ãƒŠãŒåœæ­¢ã—ã¦ã—ã¾ã†ï¼ # ãƒ‡ã‚¿ãƒƒãƒãƒ‰ãƒ¢ãƒ¼ãƒ‰ã«ã‚ˆã‚‹èµ·å‹• $ docker run -d -it --name : /bin/bash # ãƒ‡ã‚¿ãƒƒãƒãƒ‰ãƒ¢ãƒ¼ãƒ‰ã«ã‚ˆã£ã¦èµ·å‹•ä¸­ã®ã‚³ãƒ³ãƒ†ãƒŠã«æ¥ç¶š $ docker attach # PID=1ã§ï¼Œ1ã¤ã®/bin/bashãƒ—ãƒ­ã‚»ã‚¹ãŒç¨¼åƒã—ã¦ã„ã‚‹ã“ã¨ãŒç¢ºèªã§ãã‚‹ [root@:~] ps aux USER PID %CPU %MEM VSZ RSS TTY STAT START TIME COMMAND root 1 0.0 0.1 16152 3872 pts/0 Ss+ 18:06 0:00 /bin/bash root 33 0.0 0.1 45696 3732 pts/1 R+ 18:22 0:00 ps aux # ã‚³ãƒ³ãƒ†ãƒŠã¨ã®æ¥ç¶šã‚’åˆ‡æ–­ [root@:~] exit # ã‚³ãƒ³ãƒ†ãƒŠã®çŠ¶æ…‹ã‚’ç¢ºèª $ docker container ps -a --no-trunc # ==> ã‚³ãƒ³ãƒ†ãƒŠã®STATUSãŒEXITedã«ãªã£ã¦ã„ã‚‹ ä¸€æ–¹ã§execã‚³ãƒãƒ³ãƒ‰ã§ã¯ï¼Œèµ·å‹•ä¸­ã®ã‚³ãƒ³ãƒ†ãƒŠã§ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã™ã‚‹ï¼å®Ÿè¡Œã™ã‚‹ã‚³ãƒãƒ³ãƒ‰ãŒbashã‚„bashã®å ´åˆï¼Œã‚³ãƒ³ãƒ†ãƒŠã«æ¥ç¶šã§ãã‚‹ï¼exitã‚³ãƒãƒ³ãƒ‰ã‚’ä½¿ç”¨ã—ã¦ï¼Œã‚³ãƒ³ãƒ†ãƒŠã¨ã®æ¥ç¶šã‚’åˆ‡æ–­ã—ãŸå¾Œã§ã‚‚ï¼Œã‚³ãƒ³ãƒ†ãƒŠãŒèµ·å‹•ã—ç¶šã‘ã‚‹ï¼ # ãƒ‡ã‚¿ãƒƒãƒãƒ‰ãƒ¢ãƒ¼ãƒ‰ã«ã‚ˆã‚‹èµ·å‹• $ docker run -d -it --name : /bin/bash # å¯¾è©±ãƒ¢ãƒ¼ãƒ‰ã‚’ä½¿ç”¨ã—ã¦ï¼Œãƒ‡ã‚¿ãƒƒãƒãƒ‰ãƒ¢ãƒ¼ãƒ‰ã«ã‚ˆã£ã¦èµ·å‹•ä¸­ã®ã‚³ãƒ³ãƒ†ãƒŠã«æ¥ç¶š $ docker exec -it /bin/bash # ã‚‚ã—ãã¯bin/sh # PID=1,17ã§ï¼Œ2ã¤ã®/bin/bashãƒ—ãƒ­ã‚»ã‚¹ãŒç¨¼åƒã—ã¦ã„ã‚‹ã“ã¨ãŒç¢ºèªã§ãã‚‹ [root@:~] ps aux USER PID %CPU %MEM VSZ RSS TTY STAT START TIME COMMAND root 1 0.0 0.1 16152 3872 pts/0 Ss+ 18:06 0:00 /bin/bash root 17 0.0 0.1 16152 4032 pts/1 Ss 18:21 0:00 /bin/bash root 34 0.0 0.1 45696 3732 pts/1 R+ 18:22 0:00 ps aux # ã‚³ãƒ³ãƒ†ãƒŠã¨ã®æ¥ç¶šã‚’åˆ‡æ–­ [root@:~] exit # ã‚³ãƒ³ãƒ†ãƒŠã®çŠ¶æ…‹ã‚’ç¢ºèª $ docker container ps -a --no-trunc # ==> ã‚³ãƒ³ãƒ†ãƒŠã®STATUSãŒUPã«ãªã£ã¦ã„ã‚‹ search ãƒ»ã‚ªãƒ—ã‚·ãƒ§ãƒ³ãªã— ï¼Šã‚³ãƒãƒ³ãƒ‰ä¾‹ï¼Š ãƒ¬ã‚¸ã‚¹ãƒˆãƒªå´ã«ä¿ç®¡ã•ã‚Œã¦ã„ã‚‹ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’æ¤œç´¢ã™ã‚‹ï¼ $ docker search images ãƒ»ã‚ªãƒ—ã‚·ãƒ§ãƒ³ãªã— ï¼Šã‚³ãƒãƒ³ãƒ‰ä¾‹ï¼Š ãƒ›ã‚¹ãƒˆOSã«ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚ŒãŸã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’ç¢ºèªã™ã‚‹ï¼ $ docker images ãƒ»prune ï¼Šã‚³ãƒãƒ³ãƒ‰ä¾‹ï¼Š ã‚³ãƒ³ãƒ†ãƒŠã«ä½¿ç”¨ã•ã‚Œã¦ã„ãªã„ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’ä¸€æ‹¬ã§å‰Šé™¤ $ docker image prune ãƒ»rmi ï¼Šã‚³ãƒãƒ³ãƒ‰ä¾‹ï¼Š ã‚¿ã‚°åã®ãªã„ã‚¤ãƒ¡ãƒ¼ã‚¸ã®ã¿ã‚’å…¨ã¦å‰Šé™¤ã™ã‚‹ï¼ $ docker rmi --force $(sudo docker images --filter \"dangling=true\" --all --quiet) inspect ãƒ»ã‚ªãƒ—ã‚·ãƒ§ãƒ³ãªã— ï¼Šã‚³ãƒãƒ³ãƒ‰ä¾‹ï¼Š èµ·å‹•ä¸­ã‚³ãƒ³ãƒ†ãƒŠã®å…¨ã¦ã®è¨­å®šå†…å®¹ã‚’è¡¨ç¤ºã™ã‚‹ï¼grepã¨ã‚‚çµ„ã¿åˆã‚ã›ã‚‰ã‚Œã‚‹ï¼ $ docker inspect $ docker inspect | grep IPAddress ï¼Šã‚³ãƒãƒ³ãƒ‰ä¾‹ï¼Š json-fileãƒ‰ãƒ©ã‚¤ãƒãƒ¼ã‚’ä½¿ç”¨ã—ã¦ã„ã‚‹æ™‚ã«ï¼Œãƒ­ã‚°ãƒ•ã‚¡ã‚¤ãƒ«ã®å‡ºåŠ›å…ˆã‚’ç¢ºèªã™ã‚‹ï¼ $ docker inspect | grep 'LogPath' \"LogPath\": \"/var/lib/docker/containers/*****-json.log\", network ãƒ»ls ï¼Šã‚³ãƒãƒ³ãƒ‰ä¾‹ï¼Š $ docker network ls NETWORK ID NAME DRIVER SCOPE ae25b9b7740b bridge bridge local aeef782b227d tech-notebook_default bridge local ãƒ»prune $ docker network prune ãƒ»inspect è¤‡æ•°ã®ã‚³ãƒ³ãƒ†ãƒŠãŒèµ·å‹•ã—ã¦ã„ã‚‹æ™‚ã«ï¼Œã‚³ãƒ³ãƒ†ãƒŠãŒã„ãšã‚Œã®ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚’ä½¿ç”¨ã—ã¦ã„ã‚‹ã‹ã‚’ç¢ºèªã™ã‚‹ï¼ $ docker network inspect ps ãƒ»-a ï¼Šã‚³ãƒãƒ³ãƒ‰ä¾‹ï¼Š ã‚³ãƒ³ãƒ†ãƒŠã®èµ·å‹•ã¨åœæ­¢ã«ã‹ã‹ã‚ã‚‰ãšï¼ŒIDãªã©ã‚’ä¸€è¦§ã§è¡¨ç¤ºï¼ $ docker ps -a pull ï¼Šã‚³ãƒãƒ³ãƒ‰ä¾‹ï¼Š ãƒ¬ã‚¸ã‚¹ãƒˆãƒªå´ã®ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå´ã«ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹ï¼ $ docker pull : push ãƒ»ã‚ªãƒ—ã‚·ãƒ§ãƒ³ãªã— ï¼Šã‚³ãƒãƒ³ãƒ‰ä¾‹ï¼Š ãƒ›ã‚¹ãƒˆOSã§ä½œæˆã—ãŸã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’ï¼ŒæŒ‡å®šã—ãŸDockerHubã®ãƒ¦ãƒ¼ã‚¶ã«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã™ã‚‹ï¼ $ docker push /: ï¼Šã‚³ãƒãƒ³ãƒ‰ä¾‹ï¼Š ãƒ›ã‚¹ãƒˆOSã§ä½œæˆã—ãŸã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’ï¼ŒæŒ‡å®šã—ãŸECRã«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã™ã‚‹ï¼ECRã¯ã‚¿ã‚°åãŒã‚„ã‚„ç‰¹æ®Šã®ãŸã‚ï¼Œäº‹å‰ã«ã‚¿ã‚°ã‚’ä»˜ã‘æ›¿ãˆã‚‹å¿…è¦ãŒã‚ã‚‹ï¼ $ docker tag : /: $ docker push /: rm ãƒ»--force ï¼Šã‚³ãƒãƒ³ãƒ‰ä¾‹ï¼Š èµ·å‹•ä¸­ï¼åœæ­¢ä¸­ã®å…¨ã¦ã‚³ãƒ³ãƒ†ãƒŠã‚’å¼·åˆ¶çš„ã«å‰Šé™¤ã™ã‚‹ï¼ $ docker rm --force $(docker ps --all --quiet) run ãƒ»--hostname ã‚³ãƒ³ãƒ†ãƒŠå†…ã®etc/hostsãƒ•ã‚¡ã‚¤ãƒ«ã§ï¼Œã‚³ãƒ³ãƒ†ãƒŠã®ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆIPã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’ç¢ºèªã§ãã‚‹ï¼hostnameã‚ªãƒ—ã‚·ãƒ§ãƒ³ã§å‘½åã—ã¦ã„ã‚Œã°ãã®åå‰ï¼ŒæŒ‡å®šã—ã¦ã„ãªã‘ã‚Œã°ãƒ©ãƒ³ãƒ€ãƒ ãªæ–‡å­—åˆ—ãŒå‰²ã‚Šå½“ã¦ã‚‰ã‚Œã‚‹ï¼ ï¼Šã‚³ãƒãƒ³ãƒ‰ä¾‹ï¼Š $ docker run -d -it --hostname --name --publish=8080:80 : /bin/bash $ docker exec -it /bin/bash [root@:/] cat /etc/hosts 127.0.0.1 localhost ::1 localhost ip6-localhost ip6-loopback fe00::0 ip6-localnet ff00::0 ip6-mcastprefix ff02::1 ip6-allnodes ff02::2 ip6-allrouters 172.18.0.2 ãƒ»--publish æŒ‡å®šã—ãŸãƒ›ã‚¹ãƒˆãƒãƒ¼ãƒˆã¨ã‚³ãƒ³ãƒ†ãƒŠãƒãƒ¼ãƒˆã®ãƒãƒƒãƒ”ãƒ³ã‚°ã‚’å®Ÿè¡Œã™ã‚‹ï¼--publish-allã‚ªãƒ—ã‚·ãƒ§ãƒ³ã§ã¯ãƒ›ã‚¹ãƒˆãƒãƒ¼ãƒˆã‚’ãƒ©ãƒ³ãƒ€ãƒ ã«é¸ã‚“ã§ãƒãƒ¼ãƒˆãƒãƒƒãƒ”ãƒ³ã‚°ã‚’å®Ÿè¡Œã™ã‚‹ï¼ å‚è€ƒï¼šhttps://www.whitesourcesoftware.com/free-developer-tools/blog/docker-expose-port/ $ docker run -d -it --name --publish=8080:80 : /bin/bash ãƒ»--expose ã‚³ãƒ³ãƒ†ãƒŠãƒãƒ¼ãƒˆå…¬é–‹ã‚’exposeã‚ªãƒ—ã‚·ãƒ§ãƒ³ã§è¨­å®šã§ãã‚‹ï¼ã“ã‚Œã¯Dockerfileã§EXPOSEå‘½ä»¤ã¨ã—ã¦è¨­å®šã—ã¦ã‚‚ã‚ˆã„ï¼ãªãŠï¼Œãƒ—ãƒ­ã‚»ã‚¹ã®ãƒªãƒƒã‚¹ãƒ³ã™ã‚‹ãƒãƒ¼ãƒˆã¨åˆã‚ã›ã‚‹å¿…è¦ãŒã‚ã‚‹ï¼ å‚è€ƒï¼šhttps://www.whitesourcesoftware.com/free-developer-tools/blog/docker-expose-port/ $ docker run -d -it --name --expose=80 : /bin/bash ãƒ»-aï¼Œ-d ã™ã§ã«åœæ­¢ä¸­ã¾ãŸã¯èµ·å‹•ä¸­ã®ã‚³ãƒ³ãƒ†ãƒŠãŒå­˜åœ¨ã—ã¦ã„ã¦ã‚‚ï¼Œã“ã‚Œã¨ã¯åˆ¥ã«ã‚³ãƒ³ãƒ†ãƒŠã‚’æ–°ã—ãæ§‹ç¯‰ã—ï¼Œèµ·å‹•ã™ã‚‹ï¼ã•ã‚‰ã«ãã®ã‚³ãƒ³ãƒ†ãƒŠå†…ã§ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã™ã‚‹ï¼èµ·å‹•æ™‚ã«bashãƒ—ãƒ­ã‚»ã‚¹ã‚„bashãƒ—ãƒ­ã‚»ã‚¹ã‚’å®Ÿè¡Œã™ã‚‹ã¨ï¼Œã‚³ãƒ³ãƒ†ãƒŠã«æ¥ç¶šã§ãã‚‹ï¼ä½•ã‚‚æ¸¡ã•ãªã„å ´åˆã¯ï¼Œãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®ãƒ—ãƒ­ã‚»ã‚¹ã¨ã—ã¦bashãƒ—ãƒ­ã‚»ã‚¹ãŒå®Ÿè¡Œã•ã‚Œã‚‹ï¼runã‚³ãƒãƒ³ãƒ‰ã§ã¯ï¼Œã‚¢ã‚¿ãƒƒãƒãƒ¢ãƒ¼ãƒ‰ã¨ãƒ‡ã‚¿ãƒƒãƒãƒ¢ãƒ¼ãƒ‰ã‚’é¸ã¶ã“ã¨ãŒã§ãã‚‹ï¼æ–°ã—ãèµ·å‹•ã—ãŸã‚³ãƒ³ãƒ†ãƒŠã‚’åœæ­¢å¾Œã«è‡ªå‹•å‰Šé™¤ã™ã‚‹å ´åˆã¯ï¼Œrmã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’ä»˜ã‘ã‚‹ã‚ˆã†ã«ã™ã‚‹ï¼ ï¼Šã‚³ãƒãƒ³ãƒ‰ä¾‹ï¼Š # ã‚¢ã‚¿ãƒƒãƒãƒ¢ãƒ¼ãƒ‰ã«ã‚ˆã‚‹èµ·å‹•ï¼ãƒ•ã‚©ã‚¢ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ã§èµ·å‹•ã™ã‚‹ï¼ $ docker run -a -it --rm --name : /bin/bash # ãƒ‡ã‚¿ãƒƒãƒãƒ‰ãƒ¢ãƒ¼ãƒ‰ã«ã‚ˆã‚‹èµ·å‹•ï¼ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ã§èµ·å‹•ã™ã‚‹ï¼ $ docker run -d -it --rm --name : /bin/bash ã‚³ãƒ³ãƒ†ãƒŠã‚’èµ·å‹•ã™ã‚‹æ™‚ã«ï¼Œbashãƒ—ãƒ­ã‚»ã‚¹ã‚’å®Ÿè¡Œã™ã‚‹ã¨ä»¥ä¸‹ã®ã‚ˆã†ãªã‚¨ãƒ©ãƒ¼ãŒå‡ºã‚‹ã“ã¨ãŒã‚ã‚‹ï¼ãã®å ´åˆã¯ï¼Œbashãƒ—ãƒ­ã‚»ã‚¹ã‚’å®Ÿè¡Œã™ã‚‹ã‚ˆã†ã«ã™ã‚‹ï¼ docker: Error response from daemon: OCI runtime create failed: container_linux.go:370: starting container process caused: exec: \"/bin/bash\": stat /bin/bash: no such file or directory: unknown. ã‚¢ã‚¿ãƒƒãƒãƒ¢ãƒ¼ãƒ‰ã¯ï¼Œãƒ•ã‚©ã‚¢ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰èµ·å‹•ã§ã‚ã‚‹ï¼ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ã«ãƒ—ãƒ­ã‚»ã‚¹ã®ãƒ­ã‚°ãŒè¡¨ç¤ºã•ã‚Œãªã„ãŸã‚ï¼ŒåŒä¸€ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ã§ä»–ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å…¥åŠ›ã§ãã‚‹ï¼ ï¼Šã‚³ãƒãƒ³ãƒ‰ä¾‹ï¼Š # -aï¼šatattch mode $ docker run -a -it --name : /bin/bash ãƒ‡ã‚¿ãƒƒãƒãƒ‰ãƒ¢ãƒ¼ãƒ‰ã¯ï¼Œãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰èµ·å‹•ã§ã‚ã‚‹ï¼ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ã«ãƒ—ãƒ­ã‚»ã‚¹ã®ãƒ­ã‚°ãŒè¡¨ç¤ºã•ã‚Œç¶šã‘ã‚‹ãŸã‚ï¼ŒåŒä¸€ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ã§ä»–ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å…¥åŠ›ã§ããªã„ï¼ãƒ—ãƒ­ã‚»ã‚¹ã®ãƒ­ã‚°ã‚’ç›£è¦–ã§ãã‚‹ãŒï¼Œä»–ã®ãƒ—ãƒ­ã‚»ã‚¹ã‚’å…¥åŠ›ã™ã‚‹ãŸã‚ã«ã¯ï¼Œãã®ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ä¸Šã§ã‚³ãƒ³ãƒ†ãƒŠã‚’åœæ­¢ã•ã›ã‚‹å¿…è¦ãŒã‚ã‚‹ï¼ ï¼Šã‚³ãƒãƒ³ãƒ‰ä¾‹ï¼Š # -dï¼›detached mode $ docker run -d -it --name : /bin/bash start ã‚³ãƒ³ãƒ†ãƒŠã‚’èµ·å‹•ã™ã‚‹ï¼startã‚³ãƒãƒ³ãƒ‰ã§ã¯ï¼Œã‚¢ã‚¿ãƒƒãƒãƒ¢ãƒ¼ãƒ‰ã«ã‚ˆã‚‹èµ·å‹•ã—ã‹ã§ããªã„ï¼ ï¼Šã‚³ãƒãƒ³ãƒ‰ä¾‹ï¼Š åœæ­¢ä¸­ã‚³ãƒ³ãƒ†ãƒŠã‚’ã‚¢ã‚¿ãƒƒãƒãƒ¢ãƒ¼ãƒ‰ã«ã‚ˆã£ã¦èµ·å‹•ã™ã‚‹ï¼ $ docker start -i stop ãƒ»ã‚ªãƒ—ã‚·ãƒ§ãƒ³ãªã— ï¼Šã‚³ãƒãƒ³ãƒ‰ä¾‹ï¼Š èµ·å‹•ä¸­ã‚³ãƒ³ãƒ†ãƒŠã‚’åœæ­¢ã™ã‚‹ï¼ $ docker stop ï¼Šã‚³ãƒãƒ³ãƒ‰ä¾‹ï¼Š å…¨ã¦ã®ã‚³ãƒ³ãƒ†ãƒŠã‚’åœæ­¢ã™ã‚‹ï¼ $ docker stop $(docker ps --all --quiet) volume ãƒ»create Volumeãƒã‚¦ãƒ³ãƒˆã‚’ä½œæˆã™ã‚‹ï¼dockerã‚³ãƒãƒ³ãƒ‰ã§ã¯ãªãï¼Œdocker-composeã‚³ãƒãƒ³ãƒ‰ã§ä½œæˆã™ã‚‹ã“ã¨ãŒæ¨å¥¨ã•ã‚Œã¦ã„ã‚‹ï¼ ï¼Šã‚³ãƒãƒ³ãƒ‰ä¾‹ï¼Š ãƒ›ã‚¹ãƒˆOSã®Dockerã‚¨ãƒªã‚¢ã«Volumeã‚’ä½œæˆ $ docker volume create ãƒ»ls ï¼Šã‚³ãƒãƒ³ãƒ‰ä¾‹ï¼Š Dockerã‚¨ãƒªã‚¢ã®Volumeã®ä¸€è¦§ã‚’è¡¨ç¤º $ docker volume ls ãƒ»rm ï¼Šã‚³ãƒãƒ³ãƒ‰ä¾‹ï¼Š Dockerã‚¨ãƒªã‚¢ã®Volumeã‚’å‰Šé™¤ $ docker volume rm ãƒ»inspect ï¼Šã‚³ãƒãƒ³ãƒ‰ä¾‹ï¼Š Dockerã‚¨ãƒªã‚¢ã®Volumeã®è©³ç´°ã‚’è¡¨ç¤º $ docker volume inspect [ { \"CreatedAt\": \"2020-09-06T15:04:02Z\", \"Driver\": \"local\", \"Labels\": { \"com.docker.compose.project\": \"\", \"com.docker.compose.version\": \"1.26.2\", \"com.docker.compose.volume\": \"xxx\" }, \"Mountpoint\": \"/var/lib/docker/volumes/_xxx/_data\", \"Name\": \"_xxx\", \"Options\": null, \"Scope\": \"local\" } ] # Dockerã‚¨ãƒªã‚¢ã‚’Volumeãƒã‚¦ãƒ³ãƒˆã—ã¦èµ·å‹• # ãƒã‚¦ãƒ³ãƒˆãƒã‚¤ãƒ³ãƒˆã®Volumeåã‚’ä½¿ç”¨ $ docker run -d -it --name /bin/bash \\ --mount type=volume, src= volume-driver=local, dst= ï¼Šå®Ÿè£…ä¾‹ï¼Š Dockerfileã§Volumeãƒã‚¦ãƒ³ãƒˆã‚’è¡Œã†å ´åˆï¼Œãƒã‚¦ãƒ³ãƒˆå…ˆã®ã‚³ãƒ³ãƒ†ãƒŠå´ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªåã‚’æŒ‡å®šã™ã‚‹ï¼Dockerã‚¨ãƒªã‚¢ã®ãƒã‚¦ãƒ³ãƒˆãƒã‚¤ãƒ³ãƒˆã¯ï¼Œè‡ªå‹•çš„ã«ä½œæˆã•ã‚Œã‚‹ï¼Docker Composeã§è¡Œã†ã“ã¨ãŒæ¨å¥¨ã•ã‚Œã¦ã„ã‚‹ï¼ FROM ubuntu RUN mkdir /myvol RUN echo \"hello world\" > /myvol/greeting # ãƒã‚¦ãƒ³ãƒˆå…ˆã®ã‚³ãƒ³ãƒ†ãƒŠå´ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªå VOLUME /myvol 03. ãƒ­ã‚®ãƒ³ã‚° log ãƒ»--follow ãƒ­ã‚°ã‚’è¡¨ç¤ºã—ç¶šã‘ã‚‹ï¼ãƒ­ã‚®ãƒ³ã‚°ãƒ‰ãƒ©ã‚¤ãƒãƒ¼ãŒjson-fileã®å ´åˆã®ã¿æœ‰åŠ¹ï¼ $ docker logs -f ãƒ»--tail ï¼Šã‚³ãƒãƒ³ãƒ‰ä¾‹ï¼Š æŒ‡å®šã—ãŸè¡Œæ•°ã ã‘ï¼Œãƒ­ã‚°ã‚’è¡¨ç¤ºã™ã‚‹ï¼ãƒ­ã‚®ãƒ³ã‚°ãƒ‰ãƒ©ã‚¤ãƒãƒ¼ãŒjson-fileã®å ´åˆã®ã¿æœ‰åŠ¹ï¼ $ docker logs --follow=true --tail=500 --log-driver ãƒ»ãƒ­ã‚®ãƒ³ã‚°ãƒ‰ãƒ©ã‚¤ãƒãƒ¼ã¨ã¯ ã‚³ãƒ³ãƒ†ãƒŠå†…ã®æ¨™æº–å‡ºåŠ›ï¼ˆ/dev/stdoutï¼‰ã¨æ¨™æº–ã‚¨ãƒ©ãƒ¼å‡ºåŠ›ï¼ˆ/dev/stderrï¼‰ã«å‡ºåŠ›ã•ã‚ŒãŸãƒ­ã‚°ã‚’ï¼Œãƒ•ã‚¡ã‚¤ãƒ«ã‚„APIã«å¯¾ã—ã¦è»¢é€ã™ã‚‹ï¼ $ docker run -d -it --log-driver --name : /bin/bash ãƒ»json-file æ¨™æº–å‡ºåŠ›ï¼æ¨™æº–ã‚¨ãƒ©ãƒ¼å‡ºåŠ›ã«å‡ºåŠ›ã•ã‚ŒãŸãƒ­ã‚°ã‚’ï¼Œ/var/lib/docker/containers/ï¼œã‚³ãƒ³ãƒ†ãƒŠIDï¼/ï¼œã‚³ãƒ³ãƒ†ãƒŠIDï¼-json.logãƒ•ã‚¡ã‚¤ãƒ«ã«è»¢é€ã™ã‚‹ï¼æ¨™æº–ã®è¨­å®šå€¤ã§ã‚ã‚‹ï¼ { \"log-driver\": \"json-file\", \"log-opts\": { \"max-size\": \"10m\", \"max-file\": \"3\" } } ãƒ»fluentd æ§‹é€ åŒ–ãƒ­ã‚°ã«å¤‰æ›ã—ï¼Œã‚µã‚¤ãƒ‰ã‚«ãƒ¼ã¨ã—ã¦ç¨¼åƒã™ã‚‹Fluentdã‚³ãƒ³ãƒ†ãƒŠã«é€ä¿¡ã™ã‚‹ï¼ECSã‚³ãƒ³ãƒ†ãƒŠã®awsfirelensãƒ‰ãƒ©ã‚¤ãƒãƒ¼ã¯ï¼Œfluentdãƒ‰ãƒ©ã‚¤ãƒãƒ¼ã‚’ãƒ©ãƒƒãƒ”ãƒ³ã‚°ã—ãŸã‚‚ã®ã§ã‚ã‚‹ï¼ å‚è€ƒï¼š https://docs.docker.com/config/containers/logging/fluentd/ https://aws.amazon.com/jp/blogs/news/under-the-hood-firelens-for-amazon-ecs-tasks/ { \"log-driver\": \"fluentd\", \"log-opts\": { \"fluentd-address\": \":24224\" } } ãƒ»none æ¨™æº–å‡ºåŠ›ï¼æ¨™æº–ã‚¨ãƒ©ãƒ¼å‡ºåŠ›ã«å‡ºåŠ›ã•ã‚ŒãŸãƒ­ã‚°ã‚’ï¼Œãƒ•ã‚¡ã‚¤ãƒ«ã‚„APIã«è»¢é€ã—ãªã„ï¼ ãƒ•ã‚¡ã‚¤ãƒ«ã«å‡ºåŠ›ã—ãªã„ã“ã¨ã§ï¼Œé–‹ç™ºç’°å¢ƒã®ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚µã‚¤ã‚ºã®è‚¥å¤§åŒ–ã‚’é˜²ãï¼ ãƒ»awslogs æ¨™æº–å‡ºåŠ›ï¼æ¨™æº–ã‚¨ãƒ©ãƒ¼å‡ºåŠ›ã«å‡ºåŠ›ã•ã‚ŒãŸãƒ­ã‚°ã‚’CloudWatch-APIã«é€ä¿¡ã™ã‚‹ï¼ å‚è€ƒï¼šhttps://docs.docker.com/config/containers/logging/awslogs/ { \"log-driver\": \"awslogs\", \"log-opts\": { \"awslogs-region\": \"us-east-1\" } } ãƒ»gcplogs æ¨™æº–å‡ºåŠ›ï¼æ¨™æº–ã‚¨ãƒ©ãƒ¼å‡ºåŠ›ã«å‡ºåŠ›ã•ã‚ŒãŸãƒ­ã‚°ã‚’ï¼ŒGoogle Cloud Loggingã®APIã«è»¢é€ã™ã‚‹ï¼ å‚è€ƒï¼šhttps://docs.docker.com/config/containers/logging/gcplogs/ { \"log-driver\": \"gcplogs\", \"log-opts\": { \"gcp-meta-name\": \"example-instance-12345\" } } å„ãƒ™ãƒ³ãƒ€ãƒ¼ã®ã‚¤ãƒ¡ãƒ¼ã‚¸ã®ãƒ­ã‚°å‡ºåŠ›å…ˆ ãƒ»Dockerã‚³ãƒ³ãƒ†ãƒŠã®æ¨™æº–å‡ºåŠ›ï¼æ¨™æº–ã‚¨ãƒ©ãƒ¼å‡ºåŠ› Linuxã§ã¯ï¼Œæ¨™æº–å‡ºåŠ›ã¯ã€/proc//fd/1ã€ï¼Œæ¨™æº–ã‚¨ãƒ©ãƒ¼å‡ºåŠ›ã¯ã€/proc//fd/2ã€ã§ã‚ã‚‹ï¼Dockerã‚³ãƒ³ãƒ†ãƒŠã§ã¯ï¼Œã€/dev/stdoutã€ãŒã€/proc/self/fd/1ã€ã®ã‚·ãƒ³ãƒœãƒªãƒƒã‚¯ãƒªãƒ³ã‚¯ï¼Œã¾ãŸã€/dev/stderrã€ãŒã€/proc//fd/2ã€ã®ã‚·ãƒ³ãƒœãƒªãƒƒã‚¯ãƒªãƒ³ã‚¯ã¨ã—ã¦è¨­å®šã•ã‚Œã¦ã„ã‚‹ï¼ [root@*****:/dev] ls -la total 4 drwxr-xr-x 5 root root 340 Oct 14 11:36 . drwxr-xr-x 1 root root 4096 Oct 14 11:28 .. lrwxrwxrwx 1 root root 11 Oct 14 11:36 core -> /proc/kcore lrwxrwxrwx 1 root root 13 Oct 14 11:36 fd -> /proc/self/fd crw-rw-rw- 1 root root 1, 7 Oct 14 11:36 full drwxrwxrwt 2 root root 40 Oct 14 11:36 mqueue crw-rw-rw- 1 root root 1, 3 Oct 14 11:36 null lrwxrwxrwx 1 root root 8 Oct 14 11:36 ptmx -> pts/ptmx drwxr-xr-x 2 root root 0 Oct 14 11:36 pts crw-rw-rw- 1 root root 1, 8 Oct 14 11:36 random drwxrwxrwt 2 root root 40 Oct 14 11:36 shm lrwxrwxrwx 1 root root 15 Oct 14 11:36 stderr -> /proc/self/fd/2 # æ¨™æº–ã‚¨ãƒ©ãƒ¼å‡ºåŠ› lrwxrwxrwx 1 root root 15 Oct 14 11:36 stdin -> /proc/self/fd/0 lrwxrwxrwx 1 root root 15 Oct 14 11:36 stdout -> /proc/self/fd/1 # æ¨™æº–å‡ºåŠ› crw-rw-rw- 1 root root 5, 0 Oct 14 11:36 tty crw-rw-rw- 1 root root 1, 9 Oct 14 11:36 urandom crw-rw-rw- 1 root root 1, 5 Oct 14 11:36 zero ãƒ»nginxã‚¤ãƒ¡ãƒ¼ã‚¸ å…¬å¼ã®nginxã‚¤ãƒ¡ãƒ¼ã‚¸ã¯ï¼Œ/dev/stdoutã¨ã„ã†ã‚·ãƒ³ãƒœãƒªãƒƒã‚¯ãƒªãƒ³ã‚¯ã‚’ï¼Œ/var/log/nginx/access.logãƒ•ã‚¡ã‚¤ãƒ«ã«ä½œæˆã—ã¦ã„ã‚‹ï¼ã¾ãŸï¼Œ/dev/stderrã¨ã„ã†ã‚·ãƒ³ãƒœãƒªãƒƒã‚¯ãƒªãƒ³ã‚¯ã‚’ï¼Œ/var/log/nginx/error.logãƒ•ã‚¡ã‚¤ãƒ«ã«ä½œæˆã—ã¦ã„ã‚‹ï¼ã“ã‚Œã«ã‚ˆã‚Šï¼Œã“ã‚Œã‚‰ã®ãƒ•ã‚¡ã‚¤ãƒ«ã«å¯¾ã™ã‚‹ãƒ­ã‚°ã®å‡ºåŠ›ã¯ï¼Œ/dev/stdoutã¨/dev/stderrã«è»¢é€ã•ã‚Œã‚‹ï¼ å‚è€ƒï¼šhttps://docs.docker.com/config/containers/logging/ ãƒ»php-fpmã‚¤ãƒ¡ãƒ¼ã‚¸ è¦å‹‰å¼·ï¼ "},"public/virtualization/virtualization_container_docker_dockerfile.html":{"url":"public/virtualization/virtualization_container_docker_dockerfile.html","title":"ğŸ“– ï¸Dockerfile","keywords":"","body":"Dockerfile ã¯ã˜ã‚ã« æœ¬ã‚µã‚¤ãƒˆã«ã¤ãã¾ã—ã¦ï¼Œä»¥ä¸‹ã‚’ã”èªè­˜ã®ã»ã©å®œã—ããŠé¡˜ã„ã„ãŸã—ã¾ã™ï¼ å‚è€ƒï¼šhttps://hiroki-it.github.io/tech-notebook-gitbook/ 01. ã‚³ãƒ³ãƒ†ãƒŠã«æ¥ç¶šã™ã‚‹ã¾ã§ã®æ‰‹é † æ‰‹é †ã®æµã‚Œ Docker Hubã‹ã‚‰ï¼Œãƒ™ãƒ¼ã‚¹ã¨ãªã‚‹ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹ï¼ DockerfileãŒã‚¤ãƒ¡ãƒ¼ã‚¸ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‹ã‚‰ãªã‚‹ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’ãƒ“ãƒ«ãƒ‰ï¼ ã‚³ãƒãƒ³ãƒ‰ã«ã‚ˆã£ã¦ï¼Œã‚¤ãƒ¡ãƒ¼ã‚¸ä¸Šã«ã‚³ãƒ³ãƒ†ãƒŠãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚’ç”Ÿæˆã—ï¼Œã‚³ãƒ³ãƒ†ãƒŠã‚’æ§‹ç¯‰ï¼ ã‚³ãƒãƒ³ãƒ‰ã«ã‚ˆã£ã¦ï¼Œåœæ­¢ä¸­ã®ã‚³ãƒ³ãƒ†ãƒŠã‚’èµ·å‹•ï¼ ã‚³ãƒãƒ³ãƒ‰ã«ã‚ˆã£ã¦ï¼Œèµ·å‹•ä¸­ã®ã‚³ãƒ³ãƒ†ãƒŠã«æ¥ç¶šï¼ 02. Dockerfileã®å®Ÿè£… ã‚¤ãƒ¡ãƒ¼ã‚¸ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®ç©ã¿é‡ã­ ãƒ»Dockerfileã®ä»•çµ„ã¿ ä»»æ„ã®ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’ãƒ™ãƒ¼ã‚¹ã¨ã—ã¦ï¼Œæ–°ã—ã„ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’ãƒ“ãƒ«ãƒ‰ã™ã‚‹ãŸã‚ã«ã¯ï¼Œãƒ™ãƒ¼ã‚¹ã®ã‚¤ãƒ¡ãƒ¼ã‚¸ã®ä¸Šã«ï¼Œä»–ã®ã‚¤ãƒ¡ãƒ¼ã‚¸ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚’ç©ã¿é‡ã­ã‚‹å¿…è¦ãŒã‚ã‚‹ï¼ã“ã®æ™‚ï¼ŒDockerfileã‚’ç”¨ã„ã¦ï¼Œå„å‘½ä»¤ã«ã‚ˆã£ã¦ã‚¤ãƒ¡ãƒ¼ã‚¸ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚’ç©ã¿é‡ã­ã¦ã„ãï¼ ãƒ»Dockerfileã®è¨˜è¿°æ–¹æ³• ä»»æ„ã®ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’ãƒ™ãƒ¼ã‚¹ã¨ã—ã¦ï¼Œæ–°ã—ã„ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’ãƒ“ãƒ«ãƒ‰ã™ã‚‹ãŸã‚ã«ã¯ï¼Œä»¥ä¸‹ã®5ã¤é †ç•ªã§å‘½ä»¤ã‚’ç”¨ã„ã¦ï¼Œã‚¤ãƒ¡ãƒ¼ã‚¸ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚’ç©ã¿é‡ã­ã¦ã„ãï¼å‘½ä»¤ã¯ï¼Œæ…£ä¾‹çš„ã«å¤§æ–‡å­—ã§è¨˜è¿°ã™ã‚‹ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š Nginxã®ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’ãƒ“ãƒ«ãƒ‰ã™ã‚‹ãŸã‚ã®Dockerfileã‚’ç¤ºã™ï¼å‘½ä»¤ã®ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã®è¨˜è¿°å½¢å¼ã«ã¯ï¼Œæ–‡å­—åˆ—å½¢å¼ï¼ŒJSONå½¢å¼ãŒã‚ã‚‹ï¼ã“ã“ã§ã¯ï¼ŒJSONå½¢å¼ã§è¨˜è¿°ã™ã‚‹ï¼ # ãƒ™ãƒ¼ã‚¹ã®ã‚¤ãƒ¡ãƒ¼ã‚¸ï¼ˆCentOSï¼‰ã‚’ï¼Œã‚³ãƒ³ãƒ†ãƒŠã«ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ« FROM centos:8 # ubuntuä¸Šã«ï¼Œnginxã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ« RUN yum update -y \\ && yum install -y \\ nginx # ãƒ›ã‚¹ãƒˆOSã®è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã‚’ï¼Œã‚³ãƒ³ãƒ†ãƒŠå´ã®æŒ‡å®šãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ã‚³ãƒ”ãƒ¼ COPY infra/docker/web/nginx.conf /etc/nginx/nginx.conf # nginxã‚’ãƒ‡ãƒ¼ãƒ¢ãƒ³èµ·å‹• CMD [\"/usr/sbin/nginx\", \"-g\", \"daemon off;\"] # ã‚³ãƒ³ãƒ†ãƒŠã®ãƒãƒ¼ãƒˆã‚’é–‹æ”¾ã‚’æ˜ç¤ºã™ã‚‹ï¼ã“ã‚Œã¯ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ã¨ã—ã¦ã®æ©Ÿèƒ½ã—ã‹ãªã„ï¼ EXPOSE 80 å‘½ä»¤ å‡¦ç† FROM ãƒ™ãƒ¼ã‚¹ã®ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’ï¼Œã‚³ãƒ³ãƒ†ãƒŠã«ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«. RUN ãƒ™ãƒ¼ã‚¹ã‚¤ãƒ¡ãƒ¼ã‚¸ä¸Šã«ï¼Œã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«. COPY ãƒ»ãƒ›ã‚¹ãƒˆOSã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚¤ãƒ¡ãƒ¼ã‚¸ãƒ¬ã‚¤ãƒ¤ãƒ¼åŒ–ã—ï¼Œã‚³ãƒ³ãƒ†ãƒŠã®æŒ‡å®šãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ã‚³ãƒ”ãƒ¼.ãƒ»ã‚¤ãƒ¡ãƒ¼ã‚¸ã®ãƒ“ãƒ«ãƒ‰æ™‚ã«ã‚³ãƒ”ãƒ¼ã•ã‚Œã‚‹ã ã‘ã§ï¼Œãƒ“ãƒ«ãƒ‰å¾Œã®ã‚³ãƒ¼ãƒ‰ã®å¤‰æ›´ã¯åæ˜ ã•ã‚Œãªã„ï¼ãƒ»nginx.confãƒ•ã‚¡ã‚¤ãƒ«ï¼Œphp.iniãƒ•ã‚¡ã‚¤ãƒ«ï¼Œãªã©ã®è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ›ã‚¹ãƒˆOSã‹ã‚‰ã‚³ãƒ³ãƒ†ãƒŠã«ã‚³ãƒ”ãƒ¼ã—ãŸã„æ™‚ã«ã‚ˆãä½¿ã†ï¼ CMD ã‚¤ãƒ¡ãƒ¼ã‚¸ã®ãƒ—ãƒ­ã‚»ã‚¹ã®èµ·å‹•ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œï¼runã‚³ãƒãƒ³ãƒ‰ã®å¼•æ•°ã¨ã—ã¦ï¼Œä¸Šæ›¸ãã§ãã‚‹ï¼ VOLUME Volumeãƒã‚¦ãƒ³ãƒˆã‚’è¡Œã†ï¼COPYã¨ã¯ç•°ãªã‚Šï¼Œãƒ“ãƒ«ãƒ‰å¾Œã®ã‚³ãƒ¼ãƒ‰ã®å¤‰æ›´ãŒåæ˜ ã•ã‚Œã‚‹ï¼Docker Composeã§è¨˜è¿°ã—ãŸæ–¹ãŒè‰¯ã„ï¼ EXPOSE ã‚³ãƒ³ãƒ†ãƒŠã®ãƒãƒ¼ãƒˆã‚’é–‹æ”¾ã™ã‚‹ï¼ã¾ãŸï¼Œã‚¤ãƒ¡ãƒ¼ã‚¸ã®åˆ©ç”¨è€…ã«ã¨ã£ã¦ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³æ©Ÿèƒ½ã‚‚ã‚ã‚Šï¼Œãƒãƒ¼ãƒˆãƒãƒƒãƒ”ãƒ³ã‚°ã‚’å®Ÿè¡Œã™ã‚‹æ™‚ã«ä½¿ç”¨å¯èƒ½ãªã‚³ãƒ³ãƒ†ãƒŠãƒãƒ¼ãƒˆã¨ã—ã¦ä¿è¨¼ã™ã‚‹æ©Ÿèƒ½ã‚‚ã‚ã‚‹ï¼å‚è€ƒï¼šãƒ»https://docs.docker.com/engine/reference/builder/#exposeãƒ»https://www.whitesourcesoftware.com/free-developer-tools/blog/docker-expose-port/ã¾ãŸåŠ ãˆã¦ï¼Œãƒ—ãƒ­ã‚»ã‚¹è‡ªä½“ãŒå‘½ä»¤ã‚’ãƒªãƒƒã‚¹ãƒ³ã§ãã‚‹ã‚ˆã†ã«ãƒãƒ¼ãƒˆã‚’è¨­å®šã™ã‚‹å¿…è¦ãŒã‚ã‚‹ï¼ãŸã ã—ï¼Œå¤šãã®å ´åˆæ¨™æº–ã§ã“ã‚ŒãŒè¨­å®šã•ã‚Œã¦ã„ã‚‹ï¼ï¼ˆä¾‹ï¼šPHP-FPMã§ã¯ï¼Œ/usr/local/etc/www.conf.defaultãƒ•ã‚¡ã‚¤ãƒ«ã¨/usr/local/etc/php-fpm.d/www.confãƒ•ã‚¡ã‚¤ãƒ«ã«ã¯ï¼Œlisten = 127.0.0.1:9000ã®è¨­å®šãŒã‚ã‚‹ï¼‰ ENTRYPOINT ã‚¤ãƒ¡ãƒ¼ã‚¸ã®ãƒ—ãƒ­ã‚»ã‚¹ã®èµ·å‹•ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œï¼CMDã¨ã¯ç•°ãªã‚Šï¼Œå¾Œã‹ã‚‰ä¸Šæ›¸ãå®Ÿè¡Œã§ããªã„ï¼ä½¿ç”¨è€…ã«ï¼Œã‚³ãƒ³ãƒ†ãƒŠã®èµ·å‹•æ–¹æ³•ã‚’å¼·åˆ¶ã•ã›ãŸã„å ´åˆã«é©ã™ã‚‹ï¼ ENV OSä¸Šã®ã‚³ãƒãƒ³ãƒ‰å‡¦ç†ã§æ‰±ãˆã‚‹å¤‰æ•°ã‚’å®šç¾©ã™ã‚‹ï¼Dockerfileã®å‘½ä»¤ã§ã¯æ‰±ãˆãªã„ï¼ARGã¨ã®é•ã„ã®ä¾‹ã«ã¤ã„ã¦ã¯ä¸‹è¨˜ï¼ ARG Dockerfikeã®å‘½ä»¤ã§æ‰±ãˆã‚‹å¤‰æ•°ã‚’å®šç¾©ã™ã‚‹ï¼OSä¸Šã®ã‚³ãƒãƒ³ãƒ‰å‡¦ç†ã§ã¯æ‰±ãˆãªã„ï¼ENVã¨ã®é•ã„ã®ä¾‹ã«ã¤ã„ã¦ã¯ä¸‹è¨˜ï¼ ADD ãƒ»ãƒ›ã‚¹ãƒˆOSã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ï¼Œã‚³ãƒ³ãƒ†ãƒŠã®æŒ‡å®šãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ã‚³ãƒ”ãƒ¼ï¼ˆCOPYã¨åŒã˜ï¼‰ãƒ»ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆã‹ã‚‰ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ï¼Œè§£å‡ã‚‚è¡Œã†ï¼ãƒ»ã‚¤ãƒ¡ãƒ¼ã‚¸ã®ãƒ“ãƒ«ãƒ‰æ™‚ã«ã‚³ãƒ”ãƒ¼ã•ã‚Œã‚‹ã ã‘ã§ï¼Œãƒ“ãƒ«ãƒ‰å¾Œã®ã‚³ãƒ¼ãƒ‰ã®å¤‰æ›´ã¯åæ˜ ã•ã‚Œãªã„ï¼ WORKDIR çµ¶å¯¾ãƒ‘ã‚¹ã«ã‚ˆã‚‹æŒ‡å®šã§ï¼Œç¾åœ¨ã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’å¤‰æ›´. ãƒ»CMDã®æ±ºã‚æ–¹ Dockerfileã§CMDã‚’æŒ‡å®šã—ãªã„å ´åˆï¼Œã‚¤ãƒ¡ãƒ¼ã‚¸ã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®ãƒã‚¤ãƒŠãƒªãƒ•ã‚¡ã‚¤ãƒ«ãŒå‰²ã‚Šå½“ã¦ã‚‰ã‚Œã‚‹ï¼ä¸€æ—¦ï¼Œãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®ãƒã‚¤ãƒŠãƒªãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç¢ºèªã—ãŸå¾Œã«ï¼Œã“ã‚Œã‚’Dockerfileã«æ˜ç¤ºçš„ã«å®Ÿè£…ã™ã‚‹ã‚ˆã†ã«ã™ã‚‹ï¼ CONTAINER ID IMAGE COMMAND CREATED STATUS PORTS NAMES 2b2d3dfafee8 xxxxx \"/bin/sh\" 11 seconds ago Up 8 seconds 0.0.0.0:8000->8000/tcp xxxxx é™çš„å‹ä»˜ã‘è¨€èªã§ã¯ãƒ—ãƒ­ã‚»ã‚¹ã®èµ·å‹•æ™‚ã«ï¼Œä»£ã‚ã‚Šã«ã‚¢ãƒ¼ãƒ†ã‚£ãƒ•ã‚¡ã‚¯ãƒˆã®ãƒã‚¤ãƒŠãƒªãƒ•ã‚¡ã‚¤ãƒ«ã‚’å®Ÿè¡Œã—ã¦ã‚‚è‰¯ã„ï¼ãã®å ´åˆï¼Œbinãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ãƒã‚¤ãƒŠãƒªãƒ•ã‚¡ã‚¤ãƒ«ã¨ã—ã¦ã®ã‚¢ãƒ¼ãƒ†ã‚£ãƒ•ã‚¡ã‚¯ãƒˆã‚’é…ç½®ã™ã‚‹ã“ã¨ã«ãªã‚‹ï¼ã—ã‹ã—ï¼Œbinãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã¸ã®ã‚¢ã‚¯ã‚»ã‚¹æ¨©é™ãŒãªã„ã“ã¨ãŒã‚ã‚‹ãŸã‚ï¼Œãã®å ´åˆã¯ï¼Œä¸€ã¤ä¸‹ã«ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’ä½œæˆã—ï¼Œãã“ã«ãƒã‚¤ãƒŠãƒªãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç½®ãã‚ˆã†ã«ã™ã‚‹ï¼ # /go/bin ã«ã‚¢ã‚¯ã‚»ã‚¹ã§ããªã„æ™‚ã¯ï¼Œ/go/bin/cmdã«ã‚¢ãƒ¼ãƒ†ã‚£ãƒ•ã‚¡ã‚¯ãƒˆã‚’ç½®ãï¼ ERROR: for xxx-container Cannot start service go: OCI runtime create failed: container_linux.go:367: starting container process caused: exec: \"/go/bin\": permission denied: unknown ãƒ»ENTRYPOINTã®æ³¨æ„ç‚¹ ã‚¤ãƒ¡ãƒ¼ã‚¸ã®ãƒ—ãƒ­ã‚»ã‚¹ã®èµ·å‹•ã‚³ãƒãƒ³ãƒ‰ã‚’å¾Œã‹ã‚‰ä¸Šæ›¸ãã§ããªããªã‚‹ãŸã‚ï¼Œrunã‚³ãƒãƒ³ãƒ‰ã®å¼•æ•°ã¨ã—ã¦æ–°ã—ã„ã‚³ãƒãƒ³ãƒ‰ã‚’æ¸¡ã›ãšã«ï¼Œãƒ‡ãƒãƒƒã‚°ãŒã§ããªã„ã“ã¨ãŒã‚ã‚‹ï¼ # ä¸Šæ›¸ãã§ããšï¼Œå¤±æ•—ã—ã¦ã—ã¾ã†ï¼ $ docker run --rm -it /bin/bash ãƒ»ENVã¨ARGã®é•ã„ ä¸€ã¤ç›®ã«ï¼ŒENVãŒä½¿ãˆã¦ï¼ŒARGãŒä½¿ãˆãªã„ä¾‹ï¼ # ENVã¯ï¼ŒOSä¸Šã®ã‚³ãƒãƒ³ãƒ‰å‡¦ç†ã§æ‰±ãˆã‚‹å¤‰æ•°ã‚’å®šç¾© ARG PYTHON_VERSION=\"3.8.0\" RUN pyenv install ${PYTHON_VERSION} # ARGã¯ï¼ŒOSä¸Šã®ã‚³ãƒãƒ³ãƒ‰å‡¦ç†ã§ã¯æ‰±ãˆãªã„ ARG PYTHON_VERSION=\"3.8.0\" RUN pyenv install ${PYTHON_VERSION} # ===> å¤‰æ•°ã‚’å±•é–‹ã§ããªã„ äºŒã¤ç›®ã«ï¼ŒARGãŒä½¿ãˆã¦ï¼ŒENVãŒä½¿ãˆãªã„ä¾‹ï¼ # ARGã¯,Dockerfikeã®å‘½ä»¤ã§æ‰±ãˆã‚‹å¤‰æ•°ã‚’å®šç¾© ARG OS_VERSION=\"8\" FROM centos:${OS_VERSION} # ENVã¯ï¼ŒOSä¸Šã®ã‚³ãƒãƒ³ãƒ‰å‡¦ç†ã§ã¯æ‰±ãˆãªã„ ENV OS_VERSION \"8\" FROM centos:${OS_VERSION} # ===> å¤‰æ•°ã‚’å±•é–‹ã§ããªã„ ä¸‰ã¤ç›®ã«ï¼Œã“ã‚Œã‚‰ã®é•ã„ã«ã‚ˆã‚‹å¯èª­æ€§ã®æ‚ªã•ã®å¯¾ç­–ã¨ã—ã¦ï¼ŒENVã¨ARGã‚’çµ„ã¿åˆã‚ã›ãŸä¾‹ï¼ # æœ€åˆã«å…¨ã¦ï¼ŒARGã§å®šç¾© ARG CENTOS_VERSION=\"8\" ARG PYTHON_VERSION=\"3.8.0\" # å¤‰æ•°å±•é–‹ã§ãã‚‹ FROM centos:${OS_VERSION} # ARGã‚’äº‹å‰ã«å®£è¨€ ARG PYTHON_VERSION # å¿…è¦ã«å¿œã˜ã¦ï¼Œäº‹å‰ã«ENVã«è©°ã‚æ›¿ãˆã‚‹ï¼ ENV PYTHON_VERSION ${PYTHON_VERSION} # å¤‰æ•°å±•é–‹ã§ãã‚‹ RUN pyenv install ${PYTHON_VERSION} ãƒ»Docker Hubã«å¯¾ã™ã‚‹ç¶™ç¶šçš„ã‚¤ãƒ³ãƒ†ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ æ–¹æ³• ä»•çµ„ã¿ GitHub Actions GitHubãŒï¼ŒDocker Hubã«å¯¾ã—ã¦ï¼Œpushã‚’è¡Œã†ï¼ Circle CI GitHubãŒï¼ŒCircle CIã«å¯¾ã—ã¦ï¼Œé€ä¿¡WebHookã‚’è¡Œã†ï¼ Docker Hub Auto Build GitHubãŒï¼ŒDocker Hubã«å¯¾ã—ã¦ï¼Œé€ä¿¡WebHookã‚’è¡Œã†ï¼ ãƒ»Dockerfileã‚’ä½¿ç”¨ã™ã‚‹ãƒ¡ãƒªãƒƒãƒˆ Dockerfileã‚’ç”¨ã„ãªã„å ´åˆï¼Œå„ã‚¤ãƒ¡ãƒ¼ã‚¸ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã‚’æ‰‹å‹•ã§è¡Œã‚ãªã‘ã‚Œã°ãªã‚‰ãªã„ï¼ã—ã‹ã—ï¼ŒDockerfileã‚’ç”¨ã„ã‚‹ã“ã¨ã§ï¼Œã“ã‚Œã‚’è‡ªå‹•åŒ–ã§ãã‚‹ï¼ ã‚¤ãƒ¡ãƒ¼ã‚¸ã®ãƒ‡ãƒãƒƒã‚° ï¼Šã‚³ãƒãƒ³ãƒ‰ä¾‹ï¼Š ãƒ“ãƒ«ãƒ‰ã«å¤±æ•—ã—ãŸã‚¤ãƒ¡ãƒ¼ã‚¸ã‹ã‚‰ã‚³ãƒ³ãƒ†ãƒŠã‚’æ§‹ç¯‰ã—ï¼Œæ¥ç¶šã™ã‚‹ï¼rmã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’è¨­å®šã—ï¼Œæ¥ç¶šã®åˆ‡æ–­å¾Œã«ã‚³ãƒ³ãƒ†ãƒŠã‚’å‰Šé™¤ã™ã‚‹ï¼Dockerfileã«ãŠã„ã¦ï¼Œã‚¤ãƒ¡ãƒ¼ã‚¸ã®ãƒ—ãƒ­ã‚»ã‚¹ã®èµ·å‹•ã‚³ãƒãƒ³ãƒ‰ã‚’ENTRYPOINTã§è¨­å®šã—ã¦ã„ã‚‹å ´åˆã¯ï¼Œå¾Œã‹ã‚‰ä¸Šæ›¸ãã§ããªããªã‚‹ãŸã‚ï¼Œrunã‚³ãƒãƒ³ãƒ‰ã®å¼•æ•°ã¨ã—ã¦æ–°ã—ã„ã‚³ãƒãƒ³ãƒ‰ã‚’æ¸¡ã›ãšã«ï¼Œãƒ‡ãƒãƒƒã‚°ãŒã§ããªã„ã“ã¨ãŒã‚ã‚‹ï¼ $ docker run --rm -it /bin/bash # ã‚³ãƒ³ãƒ†ãƒŠã®ä¸­ root@xxxxxxxxxx: ã‚³ãƒ³ãƒ†ãƒŠãƒ¬ã‚¤ãƒ¤ãƒ¼ ãƒ»ã‚³ãƒ³ãƒ†ãƒŠãƒ¬ã‚¤ãƒ¤ãƒ¼ã¨ã¯ ã‚¤ãƒ¡ãƒ¼ã‚¸ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®ä¸Šã«ç©ã¿é‡ã­ã‚‰ã‚Œã‚‹ 02-02. ãƒ™ãƒ¼ã‚¹ã‚¤ãƒ¡ãƒ¼ã‚¸ ã‚¤ãƒ¡ãƒ¼ã‚¸ãƒªãƒã‚¸ãƒˆãƒª ãƒ»ã‚¤ãƒ¡ãƒ¼ã‚¸ãƒªãƒã‚¸ãƒˆãƒªã¨ã¯ ã‚¤ãƒ¡ãƒ¼ã‚¸ã¯ï¼Œå®Ÿè¡ŒOSã«ã‚ˆã‚‰ãšã«ä¸€è²«ã—ã¦ãƒ“ãƒ«ãƒ‰ã§ãã‚‹ãŸã‚ï¼Œé…å¸ƒã§ãã‚‹ï¼å„ã‚¤ãƒ¡ãƒ¼ã‚¸ãƒªãƒã‚¸ãƒˆãƒªï¼ˆDockerHubï¼ŒECRï¼Œãªã©ï¼‰ã«ã¯ï¼Œã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºã™ã‚‹ä¸Šã§ã®ãƒ™ãƒ¼ã‚¹ã¨ãªã‚‹ã‚¤ãƒ¡ãƒ¼ã‚¸ãŒæä¾›ã•ã‚Œã¦ã„ã‚‹ï¼ ãƒ™ãƒ¼ã‚¹ã‚¤ãƒ¡ãƒ¼ã‚¸ ãƒ»ãƒ™ãƒ¼ã‚¹ã‚¤ãƒ¡ãƒ¼ã‚¸ã®ç¨®é¡ ã‚¤ãƒ¡ãƒ¼ã‚¸ ç‰¹å¾´ ç›¸æ€§ã®è‰¯ã„ã‚·ã‚¹ãƒ†ãƒ ä¾‹ scratch ä»¥ä¸‹ã®é€šã‚Šï¼Œä½•ã‚‚æŒã£ã¦ã„ãªã„ãƒ»OSï¼šç„¡ãƒ»ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ï¼šç„¡ãƒ»ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ãƒãƒãƒ¼ã‚¸ãƒ£ï¼šç„¡ ï¼Ÿ BusyBox ãƒ»OSï¼šLinuxï¼ˆâ€»ãƒ‡ã‚£ã‚¹ãƒˆãƒªãƒ“ãƒ¥ãƒ¼ã‚·ãƒ§ãƒ³ã§ã¯ãªã„ï¼‰ãƒ»ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ï¼šåŸºæœ¬ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ãƒ„ãƒ¼ãƒ«ãƒ»ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ãƒãƒãƒ¼ã‚¸ãƒ£ï¼šç„¡ çµ„ã¿è¾¼ã¿ã‚·ã‚¹ãƒ†ãƒ  Alpine Linux ãƒ»OSï¼šLinuxï¼ˆâ€»ãƒ‡ã‚£ã‚¹ãƒˆãƒªãƒ“ãƒ¥ãƒ¼ã‚·ãƒ§ãƒ³ã§ã¯ãªã„ï¼‰ãƒ»ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ï¼šåŸºæœ¬ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ãƒ„ãƒ¼ãƒ«ãƒ»ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ãƒãƒãƒ¼ã‚¸ãƒ£ï¼šApk ï¼Ÿ ãƒ»å¯¾å¿œå¯èƒ½ãªCPUã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã®ç¨®é¡ Dockerã¯å…¨ã¦ã®PCã§ç¨¼åƒã§ãã‚‹ã‚ã‘ã§ã¯ãªãï¼Œã‚¤ãƒ¡ãƒ¼ã‚¸ã”ã¨ã«å¯¾å¿œå¯èƒ½ãªCPUã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ï¼ˆAMDç³»ï¼ŒARMç³»ï¼Œãªã©ï¼‰ãŒã‚ã‚‹ï¼åŒã˜OSã§ã‚‚ï¼Œæ©Ÿç¨®ã”ã¨ã«æ­è¼‰ã•ã‚Œã‚‹CPUã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã¯ç•°ãªã‚‹ï¼ä¾‹ãˆã°ï¼ŒMacBook 2020 ã«ã¯Intelï¼Œã¾ãŸMacBook 2021ï¼ˆM1 Macï¼‰ã«ã¯ARMãƒ™ãƒ¼ã‚¹ã®ç‹¬è‡ªCPUãŒæ­è¼‰ã•ã‚Œã¦ã„ã‚‹ãŸã‚ï¼ŒARMã«å¯¾å¿œã—ãŸã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’é¸ã¶å¿…è¦ãŒã‚ã‚‹ï¼ãŸã ã—ï¼Œã‚¤ãƒ¡ãƒ¼ã‚¸ãŒOSã®CPUã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã«å¯¾å¿œã—ã¦ã„ã‚‹ã‹ã©ã†ã‹ã‚’é–‹ç™ºè€…ãŒæ°—ã«ã™ã‚‹å¿…è¦ã¯ãªãï¼Œdocker pullæ™‚ã«ï¼ŒOSã®CPUã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã«å¯¾å¿œã—ãŸã‚¤ãƒ¡ãƒ¼ã‚¸ãŒè‡ªå‹•çš„ã«é¸æŠã•ã‚Œã‚‹ã‚ˆã†ã«ãªã£ã¦ã„ã‚‹ï¼ å‚è€ƒï¼šhttps://github.com/docker-library/official-images#architectures-other-than-amd64 ãƒ»ãƒãƒ¼ã‚¸ãƒ§ãƒ³ ã‚¤ãƒ¡ãƒ¼ã‚¸ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã«ã¯ç¨®é¡ãŒã‚ã‚Šï¼Œè¿½è·¡ã§ãã‚‹ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚¢ãƒƒãƒ—ãŒç•°ãªã‚‹ï¼ã“ã“ã§ã¯ï¼Œcomposerã®ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’ä¾‹ã«æŒ™ã’ã‚‹ï¼ å‚è€ƒï¼šhttps://hub.docker.com/_/composer/?tab=description&page=1&ordering=last_updated composerãƒãƒ¼ã‚¸ãƒ§ãƒ³ è¿½è·¡ã§ãã‚‹ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚¢ãƒƒãƒ— 2.0.9 ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’ç›´æŒ‡å®šã—ï¼Œè¿½è·¡ã—ãªã„ï¼ 2.0 ã€Œ2.0.Xã€ã®ãƒã‚¤ãƒŠãƒ¼ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆã®ã¿ã‚’è¿½è·¡ã™ã‚‹ï¼ 2 ã€Œ2.Xã€ã¨ã€Œ2.0.Xã€ã®ãƒã‚¤ãƒŠãƒ¼ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆã®ã¿ã‚’è¿½è·¡ã™ã‚‹ï¼ latest ãƒ¡ã‚¸ãƒ£ãƒ¼ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆã¨ãƒã‚¤ãƒŠãƒ¼ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆã‚’è¿½è·¡ã™ã‚‹ï¼ 03-02 ã‚¤ãƒ¡ãƒ¼ã‚¸ã®è»½é‡åŒ– ãƒ—ãƒ­ã‚»ã‚¹å˜ä½ã«ã‚ˆã‚‹Dockerfileã®åˆ†å‰² ã“ã‚Œã¯ï¼ŒDockerã®åŸå‰‡ã§ã‚ã‚‹ï¼ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ç¨¼åƒã•ã›ã‚‹ã«ã¯ï¼Œæœ€ä½é™ï¼ŒWebã‚µãƒ¼ãƒãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢ï¼Œã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ï¼ŒDBMSãŒå¿…è¦ã§ã‚ã‚‹ï¼ã“ã‚Œã‚‰ã‚’ï¼Œå€‹åˆ¥ã®ã‚³ãƒ³ãƒ†ãƒŠã§ç¨¼åƒã•ã›ï¼Œãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã§æ¥ç¶šã™ã‚‹ã‚ˆã†ã«ã™ã‚‹ï¼ ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’å‰Šé™¤ Unixãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹ã¨ï¼Œã‚­ãƒ£ãƒƒã‚·ãƒ¥ãŒæ®‹ã‚‹ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š FROM centos:8 RUN dnf upgrade -y \\ && dnf install -y \\ curl \\ # ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿å‰Šé™¤ && dnf clean all \\ # ã‚­ãƒ£ãƒƒã‚·ãƒ¥å‰Šé™¤ && rm -rf /var/cache/dnf RUNã‚³ãƒãƒ³ãƒ‰ã‚’ã¾ã¨ã‚ã‚‹ Dockerfileã®å„å‘½ä»¤ã«ã‚ˆã£ã¦ï¼Œã‚¤ãƒ¡ãƒ¼ã‚¸ ãƒ¬ã‚¤ãƒ¤ãƒ¼ãŒä¸€ã¤å¢—ãˆã¦ã—ã¾ã†ãŸã‚ï¼ŒåŒã˜å‘½ä»¤ã«ç•°ãªã‚‹ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’ä¸ãˆã‚‹æ™‚ã¯ï¼Œã“ã‚Œã‚’ä¸€ã¤ã«ã¾ã¨ã‚ã¦ã—ã¾ã†æ–¹ãŒè‰¯ã„ï¼ä¾‹ãˆã°ï¼Œä»¥ä¸‹ã®ã‚ˆã†ãªæ™‚ï¼Œ # ãƒ™ãƒ¼ã‚¹ã‚¤ãƒ¡ãƒ¼ã‚¸ä¸Šã«ï¼Œè¤‡æ•°ã®ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ« RUN yum -y isntall httpd RUN yum -y install php RUN yum -y install php-mbstring RUN yum -y install php-pear ã“ã‚Œã¯ï¼Œä»¥ä¸‹ã®ã‚ˆã†ã«ä¸€è¡Œã§ã¾ã¨ã‚ã‚‰ã‚Œã‚‹ï¼ã‚¤ãƒ¡ãƒ¼ã‚¸ãƒ¬ã‚¤ãƒ¤ãƒ¼ãŒå°‘ãªããªã‚Šï¼Œã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’è»½é‡åŒ–ã§ãã‚‹ï¼ # ãƒ™ãƒ¼ã‚¹ã‚¤ãƒ¡ãƒ¼ã‚¸ä¸Šã«ï¼Œè¤‡æ•°ã®ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ« RUN yum -y install httpd php php-mbstring php-pear ã•ã‚‰ã«ï¼Œã“ã‚Œã¯ä»¥ä¸‹ã®ã‚ˆã†ã«ã‚‚æ›¸ãã“ã¨ãŒã§ãã‚‹ï¼ # ãƒ™ãƒ¼ã‚¹ã‚¤ãƒ¡ãƒ¼ã‚¸ä¸Šã«ï¼Œè¤‡æ•°ã®ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ« RUN yum -y install \\ httpd \\ php \\ php-mbstring \\ php-pear ãƒãƒ«ãƒã‚¹ãƒ†ãƒ¼ã‚¸ãƒ“ãƒ«ãƒ‰ ãƒ»ãƒãƒ«ãƒã‚¹ãƒ†ãƒ¼ã‚¸ãƒ“ãƒ«ãƒ‰ã¨ã¯ ä¸€ã¤ã®Dockerfileå†…ã«è¤‡æ•°ã®ç‹¬ç«‹ã—ãŸã‚¹ãƒ†ãƒ¼ã‚¸ã‚’å®šç¾©ã™ã‚‹æ–¹æ³•ï¼ä»¥ä¸‹ã®æ‰‹é †ã§ä½œæˆã™ã‚‹ï¼ ã‚·ãƒ³ã‚°ãƒ«ã‚¹ãƒ†ãƒ¼ã‚¸ãƒ“ãƒ«ãƒ‰ã«æˆåŠŸã™ã‚‹Dockerfileã‚’ä½œæˆã™ã‚‹ï¼ ãƒ“ãƒ«ãƒ‰ã«ã‚ˆã£ã¦ç”Ÿæˆã•ã‚ŒãŸãƒã‚¤ãƒŠãƒªãƒ•ã‚¡ã‚¤ãƒ«ãŒã©ã“ã«é…ç½®ã•ã‚Œã‚‹ã‹ã‚’å ´æ‰€ã‚’èª¿ã¹ã‚‹ï¼ Dockerfileã§ï¼ŒäºŒã¤ç›®ã®FROMã‚’å®£è¨€ã™ã‚‹ï¼ ä¸€ã¤ç›®ã®ã‚¹ãƒ†ãƒ¼ã‚¸ã§ï¼Œãƒã‚¤ãƒŠãƒªãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã™ã‚‹ã ã‘ã§çµ‚ã‚ã‚‰ã›ã‚‹ï¼ äºŒã¤ç›®ã®ã‚¹ãƒ†ãƒ¼ã‚¸ã§ï¼ŒUnixãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹ï¼ã¾ãŸï¼Œãƒã‚¤ãƒŠãƒªãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä¸€ã¤ç›®ã®ã‚¹ãƒ†ãƒ¼ã‚¸ã‹ã‚‰ã‚³ãƒ”ãƒ¼ã™ã‚‹ï¼ ãƒ»ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã•ã‚ŒãŸãƒã‚¤ãƒŠãƒªãƒ•ã‚¡ã‚¤ãƒ«ã‚’å†åˆ©ç”¨ ï¼Šå®Ÿè£…ä¾‹ï¼Š # ä¸­é–“ã‚¤ãƒ¡ãƒ¼ã‚¸ FROM golang:1.7.3 AS builder WORKDIR /go/src/github.com/alexellis/href-counter/ RUN go get -d -v golang.org/x/net/html COPY app.go . RUN CGO_ENABLED=0 GOOS=linux go build -a -installsuffix cgo -o app . # æœ€çµ‚ã‚¤ãƒ¡ãƒ¼ã‚¸ FROM alpine:latest RUN apk --no-cache add ca-certificates WORKDIR /root/ COPY --from=builder /go/src/github.com/alexellis/href-counter/app . CMD [\"./app\"] ãƒ»å®Ÿè¡Œç’°å¢ƒåˆ¥ã«ã‚¹ãƒ†ãƒ¼ã‚¸ã‚’åˆ†ã‘ã‚‹ ï¼Šå®Ÿè£…ä¾‹ï¼Š #=================== # Global ARG #=================== ARG NGINX_VERSION=\"1.19\" ARG LABEL=\"Hiroki \" #=================== # Build Stage #=================== FROM nginx:${NGINX_VERSION} as build RUN apt-get update -y \\ && apt-get install -y \\ curl \\ vim \\ # ã‚­ãƒ£ãƒƒã‚·ãƒ¥å‰Šé™¤ && apt-get clean #=================== # Develop Stage #=================== FROM build as develop LABEL mantainer=${LABEL} COPY ./infra/docker/www/develop.nginx.conf /etc/nginx/nginx.conf CMD [\"/usr/sbin/nginx\", \"-g\", \"daemon off;\"] #=================== # Production Stage #=================== FROM build as production LABEL mantainer=${LABEL} COPY ./infra/docker/www/production.nginx.conf /etc/nginx/nginx.conf CMD [\"/usr/sbin/nginx\", \"-g\", \"daemon off;\"] å¯èƒ½ãªé™ã‚ŠOSã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’ãƒ™ãƒ¼ã‚¹ã¨ã—ãªã„ ãƒ»OSã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’ãƒ™ãƒ¼ã‚¹ã¨ã—ãŸå ´åˆï¼ˆæ‚ªã„ä¾‹ï¼‰ OSãƒ™ãƒ³ãƒ€ãƒ¼ãŒæä¾›ã™ã‚‹ãƒ™ãƒ¼ã‚¹ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’ä½¿ç”¨ã™ã‚‹ã¨ï¼Œä¸è¦ãªãƒã‚¤ãƒŠãƒªãƒ•ã‚¡ã‚¤ãƒ«ãŒå«ã¾ã‚Œã¦ã—ã¾ã†ï¼åŸå‰‡ã¨ã—ã¦ï¼Œä¸€ã¤ã®ã‚³ãƒ³ãƒ†ãƒŠã§ä¸€ã¤ã®ãƒ—ãƒ­ã‚»ã‚¹ã—ã‹å®Ÿè¡Œã›ãšï¼ŒOSå…¨ä½“ã®ã‚·ã‚¹ãƒ†ãƒ ã¯ä¸è¦ãªãŸã‚ï¼ŒOSã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’ãƒ™ãƒ¼ã‚¹ã¨ã—ãªã„ã‚ˆã†ã«ã™ã‚‹ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š # CentOSã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’ï¼Œã‚³ãƒ³ãƒ†ãƒŠã«ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ« FROM centos:8 # PHPã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹ãŸã‚ã«ï¼ŒEPELã¨Remiãƒªãƒã‚¸ãƒˆãƒªã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¦æœ‰åŠ¹åŒ–ï¼ RUN dnf upgrade -y \\ && dnf install -y \\ https://dl.fedoraproject.org/pub/epel/epel-release-latest-8.noarch.rpm \\ https://rpms.remirepo.net/enterprise/remi-release-8.rpm \\ && dnf module enable php:remi-${PHP_VERSION} \\ # ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã®è¦ä»¶ã®PHPæ‹¡å¼µæ©Ÿèƒ½ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ« && dnf install -y \\ php \\ php-bcmath \\ php-ctype \\ php-fileinfo \\ php-json \\ php-mbstring \\ php-openssl \\ php-pdo \\ php-tokenizer \\ php-xml \\ && dnf clean all \\ && rm -Rf /var/cache/dnf # DockerHubã®Composerã‚¤ãƒ¡ãƒ¼ã‚¸ã‹ã‚‰ãƒã‚¤ãƒŠãƒªãƒ•ã‚¡ã‚¤ãƒ«ã‚’å–å¾— COPY --from=composer /usr/bin/composer /usr/bin/composer ï¼Šå®Ÿè£…ä¾‹ï¼Š # CentOSã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’ï¼Œã‚³ãƒ³ãƒ†ãƒŠã«ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ« FROM centos:8 # nginxã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ« RUN dnf upgrade -y \\ ã€€ã€€&& dnf install -y \\ ã€€ã€€ nginx \\ ã€€ã€€ curl \\ ã€€ã€€&& dnf clean all \\ ã€€ã€€&& rm -Rf /var/cache/dnf COPY infra/docker/web/nginx.conf /etc/nginx/nginx.conf CMD [\"/usr/sbin/nginx\", \"-g\", \"daemon off;\"] EXPOSE 80 ãƒ»ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’ãƒ™ãƒ¼ã‚¹ã¨ã—ãŸå ´åˆï¼ˆè‰¯ã„ä¾‹ï¼‰ ä»£ã‚ã‚Šã«ï¼ŒãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢ãƒ™ãƒ³ãƒ€ãƒ¼ãŒæä¾›ã™ã‚‹ãƒ™ãƒ¼ã‚¹ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’ä½¿ç”¨ã™ã‚‹ã‚ˆã†ã«ã™ã‚‹ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š # Nginxã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’ï¼Œã‚³ãƒ³ãƒ†ãƒŠã«ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ« FROM nginx:1.19 # Nginxã‚¤ãƒ¡ãƒ¼ã‚¸ãŒUbuntuãƒ™ãƒ¼ã‚¹ãªãŸã‚ã«apt-getã‚³ãƒãƒ³ãƒ‰ RUN apt-get updatedocke -y \\ && apt-get install -y \\ curl \\ && apt-get clean COPY ./infra/docker/www/production.nginx.conf /etc/nginx/nginx.conf ãƒ»è¨€èªã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’ãƒ™ãƒ¼ã‚¹ã¨ã—ãŸå ´åˆ ä»£ã‚ã‚Šã«ï¼Œè¨€èªãƒ™ãƒ³ãƒ€ãƒ¼ãŒæä¾›ã™ã‚‹ãƒ™ãƒ¼ã‚¹ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’ä½¿ç”¨ã™ã‚‹ã‚ˆã†ã«ã™ã‚‹ï¼ # ã“ã“ã«å®Ÿè£…ä¾‹ ãƒ»alpineã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’ãƒ™ãƒ¼ã‚¹ã¨ã—ãŸå ´åˆ # ã“ã“ã«å®Ÿè£…ä¾‹ 04. ãƒ›ã‚¹ãƒˆã¨ã‚³ãƒ³ãƒ†ãƒŠé–“ã®ãƒã‚¦ãƒ³ãƒˆ Bindãƒã‚¦ãƒ³ãƒˆ ãƒ»Bindãƒã‚¦ãƒ³ãƒˆã¨ã¯ ãƒ›ã‚¹ãƒˆOSã®/Usersãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’ã‚³ãƒ³ãƒ†ãƒŠå´ã«ãƒã‚¦ãƒ³ãƒˆã™ã‚‹æ–¹æ³•ï¼ãƒ›ã‚¹ãƒˆOSã§ä½œæˆã•ã‚Œã‚‹ãƒ‡ãƒ¼ã‚¿ãŒç¶™ç¶šçš„ã«å¤‰åŒ–ã™ã‚‹å ´åˆã«é©ã—ã¦ãŠã‚Šï¼Œä¾‹ãˆã°ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ãƒ›ã‚¹ãƒˆã‚³ãƒ³ãƒ†ãƒŠé–“ã¨å…±æœ‰ã™ã‚‹æ–¹æ³•ã¨ã—ã¦æ¨å¥¨ã§ã‚ã‚‹ï¼ã—ã‹ã—ï¼Œãƒ›ã‚¹ãƒˆOSã®ãƒ‡ãƒ¼ã‚¿ã‚’æ°¸ç¶šåŒ–ã™ã‚‹æ–¹æ³•ã¨ã—ã¦ã¯ä¸é©ã§ã‚ã‚‹ï¼ã¾ãŸï¼ŒDockerfileã¾ãŸã¯docker-composeãƒ•ã‚¡ã‚¤ãƒ«ã«è¨˜è¿°ã™ã‚‹æ–¹æ³•ãŒã‚ã‚‹ãŒï¼Œå¾Œè€…ãŒæ¨å¥¨ã§ã‚ã‚‹ï¼ ï¼Šã‚³ãƒãƒ³ãƒ‰ä¾‹ï¼Š # ãƒ›ã‚¹ãƒˆOSã‚’ã‚³ãƒ³ãƒ†ãƒŠå´ã«bindãƒã‚¦ãƒ³ãƒˆ $ docker run -d -it --name /bin/bash \\ --mount type=bind, src=home/projects/, dst=/var/www/ ãƒ»ãƒã‚¦ãƒ³ãƒˆå…ƒã¨ã—ã¦æŒ‡å®šã§ãã‚‹ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª ä»¥ä¸‹ã®é€šã‚Šï¼Œãƒ›ã‚¹ãƒˆOSã®ãƒã‚¦ãƒ³ãƒˆå…ƒã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ã¯ã„ãã¤ã‹é¸æŠè‚¢ãŒã‚ã‚‹ï¼ Volumeãƒã‚¦ãƒ³ãƒˆ ãƒ»Volumeï¼ˆData Volumeï¼‰ï¼ŒDockerã‚¨ãƒªã‚¢ã¨ã¯ ãƒ›ã‚¹ãƒˆOSã®Dockerã‚¨ãƒªã‚¢ï¼ˆ/var/lib/docker/volumesãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªï¼‰ã«ä¿å­˜ã•ã‚Œã‚‹æ°¸ç¶šãƒ‡ãƒ¼ã‚¿ã®ã“ã¨ï¼Data Volumeã¨ã‚‚ã„ã†ï¼Volumeã¸ã®ãƒ‘ã‚¹ï¼ˆ/var/lib/docker/volumes//_dataï¼‰ã¯ï¼Œãƒã‚¦ãƒ³ãƒˆãƒã‚¤ãƒ³ãƒˆã¨ã„ã†ï¼ ãƒ»Volumeãƒã‚¦ãƒ³ãƒˆã¨ã¯ ãƒ›ã‚¹ãƒˆOSã«ã‚ã‚‹Dockerã‚¨ãƒªã‚¢ã®ãƒã‚¦ãƒ³ãƒˆãƒã‚¤ãƒ³ãƒˆã‚’ã‚³ãƒ³ãƒ†ãƒŠå´ã«ãƒã‚¦ãƒ³ãƒˆã™ã‚‹æ–¹æ³•ï¼ãƒ›ã‚¹ãƒˆOSã§ä½œæˆã•ã‚Œã‚‹ãƒ‡ãƒ¼ã‚¿ãŒã‚ã£ãŸã«å¤‰åŒ–ã—ãªã„å ´åˆã«é©ã—ã¦ãŠã‚Šï¼Œä¾‹ãˆã°DBã®ãƒ‡ãƒ¼ã‚¿ã‚’ãƒ›ã‚¹ãƒˆã‚³ãƒ³ãƒ†ãƒŠé–“ã¨å…±æœ‰ã™ã‚‹æ–¹æ³•ã¨ã—ã¦æ¨å¥¨ã§ã‚ã‚‹ï¼ ãƒ»Data Volumeã‚³ãƒ³ãƒ†ãƒŠã«ã‚ˆã‚‹æ°¸ç¶šåŒ–ãƒ‡ãƒ¼ã‚¿ã®æä¾› Volumeã‚’ä½¿ç”¨ã™ã‚‹å ´åˆã®ã‚³ãƒ³ãƒ†ãƒŠé…ç½®æ‰‹æ³•ã®ä¸€ã¤ï¼Dockerã‚¨ãƒªã‚¢ã®Volumeã‚’Data Volumeã‚’ã‚³ãƒ³ãƒ†ãƒŠ ï¼ˆData Volumeã‚³ãƒ³ãƒ†ãƒŠï¼‰ã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ãƒã‚¦ãƒ³ãƒˆã—ã¦ãŠãï¼Volumeã‚’ä½¿ç”¨ã™ã‚‹æ™‚ã¯ï¼ŒDockerã‚¨ãƒªã‚¢ã‚’å‚ç…§ã™ã‚‹ã®ã§ã¯ãªãï¼ŒData Volumeã‚³ãƒ³ãƒ†ãƒŠã‚’å‚ç…§ã™ã‚‹ã‚ˆã†ã«ã™ã‚‹ï¼ 05. ãƒ›ã‚¹ãƒˆã¨ã‚³ãƒ³ãƒ†ãƒŠé–“ã®ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯æ¥ç¶š bridgeãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ ãƒ»bridgeãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã¨ã¯ è¤‡æ•°ã®ã‚³ãƒ³ãƒ†ãƒŠé–“ã«å¯¾ã—ã¦ï¼Œä»®æƒ³ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã§æ¥ç¶šã•ã›ã‚‹ï¼ã¾ãŸï¼Œä»®æƒ³ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚’ç‰©ç†ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã®é–“ã‚’ï¼Œä»®æƒ³ãƒ–ãƒªãƒƒã‚¸ã‚’ç”¨ã„ã¦bridgeæ¥ç¶šã™ã‚‹ï¼ã»ã¨ã‚“ã©ã®å ´åˆï¼Œã“ã®æ–¹æ³•ã‚’ç”¨ã„ã‚‹ï¼ å‚è€ƒï¼šhttps://www.itmedia.co.jp/enterprise/articles/1609/21/news001.html ç‰©ç†ã‚µãƒ¼ãƒã¸ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒã‚³ãƒ³ãƒ†ãƒŠã«å±Šãã¾ã§ã‚’ä»¥ä¸‹ã«ç¤ºã™ï¼ç‰©ç†ã‚µãƒ¼ãƒã®8080ç•ªãƒãƒ¼ãƒˆã¨ï¼ŒWWWã‚³ãƒ³ãƒ†ãƒŠã®80ç•ªãƒãƒ¼ãƒˆã®ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®é–“ã§ï¼Œãƒãƒ¼ãƒˆãƒ•ã‚©ãƒ¯ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã‚’è¡Œã†ï¼ã“ã‚Œã«ã‚ˆã‚Šï¼Œã€http://:8080ã€ã«ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é€ä¿¡ã™ã‚‹ã¨ï¼ŒWWWã‚³ãƒ³ãƒ†ãƒŠã®ãƒãƒ¼ãƒˆç•ªå·ã«è»¢é€ã•ã‚Œã‚‹ã‚ˆã†ã«ãªã‚‹ï¼ å‡¦ç†å ´æ‰€ ãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®æµã‚Œ ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆIPã‚¢ãƒ‰ãƒ¬ã‚¹ä¾‹ ãƒãƒ¼ãƒˆç•ªå·ä¾‹ ã‚³ãƒ³ãƒ†ãƒŠå†…ãƒ—ãƒ­ã‚»ã‚¹ ãƒ—ãƒ­ã‚»ã‚¹ã®ãƒªãƒƒã‚¹ãƒ³ã™ã‚‹ãƒãƒ¼ãƒˆ :80 â†‘ ã‚³ãƒ³ãƒ†ãƒŠ ã‚³ãƒ³ãƒ†ãƒŠãƒãƒ¼ãƒˆ ãƒ»http://127.0.0.1ãƒ»http:// :80 â†‘ ãƒ›ã‚¹ãƒˆOS ä»®æƒ³ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ http://172.XX.XX.XX â†‘ ãƒ›ã‚¹ãƒˆOS ä»®æƒ³ãƒ–ãƒªãƒƒã‚¸ â†‘ ãƒ›ã‚¹ãƒˆãƒãƒ¼ãƒ‰ã‚¦ã‚§ã‚¢ ç‰©ç†ã‚µãƒ¼ãƒã®NICï¼ˆ Ethernetã‚«ãƒ¼ãƒ‰ï¼‰ http://127.0.0.1 :8080 noneãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ ãƒ»noneãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã¨ã¯ ç‰¹å®šã®ã‚³ãƒ³ãƒ†ãƒŠã‚’ï¼Œãƒ›ã‚¹ãƒˆOSã‚„ä»–ã®ã‚³ãƒ³ãƒ†ãƒŠã¨ã¯ï¼Œãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯æ¥ç¶šã•ã›ãªã„ï¼ $ docker network list NETWORK ID NAME DRIVER SCOPE 7edf2be856d7 none null local hostãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ ãƒ»hostãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã¨ã¯ ç‰¹å®šã®ã‚³ãƒ³ãƒ†ãƒŠã«å¯¾ã—ã¦ï¼Œãƒ›ã‚¹ãƒˆOSã¨åŒã˜ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯æƒ…å ±ã‚’ã‚‚ãŸã›ã‚‹ï¼ $ docker network list NETWORK ID NAME DRIVER SCOPE ac017dda93d6 host host local ã‚³ãƒ³ãƒ†ãƒŠé–“ã®æ¥ç¶šæ–¹æ³• ãƒ»ã€ãƒ›ã‚¹ãƒˆOSã€ã‹ã‚‰ã€ãƒ›ã‚¹ãƒˆOSï¼ˆlocalhostï¼‰ã€ã«ãƒªã‚¯ã‚¨ã‚¹ãƒˆ ã€ãƒ›ã‚¹ãƒˆOSã€ã‹ã‚‰ã€ãƒ›ã‚¹ãƒˆOSã€ã«å¯¾ã—ã¦ï¼Œã‚¢ã‚¦ãƒˆãƒã‚¦ãƒ³ãƒ‰ãªãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é€ä¿¡ã™ã‚‹ï¼ã“ã“ã§ã®ãƒ›ã‚¹ãƒˆOSã®ãƒ›ã‚¹ãƒˆåã¯ï¼Œã€localhostã€ã¨ãªã‚‹ï¼ãƒªã‚¯ã‚¨ã‚¹ãƒˆã¯ï¼Œãƒãƒ¼ãƒˆãƒ•ã‚©ãƒ¯ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã•ã‚ŒãŸã‚³ãƒ³ãƒ†ãƒŠã«è»¢é€ã•ã‚Œã‚‹ï¼ãƒ›ã‚¹ãƒˆOSã¨ã‚³ãƒ³ãƒ†ãƒŠã®é–“ã®ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯æ¥ç¶šã®æˆå¦ã‚’ç¢ºèªã§ãã‚‹ï¼ ï¼Šã‚³ãƒãƒ³ãƒ‰ä¾‹ï¼Š ã€ãƒ›ã‚¹ãƒˆOSã€ã‹ã‚‰ã€ãƒ›ã‚¹ãƒˆOSã€ã«å¯¾ã—ã¦ã‚¢ã‚¦ãƒˆãƒã‚¦ãƒ³ãƒ‰ãªãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é€ä¿¡ã—ï¼Œãƒ›ã‚¹ãƒˆOSã¨appã‚³ãƒ³ãƒ†ãƒŠã®é–“ã®æˆå¦ã‚’ç¢ºèªã™ã‚‹ï¼ # ãƒ›ã‚¹ãƒˆOSã§å®Ÿè¡Œ $ curl --fail http://localhost:8080/ ãƒ»ã€ã‚³ãƒ³ãƒ†ãƒŠã€ã‹ã‚‰ã€ã‚³ãƒ³ãƒ†ãƒŠã€ã«ãƒªã‚¯ã‚¨ã‚¹ãƒˆ ã€ã‚³ãƒ³ãƒ†ãƒŠã€ã‹ã‚‰ã€ã‚³ãƒ³ãƒ†ãƒŠã€ã«å¯¾ã—ã¦ï¼Œã‚¢ã‚¦ãƒˆãƒã‚¦ãƒ³ãƒ‰ãªãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é€ä¿¡ã™ã‚‹ï¼ã“ã“ã§ã®ã‚³ãƒ³ãƒ†ãƒŠã®ãƒ›ã‚¹ãƒˆåã¯ï¼Œã‚³ãƒ³ãƒ†ãƒŠå†…ã®ã€/etc/hostsã€ã«å®šç¾©ã•ã‚ŒãŸã‚‚ã®ã¨ãªã‚‹ï¼ãƒªã‚¯ã‚¨ã‚¹ãƒˆã¯ãƒ›ã‚¹ãƒˆOSã‚’çµŒç”±ã›ãšï¼Œãã®ã¾ã¾ã‚³ãƒ³ãƒ†ãƒŠã«é€ä¿¡ã•ã‚Œã‚‹ï¼ã‚³ãƒ³ãƒ†ãƒŠé–“ã®ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯æ¥ç¶šã®æˆå¦ã‚’ç¢ºèªã§ãã‚‹ï¼ã‚³ãƒ³ãƒ†ãƒŠã®ãƒ›ã‚¹ãƒˆåã®å®šç¾©æ–¹æ³•ã«ã¤ã„ã¦ã¯ï¼Œä»¥ä¸‹ã‚’å‚è€ƒã«ã›ã‚ˆï¼ å‚è€ƒï¼šhttps://hiroki-it.github.io/tech-notebook-gitbook/public/virtualization/virtualization_container_orchestration.html ï¼Šã‚³ãƒãƒ³ãƒ‰ä¾‹ï¼Š ã€appã‚³ãƒ³ãƒ†ãƒŠã€ã‹ã‚‰ã€nginxã‚³ãƒ³ãƒ†ãƒŠã€ã«å¯¾ã—ã¦ï¼Œã‚¢ã‚¦ãƒˆãƒã‚¦ãƒ³ãƒ‰ãªãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é€ä¿¡ã—ï¼Œappã‚³ãƒ³ãƒ†ãƒŠã¨nginxã‚³ãƒ³ãƒ†ãƒŠã®é–“ã®æˆå¦ã‚’ç¢ºèªã™ã‚‹ï¼ # ã‚³ãƒ³ãƒ†ãƒŠå†…ã§å®Ÿè¡Œ $ curl --fail http://:80/ ãƒ»ã€ã‚³ãƒ³ãƒ†ãƒŠã€ã‹ã‚‰ã€ãƒ›ã‚¹ãƒˆOSï¼ˆhost.docker.internalï¼‰ã€ã«ãƒªã‚¯ã‚¨ã‚¹ãƒˆ ã€ã‚³ãƒ³ãƒ†ãƒŠã€ã‹ã‚‰ã€ãƒ›ã‚¹ãƒˆOSã€ã«å¯¾ã—ã¦ï¼Œã‚¢ã‚¦ãƒˆãƒã‚¦ãƒ³ãƒ‰ãªãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é€ä¿¡ã™ã‚‹ï¼ã“ã“ã§ã®ãƒ›ã‚¹ãƒˆOSã®ãƒ›ã‚¹ãƒˆåã¯ï¼Œã€host.docker.internalã€ã«ãªã‚‹ï¼ãƒªã‚¯ã‚¨ã‚¹ãƒˆã¯ï¼Œãƒ›ã‚¹ãƒˆOSã‚’çµŒç”±ã—ã¦ï¼Œãƒãƒ¼ãƒˆãƒ•ã‚©ãƒ¯ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã•ã‚ŒãŸã‚³ãƒ³ãƒ†ãƒŠã«è»¢é€ã•ã‚Œã‚‹ï¼ãƒ›ã‚¹ãƒˆOSã¨ã‚³ãƒ³ãƒ†ãƒŠã®é–“ã®ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯æ¥ç¶šã®æˆå¦ã‚’ç¢ºèªã§ãã‚‹ï¼ # ã‚³ãƒ³ãƒ†ãƒŠå†…ã§å®Ÿè¡Œ $ curl --fail http://host.docker.internal:8080/ "},"public/virtualization/virtualization_container_orchestration.html":{"url":"public/virtualization/virtualization_container_orchestration.html","title":"ğŸ“– ï¸ã‚³ãƒ³ãƒ†ãƒŠã‚ªãƒ¼ã‚±ã‚¹ãƒˆãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³","keywords":"","body":"ã‚³ãƒ³ãƒ†ãƒŠã‚ªãƒ¼ã‚±ã‚¹ãƒˆãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ ã¯ã˜ã‚ã« æœ¬ã‚µã‚¤ãƒˆã«ã¤ãã¾ã—ã¦ï¼Œä»¥ä¸‹ã‚’ã”èªè­˜ã®ã»ã©å®œã—ããŠé¡˜ã„ã„ãŸã—ã¾ã™ï¼ å‚è€ƒï¼šhttps://hiroki-it.github.io/tech-notebook-gitbook/ 01. ã‚³ãƒ³ãƒ†ãƒŠã‚ªãƒ¼ã‚±ã‚¹ãƒˆãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã®ç¨®é¡ å˜ä¸€ãƒ›ã‚¹ãƒˆOSä¸Šã®ã‚³ãƒ³ãƒ†ãƒŠã‚ªãƒ¼ã‚±ã‚¹ãƒˆãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ å˜ä¸€ãƒ›ã‚¹ãƒˆOSä¸Šã®ã‚³ãƒ³ãƒ†ãƒŠãŒå¯¾è±¡ã§ã‚ã‚‹ï¼ç•°ãªã‚‹Dockerfileã«åŸºã¥ã„ã¦ï¼ŒDockerã‚¤ãƒ¡ãƒ¼ã‚¸ã®ãƒ“ãƒ«ãƒ‰ï¼Œã‚³ãƒ³ãƒ†ãƒŠãƒ¬ã‚¤ãƒ¤ãƒ¼ã®ç”Ÿæˆï¼Œã‚³ãƒ³ãƒ†ãƒŠã®æ§‹ç¯‰ï¼Œã‚³ãƒ³ãƒ†ãƒŠã®èµ·å‹•ï¼Œã‚’å®Ÿè¡Œã§ãã‚‹ï¼ ãƒ„ãƒ¼ãƒ«å ãƒ™ãƒ³ãƒ€ãƒ¼ Docker Compose Docker ECSï¼šElastic Container Service Amazon è¤‡æ•°ãƒ›ã‚¹ãƒˆOSã«æ¸¡ã‚‹ã‚³ãƒ³ãƒ†ãƒŠã‚ªãƒ¼ã‚±ã‚¹ãƒˆãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ è¤‡æ•°ãƒ›ã‚¹ãƒˆOSä¸Šã®ã‚³ãƒ³ãƒ†ãƒŠãŒå¯¾è±¡ã§ã‚ã‚‹ï¼ã©ã®ãƒ›ã‚¹ãƒˆOSã®Dockerãƒ‡ãƒ¼ãƒ¢ãƒ³ã«å¯¾ã—ã¦ï¼Œã©ã®ã‚³ãƒ³ãƒ†ãƒŠã«é–¢ã™ã‚‹æ“ä½œã‚’è¡Œã†ã®ã‹ã‚’é¸æŠçš„ã«å‘½ä»¤ã§ãã‚‹ï¼ å‚è€ƒï¼šhttps://www.techrepublic.com/article/simplifying-the-mystery-when-to-use-docker-docker-compose-and-kubernetes/ ãƒ„ãƒ¼ãƒ«å ãƒ™ãƒ³ãƒ€ãƒ¼ Docker Swarm Docker Kubernetes Google EKSï¼šElastic Kubernetes Service Amazon 02. ã‚³ãƒ³ãƒ†ãƒŠãƒ‡ã‚¶ã‚¤ãƒ³ãƒ‘ã‚¿ãƒ¼ãƒ³ ã‚µã‚¤ãƒ‰ã‚«ãƒ¼ãƒ»ãƒ‘ã‚¿ãƒ¼ãƒ³ ãƒ»ã‚µã‚¤ãƒ‰ã‚«ãƒ¼ãƒ»ãƒ‘ã‚¿ãƒ¼ãƒ³ã¨ã¯ ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚³ãƒ³ãƒ†ãƒŠã‚’è£œåŠ©ã™ã‚‹ã‚³ãƒ³ãƒ†ãƒŠã¨ã—ã¦ï¼ŒåŒã˜ECSã‚¿ã‚¹ã‚¯ã‚„Podå†…ã«é…ç½®ã™ã‚‹ï¼ ãƒ»ãƒ­ã‚®ãƒ³ã‚°ã‚³ãƒ³ãƒ†ãƒŠã®é…ç½® FluentBitã‚³ãƒ³ãƒ†ãƒŠã‚’ã‚µã‚¤ãƒ‰ã‚«ãƒ¼ã‚³ãƒ³ãƒ†ãƒŠã¨ã—ã¦ç¨¼åƒã•ã›ï¼Œã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚³ãƒ³ãƒ†ãƒŠã‹ã‚‰é€ä¿¡ã•ã‚ŒãŸãƒ­ã‚°ã‚’ä»–ã«ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã™ã‚‹ï¼ å‚è€ƒï¼šhttps://hiroki-it.github.io/tech-notebook-gitbook/public/observability_monitering/observability_fluentbit.html ãƒ»ãƒ¡ãƒˆãƒªã‚¯ã‚¹åé›†ã‚³ãƒ³ãƒ†ãƒŠã®é…ç½® Datadogã‚³ãƒ³ãƒ†ãƒŠã‚’ã‚µã‚¤ãƒ‰ã‚«ãƒ¼ã‚³ãƒ³ãƒ†ãƒŠã¨ã—ã¦ç¨¼åƒã•ã›ï¼Œã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚³ãƒ³ãƒ†ãƒŠã‹ã‚‰ãƒ¡ãƒˆãƒªã‚¯ã‚¹ã‚’åé›†ã™ã‚‹ï¼ å‚è€ƒï¼šhttps://hiroki-it.github.io/tech-notebook-gitbook/public/observability_monitering/observability_datadog_metrics.html ã‚¢ãƒ³ãƒã‚µãƒ€ãƒ¼ãƒ»ãƒ‘ã‚¿ãƒ¼ãƒ³ ã‚¢ãƒ€ãƒ—ã‚¿ãƒ¼ãƒ»ãƒ‘ã‚¿ãƒ¼ãƒ³ "},"public/virtualization/virtualization_container_orchestration_docker_compose_command.html":{"url":"public/virtualization/virtualization_container_orchestration_docker_compose_command.html","title":"ğŸ“– ï¸docker-composeã‚³ãƒãƒ³ãƒ‰","keywords":"","body":"docker-composeã‚³ãƒãƒ³ãƒ‰ ã¯ã˜ã‚ã« æœ¬ã‚µã‚¤ãƒˆã«ã¤ãã¾ã—ã¦ï¼Œä»¥ä¸‹ã‚’ã”èªè­˜ã®ã»ã©å®œã—ããŠé¡˜ã„ã„ãŸã—ã¾ã™ï¼ å‚è€ƒï¼šhttps://hiroki-it.github.io/tech-notebook-gitbook/ 01. ã‚³ãƒãƒ³ãƒ‰ config ãƒ»configã¨ã¯ ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã¨ã—ã¦ï¼Œdocker-compose.ymlãƒ•ã‚¡ã‚¤ãƒ«ã‚’å±•é–‹ã™ã‚‹ï¼ãƒ•ã‚¡ã‚¤ãƒ«å†…ã§ï¼Œç›¸å¯¾ãƒ‘ã‚¹ã‚„å¤‰æ•°ã‚’ä½¿ç”¨ã—ã¦ã„ã‚‹å ´åˆï¼Œã“ã‚Œã‚‰ãŒæ­£ã—ãè¨­å®šã•ã‚Œã¦ã„ã‚‹ã‹ã‚’ç¢ºèªã§ãã‚‹ï¼ ãƒ»ã‚ªãƒ—ã‚·ãƒ§ãƒ³ãªã— $ docker-compose config build ãƒ»buildã¨ã¯ ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’ãƒ“ãƒ«ãƒ‰ã™ã‚‹ï¼ ãƒ»--no-cache ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’ä½¿ç”¨ã›ãšã«ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’ãƒ“ãƒ«ãƒ‰ã™ã‚‹ï¼ $ docker-compose build --no-cache up ãƒ»upã¨ã¯ æŒ‡å®šã—ãŸã‚µãƒ¼ãƒ“ã‚¹ã®ã‚¤ãƒ¡ãƒ¼ã‚¸ã®ãƒ“ãƒ«ãƒ‰ï¼Œã‚³ãƒ³ãƒ†ãƒŠãƒ¬ã‚¤ãƒ¤ãƒ¼ç”Ÿæˆï¼Œã‚³ãƒ³ãƒ†ãƒŠæ§‹ç¯‰ï¼Œã‚³ãƒ³ãƒ†ãƒŠèµ·å‹•ã‚’è¡Œã†ï¼ã‚³ãƒ³ãƒ†ãƒŠæ§‹ç¯‰ã¾ã§ãŒå®Œäº†ã—ã¦ã„ã¦åœæ­¢ä¸­ãŒå­˜åœ¨ã™ã‚‹å ´åˆï¼Œã“ã‚Œã‚’ã‚³ãƒ³ãƒ†ãƒŠã‚’èµ·å‹•ã™ã‚‹ï¼ã¾ãŸèµ·å‹•ä¸­ã®ã‚³ãƒ³ãƒ†ãƒŠãŒã‚ã‚Œã°ï¼Œã“ã‚Œã‚’å†èµ·å‹•ã™ã‚‹ï¼ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã«ã‚ˆã‚Šèµ·å‹•ãƒ¢ãƒ¼ãƒ‰ãŒç•°ãªã‚‹ï¼ ãƒ»ã‚ªãƒ—ã‚·ãƒ§ãƒ³ãªã— æŒ‡å®šã—ãŸã‚µãƒ¼ãƒ“ã‚¹ã®ã‚¤ãƒ¡ãƒ¼ã‚¸ã®ãƒ“ãƒ«ãƒ‰ï¼Œã‚³ãƒ³ãƒ†ãƒŠãƒ¬ã‚¤ãƒ¤ãƒ¼ç”Ÿæˆï¼Œã‚³ãƒ³ãƒ†ãƒŠæ§‹ç¯‰ï¼Œã‚³ãƒ³ãƒ†ãƒŠèµ·å‹•ã‚’è¡Œã†ï¼ã‚¢ã‚¿ãƒƒãƒãƒ¢ãƒ¼ãƒ‰ã§ã‚³ãƒ³ãƒ†ãƒŠã‚’èµ·å‹•ã™ã‚‹ï¼ # ã‚¢ã‚¿ãƒƒãƒãƒ¢ãƒ¼ãƒ‰ $ docker-compose up ãƒ»-d æŒ‡å®šã—ãŸã‚µãƒ¼ãƒ“ã‚¹ã®ã‚¤ãƒ¡ãƒ¼ã‚¸ã®ãƒ“ãƒ«ãƒ‰ï¼Œã‚³ãƒ³ãƒ†ãƒŠãƒ¬ã‚¤ãƒ¤ãƒ¼ç”Ÿæˆï¼Œã‚³ãƒ³ãƒ†ãƒŠæ§‹ç¯‰ï¼Œã‚³ãƒ³ãƒ†ãƒŠèµ·å‹•ã‚’è¡Œã†ï¼ãƒ‡ã‚¿ãƒƒãƒãƒ‰ãƒ¢ãƒ¼ãƒ‰ã§ã‚³ãƒ³ãƒ†ãƒŠã‚’èµ·å‹•ã™ã‚‹ï¼ # ãƒ‡ã‚¿ãƒƒãƒãƒ¢ãƒ¼ãƒ‰ $ docker-compose up -d ãƒ»--build ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’ãƒ“ãƒ«ãƒ‰ã—ï¼Œã‚³ãƒ³ãƒ†ãƒŠã‚’æ§‹ç¯‰ã™ã‚‹ï¼ $ docker-compose up --build -d run ãƒ»runã¨ã¯ ã™ã§ã«åœæ­¢ä¸­ã¾ãŸã¯èµ·å‹•ä¸­ã®ã‚³ãƒ³ãƒ†ãƒŠãŒå­˜åœ¨ã—ã¦ã„ã¦ã‚‚ï¼Œã“ã‚Œã¨ã¯åˆ¥ã«ã‚³ãƒ³ãƒ†ãƒŠã‚’æ–°ã—ãæ§‹ç¯‰ã—ï¼Œèµ·å‹•ã™ã‚‹ï¼ã•ã‚‰ã«ãã®ã‚³ãƒ³ãƒ†ãƒŠå†…ã§ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã™ã‚‹ï¼èµ·å‹•æ™‚ã«bashãƒ—ãƒ­ã‚»ã‚¹ã‚„bashãƒ—ãƒ­ã‚»ã‚¹ã‚’å®Ÿè¡Œã™ã‚‹ã¨ï¼Œã‚³ãƒ³ãƒ†ãƒŠã«æ¥ç¶šã§ãã‚‹ï¼ä½•ã‚‚æ¸¡ã•ãªã„å ´åˆã¯ï¼Œãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®ãƒ—ãƒ­ã‚»ã‚¹ã¨ã—ã¦bashãƒ—ãƒ­ã‚»ã‚¹ãŒå®Ÿè¡Œã•ã‚Œã‚‹ï¼runã‚³ãƒãƒ³ãƒ‰ã§ã¯ï¼Œã‚¢ã‚¿ãƒƒãƒãƒ¢ãƒ¼ãƒ‰ã¨ãƒ‡ã‚¿ãƒƒãƒãƒ¢ãƒ¼ãƒ‰ã‚’é¸ã¶ã“ã¨ãŒã§ãã‚‹ï¼æ–°ã—ãèµ·å‹•ã—ãŸã‚³ãƒ³ãƒ†ãƒŠã‚’åœæ­¢å¾Œã«è‡ªå‹•å‰Šé™¤ã™ã‚‹å ´åˆã¯ï¼Œrmã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’ä»˜ã‘ã‚‹ã‚ˆã†ã«ã™ã‚‹ï¼service-portsã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’ä½¿ç”¨ã—ãªã„ã¨ï¼Œãƒ›ã‚¹ãƒˆOSã¨ã‚³ãƒ³ãƒ†ãƒŠé–“ã®ãƒãƒ¼ãƒˆãƒ•ã‚©ãƒ¯ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã‚’æœ‰åŠ¹åŒ–ã§ããªã„ãŸã‚æ³¨æ„ã™ã‚‹ï¼ ãƒ»--service-ports æ—¢å­˜ã‚³ãƒ³ãƒ†ãƒŠã‚’æ®‹ã—ã¦ï¼ŒæŒ‡å®šã—ãŸã‚µãƒ¼ãƒ“ã‚¹ã®æ–°ã—ã„ã‚³ãƒ³ãƒ†ãƒŠã‚’ã‚¢ã‚¿ãƒƒãƒãƒ¢ãƒ¼ãƒ‰ã§èµ·å‹•ã™ã‚‹ï¼ã¾ãŸï¼Œãƒ›ã‚¹ãƒˆOSã¨ã‚³ãƒ³ãƒ†ãƒŠé–“ã®ãƒãƒ¼ãƒˆãƒ•ã‚©ãƒ¯ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã‚’æœ‰åŠ¹åŒ–ã™ã‚‹ï¼ # ã‚¢ã‚¿ãƒƒãƒãƒ¢ãƒ¼ãƒ‰ $ docker-compose run --rm --service-ports ãƒ»-d --service-ports æ—¢å­˜ã‚³ãƒ³ãƒ†ãƒŠã‚’æ®‹ã—ã¦ï¼ŒæŒ‡å®šã—ãŸã‚µãƒ¼ãƒ“ã‚¹ã®æ–°ã—ã„ã‚³ãƒ³ãƒ†ãƒŠã‚’ãƒ‡ã‚¿ãƒƒãƒãƒ‰ãƒ¢ãƒ¼ãƒ‰ã§èµ·å‹•ã™ã‚‹ï¼ã¾ãŸï¼Œãƒ›ã‚¹ãƒˆOSã¨ã‚³ãƒ³ãƒ†ãƒŠé–“ã®ãƒãƒ¼ãƒˆãƒ•ã‚©ãƒ¯ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã‚’æœ‰åŠ¹åŒ–ã™ã‚‹ï¼ # ãƒ‡ã‚¿ãƒƒãƒãƒ¢ãƒ¼ãƒ‰ $ docker-compose run --rm -d --service-ports stop ãƒ»stopã¨ã¯ æŒ‡å®šã—ãŸã‚µãƒ¼ãƒ“ã‚¹ã®èµ·å‹•ä¸­ã‚³ãƒ³ãƒ†ãƒŠã‚’å…¨ã¦åœæ­¢ã™ã‚‹ï¼ ãƒ»ã‚ªãƒ—ã‚·ãƒ§ãƒ³ãªã— $ docker-compose stop down ãƒ»downã¨ã¯ æŒ‡å®šã—ãŸãƒªã‚½ãƒ¼ã‚¹ã‚’å‰Šé™¤ã™ã‚‹ï¼ ãƒ»--rmi --volumes --remove-orphans å…¨ã¦ã®ãƒªã‚½ãƒ¼ã‚¹ï¼ˆã‚¤ãƒ¡ãƒ¼ã‚¸ï¼Œã‚³ãƒ³ãƒ†ãƒŠï¼Œãƒœãƒªãƒ¥ãƒ¼ãƒ ï¼Œãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ï¼‰ã‚’å‰Šé™¤ã™ã‚‹ï¼ $ docker-compose down --rmi all --volumes --remove-orphans logs ãƒ»logsã¨ã¯ ã‚³ãƒ³ãƒ†ãƒŠå†…ã«å…¥ã‚‹ã“ã¨ãªãï¼Œèµ·å‹•ãƒ—ãƒ­ã‚»ã‚¹ã‹ã‚‰å‡ºåŠ›ã•ã‚Œã‚‹ãƒ­ã‚°ã‚’ç¢ºèªã™ã‚‹ã“ã¨ã§ãã‚‹ï¼ ãƒ»ã‚ªãƒ—ã‚·ãƒ§ãƒ³ãªã— ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ã§ãƒ­ã‚°ã‚’è¡¨ç¤ºã™ã‚‹ï¼ $ docker-compose logs ãƒ»-f ãƒ•ã‚©ã‚¢ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ã§ãƒ­ã‚°ã‚’è¡¨ç¤ºã™ã‚‹ï¼ $ docker-compose logs -f "},"public/virtualization/virtualization_container_orchestration_docker_compose_yml.html":{"url":"public/virtualization/virtualization_container_orchestration_docker_compose_yml.html","title":"ğŸ“– ï¸docker-compose.yml","keywords":"","body":"docker-compose.yml 01. services servicesã¨ã¯ ã‚³ãƒ³ãƒ†ãƒŠã‚ªãƒ¼ã‚±ã‚¹ãƒˆãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã«ãŠã‘ã‚‹ä¸€ã¤ã®ã‚³ãƒ³ãƒ†ãƒŠã‚’å®šç¾©ã™ã‚‹ï¼ã‚³ãƒ³ãƒ†ãƒŠåã¨ç•°ãªã‚Šï¼Œã‚µãƒ¼ãƒ“ã‚¹åã¯ä»–ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã¨é‡è¤‡ã—ã¦ã‚‚ã‚ˆã„ï¼docker-composeã‚³ãƒãƒ³ãƒ‰ã®å¼•æ•°ã¨ã—ã¦æŒ‡å®šã™ã‚‹ãŸã‚ï¼Œã§ãã‚‹ã ã‘ç°¡æ½”ã«ã™ã‚‹ï¼ã‚ªãƒ—ã‚·ãƒ§ãƒ³ä¸€è¦§ã¯ä»¥ä¸‹ã‚’å‚è€ƒã«ã›ã‚ˆï¼ å‚è€ƒï¼šhttps://docs.docker.jp/compose/compose-file.html args Dockerfileã®ARGSã«å±•é–‹ã™ã‚‹å¤‰æ•°ã‚’å®šç¾©ã™ã‚‹ï¼Dockerfileã«ç›´æ¥å®Ÿè£…ã™ã‚‹ã“ã¨ã¨ã®ä½¿ã„åˆ†ã‘ã¨ã—ã¦ï¼ŒDockerfileã®å®Ÿè£…ã¯ç°¡å˜ã«å¤‰æ›´ã§ããªã„ãŒï¼Œdocker-compose.ymlãƒ•ã‚¡ã‚¤ãƒ«ã«ãŠã‘ã‚‹å®šç¾©ã¯å¤‰æ›´ã—ã‚„ã™ã„ï¼ãã®ãŸã‚ï¼Œä½¿ç”¨è€…ã«å¤‰æ›´ã—ã¦æ¬²ã—ããªã„å¤‰æ•°ã¯Dockerfileã«å®Ÿè£…ã—ï¼Œå¤‰æ›´ã—ã¦ã‚‚å•é¡Œãªã„å¤‰æ•°ã¯ã“ã®ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’ä½¿ç”¨ã™ã‚‹ï¼ä»–ã«ï¼Œãƒãƒ«ãƒã‚¹ãƒ†ãƒ¼ã‚¸ãƒ“ãƒ«ãƒ‰ã‚’ä½¿ç”¨ã—ã¦ãŠã‚Šï¼Œå…¨ã¦ã®ã‚¹ãƒ†ãƒ¼ã‚¸ã§å…±é€šã—ãŸå¤‰æ•°ã‚’å±•é–‹ã—ãŸã„å ´åˆï¼Œã“ã®ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’ä½¿ç”¨ã™ã‚‹ã¨å±•é–‹ã™ã‚‹å¤‰æ•°ã‚’å…±é€šåŒ–ã§ãã‚‹ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š services: app: build: - PARAM=$PARAM ARG PARAM ENV PARAM=${PARAM} ï¼Šå®Ÿè£…ä¾‹ï¼Š # ã“ã“ã«å®Ÿè£…ä¾‹ build ãƒ»dockerfile Dockerfileã®åå‰ï¼ãƒ‘ã‚¹ã”ã¨æŒ‡å®šã™ã‚‹ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š services: app: build: dockerfile: ./docker/app/Dockerfile ãƒ»context æŒ‡å®šã—ãŸDockerfileã®ã‚ã‚‹ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’ã‚«ãƒ¬ãƒ³ãƒˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã¨ã—ã¦ï¼ŒDockerãƒ‡ãƒ¼ãƒ¢ãƒ³ï¼ˆDockerã‚¨ãƒ³ã‚¸ãƒ³ï¼‰ã«é€ä¿¡ã™ã‚‹ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’æŒ‡å®šã™ã‚‹ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š services: app: build: context: . ãƒ»target ãƒ“ãƒ«ãƒ‰ã™ã‚‹ã‚¹ãƒ†ãƒ¼ã‚¸åï¼ä¸»ã«ï¼Œãƒãƒ«ãƒã‚¹ãƒ†ãƒ¼ã‚¸ãƒ“ãƒ«ãƒ‰ã®æ™‚ã«ä½¿ç”¨ã™ã‚‹ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š services: app: build: target: develop command ã‚³ãƒ³ãƒ†ãƒŠã®èµ·å‹•æ™‚ã«æœ€åˆã«å®Ÿè¡Œã™ã‚‹ã‚³ãƒãƒ³ãƒ‰ã‚’è¨­å®šã™ã‚‹ï¼Dockerfileã‚’å¿…è¦ã¨ã›ãšï¼Œãƒ™ãƒ³ãƒ€ãƒ¼ãŒæä¾›ã™ã‚‹ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’ãã®ã¾ã¾ä½¿ç”¨ã™ã‚‹ã‚ˆã†ãªå ´åˆã«å½¹ç«‹ã¤ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š mysqlã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’ä½¿ç”¨ã—ã¦ã‚³ãƒ³ãƒ†ãƒŠã‚’æ§‹ç¯‰ã™ã‚‹ã¨ãã«ï¼Œæœ€åˆã«æ–‡å­—ã‚³ãƒ¼ãƒ‰ã‚’è¨­å®šã™ã‚‹ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã™ã‚‹ï¼ services: db: command: mysqld --character-set-server=utf8mb4 --collation-server=utf8mb4_general_ci container_name ã‚³ãƒ³ãƒ†ãƒŠåã‚’å‘½åã™ã‚‹ï¼ã‚µãƒ¼ãƒ“ã‚¹åã¨ã¯ç•°ãªã‚Šï¼Œã‚³ãƒ³ãƒ†ãƒŠåã¯ä»–ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã¨é‡è¤‡ã—ãªã„ã‚ˆã†ã«ã™ã‚‹ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š services: web: container_name: nginx depends_on ã‚³ãƒ³ãƒ†ãƒŠãŒèµ·å‹•ã™ã‚‹é †ç•ªã‚’è¨­å®šã™ã‚‹ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š DBã‚³ãƒ³ãƒ†ãƒŠã®èµ·å‹•å¾Œã«ï¼Œè©²å½“ã™ã‚‹ã‚³ãƒ³ãƒ†ãƒŠã‚’èµ·å‹•ã™ã‚‹ã‚ˆã†ã«ã™ã‚‹ï¼ services: app: depends_on: - db env_fileï¼Œenvironment ã‚³ãƒ³ãƒ†ãƒŠã§å±•é–‹ã™ã‚‹ç’°å¢ƒå¤‰æ•°ã‚’å®šç¾©ã™ã‚‹ï¼Dockerfileå†…ã§ã®ç’°å¢ƒå¤‰æ•°ã¨ã¯ç•°ãªã‚Šï¼Œãƒãƒ«ãƒã‚¹ãƒ†ãƒ¼ã‚¸ãƒ“ãƒ«ãƒ‰ã®å…¨ã‚¹ãƒ†ãƒ¼ã‚¸ã§ä½¿ç”¨ã§ãã‚‹ï¼dotenvç³»ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’ä½¿ç”¨ã—ãªãã¦ã‚‚ã‚ˆããªã‚‹ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š mysqlã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’ä½¿ç”¨ã—ãŸå ´åˆï¼Œãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®ç’°å¢ƒå¤‰æ•°ã®è¨­å®šãŒå¿…è¦ã§ã‚ã‚‹ï¼ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®ç’°å¢ƒå¤‰æ•°ã¯ï¼Œãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã‚³ãƒ³ãƒ†ãƒŠã§ã‚‚å¿…è¦ãªãŸã‚ï¼Œenvironmentã‚­ãƒ¼ã«ç›´æ¥ç’°å¢ƒå¤‰æ•°ã‚’è¨­å®šã›ãšã«ï¼Œenvãƒ•ã‚¡ã‚¤ãƒ«ã«å®šç¾©ã—ãŸç’°å¢ƒå¤‰æ•°ã‚’environmentã‚­ãƒ¼ã§å‚ç…§ã™ã‚‹ã¨ã‚ˆã„ï¼ services: db: env_file: - .env environment: MYSQL_ROOT_PASSWORD: ${DB_ROOT_PASSWORD} # rootãƒ¦ãƒ¼ã‚¶ã®ãƒ‘ã‚¹ MYSQL_DATABASE: ${DB_DATABASE} # ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹å MYSQL_USER: ${DB_USER} # ä¸€èˆ¬ãƒ¦ãƒ¼ã‚¶å MYSQL_PASSWORD: ${DB_PASSWORD} # ä¸€èˆ¬ãƒ¦ãƒ¼ã‚¶ã®ãƒ‘ã‚¹ # .envãƒ•ã‚¡ã‚¤ãƒ« MYSQL_ROOT_PASSWORD=foo # rootãƒ¦ãƒ¼ã‚¶ã®ãƒ‘ã‚¹ MYSQL_DATABASE=bar # ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹å MYSQL_USER=baz # ä¸€èˆ¬ãƒ¦ãƒ¼ã‚¶å MYSQL_PASSWORD=qux # ä¸€èˆ¬ãƒ¦ãƒ¼ã‚¶ã®ãƒ‘ã‚¹ mysqlã‚¤ãƒ¡ãƒ¼ã‚¸ã§ã¯ï¼Œç’°å¢ƒå¤‰æ•°ã®è¨­å®šã«å¿œã˜ã¦ï¼Œã‚³ãƒ³ãƒ†ãƒŠèµ·å‹•æ™‚ã«SQLãŒå®Ÿè¡Œã•ã‚Œã‚‹ã‚ˆã†ã«ãªã£ã¦ã„ã‚‹ï¼ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹åã®ç’°å¢ƒå¤‰æ•°ãŒè¨­å®šã•ã‚Œã¦ã„ã‚‹å ´åˆã¯ã€CREATE DATABASEã€ï¼Œã¾ãŸãƒ¦ãƒ¼ã‚¶åã¨ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãŒè¨­å®šã•ã‚Œã¦ã„ã‚‹å ´åˆã¯ã€CREATE USERã€ã¨ã€GRANT ALLã€ã®SQLãŒå®Ÿè¡Œã•ã‚Œã‚‹ï¼ å‚è€ƒï¼šhttps://github.com/docker-library/mysql/blob/master/5.7/docker-entrypoint.sh#L308-L322 ãƒ«ãƒ¼ãƒˆãƒ¦ãƒ¼ã‚¶åã¯å®šç¾©ã§ããšï¼Œã€rootã€ã¨ãªã‚‹ï¼ å‚è€ƒï¼šhttps://github.com/docker-library/mysql/blob/master/5.7/docker-entrypoint.sh#L156 extra_host ã‚³ãƒ³ãƒ†ãƒŠã«ï¼Œãƒ¦ãƒ¼ã‚¶å®šç¾©ã®ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆIPã‚¢ãƒ‰ãƒ¬ã‚¹ã¨ï¼Œã“ã‚Œã«ãƒãƒƒãƒ”ãƒ³ã‚°ã•ã‚ŒãŸãƒ›ã‚¹ãƒˆåã‚’è¨­å®šã™ã‚‹ï¼ãƒãƒƒãƒ”ãƒ³ã‚°ã¯ï¼Œ/etc/hostsãƒ•ã‚¡ã‚¤ãƒ«ã«æ›¸ãè¾¼ã¾ã‚Œã‚‹ï¼ã‚‚ã—è¨­å®šã—ãªã‹ã£ãŸå ´åˆï¼Œã‚µãƒ¼ãƒ“ã‚¹åã¾ãŸã¯ã‚³ãƒ³ãƒ†ãƒŠåãŒãƒ›ã‚¹ãƒˆåã¨ã—ã¦æ‰±ã‚ã‚Œã‚‹ï¼ services: web: extra_hosts: - web:162.242.195.82 $ cat /etc/hosts 127.0.0.1 localhost ::1 localhost ip6-localhost ip6-loopback fe00::0 ip6-localnet ff00::0 ip6-mcastprefix ff02::1 ip6-allnodes ff02::2 ip6-allrouters # ãƒ¦ãƒ¼ã‚¶å®šç¾©ã®ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆIPã‚¢ãƒ‰ãƒ¬ã‚¹ã¨ï¼Œã“ã‚Œã«ãƒãƒƒãƒ”ãƒ³ã‚°ã•ã‚ŒãŸãƒ›ã‚¹ãƒˆå 162.242.195.82 web 172.23.0.3 c9bd8ace335d hostname ï¼Šå®Ÿè£…ä¾‹ï¼Š ã‚³ãƒ³ãƒ†ãƒŠã«å‰²ã‚Šå½“ã¦ã‚‰ã‚Œã‚‹ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆIPã‚¢ãƒ‰ãƒ¬ã‚¹ã«ï¼ŒæŒ‡å®šã—ãŸãƒ›ã‚¹ãƒˆåã‚’ãƒãƒƒãƒ”ãƒ³ã‚°ã™ã‚‹ï¼ãƒãƒƒãƒ”ãƒ³ã‚°ã¯ï¼Œ/etc/hostsãƒ•ã‚¡ã‚¤ãƒ«ã«æ›¸ãè¾¼ã¾ã‚Œã‚‹ï¼ã‚‚ã—è¨­å®šã—ãªã‹ã£ãŸå ´åˆï¼Œã‚µãƒ¼ãƒ“ã‚¹åã¾ãŸã¯ã‚³ãƒ³ãƒ†ãƒŠåãŒãƒ›ã‚¹ãƒˆåã¨ã—ã¦æ‰±ã‚ã‚Œã‚‹ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š services: web: hostname: web $ cat /etc/hosts 127.0.0.1 localhost ::1 localhost ip6-localhost ip6-loopback fe00::0 ip6-localnet ff00::0 ip6-mcastprefix ff02::1 ip6-allnodes ff02::2 ip6-allrouters # ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆIPã‚¢ãƒ‰ãƒ¬ã‚¹ã«ãƒãƒƒãƒ”ãƒ³ã‚°ã•ã‚ŒãŸãƒ›ã‚¹ãƒˆå 172.18.0.3 web image ã‚¤ãƒ¡ãƒ¼ã‚¸ã«åå‰ã‚’ã¤ã‘ã‚‹ï¼æ¨™æº–ã§ã¯ï¼Œã€ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå_ã‚µãƒ¼ãƒ“ã‚¹åã€ã¨ãªã‚‹ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š services: app: image: foo-app: logging ãƒ»fluentd ã‚³ãƒ³ãƒ†ãƒŠã§ç”Ÿæˆã•ã‚ŒãŸãƒ­ã‚°ã‚’Fluentdã‚³ãƒ³ãƒ†ãƒŠã«è»¢é€ã™ã‚‹ï¼ å‚è€ƒï¼šhttps://docs.fluentd.org/container-deployment/docker-compose#step-0-create-docker-compose.yml ï¼Šå®Ÿè£…ä¾‹ï¼Š services: app: logging: driver: fluentbit options: fluentd-address: localhost:24224 tag: app log_router: build: ./docker/fluentd/Dockerfile ports: - \"24224:24224\" networks ã‚³ãƒ³ãƒ†ãƒŠã‚’æ¥ç¶šã™ã‚‹å†…éƒ¨ï¼å¤–éƒ¨ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã®ã‚¨ã‚¤ãƒªã‚¢ã‚¹åã‚’è¨­å®šã™ã‚‹ï¼ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯åã§ã¯ãªãï¼Œã‚¨ã‚¤ãƒªã‚¢ã‚¹åã‚’æŒ‡å®šã™ã‚‹ã“ã¨ã«æ³¨æ„ã™ã‚‹ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š networks: # å†…éƒ¨ï¼å¤–éƒ¨ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã®ã‚¨ã‚¤ãƒªã‚¢ã‚¹åã‚’æŒ‡å®šã™ã‚‹ï¼ - foo-network ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã«æ¥ç¶šã•ã‚Œã¦ã„ã‚‹ã‚³ãƒ³ãƒ†ãƒŠã¯ã‚³ãƒãƒ³ãƒ‰ã§ç¢ºèªã§ãã‚‹ï¼ # æŒ‡å®šã—ãŸãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã«æ¥ç¶šã™ã‚‹ã‚³ãƒ³ãƒ†ãƒŠã‚’ç¢ºèªã™ã‚‹ï¼ $ docker network inspect foo-network [ { \"Name\": \"foo-network\", # ï½ ä¸­ç•¥ ï½ \"Containers\": { \"e681fb35e6aa5c94c85acf3522a324d7d75aad8eada13ed1779a4f8417c3fb44\": { \"Name\": \"\", \"EndpointID\": \"ef04da88901646359086eeb45aab81d2393c2f71b4266ccadc042ae49d684409\", \"MacAddress\": \"**:**:**:**:**:**\", \"IPv4Address\": \"nnn.nn.n.n/nn\", \"IPv6Address\": \"\" \"33632947e4210126874a7c26dce281642a6040e1acbebbdbbe8ba333c281dff8\": { \"Name\": \"\", \"EndpointID\": \"ef04da88901646359086eeb45aab81d2393c2f71b4266ccadc042ae49d684409\", \"MacAddress\": \"**:**:**:**:**:**\", \"IPv4Address\": \"nnn.nn.n.n/nn\", \"IPv6Address\": \"\" } }, # ï½ ä¸­ç•¥ ï½ \"Labels\": { \"com.docker.compose.network\": \"foo-network\", \"com.docker.compose.project\": \"\", \"com.docker.compose.version\": \"1.29.0\" } } ] ãªãŠï¼Œæ¥ç¶šã™ã‚‹ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã¯æ˜ç¤ºçš„ã«æŒ‡å®šã—ãªãã¦ã‚‚ã‚ˆã„ï¼ãã®å ´åˆï¼Œã€_defaultã€ã¨ã„ã†ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ãŒï¼Œã€defaultã€ã¨ã„ã†ã‚¨ã‚¤ãƒªã‚¢ã‚¹åã§ä½œæˆã•ã‚Œã‚‹ï¼ services: web: networks: # defaultã¯ï¼Œæ˜ç¤ºçš„ã«æŒ‡å®šã—ã¦ã‚‚ã—ãªãã¦ã‚‚ã©ã¡ã‚‰ã§ã‚‚ã‚ˆã„ï¼ - default $ docker network inspect _default [ { \"Name\": \"_default\", # ï½ ä¸­ç•¥ ï½ \"Containers\": { \"e681fb35e6aa5c94c85acf3522a324d7d75aad8eada13ed1779a4f8417c3fb44\": { \"Name\": \"\", \"EndpointID\": \"ef04da88901646359086eeb45aab81d2393c2f71b4266ccadc042ae49d684409\", \"MacAddress\": \"**:**:**:**:**:**\", \"IPv4Address\": \"nnn.nn.n.n/nn\", \"IPv6Address\": \"\" \"33632947e4210126874a7c26dce281642a6040e1acbebbdbbe8ba333c281dff8\": { \"Name\": \"\", \"EndpointID\": \"ef04da88901646359086eeb45aab81d2393c2f71b4266ccadc042ae49d684409\", \"MacAddress\": \"**:**:**:**:**:**\", \"IPv4Address\": \"nnn.nn.n.n/nn\", \"IPv6Address\": \"\" } }, # ï½ ä¸­ç•¥ ï½ \"Labels\": { \"com.docker.compose.network\": \"default\", \"com.docker.compose.project\": \"\", \"com.docker.compose.version\": \"1.29.0\" } } ] platform ã‚³ãƒ³ãƒ†ãƒŠã®CPUã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã‚’è¨­å®šã™ã‚‹ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š services: app: platform: linux/amd64 ports ãƒ›ã‚¹ãƒˆOSã¨ã‚³ãƒ³ãƒ†ãƒŠã®é–“ã®ãƒãƒ¼ãƒˆãƒ•ã‚©ãƒ¯ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã‚’è¨­å®šã™ã‚‹ï¼ã‚³ãƒ³ãƒ†ãƒŠã®ã¿ãƒãƒ¼ãƒˆç•ªå·ã‚’æŒ‡å®šã—ãŸå ´åˆï¼Œãƒ›ã‚¹ãƒˆOSå´ã®ãƒãƒ¼ãƒˆç•ªå·ã¯ãƒ©ãƒ³ãƒ€ãƒ ã«ãªã‚‹ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š services: web: ports: - \"8080:80\" # : stdin_open docker-composeã‚³ãƒãƒ³ãƒ‰ã®è£å´ã§å®Ÿè¡Œã•ã‚Œã‚‹runã‚³ãƒãƒ³ãƒ‰ã«ãŠã„ã¦ï¼Œiã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’æœ‰åŠ¹åŒ–ã™ã‚‹ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š services: app: stdin_open: true tty docker-composeã‚³ãƒãƒ³ãƒ‰ã®è£å´ã§å®Ÿè¡Œã•ã‚Œã‚‹runã‚³ãƒãƒ³ãƒ‰ã«ãŠã„ã¦ï¼Œtã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’æœ‰åŠ¹åŒ–ã™ã‚‹ï¼ç–‘ä¼¼ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ã‚’å‰²ã‚Šå½“ã¦ã‚‹ã«ã‚ˆã£ã¦ï¼Œexitã®å¾Œã‚‚ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ã§ã‚³ãƒ³ãƒ†ãƒŠã‚’èµ·å‹•ã•ã›ç¶šã‘ã‚‰ã‚Œã‚‹ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š services: app: tty: true volumesï¼ˆBindãƒã‚¦ãƒ³ãƒˆï¼‰ æœ€ä¸Šå±¤ã¨serviceå†…ã§ï¼Œç•°ãªã‚‹Volumeåã‚’è¨˜è¿°ã—ãŸå ´åˆï¼ŒBindãƒã‚¦ãƒ³ãƒˆã‚’å®šç¾©ã™ã‚‹ï¼ãƒ›ã‚¹ãƒˆOSã«ã‚ã‚‹/Usersãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’ã‚³ãƒ³ãƒ†ãƒŠå´ã«ãƒã‚¦ãƒ³ãƒˆã™ã‚‹ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š services: app: volumes: - ./web:/var/www/foo # : volumesï¼ˆVolumeãƒã‚¦ãƒ³ãƒˆï¼‰ æœ€ä¸Šå±¤ã¨serviceå†…ã®ä¸¡æ–¹ã«ï¼ŒåŒã˜Volumeåã‚’è¨˜è¿°ã—ãŸå ´åˆï¼ŒVolumeãƒã‚¦ãƒ³ãƒˆã‚’å®šç¾©ã™ã‚‹ï¼Dockerã‚¨ãƒªã‚¢ã«VolumeãŒä½œæˆã•ã‚Œï¼Œserviceã‚ªãƒ—ã‚·ãƒ§ãƒ³å†…ã«è¨­å®šã—ãŸvolumesã‚ªãƒ—ã‚·ãƒ§ãƒ³ã§Volumeãƒã‚¦ãƒ³ãƒˆã‚’è¡Œã†ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š service: db: volumes: # volumeãƒã‚¦ãƒ³ãƒˆ - mysql_volume:/var/www/lib/mysql volumes: # volumeå mysql_volume: # localã§ï¼Œãƒ›ã‚¹ãƒˆOSã®Dockerã‚¨ãƒªã‚¢ã‚’æŒ‡å®š driver: local å¤‰æ•°å±•é–‹ ç’°å¢ƒå¤‰æ•°ã‚’docker-compose.ymlãƒ•ã‚¡ã‚¤ãƒ«ã«å±•é–‹ã™ã‚‹ï¼å¤‰æ•°ã®å±•é–‹ã«ã‚ãŸã‚Šï¼Œdocker-compose.ymlãƒ•ã‚¡ã‚¤ãƒ«ã¨åŒã˜éšå±¤ã«ã‚ã‚‹.envãƒ•ã‚¡ã‚¤ãƒ«ãŒè‡ªå‹•çš„ã«èª­ã¿è¾¼ã¾ã‚Œã‚‹ï¼ã“ã®å±•é–‹ã«env_fileã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’ä½¿ç”¨ã™ã‚‹ã“ã¨ã¯ã§ããªã„ï¼ãã®ãŸã‚ï¼Œä¾‹ãˆã°.envãƒ•ã‚¡ã‚¤ãƒ«ä»¥å¤–ã®åå‰ã®ç’°å¢ƒå¤‰æ•°ãƒ•ã‚¡ã‚¤ãƒ«ã‚’å¤‰æ•°å±•é–‹ã®ãŸã‚ã«ä½¿ç”¨ã™ã‚‹ã“ã¨ã¯ã§ããªã„ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š services: app: build: # å‡ºåŠ›å…ƒã®å€¤ã¯ï¼Œ.envãƒ•ã‚¡ã‚¤ãƒ«ã«å®šç¾©ã—ãªã‘ã‚Œã°ãªã‚‰ãªã„ï¼ target: ${APP_ENV} image: ${APP_ENV}-foo-app 02. networks networksã¨ã¯ æ¨™æº–ã®ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚’ä½œæˆã™ã‚‹ï¼ãŸã ã—å®šç¾©ã—ãªãã¨ã‚‚è‡ªå‹•çš„ã«æ§‹ç¯‰ã•ã‚Œã‚‹ï¼ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯åã¯ï¼ŒæŒ‡å®šã—ãªã„å ´åˆã«ã€_defaultã€ã«ãªã‚‹ï¼ ãƒ»name ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯åã‚’ãƒ¦ãƒ¼ã‚¶å®šç¾©åã«ã™ã‚‹ï¼ networks: default: # ãƒ¦ãƒ¼ã‚¶å®šç¾©ã®ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯åã¨ã‚¨ã‚¤ãƒªã‚¢ã‚¹å name: foo-network ãªãŠï¼Œã“ã®ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚’æ˜ç¤ºçš„ã«è¨­å®šã™ã‚‹å ´åˆã¯ï¼Œã‚¨ã‚¤ãƒªã‚¢ã‚¹åï¼ˆdefaultï¼‰ã§æŒ‡å®šã™ã‚‹ï¼ services: web: networks: # defaultã¯ï¼Œæ˜ç¤ºçš„ã«æŒ‡å®šã—ã¦ã‚‚ã—ãªãã¦ã‚‚ã©ã¡ã‚‰ã§ã‚‚ã‚ˆã„ï¼ - default $ docker network ls NETWORK ID NAME DRIVER SCOPE ************ foo-network bridge local $ docker network inspect foo-network [ { \"Name\": \"foo-network\", # ï½ ä¸­ç•¥ ï½ \"Containers\": { \"e681fb35e6aa5c94c85acf3522a324d7d75aad8eada13ed1779a4f8417c3fb44\": { \"Name\": \"\", \"EndpointID\": \"ef04da88901646359086eeb45aab81d2393c2f71b4266ccadc042ae49d684409\", \"MacAddress\": \"**:**:**:**:**:**\", \"IPv4Address\": \"nnn.nn.n.n/nn\", \"IPv6Address\": \"\" \"33632947e4210126874a7c26dce281642a6040e1acbebbdbbe8ba333c281dff8\": { \"Name\": \"\", \"EndpointID\": \"ef04da88901646359086eeb45aab81d2393c2f71b4266ccadc042ae49d684409\", \"MacAddress\": \"**:**:**:**:**:**\", \"IPv4Address\": \"nnn.nn.n.n/nn\", \"IPv6Address\": \"\" } }, # ï½ ä¸­ç•¥ ï½ \"Labels\": { \"com.docker.compose.network\": \"foo-network\", \"com.docker.compose.project\": \"\", \"com.docker.compose.version\": \"1.29.0\" } } ] ãƒ»external ç•°ãªã‚‹docker-compose.ymlãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰æ¥ç¶šã§ãã‚‹ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚’ä½œæˆã™ã‚‹ï¼ä½œæˆã•ã‚Œã‚‹ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯åã¨ã‚¨ã‚¤ãƒªã‚¢ã‚¹åã¯ï¼Œexternalã‚­ãƒ¼ã®ä¸Šéƒ¨ã§è¨­å®šã—ãŸã‚‚ã®ã«ãªã‚‹ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã¨ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ãŒç•°ãªã‚‹docker-compose.ymlãƒ•ã‚¡ã‚¤ãƒ«ã§ç®¡ç†ã•ã‚Œã¦ã„ã‚‹ï¼ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã‚³ãƒ³ãƒ†ãƒŠã‹ã‚‰ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã‚³ãƒ³ãƒ†ãƒŠã«æ¥ç¶šã§ãã‚‹ã‚ˆã†ã«ï¼Œãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚’ä½œæˆã™ã‚‹ï¼ # ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã®Docker-compose services: app: container_name: backend-container # ï½ ä¸­ç•¥ ï½ networks: # ä½œæˆã—ãŸã„å¤–éƒ¨ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯åã¨ã‚¨ã‚¤ãƒªã‚¢ã‚¹å backend: external: true ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã‚³ãƒ³ãƒ†ãƒŠã«ã¦ï¼Œã‚¨ã‚¤ãƒªã‚¢ã‚¹åã«ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯åã‚’æŒ‡å®šã—ã¦ï¼Œ # ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã®Docker-compose services: app: container_name: frontend-container # å†…éƒ¨ï¼å¤–éƒ¨ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã®ã„ãšã‚Œã‹ã®ã‚¨ã‚¤ãƒªã‚¢ã‚¹åã‚’æŒ‡å®šã™ã‚‹ï¼ networks: - backend # ï½ ä¸­ç•¥ ï½ networks: default: external: # æ¥ç¶šã—ãŸã„å¤–éƒ¨ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯åã¨ã‚¨ã‚¤ãƒªã‚¢ã‚¹å name: backend ä½œæˆã—ãŸå†…éƒ¨ï¼å¤–éƒ¨ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã¯ï¼Œã‚³ãƒãƒ³ãƒ‰ã§ç¢ºèªã§ãã‚‹ï¼ã€_defaultã€ã¨ã„ã†ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯åã«ãªã‚‹ï¼ ï¼Šã‚³ãƒãƒ³ãƒ‰ä¾‹ï¼Š $ docker network ls NETWORK ID NAME DRIVER SCOPE ************ backend bridge local 04. ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ Volumeãƒ—ãƒ©ã‚°ã‚¤ãƒ³ ãƒ»NFSã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ NFSãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã‚’ä½¿ç”¨ã™ã‚‹ã“ã¨ã§ï¼Œæ°¸ç¶šåŒ–ãƒ‡ãƒ¼ã‚¿ã‚’/var/lib/docker/volumesã§ã¯ãªãï¼ŒNFSã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã«ä¿å­˜ã™ã‚‹ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š ä»¥ä¸‹ã«docker-composeã‚’ä½¿ç”¨ã—ãŸå ´åˆã‚’ç¤ºã™ï¼ version: \"3.7\" services: app: build: # ï½ ä¸­ç•¥ ï½ ports: # ï½ ä¸­ç•¥ ï½ depends_on: # ï½ ä¸­ç•¥ ï½ volumes: - example:/data # ä¸‹æ–¹ã®ã‚ªãƒ—ã‚·ãƒ§ãƒ³ãŒé©ç”¨ã•ã‚Œã‚‹ï¼ volumes: example: driver_opts: # NFSãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã‚’ä½¿ç”¨ã—ï¼ŒNFSã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã«ä¿å­˜ï¼ type: \"nfs\" o: \"addr=10.40.0.199,nolock,soft,rw\" device: \":/nfs/example\" 05. ã‚¤ãƒ¡ãƒ¼ã‚¸åˆ¥Tips mysqlã‚¤ãƒ¡ãƒ¼ã‚¸ ãƒ»ãƒ“ãƒ«ãƒ‰æ™‚ã«SQLå®Ÿè¡Œ mysqlã‚³ãƒ³ãƒ†ãƒŠã«ã¯docker-entrypoint-initdb.dãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªãŒã‚ã‚‹ï¼ã“ã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«é…ç½®ã•ã‚ŒãŸsqlãƒ•ã‚¡ã‚¤ãƒ«ã‚„bashãƒ—ãƒ­ã‚»ã‚¹ã¯ï¼Œmysqlã‚³ãƒ³ãƒ†ãƒŠã®ãƒ“ãƒ«ãƒ‰æ™‚ã«docker-entrypoint.shãƒ•ã‚¡ã‚¤ãƒ«ã«ã‚ˆã£ã¦å®Ÿè¡Œã•ã‚Œã‚‹ï¼ãã®ãŸã‚ï¼ŒBindãƒã‚¦ãƒ³ãƒˆã‚’ç”¨ã„ã¦ã“ã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç½®ãã“ã¨ã§ï¼ŒåˆæœŸãƒ‡ãƒ¼ã‚¿ã®æŠ•å…¥ã‚„è¤‡æ•°ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®ä½œæˆã‚’å®Ÿç¾ã§ãã‚‹ï¼å…·ä½“çš„ãªå®Ÿè¡Œã‚¿ã‚¤ãƒŸãƒ³ã‚°ã«ã¤ã„ã¦ã¯ï¼Œä»¥ä¸‹ã‚’å‚è€ƒã«ã›ã‚ˆï¼ å‚è€ƒï¼šhttps://github.com/docker-library/mysql/blob/master/8.0/Dockerfile.debian#L92-L93 ï¼Šå®Ÿè£…ä¾‹ï¼Š mysqlã‚³ãƒ³ãƒ†ãƒŠã«ï¼ŒPHPUnitã®å®Ÿè¡Œæ™‚ã®ã¿ä½¿ç”¨ã™ã‚‹ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚’è¿½åŠ ã™ã‚‹ï¼ä»¥ä¸‹ã®ã‚ˆã†ãªï¼Œdocker-compose.ymlãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã™ã‚‹ï¼ version: \"3.7\" services: db: container_name: foo-mysql hostname: foo-mysql image: mysql:5.7 ports: - \"3307:3306\" volumes: - mysql_volume:/var/www/lib/mysql # docker-entrypoint-initdb.dãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«Bindãƒã‚¦ãƒ³ãƒˆã‚’è¡Œã†ï¼ - ./infra/docker/mysql/init:/docker-entrypoint-initdb.d environment: MYSQL_ROOT_PASSWORD: foo MYSQL_DATABASE: foo MYSQL_USER: foo MYSQL_PASSWORD: foo TZ: \"Asia/Tokyo\" command: mysqld --character-set-server=utf8mb4 --collation-server=utf8mb4_general_ci networks: - default volumes: mysql_volume: ã¾ãŸï¼Œdocker-entrypoint-initdb.dãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«é…ç½®ã™ã‚‹ãƒ•ã‚¡ã‚¤ãƒ«ã¨ã—ã¦ï¼Œä»¥ä¸‹ã®sqlãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã™ã‚‹ï¼ã“ã®ãƒ•ã‚¡ã‚¤ãƒ«ã§ã¯ï¼Œtestã¨ã„ã†ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚’ä½œæˆã™ã‚‹ãŸã‚ã®SQLã‚’å®Ÿè£…ã™ã‚‹ï¼ -- /infra/docker/mysql/initã«SQLãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç½®ãï¼ CREATE DATABASE IF NOT EXISTS `test` COLLATE 'utf8mb4_general_ci' CHARACTER SET 'utf8mb4'; GRANT ALL ON *.* TO 'foo'@'%' ; PHPUnitã§æ¥ç¶šã™ã‚‹ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚’æŒ‡å®šã™ã‚‹æ–¹æ³•ã«ã¤ã„ã¦ã¯ï¼Œä»¥ä¸‹ã‚’å‚è€ƒã«ã›ã‚ˆï¼ å‚è€ƒï¼šhttps://hiroki-it.github.io/tech-notebook-gitbook/public/software/software_application_backend_php_testing_based_on_code.html "},"public/virtualization/virtualization_container_orchestration_kubernetes.html":{"url":"public/virtualization/virtualization_container_orchestration_kubernetes.html","title":"ğŸ“– ï¸Kubernetes","keywords":"","body":"Kubernetes ã¯ã˜ã‚ã« æœ¬ã‚µã‚¤ãƒˆã«ã¤ãã¾ã—ã¦ï¼Œä»¥ä¸‹ã‚’ã”èªè­˜ã®ã»ã©å®œã—ããŠé¡˜ã„ã„ãŸã—ã¾ã™ï¼ å‚è€ƒï¼šhttps://hiroki-it.github.io/tech-notebook-gitbook/ 01. ã‚³ãƒãƒ³ãƒ‰ Kubectl ãƒ»Kubectlã¨ã¯ 02. .yml specï¼statu å‚è€ƒï¼šhttps://kubernetes.io/ja/docs/concepts/overview/working-with-objects/kubernetes-objects/ Node ãƒ»Master Node KubernetesãŒå®Ÿè¡Œã•ã‚Œã‚‹ãƒ›ã‚¹ãƒˆç‰©ç†ã‚µãƒ¼ãƒã‚’æŒ‡ã™ï¼ ãƒ»Worker Node DockerãŒå®Ÿè¡Œã•ã‚Œã‚‹ãƒ›ã‚¹ãƒˆä»®æƒ³ã‚µãƒ¼ãƒã‚’æŒ‡ã™ï¼ Service ãƒ»Serviceã¨ã¯ Podã«ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’è»¢é€ã™ã‚‹ãƒ­ãƒ¼ãƒ‰ãƒãƒ©ãƒ³ã‚µãƒ¼ã¨ã—ã¦æ©Ÿèƒ½ã™ã‚‹ï¼ å‚è€ƒï¼šhttps://kubernetes.io/ja/docs/concepts/services-networking/service/ ãƒ»å®šç¾© apiVersion: v1 kind: Service metadata: name: my-service # Serviceå spec: selector: app: MyApp ports: - protocol: TCP port: 80 # Serviceå—ä¿¡ãƒãƒ¼ãƒˆ targetPort: 9376 # è»¢é€å…ˆã®Podå—ä¿¡ãƒãƒ¼ãƒˆ Pod ãƒ»Podã¨ã¯ ãƒ›ã‚¹ãƒˆä»®æƒ³ã‚µãƒ¼ãƒä¸Šã®ã‚³ãƒ³ãƒ†ãƒŠã‚’æœ€å°ã‚°ãƒ«ãƒ¼ãƒ—å˜ä½ã®ã“ã¨ï¼Podã‚’å˜ä½ã¨ã—ã¦ï¼Œã‚³ãƒ³ãƒ†ãƒŠèµ·å‹•ï¼åœæ­¢ã‚„æ°´å¹³ã‚¹ã‚±ãƒ¼ãƒ«ã‚¤ãƒ³ï¼ã‚¹ã‚±ãƒ¼ãƒ«ã‚¢ã‚¦ãƒˆã‚’å®Ÿè¡Œã™ã‚‹ï¼ å‚è€ƒï¼šhttps://kubernetes.io/ja/docs/concepts/workloads/pods/ AWS ECSã‚¿ã‚¹ã‚¯ã«ãŠã‘ã‚‹é¡ä¼¼ã™ã‚‹essentialæ©Ÿèƒ½ã‚„ã‚ªãƒ¼ãƒˆã‚¹ã‚±ãƒ¼ãƒªãƒ³ã‚°ã«ã¤ã„ã¦ã¯ï¼Œä»¥ä¸‹ã®ãƒªãƒ³ã‚¯ã‚’å‚è€ƒã«ã›ã‚ˆï¼ å‚è€ƒï¼šhttps://hiroki-it.github.io/tech-notebook-gitbook/public/cloud_computing/cloud_computing_aws.html ï¼Šä¾‹ï¼Š PHP-FPMã‚³ãƒ³ãƒ†ãƒŠã¨Nginxã‚³ãƒ³ãƒ†ãƒŠã‚’ç¨¼åƒã•ã›ã‚‹å ´åˆï¼Œã“ã‚Œã‚‰åŒã˜Podã«é…ç½®ã™ã‚‹ï¼ ãƒ»å®šç¾© apiVersion: batch/v1 kind: Job metadata: name: hello spec: template: # Pod spec: containers: - name: hello # Podå†…ã‚³ãƒ³ãƒ†ãƒŠå image: busybox # ã‚¤ãƒ¡ãƒ¼ã‚¸ command: ['sh', '-c', 'echo \"Hello, Kubernetes!\" && sleep 3600'] # ã‚³ãƒ³ãƒ†ãƒŠèµ·å‹•æ™‚ã‚³ãƒãƒ³ãƒ‰ restartPolicy: OnFailure Secret ãƒ»Secretã¨ã¯ ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã«é–¢ã™ã‚‹ãƒ‡ãƒ¼ã‚¿ã‚’ç®¡ç†ã—ï¼Œã‚³ãƒ³ãƒ†ãƒŠã«é¸æŠçš„ã«æä¾›ã™ã‚‹ã‚‚ã®ï¼ Replica Set ãƒ»Replica Setï¼ˆReplication Controllerï¼‰ã¨ã¯ 02. Istio Istioã¨ã¯ ãŸã ã—ï¼ŒIstioã‚’å¿…ãšã—ã‚‚ä½¿ç”¨ã™ã‚‹å¿…è¦ã¯ãªãï¼ŒKubernetesã®æ¨™æº–ã®æ©Ÿèƒ½ã§ã“ã‚Œã‚’å®Ÿç¾ã—ã¦ã‚‚ã‚ˆã„ï¼ å‚è€ƒï¼šhttps://qiita.com/Ladicle/items/4ba57078128d6affadd5 ã‚·ã‚¹ãƒ†ãƒ ã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆé–“é€šä¿¡ã‚’åˆ¶å¾¡ã—ãã‚Œãªã„ï¼ éšœå®³æ™‚ã«ä½•ãŒèµ·ã“ã‚‹ã‹åˆ†ã‹ã‚‰ãªã„ï¼ éµã¨è¨¼æ˜æ›¸ã‚’ç®¡ç†ã—ãã‚Œãªã„ï¼ ã‚·ã‚¹ãƒ†ãƒ ã®å…¨ä½“åƒãŒæŠŠæ¡ã§ããªã„ ãƒ»ä¾å­˜é–¢ä¿‚ã®è§£æ±º ãƒã‚¤ã‚¯ãƒ­ã‚µãƒ¼ãƒ“ã‚¹ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã®å„ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ç®¡ç†ã™ã‚‹ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ã®ã“ã¨ï¼æ©Ÿèƒ½ã€A ---> B ---> C ---> Dã€ã‚’æŒã¤ãƒ¢ãƒãƒªã‚·ãƒƒã‚¯ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãŒã‚ã‚‹ã¨ã™ã‚‹ï¼ã“ã‚Œã‚’ãƒã‚¤ã‚¯ãƒ­ã‚µãƒ¼ãƒ“ã‚¹åŒ–ã—ã¦ï¼ŒABCDã‚’åˆ¥ã€…ã®ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã«åˆ†å‰²ã™ã‚‹ï¼ãã‚Œãã‚Œã®ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãŒPodä¸Šã§ç¨¼åƒã™ã‚‹ã“ã¨ã«ãªã‚‹ï¼ã—ã‹ã—ï¼Œã“ã‚Œã ã‘ã§ã¯ABCDãŒç‹¬ç«‹ã—ã¦ãŠã‚‰ãšï¼Œå„æ©Ÿèƒ½ã¯ä¸€ã¤å‰ã®æ©Ÿèƒ½ã«ä¾å­˜ã—ã¦ã„ã‚‹ï¼ã“ã®ä¾å­˜é–¢ä¿‚ã‚’è§£æ±ºã™ã‚‹ï¼ Istiod ãƒ»Istiodã¨ã¯ Envoyã‚’ç®¡ç†ã™ã‚‹æ©Ÿèƒ½ã®ã“ã¨ï¼Envoyã¯ï¼Œå„ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‹ã‚‰é€šä¿¡ã‚’å§”è­²ã•ã‚Œï¼Œã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³é–“ã®é€šä¿¡ã‚’ä»£ç†ã§è¡Œã†ï¼ "},"public/virtualization/virtualization_container_orchestration_docker_swarm.html":{"url":"public/virtualization/virtualization_container_orchestration_docker_swarm.html","title":"ğŸ“– ï¸Docker Swarm","keywords":"","body":"Docker Swarm ã¯ã˜ã‚ã« æœ¬ã‚µã‚¤ãƒˆã«ã¤ãã¾ã—ã¦ï¼Œä»¥ä¸‹ã‚’ã”èªè­˜ã®ã»ã©å®œã—ããŠé¡˜ã„ã„ãŸã—ã¾ã™ï¼ å‚è€ƒï¼šhttps://hiroki-it.github.io/tech-notebook-gitbook/ 01. æ¦‚å¿µ "},"public/virtualization/virtualization_server.html":{"url":"public/virtualization/virtualization_server.html","title":"ğŸ“– ï¸ä»®æƒ³ã‚µãƒ¼ãƒï¼ˆä»®æƒ³ãƒã‚·ãƒ³ï¼‰","keywords":"","body":"ä»®æƒ³ã‚µãƒ¼ãƒï¼ˆä»®æƒ³ãƒã‚·ãƒ³ï¼‰ ã¯ã˜ã‚ã« æœ¬ã‚µã‚¤ãƒˆã«ã¤ãã¾ã—ã¦ï¼Œä»¥ä¸‹ã‚’ã”èªè­˜ã®ã»ã©å®œã—ããŠé¡˜ã„ã„ãŸã—ã¾ã™ï¼ å‚è€ƒï¼šhttps://hiroki-it.github.io/tech-notebook-gitbook/ 01. Providerã«ã‚ˆã‚‹ä»®æƒ³ã‚µãƒ¼ãƒï¼ˆä»®æƒ³ãƒã‚·ãƒ³ï¼‰ã®æ§‹ç¯‰ Providerã®æ“ä½œ ãƒ»Providerã¨ã¯ åŸºæœ¬ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ã«ãŠã‘ã‚‹åˆ¶å¾¡ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã‚„ä¸€é€£ã®ãƒãƒ¼ãƒ‰ã‚¦ã‚§ã‚¢ã‚’ä»®æƒ³çš„ã«æ§‹ç¯‰ã§ãã‚‹ï¼ã“ã‚Œã‚’ï¼Œä»®æƒ³ã‚µãƒ¼ãƒï¼ˆä»®æƒ³ãƒã‚·ãƒ³ã¨ã‚‚ï¼‰ã¨ã„ã†ï¼æ§‹ç¯‰æ–¹æ³•ã®é•ã„ã«ã‚ˆã£ã¦ï¼Œã€ãƒ›ã‚¹ãƒˆå‹ã€ï¼Œã€ãƒã‚¤ãƒ‘ãƒ¼ãƒã‚¤ã‚¶å‹ã€ã«åˆ†é¡ã§ãã‚‹ï¼ Provisionerã®æ“ä½œ ãƒ»Provisionerã¨ã¯ Providerã«ã‚ˆã£ã¦æ§‹ç¯‰ã•ã‚ŒãŸä»®æƒ³ã‚µãƒ¼ãƒã«ï¼ŒWebé–‹ç™ºã®ãŸã‚ã®ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã§ãã‚‹ï¼ˆæ§‹æˆç®¡ç†ã§ãã‚‹ï¼‰ï¼å…·ä½“çš„ã«ã¯ï¼Œãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°è¨€èªã‚„ãƒ•ã‚¡ã‚¤ã‚¢ã‚¦ã‚©ãƒ¼ãƒ«ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹ï¼ Vagrantã«ã‚ˆã‚‹Providerã¨Provisionerã®æ“ä½œ ãƒ»Vagrantã¨ã¯ Providerã¨Provisionerã®æ“ä½œã‚’è‡ªå‹•åŒ–ã§ãã‚‹ï¼ãƒãƒ¼ãƒ ãƒ¡ãƒ³ãƒãƒ¼ãŒåˆ¥ã€…ã«ä»®æƒ³ã‚µãƒ¼ãƒã‚’æ§‹ç¯‰ã™ã‚‹å ´åˆï¼ŒProviderã¨Provisionerã®å‡¦ç†ã«ã‚ˆã£ã¦ä½œã‚‰ã‚Œã‚‹ä»®æƒ³ã‚µãƒ¼ãƒã®ç’°å¢ƒã«ï¼Œé•ã„ãŒç”Ÿã˜ã¦ã—ã¾ã†ï¼Vagrantã‚’ä½¿ã†å ´åˆï¼ŒProviderã¨Provisionerã«ã‚ˆã‚‹å‡¦ç†æ–¹æ³•ã¯ï¼ŒVagrantfileã«è¨˜è¿°ã•ã‚Œã¦ã„ã‚‹ï¼ã“ã®ãŸã‚ã«ï¼ŒVagrantã‚’ç”¨ã„ã‚Œã°ï¼Œãƒãƒ¼ãƒ ãƒ¡ãƒ³ãƒãƒ¼ãŒåŒã˜ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ã®ä¸‹ã§ï¼Œä»®æƒ³ã‚µãƒ¼ãƒã‚’æ§‹ç¯‰ã—ï¼Œã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã§ãã‚‹ï¼ ãƒ»ã‚µãƒ¼ãƒã®æƒ…å ±ã®ç®¡ç†æ–¹æ³• ã‚µãƒ¼ãƒã®æƒ…å ±ã¯ï¼Œ.envãƒ•ã‚¡ã‚¤ãƒ«ã§ä»¥ä¸‹ã®æ§˜ã«ç®¡ç†ã™ã‚‹ï¼å…¨ã¦ã®å€¤ãŒæ–‡å­—åˆ—ã¨ã—ã¦èªè­˜ã•ã‚Œã‚‹ãŸã‚ï¼Œæ•°å€¤ã‚„çœŸå½å€¤ã¯ä½¿ç”¨ã§ããªã„ï¼ #======================================= # Webã‚µãƒ¼ãƒæƒ…å ± #======================================= WEB_HOST= #======================================= # ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚µãƒ¼ãƒæƒ…å ± #======================================= DB_HOST=foo-db DB_NAME=foo DB_USER=foo DB_PASSWORD=***** ãƒ»ä¸»ãªvagrantã‚³ãƒãƒ³ãƒ‰ ã‚³ãƒãƒ³ãƒ‰ å‡¦ç† vagrant up ä»®æƒ³ã‚µãƒ¼ãƒèµ·å‹• vagrant halt ä»®æƒ³ã‚µãƒ¼ãƒåœæ­¢ vagrant ssh ä»®æƒ³ã‚µãƒ¼ãƒã¸ã®ãƒªãƒ¢ãƒ¼ãƒˆæ¥ç¶š vagrant global-status èµ·å‹•ä¸­ä»®æƒ³ã‚µãƒ¼ãƒã®ä¸€è¦§ 02. ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã®ãƒ“ãƒ«ãƒˆã‚¤ãƒ³ã‚µãƒ¼ãƒã®æ§‹ç¯‰ "},"public/ci_cd/ci_cd.html":{"url":"public/ci_cd/ci_cd.html","title":"ğŸ“– ï¸CICD","keywords":"","body":"CIï¼CD ã¯ã˜ã‚ã« æœ¬ã‚µã‚¤ãƒˆã«ã¤ãã¾ã—ã¦ï¼Œä»¥ä¸‹ã‚’ã”èªè­˜ã®ã»ã©å®œã—ããŠé¡˜ã„ã„ãŸã—ã¾ã™ï¼ å‚è€ƒï¼šhttps://hiroki-it.github.io/tech-notebook-gitbook/ 01. CICDãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ ãƒ»CICDãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã¨ã¯ Commitã‹ã‚‰æœ¬ç•ªç’°å¢ƒã¸ã®Deployã¾ã§ã®ãƒ—ãƒ­ã‚»ã‚¹ã‚’ã€ç¶™ç¶šçš„ã«ã€è¡Œã†ã“ã¨ã‚’ï¼ŒCIï¼šContinuous Integrationã€ã¨ã„ã†ï¼ã¾ãŸï¼Œå¤‰æ›´å†…å®¹ã‚’ã‚¹ãƒ†ãƒ¼ã‚¸ãƒ³ã‚°ç’°å¢ƒãªã©ã«è‡ªå‹•çš„ã«åæ˜ ã—ï¼Œã€ç¶™ç¶šçš„ã«ã€ãƒªãƒªãƒ¼ã‚¹ã™ã‚‹ã“ã¨ã‚’ï¼ŒCDï¼šContinuous Deliveryã¨ã„ã†ï¼ ãƒ»è‡ªå‹•åŒ–ã§ãã‚‹ãƒ—ãƒ­ã‚»ã‚¹ã¨ã§ããªã„ãƒ—ãƒ­ã‚»ã‚¹ ãƒ—ãƒ­ã‚»ã‚¹ è‡ªå‹•åŒ–ã®å¯å¦ èª¬æ˜ Build ã€‡ CI/CDãƒ„ãƒ¼ãƒ«ã¨IaCãƒ„ãƒ¼ãƒ«ã§è‡ªå‹•åŒ–å¯èƒ½ Unitãƒ†ã‚¹ãƒˆï¼ŒFunctionalãƒ†ã‚¹ãƒˆ ã€‡ CI/CDãƒ„ãƒ¼ãƒ«ã¨ãƒ†ã‚¹ãƒˆãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã§è‡ªå‹•åŒ–å¯èƒ½ï¼ Integrationãƒ†ã‚¹ãƒˆ âœ• ãƒ†ã‚¹ãƒˆä»•æ§˜æ›¸ã‚’ä½œæˆã—ï¼Œå‹•ä½œã‚’ç¢ºèªã™ã‚‹å¿…è¦ãŒã‚ã‚‹ï¼ ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°è¦ç´„ã«é–¢ã™ã‚‹Review ã€‡ CI/Cdãƒ„ãƒ¼ãƒ«ã¨é™çš„è§£æãƒ„ãƒ¼ãƒ« ä»•æ§˜ã«é–¢ã™ã‚‹Review âœ• GitHubä¸Šã§ãƒ¬ãƒ“ãƒ¥ãƒ¼ã™ã‚‹å¿…è¦ãŒã‚ã‚‹ï¼ ã‚¹ãƒ†ãƒ¼ã‚¸ãƒ³ã‚°ç’°å¢ƒã¸ã®ãƒ‡ãƒ—ãƒ­ã‚¤ ã€‡ CI/CDãƒ„ãƒ¼ãƒ«ã§è‡ªå‹•åŒ–å¯èƒ½ï¼ æœ¬ç•ªç’°å¢ƒã¸ã®ãƒ‡ãƒ—ãƒ­ã‚¤ ã€‡ CI/CDãƒ„ãƒ¼ãƒ«ã§è‡ªå‹•åŒ–å¯èƒ½ï¼ "},"public/ci_cd/ci_cd_circleci.html":{"url":"public/ci_cd/ci_cd_circleci.html","title":"ğŸ“– ï¸CircleCI","keywords":"","body":"CircleCI ã¯ã˜ã‚ã« æœ¬ã‚µã‚¤ãƒˆã«ã¤ãã¾ã—ã¦ï¼Œä»¥ä¸‹ã‚’ã”èªè­˜ã®ã»ã©å®œã—ããŠé¡˜ã„ã„ãŸã—ã¾ã™ï¼ å‚è€ƒï¼šhttps://hiroki-it.github.io/tech-notebook-gitbook/ 01. CircleCIã¨ã¯ è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã®å‚è€ƒãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ https://circleci.com/docs/reference-2-1/#circleci-2-1-reference è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒ‡ãƒãƒƒã‚° ãƒ»ãƒ‡ãƒãƒƒã‚°ã®äº‹å‰æº–å‚™ ãƒ‡ãƒãƒƒã‚°ã§ã¯è¡Œæ•°ãŒã‚ã‹ã‚‰ãªã„ä»•æ§˜ã«ãªã£ã¦ã„ã‚‹ï¼ãã“ã§ï¼ŒWorkflowã®jobã®ã©ã“ã§å¤±æ•—ã—ã¦ã„ã‚‹ã®ã‹ã‚’ç‰¹å®šã™ã‚‹ãŸã‚ã«ï¼Œæ¤œè¨¼ã—ãªã„jobã‚’ã‚³ãƒ¡ãƒ³ãƒˆã‚¢ã‚¦ãƒˆã—ã¦ãŠãï¼ workflows: # buildä»¥å¤–ã‚’å®Ÿè¡Œã—ãªã„ã‚ˆã†ã«ã™ã‚‹ã“ã¨ã§ï¼Œbuildã®ã¿ã‚’æ¤œè¨¼ã§ãã‚‹ï¼ build-test-and-deploy: jobs: - build # - test1: # requires: # - build # - test2: # requires: # - test1 # - deploy: # requires: # - test2 ãƒ»ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ ãƒ›ã‚¹ãƒˆOSå´ã§ï¼Œä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã™ã‚‹ï¼ $ circleci config validate # ä»¥ä¸‹ã®æ–‡ç« ãŒè¡¨ç¤ºã•ã‚Œã‚Œã°å•é¡Œãªã„ï¼ # Config file at .circleci/config.yml is valid. ãƒ»å‡¦ç†ã®å±•é–‹ è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã‚’å®Ÿè¡Œã—ãŸæ™‚ã®å‡¦ç†ã‚’å±•é–‹ã—ï¼Œãƒ•ã‚¡ã‚¤ãƒ«ã«å‡ºåŠ›ã§ãã‚‹ $ circleci config process .circleci/config.yml > .circleci/process.yml ãƒ»ãƒ­ãƒ¼ã‚«ãƒ«ãƒ†ã‚¹ãƒˆ ã‚³ãƒãƒ³ãƒ‰ã«ã‚ˆã‚Šï¼Œãƒ†ã‚¹ãƒˆã«å¿…è¦ãªDockerã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’pullã—ï¼Œã‚³ãƒ³ãƒ†ãƒŠã‚’æ§‹ç¯‰ã™ã‚‹ï¼ç¶šã„ã¦ï¼Œã‚³ãƒ³ãƒ†ãƒŠå†…ã§CircleCIã‚’å®Ÿè¡Œã™ã‚‹ï¼ãƒãƒ¼ã‚¸ãƒ§ãƒ³2.1ä»¥é™ã§ã¯ï¼Œäº‹å‰ã«ï¼Œè¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã®å‡¦ç†ã‚’å±•é–‹ã—ã¦ãŠãå¿…è¦ãŒã‚ã‚‹ï¼ # ãƒãƒ¼ã‚¸ãƒ§ãƒ³2.1ã®è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã®å‡¦ç†ã‚’å±•é–‹ $ circleci config process .circleci/config.yml > .circleci/process.yml # å°‚ç”¨ã®Dockerã‚³ãƒ³ãƒ†ãƒŠã‚’æ§‹ç¯‰ã—ï¼Œå±•é–‹ãƒ•ã‚¡ã‚¤ãƒ«ã‚’å…ƒã«ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œ $ circleci local execute -c .circleci/process.yml --job ãƒ»CircleCIã‚³ãƒ³ãƒ†ãƒŠã«sshæ¥ç¶š CircleCIã‚³ãƒ³ãƒ†ãƒŠã«sshæ¥ç¶šã—ï¼Œã‚³ãƒ³ãƒ†ãƒŠå†…ã§ç”Ÿæˆã•ã‚ŒãŸãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç¢ºèªã§ãã‚‹ï¼ $ -i ~/.ssh/ ãƒ»Test Insights å„ãƒ†ã‚¹ãƒˆã®ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã‚„æˆåŠŸå¤±æ•—ç‡ã‚’ç¢ºèªã§ãã‚‹ï¼ https://circleci.com/docs/2.0/insights-tests/ PHPUnitã®è‡ªå‹•å®Ÿè¡Œ ãƒ»ä»•çµ„ã¿ ãƒ†ã‚¹ãƒˆã‚¯ãƒ©ã‚¹ã‚’å®Ÿè£…ã—ãŸã†ãˆã§ï¼Œæ–°æ©Ÿèƒ½ã‚’è¨­è¨ˆå®Ÿè£…ã™ã‚‹ï¼ ãƒªãƒã‚¸ãƒˆãƒªã¸Pushã™ã‚‹ã¨ï¼ŒCIãƒ„ãƒ¼ãƒ«ãŒGituHubã‹ã‚‰ãƒ–ãƒ©ãƒ³ãƒã®çŠ¶æ…‹ã‚’å–å¾—ã™ã‚‹ï¼ CIãƒ„ãƒ¼ãƒ«ã«ã‚ˆã£ã¦ï¼ŒDockerHubã‹ã‚‰å–å¾—ã—ãŸDockerfileã®ãƒ“ãƒ«ãƒ‰ï¼ŒPHPUnitãªã©ãŒè‡ªå‹•å®Ÿè¡Œã•ã‚Œã‚‹ï¼ çµæœã‚’é€šçŸ¥ã™ã‚‹ã“ã¨ã‚‚å¯èƒ½ï¼ PHPStanã®è‡ªå‹•å®Ÿè¡Œ ãƒ»ä»•çµ„ã¿ 02-02. version versionã¨ã¯ CircleCIã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’å®£è¨€ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š version: 2.1 02-03. parameters parameters ãƒ»parametersã¨ã¯ ç¨®é¡ å‚ç…§ç¯„å›² å€¤ã‚’è¨­å®šã™ã‚‹å ´æ‰€ command parameters commandå†…ã§å®šç¾©ã™ã‚‹ï¼å®šç¾©ã•ã‚ŒãŸcommandå†…ã®ã¿ã§å®šç¾©ã§ãã‚‹ï¼ workflows job parameters jobå†…ã§å®šç¾©ã™ã‚‹ï¼å®šç¾©ã•ã‚ŒãŸjobå†…ã®ã¿ã§å‚ç…§ã§ãã‚‹ï¼ workflows executors parameter executorså†…ã§å®šç¾©ã™ã‚‹ï¼å®šç¾©ã•ã‚ŒãŸexecutoså†…ã®ã¿ã§å‚ç…§ã§ãã‚‹ï¼ job pipeline parameters ãƒˆãƒƒãƒ—ãƒ¬ãƒ™ãƒ«ã§å®šç¾©ã™ã‚‹ï¼ãƒªãƒã‚¸ãƒˆãƒªå†…ã§ã®ã¿å‚ç…§ã§ãã‚‹ï¼ workflows command parameters ãƒ»å€¤ã®å‡ºåŠ›æ–¹æ³• å¼•æ•°åã‚’ä½¿ç”¨ã—ã¦ï¼Œparametersã‹ã‚‰å€¤ã‚’å‡ºåŠ›ã™ã‚‹ï¼ > ãƒ»job parameterã‚’å‚ç…§ å®šç¾©ã§ãã‚‹ãƒ‡ãƒ¼ã‚¿å‹ã¯ï¼Œjob parameterã¨åŒã˜ï¼å®šç¾©ã•ã‚ŒãŸcommandå†…ã®ã¿ã§å®šç¾©ã§ãã‚‹ï¼ version: 2.1 commands: sayhello: description: \"Echo hello world\" # å¼•æ•°ã®å®šç¾© parameters: to: type: string # ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ default: \"Hello World\" steps: - run: echo > job parameters ãƒ»å€¤ã®å‡ºåŠ›æ–¹æ³• å¼•æ•°åã‚’ä½¿ç”¨ã—ã¦ï¼Œparametersã‹ã‚‰å€¤ã‚’å‡ºåŠ›ã™ã‚‹ï¼ > ãƒ»ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã«ã¤ã„ã¦ å¼•æ•°ãŒä¸ãˆã‚‰ã‚Œãªã‹ã£ãŸå ´åˆã«é©ç”¨ã•ã‚Œã‚‹defaultã‚’è¨­å®šã§ãã‚‹ï¼defaultã‚’è¨­å®šã—ãªã„å ´åˆï¼Œå¼•æ•°ãŒå¿…é ˆã¨è¦‹ãªã•ã‚Œã‚‹ï¼ version: 2.1 commands: sayhello: description: \"Echo hello world\" parameters: to: type: string default: \"Hello World\" steps: - run: echo > ãƒ»stringå‹ å¼•æ•°ã¨ã—ã¦ï¼Œä»»æ„ã®æ–‡å­—åˆ—ã‚’æ¸¡ã—ãŸã„ã¨ãã«ä½¿ç”¨ã™ã‚‹ï¼workflowsã«ã¦ï¼Œå€¤ã‚’è¨­å®šã™ã‚‹ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š version: 2.1 commands: print: # å¼•æ•°ã‚’å®šç¾© parameters: message: # ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ãŒç„¡ã„å ´åˆã¯å¿…é ˆ type: string steps: - run: echo > jobs: cat-file: parameters: file: type: string steps: - print: # parametersã®å€¤ã‚’æ¸¡ã™ message: Printing > - run: cat > workflows: my-workflow: jobs: - cat-file: # workflowã«ã¦æ–‡å­—åˆ—å‹ã®å€¤ã‚’è¨­å®š file: test.txt ãƒ»booleanå‹ å¤šãã®å ´åˆï¼Œå¼•æ•°ãŒTrueã®å ´åˆã®ã¿ï¼Œç‰¹å®šã®stepã‚’å®Ÿè¡Œã—ãŸã„æ™‚ã«ç”¨ã„ã‚‹ï¼jobã§å®šç¾©ã—ãŸå¾Œï¼Œworkflowsã«ã¦å€¤ã‚’è¨­å®šã™ã‚‹ï¼workflowsã«ã¦ï¼Œå€¤ã‚’è¨­å®šã™ã‚‹ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š version: 2.1 jobs: job_with_optional_custom_checkout: # å¼•æ•°ã®å®šç¾© parameters: custom_checkout: type: boolean # ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ default: false machine: true steps: - when: # å¼•æ•°ãŒtrueã®å ´åˆ condition: > steps: - run: echo \"my custom checkout\" - unless: # å¼•æ•°ã®falseã®å ´åˆ condition: > steps: - checkout workflows: build-test-deploy: jobs: - job_with_optional_custom_checkout: # workflowã«ã¦boolå‹ã®å€¤ã‚’è¨­å®š custom_checkout: true ãƒ»enumå‹ å¼•æ•°ã¨ã—ã¦ï¼Œç‰¹å®šã®æ–‡å­—åˆ—ã‚„æ•´æ•°ã®ã¿ã‚’æ¸¡ã—ãŸã„ã¨ãã«ç”¨ã„ã‚‹ï¼workflowsã«ã¦ï¼Œå€¤ã‚’è¨­å®šã™ã‚‹ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š version: 2.1 jobs: deploy: parameters: # å¼•æ•°ã‚’å®šç¾© environment: # ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ default: \"test\" type: enum enum: [\"test\", \"stg\", \"prd\"] steps: - run: # ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤testã‚’ä¸ãˆã‚‹ã¨ãã¯ä½•ã‚‚è¨­å®šã—ãªã„ name: Deploy to > command: # ä½•ã‚‰ã‹ã®å‡¦ç† workflows: deploy: jobs: - deploy: # workflowã«ã¦enumå‹ã®å€¤ã‚’è¨­å®š environment: stg executors parameter ãƒ»å€¤ã®å‡ºåŠ›æ–¹æ³• å¼•æ•°åã‚’ä½¿ç”¨ã—ã¦ï¼Œparametersã‹ã‚‰å€¤ã‚’å‡ºåŠ›ã™ã‚‹ï¼ > ãƒ»job parametersã‚’å‚ç…§ å¼•æ•°ã¨ã—ã¦ï¼Œä»»æ„ã®æ–‡å­—åˆ—ã‚’executorsã«æ¸¡ã—ãŸã„ã¨ãã«ä½¿ç”¨ã™ã‚‹ï¼ä»–ã®parametersã¨ã¯ç•°ãªã‚Šï¼Œjobã«ã¦ï¼Œå€¤ã‚’è¨­å®šã™ã‚‹ï¼ version: 2.1 executors: python: # å¼•æ•°ã®å®šç¾© parameters: tag: type: string # ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ default: latest myspecialvar: type: string docker: - image: circleci/python:> environment: MYPRECIOUS: > jobs: build: executor: name: python tag: \"2.7\" # jobã«ã¦æ–‡å­—åˆ—å‹ã®å€¤ã‚’è¨­å®š myspecialvar: \"myspecialvalue\" ãƒ»workflowã§å€¤ã‚’è¨­å®šã™ã‚‹ å…¬å¼ãƒªãƒ•ã‚¡ãƒ¬ãƒ³ã‚¹ã«ã¯è¼‰ã£ã¦ã„ãªã„ãŸã‚ï¼Œæ–¹æ³•ã¨ã—ã¦ã¯éæ¨å¥¨ï¼parameterã‚’æ¸¡ã—ãŸã„executorã‚’ä½¿ã„ã¾ã‚ã—ãŸã„æ™‚ã«ä½¿ç”¨ã™ã‚‹ï¼ version: 2.1 executors: python: # å¼•æ•°ã®å®šç¾© parameters: env: type: enum enum: [ \"2.7\", \"3.5\" ] myspecialvar: type: string docker: - image: circleci/python:> environment: MYPRECIOUS: > jobs: build: # å¼•æ•°ã®å®šç¾© parameters: # executorã‚’ãƒ‡ãƒ¼ã‚¿å‹ã¨ã—ã¦é¸æŠ executor_param: type: executor executor: > workflows: version: 2.1 build-push: jobs: - build: # jobã«ã¦executoråã‚’è¨­å®šã—ï¼Œã•ã‚‰ã«executorã«å€¤ã‚’æ¸¡ã™ executor_param: name: python # ãƒãƒ¼ã‚¸ãƒ§ãƒ³3.5ã‚’è¨­å®š tag: \"2.7\" myspecialvar: \"myspecialvalue\" - build: executor_param: name: python # ãƒãƒ¼ã‚¸ãƒ§ãƒ³3.5ã‚’è¨­å®š tag: \"3.5\" myspecialvar: \"myspecialvalue\" pipeline parameters ãƒ»å€¤ã®å‡ºåŠ›æ–¹æ³• å¼•æ•°åã‚’ä½¿ç”¨ã—ã¦ï¼Œpipeline.parametersã‹ã‚‰å€¤ã‚’å‡ºåŠ›ã™ã‚‹ï¼ > ãƒ»job parametersã‚’å‚ç…§ å®šç¾©ã§ãã‚‹ãƒ‡ãƒ¼ã‚¿å‹ã¯ï¼Œjob parameterã¨åŒã˜ï¼ãƒªãƒã‚¸ãƒˆãƒªå†…ã§ã®ã¿å‚ç…§ã§ãã‚‹ï¼ version: 2.1 parameters: # å¼•æ•°ã‚’å®šç¾© image-tag: type: string # ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ default: \"latest\" workingdir: type: string default: \"~/main\" jobs: build: docker: - image: circleci/node:> auth: username: mydockerhub-user password: $DOCKERHUB_PASSWORD environment: IMAGETAG: > working_directory: > steps: - run: echo \"Image tag used was ${IMAGETAG}\" - run: echo \"$(pwd) == >\" workflows: my-workflow: jobs: - build: # å¼•æ•°å: æ¸¡ã™å€¤ image-tag: \"1.0\" workdir: \"/tmp\" 02-04. jobs jobs ãƒ»jobsã¨ã¯ è¤‡æ•°ã®jobã‚’å®šç¾©ã™ã‚‹ï¼Workflowsã‚’ä½¿ã‚ãªã„å ´åˆã¯ï¼Œå°‘ãªãã¨ã‚‚ä¸€ã¤ã®jobã«ã¯buildã¨ã„ã†åå‰ã‚’ä½¿ç”¨ã—ãªã‘ã‚Œã°ãªã‚‰ãªã„ï¼ ãƒ»jobã®ç²’åº¦ ç²’åº¦ èª¬æ˜ å‚™è€ƒ build ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã®å®Ÿè¡Œç’°å¢ƒã‚’æ§‹ç¯‰ã™ã‚‹ï¼ buildã¨testã‚’åˆ†å‰²ã—ã«ãã„å ´åˆã¯ï¼ŒåŒã˜jobã§å®šç¾©ã—ã¦ã‚‚ã‚ˆã„ï¼ test ç¨®ã€…ã®ãƒ†ã‚¹ãƒˆï¼ˆUnitãƒ†ã‚¹ãƒˆï¼ŒFunctionalãƒ†ã‚¹ãƒˆï¼Œãªã©ï¼‰ã‚’å®Ÿè¡Œã™ã‚‹ï¼ deploy ã‚¹ãƒ†ãƒ¼ã‚¸ãƒ³ã‚°ç’°å¢ƒã¾ãŸã¯æœ¬ç•ªç’°å¢ƒã¸ã®ãƒ‡ãƒ—ãƒ­ã‚¤ã‚’å®Ÿè¡Œã™ã‚‹ï¼ dockerï¼Œmachine ãƒ»ä»®æƒ³ç’°å¢ƒã®é¸æŠ jobã‚’å®Ÿè¡Œã™ã‚‹ä»®æƒ³ç’°å¢ƒã‚’é¸æŠã§ãã‚‹ï¼ ãƒ»dockerã‚¿ã‚¤ãƒ—ã¨ã¯ Dockerã‚³ãƒ³ãƒ†ãƒŠã‚’å®Ÿè¡Œç’°å¢ƒã¨ã—ã¦è¨­å®šã™ã‚‹ï¼ã“ã‚Œã‚’é¸æŠã—ãŸã†ãˆã§ï¼ŒDockerã‚¤ãƒ¡ãƒ¼ã‚¸ã®ãƒ“ãƒ«ãƒ‰ï¼ˆDocker composeã‚’å«ã‚€ï¼‰ã‚’å®Ÿè¡Œã™ã‚‹å ´åˆï¼Œå®Ÿè¡Œç’°å¢ƒDockerã‚³ãƒ³ãƒ†ãƒŠã®ä¸­ã§Dockerã‚³ãƒ³ãƒ†ãƒŠã‚’æ§‹ç¯‰ã™ã‚‹ã¨ã„ã†å…¥ã‚Œå­æ§‹é€ ã«ãªã‚‹ï¼ã“ã‚Œã¯éæ¨å¥¨ã®ãŸã‚ï¼Œsetup_remote_dockerã‚’ä½¿ç”¨ã—ã¦ï¼Œå®Ÿè¡Œç’°å¢ƒDockerã‚³ãƒ³ãƒ†ãƒŠã¨ã¯åˆ¥ã®ç’°å¢ƒã§jobã‚’è¡Œã†å¿…è¦ãŒã‚ã‚‹ï¼ã¾ãŸï¼Œdockerã‚³ãƒãƒ³ãƒ‰ãŒã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¦ã„ãªã„ã‚¤ãƒ¡ãƒ¼ã‚¸ã§åˆã£ãŸå ´åˆã«ï¼Œsetup_remote_dockerã‚’æœ‰åŠ¹åŒ–ã™ã‚‹ã¨ï¼Œã“ã‚Œã‚’ä½¿ç”¨ã§ãã‚‹ã‚ˆã†ã«ãªã‚‹ï¼machineã‚¿ã‚¤ãƒ—ã‚’é¸ã‚“ã å ´åˆï¼Œsetup_remote_dockerã¯ä¸è¦ã§ã‚ã‚‹ï¼ãŸã ã—ï¼Œãƒœãƒªãƒ¥ãƒ¼ãƒ ãƒã‚¦ãƒ³ãƒˆã‚’ä½¿ç”¨ã§ããªããªã‚‹ã®ã§æ³¨æ„ã™ã‚‹ï¼ã¾ãŸï¼ŒDockerfileã®COPYã‚³ãƒãƒ³ãƒ‰ãŒæ©Ÿèƒ½ã—ãªããªã‚‹ï¼ å‚è€ƒï¼šhttps://circleci.com/docs/ja/2.0/building-docker-images/ ï¼Šå®Ÿè£…ä¾‹ï¼Š version: 2.1 jobs: build: docker: - image: circleci/foo steps: - checkout # ã‚³ãƒ³ãƒ†ãƒŠãŒå…¥ã‚Œå­ã«ãªã‚‰ãªã„ã‚ˆã†ã«ã™ã‚‹ï¼ - setup_remote_docker - run: | # DockerHubã¸ã®ãƒ­ã‚°ã‚¤ãƒ³ echo \"$DOCKER_PASS\" | docker login --username $DOCKER_USER --password-stdin docker run -d --name db company/proprietary-db:1.2.3 # Dockerã‚¤ãƒ¡ãƒ¼ã‚¸ã®ãƒ“ãƒ«ãƒ‰ - run: docker build -t company/app:$CIRCLE_BRANCH . # Dockerã‚¤ãƒ¡ãƒ¼ã‚¸ã®DockerHubã¸ã®ãƒ‡ãƒ—ãƒ­ã‚¤ - run: docker push company/app:$CIRCLE_BRANCH ãƒ»machineã‚¿ã‚¤ãƒ—ã¨ã¯ Linuxã‚µãƒ¼ãƒã‚’å®Ÿè¡Œç’°å¢ƒã¨ã—ã¦è¨­å®šã™ã‚‹ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š version: 2.1 jobs: build: machine: true steps: - checkout - run: | # DockerHubã¸ã®ãƒ­ã‚°ã‚¤ãƒ³ echo \"$DOCKER_PASS\" | docker login --username $DOCKER_USER --password-stdin docker run -d --name db company/proprietary-db:1.2.3 # Dockerã‚¤ãƒ¡ãƒ¼ã‚¸ã®ãƒ“ãƒ«ãƒ‰ - run: docker build -t company/app:$CIRCLE_BRANCH . # Dockerã‚¤ãƒ¡ãƒ¼ã‚¸ã®DockerHubã¸ã®ãƒ‡ãƒ—ãƒ­ã‚¤ - run: docker push company/app:$CIRCLE_BRANCH steps ãƒ»stepsã¨ã¯ å‡¦ç†ã‚’Mapå‹ã§å®šç¾©ã™ã‚‹ï¼ ãƒ»whenï¼Œunless ifæ–‡ã‚’å®šç¾©ã™ã‚‹ï¼whenã§ã¯æ¡ä»¶ãŒtrueã®å ´åˆï¼Œã¾ãŸunlessã§ã¯falseã®å ´åˆã«å®Ÿè¡Œã™ã‚‹stepã‚’å®šç¾©ã™ã‚‹ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š version: 2.1 jobs: custom_checkout: parameters: custom_checkout_parameters: type: bool # ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã¯false default: false machine: true steps: # å¼•æ•°ãŒtrueã®å ´åˆ - when: condition: > steps: - run: echo \"ç‹¬è‡ªã®ãƒã‚§ãƒƒã‚¯ã‚¢ã‚¦ãƒˆå‡¦ç†\" # å¼•æ•°ãŒfalseã®å ´åˆ - unless: condition: > steps: - checkout workflows: version: 2.1 build-test-deploy: jobs: - custom_checkout: # å¼•æ•°å: æ¸¡ã™å€¤ custom_checkout_parameters: true ãƒ»restore_cacheï¼Œsave_cache ãƒ“ãƒ«ãƒ‰ã®ã‚¢ãƒ¼ãƒ†ã‚£ãƒ•ã‚¡ã‚¯ãƒˆã‚’ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã¨ã—ã¦ä¿å­˜ã™ã‚‹ï¼ã“ã®æ©Ÿèƒ½ã‚’ä½¿ç”¨ã—ãªã„å ´åˆï¼Œä¾‹ãˆã°ï¼ŒCircleCIã‚³ãƒ³ãƒ†ãƒŠã§composer installã‚’å®Ÿè¡Œã™ã‚‹ã¨ï¼Œæ¯å›ã®Workflowã§åŒã˜ãƒ©ã‚¤ãƒ–ãƒ©ãƒªãŒã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã‚‹ï¼ã—ã‹ã—ï¼ŒWorkflowã®ãŸã³ã«ï¼Œãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹ã®ã¯éåŠ¹ç‡ã§ã‚ã‚‹ï¼ãã“ã§ï¼Œcomposer.jsonãƒ•ã‚¡ã‚¤ãƒ«ã®å®Ÿè£…ãŒå¤‰æ›´ã•ã‚Œãªã„é™ã‚Šï¼Œå‰å›ã®Workflowã®ãƒ“ãƒ«ãƒ‰æ™‚ã«ï¼Œvendorãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«é…ç½®ã•ã‚ŒãŸã‚¢ãƒ¼ãƒ†ã‚£ãƒ•ã‚¡ã‚¯ãƒˆã‚’å†åˆ©ç”¨ã™ã‚‹ã‚ˆã†ã«ã™ã‚‹ï¼ã“ã®æ©Ÿèƒ½ã¯ï¼Œè¤‡æ•°ã®Workflowã®é–“ã ã‘ã§ãªãï¼Œä¸€ã¤ã®Workflowã®ä¸­ã§ã‚‚åˆ©ç”¨ã§ãã‚‹ï¼ å‚è€ƒï¼šhttps://circleci.com/docs/ja/2.0/caching/#%E3%83%A9%E3%82%A4%E3%83%96%E3%83%A9%E3%83%AA%E3%81%AE%E3%82%AD%E3%83%A3%E3%83%83%E3%82%B7%E3%83%A5 ï¼Šå®Ÿè£…ä¾‹ï¼Š composerã‚’ä½¿ç”¨ã—ã¦ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹æ™‚ã«ï¼Œå‰å›ã®çµæœã‚’å†åˆ©ç”¨ã™ã‚‹ï¼ version: 2.1 jobs: build: steps: # composer.jsonãŒå¤‰æ›´ã•ã‚Œã¦ã„ã‚‹å ´åˆã¯å‡¦ç†ã‚’ã‚¹ã‚­ãƒƒãƒ—ï¼ - restore_cache: key: - v1-dependecies-{{ checksum \"composer.json\" }} - v1-dependencies- # å–å¾—ã—ãŸcomposer.jsonã‚’å…ƒã«ï¼Œå·®åˆ†ã®vendorã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ« - run: name: Run composer install commands: | composer install -n --prefer-dist # æœ€æ–°ã®vendorãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã¨ã—ã¦ä¿å­˜ - save_cache: key: v1-dependecies-{{ checksum \"composer.json\" }} paths: - ./vendor ï¼Šå®Ÿè£…ä¾‹ï¼Š yarnã‚’ä½¿ç”¨ã—ã¦ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹æ™‚ã«ï¼Œå‰å›ã®çµæœã‚’å†åˆ©ç”¨ã™ã‚‹ï¼ version: 2.1 jobs: build_and_test: docker: - image: circleci/python:3.8-node steps: - checkout - restore_cache: keys: - v1-dependencies-{{ checksum \"package.json\" }} - v1-dependencies- - run: name: Run yarn install commands: | yarn install - save_cache: paths: - node_modules key: v1-dependencies-{{ checksum \"yarn.lock\" }} - run: name: Run yarn build commands : | yarn build - run: name: Run yarn test commands : | yarn test ãŸã ï¼Œã“ã®æ©Ÿèƒ½ã¯commandsã§å…±é€šåŒ–ã—ãŸæ–¹ãŒå¯èª­æ€§ãŒè‰¯ã„ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š version: 2.1 commands: restore_vendor: steps: # composer.jsonã®å®Ÿè£…ãŒå¤‰æ›´ã•ã‚Œã¦ã„ãªã„å ´åˆã¯å‡¦ç†ã‚’ã‚¹ã‚­ãƒƒãƒ—ï¼ - restore_cache: key: - v1-dependencies-{{ checksum \"composer.json\" }} - v1-dependencies- save_vendor: steps: # æœ€æ–°ã®vendorã‚’ä¿å­˜ï¼ - save_cache: key: v1-dependencies-{{ checksum \"composer.json\" }} paths: - ./vendor jobs: build: steps: - restore_vendor # å–å¾—ã—ãŸcomposer.jsonã‚’å…ƒã«ï¼Œå·®åˆ†ã®vendorã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ« - run: name: Run composer install commands: | composer install -n --prefer-dist - save_vendor ãƒ»persist_to_workspaceï¼Œattach_workspace CircleCIã§ã¯ï¼Œjobã”ã¨ã«ç•°ãªã‚‹ä»®æƒ³ç’°å¢ƒãŒæ§‹ç¯‰ã•ã‚Œã‚‹ãŸã‚ï¼Œä»–ã®jobã§ä½¿ç”¨ã•ã‚ŒãŸä¸€æ™‚ãƒ•ã‚¡ã‚¤ãƒ«ã‚’å†åˆ©ç”¨ã—ãŸã„å ´åˆã«ï¼Œã“ã‚Œã‚’ä½¿ã†ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š version: 2.1 jobs: jobA: steps: # Workspaceã«ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ - persist_to_workspace: # jobAã«ã¦ï¼ŒWorkspaceã¨ã™ã‚‹ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã®root root: /tmp/workspace # Rootãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’åŸºæº–ã¨ã—ãŸç›¸å¯¾ãƒ‘ã‚¹ï¼ˆ\"./\"ä»¥å¤–ã®å ´åˆã¯ï¼Œãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã®ä½œæˆãŒå¿…è¦ï¼‰ # ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã¯ç’°å¢ƒå¤‰æ•°ã¨ã—ã¦å‡ºåŠ›ã§ããªã„ã®ã§æ³¨æ„ paths: - target/application.jar - build/* jobB: steps: # persist_to_workspaceã§ä½œæˆã•ã‚ŒãŸWorkspaceã‹ã‚‰ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ - attach_workspace: # jobAã¨ã¯ç•°ãªã‚‹ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ï¼Œãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¦ã‚‚ã‚ˆã„ at: /tmp/workspace å…¨ã¦ã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’ä¿æŒã™ã‚‹ã‚ˆã†ãªå ´åˆãŒã»ã¨ã‚“ã©ã¨æ€ã‚ã‚Œã‚‹ãŸã‚ï¼Œã‚«ãƒ¬ãƒ³ãƒˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªä»¥ä¸‹ï¼ˆ.ï¼‰ã‚’æŒ‡å®šã™ã‚‹ã®ãŒã‚ˆã„ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š version: 2.1 jobs: jobA: steps: - persist_to_workspace: root: . paths: - . jobB: steps: - attach_workspace: at: . 02-04. commands commandsã¨ã¯ è¨­å®šã‚’éƒ¨å“åŒ–ã—ï¼Œç•°ãªã‚‹jobã§stepã¨ã—ã¦ç¹°ã‚Šè¿”ã—åˆ©ç”¨ã§ãã‚‹ï¼ éƒ¨å“åŒ–ã¨å†åˆ©ç”¨ ï¼Šå®Ÿè£…ä¾‹ï¼Š version: 2.1 commands: sayhello: description: \"Echo hello world\" parameters: text: type: string default: \"Hello World\" steps: # parametersã®å€¤ã‚’æ¸¡ã™ - run: echo > jobs: myjob: docker: - image: \"circleci/node:9.6.1\" steps: # commandå - sayhello: # å¼•æ•°å: æ¸¡ã™å€¤ text: \"Lev\" 02-05. executors executors ãƒ»executorsã¨ã¯ å®Ÿè¡Œç’°å¢ƒã«é–¢ã™ã‚‹è¨­å®šã‚’éƒ¨å“åŒ–ã—ï¼Œç•°ãªã‚‹jobã§ç¹°ã‚Šè¿”ã—åˆ©ç”¨ã§ãã‚‹ï¼ éƒ¨å“åŒ–ã¨å†åˆ©ç”¨ ï¼Šå®Ÿè£…ä¾‹ï¼Š version: 2.1 executors: # ãƒ›ã‚¹ãƒˆOSç’°å¢ƒå my-executor: # ãƒ›ã‚¹ãƒˆOSç’°å¢ƒ docker: - image: circleci/ruby:2.5.1-node-browsers working_directory: ~/foo_project environment: XX: xx YY: yy jobs: my-job: executor: my-executor steps: - run: echo \"${XX}ã¨${YY}ã§ã™\" 02-06. Workflow Workflowã®ç²’åº¦ ãƒ»ãƒ–ãƒ©ãƒ³ãƒåˆ¥ ï¼Šå®Ÿè£…ä¾‹ï¼Š workflows: # Featureãƒ–ãƒ©ãƒ³ãƒã‚’ãƒ¬ãƒ“ãƒ¥ãƒ¼ feature: jobs: - build: name: build_feat filters: branches: only: - /feature.*/ - test: name: test_feat requires: - build_feat # ã‚¹ãƒ†ãƒ¼ã‚¸ãƒ³ã‚°ç’°å¢ƒã«ãƒ‡ãƒ—ãƒ­ã‚¤ develop: jobs: - build: name: build_stg filters: branches: only: - develop - test: name: test_stg requires: - build_stg - deploy: name: deploy_stg requires: - test_stg # æœ¬ç•ªç’°å¢ƒã«ãƒ‡ãƒ—ãƒ­ã‚¤ main: jobs: - build: name: build_prd filters: branches: only: - main - test: name: test_prd requires: - build_prd - deploy: name: deploy_prd requires: - test_prd ç‰¹æ®Šãªsteps ãƒ»pre-stepsï¼Œpost-steps äº‹å‰ã«jobã«å®šç¾©ã™ã‚‹å¿…è¦ã¯ãªã„ï¼workspaceã§ï¼Œã‚³ãƒ¼ãƒ«ã•ã‚Œã‚‹jobã®å¼•æ•°ã¨ã—ã¦è¨­å®šã™ã‚‹ã“ã¨ã§ï¼Œãã®jobå†…ã®æœ€åˆã¨æœ€å¾Œã«ï¼Œstepsã‚’è¿½åŠ ã§ãã‚‹ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š version: 2.1 jobs: bar: machine: true steps: - checkout - run: command: echo \"building\" - run: command: echo \"testing\" workflows: build: jobs: - bar: # Workspaceå‰ã«è¡Œã†å‡¦ç† pre-steps: - run: command: echo \"install custom dependency\" # Workspaceå¾Œã«è¡Œã†å‡¦ç† post-steps: - run: command: echo \"upload artifact to s3\" Orbsã‚’ä½¿ã†å ´åˆã¯ï¼Œã‚ªãƒ—ã‚·ãƒ§ãƒ³ã«å¼•æ•°ã‚’æ¸¡ã™å‰ã«å®šç¾©ã™ã‚‹ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š workflows: build: jobs: - aws-foo/build-push-yyy: # Workspaceå‰ã«è¡Œã†å‡¦ç† pre-steps: - run: command: echo \"FOO\" # Workspaceå¾Œã«è¡Œã†å‡¦ç† post-steps: - run: command: echo \"FOO\" # Orbsã®ã‚ªãƒ—ã‚·ãƒ§ãƒ³ name: foo dockerfile: foo tag: foo filters ãƒ»filtersã¨ã¯ ã‚³ãƒŸãƒƒãƒˆã•ã‚ŒãŸæ™‚ã«jobãŒç™ºç«ã™ã‚‹ãƒ–ãƒ©ãƒ³ãƒåï¼Œã‚ã‚‹ã„ã¯ç™ºç«ã—ãªã„ãƒ–ãƒ©ãƒ³ãƒåï¼Œã‚’è¨­å®šã™ã‚‹ï¼æ­£è¦è¡¨ç¾ã§å®Ÿè£…ã™ã‚‹å¿…è¦ãŒã‚ã‚‹ï¼ ãƒ»onlyï¼Œignore ã‚ˆãã‚ã‚‹ãƒ‘ã‚¿ãƒ¼ãƒ³ èª¬æ˜ /.*/ å…¨ã¦ã®ãƒ–ãƒ©ãƒ³ãƒã‚’æ˜ç¤ºçš„ã«æŒ‡å®š /feature\\/.*/ ã€Œfeature/ã€ã¨åå‰ã®ã¤ã„ãŸãƒ–ãƒ©ãƒ³ãƒã‚’æŒ‡å®š ï¼Šå®Ÿè£…ä¾‹ï¼Š workflows: version: 2.1 build: jobs: - foo: filters: branches: only: - /.*/ workflows: version: 2.1 build: jobs: - foo: filters: branches: ignore: - /feature\\/.*/ ãƒ»tags ã‚¿ã‚°ã‚’ã¤ã‘ãŸã‚³ãƒŸãƒƒãƒˆã«å¯¾ã—ã¦ç™ºç«ã™ã‚‹ï¼ignoreã‚­ãƒ¼ã§å…¨ã¦ã®ãƒ–ãƒ©ãƒ³ãƒã‚’æŒ‡å®šã™ã‚‹ã“ã¨ã«ã‚ˆã‚Šï¼Œãƒãƒ¼ã‚¸ã«ã‚ˆã‚‹ç™ºç«ã‚’é˜²ã’ã‚‹ï¼ workflows: version: 2.1 build: jobs: - foo: filters: branches: ignore: /.*/ tags: only: /release\\/.*/ 02-07. ç’°å¢ƒå¤‰æ•° CircleCIã«ãŠã‘ã‚‹ç’°å¢ƒå¤‰æ•°ã¨ã¯ ãƒ»ç’°å¢ƒå¤‰æ•°ã®ç¨®é¡ã¨å‚ç…§ç¯„å›² å‚ç…§ãƒ¬ãƒ™ãƒ« æ–¹æ³• èª¬æ˜ Bash exportï¼Œsourceï¼Œ$BASH_ENV runã«ãŠã‘ã‚‹commandå†…ã®ã¿ã§å‚ç…§ã§ãã‚‹ï¼ãŸã ã—ï¼Œ$BASH_ENVã‚’ä½¿ç”¨ã™ã‚Œã°ï¼Œç•°ãªã‚‹commandsé–“ã§å€¤ã‚’å…±æœ‰å¯èƒ½ï¼ Container environment jobå†…ã®ç‰¹å®šã®ã‚³ãƒ³ãƒ†ãƒŠã®ã¿ã§å‚ç…§ã§ãã‚‹ï¼ Job environment jobå†…ã®ã¿ã§å‚ç…§ã§ãã‚‹ï¼ Project Environment Variablesæ©Ÿèƒ½ ãƒªãƒã‚¸ãƒˆãƒªå†…ã®ã¿å‚ç…§ã§ãã‚‹ï¼ Global Contextsæ©Ÿèƒ½ ç•°ãªã‚‹ãƒªãƒã‚¸ãƒˆãƒªé–“ã§å‚ç…§ã§ãã‚‹ï¼ ãƒ»ç’°å¢ƒå¤‰æ•°ã®å‡ºåŠ›æ–¹æ³• ç’°å¢ƒå¤‰æ•°ã‚’echoã®å¼•æ•°ã«æŒ‡å®šã™ã‚‹ï¼ã‚ã‚‰ã‹ã˜ã‚ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ã•ã‚ŒãŸç’°å¢ƒå¤‰æ•°ã‚’ç®¡ç†ã—ã¦ãŠãï¼Œbase64 --decodeã‚’å®Ÿè¡Œã—ã¦å‡ºåŠ›ã™ã‚‹ã¨ï¼Œå®‰å…¨ã«ç’°å¢ƒå¤‰æ•°ã‚’ç®¡ç†ã§ãã‚‹ï¼ã“ã“ã§å‡ºåŠ›ã—ã¦ã„ã‚‹ç’°å¢ƒå¤‰æ•°ã¯ï¼Œä»¥ä¸‹ã®ãƒãƒ¼ãƒˆã‚’å‚è€ƒã«ã›ã‚ˆ å‚è€ƒï¼šhttps://hiroki-it.github.io/tech-notebook-gitbook/public/software/software_application_frontend_js_framework_nuxtjs.html jobs: build_and_ docker: - image: circleci/python:3.8-node steps: - checkout - run: name: Make env file command: | echo $API_URL_BROWSER | base64 --decode > .env echo $API_URL | base64 --decode >> .env echo $OAUTH_CLIENT_ID | base64 --decode >> .env echo $OAUTH_CLIENT_SECRET | base64 --decode >> .env echo $GOOGLE_MAP_QUERY_URL | base64 --decode >> .env - run: name: Install node module commands: | yarn install - run: name: Generate nuxt-ts commands: | yarn nuxt-ts generate ãªãŠï¼Œæ–‡å­—åˆ—ã®ä¸­ã«å€¤ã‚’å‡ºåŠ›ã™ã‚‹å¤‰æ•°å±•é–‹ã®å ´åˆï¼Œ${}ã‚’ä½¿ç”¨ã™ã‚‹ï¼ # å¤‰æ•°å±•é–‹ã®å ´åˆ steps: - checkout - run: name: FOO commands: | echo \"This is ${FOO}\" Bashãƒ¬ãƒ™ãƒ« ãƒ»commandã‚­ãƒ¼ã«ã‚ˆã‚‹è¨­å®š ä¸€ç•ªå‚ç…§ç¯„å›²ãŒå°ã•ãï¼Œrunã«ãŠã‘ã‚‹åŒã˜commandå†…ã®ã¿ã§å‚ç…§ã§ãã‚‹ï¼commandå†…ã§ä½¿ç”¨ã™ã‚‹ç’°å¢ƒå¤‰æ•°ã‚’å®šç¾©ã™ã‚‹ãŸã‚ã«ã¯ï¼Œã€$BASH_ENVã€ã«exportå‡¦ç†ã‚’æ ¼ç´ã™ã‚‹å¿…è¦ãŒã‚ã‚‹ï¼å®šç¾©ã—ãŸã‚‚ã®ã‚’ä½¿ç”¨ã™ã‚‹ãŸã‚ã«ã¯ï¼Œã€$BASH_ENVã€ã‚’sourceã§èª­ã¿è¾¼ã‚€å¿…è¦ãŒã‚ã‚‹ãŸã‚ã«æ³¨æ„ã™ã‚‹ï¼ å‚è€ƒï¼šhttps://circleci.com/docs/ja/2.0/env-vars/#%E3%82%B7%E3%82%A7%E3%83%AB-%E3%82%B3%E3%83%9E%E3%83%B3%E3%83%89%E3%81%A7%E3%81%AE%E7%92%B0%E5%A2%83%E5%A4%89%E6%95%B0%E3%81%AE%E8%A8%AD%E5%AE%9A ï¼Šå®Ÿè£…ä¾‹ï¼Š version: 2.1 jobs: build: docker: - image: smaant/lein-flyway:2.7.1-4.0.3 auth: username: mydockerhub-user password: $DOCKERHUB_PASSWORD steps: - run: name: Update PATH and Define Environment Variable at Runtime command: | echo \"export PATH=/path/to/foo/bin:$PATH\" >> $BASH_ENV echo \"export VERY_IMPORTANT=$(cat important_value)\" >> $BASH_ENV source $BASH_ENV echo \"$PATH\" echo \"$VERY_IMPORTANT\" CircleCIã§ã¯runã‚’å®Ÿè¡Œã™ã‚‹æ™‚ã«ã€$BASH_ENVã€ãŒsourceã§è‡ªå‹•çš„ã«èª­ã¿è¾¼ã¾ã‚Œã‚‹ã‚ˆã†ã«ãªã£ã¦ã„ã‚‹ï¼ãã®ãŸã‚ï¼Œã€$BASH_ENVã€ã¯è¤‡æ•°ã®runé–“ã€ã§å…±æœ‰ã§ãã‚‹ï¼ãŸã ã—ï¼ŒAlpineãƒ™ãƒ¼ã‚¹ã®ã‚¤ãƒ¡ãƒ¼ã‚¸ã§ã¯ï¼Œã“ã®å…±æœ‰æ©Ÿèƒ½ã‚’ä½¿ãˆãªã„ãŸã‚æ³¨æ„ã™ã‚‹ï¼ˆã‹ãªã‚ŠãŸãã•ã‚“ã‚ã‚‹ï¼‰ï¼ å‚è€ƒï¼šhttps://github.com/circleci/circleci-docs/issues/1650 version: 2.1 jobs: build: docker: - image: smaant/lein-flyway:2.7.1-4.0.3 auth: username: mydockerhub-user password: $DOCKERHUB_PASSWORD steps: - run: name: Update PATH and Define Environment Variable at Runtime command: | echo \"export PATH=/path/to/foo/bin:$PATH\" >> $BASH_ENV echo \"export VERY_IMPORTANT=$(cat important_value)\" >> $BASH_ENV - run: name: Echo # BASH_ENVãŒè‡ªå‹•çš„ã«èª­ã¿è¾¼ã¾ã‚Œã‚‹ï¼ command: | echo \"$PATH\" echo \"$VERY_IMPORTANT\" ãƒ»ã‚·ã‚§ãƒ«ã‚¹ã‚¯ãƒªãƒ—ãƒˆã«ã‚ˆã‚‹è¨­å®š ç’°å¢ƒå¤‰æ•°ã«å€¤ã‚’è¨­å®šã™ã‚‹å‡¦ç†ã‚’ã‚·ã‚§ãƒ«ã‚¹ã‚¯ãƒªãƒ—ãƒˆã«åˆ‡ã‚Šåˆ†ã‘ï¼Œç’°å¢ƒå¤‰æ•°ã‚’ä½¿ç”¨ã™ã‚‹å‰ã«ã“ã‚Œã‚’èª­ã¿è¾¼ã‚€ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š version: 2.1 jobs: build: docker: - image: smaant/lein-flyway:2.7.1-4.0.3 auth: username: mydockerhub-user password: $DOCKERHUB_PASSWORD steps: - run: name: Update PATH and Define Environment Variable at Runtime command: | source export_envs.sh echo \"$PATH\" echo \"$VERY_IMPORTANT\" #!/bin/bash set -xeuo pipefail echo \"export PATH=/path/to/foo/bin:$PATH\" >> $BASH_ENV echo \"export VERY_IMPORTANT=$(cat important_value)\" >> $BASH_ENV # ç’°å¢ƒå¤‰æ•°ã‚’å‡ºåŠ›ã—ã¾ã™ï¼ source $BASH_ENV ãƒ»ãƒ’ã‚¢ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã§ä½œæˆã—ãŸã‚·ã‚§ãƒ«ã‚¹ã‚¯ãƒªãƒ—ãƒˆã«ã‚ˆã‚‹è¨­å®š ãƒ’ã‚¢ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’ä½¿ç”¨ã—ã¦ï¼Œç’°å¢ƒå¤‰æ•°ã‚’è¨­å®šã§ãã‚‹ã‚·ã‚§ãƒ«ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’ä½œæˆã—ï¼Œã“ã‚Œã‚’èª­ã¿è¾¼ã‚€ï¼ãƒ’ã‚¢ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã§ã¯ï¼Œå„è¡Œã§echoãŒå®Ÿè¡Œã•ã‚Œã‚‹ï¼ãã®ãŸã‚ï¼Œechoã®å®Ÿè£…ãŒä¸è¦ã§ã‚ã‚‹ã“ã¨ã«æ³¨æ„ã™ã‚‹ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š cat \"export_envs.sh\" #!/bin/bash set -xeuo pipefail \"export PATH=/path/to/foo/bin:$PATH\" >> $BASH_ENV \"export VERY_IMPORTANT=$(cat important_value)\" >> $BASH_ENV source $BASH_ENV EOF Containerãƒ¬ãƒ™ãƒ« Bashãƒ¬ãƒ™ãƒ«ã‚ˆã‚Šå‚ç…§ç¯„å›²ãŒå¤§ããï¼Œjobå†…ã®ã¿ã§å‚ç…§ã§ãã‚‹ï¼environmentã‚’imageã¨åŒã˜éšå±¤ã§å®šç¾©ã™ã‚‹ï¼ version: 2.1 jobs: build: docker: - image: postgres:9.4.1 # imageã¨åŒã˜éšå±¤ã§å®šç¾©ï¼ˆï¼‰ environment: POSTGRES_USER: root Projectãƒ¬ãƒ™ãƒ« Containerãƒ¬ãƒ™ãƒ«ã‚ˆã‚Šå‚ç…§ç¯„å›²ãŒå¤§ããï¼Œãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå†…ï¼Œã™ãªã‚ã¡ãƒªãƒã‚¸ãƒˆãƒªå†…ã®ã¿ã§å‚ç…§ã§ãã‚‹ï¼Environment Variablesæ©Ÿèƒ½ã‚’ä½¿ç”¨ã™ã‚‹ï¼ç’°å¢ƒå¤‰æ•°ã®å€¤ãŒï¼”æ–‡å­—æœªæº€ï¼Œã¾ãŸã¯ç’°å¢ƒå¤‰æ•°ã®å€¤ãŒ trueã€Trueã€falseã€False ã®ã„ãšã‚Œã‹ã®å ´åˆï¼ŒCircleCIã®å‡¦ç†ã§å‡ºåŠ›ã•ã‚Œã‚‹ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ç’°å¢ƒå¤‰æ•°ã¯ãƒã‚¹ã‚­ãƒ³ã‚°ã•ã‚Œãªã„ãŸã‚ï¼Œæ³¨æ„ãŒå¿…è¦ã§ã‚ã‚‹ï¼ Grobalãƒ¬ãƒ™ãƒ« Projectãƒ¬ãƒ™ãƒ«ã‚ˆã‚Šå‚ç…§ç¯„å›²ãŒå¤§ããï¼Œç•°ãªã‚‹ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆé–“ï¼Œã™ãªã‚ã¡ãƒªãƒã‚¸ãƒˆãƒªé–“ã§å‚ç…§ã§ãã‚‹ï¼Contextsæ©Ÿèƒ½ã‚’ä½¿ç”¨ã™ã‚‹ï¼ 02-08. Docker Compose in CircleCI docker-composeã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ« ãƒ»dockerã‚¿ã‚¤ãƒ—ã®å ´åˆ è‡ªåˆ†ã§docker-composeã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹å¿…è¦ãŒã‚ã‚‹ï¼å®Ÿè¡Œç’°å¢ƒã¨ã—ã¦ã®Dockerã‚³ãƒ³ãƒ†ãƒŠã¨ï¼Œãƒ“ãƒ«ãƒ‰ã—ãŸDockerã‚³ãƒ³ãƒ†ãƒŠãŒå…¥ã‚Œå­ã«ãªã‚‰ãªã„ã‚ˆã†ã«ï¼Œsetup_remote_dockerã‚’å®Ÿè¡Œã™ã‚‹å¿…è¦ãŒã‚ã‚‹ï¼ãŸã ã—ï¼Œãƒœãƒªãƒ¥ãƒ¼ãƒ ãƒã‚¦ãƒ³ãƒˆã‚’ä½¿ç”¨ã§ããªããªã‚‹ã®ã§æ³¨æ„ã™ã‚‹ï¼ version: 2.1 jobs: build: machine: image: circleci/classic:edge steps: - checkout - setup_remote_docker - run: name: Install Docker Compose command: | set -x curl -L https://github.com/docker/compose/releases/download/1.11.2/docker-compose-`uname -s`-`uname -m` > /usr/local/bin/docker-compose chmod +x /usr/local/bin/docker-compose - run: name: docker-compose up command: | set -x docker-compose up --build -d ãƒ»machineã‚¿ã‚¤ãƒ—ã®å ´åˆï¼ˆæ¨å¥¨ï¼‰ å®Ÿè¡Œç’°å¢ƒã«machineã‚¿ã‚¤ãƒ—ã‚’é¸æŠã—ãŸå ´åˆï¼Œã™ã§ã«docker-composeãŒã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¦ã„ã‚‹ï¼ å‚è€ƒï¼šhttps://circleci.com/docs/ja/2.0/configuration-reference/#%E4%BD%BF%E7%94%A8%E5%8F%AF%E8%83%BD%E3%81%AA-machine-%E3%82%A4%E3%83%A1%E3%83%BC%E3%82%B8 docker-compose & dockerize ãƒ»docker/install-dockerize CircleCIã§Docker Composeã‚’ä½¿ç”¨ã™ã‚‹å ´åˆã«å¿…è¦ã§ã‚ã‚‹ï¼Docker Composeã¯ï¼Œã‚³ãƒ³ãƒ†ãƒŠã®æ§‹ç¯‰ã®é †ç•ªã‚’åˆ¶å¾¡ã§ãã‚‹ã‚‚ã®ã®ï¼Œã‚³ãƒ³ãƒ†ãƒŠå†…ã®ãƒ—ãƒ­ã‚»ã‚¹ã®çŠ¶æ…‹ã‚’æ°—ã«ã—ãªã„ï¼ãã®ãŸã‚ï¼Œã‚³ãƒ³ãƒ†ãƒŠã®æ§‹ç¯‰å¾Œã«ï¼Œãƒ—ãƒ­ã‚»ã‚¹ãŒå®Œå…¨ã«èµ·å‹•ã—ã¦ã„ãªã„ã®ã«ã‚‚ã‹ã‹ã‚ã‚‰ãšï¼Œæ¬¡ã®ã‚³ãƒ³ãƒ†ãƒŠã®æ§‹ç¯‰ã‚’é–‹å§‹ã—ã¦ã—ã¾ã†ï¼ã“ã‚Œã«ã‚ˆã‚Šï¼Œãƒ—ãƒ­ã‚»ã‚¹ãŒå®Œå…¨ã«èµ·å‹•ã—ã¦ã„ãªã„ã‚³ãƒ³ãƒ†ãƒŠã«å¯¾ã—ã¦ï¼Œæ¬¡ã«æ§‹ç¯‰ã•ã‚ŒãŸã‚³ãƒ³ãƒ†ãƒŠãŒæ¥ç¶šå‡¦ç†ã‚’è¡Œã£ã¦ã—ã¾ã†ã“ã¨ãŒã‚ã‚‹ï¼ã“ã‚Œã‚’é˜²ããŸã‚ã«ï¼Œãƒ—ãƒ­ã‚»ã‚¹ã®èµ·å‹•ã‚’å¾…æ©Ÿã—ã¦ã‹ã‚‰ï¼Œæ¥ç¶šå‡¦ç†ã‚’è¡Œã†ã‚ˆã†ã«ã™ã‚‹ï¼dockerizeã®ä»£ã‚ã‚Šã®æ–¹æ³•ã¨ã—ã¦ï¼Œsleepã‚³ãƒãƒ³ãƒ‰ã‚’ä½¿ç”¨ã—ã¦ã‚‚ã‚ˆã„ï¼ å‚è€ƒï¼šhttps://github.com/docker/compose/issues/374#issuecomment-126312313 ï¼Šå®Ÿè£…ä¾‹ï¼Š Laravelã‚³ãƒ³ãƒ†ãƒŠã¨MySQLã‚³ãƒ³ãƒ†ãƒŠã®å ´åˆã‚’ç¤ºã™ï¼ã‚³ãƒ³ãƒ†ãƒŠå†…ã«å¯¾ã—ã¦ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã™ã‚‹æ™‚ã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã¯ï¼ŒDockerfileã®WORKDIRã«ã‚ˆã£ã¦æ±ºã¾ã‚‹ã®ã§æ³¨æ„ã™ã‚‹ï¼ version: 2.1 orbs: docker: circleci/docker@x.y.z commands: restore_vendor: steps: - restore_cache: key: - v1-dependecies-{{ checksum composer.json }} - v1-dependencies- save_vendor: steps: - save_cache: key: v1-dependecies-{{ checksum composer.json }} paths: - /vendor jobs: build_and_test: # Docker Composeã®æ™‚ã¯machineã‚¿ã‚¤ãƒ—ã‚’ä½¿ç”¨ã™ã‚‹ machine: image: ubuntu-1604:201903-01 steps: - checkout - run: name: Make env file command: | echo $ENV | base64 --decode > .env - run: name: Make env docker file command: | cp .env.docker.example .env.docker - run: name: Docker config command: | docker-compose config - run: name: Docker compose up command: | set -xe docker network create foo-network docker-compose up --build -d - restore_vendor # Dockerã‚³ãƒ³ãƒ†ãƒŠã«å¯¾ã—ã¦comspoerã‚³ãƒãƒ³ãƒ‰ã‚’é€ä¿¡ - run: name: Composer install command: | docker-compose exec laravel-container composer install -n --prefer-dist - save_vendor # Dockerizeã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ« - docker/install-dockerize: version: v0.6.1 - run: name: Wait for MySQL to be ready command: | # ä»£ã‚ã‚Šã«sleepã‚³ãƒãƒ³ãƒ‰ã§ã‚‚ã‚ˆã„ï¼ dockerize -wait tcp://localhost:3306 -timeout 1m # Dockerã‚³ãƒ³ãƒ†ãƒŠã«å¯¾ã—ã¦ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚³ãƒãƒ³ãƒ‰ã‚’é€ä¿¡ - run: name: Run artisan migration command: | docker-compose exec laravel-container php artisan migrate --force # Dockerã‚³ãƒ³ãƒ†ãƒŠã«å¯¾ã—ã¦PHP-Unitã‚³ãƒãƒ³ãƒ‰ã‚’é€ä¿¡ - run: name: Run unit test command: | dockercompose exec laravel-container ./vendor/bin/phpunit # Dockerã‚³ãƒ³ãƒ†ãƒŠã«å¯¾ã—ã¦PHP-Stanã‚³ãƒãƒ³ãƒ‰ã‚’é€ä¿¡ - run: name: Run static test command: | docker-compose exec laravel-container ./vendor/bin/phpstan analyse --memory-limit=512M DLCï¼šDocker Layer Cache ãƒ»DLCã¨ã¯ CircleCIã§Dockerã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’ãƒ“ãƒ«ãƒ‰ã—ãŸå¾Œï¼Œå„ã‚¤ãƒ¡ãƒ¼ã‚¸ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚’DLCãƒœãƒªãƒ¥ãƒ¼ãƒ ã«ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã™ã‚‹ï¼ãã—ã¦ï¼Œæ¬¡å›ä»¥é™ã®ãƒ“ãƒ«ãƒ‰æ™‚ã«ï¼Œå·®åˆ†ãŒãªã„ã‚¤ãƒ¡ãƒ¼ã‚¸ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚’DLCãƒœãƒªãƒ¥ãƒ¼ãƒ ã‹ã‚‰ãƒ—ãƒ«ã—ã¦å†åˆ©ç”¨ã™ã‚‹ï¼ã“ã‚Œã«ã‚ˆã‚Šï¼ŒDockerã‚¤ãƒ¡ãƒ¼ã‚¸ã®ãƒ“ãƒ«ãƒ‰æ™‚é–“ã‚’çŸ­ç¸®ã§ãã‚‹ï¼ ãƒ»ä½¿ç”¨ä¾‹ machineã‚¿ã‚¤ãƒ—ã§ä½¿ç”¨ã™ã‚‹å ´åˆï¼Œmachineã‚­ãƒ¼ã®ä¸‹ã§docker_layer_cachingã‚’ä½¿ã†ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š version: 2.1 orbs: docker: circleci/docker@x.y.z jobs: build_and_test: # Docker Composeã®æ™‚ã¯machineã‚¿ã‚¤ãƒ—ã‚’ä½¿ç”¨ã™ã‚‹ machine: image: ubuntu-1604:201903-01 # DLCã‚’æœ‰åŠ¹åŒ– docker_layer_caching: true steps: - checkout - run: name: Make env file command: | echo $ENV_TESTING | base64 --decode > .env - run: name: Make env docker file command: | cp .env.docker.example .env.docker - run: name: Docker compose up command: | set -xe docker network create foo-network docker-compose up --build -d dockerã‚¿ã‚¤ãƒ—ã§ä½¿ç”¨ã™ã‚‹å ´åˆï¼Œdockerã‚­ãƒ¼ã®ä¸‹ã§docker_layer_cachingã‚’ä½¿ã†ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š version: 2.1 jobs: build_and_push: executor: docker/docker steps: - setup_remote_docker # DLCã‚’æœ‰åŠ¹åŒ– docker_layer_caching: true - checkout - docker/check - docker/build: image: / - docker/push: image: / 02-09. CircleCIãƒ©ã‚¤ãƒ–ãƒ©ãƒª orbs ãƒ»orbsã¨ã¯ CircleCIã‹ã‚‰æä¾›ã•ã‚Œã‚‹æ±ç”¨çš„ãªãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®ä½¿ç”¨ã‚’èª­ã¿è¾¼ã‚€ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š version: 2.1 orbs: hello: circleci/hello-build@0.0.5 workflows: \"Hello Workflow\": jobs: - hello/hello-build ãƒ»jobsï¼Œcommandsï¼Œexecutors æ§‹é€  èª¬æ˜ jobs workflowsã«ã¦ï¼ŒOrbsã‹ã‚‰jobã¨ã—ã¦ä½¿ç”¨ã§ãã‚‹ï¼ commands jobã«ã¦ï¼Œstepã¨ã—ã¦ä½¿ç”¨ã§ãã‚‹ï¼ executors exexutorã«ã¦ï¼Œäº‹å‰å®šç¾©ã•ã‚ŒãŸexecutorsã¨ã—ã¦ä½¿ç”¨ã§ãã‚‹ï¼ ãƒ»ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã¸ã®å¼•æ•°ã®æ¸¡ã—æ–¹ã¨æ³¨æ„ç‚¹ AWSèªè¨¼æƒ…å ±ã¯ï¼ŒCircleCIã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆåã¨åŒã˜ç’°å¢ƒå¤‰æ•°åã§ç™»éŒ²ã—ã¦ãŠã‘ã°ï¼Œã‚ªãƒ—ã‚·ãƒ§ãƒ³ã§æ¸¡ã•ãªãã¨ã‚‚ï¼Œè‡ªå‹•ã§å…¥åŠ›ã—ã¦ãã‚Œã‚‹ï¼ã‚ªãƒ—ã‚·ãƒ§ãƒ³ãŒenv_var_nameå‹ã¯ï¼ŒåŸºæœ¬çš„ã«å…¨ã¦ã®ã‚¹ã‚³ãƒ¼ãƒ—ãƒ¬ãƒ™ãƒ«ã®ç’°å¢ƒå¤‰æ•°ã‚’å—ã‘ä»˜ã‘ã‚‹ï¼ãŸã ã—Alpineãƒ™ãƒ¼ã‚¹ã®ã‚¤ãƒ¡ãƒ¼ã‚¸ã§ã¯ï¼Œã€$BASH_ENVã€ã‚’ç”¨ã„ã¦ï¼Œè¤‡æ•°ã®runé–“ã§ç’°å¢ƒå¤‰æ•°ã‚’å…±æœ‰ã§ããšï¼Œorbsã®ã‚¹ãƒ†ãƒƒãƒ—ã«ç’°å¢ƒå¤‰æ•°ã‚’æ¸¡ã›ãªã„ãŸã‚æ³¨æ„ã™ã‚‹ï¼ å‚è€ƒï¼šhttps://github.com/circleci/circleci-docs/issues/1650 ï¼Šå®Ÿè£…ä¾‹ï¼Š version: 2.1 orbs: aws-foo: circleci/aws-foo@x.y.z jobs: foo_bar_baz: docker: - image: circleci/python:x.y.z steps: - attach_workspace: at: . - setup_remote_docker: - aws-cli/install - aws-cli/setup - aws-foo/foo-bar-baz: # ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆåã§ã‚ã‚Œã°ï¼Œè¨˜è¿°ã—ãªãã¦ã‚‚è‡ªå‹•çš„ã«å…¥åŠ›ã—ã¦ãã‚Œã‚‹ï¼ account-url: $AWS_ECR_ACCOUNT_URL_ENV_VAR_NAME aws-access-key-id: $ACCESS_KEY_ID_ENV_VAR_NAME aws-secret-access-key: $SECRET_ACCESS_KEY_ENV_VAR_NAME region: $AWS_REGION_ENV_VAR_NAME aws-cli ãƒ»commands: install aws-cliã‚³ãƒãƒ³ãƒ‰ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã‚’è¡Œã†ï¼ ãƒ»commands: setup aws-cliã‚³ãƒãƒ³ãƒ‰ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã¨ï¼ŒCredentialsæƒ…å ±ã®è¨­å®šã‚’è¡Œã†ï¼AWSãƒªã‚½ãƒ¼ã‚¹ã‚’æ“ä½œã™ã‚‹ãŸã‚ã«ä½¿ç”¨ã™ã‚‹ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š CloudFrontã«ä¿å­˜ã•ã‚Œã¦ã„ã‚‹Cacheã‚’å‰Šé™¤ã™ã‚‹ï¼ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã‚’ãƒ‡ãƒ—ãƒ­ã‚¤ã—ãŸã¨ã—ã¦ã‚‚ï¼ŒCloudFrontã«ä¿å­˜ã•ã‚Œã¦ã„ã‚‹Cacheã‚’å‰Šé™¤ã—ãªã„é™ã‚Šï¼ŒCacheãŒHitã—ãŸãƒ¦ãƒ¼ã‚¶ã«ã¯éå»ã®ãƒ•ã‚¡ã‚¤ãƒ«ãŒãƒ¬ã‚¹ãƒãƒ³ã‚¹ã•ã‚Œã¦ã—ã¾ã†ï¼ãã®ãŸã‚ï¼ŒS3ã¸ã®ãƒ‡ãƒ—ãƒ­ã‚¤å¾Œã«ï¼ŒCacheã‚’å‰Šé™¤ã™ã‚‹å¿…è¦ãŒã‚ã‚‹ï¼ version: 2.1 orbs: aws-cli: circleci/aws-cli@1.3.1 jobs: cloudfront_create_invalidation: docker: - image: cimg/python:3.9-node steps: - checkout - aws-cli/setup - run: name: Run create invalidation command: | echo $AWS_CLOUDFRONT_ID | base64 --decode | aws cloudfront create-invalidation --distribution-id $AWS_CLOUDFRONT_ID --paths \"/*\" workflows: # ã‚¹ãƒ†ãƒ¼ã‚¸ãƒ³ã‚°ç’°å¢ƒã«ãƒ‡ãƒ—ãƒ­ã‚¤ develop: jobs: # ç›´å‰ã«æ‰¿èªã‚¸ãƒ§ãƒ–ã‚’æŒ¿å…¥ã™ã‚‹ - hold: name: hold_create_invalidation_stg type: approval - cloudfront_create_invalidation: name: cloudfront_create_invalidation_stg filters: branches: only: - develop # æœ¬ç•ªç’°å¢ƒã«ãƒ‡ãƒ—ãƒ­ã‚¤ main: jobs: # ç›´å‰ã«æ‰¿èªã‚¸ãƒ§ãƒ–ã‚’æŒ¿å…¥ã™ã‚‹ - hold: name: hold_create_invalidation_prd type: approval - cloudfront_create_invalidation: name: cloudfront_create_invalidation_prd filters: branches: only: - main ãŸã ã—ï¼Œcredentialsãƒ•ã‚¡ã‚¤ãƒ«ã®ä½œæˆã§ã¯ï¼Œorbsã‚’ä½¿ç”¨ã—ãªã„æ–¹ãŒã‚ˆã‚Šç°¡æ½”ã«æ¡ä»¶åˆ†å²ã‚’å®Ÿè£…ã§ãã‚‹ã‹ã‚‚ã—ã‚Œãªã„ï¼ #!/bin/bash set -xeuo pipefail case \"$APP_ENV\" in \"stg\") AWS_ACCESS_KEY_ID=$STG_AWS_ACCESS_KEY_ID AWS_SECRET_ACCESS_KEY=$STG_AWS_SECRET_ACCESS_KEY ;; \"prd\") AWS_ACCESS_KEY_ID=\"$PRD_AWS_ACCESS_KEY_ID\" AWS_SECRET_ACCESS_KEY=\"$PRD_AWS_SECRET_ACCESS_KEY\" ;; *) echo \"The parameter ${APP_ENV} is invalid.\" exit 1 ;; esac # defaultãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ã«ã‚¯ãƒ¬ãƒ‡ãƒ³ã‚·ãƒ£ãƒ«æƒ…å ±ã‚’è¨­å®šã™ã‚‹ï¼ aws configure aws-ecr ãƒ»jobsï¼šbuild-and-push-image CircleCIã‚³ãƒ³ãƒ†ãƒŠã§Dockerã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’ãƒ“ãƒ«ãƒ‰ã—ï¼ŒECRã«ãƒ‡ãƒ—ãƒ­ã‚¤ã™ã‚‹ï¼remote-docker-layer-cachingã‚’ä½¿ç”¨ã—ã¦ï¼ŒDocker Layer Cacheã‚’æœ‰åŠ¹åŒ–ã§ãã‚‹ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š version: 2.1 orbs: aws-cli: circleci/aws-cli@1.3.1 aws-ecr: circleci/aws-ecr@6.15.2 jobs: aws-ecr/build-and-push-image: name: ecr_build_and_push_image # Docker Layer Cacheã‚’ä½¿ç”¨ã™ã‚‹ã‹ã©ã†ã‹ï¼ˆæœ‰æ–™ï¼‰ remote-docker-layer-caching: true # ãƒªãƒã‚¸ãƒˆãƒªãŒãªã„æ™‚ã«ä½œæˆã™ã‚‹ã‹ã©ã†ã‹ï¼ create-repo: true no-output-timeout: 20m # projectã‚’ä½œæ¥­ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã¨ã—ãŸæ™‚ã®ç›¸å¯¾ãƒ‘ã‚¹ dockerfile: ./infra/docker/Dockerfile path: \".\" profile-name: myProfileName repo: \"{$SERVICE}-repository\" # CircleCIã®ãƒãƒƒã‚·ãƒ¥å€¤ã«ã‚ˆã‚‹ãƒãƒ¼ã‚¸ãƒ§ãƒ‹ãƒ³ã‚° tag: $CIRCLE_SHA1 # jobå†…ã«ã¦ï¼Œattach_workspaceã‚¹ãƒ†ãƒƒãƒ—ã‚’å®Ÿè¡Œï¼ attach-workspace: true # attach_workspaceã‚¹ãƒ†ãƒƒãƒ—å®Ÿè¡Œæ™‚ã®rootãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª workspace-root: aws-ecs ãƒ»jobsï¼šdeploy-update-serviceï¼ˆãƒ­ãƒ¼ãƒªãƒ³ã‚°ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆä½¿ç”¨æ™‚ï¼‰ ECRã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’ä½¿ç”¨ã—ã¦ï¼Œæ–°ã—ã„ãƒªãƒ“ã‚¸ãƒ§ãƒ³ç•ªå·ã®ã‚¿ã‚¹ã‚¯å®šç¾©ã‚’ä½œæˆã—ï¼Œã¾ãŸã“ã‚Œã‚’ä½¿ç”¨ã—ã¦ã‚³ãƒ³ãƒ†ãƒŠã‚’ãƒ‡ãƒ—ãƒ­ã‚¤ã™ã‚‹ï¼verify-revision-is-deployedã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’ä½¿ç”¨ã—ã¦ï¼ŒECSã‚µãƒ¼ãƒ“ã‚¹ãŒæ›´æ–°ã•ã‚ŒãŸå¾Œï¼Œå®Ÿè¡Œã•ã‚Œã¦ã„ã‚‹ã‚¿ã‚¹ã‚¯ãŒã‚¿ã‚¹ã‚¯å®šç¾©ã«åˆè‡´ã—ã¦ã„ã‚‹ã‹ã‚’ç›£è¦–ã™ã‚‹ï¼ä¾‹ãˆã°ï¼Œã‚¿ã‚¹ã‚¯ãŒã€ŒRunnningã€ã«ãªã‚‰ãšã«ã€ŒStoppedã€ã«ãªã£ã¦ã—ã¾ã†å ´åˆã‚„ï¼Œæ—¢å­˜ã®ã‚¿ã‚¹ã‚¯ãŒã€ŒStoppedã€ã«ãªã‚‰ãšã«ã€ŒRunningã€ã®ã¾ã¾ã«ãªã£ã¦ã—ã¾ã†å ´åˆï¼Œã“ã®çŠ¶æ…‹ã¯ã‚¿ã‚¹ã‚¯å®šç¾©ã«åˆè‡´ã—ãªã„ã®ã§ï¼Œæ¤œçŸ¥ã§ãã‚‹ï¼ å‚è€ƒï¼šhttps://circleci.com/docs/ja/2.0/ecs-ecr/#deploy-the-new-docker-image-to-an-existing-aws-ecs-service ï¼Šå®Ÿè£…ä¾‹ï¼Š version: 2.1 orbs: aws-cli: circleci/aws-cli@1.3.1 aws-ecs: circleci/aws-ecs@2.2.1 jobs: aws-ecs/deploy-update-service: name: ecs_update_service_by_rolling_update # ã‚¿ã‚¹ã‚¯å®šç¾©åã‚’æŒ‡å®š family: \"${SERVICE}-ecs-task-definition\" # ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼åã‚’æŒ‡å®š cluster-name: \"${SERVICE}-cluster\" # ã‚µãƒ¼ãƒ“ã‚¹åã‚’æŒ‡å®š service-name: \"${SERVICE}-service\" # ã‚³ãƒ³ãƒ†ãƒŠå®šç¾©ã®ã‚³ãƒ³ãƒ†ãƒŠåã¨ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚¿ã‚°ã‚’ä¸Šæ›¸ãï¼ã‚¤ãƒ¡ãƒ¼ã‚¸ã¯CircleCIã®ãƒãƒƒã‚·ãƒ¥å€¤ã§ã‚¿ã‚°ä»˜ã‘ã—ã¦ã„ã‚‹ã®ã§å¿…é ˆï¼ container-image-name-updates: \"container=laravel,tag=${CIRCLE_SHA1},container=nginx,tag=${CIRCLE_SHA1}\" # ã‚µãƒ¼ãƒ“ã‚¹æ›´æ–°å¾Œã®ã‚¿ã‚¹ã‚¯ç›£è¦– verify-revision-is-deployed: true workflows: # ã‚¹ãƒ†ãƒ¼ã‚¸ãƒ³ã‚°ç’°å¢ƒã«ãƒ‡ãƒ—ãƒ­ã‚¤ develop: jobs: - ecs_update_service_by_rolling_update: name: ecs_update_service_by_rolling_update_stg filters: branches: only: - develop # æœ¬ç•ªç’°å¢ƒã«ãƒ‡ãƒ—ãƒ­ã‚¤ main: jobs: - ecs_update_service_by_rolling_update: name: ecs_update_service_by_rolling_update_production filters: branches: only: - main ãƒ»jobsï¼šdeploy-update-serviceï¼ˆB/Gãƒ‡ãƒ—ãƒ­ã‚¤ãƒ¡ãƒ³ãƒˆä½¿ç”¨æ™‚ï¼‰ ECSã‚¿ã‚¹ã‚¯å®šç¾©ã‚’æ›´æ–°ã™ã‚‹ï¼ã•ã‚‰ã«ï¼ŒBlue/Greenãƒ‡ãƒ—ãƒ­ã‚¤ãƒ¡ãƒ³ãƒˆãŒãã®ã‚¿ã‚¹ã‚¯å®šç¾©ã‚’æŒ‡å®šã—ï¼ŒECSã‚µãƒ¼ãƒ“ã‚¹ã‚’æ›´æ–°ã™ã‚‹ï¼ãƒ­ãƒ¼ãƒªãƒ³ã‚°ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆã¨åŒæ§˜ã«ã—ã¦ï¼Œverify-revision-is-deployedã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’ä½¿ç”¨ã§ãã‚‹ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š version: 2.1 orbs: aws-cli: circleci/aws-cli@1.3.1 aws-ecs: circleci/aws-ecs@2.2.1 jobs: aws-ecs/deploy-update-service: name: ecs_update_service_by_code_deploy # ã‚¿ã‚¹ã‚¯å®šç¾©åã‚’æŒ‡å®š family: \"${SERVICE}-ecs-task-definition\" # ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼åã‚’æŒ‡å®š cluster-name: \"${SERVICE}-cluster\" # ã‚µãƒ¼ãƒ“ã‚¹åã‚’æŒ‡å®š service-name: \"${SERVICE}-service\" # CodeDeployã«ãŠã‘ã‚‹ãƒ‡ãƒ—ãƒ­ã‚¤ã®ä½œæˆã‚’è¨­å®š deployment-controller: CODE_DEPLOY codedeploy-application-name: $SERVICE codedeploy-deployment-group-name: \"${SERVICE}-deployment-group\" codedeploy-load-balanced-container-name: www-container codedeploy-load-balanced-container-port: 80 # ã‚³ãƒ³ãƒ†ãƒŠåã¨ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚¿ã‚°ã‚’æŒ‡å®šï¼ã‚¤ãƒ¡ãƒ¼ã‚¸ã¯CircleCIã®ãƒãƒƒã‚·ãƒ¥å€¤ã§ã‚¿ã‚°ä»˜ã‘ã—ã¦ã„ã‚‹ã®ã§å¿…é ˆï¼ container-image-name-updates: \"container=laravel,tag=${CIRCLE_SHA1},container=nginx,tag=${CIRCLE_SHA1}\" # ã‚µãƒ¼ãƒ“ã‚¹æ›´æ–°å¾Œã®ã‚¿ã‚¹ã‚¯ç›£è¦– verify-revision-is-deployed: true workflows: # ã‚¹ãƒ†ãƒ¼ã‚¸ãƒ³ã‚°ç’°å¢ƒã«ãƒ‡ãƒ—ãƒ­ã‚¤ develop: jobs: - ecs_update_service_by_code_deploy: name: ecs_update_service_by_code_deploy_stg filters: branches: only: - develop # æœ¬ç•ªç’°å¢ƒã«ãƒ‡ãƒ—ãƒ­ã‚¤ main: jobs: - ecs_update_service_by_code_deploy: name: ecs_update_service_by_code_deploy_production filters: branches: only: - main ãƒ»jobsï¼šrun-task ç¾åœ¨èµ·å‹•ä¸­ã®ECSã‚¿ã‚¹ã‚¯ã¨ã¯åˆ¥ã«ï¼Œæ–°ã—ã„ã‚¿ã‚¹ã‚¯ã‚’ä¸€æ™‚çš„ã«èµ·å‹•ã™ã‚‹ï¼èµ·å‹•æ™‚ã«ï¼Œoverridesã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’ä½¿ç”¨ã—ã¦ï¼ŒæŒ‡å®šã—ãŸã‚¿ã‚¹ã‚¯å®šç¾©ã®ã‚³ãƒ³ãƒ†ãƒŠè¨­å®šã‚’ä¸Šæ›¸ãã§ãã‚‹ï¼æ­£è¦è¡¨ç¾ã§è¨­å®šã™ã‚‹å¿…è¦ãŒã‚ã‚Šï¼Œã•ã‚‰ã«JSONã§ã¯ã€Œ\\ã€ã‚’ã€Œ\\\\ã€ã«ã‚¨ã‚¹ã‚±ãƒ¼ãƒ—ã—ãªã‘ã‚Œã°ãªã‚‰ãªã„ï¼ã‚³ãƒãƒ³ãƒ‰ãŒå®Ÿè¡Œã•ã‚ŒãŸå¾Œã«ï¼Œã‚¿ã‚¹ã‚¯ã¯è‡ªå‹•çš„ã«StoppedçŠ¶æ…‹ã«ãªã‚‹ï¼ ä¸Šæ›¸ãã§ãã‚‹ã‚­ãƒ¼ã®å‚ç…§ãƒªãƒ³ã‚¯ï¼šhttps://docs.aws.amazon.com/cli/latest/reference/ecs/run-task.html ï¼Šå®Ÿè£…ä¾‹ï¼Š ä¾‹ãˆã°ï¼Œãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã«å¯¾ã—ã¦ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚’å®Ÿè¡Œã™ã‚‹ãŸã‚ã®ECSã‚¿ã‚¹ã‚¯ã‚’èµ·å‹•ã™ã‚‹ï¼overridesã‚ªãƒ—ã‚·ãƒ§ãƒ³ã§ã‚³ãƒ³ãƒ†ãƒŠå®šç¾©ã®ã‚³ãƒãƒ³ãƒ‰ã‚’ä¸Šæ›¸ãã™ã‚‹ï¼ version: 2.1 orbs: aws-cli: circleci/aws-cli@1.3.1 aws-ecs: circleci/aws-ecs@2.2.1 jobs: aws-ecs/run-task: name: ecs_run_task_for_migration cluster: \"${SERVICE}-ecs-cluster\" # LATESTã¨ã™ã‚‹ã¨ãã®æ™‚ç‚¹ã®æœ€æ–°ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’è‡ªå‹•ã§å‰²ã‚ŠæŒ¯ã‚‰ã‚Œã¦ã—ã¾ã†ï¼ platform-version: 1.4.0 awsvpc: true launch-type: FARGATE subnet-ids: $AWS_SUBNET_IDS security-group-ids: $AWS_SECURITY_GROUPS # ã‚¿ã‚¹ã‚¯å®šç¾©åï¼æœ€æ–°ãƒªãƒ“ã‚¸ãƒ§ãƒ³ç•ªå·ãŒè‡ªå‹•è£œå®Œã•ã‚Œã‚‹ï¼ task-definition: \"${SERVICE}-ecs-task-definition\" # ã‚¿ã‚¹ã‚¯èµ·å‹•æ™‚ã«ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã™ã‚‹ã‚ˆã†ã«ï¼ŒLaravelã‚³ãƒ³ãƒ†ãƒŠã®ã€€commandã‚­ãƒ¼ã‚’ä¸Šæ›¸ã overrides: \"{\\\\\\\"containerOverrides\\\\\\\":[{\\\\\\\"name\\\\\\\": \\\\\\\"laravel-container\\\\\\\",\\\\\\\"command\\\\\\\": [\\\\\\\"php\\\\\\\", \\\\\\\"artisan\\\\\\\", \\\\\\\"migrate\\\\\\\", \\\\\\\"--force\\\\\\\"]}]}\" workflows: # ã‚¹ãƒ†ãƒ¼ã‚¸ãƒ³ã‚°ç’°å¢ƒã«ãƒ‡ãƒ—ãƒ­ã‚¤ develop: jobs: - ecs_run_task_for_migration: name: ecs_run_task_for_migration_stg filters: branches: only: - develop # æœ¬ç•ªç’°å¢ƒã«ãƒ‡ãƒ—ãƒ­ã‚¤ main: jobs: - ecs_run_task_for_migration: name: ecs_run_task_for_migration_production filters: branches: only: - main aws-code-deploy ãƒ»jobsï¼šdeploy S3ã«ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã¨appspecãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ‡ãƒ—ãƒ­ã‚¤ã§ãã‚‹ï¼ã¾ãŸï¼ŒCodeDeployã‚’ç”¨ã„ã¦ï¼Œã“ã‚Œã‚’EC2ã«ãƒ‡ãƒ—ãƒ­ã‚¤ã§ãã‚‹ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š version: 2.1 orbs: aws-code-deploy: circleci/aws-code-deploy@1.0.1 jobs: aws-code-deploy/deploy: name: code_deploy application-name: $SERVICE} # appspecãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä¿å­˜ã™ã‚‹ãƒã‚±ãƒƒãƒˆå bundle-bucket: \"${SERVICE}-bucket\" # appspecãƒ•ã‚¡ã‚¤ãƒ«ã®ã‚ã‚‹ãƒ•ã‚©ãƒ«ãƒ€ bundle-source: ./infra/aws_codedeploy # appspecãƒ•ã‚¡ã‚¤ãƒ«ã‚’zipãƒ•ã‚©ãƒ«ãƒ€ã§ä¿å­˜ bundle-type: zip # zipãƒ•ã‚©ãƒ«ãƒ€å bundle-key: foo-bundle deployment-config: CodeDeployDefault.ECSAllAtOnce deployment-group: \"${SERVICE}-deployment-group\" # ECSã«ã‚¢ã‚¯ã‚»ã‚¹ã§ãã‚‹CodeDeployã‚µãƒ¼ãƒ“ã‚¹ãƒ­ãƒ¼ãƒ« service-role-arn: $CODE_DEPLOY_ROLE_FOR_ECS workflows: # ã‚¹ãƒ†ãƒ¼ã‚¸ãƒ³ã‚°ç’°å¢ƒã«ãƒ‡ãƒ—ãƒ­ã‚¤ develop: jobs: - code_deploy: name: code_deploy_stg filters: branches: only: - develop # æœ¬ç•ªç’°å¢ƒã«ãƒ‡ãƒ—ãƒ­ã‚¤ main: jobs: - code_deploy: name: code_deploy_production filters: branches: only: - main slack ãƒ»commandsï¼šnotify ã‚¸ãƒ§ãƒ–ã®çµ‚äº†æ™‚ã«ï¼ŒæˆåŠŸã¾ãŸã¯å¤±æ•—ã«åŸºã¥ã„ã¦ï¼Œã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚’é€šçŸ¥ã™ã‚‹ï¼ã‚¸ãƒ§ãƒ–ã®æœ€å¾Œã®ã‚¹ãƒ†ãƒƒãƒ—ã¨ã—ã¦è¨­å®šã—ãªã‘ã‚Œã°ãªã‚‰ãªã„ï¼ version: 2.1 orbs: slack: circleci/slack@4.1 commands: # ä»–ã®ã‚¸ãƒ§ãƒ–å†…ã§ä½¿ç”¨ã§ãã‚‹ã‚ˆã†ã«commandã¨ã—ã¦å®šç¾© notify_of_failure: steps: - slack/notify: event: fail template: basic_fail_1 jobs: deploy: steps: # ï½ ä¸­ç•¥ ï½ workflows: # ã‚¹ãƒ†ãƒ¼ã‚¸ãƒ³ã‚°ç’°å¢ƒã«ãƒ‡ãƒ—ãƒ­ã‚¤ develop: jobs: - deploy: name: deploy_stg filters: branches: only: - develop # å¤±æ•—æ™‚ã«é€šçŸ¥ post-steps: - notify_of_failure: # æœ¬ç•ªç’°å¢ƒã«ãƒ‡ãƒ—ãƒ­ã‚¤ main: jobs: - deploy: name: deploy_production filters: branches: only: - main # å¤±æ•—æ™‚ã«é€šçŸ¥ post-steps: - notify_of_failure: "},"public/ci_cd/ci_cd_capistrano.html":{"url":"public/ci_cd/ci_cd_capistrano.html","title":"ğŸ“– ï¸Capistrano","keywords":"","body":"Capistrano ã¯ã˜ã‚ã« æœ¬ã‚µã‚¤ãƒˆã«ã¤ãã¾ã—ã¦ï¼Œä»¥ä¸‹ã‚’ã”èªè­˜ã®ã»ã©å®œã—ããŠé¡˜ã„ã„ãŸã—ã¾ã™ï¼ å‚è€ƒï¼šhttps://hiroki-it.github.io/tech-notebook-gitbook/ Capistranoã¨ã¯ ãƒ»ä»•çµ„ã¿ è‡ªèº«ã®ãƒ‘ã‚½ã‚³ãƒ³ã‹ã‚‰ã‚¯ãƒ©ã‚¦ãƒ‰ãƒ‡ãƒ—ãƒ­ã‚¤ã‚µãƒ¼ãƒã«ãƒªãƒ¢ãƒ¼ãƒˆæ¥ç¶šã™ã‚‹ï¼ ã‚¯ãƒ©ã‚¦ãƒ‰ãƒ‡ãƒ—ãƒ­ã‚¤ã‚µãƒ¼ãƒã®è‡ªå‹•ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ„ãƒ¼ãƒ«ï¼ˆä¾‹ï¼šCapistranoï¼‰ãŒï¼Œã‚¯ãƒ©ã‚¦ãƒ‰ãƒ‡ãƒ—ãƒ­ã‚¤ã‚µãƒ¼ãƒã‹ã‚‰ã‚¯ãƒ©ã‚¦ãƒ‰Webã‚µãƒ¼ãƒã«ãƒªãƒ¢ãƒ¼ãƒˆæ¥ç¶šã™ã‚‹ï¼ è‡ªå‹•ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ„ãƒ¼ãƒ«ãŒï¼Œã‚¯ãƒ©ã‚¦ãƒ‰Webã‚µãƒ¼ãƒã®Gitã‚’æ“ä½œã—ï¼Œpullã‚ã‚‹ã„ã¯cloneã‚’å®Ÿè¡Œã™ã‚‹ï¼ãã®çµæœï¼ŒGitHubã‹ã‚‰ã‚¯ãƒ©ã‚¦ãƒ‰ãƒ‡ãƒ—ãƒ­ã‚¤ã‚µãƒ¼ãƒã«æŒ‡å®šã®ãƒ–ãƒ©ãƒ³ãƒã®çŠ¶æ…‹ãŒå–ã‚Šè¾¼ã¾ã‚Œã‚‹ï¼ "},"public/observability_monitering/observability.html":{"url":"public/observability_monitering/observability.html","title":"ğŸ“– ï¸å¯è¦³æ¸¬æ€§","keywords":"","body":"å¯è¦³æ¸¬æ€§ ã¯ã˜ã‚ã« æœ¬ã‚µã‚¤ãƒˆã«ã¤ãã¾ã—ã¦ï¼Œä»¥ä¸‹ã‚’ã”èªè­˜ã®ã»ã©å®œã—ããŠé¡˜ã„ã„ãŸã—ã¾ã™ï¼ å‚è€ƒï¼šhttps://hiroki-it.github.io/tech-notebook-gitbook/ 01. å¯è¦³æ¸¬æ€§ å¯è¦³æ¸¬æ€§ã¨ã¯ ã€åé›†ã•ã‚ŒãŸãƒ‡ãƒ¼ã‚¿ã‹ã‚‰ï¼Œã‚·ã‚¹ãƒ†ãƒ ã«ãŠã‘ã‚‹æƒ³å®šå¤–ã®ä¸å…·åˆã‚’ã©ã‚Œã ã‘æ­£ç¢ºã«æ¨æ¸¬ã§ãã‚‹ã‹ã€ã‚’è¡¨ã™ç¨‹åº¦ã®ã“ã¨ï¼ã‚·ã‚¹ãƒ†ãƒ ã®æƒ³å®šå†…ã®ä¸å…·åˆã¯ã€ç›£è¦–ã€ã‚„ã€ãƒ†ã‚¹ãƒˆã€ã«ã‚ˆã£ã¦æ¤œçŸ¥ã§ãã‚‹ãŒï¼Œæƒ³å®šå¤–ã®ã‚‚ã®ã‚’æ¤œçŸ¥ã§ããªã„ï¼ã—ã‹ã—ï¼Œå¯è¦³æ¸¬æ€§ã‚’é«˜ã‚ã‚‹ã“ã¨ã«ã‚ˆã‚Šï¼Œæƒ³å®šå¤–ã®ä¸å…·åˆã‚’è¡¨é¢åŒ–ã§ãã‚‹ï¼ å‚è€ƒï¼š https://blog.thundra.io/observability-driven-development-for-serverless https://sookocheff.com/post/architecture/testing-in-production/ https://www.sentinelone.com/blog/observability-production-systems-why-how/ å¯è¦³æ¸¬æ€§ã‚’é«˜ã‚ã‚‹æ–¹æ³• ãƒ»ãƒã‚¤ã‚¯ãƒ­ã‚µãƒ¼ãƒ“ã‚¹ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã®å ´åˆ ãƒ†ãƒ¬ãƒ¡ãƒˆãƒªãƒ¼ã‚’ååˆ†ã«åé›†ã—ï¼Œã“ã‚Œã‚‰ã‚’ç´ä»˜ã‘ã¦å¯è¦–åŒ–ã™ã‚‹å¿…è¦ãŒã‚ã‚‹ï¼ ãƒ»ãƒ¢ãƒãƒªã‚¹ã«ãŠã‘ã‚‹å¯è¦³æ¸¬æ€§ å¯è¦³æ¸¬æ€§ã¯ï¼ŒåŸºæœ¬çš„ã«ãƒã‚¤ã‚¯ãƒ­ã‚µãƒ¼ãƒ“ã‚¹ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã®æ–‡è„ˆã§èªã‚‰ã‚Œã‚‹ï¼ãƒ¢ãƒãƒªã‚·ãƒƒã‚¯ã«ãŠã„ã¦ï¼Œã©ã®ã‚ˆã†ã«ã—ã¦å¯è¦³æ¸¬æ€§ã‚’é«˜ã‚ã‚‹ã®ã‹ã‚’èª¿æŸ»ä¸­...ï¼ˆæƒ…å ±ãŒå…¨ç„¶è¦‹ã¤ã‹ã‚‰ãªã„ï¼‰ ç™ºè¡¨ã‚¹ãƒ©ã‚¤ãƒ‰ 01-02. ãƒ†ãƒ¬ãƒ¡ãƒˆãƒªãƒ¼ ãƒ†ãƒ¬ãƒ¡ãƒˆãƒªãƒ¼ã¨ã¯ å¯è¦³æ¸¬æ€§ã‚’å®Ÿç¾ã™ã‚‹ãŸã‚ã«åé›†ã™ã‚‹å¿…è¦ã®ã‚ã‚‹ï¼“ã¤ã®ãƒ‡ãƒ¼ã‚¿è¦ç´ ï¼ˆã€ãƒ¡ãƒˆãƒªã‚¯ã‚¹ã€ã€ãƒ­ã‚°ã€ã€åˆ†æ•£ãƒˆãƒ¬ãƒ¼ã‚¹ã€ï¼‰ã®ã“ã¨ï¼NewRelicã‚„Datadogã¯ãƒ†ãƒ¬ãƒ¡ãƒˆãƒªãƒ¼ã®è¦ç´ ã‚’å…¨ã¦æŒã¤ï¼ã¾ãŸï¼ŒAWSã§ã¯CloudWatchï¼ˆãƒ¡ãƒˆãƒªã‚¯ã‚¹ï¼‹ãƒ­ã‚°ï¼‰ã¨X-Rayï¼ˆåˆ†æ•£ãƒˆãƒ¬ãƒ¼ã‚¹ï¼‰ã‚’ä¸¡æ–¹åˆ©ç”¨ã™ã‚‹ã¨ï¼Œã“ã‚Œã‚‰ã®è¦ç´ ã‚’æº€ãŸã›ãŸã“ã¨ã«ãªã‚Šï¼Œå¯è¦³æ¸¬æ€§ã‚’å®Ÿç¾ã§ãã‚‹ï¼ å‚è€ƒï¼š https://www.forbes.com/sites/andythurai/2021/02/02/aiops-vs-observability-vs-monitoringwhat-is-the-difference-are-you-using-the-right-one-for-your-enterprise/ https://knowledge.sakura.ad.jp/26395/ 02. ãƒ¡ãƒˆãƒªã‚¯ã‚¹ ãƒ¡ãƒˆãƒªã‚¯ã‚¹ã¨ã¯ ã¨ã‚ã‚‹åˆ†æã«ã¦ï¼Œä¸€å®šæœŸé–“ã«ç™ºç”Ÿã—ãŸè¤‡æ•°ã®ãƒ‡ãƒ¼ã‚¿ãƒã‚¤ãƒ³ãƒˆã®é›†è¨ˆå€¤ã®ã“ã¨ï¼ã€å¹³å‡ã€ã€åˆè¨ˆã€ã€æœ€å°ï¼æœ€å¤§ã€ã€å¹³æ–¹æ ¹ã€ãªã©ã‚’ç”¨ã„ã¦ï¼Œãƒ‡ãƒ¼ã‚¿ãƒã‚¤ãƒ³ãƒˆã‚’é›†è¨ˆã™ã‚‹ï¼ å‚è€ƒï¼šhttps://docs.aws.amazon.com/ja_jp/AmazonCloudWatch/latest/monitoring/cloudwatch_concepts.html#Metric ãƒ‡ãƒ¼ã‚¿ãƒã‚¤ãƒ³ãƒˆ ãƒ»ãƒ‡ãƒ¼ã‚¿ãƒã‚¤ãƒ³ãƒˆã¨ã¯ åˆ†æå¯¾è±¡ã‹ã‚‰å¾—ã‚‰ã‚Œã‚‹æœ€å°å˜ä½ã®æ•°å€¤ãƒ‡ãƒ¼ã‚¿ã®ã“ã¨ï¼ãƒ‡ãƒ¼ã‚¿ãƒã‚¤ãƒ³ãƒˆã¯ï¼Œåˆ†æã”ã¨ã«å­˜åœ¨ã—ã¦ã„ã‚‹ï¼ä¾‹ãˆã°ï¼Œã¨ã‚ã‚‹åˆ†æã§ä¸€åˆ†ã”ã¨ã«å¯¾è±¡ãŒæ¸¬å®šã•ã‚Œã‚‹å ´åˆï¼Œä¸€åˆ†ã”ã¨ã«å¾—ã‚‰ã‚Œã‚‹æ•°å€¤ãƒ‡ãƒ¼ã‚¿ãŒãƒ‡ãƒ¼ã‚¿ãƒã‚¤ãƒ³ãƒˆã¨ãªã‚‹ï¼ä¸€æ–¹ã§ï¼Œä¸€æ™‚é–“ã”ã¨ã®æ¸¬å®šã®å ´åˆï¼Œä¸€æ™‚é–“ã”ã¨ã«å¾—ã‚‰ã‚Œã‚‹æ•°å€¤ãƒ‡ãƒ¼ã‚¿ãŒãƒ‡ãƒ¼ã‚¿ãƒã‚¤ãƒ³ãƒˆã§ã‚ã‚‹ï¼ å‚è€ƒï¼š https://whatis.techtarget.com/definition/data-point https://aws.amazon.com/jp/about-aws/whats-new/2017/12/amazon-cloudwatch-alarms-now-alerts-you-when-any-m-out-of-n-metric-datapoints-in-an-interval-are-above-your-threshold/ ï¼”å¤§ã‚·ã‚°ãƒŠãƒ« ãƒ»ï¼”å¤§ã‚·ã‚°ãƒŠãƒ«ã¨ã¯ ç‰¹ã«é‡è¦ãªãƒ¡ãƒˆãƒªã‚¯ã‚¹ï¼ˆãƒˆãƒ©ãƒ•ã‚£ãƒƒã‚¯ï¼Œãƒ¬ã‚¤ãƒ†ãƒ³ã‚·ãƒ¼ï¼Œã‚¨ãƒ©ãƒ¼ï¼Œã‚µãƒãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ï¼‰ã®ã“ã¨ï¼ ãƒ»ãƒˆãƒ©ãƒ•ã‚£ãƒƒã‚¯ ã‚µãƒ¼ãƒç›£è¦–å¯¾è±¡ã®ãƒ¡ãƒˆãƒªã‚¯ã‚¹ã«å±ã™ã‚‹ï¼ ãƒ»ãƒ¬ã‚¤ãƒ†ãƒ³ã‚·ãƒ¼ ã‚µãƒ¼ãƒç›£è¦–å¯¾è±¡ã®ãƒ¡ãƒˆãƒªã‚¯ã‚¹ã«å±ã™ã‚‹ï¼ ãƒ»ã‚¨ãƒ©ãƒ¼ ã‚µãƒ¼ãƒç›£è¦–å¯¾è±¡ã®ãƒ¡ãƒˆãƒªã‚¯ã‚¹ã«å±ã™ã‚‹ï¼ ç¨®é¡ èª¬æ˜ æ˜ç¤ºçš„ã‚¨ãƒ©ãƒ¼ 400/500ç³»ã®ãƒ¬ã‚¹ãƒãƒ³ã‚¹ æš—é»™çš„ã‚¨ãƒ©ãƒ¼ SLOã«æº€ãŸãªã„200/300ç³»ã®ãƒ¬ã‚¹ãƒãƒ³ã‚¹ï¼ŒAPIä»•æ§˜ã«åˆã£ã¦ã„ãªã„ãƒ¬ã‚¹ãƒãƒ³ã‚¹ ãƒ»ã‚µãƒãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ ã‚·ã‚¹ãƒ†ãƒ åˆ©ç”¨ç‡ï¼ˆCPUåˆ©ç”¨ç‡ï¼Œãƒ¡ãƒ¢ãƒªç†å®¹å®¤ï¼Œã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸åˆ©ç”¨ç‡ï¼Œãªã©ï¼‰ã®é£½å’Œåº¦ã®ã“ã¨ï¼ä¾‹ãˆã°ï¼Œä»¥ä¸‹ã®é£½å’Œåº¦ãŒã‚ã‚‹ï¼60ï½70%ã§ï¼Œè­¦å‘Šãƒ©ã‚¤ãƒ³ã‚’è¨­ã‘ã¦ãŠãå¿…è¦ãŒã‚ã‚‹ï¼ã‚µãƒ¼ãƒç›£è¦–å¯¾è±¡ã®ãƒ¡ãƒˆãƒªã‚¯ã‚¹ã«å±ã™ã‚‹ï¼ 03. ãƒ­ã‚° ãƒ­ã‚°ã¨ã¯ ç‰¹å®šã®ç¬é–“ã«ç™ºç”Ÿã—ãŸã‚¤ãƒ™ãƒ³ãƒˆãŒè¨˜è¼‰ã•ã‚ŒãŸãƒ‡ãƒ¼ã‚¿ã®ã“ã¨ï¼ å‚è€ƒï¼šhttps://newrelic.com/jp/blog/how-to-relic/metrics-events-logs-and-traces æ§‹é€ ã‹ã‚‰ã¿ãŸç¨®é¡ ãƒ»éæ§‹é€ åŒ–ãƒ­ã‚° ã‚¤ãƒ™ãƒ³ãƒˆã®å€¤ã ã‘ãŒè¡¨ç¤ºã•ã‚ŒãŸãƒ­ã‚°ã®ã“ã¨ï¼æ–‡å­—åˆ—ãƒ‡ãƒ¼ã‚¿ã§å®šç¾©ã•ã‚Œã‚‹ï¼ 192.168.0.1 [2021-01-01 12:00:00] GET /foos/1 200 ãƒ»æ§‹é€ åŒ–ãƒ­ã‚° ã‚¤ãƒ™ãƒ³ãƒˆã®é …ç›®åã¨å€¤ãŒè¡¨ç¤ºã•ã‚ŒãŸãƒ­ã‚°ã®ã“ã¨ï¼JSONå‹ã§å®šç¾©ã•ã‚Œã‚‹ã“ã¨ãŒå¤šã„ï¼ { \"client_ip\": \"192.168.0.1\", \"timestamp\": \"2021-01-01 12:00:00\", \"method\": \"GET\", \"url\": \"/foos/1\", \"status_code\": 200 } ãƒ­ã‚®ãƒ³ã‚° ãƒ»Distributed loggingï¼ˆåˆ†æ•£ãƒ­ã‚®ãƒ³ã‚°ï¼‰ ãƒã‚¤ã‚¯ãƒ­ã‚µãƒ¼ãƒ“ã‚¹ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã«ãŠã„ã¦ï¼Œå„ã‚µãƒ¼ãƒ“ã‚¹ã‹ã‚‰åé›†ã•ã‚ŒãŸãƒ­ã‚°ã‚’ï¼Œãƒãƒ©ãƒãƒ©ã«åˆ†æï¼ç®¡ç†ã™ã‚‹æ–¹æ³•ã®ã“ã¨ï¼ å‚è€ƒï¼šhttps://www.splunk.com/ja_jp/data-insider/what-is-distributed-tracing.html#centralized-logging ãƒ»Centralized loggingï¼ˆé›†ä¸­ãƒ­ã‚®ãƒ³ã‚°ï¼‰ ãƒã‚¤ã‚¯ãƒ­ã‚µãƒ¼ãƒ“ã‚¹ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã«ãŠã„ã¦ï¼Œå„ã‚µãƒ¼ãƒ“ã‚¹ã‹ã‚‰åé›†ã•ã‚ŒãŸãƒ­ã‚°ã‚’ï¼Œä¸€å…ƒçš„ã«åˆ†æï¼ç®¡ç†ã™ã‚‹æ–¹æ³•ã®ã“ã¨ï¼ å‚è€ƒï¼šhttps://www.splunk.com/ja_jp/data-insider/what-is-distributed-tracing.html#centralized-logging 04. åˆ†æ•£ãƒˆãƒ¬ãƒ¼ã‚¹ åˆ†æ•£ãƒˆãƒ¬ãƒ¼ã‚¹ã¨ã¯ ãƒã‚¤ã‚¯ãƒ­ã‚µãƒ¼ãƒ“ã‚¹ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã«ãŠã„ã¦ï¼Œè¤‡æ•°ã®ã‚µãƒ¼ãƒ“ã‚¹ã‹ã‚‰åé›†ã•ã‚ŒãŸã‚¹ãƒ‘ãƒ³ã®ã‚»ãƒƒãƒˆã®ã“ã¨ï¼ã‚¹ãƒ‘ãƒ³ã‚’ç´ä»˜ã‘ã‚‹ã“ã¨ã«ã‚ˆã£ã¦ï¼Œç•°ãªã‚‹ã‚µãƒ¼ãƒ“ã‚¹ã‚’æ¨ªæ–­ã™ã‚‹å‡¦ç†ã‚’ï¼Œä¸€ç¹‹ããªã‚‚ã®ã¨ã—ã¦èªè­˜ã§ãã‚‹ã‚ˆã†ã«ãªã‚‹ï¼ å‚è€ƒï¼š https://www.dynatrace.com/news/blog/open-observability-part-1-distributed-tracing-and-observability/ https://docs.newrelic.com/jp/docs/distributed-tracing/concepts/introduction-distributed-tracing/ https://medium.com/nikeengineering/hit-the-ground-running-with-distributed-tracing-core-concepts-ff5ad47c7058 åˆ†æ•£ãƒˆãƒ¬ãƒ¼ã‚¹ã®èª­ã¿æ–¹ ä¸Šã‹ã‚‰ä¸‹ã«èª­ã‚€ã¨ï¼Œä¸Šæµã‚µãƒ¼ãƒ“ã‚¹ï¼ˆä¸Šä½ã‚¹ãƒ‘ãƒ³ï¼‰ãŒä¸‹æµã‚µãƒ¼ãƒ“ã‚¹ï¼ˆä¸‹ä½ã‚¹ãƒ‘ãƒ³ï¼‰ã‚’å‡¦ç†ã‚’ã‚³ãƒ¼ãƒ«ã—ã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèªã§ãã‚‹ï¼ä¸‹ã‹ã‚‰ä¸Šã«èª­ã‚€ã¨ï¼Œä¸‹æµã‚µãƒ¼ãƒ“ã‚¹ï¼ˆä¸‹ä½ã‚¹ãƒ‘ãƒ³ï¼‰ã‹ã‚‰ä¸Šæµã‚µãƒ¼ãƒ“ã‚¹ï¼ˆä¸Šä½ã‚¹ãƒ‘ãƒ³ï¼‰ã«çµæœã‚’è¿”å´ã—ã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèªã§ãã‚‹ï¼ å‚è€ƒï¼šhttps://cloud.google.com/architecture/using-distributed-tracing-to-observe-microservice-latency-with-opencensus-and-stackdriver-trace ãƒ¢ãƒãƒªã‚¹ã«ãŠã‘ã‚‹åˆ†æ•£ãƒˆãƒ¬ãƒ¼ã‚¹ ãƒ¢ãƒãƒªã‚¹ãªã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã§ã¯ï¼Œã‚·ã‚¹ãƒ†ãƒ ãŒåˆ†æ•£ã—ã¦ã„ãªã„ãŸã‚ï¼Œå˜ãªã‚‹ãƒˆãƒ¬ãƒ¼ã‚¹ã¨ãªã‚‹ï¼ å‚è€ƒï¼šhttps://deepsource.io/blog/distributed-tracing/#monolithic-observability ï¼Šä¾‹ï¼Š ï¼ˆï¼‘ï¼‰a1ï¼šã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆãŒãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é€ä¿¡ã™ã‚‹ï¼ ï¼ˆï¼’ï¼‰a1ï¼šãƒªã‚¯ã‚¨ã‚¹ãƒˆãŒãƒ­ãƒ¼ãƒ‰ãƒãƒ©ãƒ³ã‚µï¼ã«åˆ°é”ã™ã‚‹ï¼ ï¼ˆï¼“ï¼‰a1ï½a2ï¼šãƒ­ãƒ¼ãƒ‰ãƒãƒ©ãƒ³ã‚µï¼ã§å‡¦ç†ãŒå®Ÿè¡Œã•ã‚Œã‚‹ï¼ ï¼ˆï¼”ï¼‰a2ï¼šãƒ­ãƒ¼ãƒ‰ãƒãƒ©ãƒ³ã‚µï¼ãŒãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã«è»¢é€ã™ã‚‹ï¼ ï¼ˆï¼•ï¼‰a2ï¼šãƒªã‚¯ã‚¨ã‚¹ãƒˆãŒã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã«åˆ°é”ã™ã‚‹ï¼ ï¼ˆï¼–ï¼‰a2ï½a3ï¼šã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã§å‡¦ç†ãŒå®Ÿè¡Œã•ã‚Œã‚‹ï¼ ï¼ˆï¼—ï¼‰a3ï¼šã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãŒãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã«è¿”ä¿¡ã™ã‚‹ï¼ ã‚¹ãƒ‘ãƒ³ ãƒ»ã‚¹ãƒ‘ãƒ³ã¨ã¯ ãƒã‚¤ã‚¯ãƒ­ã‚µãƒ¼ãƒ“ã‚¹ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã«ãŠã„ã¦ï¼Œç‰¹å®šã®ã‚µãƒ¼ãƒ“ã‚¹ã§ç™ºç”Ÿã—ãŸãƒ‡ãƒ¼ã‚¿ã®ã‚»ãƒƒãƒˆã®ã“ã¨ï¼JSONå‹ã§å®šç¾©ã•ã‚Œã‚‹ã“ã¨ãŒå¤šã„ï¼SaaSãƒ„ãƒ¼ãƒ«ã«ã‚ˆã£ã¦JSONå‹ã®æ§‹é€ ãŒç•°ãªã‚‹ï¼ å‚è€ƒï¼š https://opentracing.io/docs/overview/spans/ https://docs.datadoghq.com/ja/tracing/guide/send_traces_to_agent_by_api/#%E3%83%A2%E3%83%87%E3%83%AB https://docs.newrelic.com/jp/docs/distributed-tracing/trace-api/report-new-relic-format-traces-trace-api/#new-relic-guidelines ãƒ»ã‚¹ãƒ‘ãƒ³é–“ã®ç´ä»˜ã‘ ãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒ˜ãƒƒãƒ€ãƒ¼ã‚„ãƒœãƒ‡ã‚£ã«IDã‚’å‰²ã‚Šå½“ã¦ï¼Œç•°ãªã‚‹ã‚µãƒ¼ãƒ“ã‚¹ã®ã‚¹ãƒ‘ãƒ³é–“ã‚’ç´ä»˜ã‘ã‚‹ï¼AWSã‚’ä½¿ç”¨ã—ã¦ã„ã‚‹å ´åˆï¼Œä¾‹ãˆã°ALBãŒX-Amzn-Trace-Idãƒ˜ãƒƒãƒ€ãƒ¼ã«ãƒªã‚¯ã‚¨ã‚¹ãƒˆIDã‚’ä»˜ä¸ã—ã¦ãã‚Œã‚‹ãŸã‚ï¼Œã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã§ãƒªã‚¯ã‚¨ã‚¹ãƒˆIDã‚’å®Ÿè£…ã›ãšã«åˆ†æ•£ãƒˆãƒ¬ãƒ¼ã‚¹ã‚’å®Ÿç¾ã§ãã‚‹ï¼ å‚è€ƒï¼šhttps://docs.aws.amazon.com/ja_jp/elasticloadbalancing/latest/application/load-balancer-request-tracing.html ãƒ»ãƒ‡ãƒ¼ã‚¿ãƒã‚¤ãƒ³ãƒˆåŒ– ã‚¹ãƒ‘ãƒ³ãŒæŒã¤ãƒ‡ãƒ¼ã‚¿ã‚’ãƒ‡ãƒ¼ã‚¿ãƒã‚¤ãƒ³ãƒˆã¨ã—ã¦é›†è¨ˆã™ã‚‹ã“ã¨ã«ã‚ˆã‚Šï¼Œãƒ¡ãƒˆãƒªã‚¯ã‚¹ã‚’åé›†ã§ãã‚‹ï¼ "},"public/observability_monitering/monitering.html":{"url":"public/observability_monitering/monitering.html","title":"ğŸ“– ï¸ç›£è¦–","keywords":"","body":"ç›£è¦– ã¯ã˜ã‚ã« æœ¬ã‚µã‚¤ãƒˆã«ã¤ãã¾ã—ã¦ï¼Œä»¥ä¸‹ã‚’ã”èªè­˜ã®ã»ã©å®œã—ããŠé¡˜ã„ã„ãŸã—ã¾ã™ï¼ å‚è€ƒï¼šhttps://hiroki-it.github.io/tech-notebook-gitbook/ 01. ç›£è¦– ç›£è¦–ã¨ã¯ æ—¢çŸ¥ã®ãƒ¡ãƒˆãƒªã‚¯ã‚¹ã¨ãƒ­ã‚°ã«åŸºã¥ã„ã¦ï¼Œã‚·ã‚¹ãƒ†ãƒ ã«ãŠã‘ã‚‹æƒ³å®šå†…ã®ä¸å…·åˆã®ç™ºç”Ÿã‚’æœªç„¶ã«é˜²ãã“ã¨ï¼æƒ³å®šå†…ã¨ã„ã†ç‚¹ã§ï¼Œå¯è¦³æ¸¬æ€§ã¨åŒºåˆ¥ã§ãã‚‹ï¼ å‚è€ƒï¼š https://en.wikipedia.org/wiki/Website_monitoring https://blog.thundra.io/observability-driven-development-for-serverless ç›£è¦–ã®è¦ç´  ç›£è¦–ã¯ï¼Œä»¥ä¸‹ã®è¦ç´ ã‹ã‚‰ãªã‚‹ï¼ å‚è€ƒï¼šhttps://www.amazon.co.jp/dp/4873118646 ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ èª¬æ˜ ãƒ‡ãƒ¼ã‚¿ã®åé›† ç›£è¦–å¯¾è±¡ã‹ã‚‰ãƒ‡ãƒ¼ã‚¿ã‚’åé›†ã™ã‚‹ï¼ãƒ‡ãƒ¼ã‚¿ã¨ã—ã¦ã¯ï¼Œãƒ¡ãƒˆãƒªã‚¯ã‚¹ï¼Œã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãƒ­ã‚°ï¼Œãƒ–ãƒ©ã‚¦ã‚¶ãƒ­ã‚°ï¼Œãƒ¦ãƒ¼ã‚¶ãƒˆãƒ©ãƒ•ã‚£ãƒƒã‚¯ï¼Œãªã©ãŒã‚ã‚‹ï¼ â†“ åé›†å¾Œï¼Œæ¬¡ã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã«åˆ†å²ã™ã‚‹ï¼ ãƒ‡ãƒ¼ã‚¿ã®ä¿ç®¡ ãƒ‡ãƒ¼ã‚¿ã‚’ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã«ä¿ç®¡ã™ã‚‹ï¼ ãƒ‡ãƒ¼ã‚¿ã®å¯è¦–åŒ– ãƒ‡ãƒ¼ã‚¿ã‚’ç›£è¦–ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã«è¡¨ç¤ºã—ï¼Œç›®è¦–ã§ãã‚‹ã‚ˆã†ã«ã™ã‚‹ï¼ ãƒ‡ãƒ¼ã‚¿ã®åˆ†æ ãƒ‡ãƒ¼ã‚¿ã‚’æ•°å­¦çš„ã«åˆ†æã—ï¼Œçµæœã‚’ç®—å‡ºã™ã‚‹ï¼ ãƒ¬ãƒãƒ¼ãƒˆã®ä½œæˆ ç®—å‡ºå€¤ã‚’ã‚°ãƒ©ãƒ•åŒ–ã¨ã—ã¦ï¼Œãƒ¬ãƒãƒ¼ãƒˆã‚’ä½œæˆã™ã‚‹ï¼ ã‚¢ãƒ©ãƒ¼ãƒˆ ãƒ‡ãƒ¼ã‚¿ã«ç•°å¸¸ãŒã‚ã‚‹å ´åˆï¼Œã“ã‚Œã‚’ã‚¤ãƒ³ã‚·ãƒ‡ãƒ³ãƒˆã¨ã—ã¦é–‹ç™ºè€…ã«é€šçŸ¥ã™ã‚‹ï¼SLAã«æº€ãŸãªã„å ´åˆï¼Œã‚µãƒ¼ãƒ“ã‚¹åˆ©ç”¨è€…ã«åˆ©ç”¨æ–™ã‚’è¿”é‡‘ã™ã‚‹ï¼ã¾ãŸï¼Œã‚¤ãƒ³ã‚·ãƒ‡ãƒ³ãƒˆã‚’è§£æ±ºã™ã‚‹ãŸã‚ã®ã‚¿ã‚¹ã‚¯ã‚’ä½œæˆã—ï¼Œã“ã‚Œã«å¯¾å¿œã™ã‚‹ï¼ ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ç›£è¦– ãƒ»ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ç›£è¦–ã¨ã¯ ãƒ–ãƒ©ã‚¦ã‚¶ã«é–¢ã™ã‚‹ãƒˆãƒ©ãƒ•ã‚£ãƒƒã‚¯ã‚’ç›£è¦–ã™ã‚‹ï¼ ãƒ»ãƒªã‚¢ãƒ«ãƒ¦ãƒ¼ã‚¶ç›£è¦–ï¼ˆRUMï¼‰ ãƒ–ãƒ©ã‚¦ã‚¶ã¯ï¼ŒWebãƒšãƒ¼ã‚¸ã®ãƒ­ãƒ¼ãƒ‰æ™‚ã«ï¼ŒNavigation-timing-APIã«å¯¾ã—ã¦ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é€ä¿¡ã—ï¼ŒWebãƒšãƒ¼ã‚¸ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã«é–¢ã™ã‚‹ãƒ¡ãƒˆãƒªã‚¯ã‚¹ã‚’åé›†ã™ã‚‹ï¼ãƒªã‚¢ãƒ«ãƒ¦ãƒ¼ã‚¶ç›£è¦–ã§ã¯ï¼Œã“ã®ãƒ¡ãƒˆãƒªã‚¯ã‚¹ã‚’ç›£è¦–ã™ã‚‹ï¼ å‚è€ƒï¼šhttps://developer.mozilla.org/ja/docs/Web/API/Navigation_timing_API ãƒšãƒ¼ã‚¸ãƒ­ãƒ¼ãƒ‰æ™‚é–“ã¯ç‰¹ã«é‡è¦ã§ã‚ã‚‹ï¼Amazonã®è‡ªç¤¾èª¿æŸ»ã§ã¯ï¼Œãƒ­ãƒ¼ãƒ‰æ™‚é–“ãŒ100msçŸ­ããªã‚‹ã”ã¨ã«ï¼Œå£²ã‚Šä¸Šã’ãŒ1%å¢—åŠ ã™ã‚‹ã“ã¨ãŒæ˜ã‚‰ã‹ã«ãªã£ãŸï¼4ç§’ä»¥ä¸‹ã‚’ç›®æŒ‡ã™ã¨è‰¯ã„ï¼ å‚è€ƒï¼šhttps://bit.ly/2y494hq ãƒ»åˆæˆç›£è¦–ï¼ˆå¤–éƒ¨ç›£è¦–ï¼‰ ã€å¤–éƒ¨ç›£è¦–ã€ã¨ã‚‚ã„ã†ï¼SaaSã¯ï¼Œå®Ÿéš›ã®ãƒ¦ãƒ¼ã‚¶ã®ä¸€é€£ã®æ“ä½œã‚’æ¨¡ã—ãŸãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã«é€ä¿¡ã—ï¼Œãƒ¬ã‚¹ãƒãƒ³ã‚¹ã«é–¢ã™ã‚‹ãƒ¡ãƒˆãƒªã‚¯ã‚¹ã‚’åé›†ã™ã‚‹ï¼åˆæˆç›£è¦–ã§ã¯ï¼Œãƒ¡ãƒˆãƒªã‚¯ã‚¹ã‚’ç›£è¦–ã™ã‚‹ï¼ãƒ¦ãƒ¼ã‚¶ã‚’æ¨¡ã—ãŸãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’ç”Ÿæˆã™ã‚‹ã¨ã„ã†æ„å‘³åˆã„ã§ï¼Œã€åˆæˆã€ã¨ã„ã†ï¼ãƒ¦ãƒ¼ã‚¶è¦–ç‚¹ã§ç›£è¦–ã§ãã‚‹ï¼ å‚è€ƒï¼š https://takehora.hatenadiary.jp/entry/2019/07/05/012036 https://www.manageengine.jp/products/Applications_Manager/solution_synthetic-monitoring.html ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ç›£è¦–ï¼ˆAPMï¼‰ ãƒ»ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ç›£è¦–ã¨ã¯ ã€APMï¼ˆã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ç›£è¦–ï¼‰ã€ã¨ã‚‚ã„ã†ï¼ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å†…ã«å¸¸é§ã•ã›ãŸSaaSã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã¯ï¼Œã‚µãƒ¼ãƒå†…ã§ç¨¼åƒä¸­ã®ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ãƒ¡ãƒˆãƒªã‚¯ã‚¹ã‚„ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãƒ­ã‚°ã‚’åé›†ã—ï¼ŒSaaSã«é€ä¿¡ã™ã‚‹ï¼ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ç›£è¦–ã§ã¯ï¼Œã“ã‚Œã‚‰ã®ãƒ¡ãƒˆãƒªã‚¯ã‚¹ã‚„ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãƒ­ã‚°ã‚’ç›£è¦–ã™ã‚‹ï¼ãƒ¡ãƒˆãƒªã‚¯ã‚¹ã®ä¾‹ã¯ä»¥ä¸‹ã«ç¤ºã™ï¼ SQLã«ã‹ã‹ã‚‹æ™‚é–“ ãƒ“ãƒ«ãƒ‰ã¾ãŸã¯ãƒ‡ãƒ—ãƒ­ã‚¤ã®é–‹å§‹ï¼çµ‚äº†æ™‚é–“ å¤–éƒ¨APIã‚³ãƒ¼ãƒ«ã«ã‹ã‹ã‚‹æ™‚é–“ ãƒªã‚¯ã‚¨ã‚¹ãƒˆã®å—ä¿¡æ•° ãƒ­ã‚°ã‚¤ãƒ³æ•° ãƒ»StatsDã‚’ç”¨ã„ãŸãƒ¡ãƒˆãƒªã‚¯ã‚¹ã®ä½œæˆ ã‚µãƒ¼ãƒå†…ã«StatsDã‚’å¸¸é§ã•ã›ï¼Œã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã§StatsDãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’ç”¨ã„ã‚‹ã¨ï¼Œãƒ¡ãƒˆãƒªã‚¯ã‚¹ã‚’åé›†ã§ãã‚‹ï¼ã“ã®ãƒ¡ãƒˆãƒªã‚¯ã‚¹ã‚’SaaSã«é€ä¿¡ã™ã‚‹ï¼ å‚è€ƒï¼šhttps://github.com/statsd/statsd/wiki CloudWatchã§ã¯StatsDã‹ã‚‰ã®ãƒ¡ãƒˆãƒªã‚¯ã‚¹ã®é€ä¿¡ãŒã‚µãƒãƒ¼ãƒˆã•ã‚Œã¦ã„ã‚‹ï¼ å‚è€ƒï¼š https://docs.aws.amazon.com/ja_jp/AmazonCloudWatch/latest/monitoring/CloudWatch-Agent-custom-metrics-statsd.html https://qiita.com/murata-tomohide/items/9bd1320865b2eba47538 ã‚µãƒ¼ãƒï¼ã‚³ãƒ³ãƒ†ãƒŠç›£è¦– ãƒ»ã‚µãƒ¼ãƒï¼ã‚³ãƒ³ãƒ†ãƒŠç›£è¦–ã¨ã¯ ã‚µãƒ¼ãƒï¼ã‚³ãƒ³ãƒ†ãƒŠã®OSã«é–¢ã™ã‚‹ãƒ¡ãƒˆãƒªã‚¯ã‚¹ã‚’åé›†ã—ï¼Œã“ã‚Œã‚’SaaSã«é€ä¿¡ã™ã‚‹ï¼ã‚µãƒ¼ãƒï¼ã‚³ãƒ³ãƒ†ãƒŠç›£è¦–ã§ã¯ï¼Œã“ã®ãƒ¡ãƒˆãƒªã‚¯ã‚¹ã‚’ç›£è¦–ã™ã‚‹ï¼ãƒ¡ãƒˆãƒªã‚¯ã‚¹ã®ä¾‹ã¯ä»¥ä¸‹ã«ç¤ºã™ï¼ CPU ãƒ¡ãƒ¢ãƒª ãƒ­ãƒ¼ãƒ‰ã‚¢ãƒ™ãƒ¬ãƒ¼ã‚¸ ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ ãƒ‡ã‚£ã‚¹ã‚¯ ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ç›£è¦– ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ç›£è¦– 02. ãƒã‚¹ãƒˆãƒ¢ãƒ¼ãƒ†ãƒ ã®ä½œæˆ ãƒã‚¹ãƒˆãƒ¢ãƒ¼ãƒ†ãƒ ã¨ã¯ ã‚¢ãƒ©ãƒ¼ãƒˆã§é€šçŸ¥ã•ã‚ŒãŸã‚¤ãƒ³ã‚·ãƒ‡ãƒ³ãƒˆãŒãƒ“ã‚¸ãƒã‚¹ã«å¤§ããªå½±éŸ¿ã‚’ä¸ãˆãŸå ´åˆï¼ŒæŒ¯ã‚Šè¿”ã‚Šã®ãŸã‚ã«ï¼Œãƒã‚¹ãƒˆãƒ¢ãƒ¼ãƒ†ãƒ ã‚’ä½œæˆã™ã‚‹ï¼ãƒã‚¹ãƒˆãƒ¢ãƒ¼ãƒ†ãƒ ã¯ï¼Œéšœå®³å ±å‘Šæ›¸ã¨ã¯ç•°ãªã‚Šï¼ŒåŸå› ç‰¹å®šã¨ã‚·ã‚¹ãƒ†ãƒ æ”¹å–„ã«é‡ãã‚’ç½®ã„ãŸå ±å‘Šæ›¸ã§ã‚ã‚‹ï¼éšœå®³å ±å‘Šæ›¸ã¯ï¼Œè²¬ä»»ã®å ±å‘Šã®æ„å‘³åˆã„ãŒå¼·ããªã£ã¦ã—ã¾ã†ï¼ ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ å‚è€ƒï¼šhttps://ueokande.github.io/incident-response-docs-ja/after/post_mortem_template/ # ãƒã‚¹ãƒˆãƒ¢ãƒ¼ãƒ†ãƒ  ## ã‚¿ã‚¤ãƒˆãƒ« ## æ—¥ä»˜ ## æ‹…å½“è€… **â€»æ‹…å½“è€…ã‚’çµ¶å¯¾ã«è²¬ã‚ãšï¼Œéšœå®³ã¯èª°ã®ã›ã„ã§ã‚‚ãªã„ã¨ã„ã†æ„è­˜ã‚’å¼·ãæŒã¤ï¼** ## åŸå› ã¨å¯¾å¿œ **â€»åŸå› ç‰¹å®šã¨ã‚·ã‚¹ãƒ†ãƒ æ”¹å–„ã«é‡ãã‚’ç½®ãã“ã¨ï¼** ## ã‚·ã‚¹ãƒ†ãƒ çš„/åç›Šçš„ãªå½±éŸ¿ç¯„å›² ## å¹¸é‹ã ã£ãŸã“ã¨ ## ä»•çµ„ã¿ã®æ”¹å–„ç­– **â€»ã€Œä»¥å¾Œã¯æ³¨æ„ã™ã‚‹ã€ã§ã¯ãªãï¼Œå†ç™ºã—ãªã„ä»•çµ„ã¿ä½œã‚Šã«ãªã‚‹ã‚ˆã†ã«ã™ã‚‹ï¼** ## éšœå®³ç™ºç”Ÿã‹ã‚‰å¯¾å¿œã¾ã§ã®ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³ ä»–ç¤¾äº‹ä¾‹ å‚è€ƒï¼šhttps://ueokande.github.io/incident-response-docs-ja/after/post_mortem_process/#_6 ã‚µãƒ¼ãƒ“ã‚¹ ãƒªãƒ³ã‚¯ AWS https://aws.amazon.com/jp/message/5467D2/ Heroku https://status.heroku.com/incidents/151 Twilio https://www.twilio.com/blog/2013/07/billing-incident-post-mortem-breakdown-analysis-and-root-cause.html 03. ç›£è¦–ã«åŸºã¥ãæ„æ€æ±ºå®š SLIï¼šService Level Indicatorï¼ˆã‚µãƒ¼ãƒ“ã‚¹ãƒ¬ãƒ™ãƒ«æŒ‡æ¨™ï¼‰ ãƒ»SLIã¨ã¯ ã‚µãƒ¼ãƒ“ã‚¹ãƒ¬ãƒ™ãƒ«ã®æŒ‡æ¨™ã¨ã™ã‚‹ãƒ¡ãƒˆãƒªã‚¯ã‚¹ã®ã“ã¨ï¼ ãƒ»SLIã®ä¾‹ ã‚µãƒ¼ãƒç¨¼åƒç‡ ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ç¨¼åƒç‡ ãƒ¬ã‚¤ãƒ†ãƒ³ã‚·ãƒ¼ ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚¿ã‚¤ãƒ  ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã®ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚³ãƒ¼ãƒ‰ç‡ ã‚¹ãƒ«ãƒ¼ãƒ—ãƒƒãƒˆ AWSã§å½¹ç«‹ã¤ãƒ¡ãƒˆãƒªã‚¯ã‚¹ ãƒ»SLIã«é–¢é€£ã™ã‚‹ãƒ¡ãƒˆãƒªã‚¯ã‚¹ æŒ‡æ¨™ AWSãƒªãƒªãƒ¼ã‚¹ é–¢é€£ã™ã‚‹ãƒ¡ãƒˆãƒªã‚¯ã‚¹ è£œè¶³ ã‚µãƒ¼ãƒç¨¼åƒç‡ ECS ãƒ»RunningTaskCount ã‚¿ãƒ¼ã‚²ãƒƒãƒˆè¿½è·¡ã‚¹ã‚±ãƒ¼ãƒªãƒ³ã‚°ãƒãƒªã‚·ãƒ¼ã®ECSã‚µãƒ¼ãƒ“ã‚¹ãƒ¡ãƒˆãƒªã‚¯ã‚¹ã‚‚å‚è€ƒã«ã›ã‚ˆï¼ ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ç¨¼åƒç‡ RDS ãƒ»CPUUtilizationãƒ»FreeableMemory ãƒ¬ã‚¤ãƒ†ãƒ³ã‚·ãƒ¼ API Gateway ãƒ»Latencyãƒ»IntegrationLatency ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã®ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚³ãƒ¼ãƒ‰ç‡ API Gateway ãƒ»4XXErrorãƒ»5XXError ALB ãƒ»HTTPCode_ELB_4XX_Countãƒ»HTTPCode_ELB_5XX_Countãƒ»HTTPCode_TARGET_4XX_Countãƒ»HTTPCode_TARGET_5XX_Countãƒ»RejectedConnectionCountãƒ»HealthyHostCountãƒ»TargetConnectionErrorCountãƒ»TargetTLSNegotiationErrorCount å‚è€ƒï¼šhttps://docs.aws.amazon.com/ja_jp/elasticloadbalancing/latest/application/load-balancer-cloudwatch-metrics.html ãƒ»ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã«é–¢ã™ã‚‹ãƒ¡ãƒˆãƒªã‚¯ã‚¹ åå‰ AWSãƒªãƒªãƒ¼ã‚¹ è£œè¶³ ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã‚¤ãƒ³ã‚µã‚¤ãƒˆ RDS RDSã®ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã«é–¢ã™ã‚‹ãƒ¡ãƒˆãƒªã‚¯ã‚¹ã‚’åé›†ã—ï¼ŒSQLãƒ¬ãƒ™ãƒ«ã§ç›£è¦–ã§ãã‚‹ã‚ˆã†ã«ãªã‚‹ï¼ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚°ãƒ«ãƒ¼ãƒ—ã®performance_schemaã‚’æœ‰åŠ¹åŒ–ã™ã‚‹å¿…è¦ãŒã‚ã‚‹ï¼å¯¾å¿œã™ã‚‹ã‚¨ãƒ³ã‚¸ãƒ³ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã¨ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚¿ã‚¤ãƒ—ã«ã¤ã„ã¦ã¯ï¼Œä»¥ä¸‹ã®ãƒªãƒ³ã‚¯ã‚’å‚è€ƒã«ã›ã‚ˆï¼å‚è€ƒï¼šhttps://docs.aws.amazon.com/ja_jp/AmazonRDS/latest/UserGuide/USER_PerfInsights.Overview.Engines.htm Container ã‚¤ãƒ³ã‚µã‚¤ãƒˆ ECSï¼EKS ECSï¼EKSã®ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã«é–¢ã™ã‚‹ãƒ¡ãƒˆãƒªã‚¯ã‚¹ã‚’åé›†ã—ï¼ŒECSï¼EKSã®ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ï¼Œã‚µãƒ¼ãƒ“ã‚¹ï¼Œã‚¿ã‚¹ã‚¯ï¼Œã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ï¼Œå˜ä½ã§ç›£è¦–ã§ãã‚‹ã‚ˆã†ã«ãªã‚‹ï¼ã¾ãŸï¼Œã‚³ãƒ³ãƒ†ãƒŠé–“ã®ç¹‹ãŒã‚Šã‚’ã‚³ãƒ³ãƒ†ãƒŠãƒãƒƒãƒ—ã§è¦–è¦šåŒ–ã§ãã‚‹ã‚ˆã†ã«ãªã‚‹ï¼ECSï¼EKSã®ã‚¢ã‚«ã‚¦ãƒ³ãƒˆè¨­å®šã§Containerã‚¤ãƒ³ã‚µã‚¤ãƒˆã‚’æœ‰åŠ¹åŒ–ã™ã‚‹å¿…è¦ãŒã‚ã‚‹ï¼ Lambdaã‚¤ãƒ³ã‚µã‚¤ãƒˆ Lambda Lambdaã®ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã«é–¢ã™ã‚‹ãƒ¡ãƒˆãƒªã‚¯ã‚¹ã‚’åé›†ã§ãã‚‹ã‚ˆã†ã«ãªã‚‹ï¼ SLOï¼šService Level Objectiveï¼ˆã‚µãƒ¼ãƒ“ã‚¹ãƒ¬ãƒ™ãƒ«ç›®æ¨™ï¼‰ ãƒ»SLOã¨ã¯ SLIã¨ã—ã¦æ¡ç”¨ã—ãŸæŒ‡æ¨™ã®ç›®æ¨™å€¤ã®ã“ã¨ï¼ãƒ¦ãƒ¼ã‚¶ã®è¦–ç‚¹ã§è¨­å®šã™ã‚‹å¿…è¦ãŒã‚ã‚‹ï¼99.9%ã®æˆåŠŸç‡ã‚’ç›®æ¨™ã¨ã™ã‚‹ã“ã¨ãŒå¤šã„ï¼ ãƒ»SLOã®ä¾‹ æŒ‡æ¨™ ç›®æ¨™å€¤ã®ä¾‹ ã‚µãƒ¼ãƒç¨¼åƒç‡ æ—¥å½“ãŸã‚Š0.1%ä»¥ä¸‹ã®ãƒ€ã‚¦ãƒ³ã‚¿ã‚¤ãƒ  ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ç¨¼åƒç‡ æ—¥å½“ãŸã‚Š0.1%ä»¥ä¸‹ã®ãƒ€ã‚¦ãƒ³ã‚¿ã‚¤ãƒ  ãƒ¬ã‚¤ãƒ†ãƒ³ã‚·ãƒ¼ æ—¥å½“ãŸã‚Š0.1%ä»¥ä¸‹ã®ãƒ¬ã‚¤ãƒ†ãƒ³ã‚·ãƒ¼ ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã®ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚³ãƒ¼ãƒ‰ç‡ æ—¥å½“ãŸã‚Š99.9%ä»¥ä¸Šã®200ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚³ãƒ¼ãƒ‰ ã‚¹ãƒ«ãƒ¼ãƒ—ãƒƒãƒˆ æ—¥å½“ãŸã‚Š0.1%ä»¥ä¸‹ã®ã‚¹ãƒ«ãƒ¼ãƒ—ãƒƒãƒˆä½ä¸‹ ã‚¨ãƒ©ãƒ¼ãƒã‚¸ã‚§ãƒƒãƒˆ ãƒ»ã‚¨ãƒ©ãƒ¼ãƒã‚¸ã‚§ãƒƒãƒˆã¨ã¯ å¹´æœˆå½“ãŸã‚Šã§è¨±å®¹ã™ã‚‹ã‚¨ãƒ©ãƒ¼ã‚„ãƒ€ã‚¦ãƒ³ã‚¿ã‚¤ãƒ ã®ç¨‹åº¦ã®ã“ã¨ï¼ã‚¨ãƒ©ãƒ¼ã‚„ãƒ€ã‚¦ãƒ³ã‚¿ã‚¤ãƒ ã®ç™ºç”Ÿã«ã‚ˆã£ã¦ãƒ“ã‚¸ãƒã‚¹ã«å½±éŸ¿ã‚’ä¸ãˆã‚‹å¯èƒ½æ€§ãŒã‚ã£ãŸã¨ã—ã¦ã‚‚ï¼ŒSLOã®é–¾å€¤ã‚’è¶…ãˆãªã„é™ã‚Šã¯ã“ã‚Œã‚’è¨±å®¹ã—ï¼ŒæŠ€è¡“ã‚’å„ªå…ˆã™ã‚‹ï¼ãƒ“ã‚¸ãƒã‚¹ã‚ˆã‚ŠæŠ€è¡“ã‚’å„ªå…ˆã™ã‚‹æ™‚ã«ï¼Œç´ æ—©ãæ„æ€æ±ºå®šã§ãã‚‹ï¼ SLAï¼šService Level Agreement ãƒ»SLAã¨ã¯ ã‚µãƒ¼ãƒ“ã‚¹ãƒ¬ãƒ™ãƒ«åˆæ„ã¨è¨³ã›ã‚‹ï¼ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆã‚µãƒ¼ãƒ“ã‚¹ã«æœ€ä½é™ã®ã‚µãƒ¼ãƒ“ã‚¹ã®ãƒ¬ãƒ™ãƒ«ã‚’ä¿è¨¼ã—ï¼Œã“ã‚Œã‚’ä¸‹å›ã£ãŸå ´åˆã«ã¯è¿”é‡‘ã§ãã‚‹ã‚ˆã†ã«åˆæ„ã™ã‚‹ã‚‚ã®ï¼SLAã¨ã—ã¦ï¼Œä¾‹ãˆã°ä»¥ä¸‹ãŒã‚ã‚‹ï¼ é …ç›® èª¬æ˜ ãƒ¬ãƒ™ãƒ«ä¾‹ è¿”é‡‘ç‡ ã‚µãƒ¼ãƒç¨¼åƒç‡ ã‚µãƒ¼ãƒã®æ™‚é–“å½“ãŸã‚Šã®ç¨¼åƒç‡ 99.9%ä»¥ä¸Š 10% éšœå®³å›å¾©æ™‚é–“ éšœå®³ãŒèµ·ã“ã£ã¦ã‹ã‚‰å›å¾©ã™ã‚‹ã¾ã§ã®æ™‚é–“ 2æ™‚é–“ä»¥å†… 10% éšœå®³ãŠå•ã„åˆã‚ã› éšœå®³ç™ºç”Ÿæ™‚ã®ãŠå•ã„åˆã‚ã›å¯èƒ½æ™‚é–“å¸¯ 24æ™‚é–“365æ—¥ 10% ãƒ»AWSã®SLA AWSã§ã¯ã‚µãƒ¼ãƒ“ã‚¹ãƒ¬ãƒ™ãƒ«ã®é …ç›®ã¨ã—ã¦ï¼Œã‚µãƒ¼ãƒç¨¼åƒç‡ã‚’æ¡ç”¨ã—ã¦ã„ã‚‹ï¼ã“ã‚Œã«å¯¾ã—ã¦ï¼Œã»ã¨ã‚“ã©ã®AWSãƒªã‚½ãƒ¼ã‚¹ã§ï¼Œä»¥ä¸‹ã®SLAãŒè¨­å®šã•ã‚Œã¦ã„ã‚‹ï¼å„ãƒªã‚½ãƒ¼ã‚¹ã«SLAãŒå®šç¾©ã•ã‚Œã¦ã„ã‚‹ï¼ å‚è€ƒï¼šhttps://aws.amazon.com/jp/legal/service-level-agreements/ ï¼Šä¾‹ï¼Š EC2ï¼ŒEBSï¼ŒECSï¼ŒEKSï¼Œã®ä¾‹ã‚’ç¤ºã™ï¼ æ¯æœˆã®ç¨¼åƒç‡ ç™ºç”Ÿã—ãŸãƒ€ã‚¦ãƒ³ã‚¿ã‚¤ãƒ  è¿”é‡‘ç‡ 99.0ï¼…ä»¥ä¸Šï¼Œ99.99%æœªæº€ 87.6ï½0.876æ™‚é–“ 10% 95.0ï¼…ä»¥ä¸Šï¼Œ99.0ï¼…æœªæº€ 438ï½87.6æ™‚é–“ 30% 95.0%æœªæº€ 438æ™‚é–“ä»¥ä¸Š 100% "},"public/observability_monitering/observability_fluentd_and_fluentbit.html":{"url":"public/observability_monitering/observability_fluentd_and_fluentbit.html","title":"ğŸ“– ï¸Fluentdï¼FluentBit","keywords":"","body":"Fluentdï¼FluentBit ã¯ã˜ã‚ã« æœ¬ã‚µã‚¤ãƒˆã«ã¤ãã¾ã—ã¦ï¼Œä»¥ä¸‹ã‚’ã”èªè­˜ã®ã»ã©å®œã—ããŠé¡˜ã„ã„ãŸã—ã¾ã™ï¼ å‚è€ƒï¼šhttps://hiroki-it.github.io/tech-notebook-gitbook/ 01. Fluentdï¼FluentBitã¨ã¯ æ¦‚è¦ ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‹ã‚‰ãƒ­ã‚°ã‚’åé›†ã—ï¼Œã“ã‚Œã‚’ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°ã—ãŸå¾Œï¼Œè¤‡æ•°ã®å®›å…ˆã«è»¢é€ã™ã‚‹ï¼ å‚è€ƒï¼šhttps://docs.fluentbit.io/manual/about/fluentd-and-fluent-bit Fluentd vs. FluentBit Fluentd FluentBit ã‚¹ã‚³ãƒ¼ãƒ— ã‚³ãƒ³ãƒ†ãƒŠï¼ã‚µãƒ¼ãƒ çµ„ã¿è¾¼ã¿Linuxï¼ã‚³ãƒ³ãƒ†ãƒŠï¼ã‚µãƒ¼ãƒ è¨€èª C & Ruby NS ãƒ¡ãƒ¢ãƒªæœ€å¤§ä½¿ç”¨é‡ 40MB 650KB ä¾å­˜é–¢ä¿‚ æ¨™æº–ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã§ä¸€å®šæ•°ã®Ruby gemã«ä¾å­˜ã™ã‚‹ï¼ æ¨™æº–ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã§ã¯ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã«ä¾å­˜ã—ãªã„ï¼ ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ é«˜ é«˜ ãƒ—ãƒ©ã‚°ã‚¤ãƒ³æ•° 1000å€‹ä»¥ä¸Š 70å€‹ "},"public/observability_monitering/observability_fluentbit.html":{"url":"public/observability_monitering/observability_fluentbit.html","title":"ğŸ“– ï¸FluentBit","keywords":"","body":"FluentBit 01. ãƒ­ã‚°ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ ãƒ­ã‚°ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã¨ã¯ FluentBitã«ã¦ï¼Œãƒ­ã‚°ã‚’å‡¦ç†ã™ã‚‹ä¸€é€£ã®ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã®ã“ã¨ï¼ ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã®è¨­å®š ãƒ»confãƒ•ã‚¡ã‚¤ãƒ« confãƒ•ã‚¡ã‚¤ãƒ«ã§ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚’è¨­å®šã§ãã‚‹ï¼ å‚è€ƒï¼šhttps://docs.fluentbit.io/manual/administration/configuring-fluent-bit/configuration-file è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã¯ä»¥ä¸‹ã‹ã‚‰è¡Œã†ï¼ å‚è€ƒï¼šhttps://cloud.calyptia.com/visualizer ãƒ»ã‚³ãƒãƒ³ãƒ‰ ã‚³ãƒãƒ³ãƒ‰ã§ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚’å®Ÿè¡Œã§ãã‚‹ï¼ Available Options -b --storage_path=PATH specify a storage buffering path -c --config=FILE specify an optional configuration file -d, --daemon run Fluent Bit in background mode -D, --dry-run dry run -f, --flush=SECONDS flush timeout in seconds (default: 5) -F --filter=FILTER set a filter -i, --input=INPUT set an input -m, --match=MATCH set plugin match, same as '-p match=abc' -o, --output=OUTPUT set an output -p, --prop=\"A=B\" set plugin configuration property -R, --parser=FILE specify a parser configuration file -e, --plugin=FILE load an external plugin (shared lib) -l, --log_file=FILE write log info to a file -t, --tag=TAG set plugin tag, same as '-p tag=abc' -T, --sp-task=SQL define a stream processor task -v, --verbose increase logging verbosity (default: info) -w, --workdir set the working directory -H, --http enable monitoring HTTP server -P, --port set HTTP server TCP port (default: 2020) -s, --coro_stack_size set coroutines stack size in bytes (default: 24576) -q, --quiet quiet mode -S, --sosreport support report for Enterprise customers -V, --version show version number -h, --help print this help 02. ã‚»ã‚¯ã‚·ãƒ§ãƒ³ SERVICE ãƒ»SERVICEã‚»ã‚¯ã‚·ãƒ§ãƒ³ã¨ã¯ ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³å…¨ä½“ã®è¨­å®šã‚„ãƒ•ã‚¡ã‚¤ãƒ«ã®èª­ã¿è¾¼ã¿ã‚’å®šç¾©ã™ã‚‹ï¼å„è¨­å®šã®é ­æ–‡å­—ã¯å¤§æ–‡å­—ã¨ã™ã‚‹ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š [SERVICE] Flush 1 # çŒ¶äºˆæ™‚é–“ Grace 30 # FluentBitè‡ªä½“ã®ãƒ­ã‚°ãƒ¬ãƒ™ãƒ« Log_Level info # èª­ã¿è¾¼ã¾ã‚Œã‚‹Parsers Multilineãƒ•ã‚¡ã‚¤ãƒ«ã®åå‰ Parsers_File parsers_multiline.conf # èª­ã¿è¾¼ã¾ã‚Œã‚‹Stream Processorãƒ•ã‚¡ã‚¤ãƒ«ã®åå‰ Streams_File stream_processor.conf ãƒ»å®Ÿè¡Œãƒ­ã‚°ã®ç¢ºèª Log_Levelå€¤ã§FluentBitã®ãƒ­ã‚°ãƒ¬ãƒ™ãƒ«ã‚’åˆ¶å¾¡ã§ãã‚‹ï¼debugã‚’å‰²ã‚Šå½“ã¦ã‚‹ã¨ï¼ŒFluentBitã®ãƒ­ã‚°ãŒã‚ˆã‚Šè©³ç´°ã«ãªã‚Šï¼Œå„ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã®è¨­å®šå€¤ã‚’ç¢ºèªã§ãã‚‹ã‚ˆã†ã«ãªã‚‹ï¼ ï¼Šå®Ÿè¡Œãƒ­ã‚°ä¾‹ï¼Š Fluent Bit v1.8.6 * Copyright (C) 2019-2021 The Fluent Bit Authors * Copyright (C) 2015-2018 Treasure Data * Fluent Bit is a CNCF sub-project under the umbrella of Fluentd * https://fluentbit.io [2021/01/01 12:00:00] [ info] Configuration: [2021/01/01 12:00:00] [ info] flush time | 1.000000 seconds [2021/01/01 12:00:00] [ info] grace | 30 seconds [2021/01/01 12:00:00] [ info] daemon | 0 [2021/01/01 12:00:00] [ info] ___________ [2021/01/01 12:00:00] [ info] inputs: [2021/01/01 12:00:00] [ info] forward [2021/01/01 12:00:00] [ info] ___________ [2021/01/01 12:00:00] [ info] filters: [2021/01/01 12:00:00] [ info] stdout.0 [2021/01/01 12:00:00] [ info] ___________ [2021/01/01 12:00:00] [ info] outputs: [2021/01/01 12:00:00] [ info] null.0 [2021/01/01 12:00:00] [ info] ___________ [2021/01/01 12:00:00] [ info] collectors: [2021/01/01 12:00:00] [ info] [engine] started (pid=1) [2021/01/01 12:00:00] [debug] [engine] coroutine stack size: 24576 bytes (24.0K) [2021/01/01 12:00:00] [debug] [storage] [cio stream] new stream registered: forward.0 [2021/01/01 12:00:00] [ info] [storage] version=1.1.1, initializing... [2021/01/01 12:00:00] [ info] [storage] in-memory [2021/01/01 12:00:00] [ info] [storage] normal synchronization mode, checksum disabled, max_chunks_up=128 [2021/01/01 12:00:00] [ info] [cmetrics] version=0.2.1 [2021/01/01 12:00:00] [debug] [in_fw] Listen='0.0.0.0' TCP_Port=24224 [2021/01/01 12:00:00] [ info] [input:forward:forward.0] listening on 0.0.0.0:24224 [2021/01/01 12:00:00] [debug] [null:null.0] created event channels: read=21 write=22 [2021/01/01 12:00:00] [debug] [router] match rule forward.0:null.0 [2021/01/01 12:00:00] [ info] [sp] stream processor started INPUT ãƒ»INPUTã‚»ã‚¯ã‚·ãƒ§ãƒ³ã¨ã¯ ãƒ­ã‚°ã®ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã¸ã®å…¥åŠ›æ–¹æ³•ã‚’å®šç¾©ã™ã‚‹ï¼ å‚è€ƒï¼šhttps://docs.fluentbit.io/manual/concepts/data-pipeline/input ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã‚’ç”¨ã„ã¦ï¼Œãƒ­ã‚°ã®å…¥åŠ›æ–¹æ³•ã‚’æŒ‡å®šã™ã‚‹ï¼ å‚è€ƒï¼šhttps://docs.fluentbit.io/manual/pipeline/inputs ã‚³ãƒãƒ³ãƒ‰ã®-iã‚ªãƒ—ã‚·ãƒ§ãƒ³ã§INPUTåã‚’æŒ‡å®šã—ï¼Œå®Ÿè¡Œã™ã‚‹ã“ã¨ã‚‚ã§ãã‚‹ï¼ Inputs cpu CPU Usage mem Memory Usage thermal Thermal kmsg Kernel Log Buffer proc Check Process health disk Diskstats systemd Systemd (Journal) reader netif Network Interface Usage docker Docker containers metrics docker_events Docker events node_exporter_metrics Node Exporter Metrics (Prometheus Compatible) fluentbit_metrics Fluent Bit internal metrics tail Tail files dummy Generate dummy data head Head Input health Check TCP server health http HTTP collectd collectd input plugin statsd StatsD input plugin serial Serial input stdin Standard Input syslog Syslog exec Exec Input tcp TCP mqtt MQTT, listen for Publish messages forward Fluentd in-forward random Random ãƒ»dummyãƒ—ãƒ©ã‚°ã‚¤ãƒ³ ãƒ€ãƒŸãƒ¼ã®æ§‹é€ åŒ–ãƒ­ã‚°ã‚’ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã«å…¥åŠ›ã™ã‚‹ï¼éæ§‹é€ åŒ–ãƒ­ã‚°ã¯å…¥åŠ›ãƒ‡ãƒ¼ã‚¿ã¨ã—ã¦ä½¿ç”¨ã§ããªã„ï¼ãƒ­ãƒ¼ã‚«ãƒ«ç’°å¢ƒã§ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã®å‹•ä½œã‚’ç¢ºèªã™ã‚‹ãŸã‚ã«å½¹ç«‹ã¤ï¼ å‚è€ƒï¼š https://docs.fluentbit.io/manual/pipeline/inputs/dummy https://docs.fluentbit.io/manual/local-testing/logging-pipeline { \"message\": \"dummy\" } ï¼Šå®Ÿè£…ä¾‹ï¼Š [INPUT] Name dummy # ãƒ€ãƒŸãƒ¼JSONãƒ‡ãƒ¼ã‚¿ Dummy {\"message\":\"dummy\"} ï¼Šã‚³ãƒãƒ³ãƒ‰ä¾‹ï¼Š fluent-bit/bin/fluent-bit -i dummy -o stdout ãƒ»forwardãƒ—ãƒ©ã‚°ã‚¤ãƒ³ å—ä¿¡ã—ãŸãƒ­ã‚°ã‚’æŒ‡å®šã•ã‚ŒãŸãƒãƒ¼ãƒˆã§ãƒªãƒƒã‚¹ãƒ³ã—ï¼Œãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã«å…¥åŠ›ã™ã‚‹ï¼ å‚è€ƒï¼šhttps://docs.fluentbit.io/manual/pipeline/inputs/forward ï¼Šå®Ÿè£…ä¾‹ï¼Š [INPUT] # ãƒ—ãƒ©ã‚°ã‚¤ãƒ³å Name forward Listen 0.0.0.0 # ãƒ—ãƒ­ã‚»ã‚¹ã®ãƒªãƒƒã‚¹ãƒ³ãƒãƒ¼ãƒˆ ï¼Šå®Ÿè¡Œãƒ­ã‚°ä¾‹ï¼Š Fluent Bit v1.8.6 * Copyright (C) 2019-2021 The Fluent Bit Authors * Copyright (C) 2015-2018 Treasure Data * Fluent Bit is a CNCF sub-project under the umbrella of Fluentd * https://fluentbit.io [2021/01/01 12:00:00] [ info] [engine] started (pid=1) [2021/01/01 12:00:00] [ info] [storage] version=1.1.1, initializing... [2021/01/01 12:00:00] [ info] [storage] in-memory [2021/01/01 12:00:00] [ info] [storage] normal synchronization mode, checksum disabled, max_chunks_up=128 [2021/01/01 12:00:00] [ info] [cmetrics] version=0.2.1 [2021/01/01 12:00:00] [ info] [input:forward:forward.0] listening on 0.0.0.0:24224 [2021/01/01 12:00:00] [ info] [sp] stream processor started ï¼Šã‚³ãƒãƒ³ãƒ‰ä¾‹ï¼Š $ fluent-bit/bin/fluent-bit \\ -i forward \\ -o stdout ãƒ»tailãƒ—ãƒ©ã‚°ã‚¤ãƒ³ æŒ‡å®šã—ãŸãƒ‘ã‚¹ã«ç¶™ç¶šçš„ã«å‡ºåŠ›ã•ã‚Œã‚‹ãƒ­ã‚°ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é †æ¬¡çµåˆã—ï¼Œãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã«å…¥åŠ›ã™ã‚‹ï¼ã‚ã‚‰ã‹ã˜ã‚ï¼ŒFluentBitã‚³ãƒ³ãƒ†ãƒŠå†…ã«ãƒ­ã‚°ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é…ç½®ã™ã‚‹å¿…è¦ãŒã‚ã‚Šï¼ŒPathã§ã“ã‚Œã‚’æŒ‡å®šã™ã‚‹ï¼v1.8ã‚’å¢ƒã«ã‚ªãƒ—ã‚·ãƒ§ãƒ³ãŒå¤‰ã‚ã£ã¦ã„ã‚‹ã“ã¨ã«æ³¨æ„ã™ã‚‹ï¼ å‚è€ƒï¼šhttps://docs.fluentbit.io/manual/pipeline/inputs/tail ï¼Šå®Ÿè£…ä¾‹ï¼Š [INPUT] # ãƒ—ãƒ©ã‚°ã‚¤ãƒ³å Name tail # FluentBitã‚³ãƒ³ãƒ†ãƒŠå†…ã®ãƒ­ã‚°ãƒ•ã‚¡ã‚¤ãƒ«ã®å ´æ‰€ï¼ãƒ¯ã‚¤ãƒ«ãƒ‰ã‚«ãƒ¼ãƒ‰ã‚’ä½¿ç”¨ã§ãã‚‹ï¼ Path /var/www/foo/storage/logs/*.log # ä½¿ç”¨ã™ã‚‹ãƒ‘ãƒ¼ã‚µãƒ¼å multiline.parser laravel-multiline-parser log_router: container_name: fluentbit build: dockerfile: ./docker/fluentbit/Dockerfile context: . volumes: # ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ãƒ­ã‚°ãƒ•ã‚¡ã‚¤ãƒ«ã®Volumeãƒã‚¦ãƒ³ãƒˆ - ./storage/logs:/var/www/foo/storage/logs ï¼Šã‚³ãƒãƒ³ãƒ‰ä¾‹ï¼Š å‚è€ƒï¼šhttps://docs.fluentbit.io/manual/pipeline/inputs/tail#command-line $ fluent-bit -i tail -p path=/var/www/foo/storage/logs/*.log -o stdout ï¼Šå®Ÿè¡Œãƒ­ã‚°ä¾‹ï¼Š * Copyright (C) 2019-2021 The Fluent Bit Authors * Copyright (C) 2015-2018 Treasure Data * Fluent Bit is a CNCF sub-project under the umbrella of Fluentd * https://fluentbit.io [2021/01/01 12:00:00] [ info] [engine] started (pid=1) [2021/01/01 12:00:00] [ info] [storage] version=1.1.1, initializing... [2021/01/01 12:00:00] [ info] [storage] in-memory [2021/01/01 12:00:00] [ info] [storage] normal synchronization mode, checksum disabled, max_chunks_up=128 [2021/01/01 12:00:00] [ info] [cmetrics] version=0.2.1 [2021/01/01 12:00:00] [ info] [sp] stream processor started [2021/01/01 12:00:00] [ info] [input:tail:tail.0] inotify_fs_add(): inode=31621169 watch_fd=1 name=/var/www/foo/storage/logs/laravel.log [0] tail.0: [1634640932.010306200, {\"log\"=>\"[2021-01-01 12:00:00] local.INFO: ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸\"}] [1] tail.0: [1634640932.013139300, {\"log\"=>\"[2021-01-01 12:00:00] local.INFO: ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸\"}] [2] tail.0: [1634640932.013147300, {\"log\"=>\"[2021-01-01 12:00:00] local.INFO: ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸\"}] PARSE ãƒ»PARSEã‚»ã‚¯ã‚·ãƒ§ãƒ³ã¨ã¯ ãƒ»MULTILINE_PARSERã‚»ã‚¯ã‚·ãƒ§ãƒ³ å‚è€ƒï¼šhttps://docs.fluentbit.io/manual/administration/configuring-fluent-bit/multiline-parsing ï¼Šå®Ÿè£…ä¾‹ï¼Š Laravelã®ã‚¹ã‚¿ãƒƒã‚¯ãƒˆãƒ¬ãƒ¼ã‚¹ã‚’çµåˆã™ã‚‹ï¼ [MULTILINE_PARSER] # ãƒ‘ãƒ¼ã‚µãƒ¼å name laravel # ãƒ‘ãƒ¼ã‚µãƒ¼ã‚¿ã‚¤ãƒ— type regex flush_timeout 1000 # ãƒ‘ãƒ¼ã‚µãƒ¼ãƒ«ãƒ¼ãƒ«ï¼ã‚¹ã‚¿ãƒƒã‚¯ãƒˆãƒ¬ãƒ¼ã‚¹ã®æ–‡é ­ã‚’start_stateï¼Œã¾ãŸä»¥é™ã«çµåˆã™ã‚‹æ–‡å­—åˆ—ã‚’contã§æŒ‡å®šã™ã‚‹ï¼ # [%Y-%m-%d %H:%M:%S] ã‚’ã‚¹ã‚¿ãƒƒã‚¯ãƒˆãƒ¬ãƒ¼ã‚¹ã®é–‹å§‹åœ°ç‚¹ã¨ã™ã‚‹ï¼ rule \"start_state\" \"/\\[[12]\\d{3}-(0[1-9]|1[0-2])-(0[1-9]|[12]\\d|3[01])\\s+([01]?\\d|2[0-3]):([0-5]\\d):([0-5]\\d)\\].*/\" \"cont\" # [stacktrace]ï¼Œ[previous exception]ï¼Œ#ï¼Œè¡Œé–“ï¼Œ\"} ï¼Œã§å§‹ã¾ã‚‹æ–‡å­—ã®å ´åˆã«çµåˆã™ã‚‹ï¼ rule \"cont\" \"/(\\[(stacktrace|previous exception)\\]|#|\\n\\n|\"\\}).*/\" \"cont\" FILTER ãƒ»FILTERã‚»ã‚¯ã‚·ãƒ§ãƒ³ã¨ã¯ ç‰¹å®šã®æ–‡å­—åˆ—ã‚’æŒã¤ãƒ­ã‚°ã®ã¿ã‚’BUFFERã‚»ã‚¯ã‚·ãƒ§ãƒ³ã«è»¢é€ã™ã‚‹ï¼ ãƒ»multilineãƒ—ãƒ©ã‚°ã‚¤ãƒ³ å‚è€ƒï¼šhttps://docs.fluentbit.io/manual/pipeline/filters/multiline-stacktrace [FILTER] # ãƒ—ãƒ©ã‚°ã‚¤ãƒ³å name multiline match * multiline.key_content log # ä½¿ç”¨ã™ã‚‹ãƒ‘ãƒ¼ã‚µãƒ¼å multiline.parser laravel ã‚³ãƒãƒ³ãƒ‰ã®-fã‚ªãƒ—ã‚·ãƒ§ãƒ³ã§INPUTåã‚’æŒ‡å®šã—ï¼Œå®Ÿè¡Œã™ã‚‹ã“ã¨ã‚‚ã§ãã‚‹ï¼ Filters alter_size Alter incoming chunk size aws Add AWS Metadata checklist Check records and flag them record_modifier modify record throttle Throttle messages using sliding window algorithm kubernetes Filter to append Kubernetes metadata modify modify records by applying rules multiline Concatenate multiline messages nest nest events by specified field values parser Parse events expect Validate expected keys and values grep grep events by specified field values rewrite_tag Rewrite records tags lua Lua Scripting Filter stdout Filter events to STDOUT geoip2 add geoip information to records ãƒ»stdoutãƒ—ãƒ©ã‚°ã‚¤ãƒ³ å‚è€ƒï¼šhttps://docs.fluentbit.io/manual/pipeline/filters/standard-output [FILTER] # ãƒ—ãƒ©ã‚°ã‚¤ãƒ³å Name stdout Match * ï¼Šã‚³ãƒãƒ³ãƒ‰ä¾‹ï¼Š $ fluent-bit/bin/fluent-bit \\ -i \\ -F stdout \\ -m '*' \\ -o null ï¼Šå®Ÿè¡Œãƒ­ã‚°ä¾‹ï¼Š Fluent Bit v1.8.6 * Copyright (C) 2019-2021 The Fluent Bit Authors * Copyright (C) 2015-2018 Treasure Data * Fluent Bit is a CNCF sub-project under the umbrella of Fluentd * https://fluentbit.io [2021/01/01 06:18:52] [ info] [engine] started (pid=40) [2021/01/01 06:18:52] [ info] [storage] version=1.1.1, initializing... [2021/01/01 06:18:52] [ info] [storage] in-memory [2021/01/01 06:18:52] [ info] [storage] normal synchronization mode, checksum disabled, max_chunks_up=128 [2021/01/01 06:18:52] [ info] [cmetrics] version=0.2.1 [2021/01/01 06:18:52] [ info] [sp] stream processor started [0] cpu.0: [1634710733.114477665, {\"cpu_p\"=>0.166667, \"user_p\"=>0.000000, \"system_p\"=>0.166667, \"cpu0.p_cpu\"=>0.000000, \"cpu0.p_user\"=>0.000000, \"cpu0.p_system\"=>0.000000, \"cpu1.p_cpu\"=>1.000000, \"cpu1.p_user\"=>0.000000, \"cpu1.p_system\"=>1.000000, \"cpu2.p_cpu\"=>0.000000, \"cpu2.p_user\"=>0.000000, \"cpu2.p_system\"=>0.000000, \"cpu3.p_cpu\"=>0.000000, \"cpu3.p_user\"=>0.000000, \"cpu3.p_system\"=>0.000000, \"cpu4.p_cpu\"=>0.000000, \"cpu4.p_user\"=>0.000000, \"cpu4.p_system\"=>0.000000, \"cpu5.p_cpu\"=>0.000000, \"cpu5.p_user\"=>0.000000, \"cpu5.p_system\"=>0.000000}] [0] cpu.0: [1634710734.115201385, {\"cpu_p\"=>0.333333, \"user_p\"=>0.166667, \"system_p\"=>0.166667, \"cpu0.p_cpu\"=>0.000000, \"cpu0.p_user\"=>0.000000, \"cpu0.p_system\"=>0.000000, \"cpu1.p_cpu\"=>0.000000, \"cpu1.p_user\"=>0.000000, \"cpu1.p_system\"=>0.000000, \"cpu2.p_cpu\"=>0.000000, \"cpu2.p_user\"=>0.000000, \"cpu2.p_system\"=>0.000000, \"cpu3.p_cpu\"=>0.000000, \"cpu3.p_user\"=>0.000000, \"cpu3.p_system\"=>0.000000, \"cpu4.p_cpu\"=>0.000000, \"cpu4.p_user\"=>0.000000, \"cpu4.p_system\"=>0.000000, \"cpu5.p_cpu\"=>0.000000, \"cpu5.p_user\"=>0.000000, \"cpu5.p_system\"=>0.000000}] [0] cpu.0: [1634710735.114646610, {\"cpu_p\"=>1.500000, \"user_p\"=>0.666667, \"system_p\"=>0.833333, \"cpu0.p_cpu\"=>0.000000, \"cpu0.p_user\"=>0.000000, \"cpu0.p_system\"=>0.000000, \"cpu1.p_cpu\"=>3.000000, \"cpu1.p_user\"=>2.000000, \"cpu1.p_system\"=>1.000000, \"cpu2.p_cpu\"=>2.000000, \"cpu2.p_user\"=>1.000000, \"cpu2.p_system\"=>1.000000, \"cpu3.p_cpu\"=>1.000000, \"cpu3.p_user\"=>0.000000, \"cpu3.p_system\"=>1.000000, \"cpu4.p_cpu\"=>1.000000, \"cpu4.p_user\"=>0.000000, \"cpu4.p_system\"=>1.000000, \"cpu5.p_cpu\"=>2.000000, \"cpu5.p_user\"=>1.000000, \"cpu5.p_system\"=>1.000000}] BUFFERã‚»ã‚¯ã‚·ãƒ§ãƒ³ ãƒ»BUFFERã‚»ã‚¯ã‚·ãƒ§ãƒ³ã¨ã¯ ãƒ­ã‚°ã¯ãƒãƒ£ãƒ³ã‚¯åŒ–ã•ã‚Œï¼Œãƒ¡ãƒ¢ãƒªï¼ãƒ•ã‚¡ã‚¤ãƒ«ã«ã‚ã‚‹ãƒãƒƒãƒ•ã‚¡ãƒ¼å†…ã®ã‚­ãƒ¥ãƒ¼ã«è“„ãˆã‚‰ã‚Œã‚‹ï¼ãƒãƒ£ãƒ³ã‚¯ã¯ã‚­ãƒ¥ãƒ¼ã‹ã‚‰å–ã‚Šå‡ºã•ã‚Œï¼Œã‚¿ãƒ¼ã‚²ãƒƒãƒˆã«è»¢é€ã•ã‚Œã‚‹ï¼Fluentdã‹ã‚‰æ¦‚å¿µå›³ã‚’æ‹å€Ÿã—ãŸï¼ å‚è€ƒï¼š https://docs.fluentbit.io/manual/administration/buffering-and-storage https://atmarkit.itmedia.co.jp/ait/articles/1402/06/news007.html ãƒ»ãƒ¡ãƒ¢ãƒªä¸Šã§ãƒãƒƒãƒ•ã‚¡ãƒªãƒ³ã‚° å‚è€ƒï¼šhttps://docs.fluentbit.io/manual/administration/buffering-and-storage#input-section-configuration ï¼Šå®Ÿè£…ä¾‹ï¼Š [SERVICE] flush 1 log_Level info [INPUT] name cpu # ãƒ¡ãƒ¢ãƒªä¸Šã§ãƒãƒƒãƒ•ã‚¡ãƒªãƒ³ã‚°ãŒå®Ÿè¡Œã•ã‚Œã‚‹ï¼ˆæ¨™æº–å€¤ï¼‰ï¼ storage.type memory ãƒ»ãƒ•ã‚¡ã‚¤ãƒ«ä¸Šã§ãƒãƒƒãƒ•ã‚¡ãƒªãƒ³ã‚° å‚è€ƒï¼šhttps://docs.fluentbit.io/manual/administration/buffering-and-storage#input-section-configuration ï¼Šå®Ÿè£…ä¾‹ï¼Š [SERVICE] flush 1 log_Level info # ãƒ•ã‚¡ã‚¤ãƒ«ã®å ´æ‰€ storage.path /var/log/fluentbit/ [INPUT] name cpu # ãƒ•ã‚¡ã‚¤ãƒ«ä¸Šã§ãƒãƒƒãƒ•ã‚¡ãƒªãƒ³ã‚°ãŒå®Ÿè¡Œã•ã‚Œã‚‹ï¼ storage.type filesystem æŒ‡å®šã—ãŸå ´æ‰€ã«cpu.0ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªãŒç”Ÿæˆã•ã‚Œï¼Œãã“ã«ã‚ã‚‹flbãƒ•ã‚¡ã‚¤ãƒ«ä¸Šã§ãƒãƒƒãƒ•ã‚¡ãƒªãƒ³ã‚°ãŒå®Ÿè¡Œã•ã‚Œã‚‹ï¼ $ ls -ls /var/log/fluentbit/cpu.0 -rw------- 1 root root 4096 Oct 20 15:51 1-1634745095.575805200.flb STREAM_TASKã‚»ã‚¯ã‚·ãƒ§ãƒ³ ãƒ»STREAM_TASKã‚»ã‚¯ã‚·ãƒ§ãƒ³ã¨ã¯ ãƒãƒ£ãƒ³ã‚¯åŒ–ã•ã‚ŒãŸãƒ­ã‚°ã«ã‚¿ã‚°ä»˜ã‘ã‚’è¡Œã†ï¼ã‚¿ã‚°ä»˜ã‘ã•ã‚ŒãŸãƒ­ã‚°ã¯ï¼Œãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã®INPUTã‚»ã‚¯ã‚·ãƒ§ãƒ³ã«å†åº¦å–ã‚Šè¾¼ã¾ã‚Œï¼Œå‡¦ç†ã—ç›´ã•ã‚Œã‚‹ï¼ å‚è€ƒï¼šhttps://docs.fluentbit.io/manual/stream-processing/overview#stream-processor STREAM_TASKã‚»ãƒƒã‚·ãƒ§ãƒ³ã¯ï¼Œãƒ­ã‚°SQLã§å®šç¾©ã•ã‚Œã‚‹ï¼ å‚è€ƒï¼šhttps://docs.fluentbit.io/manual/stream-processing/getting-started/fluent-bit-sql [STREAM_TASK] Name foo Exec CREATE STREAM foo AS SELECT * FROM TAG:'foo'; OUTPUT ãƒ»OUTPUTã‚»ã‚¯ã‚·ãƒ§ãƒ³ã¨ã¯ ãƒãƒ£ãƒ³ã‚¯ã¨ã—ã¦è“„ãˆã‚‰ã‚ŒãŸãƒ­ã‚°ã®å‡ºåŠ›å…ˆã‚’å®šç¾©ã™ã‚‹ï¼è¨­å®šå¯èƒ½ãªå‡ºåŠ›å…ˆã®ç¨®é¡ã«ã¤ã„ã¦ã¯ï¼Œä»¥ä¸‹ã‚’å‚è€ƒã«ã›ã‚ˆï¼ å‚è€ƒï¼šhttps://docs.fluentbit.io/manual/pipeline/outputs ã‚³ãƒãƒ³ãƒ‰ã®-oã‚ªãƒ—ã‚·ãƒ§ãƒ³ã§INPUTåã‚’æŒ‡å®šã—ï¼Œå®Ÿè¡Œã™ã‚‹ã“ã¨ã‚‚ã§ãã‚‹ï¼ Outputs azure Send events to Azure HTTP Event Collector azure_blob Azure Blob Storage bigquery Send events to BigQuery via streaming insert counter Records counter datadog Send events to DataDog HTTP Event Collector es Elasticsearch exit Exit after a number of flushes (test purposes) file Generate log file forward Forward (Fluentd protocol) http HTTP Output influxdb InfluxDB Time Series logdna LogDNA loki Loki kafka Kafka kafka-rest Kafka REST Proxy nats NATS Server nrlogs New Relic null Throws away events plot Generate data file for GNU Plot slack Send events to a Slack channel splunk Send events to Splunk HTTP Event Collector stackdriver Send events to Google Stackdriver Logging stdout Prints events to STDOUT syslog Syslog tcp TCP Output td Treasure Data flowcounter FlowCounter gelf GELF Output websocket Websocket cloudwatch_logs Send logs to Amazon CloudWatch kinesis_firehose Send logs to Amazon Kinesis Firehose kinesis_streams Send logs to Amazon Kinesis Streams prometheus_exporter Prometheus Exporter prometheus_remote_write Prometheus remote write s3 Send to S3 ãƒ»AWSã®ä»»æ„ã®ãƒªã‚½ãƒ¼ã‚¹ã«å‡ºåŠ› AWSã‹ã‚‰æä¾›ã•ã‚Œã‚‹ä»–ã®å…¨ã¦ã®FluentBitã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’æŸã­ãŸãƒ™ãƒ¼ã‚¹ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’ä½¿ç”¨ã™ã‚‹ï¼ å‚è€ƒï¼šhttps://github.com/aws/amazon-cloudwatch-logs-for-fluent-bit ãƒ»Cloudwatchãƒ­ã‚°ã¸ã®å‡ºåŠ› cloudwatch_logsãƒ—ãƒ©ã‚°ã‚¤ãƒ³ãŒã‚ã‚‰ã‹ã˜ã‚ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¦ã„ã‚‹ãƒ™ãƒ¼ã‚¹ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’ä½¿ç”¨ã™ã‚‹ï¼ å‚è€ƒï¼šhttps://github.com/aws/amazon-cloudwatch-logs-for-fluent-bit è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã«äºˆç´„ã•ã‚ŒãŸAWSå¤‰æ•°ã«ã¤ã„ã¦ã¯ï¼Œä»¥ä¸‹ã®ãƒªãƒ³ã‚¯ã‚’å‚è€ƒã«ã›ã‚ˆï¼ å‚è€ƒï¼šhttps://github.com/aws/amazon-cloudwatch-logs-for-fluent-bit#templating-log-group-and-stream-names ######################### # CloudWatchãƒ­ã‚°ã¸ã®è»¢é€ ######################### [OUTPUT] # ãƒ—ãƒ©ã‚°ã‚¤ãƒ³å Name cloudwatch_logs # è»¢é€å¯¾è±¡ã¨ã™ã‚‹ãƒ­ã‚°ã®ã‚¿ã‚° Match laravel # ã‚¢ã‚¦ãƒˆãƒ—ãƒƒãƒˆJSONã®ã†ã¡ï¼Œå®›å…ˆã«è»¢é€ã™ã‚‹ã‚­ãƒ¼å log_key log region ap-northeast-1 # äºˆç´„å¤‰æ•°ã‚ã‚Šï¼ log_group_name /prd-foo-ecs-container/laravel/log # ãƒ­ã‚°ã‚¹ãƒˆãƒªãƒ¼ãƒ åï¼äºˆç´„å¤‰æ•°ã‚ã‚Šï¼ã‚¿ã‚¹ã‚¯IDãªã©å‡ºåŠ›ã§ãã‚‹ï¼ log_stream_name container/laravel/$(ecs_task_id) [OUTPUT] Name cloudwatch_logs Match nginx log_key log region ap-northeast-1 log_group_name /prd-foo-ecs-container/nginx/log log_stream_name container/nginx/$(ecs_task_id) CloudWatchãƒ­ã‚°ã«é€ä¿¡ã•ã‚Œã‚‹ãƒ‡ãƒ¼ã‚¿ã¯JSONå‹ã§ã‚ã‚‹ï¼logã‚­ãƒ¼ã«ãƒ­ã‚°ãŒå‰²ã‚Šå½“ã¦ã‚‰ã‚Œã¦ã„ã‚‹ï¼ç‰¹å®šã®ã‚­ãƒ¼ã®å€¤ã®ã¿ã‚’CloudWatchãƒ­ã‚°ã«é€ä¿¡ã™ã‚‹å ´åˆï¼Œlog_keyã‚ªãƒ—ã‚·ãƒ§ãƒ³ã§ã‚­ãƒ¼åã‚’æŒ‡å®šã™ã‚‹ï¼ä¾‹ãˆã°ï¼Œlogã‚­ãƒ¼ã®ã¿ã‚’é€ä¿¡ã™ã‚‹å ´åˆï¼Œã€logã€ã¨æŒ‡å®šã™ã‚‹ï¼ å‚è€ƒï¼šhttps://blog.msysh.me/posts/2020/07/split_logs_into_multiple_target_with_firelens_and_rewrite_tag.html { \"container_id\": \"*****\", \"container_name\": \"prd-foo-ecs-container\", \"ecs_cluster\": \"prd-foo-ecs-cluster\", \"ecs_task_arn\": \"arn:aws:ecs:ap-northeast-1:****:task/cluster-name/*****\", \"ecs_task_definition\": \"prd-foo-ecs-task-definition:1\", \"log\": \"\", \"source\": \"stdout\", \"ver\": \"1.5\" } ãƒ»Datadogã¸ã®å‡ºåŠ› å…¨ã¦ã®ãƒ™ãƒ¼ã‚¹ã‚¤ãƒ¡ãƒ¼ã‚¸ã«æ¨™æº–ã§datadogãƒ—ãƒ©ã‚°ã‚¤ãƒ³ãŒã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¦ã„ã‚‹ãŸã‚ï¼Œdatadogãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã¯ä¸è¦ã§ã‚ã‚‹ï¼ å‚è€ƒï¼šhttps://github.com/DataDog/fluent-plugin-datadog ######################### # Datadogã¸ã®è»¢é€ ######################### [OUTPUT] # ãƒ—ãƒ©ã‚°ã‚¤ãƒ³å Name datadog # è»¢é€å¯¾è±¡ã¨ã™ã‚‹ãƒ­ã‚°ã®ã‚¿ã‚° Match laravel # è»¢é€å…ˆãƒ›ã‚¹ãƒˆ Host http-intake.logs.datadoghq.com TLS on compress gzip # Datadogã®APIã‚­ãƒ¼ï¼ apikey ***** # Datadogãƒ­ã‚°ã‚¨ã‚¯ã‚¹ãƒ—ãƒ­ãƒ¼ãƒ©ãƒ¼ã«ãŠã‘ã‚‹Serviceå dd_service prd-foo # Datadogãƒ­ã‚°ã‚¨ã‚¯ã‚¹ãƒ—ãƒ­ãƒ¼ãƒ©ãƒ¼ã«ãŠã‘ã‚‹Sourceå dd_source prd-foo dd_message_key log # è¿½åŠ ã‚¿ã‚° dd_tags env:prd-foo [OUTPUT] Name datadog Match nginx Host http-intake.logs.datadoghq.com TLS on compress gzip apikey ***** dd_service prd-foo dd_source prd-foo dd_message_key log dd_tags env:prd-foo ä»£ã‚ã‚Šã«ï¼ŒåŒã˜è¨­å®šã‚’FireLensã®logConfigurationã‚­ãƒ¼ã¨ã—ã¦ã‚‚é©ç”¨ã™ã‚‹ã“ã¨ã‚‚ã§ãã‚‹ï¼ å‚è€ƒï¼šhttps://github.com/aws-samples/amazon-ecs-firelens-examples/blob/mainline/examples/fluent-bit/datadog/README.md \"logConfiguration\": { \"logDriver\":\"awsfirelens\", \"options\": { \"Name\": \"datadog\", \"Host\": \"http-intake.logs.datadoghq.com\", \"TLS\": \"on\", \"apikey\": \"\", \"dd_service\": \"prd-foo\", \"dd_source\": \"prd-foo\", \"dd_tags\": \"env:prd-foo\", \"provider\": \"ecs\" } }, ãƒ»Kinesis Firehoseã¸ã®å‡ºåŠ› kinesis_firehoseãƒ—ãƒ©ã‚°ã‚¤ãƒ³ãŒã‚ã‚‰ã‹ã˜ã‚ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¦ã„ã‚‹ãƒ™ãƒ¼ã‚¹ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’ä½¿ç”¨ã™ã‚‹ï¼ å‚è€ƒï¼šhttps://github.com/aws/amazon-kinesis-firehose-for-fluent-bit ãƒ»Kinesis Streamsã¸ã®å‡ºåŠ› kinesis_streamsãƒ—ãƒ©ã‚°ã‚¤ãƒ³ãŒã‚ã‚‰ã‹ã˜ã‚ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¦ã„ã‚‹ãƒ™ãƒ¼ã‚¹ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’ä½¿ç”¨ã™ã‚‹ï¼ å‚è€ƒï¼šhttps://github.com/aws/amazon-kinesis-streams-for-fluent-bit ãƒ»NewRelicã¸ã®å‡ºåŠ› newRelicãƒ—ãƒ©ã‚°ã‚¤ãƒ³ãŒã‚ã‚‰ã‹ã˜ã‚ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¦ã„ã‚‹ãƒ™ãƒ¼ã‚¹ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’ä½¿ç”¨ã™ã‚‹ï¼ å‚è€ƒï¼šhttps://github.com/newrelic/newrelic-fluent-bit-output ãƒ»æ¨™æº–å‡ºåŠ›ã¸ã®å‡ºåŠ› æ¨™æº–å‡ºåŠ›ã«å‡ºåŠ›ã™ã‚‹ï¼ŒFluentBitã®å®Ÿè¡Œãƒ­ã‚°ã§ã“ã‚Œã‚’ç¢ºèªã§ãã‚‹ï¼ [OUTPUT] Name stdout match * ãƒ»ç ´æ£„ å‡ºåŠ›ã‚’ç ´æ£„ã™ã‚‹ï¼ å‚è€ƒï¼šhttps://docs.fluentbit.io/manual/pipeline/outputs/null ï¼Šå®Ÿè£…ä¾‹ï¼Š [OUTPUT] Name null match * ï¼Šã‚³ãƒãƒ³ãƒ‰ä¾‹ï¼Š $ fluent-bit/bin/fluent-bit \\ -i \\ -F stdout \\ -m '*' \\ -o null 03. Fargateã‚³ãƒ³ãƒ†ãƒŠã‹ã‚‰ã®ãƒ­ã‚°åé›† FireLensã‚³ãƒ³ãƒ†ãƒŠ ãƒ»FireLensã‚³ãƒ³ãƒ†ãƒŠã¨ã¯ AWSãŒæä¾›ã™ã‚‹FluentBitï¼Fluentdã‚¤ãƒ¡ãƒ¼ã‚¸ã«ã‚ˆã£ã¦æ§‹ç¯‰ã•ã‚Œã‚‹ã‚³ãƒ³ãƒ†ãƒŠã§ã‚ã‚Šï¼ŒFargateã‚³ãƒ³ãƒ†ãƒŠã®ã‚µã‚¤ãƒ‰ã‚«ãƒ¼ã‚³ãƒ³ãƒ†ãƒŠã¨ã—ã¦é…ç½®ã•ã‚Œã‚‹ï¼Fargateã‚³ãƒ³ãƒ†ãƒŠã‹ã‚‰ãƒ­ã‚°ãŒé€ä¿¡ã•ã‚Œã‚‹ã¨ï¼Œã‚³ãƒ³ãƒ†ãƒŠå†…ã§ç¨¼åƒã™ã‚‹FluentBitï¼FluentdãŒã“ã‚Œã‚’åé›†ã—ï¼Œã“ã‚Œã‚’ä»–ã®ã‚µãƒ¼ãƒ“ã‚¹ã«è»¢é€ã™ã‚‹ï¼æ§‹ç¯‰ã®ãŸã‚ã®å®Ÿè£…ä¾‹ã«ã¤ã„ã¦ã¯ï¼Œä»¥ä¸‹ã®ãƒªãƒ³ã‚¯ã‚’å‚è€ƒã«ã›ã‚ˆï¼ å‚è€ƒï¼š https://github.com/aws-samples/amazon-ecs-firelens-examples https://aws.amazon.com/jp/blogs/news/announcing-firelens-a-new-way-to-manage-container-logs/ ãƒ»ãƒ­ã‚°ã®è»¢é€å…ˆ FluentBitï¼FluentdãŒå¯¾å¿œã™ã‚‹ä»–ã®ã‚µãƒ¼ãƒ“ã‚¹ã«ãƒ­ã‚°ã‚’è»¢é€ã§ãã‚‹ï¼ å‚è€ƒï¼šhttps://docs.fluentbit.io/manual/pipeline/outputs ã‚µã‚¤ãƒ‰ã‚«ãƒ¼ã‚³ãƒ³ãƒ†ãƒŠãƒ‘ã‚¿ãƒ¼ãƒ³ ãƒ»ã‚µã‚¤ãƒ‰ã‚«ãƒ¼ã‚³ãƒ³ãƒ†ãƒŠãƒ‘ã‚¿ãƒ¼ãƒ³ã¨ã¯ ã‚µã‚¤ãƒ‰ã‚«ãƒ¼ã‚³ãƒ³ãƒ†ãƒŠãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’å«ã‚€ã‚³ãƒ³ãƒ†ãƒŠãƒ‡ã‚¶ã‚¤ãƒ³ãƒ‘ã‚¿ãƒ¼ãƒ³ã«ã¤ã„ã¦ã¯ï¼Œä»¥ä¸‹ã®ãƒªãƒ³ã‚¯ã‚’å‚è€ƒã«ã›ã‚ˆï¼ å‚è€ƒï¼šhttps://hiroki-it.github.io/tech-notebook-gitbook/public/virtualization/virtualization_container_orchestration.html ãƒ»ãƒ­ã‚°ã®åé›†ï¼è»¢é€ã®ä»•çµ„ã¿ ä»¥ä¸‹ã®é †ç•ªã§ãƒ­ã‚°ã®åé›†ï¼è»¢é€ã‚’å®Ÿè¡Œã™ã‚‹ï¼ å‚è€ƒï¼šhttps://aws.amazon.com/jp/blogs/news/under-the-hood-firelens-for-amazon-ecs-tasks/ awsfirelensãƒ‰ãƒ©ã‚¤ãƒãƒ¼ã¯Fluentdãƒ­ã‚°ãƒ‰ãƒ©ã‚¤ãƒãƒ¼ã‚’ãƒ©ãƒƒãƒ”ãƒ³ã‚°ã—ãŸã‚‚ã®ã§ã‚ã‚Šï¼Œãƒ­ã‚°ã‚’FireLensã‚³ãƒ³ãƒ†ãƒŠã«é€ä¿¡ã™ã‚‹ï¼Fluentdãƒ­ã‚°ãƒ‰ãƒ©ã‚¤ãƒãƒ¼ã«ã¤ã„ã¦ã¯ï¼Œä»¥ä¸‹ã‚’å‚è€ƒã«ã›ã‚ˆï¼ å‚è€ƒï¼šhttps://docs.docker.com/config/containers/logging/fluentd/ FireLensã‚³ãƒ³ãƒ†ãƒŠã¯ï¼Œã“ã‚Œã‚’å—ä¿¡ã™ã‚‹ï¼ ã‚³ãƒ³ãƒ†ãƒŠå†…ã§ç¨¼åƒã™ã‚‹FluentBitã®ãƒ­ã‚°ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã®INPUTã«æ¸¡ã•ã‚Œï¼ŒFluentBitã¯ãƒ­ã‚°ã‚’å‡¦ç†ã™ã‚‹ï¼ OUTPUTã‚»ã‚¯ã‚·ãƒ§ãƒ³ã«æ¸¡ã•ã‚Œï¼ŒFluentBitã¯æŒ‡å®šã—ãŸå¤–éƒ¨ã‚µãƒ¼ãƒ“ã‚¹ã«ãƒ­ã‚°ã‚’è»¢é€ã™ã‚‹ï¼ ãƒ»ãƒ­ã‚°è»¢é€ãƒ—ãƒ­ã‚»ã‚¹ FireLensã‚³ãƒ³ãƒ†ãƒŠã§ã¯ï¼ŒFluentBitã¾ãŸã¯FlunetdãŒãƒ­ã‚°è»¢é€ãƒ—ãƒ­ã‚»ã‚¹ã¨ã—ã¦ç¨¼åƒã™ã‚‹ï¼FireLensã‚³ãƒ³ãƒ†ãƒŠã‚’ä½¿ç”¨ã›ãšã«ï¼Œç‹¬è‡ªã®ã‚³ãƒ³ãƒ†ãƒŠã‚’æ§‹ç¯‰ã—ã¦ç¨¼åƒã•ã›ã‚‹ã“ã¨ã‚‚å¯èƒ½ã§ã‚ã‚‹ãŒï¼ŒFireLensã‚³ãƒ³ãƒ†ãƒŠã‚’ä½¿ç”¨ã™ã‚Œã°ï¼Œä¸»è¦ãªã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ãŒã•ã‚Œã¦ã„ã‚‹ãŸã‚ï¼Œã‚ˆã‚Šç°¡å˜ãªè¨­å®šã§FluentBitã¾ãŸã¯Flunetdã‚’ä½¿ç”¨ã§ãã‚‹ï¼FluentBitã®æ–¹ãŒã‚ˆã‚Šä½è² è·ã§ç¨¼åƒã™ã‚‹ãŸã‚ï¼ŒFluentBitãŒæ¨å¥¨ã•ã‚Œã¦ã„ã‚‹ï¼ å‚è€ƒï¼š https://aws.amazon.com/jp/blogs/news/under-the-hood-firelens-for-amazon-ecs-tasks/ https://docs.aws.amazon.com/ja_jp/AmazonECS/latest/userguide/using_firelens.html ãƒ™ãƒ¼ã‚¹ã‚¤ãƒ¡ãƒ¼ã‚¸ ãƒ»FluentBitã‚¤ãƒ¡ãƒ¼ã‚¸ FireLensã‚³ãƒ³ãƒ†ãƒŠã®ãƒ™ãƒ¼ã‚¹ã‚¤ãƒ¡ãƒ¼ã‚¸ã¨ãªã‚‹FluentBitã‚¤ãƒ¡ãƒ¼ã‚¸ãŒAWSã‹ã‚‰æä¾›ã•ã‚Œã¦ã„ã‚‹ï¼AWSãƒªã‚½ãƒ¼ã‚¹ã«ãƒ­ã‚°ã‚’è»¢é€ã™ã‚‹ãŸã‚ã®ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ãŒã™ã§ã«å«ã¾ã‚Œã¦ã„ã‚‹ï¼ãªãŠï¼ŒDatadogãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã¯FluentBitè‡ªä½“ã«ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æ¸ˆã¿ã§ã‚ã‚‹ï¼ãƒ‘ãƒ–ãƒªãƒƒã‚¯ECRãƒªãƒã‚¸ãƒˆãƒªã‹ã‚‰ãƒ—ãƒ«ã—ãŸã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’ãã®ã¾ã¾ä½¿ç”¨ã™ã‚‹å ´åˆã¨ï¼Œãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆECRãƒªãƒã‚¸ãƒˆãƒªã§å†ç®¡ç†ã—ã¦ã‹ã‚‰ä½¿ç”¨ã™ã‚‹å ´åˆãŒã‚ã‚‹ï¼ å‚è€ƒï¼šhttps://docs.aws.amazon.com/ja_jp/AmazonECS/latest/developerguide/firelens-using-fluentbit.html [/fluent-bit]$ ls -la -rw-r--r-- 1 root root 26624256 Sep 1 18:04 cloudwatch.so # æ—§cloudwatch_logsãƒ—ãƒ©ã‚°ã‚¤ãƒ³ -rw-r--r-- 1 root root 26032656 Sep 1 18:04 firehose.so # kinesis_firehoseãƒ—ãƒ©ã‚°ã‚¤ãƒ³ -rw-r--r-- 1 root root 30016544 Sep 1 18:03 kinesis.so # kinesis_streamsãƒ—ãƒ©ã‚°ã‚¤ãƒ³ ... ãƒ»ãƒ‘ãƒ–ãƒªãƒƒã‚¯ECRãƒªãƒã‚¸ãƒˆãƒªã‚’ä½¿ç”¨ã™ã‚‹å ´åˆ ECSã®ã‚³ãƒ³ãƒ†ãƒŠå®šç¾©ã«ã¦ï¼Œãƒ‘ãƒ–ãƒªãƒƒã‚¯ECRãƒªãƒã‚¸ãƒˆãƒªã®URLã‚’æŒ‡å®šã—ï¼ŒECRã‚¤ãƒ¡ãƒ¼ã‚¸ã®ãƒ—ãƒ«ã‚’å®Ÿè¡Œã™ã‚‹ï¼æ¨™æº–ã§å†…è”µã•ã‚Œã¦ã„ã‚‹confãƒ•ã‚¡ã‚¤ãƒ«ã®è¨­å®šã‚’ãã®ã¾ã¾ä½¿ç”¨ã™ã‚‹å ´åˆã¯ï¼Œã“ã¡ã‚‰ã‚’æ¡ç”¨ã™ã‚‹ï¼ å‚è€ƒï¼šhttps://docs.aws.amazon.com/ja_jp/AmazonECS/latest/developerguide/firelens-using-fluentbit.html#firelens-image-ecr ãƒ»ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆECRãƒªãƒã‚¸ãƒˆãƒªã‚’ä½¿ç”¨ã™ã‚‹å ´åˆ ã‚ã‚‰ã‹ã˜ã‚ï¼ŒDockerHubã‹ã‚‰FluentBitã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’ãƒ—ãƒ«ã™ã‚‹ãŸã‚ã®Dockerfileã‚’ä½œæˆã—ï¼Œãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆECRãƒªãƒã‚¸ãƒˆãƒªã«ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’ãƒ—ãƒƒã‚·ãƒ¥ã—ã¦ãŠãï¼ECSã®ã‚³ãƒ³ãƒ†ãƒŠå®šç¾©ã«ã¦ï¼Œãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆECRãƒªãƒã‚¸ãƒˆãƒªã®URLã‚’æŒ‡å®šã—ï¼ŒECRã‚¤ãƒ¡ãƒ¼ã‚¸ã®ãƒ—ãƒ«ã‚’å®Ÿè¡Œã™ã‚‹ï¼æ¨™æº–ã§å†…è”µã•ã‚Œã¦ã„ã‚‹confãƒ•ã‚¡ã‚¤ãƒ«ã®è¨­å®šã‚’ä¸Šæ›¸ãã—ãŸã„å ´åˆã¯ï¼Œã“ã¡ã‚‰ã‚’æ¡ç”¨ã™ã‚‹ï¼ FROM amazon/aws-for-fluent-bit:latest å‚è€ƒï¼š https://hub.docker.com/r/amazon/aws-for-fluent-bit https://github.com/aws/aws-for-fluent-bit https://docs.aws.amazon.com/ja_jp/AmazonECS/latest/developerguide/firelens-using-fluentbit.html#firelens-image-dockerhub æ¨™æº–è¨­å®šã®ä¸Šæ›¸ã ãƒ»æ¨™æº–è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã®ç¨®é¡ aws-for-fluent-bitã‚¤ãƒ¡ãƒ¼ã‚¸ã®/fluent-bit/etcãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ã¯æ¨™æº–ã§è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ãŒç”¨æ„ã•ã‚Œã¦ã„ã‚‹ï¼è¿½åŠ è¨­å®šã‚’å®Ÿè¡Œã™ã‚‹ãƒ•ã‚¡ã‚¤ãƒ«ã¯ã“ã“ã«é…ç½®ã™ã‚‹ï¼ [/fluent-bit/etc]$ ls -la -rw-r--r-- 1 root root 251 Sep 1 17:57 fluent-bit.conf -rw-r--r-- 1 root root 1564 Sep 27 02:15 fluent-bit_custom.conf # è¿½åŠ è¨­å®šç”¨ -rw-r--r-- 1 root root 4664 Sep 1 18:07 parsers.conf -rw-r--r-- 1 root root 584 Sep 1 18:07 parsers_ambassador.conf -rw-r--r-- 1 root root 226 Sep 1 18:07 parsers_cinder.conf -rw-r--r-- 1 root root 2798 Sep 1 18:07 parsers_extra.conf -rw-r--r-- 1 root root 240 Sep 1 18:07 parsers_java.conf -rw-r--r-- 1 root root 845 Sep 1 18:07 parsers_mult.conf -rw-r--r-- 1 root root 291 Sep 27 02:15 parsers_multiline.conf -rw-r--r-- 1 root root 2954 Sep 1 18:07 parsers_openstack.conf -rw-r--r-- 1 root root 579 Sep 27 02:15 stream_processor.conf # è¿½åŠ è¨­å®šç”¨ FireLensã‚³ãƒ³ãƒ†ãƒŠã®/fluent-bit/etc/fluent-bit.confãƒ•ã‚¡ã‚¤ãƒ«ã¯ä»¥ä¸‹ã®é€šã‚Šã¨ãªã‚Šï¼Œãƒ­ãƒ¼ã‚«ãƒ«PCã§FluentBitã‚³ãƒ³ãƒ†ãƒŠã‚’èµ·å‹•ã—ãŸå ´åˆã¨ç•°ãªã‚‹æ§‹æˆã«ãªã£ã¦ã„ã‚‹ã“ã¨ã«æ³¨æ„ã™ã‚‹ï¼ å‚è€ƒï¼šhttps://dev.classmethod.jp/articles/check-fluent-bit-conf/ [INPUT] Name tcp Listen 127.0.0.1 Port 8877 Tag firelens-healthcheck [INPUT] Name forward unix_path /var/run/fluent.sock [INPUT] Name forward Listen 127.0.0.1 Port 24224 [FILTER] Name record_modifier Match * Record ecs_cluster sample-test-cluster Record ecs_task_arn arn:aws:ecs:ap-northeast-1:123456789012:task/sample-test-cluster/d4efc1a0fdf7441e821a3683836ad69a Record ecs_task_definition sample-test-webapp-taskdefinition:15 [OUTPUT] Name null Match firelens-healthcheck ãƒ»fluent-bit_custom.confãƒ•ã‚¡ã‚¤ãƒ« FireLensã‚³ãƒ³ãƒ†ãƒŠã®/fluent-bit/etc/fluent-bit.confãƒ•ã‚¡ã‚¤ãƒ«ã‚’ï¼Œã‚³ãƒ³ãƒ†ãƒŠå®šç¾©ã®config-file-valueã‚­ãƒ¼ã§æŒ‡å®šã—ï¼Œè¿½åŠ è¨­å®šã‚’å®Ÿè¡Œã™ã‚‹ï¼ã“ã‚Œã«ã‚ˆã‚Šï¼ŒFireLensã‚³ãƒ³ãƒ†ãƒŠã«INCLUDEæ–‡ãŒæŒ¿å…¥ã•ã‚Œã‚‹ï¼ å‚è€ƒï¼šhttps://dev.classmethod.jp/articles/check-fluent-bit-conf/ [INPUT] Name tcp Listen 127.0.0.1 Port 8877 Tag firelens-healthcheck [INPUT] Name forward unix_path /var/run/fluent.sock [INPUT] Name forward Listen 127.0.0.1 Port 24224 [FILTER] Name record_modifier Match * Record ecs_cluster prd-foo-ecs-cluster Record ecs_task_arn arn:aws:ecs:ap-northeast-1::task/prd-foo-ecs-cluster/***** Record ecs_task_definition prd-foo-ecs-task-definition:1 # INCLUDEæ–‡ãŒæŒ¿å…¥ã•ã‚Œã‚‹ï¼ãƒ¦ãƒ¼ã‚¶å®šç¾©ã®è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ãŒèª­ã¿è¾¼ã¾ã‚Œã‚‹ï¼ @INCLUDE /fluent-bit/etc/fluent-bit_custom.conf [OUTPUT] Name laravel Match laravel-firelens* [OUTPUT] Name nginx Match nginx-firelens* ã¡ãªã¿ã«ï¼Œæ¨™æº–ã®è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã«ã¯ï¼ŒINPUTã‚»ã‚¯ã‚·ãƒ§ãƒ³ãŒã™ã§ã«å®šç¾©ã•ã‚Œã¦ã„ã‚‹ãŸã‚ï¼Œfluent-bit_custom.confãƒ•ã‚¡ã‚¤ãƒ«ã§ã¯INPUTã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚’å®šç¾©ã—ãªãã¦ã‚‚å•é¡Œãªã„ï¼ å‚è€ƒï¼šhttps://github.com/aws/aws-for-fluent-bit/blob/mainline/fluent-bit.conf [INPUT] Name forward Listen 0.0.0.0 Port 24224 [OUTPUT] Name cloudwatch Match ** region us-east-1 log_group_name fluent-bit-cloudwatch log_stream_prefix from-fluent-bit- auto_create_group true ãƒ»stream_processor.confãƒ•ã‚¡ã‚¤ãƒ« STREAM_TASKã‚»ã‚¯ã‚·ãƒ§ãƒ³ã«ã¦ï¼Œãƒ­ã‚°ã®ã‚¿ã‚°ä»˜ã‘ã‚’å®šç¾©ã™ã‚‹ï¼FireLensã‚³ãƒ³ãƒ†ãƒŠã®ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã§ã¯ï¼Œã€-firelens-ã€ã¨ã„ã†åå‰ã§ãƒ­ã‚°ãŒå‡¦ç†ã•ã‚Œã¦ã„ã‚‹ï¼ãã®ãŸã‚ï¼ŒStream Processorã§ãƒ­ã‚°ã‚’æŠ½å‡ºã™ã‚‹ãŸã‚ã«ã¯ï¼Œã‚¯ã‚¨ãƒªã§ã€FROM TAG:'*-firelens-*'ã€ã‚’æŒ‡å®šã™ã‚‹å¿…è¦ãŒã‚ã‚‹ï¼ã¡ãªã¿ã«ï¼ŒSTREAM_TASKã‚»ã‚¯ã‚·ãƒ§ãƒ³ã§ã‚¿ã‚°ä»˜ã‘ã•ã‚ŒãŸãƒ­ã‚°ã¯ï¼ŒINPUTã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‹ã‚‰å†ã³å‡¦ç†ã—ç›´ã•ã‚Œã‚‹ï¼ å‚è€ƒï¼šhttps://aws.amazon.com/jp/blogs/news/under-the-hood-firelens-for-amazon-ecs-tasks/ # appã‚³ãƒ³ãƒ†ãƒŠã®ãƒ­ã‚°ã¸ã®ã‚¿ã‚°ä»˜ã‘ [STREAM_TASK] Name laravel Exec CREATE STREAM web WITH (tag='laravel') AS SELECT log FROM TAG:'*-firelens-*' WHERE container_name = 'laravel'; # webã‚³ãƒ³ãƒ†ãƒŠã®ãƒ­ã‚°ã¸ã®ã‚¿ã‚°ä»˜ã‘ [STREAM_TASK] Name nginx Exec CREATE STREAM web WITH (tag='nginx') AS SELECT log FROM TAG:'*-firelens-*' WHERE container_name = 'nginx'; # å…¨ã¦ã®ã‚³ãƒ³ãƒ†ãƒŠã®ãƒ­ã‚°ã¸ã®ã‚¿ã‚°ä»˜ã‘ [STREAM_TASK] Name containers Exec CREATE STREAM container WITH (tag='containers') AS SELECT * FROM TAG:'*-firelens-*'; [SERVICE] Flush 1 Grace 30 Log_Level info # ãƒ•ã‚¡ã‚¤ãƒ«ã‚’èª­ã¿è¾¼ã‚€ Parsers_File parsers_multiline.conf Streams_File stream_processor.conf ãƒ»parsers_multiline.confãƒ•ã‚¡ã‚¤ãƒ« MULTILINE_PARSERã‚»ã‚¯ã‚·ãƒ§ãƒ³ã«ã¦ï¼Œã‚¹ã‚¿ãƒƒã‚¯ãƒˆãƒ¬ãƒ¼ã‚¹ãƒ­ã‚°ã®å„è¡Œã®çµåˆã‚’å®šç¾©ã™ã‚‹ï¼ å‚è€ƒï¼šhttps://github.com/aws-samples/amazon-ecs-firelens-examples/blob/mainline/examples/fluent-bit/filter-multiline/README.md [MULTILINE_PARSER] name laravel type regex flush_timeout 1000 rule \"start_state\" \"/(Dec \\d+ \\d+\\:\\d+\\:\\d+)(.*)/\" \"cont\" rule \"cont\" \"/^\\s+at.*/\" \"cont\" [SERVICE] flush 1 log_level info parsers_file /parsers_multiline.conf [FILTER] name multiline match * multiline.key_content log # ãƒ•ã‚¡ã‚¤ãƒ«ã‚’èª­ã¿è¾¼ã‚€ï¼çµ„ã¿è¾¼ã¿ãƒ‘ãƒ¼ã‚µï¼ˆgoãªã©ï¼‰ã‚’ä½¿ç”¨ã™ã‚‹ã“ã¨ã‚‚å¯èƒ½ï¼ multiline.parser go, laravel FireLensã‚³ãƒ³ãƒ†ãƒŠã®ã‚³ãƒ³ãƒ†ãƒŠå®šç¾© ãƒ»å…¨ä½“ [ { \"name\": \"\", \"image\": \"\", \"essential\": true, \"portMappings\": [ { \"containerPort\": 80, \"hostPort\": 80, \"protocol\": \"tcp\" } ], \"logConfiguration\": { \"logDriver\": \"awsfirelens\", \"options\": { \"Name\": \"forward\" } } }, { # FireLensã‚³ãƒ³ãƒ†ãƒŠåãŒlog_routerã¨ãªã‚‹ã“ã¨ã¯å›ºå®š \"name\": \"log_router\", \"image\": \"\", \"essential\": false, \"logConfiguration\": { \"logDriver\": \"awslogs\", \"options\": { # FireLensã‚³ãƒ³ãƒ†ãƒŠè‡ªä½“ãŒCloudWatchãƒ­ã‚°ã«ãƒ­ã‚°å‡ºåŠ› \"awslogs-group\": \"\", \"awslogs-region\": \"\", \"awslogs-stream-prefix\": \"\" } }, \"firelensConfiguration\": { # FireLensã‚³ãƒ³ãƒ†ãƒŠã§FluentBitã‚’ç¨¼åƒã•ã›ã‚‹ \"type\": \"fluentbit\", \"options\": { \"config-file-type\": \"file\", # è¨­å®šä¸Šæ›¸ãã®ãŸã‚èª­ã¿è¾¼ã¿ \"config-file-value\": \"/fluent-bit/etc/fluent-bit_custom.conf\" # ECSã®æƒ…å ±ã‚’FireLensã«é€ä¿¡ã™ã‚‹ã‹ã©ã†ã‹ \"enable-ecs-log-metadata\": \"true\" } }, \"portMappings\": [], \"memoryReservation\": 50, \"secrets\": [ { \"name\": \"DD_API_KEY\", \"valueFrom\": \"\" }, { \"name\": \"DD_ENV\", \"valueFrom\": \"\" } ] } ] ãƒ»name FireLensã‚³ãƒ³ãƒ†ãƒŠã‚’ã‚µã‚¤ãƒ‰ã‚«ãƒ¼ã¨ã—ã¦æ§‹ç¯‰ã™ã‚‹ãŸã‚ã«ï¼Œã‚³ãƒ³ãƒ†ãƒŠå®šç¾©ã‚’å®Ÿè£…ã™ã‚‹ï¼FireLensã‚³ãƒ³ãƒ†ãƒŠã¯ã€log_routeterã€ã¨ã™ã‚‹ï¼ ãƒ»logConfiguration å‚è€ƒï¼šhttps://docs.aws.amazon.com/ja_jp/AmazonECS/latest/userguide/firelens-example-taskdefs.html#firelens-example-forward é …ç›® èª¬æ˜ type ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒŠã‹ã‚‰FireLensã‚³ãƒ³ãƒ†ãƒŠã«ãƒ­ã‚°ã‚’é€ä¿¡ã§ãã‚‹ã‚ˆã†ã«ï¼Œãƒ­ã‚°ãƒ‰ãƒ©ã‚¤ãƒãƒ¼ã®ã‚¿ã‚¤ãƒ—ã¨ã—ã¦ã€fluentbitã€ã‚’è¨­å®šã™ã‚‹ï¼ config-file-type FluentBitã®è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã‚’èª­ã¿è¾¼ã‚€ãŸã‚ã«ï¼Œfileã¨ã™ã‚‹ï¼ config-file-value optionsã‚­ãƒ¼ã«ã¦ï¼Œãƒ­ã‚°è»¢é€æ™‚ã®è¨­å®šãŒå¯èƒ½ã§ã‚ã‚‹ãŒï¼Œãã‚Œã‚‰ã¯fluent-bit.confãƒ•ã‚¡ã‚¤ãƒ«ã«ã‚‚è¨­å®šå¯èƒ½ã§ã‚ã‚‹ãŸã‚ï¼Œè»¢é€ã®è¨­å®šã¯ã§ãã‚‹ã ã‘fluent-bit.confãƒ•ã‚¡ã‚¤ãƒ«ã«å®Ÿè£…ã™ã‚‹ï¼FireLensã‚³ãƒ³ãƒ†ãƒŠè‡ªä½“ã®ãƒ­ã‚°ã¯ï¼ŒCloudWatchãƒ­ã‚°ã«é€ä¿¡ã™ã‚‹ã‚ˆã†ã«è¨­å®šã—ï¼Œãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒŠã‹ã‚‰å—ä¿¡ã—ãŸãƒ­ã‚°ã¯ç›£è¦–ãƒ„ãƒ¼ãƒ«ï¼ˆDatadogãªã©ï¼‰ã«è»¢é€ã™ã‚‹ï¼ enable-ecs-log-metadataï¼ˆæ¨™æº–ã§æœ‰åŠ¹åŒ–ï¼‰ æœ‰åŠ¹ã«ã—ãŸå ´åˆï¼ŒDatadogã®ãƒ­ã‚°ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã§ï¼Œä¾‹ãˆã°ä»¥ä¸‹ã®ã‚ˆã†ãªã‚¿ã‚°ãŒä»˜ã‘ã‚‰ã‚Œã‚‹ï¼åå¯¾ã«ç„¡åŠ¹ã«ã—ãŸå ´åˆï¼Œä»¥ä¸‹ã®ã‚ˆã†ãªã‚¿ã‚°ãŒä»˜ã‘ã‚‰ã‚Œã‚‹ï¼å‚è€ƒï¼šhttps://tech.spacely.co.jp/entry/2020/11/28/173356 environmentï¼Œsecrets ã‚³ãƒ³ãƒ†ãƒŠå†…ã®fluent-bit.confãƒ•ã‚¡ã‚¤ãƒ«ã«å¤‰æ•°ã‚’å‡ºåŠ›ã§ãã‚‹ã‚ˆã†ã«ï¼Œã‚³ãƒ³ãƒ†ãƒŠã®ç’°å¢ƒå¤‰æ•°ã«å€¤ã‚’å®šç¾©ã™ã‚‹ï¼ "},"public/observability_monitering/observability_datadog_metrics.html":{"url":"public/observability_monitering/observability_datadog_metrics.html","title":"ğŸ“– ï¸ãƒ¡ãƒˆãƒªã‚¯ã‚¹åé›†","keywords":"","body":"ãƒ¡ãƒˆãƒªã‚¯ã‚¹åé›† ã¯ã˜ã‚ã« æœ¬ã‚µã‚¤ãƒˆã«ã¤ãã¾ã—ã¦ï¼Œä»¥ä¸‹ã‚’ã”èªè­˜ã®ã»ã©å®œã—ããŠé¡˜ã„ã„ãŸã—ã¾ã™ï¼ å‚è€ƒï¼šhttps://hiroki-it.github.io/tech-notebook-gitbook/ 01. Ec2ã«ãŠã‘ã‚‹ãƒ¡ãƒˆãƒªã‚¯ã‚¹åé›† Datadogã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆ on EC2ã¨ã¯ ãƒ»Datadogã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆ on EC2ã¨ã¯ å¸¸é§ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã§ã‚ã‚Šï¼Œã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ãƒ¡ãƒˆãƒªã‚¯ã‚¹ã‚’åé›†ã—ï¼ŒDatadogã«è»¢é€ã™ã‚‹ï¼ å‚è€ƒï¼šhttps://docs.datadoghq.com/ja/agent/amazon_ecs/?tab=awscli 02. Fargateã«ãŠã‘ã‚‹ãƒ¡ãƒˆãƒªã‚¯ã‚¹åé›† Datadogã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆ on Fargate ãƒ»Datadogã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆ on Fargateã¨ã¯ å¸¸é§ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã§ã‚ã‚Šï¼Œã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‹ã‚‰ãƒ¡ãƒˆãƒªã‚¯ã‚¹ã‚’Datadogã«è»¢é€ã™ã‚‹ï¼EC2ç”¨ã®Datadogã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã¨ã¯ç•°ãªã‚Šï¼Œãƒ­ã‚°ã¯è»¢é€ã—ãªã„ï¼ å‚è€ƒï¼šhttps://docs.datadoghq.com/ja/integrations/ecs_fargate/?tab=fluentbitandfirelens#%E3%82%BB%E3%83%83%E3%83%88%E3%82%A2%E3%83%83%E3%83%97 ãƒ»ç’°å¢ƒå¤‰æ•° ã‚°ãƒ­ãƒ¼ãƒãƒ«ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã¨ã—ã¦å½¹ç«‹ã¤ç’°å¢ƒå¤‰æ•°ã‚’ä»¥ä¸‹ã«ç¤ºã™ï¼ å‚è€ƒï¼šhttps://docs.datadoghq.com/ja/agent/docker/?tab=%E6%A8%99%E6%BA%96#%E3%82%B0%E3%83%AD%E3%83%BC%E3%83%90%E3%83%AB%E3%82%AA%E3%83%97%E3%82%B7%E3%83%A7%E3%83%B3 å¤‰æ•°å èª¬æ˜ è£œè¶³ Datadogã‚³ãƒ³ã‚½ãƒ¼ãƒ«URL DD_API_KEY Datadogã‚³ãƒ³ãƒ†ãƒŠãŒã‚ã‚‰ã‚†ã‚‹ãƒ‡ãƒ¼ã‚¿ã‚’Datadogã«é€ä¿¡ã™ã‚‹ãŸã‚ã«å¿…è¦ã§ã‚ã‚‹ï¼ DD_ENV APMã‚’ç”¨ã„ã‚‹å ´åˆã«ï¼Œã‚µãƒ¼ãƒ“ã‚¹ã‚„ãƒˆãƒ¬ãƒ¼ã‚¹ç”»é¢ã«ã¦ï¼Œenvã‚¿ã‚°ã«å€¤ã‚’è¨­å®šã™ã‚‹ï¼ ã‚µãƒ¼ãƒ“ã‚¹å˜ä½ã§çµã‚Šè¾¼ã‚ã‚‹ã‚ˆã†ã«ï¼Œprd-fooã‚„stg-fooã¨ã—ãŸæ–¹ãŒè‰¯ã„ï¼ https://app.datadoghq.com/apm/services DD_HOSTNAME ã‚³ãƒ³ãƒ†ãƒŠã®ãƒ›ã‚¹ãƒˆåã‚’è¨­å®šã™ã‚‹ï¼ Fargateã‚’ä½¿ç”¨ã™ã‚‹å ´åˆã¯ï¼Œã“ã‚Œã‚’ä½¿ç”¨ã—ãªã„ã‚ˆã†ã«ã™ã‚‹ï¼å‚è€ƒï¼šhttps://docs.datadoghq.com/ja/integrations/ecs_fargate/?tab=fluentbitandfirelens#%E3%81%9D%E3%81%AE%E4%BB%96%E3%81%AE%E7%92%B0%E5%A2%83%E5%A4%89%E6%95%B0 https://app.datadoghq.com/infrastructure/map ECS_FARGATE Fargateã‚’ç”¨ã„ã‚‹å ´åˆã«ï¼Œã“ã‚Œã‚’å®£è¨€ã™ã‚‹ï¼ ä»»æ„ã§é¸æŠã§ãã‚‹ãƒ¡ãƒˆãƒªã‚¯ã‚¹ã®åé›†ã¨ã—ã¦å½¹ç«‹ã¤ç’°å¢ƒå¤‰æ•°ã‚’ä»¥ä¸‹ã«ç¤ºã™ï¼ä¸€éƒ¨ã®ãƒ¡ãƒˆãƒªã‚¯ã‚¹ã¯ï¼Œæ¨™æº–ã§ã¯åé›†ã—ãªã„ã‚ˆã†ã«ãªã£ã¦ãŠã‚Šï¼Œåé›†ã™ã‚‹ãŸã‚ã«ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚’æœ‰åŠ¹åŒ–ã™ã‚‹å¿…è¦ãŒã‚ã‚‹ï¼ å‚è€ƒï¼šhttps://docs.datadoghq.com/ja/agent/docker/?tab=%E6%A8%99%E6%BA%96#%E3%82%AA%E3%83%97%E3%82%B7%E3%83%A7%E3%83%B3%E3%81%AE%E5%8F%8E%E9%9B%86-agent å¤‰æ•°å èª¬æ˜ è£œè¶³ Datadogã‚³ãƒ³ã‚½ãƒ¼ãƒ«URL DD_APM_ENABLED APMã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚’æœ‰åŠ¹åŒ–ã™ã‚‹ï¼ Fargateã‚’ä½¿ç”¨ã—ã¦ã„ã‚‹å ´åˆï¼ŒAPMã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚’æœ‰åŠ¹åŒ–ã™ã‚‹ã ã‘ã§ãªãï¼Œåˆ†æ•£ãƒˆãƒ¬ãƒ¼ã‚¹ã‚’é€ä¿¡ã§ãã‚‹ã‚ˆã†ã«ï¼Œã‚µãƒ¼ãƒ“ã‚¹ã«ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ãŒå¿…è¦ã§ã‚ã‚‹ï¼å‚è€ƒï¼šãƒ»https://app.datadoghq.com/apm/docs?architecture=host-based&framework=php-fpm&language=phpãƒ»https://docs.datadoghq.com/ja/tracing/#datadog-%E3%81%B8%E3%83%88%E3%83%AC%E3%83%BC%E3%82%B9%E3%82%92%E9%80%81%E4%BF%A1 https://app.datadoghq.com/apm/home DD_LOGS_ENABLED - DD_PROCESS_AGENT_ENABLED ãƒ©ã‚¤ãƒ–ãƒ—ãƒ­ã‚»ã‚¹ã‚’æœ‰åŠ¹åŒ–ã—ï¼Œå®Ÿè¡Œä¸­ã®ãƒ—ãƒ­ã‚»ã‚¹ã‚’åé›†ã™ã‚‹ï¼å‚è€ƒï¼šhttps://docs.datadoghq.com/ja/infrastructure/process/?tab=linuxwindows https://app.datadoghq.com/containers ã‚«ã‚¹ã‚¿ãƒ ãƒ¡ãƒˆãƒªã‚¯ã‚¹ã®åé›†ã¨ã—ã¦å½¹ç«‹ã¤ç’°å¢ƒå¤‰æ•°ã‚’ä»¥ä¸‹ã«ç¤ºã™ï¼ å‚è€ƒï¼šhttps://docs.datadoghq.com/ja/agent/docker/?tab=%E6%A8%99%E6%BA%96#dogstatsd-%E3%82%AB%E3%82%B9%E3%82%BF%E3%83%A0%E3%83%A1%E3%83%88%E3%83%AA%E3%82%AF%E3%82%B9 å¤‰æ•°å èª¬æ˜ Datadogã‚³ãƒ³ã‚½ãƒ¼ãƒ«URL DD_DOGSTATSD_NON_LOCAL_TRAFFIC Datadogã‚³ãƒ³ãƒ†ãƒŠã®ã‚«ã‚¹ã‚¿ãƒ ãƒ¡ãƒˆãƒªã‚¯ã‚¹ã®å—ä¿¡ã‚’æœ‰åŠ¹åŒ–ã™ã‚‹ï¼ ãƒˆãƒ¬ãƒ¼ã‚¹ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆ ãƒ»ãƒˆãƒ¬ãƒ¼ã‚¹ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã¨ã¯ Dockerã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã«ã¦ï¼ŒDD_APM_ENABLEDã®ç’°å¢ƒå¤‰æ•°ã«trueã‚’å‰²ã‚Šå½“ã¦ã‚‹ã¨ï¼Œãƒˆãƒ¬ãƒ¼ã‚¹ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆãŒæœ‰åŠ¹ã«ãªã‚‹ï¼APMã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚’æœ‰åŠ¹åŒ–ã—ï¼Œåˆ†æ•£ãƒˆãƒ¬ãƒ¼ã‚¹ã‚’åé›†ã§ãã‚‹ï¼APMã§ã¯ï¼Œåˆ†æ•£ãƒˆãƒ¬ãƒ¼ã‚¹ã‚’å…ƒã«ã—ã¦ï¼Œã‚µãƒ¼ãƒ“ã‚¹é–“ã®ä¾å­˜é–¢ä¿‚ã‚’ã‚µãƒ¼ãƒ“ã‚¹ãƒãƒƒãƒ—ã¨ã—ã¦ç¢ºèªã§ãã‚‹ï¼ å‚è€ƒï¼š https://docs.datadoghq.com/ja/agent/docker/apm/?tab=linux https://docs.datadoghq.com/ja/tracing/#datadog-apm-%E3%81%AE%E7%A2%BA%E8%AA%8D ãƒ»ç’°å¢ƒå¤‰æ•° ä¸€éƒ¨ã®ç’°å¢ƒå¤‰æ•°ã¯ï¼ŒDockerã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã®ç’°å¢ƒå¤‰æ•°ã¨é‡ãªã‚‹ï¼ å‚è€ƒï¼šhttps://docs.datadoghq.com/ja/agent/docker/apm/?tab=linux#docker-apm-agent-%E3%81%AE%E7%92%B0%E5%A2%83%E5%A4%89%E6%95%B0 å¤‰æ•°å èª¬æ˜ è£œè¶³ DD_LOG_LEVEL APMã«é€ä¿¡ã™ã‚‹ãƒ­ã‚°ãƒ¬ãƒ™ãƒ«ã‚’è¨­å®šã™ã‚‹ï¼ Datadogã‚³ãƒ³ãƒ†ãƒŠ ãƒ»Datadogã‚³ãƒ³ãƒ†ãƒŠã¨ã¯ DatadogãŒæä¾›ã™ã‚‹datadogã‚¤ãƒ¡ãƒ¼ã‚¸ã«ã‚ˆã£ã¦æ§‹ç¯‰ã•ã‚Œã‚‹ã‚³ãƒ³ãƒ†ãƒŠã§ã‚ã‚Šï¼Œã‚³ãƒ³ãƒ†ãƒŠã®ã‚µã‚¤ãƒ‰ã‚«ãƒ¼ã‚³ãƒ³ãƒ†ãƒŠã¨ã—ã¦é…ç½®ã•ã‚Œã‚‹ï¼ã‚³ãƒ³ãƒ†ãƒŠå†…ã§ç¨¼åƒã™ã‚‹Datadog Dockerã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆãŒï¼Œã‚³ãƒ³ãƒ†ãƒŠã‹ã‚‰ãƒ¡ãƒˆãƒªã‚¯ã‚¹ã‚’åé›†ã—ï¼ŒDatadogã«ã“ã‚Œã‚’è»¢é€ã™ã‚‹ï¼ å‚è€ƒï¼šhttps://docs.datadoghq.com/ja/integrations/ecs_fargate/?tab=fluentbitandfirelens#%E6%A6%82%E8%A6%81 ãƒ»Datadogã‚³ãƒ³ãƒ†ãƒŠã®é…ç½® [ { # laravelã‚³ãƒ³ãƒ†ãƒŠ }, { # nginxã‚³ãƒ³ãƒ†ãƒŠ }, { # datadogã‚³ãƒ³ãƒ†ãƒŠ \"name\": \"datadog\", \"image\": \"datadog/agent:latest\", \"essential\": false, \"portMappings\": [ { \"containerPort\": 8126, \"hostPort\": 8126, \"protocol\": \"tcp\" } ], \"logConfiguration\": { \"logDriver\": \"awslogs\", \"options\": { \"awslogs-group\": \"/prd-foo/laravel/log\", \"awslogs-region\": \"ap-northeast-1\" \"awslogs-stream-prefix\": \"/container\" } }, \"cpu\": 10, \"memory\": 256, \"environment\": [ { \"name\": \"ECS_FARGATE\", \"value\": \"true\" }, { \"name\": \"DD_PROCESS_AGENT_ENABLED\", \"value\": \"true\" }, { \"name\": \"DD_DOGSTATSD_NON_LOCAL_TRAFFIC\", \"value\": \"true\" }, { \"name\": \"DD_APM_ENABLED\", \"value\": \"true\" }, { \"name\": \"DD_LOGS_ENABLED\", \"value\": \"true\" }, { # ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã«å¯¾ã™ã‚‹envã‚¿ã‚° \"name\": \"DD_ENV\", \"value\": \"foo\" }, { # ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã«å¯¾ã™ã‚‹serviceã‚¿ã‚° \"name\": \"DD_SERVICE\", \"value\": \"foo\" }, { # ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã«å¯¾ã™ã‚‹versionã‚¿ã‚° \"name\": \"DD_VERSION\", \"value\": \"latest\" } ], \"secrets\": [ { \"name\": \"DD_API_KEY\", \"valueFrom\": \"/prd-foo/DD_API_KEY\" } ], \"dockerLabels\": { # ECSã‚³ãƒ³ãƒ†ãƒŠã«å¯¾ã™ã‚‹envã‚¿ã‚° \"com.datadoghq.tags.env\": \"prd\", # ECSã‚³ãƒ³ãƒ†ãƒŠã«å¯¾ã™ã‚‹serviceã‚¿ã‚° \"com.datadoghq.tags.service\": \"foo\", # ECSã‚³ãƒ³ãƒ†ãƒŠã«å¯¾ã™ã‚‹versionã‚¿ã‚° \"com.datadoghq.tags.version\": \"1.0.0\" } } ] ãƒ»IAMãƒ­ãƒ¼ãƒ« Datadogã‚³ãƒ³ãƒ†ãƒŠãŒã‚³ãƒ³ãƒ†ãƒŠã‹ã‚‰ãƒ¡ãƒˆãƒªã‚¯ã‚¹ã‚’åé›†ã§ãã‚‹ã‚ˆã†ã«ï¼ŒECSã‚¿ã‚¹ã‚¯å®Ÿè¡Œãƒ­ãƒ¼ãƒ«ã«ãƒãƒªã‚·ãƒ¼ã‚’è¿½åŠ ã™ã‚‹å¿…è¦ãŒã‚ã‚‹ï¼ å‚è€ƒï¼šhttps://docs.datadoghq.com/ja/integrations/ecs_fargate/?tab=fluentbitandfirelens#iam-%E3%83%9D%E3%83%AA%E3%82%B7%E3%83%BC%E3%81%AE%E4%BD%9C%E6%88%90%E3%81%A8%E4%BF%AE%E6%AD%A3 { \"Version\": \"2012-10-17\", \"Statement\": [ { \"Action\": [ \"ecs:ListClusters\", \"ecs:ListContainerInstances\", \"ecs:DescribeContainerInstances\" ], \"Effect\": \"Allow\", \"Resource\": \"*\" } ] } 03. ãƒ¡ãƒˆãƒªã‚¯ã‚¹ã‚¤ãƒ³ãƒ†ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ ãƒ¡ãƒˆãƒªã‚¯ã‚¹ã‚¤ãƒ³ãƒ†ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã¨ã¯ è¨€èªï¼ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ï¼ãƒ„ãƒ¼ãƒ«ï¼Œãªã©ã«é–¢ã—ã¦ï¼Œå°‚ç”¨ã®ãƒ¡ãƒˆãƒªã‚¯ã‚¹ã‚’åé›†ã§ãã‚‹ã‚ˆã†ã«ãªã‚‹ï¼ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã¨ã—ã¦ä½¿ç”¨ã•ã‚Œã‚‹è¨€èªï¼ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã®å ´åˆï¼ŒDatadogã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆãŒã‚¤ãƒ³ãƒ†ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å‡¦ç†ã‚’æŒã¤ãŸã‚ï¼Œã‚µãƒ¼ãƒï¼ã‚³ãƒ³ãƒ†ãƒŠã¸ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã¯ä¸è¦ã§ã‚ã‚‹ï¼Datedogã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆãŒã‚³ãƒ³ãƒ†ãƒŠï¼ã‚µãƒ¼ãƒã§ç¨¼åƒã™ã‚‹è¨€èªï¼ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ï¼ãƒ„ãƒ¼ãƒ«ã‚’è‡ªå‹•ã§èªè­˜ã—ã¦ãã‚Œã‚‹ï¼ ç¨®é¡ ãƒ»PHP-FPMã®å ´åˆ PHP-FPMã‚¤ãƒ³ãƒ†ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚’æœ‰åŠ¹åŒ–ã—ãŸå ´åˆï¼Œä»¥ä¸‹ã®å°‚ç”¨ãƒ¡ãƒˆãƒªã‚¯ã‚¹ã‚’åé›†ã§ãã‚‹ã‚ˆã†ã«ãªã‚‹ï¼ å‚è€ƒï¼šhttps://docs.datadoghq.com/ja/integrations/php_fpm/?tab=host#%E3%83%A1%E3%83%88%E3%83%AA%E3%82%AF%E3%82%B9 ãƒ»Nginxã®å ´åˆ Nginxã‚¤ãƒ³ãƒ†ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚’æœ‰åŠ¹åŒ–ã—ãŸå ´åˆï¼Œä»¥ä¸‹ã®å°‚ç”¨ãƒ¡ãƒˆãƒªã‚¯ã‚¹ã‚’åé›†ã§ãã‚‹ã‚ˆã†ã«ãªã‚‹ï¼ å‚è€ƒï¼šhttps://docs.datadoghq.com/ja/integrations/nginx/?tab=host#%E3%83%A1%E3%83%88%E3%83%AA%E3%82%AF%E3%82%B9 04. ãƒ¡ãƒˆãƒªã‚¯ã‚¹é€ä¿¡ è¨­å®šæ–¹æ³• ã„ãã¤ã‹ã®æ–¹æ³•ã§ï¼Œåé›†ã•ã‚ŒãŸãƒ¡ãƒˆãƒªã‚¯ã‚¹ã‚’é€ä¿¡ã§ãã‚‹ï¼ å‚è€ƒï¼šhttps://docs.datadoghq.com/ja/metrics/#datadog-%E3%81%B8%E3%81%AE%E3%83%A1%E3%83%88%E3%83%AA%E3%82%AF%E3%82%B9%E3%81%AE%E9%80%81%E4%BF%A1 ã‚¤ãƒ³ãƒ†ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ— Datadogã§ã‚¤ãƒ³ãƒ†ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚’æœ‰åŠ¹åŒ–ã™ã‚‹ã¨åŒæ™‚ã«ï¼Œã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã«ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹ï¼ ãƒ¡ãƒˆãƒªã‚¯ã‚¹ã®å‰Šé™¤ Datadogã«é€ä¿¡ã•ã‚Œãªããªã£ãŸãƒ¡ãƒˆãƒªã‚¯ã‚¹ã¯ï¼Œæ™‚é–“çµŒéã¨ã¨ã‚‚ã«Datadogã‹ã‚‰å‰Šé™¤ã•ã‚Œã‚‹ï¼ å‚è€ƒï¼šhttps://docs.datadoghq.com/ja/dashboards/faq/historical-data/ 05. ä»–ãƒ†ãƒ¬ãƒ¡ãƒˆãƒªãƒ¼ã¨ã®ç›¸é–¢ä»˜ã‘ å‚è€ƒï¼šhttps://docs.datadoghq.com/ja/logs/guide/correlate-logs-with-metrics/ "},"public/observability_monitering/observability_datadog_log.html":{"url":"public/observability_monitering/observability_datadog_log.html","title":"ğŸ“– ï¸ãƒ­ã‚°åé›†","keywords":"","body":"ãƒ­ã‚°åé›† ã¯ã˜ã‚ã« æœ¬ã‚µã‚¤ãƒˆã«ã¤ãã¾ã—ã¦ï¼Œä»¥ä¸‹ã‚’ã”èªè­˜ã®ã»ã©å®œã—ããŠé¡˜ã„ã„ãŸã—ã¾ã™ï¼ å‚è€ƒï¼šhttps://hiroki-it.github.io/tech-notebook-gitbook/ 01. ãƒ­ã‚°åé›†ã®ä»•çµ„ã¿ ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ ï¼ˆï¼‘ï¼‰ã‚µãƒ¼ãƒã®å ´åˆï¼Œç¨¼åƒã™ã‚‹Datadogã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆãŒï¼ŒDatadog-APIã«ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãƒ­ã‚°ã‚’é€ä¿¡ã™ã‚‹ï¼ã‚³ãƒ³ãƒ†ãƒŠã®å ´åˆï¼ŒFluentBitãŒä»£ã‚ã‚Šã«ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãƒ­ã‚°ã‚’é€ä¿¡ã™ã‚‹ï¼ ï¼ˆï¼’ï¼‰Datadogã«ã¦ï¼Œãƒ­ã‚°ã¯ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã§å‡¦ç†ã•ã‚Œï¼Œæ§‹é€ åŒ–ãƒ­ã‚°ã«ãªã‚‹ï¼ ï¼ˆï¼“ï¼‰ãƒ¦ãƒ¼ã‚¶ã¯ï¼Œãƒ­ã‚°ã®å±æ€§å€¤ã«åŸºã¥ã„ã¦ï¼Œãƒ­ã‚°ã‚’æ¤œç´¢ã§ãã‚‹ã‚ˆã†ã«ãªã‚‹ï¼ å‚è€ƒï¼šhttps://developers.cyberagent.co.jp/blog/archives/12565/ ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ ï¼ˆï¼‘ï¼‰ãƒ–ãƒ©ã‚¦ã‚¶ã®ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã«å‡ºåŠ›ã•ã‚Œã‚‹ãƒ­ã‚°ã‚’åé›†ã™ã‚‹ï¼ ï¼ˆï¼’ï¼‰Datadogã«ã¦ï¼Œãƒ­ã‚°ã¯ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã§å‡¦ç†ã•ã‚Œï¼Œæ§‹é€ åŒ–ãƒ­ã‚°ã«ãªã‚‹ï¼ ï¼ˆï¼“ï¼‰ãƒ¦ãƒ¼ã‚¶ã¯ï¼Œãƒ­ã‚°ã®å±æ€§å€¤ã«åŸºã¥ã„ã¦ï¼Œãƒ­ã‚°ã‚’æ¤œç´¢ã§ãã‚‹ã‚ˆã†ã«ãªã‚‹ï¼ å‚è€ƒï¼šhttps://qiita.com/komtaki/items/a2d3f06e2265e55b0c08#2-js%E3%83%AD%E3%82%AC%E3%83%BC%E3%81%AE%E6%A7%8B%E7%AF%89 02. Ec2ã«ãŠã‘ã‚‹ãƒ­ã‚°åé›† Datadogã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆ on EC2ã¨ã¯ ãƒ»Datadogã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆ on EC2ã¨ã¯ å¸¸é§ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã§ã‚ã‚Šï¼Œã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãƒ­ã‚°ã‚’åé›†ã—ï¼ŒDatadogã«è»¢é€ã™ã‚‹ï¼ å‚è€ƒï¼šhttps://docs.datadoghq.com/ja/agent/amazon_ecs/?tab=awscli ãƒ»ãƒ­ã‚°åé›†ã®æœ‰åŠ¹åŒ– ãƒ­ã‚°ã®åé›†ã¯æ¨™æº–ã§ç„¡åŠ¹åŒ–ã•ã‚Œã¦ã„ã‚‹ï¼/etc/datadog-agent/datadog.yamlãƒ•ã‚¡ã‚¤ãƒ«ã«ã¦ï¼Œã“ã‚Œã‚’æœ‰åŠ¹åŒ–ã™ã‚‹ï¼ logs_enabled: true 03. Fargateã«ãŠã‘ã‚‹ãƒ­ã‚°åé›† FireLensã‚³ãƒ³ãƒ†ãƒŠ ãƒ»FireLensã‚³ãƒ³ãƒ†ãƒŠã¨ã¯ Datadogã‚³ãƒ³ãƒ†ãƒŠã¯ã‚³ãƒ³ãƒ†ãƒŠã‹ã‚‰ãƒ­ã‚°ã‚’åé›†ã§ããªã„ãŸã‚ï¼Œä»£ã‚ã‚Šã«FireLensã‚³ãƒ³ãƒ†ãƒŠã‚’ç”¨ã„ã‚‹å¿…è¦ãŒã‚ã‚‹ï¼ä»¥ä¸‹ã®ãƒªãƒ³ã‚¯ã‚’å‚è€ƒã«ã›ã‚ˆï¼ å‚è€ƒï¼š https://docs.datadoghq.com/ja/integrations/ecs_fargate/?tab=fluentbitandfirelens https://hiroki-it.github.io/tech-notebook-gitbook/public/summary.html?q=firelens FireLensã‚³ãƒ³ãƒ†ãƒŠã®ãƒ™ãƒ¼ã‚¹ã‚¤ãƒ¡ãƒ¼ã‚¸ ãƒ»Datadogã‚¤ãƒ¡ãƒ¼ã‚¸ Datadogã‚³ãƒ³ãƒ†ãƒŠã®ãƒ™ãƒ¼ã‚¹ã‚¤ãƒ¡ãƒ¼ã‚¸ã¨ãªã‚‹Datadogã‚¤ãƒ¡ãƒ¼ã‚¸ãŒDatadogå…¬å¼ã‹ã‚‰æä¾›ã•ã‚Œã¦ã„ã‚‹ï¼ãƒ‘ãƒ–ãƒªãƒƒã‚¯ECRãƒªãƒã‚¸ãƒˆãƒªã‹ã‚‰ãƒ—ãƒ«ã—ãŸã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’ãã®ã¾ã¾ç”¨ã„ã‚‹å ´åˆã¨ï¼Œãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆECRãƒªãƒã‚¸ãƒˆãƒªã§å†ç®¡ç†ã—ã¦ã‹ã‚‰ç”¨ã„ã‚‹å ´åˆãŒã‚ã‚‹ï¼ ãƒ»ãƒ‘ãƒ–ãƒªãƒƒã‚¯ECRãƒªãƒã‚¸ãƒˆãƒªã‚’ç”¨ã„ã‚‹å ´åˆ ECSã®ã‚³ãƒ³ãƒ†ãƒŠå®šç¾©ã«ã¦ï¼Œãƒ‘ãƒ–ãƒªãƒƒã‚¯ECRãƒªãƒã‚¸ãƒˆãƒªã®URLã‚’æŒ‡å®šã—ï¼ŒECRã‚¤ãƒ¡ãƒ¼ã‚¸ã®ãƒ—ãƒ«ã‚’å®Ÿè¡Œã™ã‚‹ï¼æ¨™æº–ã§å†…è”µã•ã‚Œã¦ã„ã‚‹yamlãƒ•ã‚¡ã‚¤ãƒ«ã®è¨­å®šã‚’ãã®ã¾ã¾ç”¨ã„ã‚‹å ´åˆã¯ï¼Œã“ã¡ã‚‰ã‚’æ¡ç”¨ã™ã‚‹ï¼ å‚è€ƒï¼š https://gallery.ecr.aws/datadog/agent https://github.com/DataDog/datadog-agent ãƒ»ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆECRãƒªãƒã‚¸ãƒˆãƒªã‚’ç”¨ã„ã‚‹å ´åˆ ã‚ã‚‰ã‹ã˜ã‚ï¼ŒDockerHubã‹ã‚‰datadogã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’ãƒ—ãƒ«ã™ã‚‹ãŸã‚ã®Dockerfileã‚’ä½œæˆã—ï¼Œãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆECRãƒªãƒã‚¸ãƒˆãƒªã«ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’ãƒ—ãƒƒã‚·ãƒ¥ã—ã¦ãŠãï¼ECSã®ã‚³ãƒ³ãƒ†ãƒŠå®šç¾©ã«ã¦ï¼Œãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆECRãƒªãƒã‚¸ãƒˆãƒªã®URLã‚’æŒ‡å®šã—ï¼ŒECRã‚¤ãƒ¡ãƒ¼ã‚¸ã®ãƒ—ãƒ«ã‚’å®Ÿè¡Œã™ã‚‹ï¼æ¨™æº–ã§å†…è”µã•ã‚Œã¦ã„ã‚‹yamlãƒ•ã‚¡ã‚¤ãƒ«ã®è¨­å®šã‚’ä¸Šæ›¸ãã—ãŸã„å ´åˆã¯ï¼Œã“ã¡ã‚‰ã‚’æ¡ç”¨ã™ã‚‹ï¼ å‚è€ƒï¼šhttps://hub.docker.com/r/datadog/agent FROM data/agent:latest æ¨™æº–è¨­å®šã®ä¸Šæ›¸ã å‚è€ƒï¼šhttps://github.com/DataDog/datadog-agent/blob/main/pkg/config/config_template.yaml 05. ãƒ­ã‚°ã®è­˜åˆ¥å­ attributeï¼ˆå±æ€§ï¼‰ ãƒ»äºˆç´„æ¸ˆã¿å±æ€§ å‚è€ƒï¼šhttps://docs.datadoghq.com/ja/logs/log_configuration/attributes_naming_convention/ å±æ€§å èª¬æ˜ è£œè¶³ ä¾‹ host ãƒ­ã‚°ã®ç”Ÿæˆå…ƒã®ãƒ›ã‚¹ãƒˆåã‚’ç¤ºã™ï¼ ãƒ­ã‚°ãŒç”Ÿæˆå…ƒã¨ã¯åˆ¥ã®å ´æ‰€ã‹ã‚‰é€ä¿¡ã•ã‚Œã¦ã„ã‚‹å ´åˆã«å½¹ç«‹ã¤ï¼Datadogã‚³ãƒ³ãƒ†ãƒŠã®ç’°å¢ƒå¤‰æ•°ã«ã¦ï¼ŒDD_HOSTNAMEã‚’ç”¨ã„ã¦hostå±æ€§ã‚’è¨­å®šã™ã‚‹ï¼ã“ã‚Œã«ã‚ˆã‚Šï¼Œãƒ›ã‚¹ãƒˆãƒãƒƒãƒ—ã§ãƒ›ã‚¹ãƒˆã‚’ä¿¯ç°ã§ãã‚‹ã‚ˆã†ã«ãªã‚‹ã ã‘ã§ãªãï¼Œãƒ­ã‚°ã‚¨ã‚¯ã‚¹ãƒ—ãƒ­ãƒ¼ãƒ©ã§ãƒ›ã‚¹ãƒˆã‚¿ã‚°ãŒå±æ€§ã¨ã—ã¦ä»˜ä¸ã•ã‚Œã‚‹ï¼ä»–ã«AWSã‚¤ãƒ³ãƒ†ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã§ã¯ï¼Œé€ä¿¡å…ƒã®ãƒ­ã‚°ã‚°ãƒ«ãƒ¼ãƒ—åã‚„ãƒã‚±ãƒƒãƒˆåãŒä»˜ä¸ã•ã‚Œã‚‹ï¼ ãƒ»fooãƒ»foo-backendãƒ»foo-frontendãƒ»foo-log-groupãƒ»foo-bucket source ãƒ­ã‚°ã®ç”Ÿæˆå…ƒã®åå‰ã‚’ç¤ºã™ï¼ ãƒ™ãƒ³ãƒ€ãƒ¼åã‚’ä½¿ç”¨ã™ã‚‹ã¨ã‚ã‹ã‚Šã‚„ã™ã„ï¼ ãƒ»laravelãƒ»nginxãƒ»redis status ãƒ­ã‚°ã®ãƒ¬ãƒ™ãƒ«ã‚’ç¤ºã™ï¼ service ãƒ­ã‚°ã®ç”Ÿæˆå…ƒã®ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³åã‚’ç¤ºã™ï¼ ãƒ­ã‚°ã¨APMåˆ†æ•£ãƒˆãƒ¬ãƒ¼ã‚¹ã‚’ç´ä»˜ã‘ã‚‹ãŸã‚ï¼Œä¸¡æ–¹ã«åŒã˜åå‰ã‚’å‰²ã‚Šå½“ã¦ã‚‹å¿…è¦ãŒã‚ã‚‹ï¼ ãƒ»fooãƒ»bar-backendãƒ»baz-frontend trace_id ãƒ­ã‚°ã‚’åˆ†æ•£ãƒˆãƒ¬ãƒ¼ã‚¹ã‚„ã‚¹ãƒ‘ãƒ³ã¨ç´ä»˜ã‘ã‚‹IDã‚’ç¤ºã™ï¼ message ãƒ­ã‚°ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’ç¤ºã™ï¼ ãƒ»æ¨™æº–å±æ€§ æ¨™æº–ã§ç”¨æ„ã•ã‚ŒãŸå±æ€§ï¼ å‚è€ƒï¼šhttps://docs.datadoghq.com/ja/logs/log_configuration/attributes_naming_convention/#%E6%A8%99%E6%BA%96%E5%B1%9E%E6%80%A7 ï¼Šä¾‹ï¼Š Laravelã®å ´åˆ { \"container_id\": \"*****\", \"container_name\": \"/prd-foo-ecs-container\", \"date\": 12345, \"log_status\": \"NOTICE\", \"service\": \"foo\", \"source\": \"laravel\", \"timestamp\": 12345 } ï¼Šä¾‹ï¼Š Nginxã®å ´åˆ { \"content\": { \"attributes\": { \"date_access\": 12345, \"http\": { \"method\": \"GET\", \"referer\": \"-\", \"status_category\": \"info\", \"status_code\": 200, \"url\": \"/healthcheck\", \"url_details\": { \"path\": \"/healthcheck\" }, \"useragent\": \"ELB-HealthChecker/2.0\", \"useragent_details\": { \"browser\": { \"family\": \"Other\" }, \"device\": { \"category\": \"Other\", \"family\": \"Other\" }, \"os\": { \"family\": \"Other\" } }, \"version\": \"1.1\" }, \"network\": { \"bytes_written\": 17, \"client\": { \"ip\": \"nn.nnn.nn.nnn\" } }, \"service\": \"foo\", \"timestamp\": 12345 }, \"message\": \"nn.nnn.nn.nnn - - [01/Sep/2021:00:00:00 +0000] \\\"GET /healthcheck HTTP/1.1\\\" 200 17 \\\"-\\\" \\\"ELB-HealthChecker/2.0\\\"\", \"service\": \"foo\", \"tags\": [ \"source:nginx\", \"env:prd\" ], \"timestamp\": \"2021-09-01T00:00:00.000Z\" }, \"id\": \"*****\" } ãƒ»ã‚¹ã‚¿ãƒƒã‚¯ãƒˆãƒ¬ãƒ¼ã‚¹å±æ€§ ã‚¹ã‚¿ãƒƒã‚¯ãƒˆãƒ¬ãƒ¼ã‚¹ãƒ­ã‚°ã‚’æ§‹æˆã™ã‚‹è¦ç´ ã«ä»˜ä¸ã•ã‚Œã‚‹å±æ€§ã®ã“ã¨ï¼ å‚è€ƒï¼šhttps://docs.datadoghq.com/ja/logs/log_collection/?tab=host#%E3%82%B9%E3%82%BF%E3%83%83%E3%82%AF%E3%83%88%E3%83%AC%E3%83%BC%E3%82%B9%E3%81%AE%E5%B1%9E%E6%80%A7 å±æ€§å èª¬æ˜ logger.name ãƒ­ã‚°ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®åå‰ã‚’ç¤ºã™ï¼ logger.thread_name ã‚¹ãƒ¬ãƒƒãƒ‰åã‚’ç¤ºã™ï¼ error.stack ã‚¹ã‚¿ãƒƒã‚¯ãƒˆãƒ¬ãƒ¼ã‚¹ãƒ­ã‚°å…¨ä½“ã‚’ç¤ºã™ï¼ error.message ã‚¹ã‚¿ãƒƒã‚¯ãƒˆãƒ¬ãƒ¼ã‚¹ãƒ­ã‚°ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸éƒ¨åˆ†ã‚’ç¤ºã™ï¼ error.kind ã‚¨ãƒ©ãƒ¼ã®ç¨®é¡ï¼ˆExceptionï¼ŒOSErrorï¼Œãªã©ï¼‰ã‚’ç¤ºã™ï¼ ã‚¿ã‚° 06. åé›†ã•ã‚ŒãŸãƒ­ã‚°ã®é€ä¿¡ EC2ã«ãŠã‘ã‚‹ãƒ­ã‚°ã®é€ä¿¡ ãƒ»PHP Monologã®å ´åˆ Logãƒ©ã‚¤ãƒ–ãƒ©ãƒªã«Monologã‚’ä½¿ç”¨ã—ã¦ã„ã‚‹å ´åˆï¼Œ/etc/datadog-agent/conf.d/php.dãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªä¸‹ã«conf.yamlãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã™ã‚‹ï¼ã“ã“ã«ï¼ŒDatadogã«ãƒ­ã‚°ã‚’é€ä¿¡ã™ã‚‹ãŸã‚ã®è¨­å®šã‚’è¡Œã†ï¼ å‚è€ƒï¼šhttps://docs.datadoghq.com/ja/logs/log_collection/php/?tab=phpmonolog#agent-%E3%81%AE%E6%A7%8B%E6%88%90 ï¼Šå®Ÿè£…ä¾‹ï¼Š init_config: instances: ## Log section logs: - type: file path: \"/path/to/laravel.log\" service: php source: php sourcecategory: sourcecode Fargateã«ãŠã‘ã‚‹ãƒ­ã‚°ã®é€ä¿¡ FireLensã‚³ãƒ³ãƒ†ãƒŠã§ç¨¼åƒã™ã‚‹FluentBitãŒï¼ŒDatadogã«ãƒ­ã‚°ã‚’é€ä¿¡ã™ã‚‹ï¼ä»¥ä¸‹ã®ãƒªãƒ³ã‚¯ã‚’å‚è€ƒã«ã›ã‚ˆï¼ å‚è€ƒï¼šhttps://hiroki-it.github.io/tech-notebook-gitbook/public/observability_monitering/observability_fluentd_and_fluentbit.html 07. ãƒ­ã‚°ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ ãƒ­ã‚°ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã¨ã¯ Datadogã«é€ä¿¡ã•ã‚ŒãŸãƒ­ã‚°ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‹ã‚‰å€¤ã‚’æŠ½å‡ºã—ï¼Œæ§‹é€ åŒ–ãƒ­ã‚°ã®å„å±æ€§ã«å‰²ã‚Šå½“ã¦ã‚‹ï¼ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã®ãƒ«ãƒ¼ãƒ«ã«å½“ã¦ã¯ã¾ã‚‰ãªã‹ã£ãŸã•ã‚Œãªã‹ã£ãŸãƒ­ã‚°ã¯ï¼Œãã®ã¾ã¾æµå…¥ã™ã‚‹ï¼å±æ€§ã”ã¨ã«ãƒ•ã‚¡ã‚»ãƒƒãƒˆã«å¯¾å¿œã—ã¦ãŠã‚Šï¼Œå„ãƒ•ã‚¡ã‚»ãƒƒãƒˆã®å€¤åˆ¤å®šãƒ«ãƒ¼ãƒ«ã«åŸºã¥ã„ã¦ï¼Œãƒ­ã‚°ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ç”»é¢ã«è¡¨ç¤ºã•ã‚Œã‚‹ï¼ ãƒªãƒãƒƒãƒ‘ãƒ¼ç³» ãƒ»ãƒªãƒãƒƒãƒ‘ãƒ¼ æŒ‡å®šã—ãŸå±æ€§ï¼ã‚¿ã‚°ã«å‰²ã‚Šå½“ã¦ã‚‰ã‚ŒãŸå€¤ã‚’ï¼Œåˆ¥ã®å±æ€§ã«å‰²ã‚Šå½“ã¦ç›´ã™ï¼å†å‰²ã‚Šå½“ã¦æ™‚ã«ï¼Œå…ƒã€…ã®ãƒ‡ãƒ¼ã‚¿å‹ã‚’å¤‰æ›´ã§ãã‚‹ï¼ ï¼Šä¾‹ï¼Š CloudWatchãƒ­ã‚°ã‹ã‚‰ï¼Œä»¥ä¸‹ã®ã‚ˆã†ãªAPI Gatewayã‚¢ã‚¯ã‚»ã‚¹ãƒ­ã‚°ã®æ§‹é€ åŒ–ãƒ­ã‚°ã‚’å—ä¿¡ã™ã‚‹ã¨ã™ã‚‹ï¼ { \"content\": { \"attributes\": { \"aws\": { \"awslogs\": { \"logGroup\": \"prd-foo-api-access-log\", \"logStream\": \"be4fcfca38da39f3ad4190e2f325e5d8\", \"owner\": \"123456789\" }, \"function_version\": \"$LATEST\", \"invoked_function_arn\": \"arn:aws:lambda:ap-northeast-1:123456789:function:datadog-ForwarderStack-*****-Forwarder-*****\" }, \"caller\": \"-\", \"host\": \"prd-foo-api-access-log\", \"httpMethod\": \"GET\", \"id\": \"36472822677180929652719686832176844832038235205288853504\", \"ip\": \"nnn.nn.nnn.nnn\", \"protocol\": \"HTTP/1.1\", \"requestId\": \"4d0c0105-7c89-4384-8b3b-fcc63f701652\", \"requestTime\": \"01/Jan/2021:12:00:00 +0000\", \"resourcePath\": \"/users/{userId}\", \"responseLength\": \"26\", \"service\": \"apigateway\", \"status\": 200, \"timestamp\": 1635497933028, \"user\": \"-\" }, \"host\": \"prd-foo-api-access-log\", \"service\": \"apigateway\", \"tags\": [ \"forwardername:datadog-forwarderstack-*****-forwarder-*****\", \"source:apigateway\", \"sourcecategory:aws\", \"forwarder_memorysize:1024\", \"forwarder_version:3.39.0\" ], \"timestamp\": \"2021-01-01T12:00:00.000Z\" }, \"id\": \"AQAAAXzLRfjkXhzqsgAAAABBWHpMUmxPM0FBQTFWVnRrNTVXbkx3QUE\" } ã“ã‚Œã«å¯¾ã—ã¦ï¼Œãƒªãƒãƒƒãƒ‘ãƒ¼ã®ãƒ«ãƒ¼ãƒ«ã‚’å®šç¾©ã™ã‚‹ï¼ä¾‹ãˆã°ï¼Œãƒªã‚¯ã‚¨ã‚¹ãƒˆã«é–¢ã™ã‚‹å±æ€§å€¤ã‚’httpå±æ€§å†…ã®å„å±æ€§ã«å‰²ã‚Šå½“ã¦ç›´ã™ï¼ { \"content\": { \"attributes\": { \"aws\": { \"awslogs\": { \"logGroup\": \"prd-foo-api-access-log\", \"logStream\": \"be4fcfca38da39f3ad4190e2f325e5d8\", \"owner\": \"123456789\" }, \"function_version\": \"$LATEST\", \"invoked_function_arn\": \"arn:aws:lambda:ap-northeast-1:123456789:function:datadog-ForwarderStack-*****-Forwarder-*****\" }, \"date_access\": \"01/Jan/2021:12:00:00 +0000\", \"host\": \"prd-foo-api-access-log\", \"http\": { \"auth\": \"-\", \"ident\": \"-\", \"method\": \"GET\", \"request_id\": \"4d0c0105-7c89-4384-8b3b-fcc63f701652\", \"status_category\": \"OK\", \"status_code\": 200, \"url\": \"/users/{userId}\", \"url_details\": { \"path\": \"/users/{userId}\" }, \"version\": \"HTTP/1.1\" }, \"id\": \"36472822677180929652719686832176844832038235205288853504\", \"network\": { \"bytes_written\": \"26\", \"client\": { \"ip\": \"nnn.nn.nnn.nnn\" } }, \"service\": \"apigateway\", \"timestamp\": 1635497933028 }, \"host\": \"prd-foo-api-access-log\", \"service\": \"apigateway\", \"tags\": [ \"forwardername:datadog-forwarderstack-*****-forwarder-*****\", \"source:apigateway\", \"sourcecategory:aws\", \"forwarder_memorysize:1024\", \"forwarder_version:3.39.0\" ], \"timestamp\": \"2021-01-01T12:00:00.000Z\" }, \"id\": \"AQAAAXzLRfjkXhzqsgAAAABBWHpMUmxPM0FBQTFWVnRrNTVXbkx3QUE\" } ãƒ»ãƒ­ã‚°ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãƒªãƒãƒƒãƒ‘ãƒ¼ æŒ‡å®šã—ãŸå±æ€§ï¼ã‚¿ã‚°ã«å‰²ã‚Šå½“ã¦ã‚‰ã‚ŒãŸå€¤ã‚’ï¼Œãƒ«ãƒ¼ãƒ«ã«åŸºã¥ã„ã¦ï¼Œã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãƒ•ã‚¡ã‚»ãƒƒãƒˆã®å„ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ï¼ˆINFOï¼ŒWARNINGï¼ŒERRORï¼Œãªã©ï¼‰ã¨ã—ã¦ç™»éŒ²ã™ã‚‹ï¼ãƒ­ã‚°ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ç”»é¢ã«ã¦ï¼Œã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãƒ•ã‚¡ã‚»ãƒƒãƒˆã¨ã—ã¦è¡¨ç¤ºã•ã‚Œã‚‹ï¼åˆ¤å®šãƒ«ãƒ¼ãƒ«ã«ã¤ã„ã¦ã¯ï¼Œä»¥ä¸‹ã®ãƒªãƒ³ã‚¯ã‚’å‚è€ƒã«ã›ã‚ˆï¼ å‚è€ƒï¼šhttps://docs.datadoghq.com/logs/log_configuration/processors/?tab=ui#log-status-remapper ãƒ»ã‚µãƒ¼ãƒ“ã‚¹ãƒªãƒãƒƒãƒ‘ãƒ¼ æŒ‡å®šã—ãŸå±æ€§ï¼ã‚¿ã‚°ã«å‰²ã‚Šå½“ã¦ã‚‰ã‚ŒãŸå€¤ã‚’ï¼Œã‚µãƒ¼ãƒ“ã‚¹ãƒ•ã‚¡ã‚»ãƒƒãƒˆã®ã‚µãƒ¼ãƒ“ã‚¹åã¨ã—ã¦ç™»éŒ²ã™ã‚‹ï¼ å‚è€ƒï¼šhttps://docs.datadoghq.com/logs/log_configuration/processors/?tab=ui#service-remapper ãƒ‘ãƒ¼ã‚µãƒ¼ç³» ãƒ»Grokãƒ‘ãƒ¼ã‚µãƒ¼ ãƒ‘ãƒ¼ã‚¹ãƒ«ãƒ¼ãƒ«ï¼ˆ%{MATCHER:EXTRACT:FILTER}ï¼‰ã‚’ç”¨ã„ã¦ï¼Œå±æ€§ã«ãƒ­ã‚°å€¤ã‚’å‰²ã‚Šå½“ã¦ã‚‹ï¼ å‚è€ƒï¼š https://docs.datadoghq.com/ja/logs/processing/parsing/?tab=matcher https://docs.datadoghq.com/logs/log_configuration/processors/?tab=ui#grok-parser Laravelã‹ã‚‰ï¼Œä»¥ä¸‹ã®ã‚ˆã†ãªéæ§‹é€ åŒ–ãƒ­ã‚°ã‚’å—ä¿¡ã™ã‚‹ã¨ã™ã‚‹ï¼ [2021-01-01 00:00:00] staging.ERROR: ãƒ­ã‚°ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ [2021-01-01 00:00:00] production.ERROR: ãƒ­ã‚°ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ ä»¥ä¸‹ã®ã‚ˆã†ãªGrokãƒ‘ãƒ¼ã‚µãƒ¼ãƒ«ãƒ¼ãƒ«ã‚’å®šç¾©ã™ã‚‹ï¼dateãƒãƒƒãƒãƒ£ãƒ¼ã‚’ç”¨ã„ã¦ï¼Œdateå±æ€§ã«ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—å€¤ã‚’å‰²ã‚Šå½“ã¦ã‚‹ï¼ã¾ãŸï¼Œwordãƒãƒƒãƒãƒ£ãƒ¼ã‚’ç”¨ã„ã¦ï¼Œlog_statusã‚«ã‚¹ã‚¿ãƒ å±æ€§ã«ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹å€¤ã‚’å‰²ã‚Šå½“ã¦ã‚‹ï¼ä»»æ„ã®ãƒ«ãƒ¼ãƒ«åã‚’è¨­å®šã§ãã‚‹ï¼ FooRule \\[%{date(\"yyyy-MM-dd HH:mm:ss\"):date}\\]\\s+(production|staging).%{word:log_status}\\:.+ ã“ã‚Œã«ã‚ˆã‚Šï¼Œæ§‹é€ åŒ–ãƒ­ã‚°ã®å„å±æ€§ã«å€¤ãŒå‰²ã‚Šå½“ã¦ã‚‰ã‚Œã‚‹ï¼ { \"date\": 1630454400000, \"log_status\": \"INFO\" } ãƒ»Urlãƒ‘ãƒ¼ã‚µãƒ¼ æ§‹é€ åŒ–ãƒ­ã‚°ã®URLå€¤ã‹ã‚‰ãƒ‘ã‚¹ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚„ã‚¯ã‚¨ãƒªãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’æ¤œå‡ºã—ï¼Œè©³ç´°ãªå±æ€§ã¨ã—ã¦æ–°ã—ãä»˜ä¸ã™ã‚‹ï¼ å‚è€ƒï¼šhttps://docs.datadoghq.com/ja/logs/processing/processors/?tab=ui#url-%E3%83%91%E3%83%BC%E3%82%B5%E3%83%BC ï¼Šä¾‹ï¼Š ã¨ã‚ã‚‹ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‹ã‚‰ï¼Œä»¥ä¸‹ã®ã‚ˆã†ãªéæ§‹é€ åŒ–ãƒ­ã‚°ã‚’å—ä¿¡ã™ã‚‹ã¨ã™ã‚‹ï¼ 192.168.0.1 [2021-01-01 12:00:00] GET /users?paginate=10&fooId=1 200 ä»¥ä¸‹ã®ã‚ˆã†ãªGrokãƒ‘ãƒ¼ã‚µã®ãƒ«ãƒ¼ãƒ«ã‚’å®šç¾©ã™ã‚‹ï¼å„ãƒãƒƒãƒãƒ£ãƒ¼ã§ã‚«ã‚¹ã‚¿ãƒ å±æ€§ã«å€¤ã‚’å‰²ã‚Šå½“ã¦ã‚‹ï¼ FooRule %{ipv4:network.client.ip}\\s+\\[%{date(\"yyyy-MM-dd HH:mm:ss\"):date}\\]\\s+%{word:http.method}\\s+%{notSpace:http.url}\\s+%{integer:http.status_code} ã“ã‚Œã«ã‚ˆã‚Šï¼Œæ§‹é€ åŒ–ãƒ­ã‚°ã®å„å±æ€§ã«å€¤ãŒå‰²ã‚Šå½“ã¦ã‚‰ã‚Œã‚‹ï¼ { \"date\": 1609502400000, \"http\": { \"method\": \"GET\", \"status_code\": 200, \"url\": \"/users?paginate=10&fooId=1\" }, \"network\": { \"client\": { \"ip\": \"192.168.0.1\" } } } ã“ã‚Œã«å¯¾ã—ã¦ï¼ŒUrlãƒ‘ãƒ¼ã‚µã®ãƒ«ãƒ¼ãƒ«ã‚’å®šç¾©ã™ã‚‹ï¼http.urlå±æ€§ã‹ã‚‰ãƒ‘ã‚¹ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚„ã‚¯ã‚¨ãƒªãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’æ¤œå‡ºã—ï¼Œhttp.url_detailså±æ€§ã¨ã—ã¦æ–°ã—ãä»˜ä¸ã™ã‚‹ï¼ { \"date\": 1609502400000, \"http\": { \"method\": \"GET\", \"status_code\": 200, \"url\": \"/users?paginate=10&fooId=1\", \"url_details\": { \"path\": \"/users\", \"queryString\": { \"fooId\": 1, \"paginate\": 10 } } }, \"network\": { \"client\": { \"ip\": \"192.168.0.1\" } } } ï¼Šä¾‹ï¼Š CloudWatchãƒ­ã‚°ã‹ã‚‰ï¼Œä»¥ä¸‹ã®ã‚ˆã†ãªAPI Gatewayã‚¢ã‚¯ã‚»ã‚¹ãƒ­ã‚°ã®æ§‹é€ åŒ–ãƒ­ã‚°ã‚’å—ä¿¡ã™ã‚‹ã¨ã™ã‚‹ï¼ { \"content\": { \"attributes\": { \"aws\": { \"awslogs\": { \"logGroup\": \"prd-foo-api-access-log\", \"logStream\": \"be4fcfca38da39f3ad4190e2f325e5d8\", \"owner\": \"123456789\" }, \"function_version\": \"$LATEST\", \"invoked_function_arn\": \"arn:aws:lambda:ap-northeast-1:123456789:function:datadog-ForwarderStack-*****-Forwarder-*****\" }, \"caller\": \"-\", \"host\": \"prd-foo-api-access-log\", \"httpMethod\": \"GET\", \"id\": \"36472822677180929652719686832176844832038235205288853504\", \"ip\": \"nnn.nn.nnn.nnn\", \"protocol\": \"HTTP/1.1\", \"requestId\": \"4d0c0105-7c89-4384-8b3b-fcc63f701652\", \"requestTime\": \"01/Jan/2021:12:00:00 +0000\", \"resourcePath\": \"/users/{userId}\", \"responseLength\": \"26\", \"service\": \"apigateway\", \"status\": 200, \"timestamp\": 1635497933028, \"user\": \"-\" }, \"host\": \"prd-foo-api-access-log\", \"service\": \"apigateway\", \"tags\": [ \"forwardername:datadog-forwarderstack-*****-forwarder-*****\", \"source:apigateway\", \"sourcecategory:aws\", \"forwarder_memorysize:1024\", \"forwarder_version:3.39.0\" ], \"timestamp\": \"2021-01-01T12:00:00.000Z\" }, \"id\": \"AQAAAXzLRfjkXhzqsgAAAABBWHpMUmxPM0FBQTFWVnRrNTVXbkx3QUE\" } ã“ã‚Œã«å¯¾ã—ã¦ï¼Œä»¥ä¸‹ã®ã‚ˆã†ãªã‚«ãƒ†ã‚´ãƒªãƒ‘ãƒ¼ã‚µãƒ¼ã®ãƒ«ãƒ¼ãƒ«ã‚’å®šç¾©ã™ã‚‹ï¼aws.invoked_function_arnå±æ€§ã®Lambdaã®ARNå¿œã˜ã¦ï¼Œserviceå±æ€§ã«ã‚µãƒ¼ãƒ“ã‚¹å€¤ï¼ˆfoo-apigatewayï¼Œbar-apigatewayï¼Œbaz-apigatewayï¼‰ã‚’ä»˜ä¸ã™ã‚‹ã‚ˆã†ã«ã™ã‚‹ï¼ã“ã®å±æ€§ã‚’ä½¿ç”¨ã™ã‚‹ç†ç”±ã¯ï¼Œæ§˜ã€…ãªAWSãƒªã‚½ãƒ¼ã‚¹ã®æ§‹é€ åŒ–ãƒ­ã‚°ãŒæŒã£ã¦ã„ã‚‹ãŸã‚ã§ã‚ã‚‹ï¼ˆownerå±æ€§ã§ã‚‚ã‚ˆã„ï¼ãŸã ã—ï¼ŒãŠãã‚‰ãS3ã‹ã‚‰ãƒ­ã‚°ã‚’åé›†ã™ã‚‹å ´åˆã¯ã“ã‚ŒãŒãªã„ï¼Ÿï¼‰ï¼å…ƒã®æ§‹é€ åŒ–ãƒ­ã‚°ã«ã™ã§ã«serviceå±æ€§ãŒã‚ã‚‹ãŸã‚ï¼Œã“ã®å€¤ãŒä¸Šæ›¸ãã•ã‚Œã‚‹ï¼ foo-apigateway @aws.invoked_function_arn:\"arn:aws:lambda:ap-northeast-1:123456789:function:datadog-ForwarderStack-*****-Forwarder-*****\" bar-apigateway @aws.invoked_function_arn:\"arn:aws:lambda:ap-northeast-1:987654321:function:datadog-ForwarderStack-*****-Forwarder-*****\" baz-apigateway @aws.invoked_function_arn:\"arn:aws:lambda:ap-northeast-1:192837465:function:datadog-ForwarderStack-*****-Forwarder-*****\" ã“ã‚Œã«ã‚ˆã‚Šï¼Œæ§‹é€ åŒ–ãƒ­ã‚°ã®serviceå±æ€§ã«ã‚µãƒ¼ãƒ“ã‚¹å€¤ãŒå‰²ã‚Šå½“ã¦ã‚‰ã‚Œã‚‹ï¼ãªãŠï¼Œserviceå±æ€§ä»¥å¤–ã¯å…ƒã®æ§‹é€ åŒ–ãƒ­ã‚°ã¨åŒã˜ãŸã‚ï¼Œçœç•¥ã—ã¦ã„ã‚‹ï¼ { \"content\": { # ï½ ä¸­ç•¥ ï½ \"service\": \"foo-apigateway\", # ï½ ä¸­ç•¥ ï½ }, # ï½ ä¸­ç•¥ ï½ } ã“ã‚Œã«å¯¾ã—ã¦ï¼Œã‚µãƒ¼ãƒ“ã‚¹ãƒªãƒãƒƒãƒ‘ãƒ¼ã®ãƒ«ãƒ¼ãƒ«ã‚’å®šç¾©ã™ã‚‹ï¼serviceå±æ€§ã®ã‚µãƒ¼ãƒ“ã‚¹å€¤ãŒï¼Œã‚µãƒ¼ãƒ“ã‚¹ãƒ•ã‚¡ã‚»ãƒƒãƒˆã¨ã—ã¦ç™»éŒ²ã•ã‚Œã‚‹ã‚ˆã†ã«ã™ã‚‹ï¼ ãƒ»ãƒ¦ãƒ¼ã‚¶ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆãƒ‘ãƒ¼ã‚µãƒ¼ ï¼Šä¾‹ï¼Š Nginxã‹ã‚‰ï¼Œä»¥ä¸‹ã®ã‚ˆã†ãªéæ§‹é€ åŒ–ãƒ­ã‚°ã‚’å—ä¿¡ã™ã‚‹ã¨ã™ã‚‹ï¼ nn.nnn.nn.nn - - [01/Sep/2021:00:00:00 +0000] \"GET /healthcheck HTTP/1.1\" 200 17 \"-\" \"ELB-HealthChecker/2.0\" ã“ã‚Œã«å¯¾ã—ã¦ï¼Œä»¥ä¸‹ã®ã‚ˆã†ãªGrokãƒ‘ãƒ¼ã‚µãƒ¼ãƒ«ãƒ¼ãƒ«ã‚’å®šç¾©ã™ã‚‹ï¼http.useragentå±æ€§ã«ãƒ¦ãƒ¼ã‚¶ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆå€¤ã‚’å‰²ã‚Šå½“ã¦ã‚‹ï¼ access.common %{_client_ip} %{_ident} %{_auth} \\[%{_date_access}\\] \"(?>%{_method} |)%{_url}(?> %{_version}|)\" %{_status_code} (?>%{_bytes_written}|-) access.combined %{access.common} (%{number:duration:scale(1000000000)} )?\"%{_referer}\" \"%{_user_agent}\"( \"%{_x_forwarded_for}\")?.* error.format %{date(\"yyyy/MM/dd HH:mm:ss\"):date_access} \\[%{word:level}\\] %{data:error.message}(, %{data::keyvalue(\": \",\",\")})? ã“ã‚Œã«ã‚ˆã‚Šï¼Œæ§‹é€ åŒ–ãƒ­ã‚°ã®å„å±æ€§ã«å€¤ãŒå‰²ã‚Šå½“ã¦ã‚‰ã‚Œã‚‹ï¼ { \"date_access\": 12345, \"http\": { \"method\": \"GET\", \"referer\": \"-\", \"status_code\": 200, \"url\": \"/healthcheck\", \"useragent\": \"ELB-HealthChecker/2.0\", \"version\": \"1.1\" }, \"network\": { \"bytes_written\": 17, \"client\": { \"ip\": \"nn.nnn.nnn.nn\" } } } ã“ã‚Œã«å¯¾ã—ã¦ï¼Œãƒ¦ãƒ¼ã‚¶ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆãƒ‘ãƒ¼ã‚µãƒ¼ã®ãƒ«ãƒ¼ãƒ«ã‚’å®šç¾©ã™ã‚‹ï¼http.useragentå±æ€§ã®å€¤ã‚’åˆ†è§£ã—ï¼Œuseragent_detailså±æ€§ã«æŒ¯ã‚Šåˆ†ã‘ã‚‹ã‚ˆã†ã«ã™ã‚‹ï¼ã“ã‚Œã«ã‚ˆã‚Šï¼Œæ§‹é€ åŒ–ãƒ­ã‚°ã®å„å±æ€§ã«å€¤ãŒå‰²ã‚Šå½“ã¦ã‚‰ã‚Œã‚‹ï¼ { # ï½ ä¸­ç•¥ ï½ \"useragent_details\": { \"browser\": { \"family\": \"Chrome\" }, \"device\": { \"category\": \"Other\", \"family\": \"Other\" }, \"os\": { \"family\": \"Linux\" } } # ï½ ä¸­ç•¥ ï½ } ãƒ—ãƒ­ã‚»ãƒƒã‚µãƒ¼ç³» ãƒ»ã‚«ãƒ†ã‚´ãƒªãƒ—ãƒ­ã‚»ãƒƒã‚µãƒ¼ æ¤œç´¢æ¡ä»¶ã«ä¸€è‡´ã™ã‚‹å±æ€§ã‚’æŒã¤æ§‹é€ åŒ–ãƒ­ã‚°ã«å¯¾ã—ã¦ï¼Œå±æ€§ã‚’æ–°ã—ãä»˜ä¸ã™ã‚‹ï¼ ï¼Šä¾‹ï¼Š Nginxã‹ã‚‰ï¼Œä»¥ä¸‹ã®ã‚ˆã†ãªéæ§‹é€ åŒ–ãƒ­ã‚°ã‚’å—ä¿¡ã™ã‚‹ã¨ã™ã‚‹ï¼ nn.nnn.nn.nn - - [01/Sep/2021:00:00:00 +0000] \"GET /healthcheck HTTP/1.1\" 200 17 \"-\" \"ELB-HealthChecker/2.0\" ä»¥ä¸‹ã®ã‚ˆã†ãªGrokãƒ‘ãƒ¼ã‚µãƒ¼ãƒ«ãƒ¼ãƒ«ã‚’å®šç¾©ã™ã‚‹ï¼http.status_codeå±æ€§ã«ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚³ãƒ¼ãƒ‰å€¤ã‚’å‰²ã‚Šå½“ã¦ã‚‹ï¼ access.common %{_client_ip} %{_ident} %{_auth} \\[%{_date_access}\\] \"(?>%{_method} |)%{_url}(?> %{_version}|)\" %{_status_code} (?>%{_bytes_written}|-) access.combined %{access.common} (%{number:duration:scale(1000000000)} )?\"%{_referer}\" \"%{_user_agent}\"( \"%{_x_forwarded_for}\")?.* error.format %{date(\"yyyy/MM/dd HH:mm:ss\"):date_access} \\[%{word:level}\\] %{data:error.message}(, %{data::keyvalue(\": \",\",\")})? ã“ã‚Œã«ã‚ˆã‚Šï¼Œæ§‹é€ åŒ–ãƒ­ã‚°ã®å„å±æ€§ã«å€¤ãŒå‰²ã‚Šå½“ã¦ã‚‰ã‚Œã‚‹ï¼ { \"date_access\": 12345, \"http\": { \"method\": \"GET\", \"referer\": \"-\", \"status_code\": 200, \"url\": \"/healthcheck\", \"useragent\": \"ELB-HealthChecker/2.0\", \"version\": \"1.1\" }, \"network\": { \"bytes_written\": 17, \"client\": { \"ip\": \"nn.nnn.nnn.nn\" } } } ã“ã‚Œã«å¯¾ã—ã¦ï¼Œä»¥ä¸‹ã®ã‚ˆã†ãªã‚«ãƒ†ã‚´ãƒªãƒ‘ãƒ¼ã‚µãƒ¼ã®ãƒ«ãƒ¼ãƒ«ã‚’å®šç¾©ã™ã‚‹ï¼http.status_codeå±æ€§ã®ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚³ãƒ¼ãƒ‰å€¤ã«å¿œã˜ã¦ï¼Œhttp.status_categoryå±æ€§ã«ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãƒ¬ãƒ™ãƒ«å€¤ï¼ˆinfoï¼Œnoticeï¼Œwarningï¼Œerrorï¼‰ã‚’ä»˜ä¸ã™ã‚‹ã‚ˆã†ã«ã™ã‚‹ï¼ info @http.status_code:[200 TO 299] notice @http.status_code:[300 TO 399] warning @http.status_code:[400 TO 499] error @http.status_code:[500 TO 599] ã“ã‚Œã«ã‚ˆã‚Šï¼Œæ§‹é€ åŒ–ãƒ­ã‚°ã®http.status_categoryå±æ€§ã«ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãƒ¬ãƒ™ãƒ«å€¤ãŒå‰²ã‚Šå½“ã¦ã‚‰ã‚Œã‚‹ï¼ãªãŠï¼Œhttp.status_categoryå±æ€§ä»¥å¤–ã¯å…ƒã®æ§‹é€ åŒ–ãƒ­ã‚°ã¨åŒã˜ãŸã‚ï¼Œçœç•¥ã—ã¦ã„ã‚‹ï¼ { # ï½ ä¸­ç•¥ ï½ \"http\": { # ï½ ä¸­ç•¥ ï½ status_category: \"info\" }, # ï½ ä¸­ç•¥ ï½ } ã“ã‚Œã«å¯¾ã—ã¦ï¼Œã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãƒªãƒãƒƒãƒ‘ãƒ¼ã®ãƒ«ãƒ¼ãƒ«ã‚’å®šç¾©ã™ã‚‹ï¼http.status_categoryå±æ€§ã®ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãƒ¬ãƒ™ãƒ«å€¤ãŒï¼Œã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãƒ•ã‚¡ã‚»ãƒƒãƒˆï¼ˆINFOï¼ŒWARNINGï¼ŒERRORï¼Œãªã©ï¼‰ã¨ã—ã¦ç™»éŒ²ã•ã‚Œã‚‹ã‚ˆã†ã«ã™ã‚‹ï¼ ãƒ‘ãƒ¼ã‚¹ãƒ«ãƒ¼ãƒ«ã®æ§‹æˆ ãƒ»ãƒãƒƒãƒãƒ£ãƒ¼ å‚è€ƒï¼šhttps://docs.datadoghq.com/ja/logs/processing/parsing/?tab=matcher#%E3%83%9E%E3%83%83%E3%83%81%E3%83%A3%E3%83%BC%E3%81%A8%E3%83%95%E3%82%A3%E3%83%AB%E3%82%BF%E3%83%BC ãƒ»ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ å‚è€ƒï¼šhttps://docs.datadoghq.com/ja/logs/processing/parsing/?tab=filter#%E3%83%9E%E3%83%83%E3%83%81%E3%83%A3%E3%83%BC%E3%81%A8%E3%83%95%E3%82%A3%E3%83%AB%E3%82%BF%E3%83%BC 07-02. ãƒ­ã‚°ã‚¤ãƒ³ãƒ†ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ ãƒ­ã‚°ã‚¤ãƒ³ãƒ†ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã¨ã¯ ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ï¼ŒãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢ï¼Œã‚¯ãƒ©ã‚¦ãƒ‰ã‚¤ãƒ³ãƒ•ãƒ©ï¼Œãªã©ã®ãƒ­ã‚°ã‚’é›†ç´„çš„ã«åé›†ã—ã‚„ã™ããªã‚‹æ©Ÿèƒ½ã‚’æä¾›ã™ã‚‹ï¼ ç¨®é¡ ãƒ»AWSã®å ´åˆ AWSãƒªã‚½ãƒ¼ã‚¹ã§ç”Ÿæˆã•ã‚ŒãŸãƒ­ã‚°ã‚’Daadogã«è»¢é€ã§ãã‚‹ã‚ˆã†ã«ã—ï¼Œã¾ãŸæ§‹é€ åŒ–ãƒ­ã‚°ã¨ã—ã¦æ¤œç´¢ã§ãã‚‹ã‚ˆã†ã«ã™ã‚‹ï¼æ¬¡ã®æ–¹æ³•ã§ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã™ã‚‹ï¼ ï¼ˆï¼‘ï¼‰Datadogã®AWSã‚¢ã‚«ã‚¦ãƒ³ãƒˆã®ç™»éŒ²ç”»é¢ã§ï¼ŒCloudFormationã«ã‚ˆã‚‹è‡ªå‹•ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã‚’é¸æŠã™ã‚‹ï¼ å‚è€ƒï¼šhttps://app.datadoghq.com/account/settings#integrations/amazon-web-services ï¼ˆï¼’ï¼‰CloudFormationã«ã‚ˆã‚Šï¼Œãƒ¡ãƒˆãƒªã‚¯ã‚¹ï¼ãƒ­ã‚°ï¼åˆ†æ•£ãƒˆãƒ¬ãƒ¼ã‚¹ã‚’è»¢é€ã™ã‚‹Lambdaã‚„IAMãƒ­ãƒ¼ãƒ«ã‚’æ§‹ç¯‰ã™ã‚‹ï¼æ§‹ç¯‰ã•ã‚ŒãŸIAMãƒ­ãƒ¼ãƒ«ï¼ˆDatadogIntegrationRoleï¼‰ã‚’Datadogã®IAMãƒ¦ãƒ¼ã‚¶ï¼ˆ464622532012ï¼‰ã«å§”è­²ã§ãã‚‹ã‚ˆã†ã«ï¼Œã‚¢ã‚«ã‚¦ãƒ³ãƒˆIDã¨ãƒ­ãƒ¼ãƒ«åã‚’Datadogã®è¨­å®šç”»é¢ã«å…¥åŠ›ã™ã‚‹ï¼ å‚è€ƒï¼šhttps://app.datadoghq.com/account/settings#integrations/amazon-web-services ï¼ˆï¼“ï¼‰ã“ã“ã§ã¯ãƒ­ã‚°ã‚’è»¢é€ã§ãã‚‹ã‚ˆã†ã«ï¼ŒLambdaã®ãƒˆãƒªã‚¬ãƒ¼ã¨ã—ã¦CloudWatchãƒ­ã‚°ã‚„S3ã‚’è¨­å®šã™ã‚‹ï¼ãƒˆãƒªã‚¬ãƒ¼ã¨ã—ã¦è¨­å®šã›ãšã«ï¼Œè‡ªå‹•ã§è»¢é€ã™ã‚‹ã“ã¨ã‚‚å¯èƒ½ã§ã‚ã‚‹ãŒï¼Œè‡ªå‹•èªè­˜ã•ã‚Œã‚‹ãƒ­ã‚°ã®ç¨®é¡ãŒå°‘ãªã„ã®ã§ï¼Œæ‰‹å‹•ã§è¨­å®šã—ãŸæ–¹ãŒè‰¯ã„ï¼ å‚è€ƒï¼šhttps://docs.datadoghq.com/logs/guide/send-aws-services-logs-with-the-datadog-lambda-function/?tab=awsconsole#automatically-set-up-triggers ï¼ˆï¼”ï¼‰é€ä¿¡å…ƒã®AWSãƒªã‚½ãƒ¼ã‚¹ã®å‘½åã«ã‚ˆã£ã¦ï¼Œãƒ­ã‚°ã®serviceå±æ€§ã®å€¤ãŒå¤‰ã‚ã‚‹ï¼ä¾‹ãˆã°ï¼ŒCloudWatchãƒ­ã‚°ã®ãƒ­ã‚°ã‚°ãƒ«ãƒ¼ãƒ—åãŒã€api-gateway-***ã€ã‹ã‚‰å§‹ã¾ã‚‹å ´åˆï¼Œå±æ€§å€¤ã¯apigatewayã«ãªã‚‹ï¼ 07-03. ãƒ­ã‚°ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã®å¾Œå‡¦ç† æ¨™æº–å±æ€§ã®ä»˜ä¸ 07-04. ã‚ªãƒ—ã‚·ãƒ§ãƒ³å‡¦ç† ãƒ­ã‚°ã®ãƒ¡ãƒˆãƒªã‚¯ã‚¹ ãƒ»ãƒ­ã‚°ã®ãƒ¡ãƒˆãƒªã‚¯ã‚¹ã¨ã¯ ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã§å‡¦ç†ã‚’çµ‚ãˆãŸãƒ­ã‚°ã«é–¢ã—ã¦ï¼Œå±æ€§ï¼ã‚¿ã‚°ã«åŸºã¥ããƒ¡ãƒˆãƒªã‚¯ã‚¹ã‚’ä½œæˆã™ã‚‹ï¼ãƒ¡ãƒˆãƒªã‚¯ã‚¹ã‚’ä½œæˆã—ã¦ãŠãã¨ï¼Œãƒ­ã‚°ã®ãƒ¬ãƒãƒ¼ãƒˆã¨ã—ã¦ä½¿ç”¨ã§ãã‚‹ï¼ å‚è€ƒï¼šhttps://www.amazon.co.jp/dp/1800568738 ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ ãƒ»ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã¨ã¯ ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã§å‡¦ç†ã‚’çµ‚ãˆãŸãƒ­ã‚°ã‚’ã‚°ãƒ«ãƒ¼ãƒ—åŒ–ã—ï¼Œãƒ­ã‚°ã®ç ´æ£„ãƒ«ãƒ¼ãƒ«ã‚„ä¿ç®¡æœŸé–“ã‚’ã‚°ãƒ«ãƒ¼ãƒ—ã”ã¨ã«å®šç¾©ã§ãã‚‹ï¼ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã‚’ä½¿ç”¨ã™ã‚Œã°ï¼ŒDatadogã®ãƒ­ã‚°ä¿ç®¡ã®ãƒãƒƒã‚¯ã«ãªã‚‹ä¿ç®¡æ–™é‡‘ã‚’æŠ‘ãˆã‚‰ã‚Œã‚‹ï¼ å‚è€ƒï¼š https://docs.datadoghq.com/ja/logs/indexes/ https://tech-blog.abeja.asia/entry/why-datadog ã‚¢ãƒ¼ã‚«ã‚¤ãƒ– ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ«ãƒ¼ãƒ« 07. ãƒ­ã‚°ã‚¨ã‚¯ã‚¹ãƒ—ãƒ­ãƒ¼ãƒ© Live Tail ãƒ»Live Tailã¨ã¯ ãƒ­ã‚°ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³å‡¦ç†å¾Œã®ãƒ­ã‚°ã‚’ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã§ç¢ºèªã§ãã‚‹ï¼ å‚è€ƒï¼šhttps://docs.datadoghq.com/ja/logs/explorer/live_tail/ ãƒ­ã‚°ã‚¯ã‚¨ãƒª ãƒ»ãƒ­ã‚°ã‚¯ã‚¨ãƒª æ§‹é€ åŒ–ãƒ­ã‚°ã®å±æ€§åã¨å€¤ã«åŸºã¥ã„ã¦ï¼Œãƒ­ã‚°ã‚’çµã‚Šè¾¼ã‚ã‚‹ï¼ å‚è€ƒï¼šhttps://docs.datadoghq.com/ja/logs/explorer/search_syntax/ ãƒ»ã‚ªãƒ¼ãƒˆã‚³ãƒ³ãƒ—ãƒªãƒ¼ãƒˆ å…¥åŠ›æ¬„å³ã®ã‚¢ã‚¤ã‚³ãƒ³ã§åˆ‡ã‚Šæ›¿ãˆã‚‹ï¼æ¤œç´¢æ¡ä»¶ã¨ã—ã¦å±æ€§åã¨å€¤ã‚’è£œå®Œå…¥åŠ›ã§ãã‚‹ï¼ã‚ªãƒ¼ãƒˆã‚³ãƒ³ãƒ—ãƒªãƒ¼ãƒˆã‚’ã®ä½¿ç”¨æ™‚ã¯ï¼Œå°æ–‡å­—ã§å…¥åŠ›ã—ãŸå±æ€§åã®é ­æ–‡å­—ãŒç”»é¢ä¸Šã§å¤§æ–‡å­—ã«å¤‰æ›ã•ã‚Œã‚‹ï¼ å…¥åŠ›æ¬„å³ã®ã‚¢ã‚¤ã‚³ãƒ³ã§åˆ‡ã‚Šæ›¿ãˆã‚‹ï¼æ¤œç´¢æ¡ä»¶ã¨ã—ã¦å±æ€§åã¨å€¤ã‚’ãã®ã¾ã¾å…¥åŠ›ã™ã‚‹ï¼ "},"public/observability_monitering/observability_datadog_distributed_trace.html":{"url":"public/observability_monitering/observability_datadog_distributed_trace.html","title":"ğŸ“– ï¸åˆ†æ•£ãƒˆãƒ¬ãƒ¼ã‚¹åé›†","keywords":"","body":"åˆ†æ•£ãƒˆãƒ¬ãƒ¼ã‚¹åé›† ã¯ã˜ã‚ã« æœ¬ã‚µã‚¤ãƒˆã«ã¤ãã¾ã—ã¦ï¼Œä»¥ä¸‹ã‚’ã”èªè­˜ã®ã»ã©å®œã—ããŠé¡˜ã„ã„ãŸã—ã¾ã™ï¼ å‚è€ƒï¼šhttps://hiroki-it.github.io/tech-notebook-gitbook/ 01. ãƒˆãƒ¬ãƒ¼ã‚µãƒ¼ ãƒˆãƒ¬ãƒ¼ã‚µãƒ¼ã¨ã¯ APMæ©Ÿèƒ½ã‚’ç”¨ã„ã‚‹æ™‚ã«ï¼Œãƒˆãƒ¬ãƒ¼ã‚¹ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆãŒç¨¼åƒã™ã‚‹Datadogã‚³ãƒ³ãƒ†ãƒŠã«åˆ†æ•£ãƒˆãƒ¬ãƒ¼ã‚¹ã‚’é€ä¿¡ã§ãã‚‹ã‚ˆã†ï¼Œã‚µãƒ¼ãƒ“ã‚¹ã®ã‚³ãƒ³ãƒ†ãƒŠã§ãƒˆãƒ¬ãƒ¼ã‚µãƒ¼ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹å¿…è¦ãŒã‚ã‚‹ï¼ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã¯ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã«ã‚ˆã£ã¦èª­ã¿è¾¼ã¾ã‚ŒãŸå¾Œï¼Œã€http://localhost:8126ã€ã‚’æŒ‡å®šã—ã¦ï¼Œåˆ†æ•£ãƒˆãƒ¬ãƒ¼ã‚¹ã‚’é€ä¿¡ã™ã‚‹ã‚ˆã†ã«ãªã‚‹ï¼ å‚è€ƒï¼šhttps://docs.datadoghq.com/ja/tracing/#datadog-%E3%81%B8%E3%83%88%E3%83%AC%E3%83%BC%E3%82%B9%E3%82%92%E9%80%81%E4%BF%A1 ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ä¸€è¦§ å‚è€ƒï¼šhttps://docs.datadoghq.com/ja/developers/libraries/#apm-%E3%81%A8%E5%88%86%E6%95%A3%E5%9E%8B%E3%83%88%E3%83%AC%E3%83%BC%E3%82%B7%E3%83%B3%E3%82%B0%E3%82%AF%E3%83%A9%E3%82%A4%E3%82%A2%E3%83%B3%E3%83%88%E3%83%A9%E3%82%A4%E3%83%96%E3%83%A9%E3%83%AA PHPãƒˆãƒ¬ãƒ¼ã‚µãƒ¼ ãƒ»ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ« å„ã‚µãƒ¼ãƒ“ã‚¹ã®Dockerfileã«ã¦ï¼Œãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹ï¼ å‚è€ƒï¼šhttps://docs.datadoghq.com/tracing/setup_overview/setup/php/?tab=containers ENV DD_TRACE_VERSION=0.63.0 # GitHubã‹ã‚‰ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ RUN curl -Lo https://github.com/DataDog/dd-trace-php/releases/download/${DD_TRACE_VERSION}/datadog-php-tracer_${DD_TRACE_VERSION}_amd64.deb \\ # è§£å‡ && dpkg -i datadog-php-tracer.deb \\ # æ®‹éª¸ãƒ•ã‚¡ã‚¤ãƒ«ã‚’å‰Šé™¤ && rm datadog-php-tracer.deb ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãŒãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’èª­ã¿è¾¼ã‚“ã ã‹å¦ã‹ã‚’ã‚³ãƒãƒ³ãƒ‰ã§ç¢ºèªã§ãã‚‹ï¼ # æˆåŠŸã®å ´åˆ root@*****:/ php --ri=ddtrace ddtrace Datadog PHP tracer extension For help, check out the documentation at https://docs.datadoghq.com/tracing/languages/php/ (c) Datadog 2020 ... ã¾ã ã¾ã ç¶šã # å¤±æ•—ã®å ´åˆ root@*****:/ php --ri=ddtrace Extension 'ddtrace' not present. ãƒ»ç’°å¢ƒå¤‰æ•° ç’°å¢ƒå¤‰æ•°ã‚’ä½¿ç”¨ã§ãã‚‹ï¼åˆ†æ•£ãƒˆãƒ¬ãƒ¼ã‚¹ã®ã‚¿ã‚°åã«åæ˜ ã•ã‚Œã‚‹ï¼ç’°å¢ƒå¤‰æ•°ã«ã¤ã„ã¦ã¯ï¼Œä»¥ä¸‹ã®ãƒªãƒ³ã‚¯ã‚’å‚è€ƒã«ã›ã‚ˆï¼ å‚è€ƒï¼šhttps://docs.datadoghq.com/ja/tracing/setup_overview/setup/php/?tab=%E3%82%B3%E3%83%B3%E3%83%86%E3%83%8A#%E7%92%B0%E5%A2%83%E5%A4%89%E6%95%B0%E3%82%B3%E3%83%B3%E3%83%95%E3%82%A3%E3%82%AE%E3%83%A5%E3%83%AC%E3%83%BC%E3%82%B7%E3%83%A7%E3%83%B3 å¤‰æ•°å èª¬æ˜ ç”»é¢ DD_SERVICE_MAPPING åˆ†æ•£ãƒˆãƒ¬ãƒ¼ã‚¹ã«ã‚µãƒ¼ãƒ“ã‚¹åã‚’è¨­å®šã™ã‚‹ï¼ã‚µãƒ¼ãƒ“ã‚¹åã¯æ¨™æº–ã®ã§ã‚¤ãƒ³ãƒ†ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³åã«ãªã‚‹ãŒï¼Œã“ã‚Œã‚’ä¸Šæ›¸ãã§ãã‚‹ï¼ˆä¾‹ï¼‰laravel:foo-laravel,pdo:foo-pdo https://app.datadoghq.com/apm/services DD_SERVICE_NAME åˆ†æ•£ãƒˆãƒ¬ãƒ¼ã‚¹ã«ã‚µãƒ¼ãƒ“ã‚¹åã‚’è¨­å®šã™ã‚‹ï¼DD_SERVICE_MAPPINGãŒnullã®å ´åˆï¼Œã“ã®ç’°å¢ƒå¤‰æ•°ã®å€¤ãŒä»£ã‚ã‚Šã«ã‚µãƒ¼ãƒ“ã‚¹åã«ãªã‚‹ï¼ˆä»•çµ„ã¿ãŒã‚ˆãã‚ã‹ã‚‰ã‚“ï¼‰ï¼ DD_TRACE__ENABLED æœ‰åŠ¹åŒ–ã™ã‚‹ã‚¤ãƒ³ãƒ†ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³åã‚’è¨­å®šã™ã‚‹ï¼æ¨™æº–ã§å…¨ã¦ã®ã‚¤ãƒ³ãƒ†ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãŒæœ‰åŠ¹åŒ–ã•ã‚Œã¦ã„ã‚‹ãŸã‚ï¼Œè¨­å®šã¯ä¸è¦ã§ã‚ã‚‹ï¼Datadogã®ã‚¤ãƒ³ãƒ†ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ç„¡åŠ¹åŒ–ã™ã‚‹å ´åˆã¯ DD__DISABLED ç„¡åŠ¹åŒ–ã™ã‚‹ã‚¤ãƒ³ãƒ†ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³åã‚’è¨­å®šã™ã‚‹ï¼ ãƒˆãƒ¬ãƒ¼ã‚µãƒ¼ã®è¨­å®šã®çŠ¶æ…‹ã¯ï¼Œphp --ri=ddtraceã‚³ãƒãƒ³ãƒ‰ã®çµæœå¾—ã‚‰ã‚Œã‚‹JSONã‚’æ•´å½¢ã™ã‚‹ã“ã¨ã§ç¢ºèªã§ãã‚‹ï¼ root@*****:/ php --ri=ddtrace Datadog tracing support => enabled Version => 0.57.0 DATADOG TRACER CONFIGURATION => { ..... } # Node.jsãƒˆãƒ¬ãƒ¼ã‚µãƒ¼ ãƒ»TypeScriptã‚„ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ãƒãƒ³ãƒ‰ãƒ«ã‚’ä½¿ã£ã¦ã„ã‚‹å ´åˆ ã‚¨ãƒ³ãƒˆãƒªãƒã‚¤ãƒ³ãƒˆã¨ãªã‚‹nuxt.config.jsãƒ•ã‚¡ã‚¤ãƒ«ã«ã¦ï¼Œä¸€ç•ªæœ€åˆã«Datadogã®ãƒˆãƒ¬ãƒ¼ã‚¹ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’èª­ã¿è¾¼ã¿ï¼ŒåˆæœŸåŒ–ã™ã‚‹ï¼ å‚è€ƒï¼šhttps://docs.datadoghq.com/ja/tracing/setup_overview/setup/nodejs/?tab=%E3%82%B3%E3%83%B3%E3%83%86%E3%83%8A#typescript-%E3%81%A8%E3%83%90%E3%83%B3%E3%83%89%E3%83%A9%E3%83%BC import 'dd-trace/init' // ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã‚’å«ã‚€ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®ã‚¤ãƒ³ãƒãƒ¼ãƒˆãŒç¶šã ã¾ãŸï¼ŒåˆæœŸåŒ–æ™‚ã«è¨­å®šã—ãŸç’°å¢ƒå¤‰æ•°ã‚’ä½¿ç”¨ã§ãã‚‹ï¼APMã®ã‚µãƒ¼ãƒ“ã‚¹ã®ã‚¿ã‚°åã«åæ˜ ã•ã‚Œã‚‹ï¼ å‚è€ƒï¼šhttps://docs.datadoghq.com/ja/tracing/setup_overview/setup/nodejs/?tab=%E3%82%B3%E3%83%B3%E3%83%86%E3%83%8A#%E3%82%B3%E3%83%B3%E3%83%95%E3%82%A3%E3%82%AE%E3%83%A5%E3%83%AC%E3%83%BC%E3%82%B7%E3%83%A7%E3%83%B3 02. åˆ†æ•£ãƒˆãƒ¬ãƒ¼ã‚¹ã®ç”Ÿæˆ åˆ†æ•£ãƒˆãƒ¬ãƒ¼ã‚¹ ãƒ»åˆ†æ•£ãƒˆãƒ¬ãƒ¼ã‚¹ã¨ã¯ å‚è€ƒï¼šhttps://hiroki-it.github.io/tech-notebook-gitbook/public/observability_monitering/observability.html ãƒ»æ§‹é€  Datadogã«ãŠã„ã¦ï¼Œåˆ†æ•£ãƒˆãƒ¬ãƒ¼ã‚¹ã¯ã‚¹ãƒ‘ãƒ³ã‚’æŒã¤é…åˆ—ãƒ‡ãƒ¼ã‚¿ã¨ã—ã¦å®šç¾©ã•ã‚Œã‚‹ï¼ å‚è€ƒï¼šhttps://docs.datadoghq.com/tracing/guide/send_traces_to_agent_by_api/ [ span1, span2, span3 ] ã¾ãŸï¼Œè¤‡æ•°ã®åˆ†æ•£ãƒˆãƒ¬ãƒ¼ã‚¹ã‚’é…åˆ—ãƒ‡ãƒ¼ã‚¿ã¨ã—ã¦å®šç¾©ã§ãã‚‹ï¼ [ trace1, trace2, trace3 ] ã‚¹ãƒ‘ãƒ³ ãƒ»ã‚¹ãƒ‘ãƒ³ã¨ã¯ å‚è€ƒï¼šhttps://hiroki-it.github.io/tech-notebook-gitbook/public/observability_monitering/observability.html ãƒ»æ§‹é€  Datadogã«ãŠã„ã¦ï¼Œã‚¹ãƒ‘ãƒ³ã¯JSONå‹ãƒ‡ãƒ¼ã‚¿ã¨ã—ã¦å®šç¾©ã•ã‚Œã‚‹ï¼ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å†…ã®ãƒˆãƒ¬ãƒ¼ã‚µãƒ¼ã«ãŠã„ã¦ï¼ŒæŒ‡å®šã•ã‚ŒãŸJSONå‹ã®ã‚¹ãƒ‘ãƒ³ãŒä½œæˆã•ã‚Œï¼Œã‚¹ãƒ‘ãƒ³ã¯Datadog-APIã«é€ä¿¡ã•ã‚Œã‚‹ï¼ å‚è€ƒï¼šhttps://docs.datadoghq.com/tracing/guide/send_traces_to_agent_by_api/ ï¼Šå®Ÿè£…ä¾‹ï¼Š [ [ { \"duration\": 123, # å‡¦ç†ã®æ‰€è¦æ™‚é–“ \"error\": 0, # ã‚¨ãƒ©ãƒ¼ã®æœ‰ç„¡ \"meta\": { \"env\": \"prd\" # ã‚¿ã‚°ã®ã‚Š }, \"metrics\": { \"baz-sum\": 123 # ã‚µãƒ¼ãƒ“ã‚¹ã®ãƒ¡ãƒˆãƒªã‚¯ã‚¹ }, \"name\": \"laravel.request\", # ã‚¹ãƒ‘ãƒ³å \"parent_id\": 123, # è¦ªã‚¹ãƒ‘ãƒ³ID \"resource\": \"/foos\", # ã‚¢ã‚¯ã‚»ã‚¹ã•ã‚ŒãŸãƒªã‚½ãƒ¼ã‚¹ \"service\": \"laravel\", # ã‚µãƒ¼ãƒ“ã‚¹å \"span_id\": 123456789, # ã‚¹ãƒ‘ãƒ³ID \"start\": 0, # å‡¦ç†é–‹å§‹æ™‚é–“ \"trace_id\": 123456789, # ãƒˆãƒ¬ãƒ¼ã‚¹ID \"type\": \"web\" # ã‚µãƒ¼ãƒ“ã‚¹ã®ã‚¿ã‚¤ãƒ— } ] ] ãƒ»ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ ã‚¹ãƒ‘ãƒ³ã®metaã‚­ãƒ¼ã«ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã®ã‚»ãƒƒãƒˆã‚’å‰²ã‚Šå½“ã¦ã‚‰ã‚Œã‚‹ï¼ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã¯ã‚¿ã‚°ã¨ã—ã¦æ©Ÿèƒ½ã™ã‚‹ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š PHPãƒˆãƒ¬ãƒ¼ã‚µãƒ¼ã§laravelå†…ã‹ã‚‰ã‚¿ã‚°ã‚’åé›†ã—ãŸä¾‹ { \"env\": \"prd\", \"http\": { \"host\": \"example.co.jp\", \"method\": \"GET\", \"path_group\": \"/foos\", \"status_code\": 200, \"url\": \"https://example.co.jp/foos/1\" }, \"laravel\": { \"route\": { \"action\": \"App\\Http\\Controllers\\Foo\\FooController@get\", \"name\": \"foos.get\" } }, \"php\" : { \"compilation\": { \"total_time_ms\": 123.45 } }, \"process_id\": 100 } ã‚¹ãƒ‘ãƒ³ã®ãƒ¡ãƒˆãƒªã‚¯ã‚¹ ãƒ»ã‚¹ãƒ‘ãƒ³ã®ãƒ‡ãƒ¼ã‚¿ãƒã‚¤ãƒ³ãƒˆåŒ– ã‚¹ãƒ‘ãƒ³ã®æŒã¤ãƒ‡ãƒ¼ã‚¿ã‚’ãƒ‡ãƒ¼ã‚¿ãƒã‚¤ãƒ³ãƒˆã¨ã—ã¦é›†è¨ˆã™ã‚‹ã¨ï¼Œãƒ¡ãƒˆãƒªã‚¯ã‚¹ã‚’åé›†ã§ãã‚‹ï¼ å‚è€ƒï¼šhttps://docs.datadoghq.com/ja/tracing/generate_metrics/ ãƒ»ãƒ¡ãƒˆãƒªã‚¯ã‚¹åã®æ§‹æˆè¦ç´  ãƒ¡ãƒˆãƒªã‚¯ã‚¹åã¯ã€trace..ã€ã®åå‰ã§æ§‹æˆã•ã‚Œã‚‹ï¼ å‚è€ƒï¼šhttps://docs.datadoghq.com/ja/tracing/guide/metrics_namespace/ ãƒ»ãƒ¡ãƒˆãƒªã‚¯ã‚¹ã®ã‚¹ãƒ‘ãƒ³å ãƒ‡ãƒ¼ã‚¿ãƒã‚¤ãƒ³ãƒˆã¨ãªã£ãŸã‚¹ãƒ‘ãƒ³åãŒå‰²ã‚Šå½“ã¦ã‚‰ã‚Œã‚‹ï¼ ï¼Šä¾‹ï¼Š trace.web.request. trace.db.query. trace.db.commit. ãƒ»ãƒ¡ãƒˆãƒªã‚¯ã‚¹ã®ãƒ¡ãƒˆãƒªã‚¯ã‚¹ã‚µãƒ•ã‚£ãƒƒã‚¯ã‚¹å ãƒ¡ãƒˆãƒªã‚¯ã‚¹ã®ç¨®é¡ã«å¿œã˜ãŸã‚µãƒ•ã‚£ãƒƒã‚¯ã‚¹åãŒå‰²ã‚Šå½“ã¦ã‚‰ã‚Œã‚‹ï¼ å‚è€ƒï¼šhttps://docs.datadoghq.com/ja/tracing/guide/metrics_namespace/#%E3%83%A1%E3%83%88%E3%83%AA%E3%82%AF%E3%82%B9%E3%82%B5%E3%83%95%E3%82%A3%E3%83%83%E3%82%AF%E3%82%B9 ï¼Šä¾‹ï¼Š trace..hits.***ï¼ˆè©²å½“ã‚¹ãƒ‘ãƒ³ã®ãƒ’ãƒƒãƒˆæ•°ï¼‰ trace..durationï¼ˆè©²å½“ã‚¹ãƒ‘ãƒ³ã®å‡¦ç†æ™‚é–“ï¼‰ trace..duration.by.***ï¼ˆè©²å½“ã‚¹ãƒ‘ãƒ³ã®å‡¦ç†æ™‚é–“ã®å‰²åˆï¼‰ trace..errors.***ï¼ˆè©²å½“ã‚¹ãƒ‘ãƒ³ã«ãŠã‘ã‚‹ã‚¨ãƒ©ãƒ¼æ•°ï¼‰ 03. ã‚µãƒ¼ãƒ“ã‚¹ã®è­˜åˆ¥ ã‚µãƒ¼ãƒ“ã‚¹ã‚¿ã‚¤ãƒ— ãƒ»ã‚µãƒ¼ãƒ“ã‚¹ã‚¿ã‚¤ãƒ—ã¨ã¯ ãƒˆãƒ¬ãƒ¼ã‚µã«ã‚ˆã£ã¦ï¼Œã‚µãƒ¼ãƒ“ã‚¹ã¯ã€Webã€ã€DBã€ã€Cacheã€ã€Cacheã€ã®ï¼”ã¤ã«åˆ†é¡ã•ã‚Œã‚‹ï¼å„ã‚µãƒ¼ãƒ“ã‚¹ã®span.typeå±æ€§ã«å‰²ã‚Šå½“ã¦ã‚‰ã‚Œã‚‹ã‚¿ã‚¤ãƒ—åã‹ã‚‰è‡ªå‹•çš„ã«å‰²ã‚ŠæŒ¯ã‚‰ã‚Œã‚‹ï¼ã‚¿ã‚¤ãƒ—åã®ç¨®é¡ã«ã¤ã„ã¦ã¯ï¼Œä»¥ä¸‹ã®ãƒªãƒ³ã‚¯ã‚’å‚è€ƒã«ã›ã‚ˆï¼ å‚è€ƒï¼š https://github.com/DataDog/dd-trace-php/blob/master/src/api/Type.php https://docs.datadoghq.com/ja/tracing/visualization/services_list/#%E3%82%B5%E3%83%BC%E3%83%93%E3%82%B9%E3%82%BF%E3%82%A4%E3%83%97 ã‚µãƒ¼ãƒ“ã‚¹ã®ã‚¿ã‚° ãƒ»ã‚µãƒ¼ãƒ“ã‚¹ã®ã‚¿ã‚°ã¨ã¯ ãƒˆãƒ¬ãƒ¼ã‚µã«ã‚ˆã£ã¦ï¼Œã‚µãƒ¼ãƒ“ã‚¹ã«ã‚¿ã‚°ã‚’è¿½åŠ ã§ãã‚‹ï¼PHPãƒˆãƒ¬ãƒ¼ã‚µã®å„ã‚¤ãƒ³ãƒ†ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã®ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã«ã¤ã„ã¦ã¯ä»¥ä¸‹ã®ãƒªãƒ³ã‚¯ã‚’å‚è€ƒã«ã›ã‚ˆï¼ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã‹ã‚‰ï¼ŒPHPãƒˆãƒ¬ãƒ¼ã‚µãƒ¼ãŒã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‹ã‚‰ã©ã®ã‚ˆã†ã«æƒ…å ±ã‚’æŠœãå‡ºã—ï¼Œåˆ†æ•£ãƒˆãƒ¬ãƒ¼ã‚¹ã®ã‚¿ã‚°ã®å€¤ã‚’æ±ºå®šã—ã¦ã„ã‚‹ã‹ãŒã‚ã‹ã‚‹ï¼ å‚è€ƒï¼š https://github.com/DataDog/dd-trace-php/tree/master/src/DDTrace/Integrations https://github.com/DataDog/dd-trace-php/blob/master/src/api/Tag.php 04. åˆ†æ•£ãƒˆãƒ¬ãƒ¼ã‚¹ã‚¤ãƒ³ãƒ†ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ åˆ†æ•£ãƒˆãƒ¬ãƒ¼ã‚¹ã‚¤ãƒ³ãƒ†ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã¨ã¯ è¨€èªï¼ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ï¼ãƒ„ãƒ¼ãƒ«ï¼Œãªã©ã«é–¢ã—ã¦ï¼Œå°‚ç”¨ã®åˆ†æ•£ãƒˆãƒ¬ãƒ¼ã‚¹ã‚’åé›†ã§ãã‚‹ã‚ˆã†ã«ãªã‚‹ï¼ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã¨ã—ã¦ä½¿ç”¨ã•ã‚Œã‚‹è¨€èªï¼ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã®å ´åˆï¼Œãƒˆãƒ¬ãƒ¼ã‚¹ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆãŒã‚¤ãƒ³ãƒ†ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å‡¦ç†ã‚’æŒã¤ãŸã‚ï¼Œã‚µãƒ¼ãƒï¼ã‚³ãƒ³ãƒ†ãƒŠã¸ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã¯ä¸è¦ã§ã‚ã‚‹ï¼ã«ã¤ã„ã¦ã¯ï¼Œä»¥ä¸‹ã®ãƒªãƒ³ã‚¯ã‚’å‚è€ƒã«ã›ã‚ˆï¼ å‚è€ƒï¼šhttps://github.com/DataDog/dd-trace-php/tree/master/src/DDTrace/Integrations "},"public/observability_monitering/observability_datadog_telemetry_association.html":{"url":"public/observability_monitering/observability_datadog_telemetry_association.html","title":"ğŸ“– ï¸ãƒ†ãƒ¬ãƒ¡ãƒˆãƒªãƒ¼é–“ã®ç´ã¥ã‘","keywords":"","body":"ãƒ†ãƒ¬ãƒ¡ãƒˆãƒªãƒ¼é–“ã®ç´ä»˜ã‘ 01. ã‚¿ã‚° ã‚¿ã‚°ã®ç¨®é¡ å‚è€ƒï¼š https://docs.datadoghq.com/ja/getting_started/tagging/ https://www.datadoghq.com/ja/blog/tagging-best-practices/ ã‚¿ã‚°å èª¬æ˜ host ãƒ¡ãƒˆãƒªã‚¯ã‚¹ï¼Œãƒ­ã‚°ï¼Œåˆ†æ•£ãƒˆãƒ¬ãƒ¼ã‚¹ã®é€ä¿¡å…ƒã®ãƒ›ã‚¹ãƒˆåã‚’ç¤ºã™ï¼ãƒ†ãƒ¬ãƒ¡ãƒˆãƒªãƒ¼ãŒç”Ÿæˆå…ƒã¨ã¯åˆ¥ã®å ´æ‰€ã‹ã‚‰é€ä¿¡ã•ã‚Œã¦ã„ã‚‹å ´åˆã«å½¹ç«‹ã¤ï¼ device source ãƒ­ã‚°ã®ç”Ÿæˆå…ƒã®ãƒ™ãƒ³ãƒ€ãƒ¼åã‚’ç¤ºã™ï¼ service ãƒ¡ãƒˆãƒªã‚¯ã‚¹ï¼Œãƒ­ã‚°ï¼Œåˆ†æ•£ãƒˆãƒ¬ãƒ¼ã‚¹ã®ç”Ÿæˆå…ƒã®ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³åã‚’ç¤ºã™ï¼ env ãƒ¡ãƒˆãƒªã‚¯ã‚¹ï¼Œãƒ­ã‚°ï¼Œåˆ†æ•£ãƒˆãƒ¬ãƒ¼ã‚¹ã®ç”Ÿæˆå…ƒã®å®Ÿè¡Œç’°å¢ƒåã‚’ç¤ºã™ï¼ version ãƒ¡ãƒˆãƒªã‚¯ã‚¹ï¼Œãƒ­ã‚°ï¼Œåˆ†æ•£ãƒˆãƒ¬ãƒ¼ã‚¹ã®ç”Ÿæˆå…ƒã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³åã‚’ç¤ºã™ï¼ çµ±åˆã‚¿ã‚°ä»˜ã‘ çµ±åˆã‚¿ã‚°ï¼ˆserviceï¼Œenvï¼Œversionï¼‰ã«åŒã˜å€¤ã‚’å‰²ã‚Šå½“ã¦ã‚‹ã¨ï¼Œãƒ†ãƒ¬ãƒ¡ãƒˆãƒªãƒ¼é–“ã‚’ç´ã¥ã‘ã‚‰ã‚Œã‚‹ï¼ å‚è€ƒï¼šhttps://docs.datadoghq.com/ja/getting_started/tagging/unified_service_tagging/?tab=kubernetes å„ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ç”»é¢ã§ã®ä½¿ã„æ–¹ å‚è€ƒï¼šhttps://docs.datadoghq.com/ja/getting_started/tagging/using_tags/ 02. æ§‹é€ åŒ–ãƒ­ã‚°ã¨ä»–ãƒ†ãƒ¬ãƒ¡ãƒˆãƒªãƒ¼é–“ã®ç´ä»˜ã‘ åˆ†æ•£ãƒˆãƒ¬ãƒ¼ã‚¹å…¨ä½“ã¨ã®ç´ä»˜ã‘ ã‚¹ãƒ‘ãƒ³ã¨æ§‹é€ åŒ–ãƒ­ã‚°ã®çµ±åˆã‚¿ã‚°ï¼ˆserviceï¼Œenvï¼Œversionï¼‰ã«åŒã˜å€¤ã‚’å‰²ã‚Šå½“ã¦ã‚‹ã¨ï¼Œåˆ†æ•£ãƒˆãƒ¬ãƒ¼ã‚¹å…¨ä½“ã¨æ§‹é€ åŒ–ãƒ­ã‚°é–“ã‚’ç´ä»˜ã‘ã‚‰ã‚Œã‚‹ï¼ å‚è€ƒï¼šhttps://docs.datadoghq.com/ja/tracing/connect_logs_and_traces/ ã‚¹ãƒ‘ãƒ³ã¨ã®ç´ä»˜ã‘ ã‚¹ãƒ‘ãƒ³ã¨æ§‹é€ åŒ–ãƒ­ã‚°ã«ï¼ŒåŒã˜ãƒˆãƒ¬ãƒ¼ã‚¹IDã¨ã‚¹ãƒ‘ãƒ³IDã‚’å‰²ã‚Šå½“ã¦ã‚‹ã¨ï¼Œã‚¹ãƒ‘ãƒ³ã¨æ§‹é€ åŒ–ãƒ­ã‚°é–“ã‚’ç´ä»˜ã‘ã‚‰ã‚Œã‚‹ï¼ã“ã‚Œã«ã‚ˆã‚Šï¼Œãã®æ§‹é€ åŒ–ãƒ­ã‚°ãŒï¼Œã„ãšã‚Œã®ã‚µãƒ¼ãƒ“ã‚¹ã§ï¼Œã¾ãŸã©ã®ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã§ç™ºç”Ÿã—ãŸã‚‚ã®ã‹ã‚’ç¢ºèªã§ãã‚‹ï¼ å‚è€ƒï¼šhttps://docs.datadoghq.com/tracing/visualization/trace/?tab=logs 03. ãƒ¡ãƒˆãƒªã‚¯ã‚¹ã¨ä»–ãƒ†ãƒ¬ãƒ¡ãƒˆãƒªãƒ¼é–“ã®ç´ä»˜ã‘ ã‚µãƒ¼ãƒï¼ã‚³ãƒ³ãƒ†ãƒŠã®ãƒ¡ãƒˆãƒªã‚¯ã‚¹ã¨ã®ç´ä»˜ã‘ ã‚¹ãƒ‘ãƒ³ã¨ã‚³ãƒ³ãƒ†ãƒŠã®DockerLabelã®çµ±åˆã‚¿ã‚°ï¼ˆserviceï¼Œenvï¼Œversionï¼‰ã«ï¼ŒåŒã˜å€¤ã‚’å‰²ã‚Šå½“ã¦ã‚‹ã¨ï¼Œåˆ†æ•£ãƒˆãƒ¬ãƒ¼ã‚¹ã¨ã‚µãƒ¼ãƒï¼ã‚³ãƒ³ãƒ†ãƒŠã®OSã«é–¢ã™ã‚‹ãƒ¡ãƒˆãƒªã‚¯ã‚¹ã‚’ç´ä»˜ã‘ã‚‰ã‚Œã‚‹ï¼ "},"public/observability_monitering/observability_datadog_monitering.html":{"url":"public/observability_monitering/observability_datadog_monitering.html","title":"ğŸ“– ï¸ç›£è¦–","keywords":"","body":"ç›£è¦– ã¯ã˜ã‚ã« æœ¬ã‚µã‚¤ãƒˆã«ã¤ãã¾ã—ã¦ï¼Œä»¥ä¸‹ã‚’ã”èªè­˜ã®ã»ã©å®œã—ããŠé¡˜ã„ã„ãŸã—ã¾ã™ï¼ å‚è€ƒï¼šhttps://hiroki-it.github.io/tech-notebook-gitbook/ 01. ãƒ¢ãƒ‹ã‚¿ãƒ¼ ãƒ¢ãƒ‹ã‚¿ãƒ¼ã¨ã¯ ãƒ¡ãƒˆãƒªã‚¯ã‚¹ï¼ãƒ­ã‚°ã‚’ç›£è¦–ã—ï¼Œã‚·ã‚¹ãƒ†ãƒ ã®äºˆæ¸¬å¯èƒ½ãªä¸å…·åˆã®ç™ºç”Ÿã‚’æœªç„¶ã«é˜²ãï¼ ãƒ­ã‚°ãƒ¢ãƒ‹ã‚¿ãƒ¼ ãƒ»ãƒ­ã‚°ã‚¯ã‚¨ãƒªã®å‹•ä½œç¢ºèª ãƒ­ã‚°ãƒ¢ãƒ‹ã‚¿ãƒ¼ã®ã‚¯ã‚¨ãƒªã¯ï¼Œãƒ­ã‚°ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã¨åŒã˜ä»•çµ„ã¿ã§æ©Ÿèƒ½ã™ã‚‹ï¼ãã®ãŸã‚ï¼Œæœ€åˆã¯ãƒ­ã‚°ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã§å¿…è¦ãªãƒ­ã‚°ã‚’çµã‚Šè¾¼ã‚ã‚‹ã‹ã‚’ç¢ºèªã—ï¼Œå•é¡Œãªã‘ã‚Œã°ãƒ­ã‚°ãƒ¢ãƒ‹ã‚¿ãƒ¼ã®ã‚¯ã‚¨ãƒªã‚’è¨­å®šã™ã‚‹ï¼ å‚è€ƒï¼šhttps://docs.datadoghq.com/ja/monitors/monitor_types/log/#%E6%A4%9C%E7%B4%A2%E3%82%AF%E3%82%A8%E3%83%AA%E3%82%92%E5%AE%9A%E7%BE%A9%E3%81%99%E3%82%8B ãƒ»ã‚·ãƒ³ã‚°ãƒ«ã‚¢ãƒ©ãƒ¼ãƒˆ ãƒ»ãƒãƒ«ãƒã‚¢ãƒ©ãƒ¼ãƒˆ ãƒ­ã‚°ã‚¯ã‚¨ãƒªã§group byå¥ã‚’å®šç¾©ã™ã‚‹ã¨ï¼Œé¸æŠã§ãã‚‹ã‚ˆã†ã«ãªã‚‹ï¼ 01-02. é€šçŸ¥å†…å®¹ã®å®šç¾© ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆå¤‰æ•° å‚è€ƒï¼šhttps://docs.datadoghq.com/ja/monitors/notify/variables/?tab=is_alert#template-variables ãƒãƒ«ãƒã‚¢ãƒ©ãƒ¼ãƒˆå¤‰æ•° ãƒ»ãƒãƒ«ãƒã‚¢ãƒ©ãƒ¼ãƒˆå¤‰æ•°ã¨ã¯ ã‚¯ã‚¨ãƒªã®group byå¥ã«å‰²ã‚Šå½“ã¦ãŸã‚¿ã‚°ã‚„ãƒ•ã‚¡ã‚»ãƒƒãƒˆã‚’å¤‰æ•°ã¨ã—ã¦å‡ºåŠ›ã™ã‚‹ï¼ãƒãƒ«ãƒã‚¢ãƒ©ãƒ¼ãƒˆãƒ¢ãƒ‹ã‚¿ãƒ¼ã‚’ä½¿ç”¨ã™ã‚‹å ´åˆã®ã¿ï¼Œä½¿ç”¨ã§ãã‚‹ï¼ ã‚¿ã‚°å¤‰æ•° ãƒ»ã‚¿ã‚°å¤‰æ•°ã¨ã¯ æ§‹é€ åŒ–ãƒ­ã‚°ã®å±æ€§å€¤ã¾ãŸã¯ã‚¿ã‚°å€¤ã‚’å¤‰æ•°ã¨ã—ã¦å‡ºåŠ›ã™ã‚‹ï¼{{log.attributes.}} ã¾ãŸã¯{{log.tags.}}ã¨ã—ã¦å®Ÿè£…ã™ã‚‹ï¼ å‚è€ƒï¼šhttps://docs.datadoghq.com/ja/monitors/notify/variables/?tab=is_alert#matching-attributetag-variables ã‚³ãƒ³ãƒã‚¸ãƒƒãƒˆãƒ¢ãƒ‹ã‚¿ãƒ¼å¤‰æ•° ãƒ»ã‚³ãƒ³ãƒã‚¸ãƒƒãƒˆãƒ¢ãƒ‹ã‚¿ãƒ¼å¤‰æ•°ã¨ã¯ å‚è€ƒï¼šhttps://docs.datadoghq.com/ja/monitors/notify/variables/?tab=is_alert#composite-monitor-variables æ¡ä»¶å¤‰æ•° å‚è€ƒï¼šhttps://docs.datadoghq.com/ja/monitors/notify/variables/?tab=is_alert#conditional-variables ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®æ§‹æˆ ãƒ»ã‚¿ã‚¤ãƒˆãƒ« é€šçŸ¥å…ˆã«ã‚¿ã‚¤ãƒˆãƒ«ã¨ã—ã¦è¡¨ç¤ºã™ã‚‹ãƒ†ã‚­ã‚¹ãƒˆã‚’å®šç¾©ã™ã‚‹ï¼ã‚¿ã‚¤ãƒˆãƒ«ã«å¤‰æ•°ã‚’å‡ºåŠ›ã§ãã‚‹ï¼ ã€{{log.attributes.service}}ã€‘ï½ˆç’°å¢ƒã§ã‚¨ãƒ©ãƒ¼ã‚’æ¤œçŸ¥ã—ã¾ã—ãŸ ãƒ»æœ¬æ–‡ é€šçŸ¥å…ˆã¨ãƒ†ã‚­ã‚¹ãƒˆã‚’å®šç¾©ã™ã‚‹ï¼ãƒãƒ¼ã‚¯ãƒ€ã‚¦ãƒ³è¨˜æ³•ã‚’ä½¿ç”¨ã§ãã‚‹ï¼ å‚è€ƒï¼šhttps://www.datadoghq.com/ja/blog/tagging-best-practices/#%e3%83%81%e3%83%bc%e3%83%a0%e7%94%a8%e3%81%ae%e8%87%aa%e5%8b%95%e7%9a%84%e3%81%8b%e3%81%a4%e5%8b%95%e7%9a%84%e3%81%aa%e3%82%a2%e3%83%a9%e3%83%bc%e3%83%88%e3%82%92%e4%bd%9c%e6%88%90%e3%81%99%e3%82%8b {{#is_alert}} @ ç’°å¢ƒåï¼š{{log.attributes.env}} ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³åï¼š{{log.attributes.service}} ã‚½ãƒ¼ã‚¹åï¼š{{log.tags.source}} ãƒªãƒ¼ã‚¸ãƒ§ãƒ³åï¼š{{log.attributes.region}} {{/is_alert}} 02. ãƒªã‚¢ãƒ«ãƒ¦ãƒ¼ã‚¶ç›£è¦–ï¼ˆRUMï¼‰ ãƒ–ãƒ©ã‚¦ã‚¶ã‚¨ãƒ©ãƒ¼ ãƒ»ãƒ–ãƒ©ã‚¦ã‚¶ã‚¨ãƒ©ãƒ¼ã¨ã¯ Datadogã«ãŠã„ã¦ï¼Œãƒ–ãƒ©ã‚¦ã‚¶ã®ã‚¨ãƒ©ãƒ¼ã¯ä»¥ä¸‹ã«åˆ†é¡ã•ã‚Œã‚‹ï¼ å‚è€ƒï¼šhttps://docs.datadoghq.com/real_user_monitoring/browser/collecting_browser_errors/?tab=npm ã‚¨ãƒ©ãƒ¼ã®ã‚½ãƒ¼ã‚¹ ã‚¨ãƒ©ãƒ¼ã®ä¾‹ ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ä¸Š ãƒ»ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã•ã‚Œãšã«ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ä¸Šã«è¡¨ç¤ºã•ã‚ŒãŸä¾‹å¤–ãƒ»ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã•ã‚Œãšã«ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ä¸Šã«è¡¨ç¤ºã•ã‚ŒãŸPromiseã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®rejectãƒ¡ã‚½ãƒƒãƒ‰ã®çµæœ ãƒ–ãƒ©ã‚¦ã‚¶ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ä¸Š console.errorãƒ¡ã‚½ãƒƒãƒ‰ã«ã‚ˆã£ã¦ï¼Œã‚³ãƒ³ã‚½ãƒ¼ãƒ«ä¸Šã«å‡ºåŠ›ã•ã‚ŒãŸãƒ†ã‚­ã‚¹ãƒˆ ã‚«ã‚¹ã‚¿ãƒ  @datadog/browser-rumãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®addErrorãƒ¡ã‚½ãƒƒãƒ‰ã«ã‚ˆã£ã¦ï¼ŒDatadog-APIã«é€ä¿¡ã•ã‚ŒãŸãƒ†ã‚­ã‚¹ãƒˆ 03. åˆæˆç›£è¦– ãƒ–ãƒ©ã‚¦ã‚¶ãƒ†ã‚¹ãƒˆ ãƒ»é€ä¿¡å…ƒIPã‚¢ãƒ‰ãƒ¬ã‚¹ Datadogç¤¾ã®ã‚µãƒ¼ãƒã‹ã‚‰ãƒªã‚¯ã‚¨ã‚¹ãƒˆãŒé€ä¿¡ã•ã‚Œã‚‹ï¼ã‚µãƒ¼ãƒè‡ªä½“ã¯AWSã‚„Azureã«ã‚ˆã£ã¦ç®¡ç†ã•ã‚Œã¦ãŠã‚Šï¼Œä½¿ç”¨ã™ã‚‹ã‚µãƒ¼ãƒã®ãƒªãƒ¼ã‚¸ãƒ§ãƒ³ã‚’é¸æŠã§ãã‚‹ï¼ãƒªãƒ¼ã‚¸ãƒ§ãƒ³ã”ã¨ã«æ•°å€‹ãšã¤ã‚µãƒ¼ãƒãŒå­˜åœ¨ã—ã¦ã„ã‚‹ãŸã‚ï¼Œã‚‚ã—åˆæˆç›£è¦–å¯¾è±¡ã®ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã§IPåˆ¶é™ãŒè¡Œã‚ã‚Œã¦ã„ã‚‹å ´åˆã¯ï¼Œã“ã‚Œã‚‰ã®ã‚µãƒ¼ãƒã®IPã‹ã‚‰ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’è¨±å¯ã™ã‚‹å¿…è¦ãŒã‚ã‚‹ï¼ å‚è€ƒï¼šhttps://docs.datadoghq.com/synthetics/guide/identify_synthetics_bots/?tab=singleandmultistepapitests ãƒ»ãƒ˜ãƒƒãƒ€ãƒ¼ å‚è€ƒï¼š https://docs.datadoghq.com/synthetics/guide/identify_synthetics_bots/?tab=singleandmultistepapitests#default-headers https://docs.datadoghq.com/synthetics/apm/#how-are-traces-linked-to-tests ãƒ˜ãƒƒãƒ€ãƒ¼ å€¤ user-agent ãƒ–ãƒ©ã‚¦ã‚¶ãƒ†ã‚¹ãƒˆã§è¨­å®šã—ãŸãƒ–ãƒ©ã‚¦ã‚¶ãŒå‰²ã‚Šå½“ã¦ã‚‰ã‚Œã‚‹ï¼ sec-datadog ãƒ–ãƒ©ã‚¦ã‚¶ãƒ†ã‚¹ãƒˆã®IDãŒå‰²ã‚Šå½“ã¦ã‚‰ã‚Œã‚‹ï¼ x-datadog-trace-id ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ãŒãƒã‚¤ã‚¯ãƒ­ã‚µãƒ¼ãƒ“ã‚¹ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã®å ´åˆã«ï¼Œåé›†ã§ãã‚‹åˆ†æ•£ãƒˆãƒ¬ãƒ¼ã‚¹ã‚’ç´ä»˜ã‘ã‚‹IDãŒå‰²ã‚Šå½“ã¦ã‚‰ã‚Œã‚‹ï¼ x-datadog-parent-id ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ãŒãƒã‚¤ã‚¯ãƒ­ã‚µãƒ¼ãƒ“ã‚¹ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã®å ´åˆã«ï¼Œåˆ†æ•£ãƒˆãƒ¬ãƒ¼ã‚¹ã®ãƒ«ãƒ¼ãƒˆã‚¹ãƒ‘ãƒ³ã¨ã—ã¦ï¼Œ0ãŒå‰²ã‚Šå½“ã¦ã‚‰ã‚Œã‚‹ï¼ x-datadog-origin ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ãŒãƒã‚¤ã‚¯ãƒ­ã‚µãƒ¼ãƒ“ã‚¹ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã®å ´åˆã«ï¼Œåˆ†æ•£ãƒˆãƒ¬ãƒ¼ã‚¹ãŒAPMã‚¯ã‚ªãƒ¼ã‚¿ã«å½±éŸ¿ã—ãªã„ã‚ˆã†ã«ï¼Œsynthetics-browserãŒå‰²ã‚Šå½“ã¦ã‚‰ã‚Œã‚‹ï¼ x-datadog-sampling-priority ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ãŒãƒã‚¤ã‚¯ãƒ­ã‚µãƒ¼ãƒ“ã‚¹ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã®å ´åˆã«ï¼Œåˆ†æ•£ãƒˆãƒ¬ãƒ¼ã‚¹ãŒåé›†ã•ã‚Œã‚‹å„ªå…ˆåº¦ã¨ã—ã¦ï¼Œ1ãŒå‰²ã‚Šå½“ã¦ã‚Œã‚‹ï¼ APIãƒ†ã‚¹ãƒˆ ãƒãƒ«ãƒã‚¹ãƒ†ãƒƒãƒ—APIãƒ†ã‚¹ãƒˆ 04. ã‚°ãƒ©ãƒ• å›³ã®ç¨®é¡ ã‚¹ã‚±ãƒ¼ãƒ«ã®ç¨®é¡ ãƒ»logï¼ˆå¯¾æ•°ï¼‰ã‚¹ã‚±ãƒ¼ãƒ« ãƒ»linearï¼ˆç·šå½¢ï¼‰ã‚¹ã‚±ãƒ¼ãƒ« ãƒ»ï¼’ã®ç´¯ä¹—ã‚¹ã‚±ãƒ¼ãƒ« ãƒ»sqrtï¼ˆå¹³æ–¹æ ¹ï¼‰ã‚¹ã‚±ãƒ¼ãƒ« "},"public/system_development_methodology/system_development_methodology.html":{"url":"public/system_development_methodology/system_development_methodology.html","title":"ğŸ“– ï¸ã‚·ã‚¹ãƒ†ãƒ é–‹ç™ºæ‰‹æ³•è«–","keywords":"","body":"ã‚·ã‚¹ãƒ†ãƒ é–‹ç™ºæ‰‹æ³•è«– ã¯ã˜ã‚ã« æœ¬ã‚µã‚¤ãƒˆã«ã¤ãã¾ã—ã¦ï¼Œä»¥ä¸‹ã‚’ã”èªè­˜ã®ã»ã©å®œã—ããŠé¡˜ã„ã„ãŸã—ã¾ã™ï¼ å‚è€ƒï¼šhttps://hiroki-it.github.io/tech-notebook-gitbook/ 01. ã‚¦ã‚©ãƒ¼ã‚¿ãƒ¼ãƒ•ã‚©ãƒ¼ãƒ«å‹é–‹ç™º ã‚¦ã‚©ãƒ¼ã‚¿ãƒ¼ãƒ•ã‚©ãƒ¼ãƒ«å‹é–‹ç™ºã¨ã¯ å¤–éƒ¨è¨­è¨ˆã®è©³ç´° å¤–éƒ¨è¨­è¨ˆã§ã¯ï¼Œãƒ¦ãƒ¼ã‚¶å‘ã‘ã®ã‚·ã‚¹ãƒ†ãƒ è¨­è¨ˆãŒè¡Œã‚ã‚Œã‚‹ï¼ 02. ãƒ—ãƒ­ãƒˆã‚¿ã‚¤ãƒ—å‹é–‹ç™º ãƒ—ãƒ­ãƒˆã‚¿ã‚¤ãƒ—å‹é–‹ç™ºã¨ã¯ ã‚·ã‚¹ãƒ†ãƒ è¨­è¨ˆã«å…¥ã‚‹ã¾ã§ã«è©¦ä½œå“ã‚’ä½œã‚Šï¼Œè¦ä»¶å®šç¾©ã‚’ã‚ˆã‚Šæ­£ç¢ºã«ã™ã‚‹é–‹ç™ºæ–¹æ³•ï¼ 03. ãƒ¬ãƒ“ãƒ¥ãƒ¼ ãƒ¬ãƒ“ãƒ¥ãƒ¼ã¨ã¯ å„å·¥ç¨‹ãŒå®Œäº†ã—ãŸæ®µéšã§ï¼Œãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚’è¡Œã†é–‹ç™ºæ–¹æ³•ï¼ 04. RADï¼ˆRapid Application Developmentï¼‰ RADã¨ã¯ Visual Basicãªã©ã®é–‹ç™ºæ”¯æ´ãƒ„ãƒ¼ãƒ«ã‚’ç”¨ã„ã¦ï¼ŒçŸ­æœŸé–“ã§è¨­è¨ˆï½ãƒ†ã‚¹ãƒˆã¾ã§ã‚’ç¹°ã‚Šè¿”ã™é–‹ç™ºæ–¹æ³•ï¼ 05. ã‚¹ãƒ‘ã‚¤ãƒ©ãƒ«å‹é–‹ç™º ã‚¹ãƒ‘ã‚¤ãƒ©ãƒ«å‹é–‹ç™ºã¨ã¯ ã‚·ã‚¹ãƒ†ãƒ ã‚’ã„ãã¤ã‹ã®ã‚µãƒ–ã‚·ã‚¹ãƒ†ãƒ ã«åˆ†å‰²ã—ï¼Œã‚¦ã‚©ãƒ¼ã‚¿ãƒ¼ãƒ•ã‚©ãƒ¼ãƒ«å‹é–‹ç™ºã§å„ã‚µãƒ–ã‚·ã‚¹ãƒ†ãƒ ã‚’é–‹ç™ºã—ã¦ã„ãæ–¹æ³•ï¼ 06. ã‚¢ã‚¸ãƒ£ã‚¤ãƒ«å‹é–‹ç™º ã‚¢ã‚¸ãƒ£ã‚¤ãƒ«å‹é–‹ç™ºã¨ã¯ ã‚¹ãƒ‘ã‚¤ãƒ©ãƒ«ãƒ¢ãƒ‡ãƒ«ã®æ´¾ç”Ÿå‹ï¼ã‚¹ãƒ‘ã‚¤ãƒ©ãƒ«ãƒ¢ãƒ‡ãƒ«ã‚ˆã‚Šã‚‚çŸ­ã„æœŸé–“ã§ï¼Œè¨­è¨ˆï½ãƒ†ã‚¹ãƒˆã¾ã§ã‚’ç¹°ã‚Šè¿”ã™é–‹ç™ºæ–¹æ³•ï¼ 07. CASEãƒ„ãƒ¼ãƒ«ï¼šComputer Aided Software Enginnering CASEãƒ„ãƒ¼ãƒ«ã¨ã¯ ã‚·ã‚¹ãƒ†ãƒ é–‹ç™ºã‚’ã‚µãƒãƒ¼ãƒˆã™ã‚‹ãƒ„ãƒ¼ãƒ«ç¾¤ã®ã“ã¨ï¼ ä¸ŠæµCASEãƒ„ãƒ¼ãƒ« ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼å›³ï¼ŒERå›³ ä¸‹æµCASEãƒ„ãƒ¼ãƒ« ãƒ†ã‚¹ãƒˆæ”¯æ´ãƒ„ãƒ¼ãƒ« ä¿å®ˆCASEãƒ„ãƒ¼ãƒ« ãƒªãƒãƒ¼ã‚¹ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ãƒªãƒ³ã‚° "},"public/system_development_methodology/system_development_methodology_project_management.html":{"url":"public/system_development_methodology/system_development_methodology_project_management.html","title":"ğŸ“– ï¸ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆç®¡ç†","keywords":"","body":"ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆç®¡ç† ã¯ã˜ã‚ã« æœ¬ã‚µã‚¤ãƒˆã«ã¤ãã¾ã—ã¦ï¼Œä»¥ä¸‹ã‚’ã”èªè­˜ã®ã»ã©å®œã—ããŠé¡˜ã„ã„ãŸã—ã¾ã™ï¼ å‚è€ƒï¼šhttps://hiroki-it.github.io/tech-notebook-gitbook/ 01. ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆç®¡ç† ç®¡ç†æŒ‡æ¨™ ã€é–‹ç™ºè¦æ¨¡ï¼ˆã‹ï¼‰ã€ï¼Œã€å·¥æ•°ï¼ˆã“ï¼‰ã€ï¼Œã€ç”Ÿç”£æ€§ï¼ˆã›ï¼‰ã€ã®å˜ä½é–“ã®é–¢ä¿‚ã¯ï¼Œã€ã¿ã¯ã˜ã€ã¨åŒã˜ã§ã‚ã‚‹ï¼ ãƒ»é–‹ç™ºè¦æ¨¡ï¼ˆã‹ï¼‰ ï¼ˆãƒ—ãƒ­ã‚°ãƒ©ãƒ æœ¬æ•°ã«ã‚ˆã‚‹é–‹ç™ºè¦æ¨¡ï¼‰ï¼ï¼ˆãƒ—ãƒ­ã‚°ãƒ©ãƒ æœ¬æ•°ï¼‰ ï¼ˆãƒ—ãƒ­ã‚°ãƒ©ãƒ è¡Œæ•°ã«ã‚ˆã‚‹é–‹ç™ºè¦æ¨¡ï¼‰ï¼ï¼ˆï½‹ã‚¹ãƒ†ãƒƒãƒ—è¡Œæ•°ï¼‰ ãƒ»å·¥æ•°ï¼ˆã“ï¼‰ ï¼ˆäººæ™‚ã«ã‚ˆã‚‹å·¥æ•°ï¼‰ï¼ï¼ˆäººæ•°ãƒ»æ™‚ï¼‰ï¼ï¼ˆäººæ•° Ã— æ™‚é–“ï¼‰ ï¼ˆäººæ™‚ã«ã‚ˆã‚‹æ¨™æº–å·¥æ•°ï¼‰ï¼ï¼ˆãƒ—ãƒ­ã‚°ãƒ©ãƒ ä¸€æœ¬å½“ãŸã‚Šã®äººæ•°ãƒ»æ™‚ï¼‰ï¼ï¼ˆäººæ•°ãƒ»æ™‚ï¼æœ¬ï¼‰ ä¸€æœŸé–‹ç™º å¤–éƒ¨è¨­è¨ˆ å†…éƒ¨è¨­è¨ˆ é–‹ç™º çµåˆãƒ†ã‚¹ãƒˆ ç·åˆãƒ†ã‚¹ãƒˆ å·¥æ•° 42ï¼ˆæ™‚é–“ï¼‰ 70 140 52.5 42.0 é…åˆ†æœˆæ•° 3ï¼ˆãƒ¶æœˆï¼‰ 3 5 2 3 Aç¤¾å‹•å“¡æ•° 12ï¼ˆäººï¼‰ 20 0 12 12 Bç¤¾å‹•å“¡æ•° 2ï¼ˆäººï¼‰ 4 28 15 2 ãƒ»ç”Ÿç”£æ€§ï¼ˆã›ï¼‰ ï¼ˆãƒ—ãƒ­ã‚°ãƒ©ãƒ æœ¬æ•°ã®ç”Ÿç”£æ€§ï¼‰ ï¼ï¼ˆãƒ—ãƒ­ã‚°ãƒ©ãƒ æœ¬æ•°ï¼äººæ™‚ï¼‰ ï¼ï¼ˆãƒ—ãƒ­ã‚°ãƒ©ãƒ æœ¬æ•°ã«ã‚ˆã‚‹é–‹ç™ºè¦æ¨¡ï¼‰Ã·ï¼ˆå·¥æ•°ï¼‰ ï¼ˆkã‚¹ãƒ†ãƒƒãƒ—è¡Œæ•°ã®ç”Ÿç”£æ€§ï¼‰ ï¼ï¼ˆï½‹ã‚¹ãƒ†ãƒƒãƒ—è¡Œæ•°ï¼äººæ™‚ï¼‰ ï¼ï¼ˆï½‹ã‚¹ãƒ†ãƒƒãƒ—è¡Œæ•°ã«ã‚ˆã‚‹é–‹ç™ºè¦æ¨¡ï¼‰Ã·ï¼ˆå·¥æ•°ï¼‰ ãƒ»é€²æ—ç‡ Arrow ãƒ€ã‚¤ã‚¢ã‚°ãƒ©ãƒ  ãƒ»ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã«å¿…è¦ãªæ—¥æ•° å…¨ä½“çš„ãªå·¥ç¨‹ã«å¿…è¦ãªæ—¥æ•°ã¯ï¼Œæ‰€è¦æ—¥æ•°ãŒæœ€ã‚‚å¤šã„çµŒè·¯ã«å½±éŸ¿ã•ã‚Œã‚‹ï¼ã“ã®çµŒè·¯ã‚’ï¼ŒCritical Path ã¨ã„ã†ï¼ ãƒ»æœ€æ—©çµåˆç‚¹æ™‚åˆ» å…¨ä½“çš„ãªå·¥ç¨‹ã®ä¸­ã§ï¼Œä»»æ„ã®çµåˆç‚¹ã«å–ã‚Šæ›ã‹ã‚‹ãŸã‚ã«å¿…è¦ãªæœ€å°‘æ—¥æ•°ã®ã“ã¨ï¼Critical Path ã«å½±éŸ¿ã•ã‚Œã‚‹ã®ã§ï¼Œæ³¨æ„ï¼ ãƒ»æœ€é…çµåˆç‚¹æ™‚åˆ» å…¨ä½“çš„ãªå·¥ç¨‹ã®ä¸­ã§ï¼Œä»»æ„ã®çµåˆç‚¹ã«å–ã‚Šæ›ã‹ã‚‹ãŸã‚ã«å¿…è¦ãªæœ€å¤šæ—¥æ•°ã®ã“ã¨ï¼ "},"public/system_development_methodology/system_development_methodology_github.html":{"url":"public/system_development_methodology/system_development_methodology_github.html","title":"ğŸ“– ï¸GitHub","keywords":"","body":"GitHub ã¯ã˜ã‚ã« æœ¬ã‚µã‚¤ãƒˆã«ã¤ãã¾ã—ã¦ï¼Œä»¥ä¸‹ã‚’ã”èªè­˜ã®ã»ã©å®œã—ããŠé¡˜ã„ã„ãŸã—ã¾ã™ï¼ å‚è€ƒï¼šhttps://hiroki-it.github.io/tech-notebook-gitbook/ 01. ä½œæ¥­è€…ã®å ´åˆ Issue ãƒ»ä½œæˆ ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’å…ƒã«ï¼ŒIssueã‚’ä½œæˆã™ã‚‹ï¼ ãƒ»å‰Šé™¤ ãƒªãƒã‚¸ãƒˆãƒªã®ç®¡ç†è€…æ¨©é™ãŒã‚ã‚Œã°å‰Šé™¤ã§ãã‚‹ï¼ PullReq ãƒ»ä½œæˆ ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’å…ƒã«ï¼ŒPullReqã‚’ä½œæˆã™ã‚‹ï¼ ãƒ»å‰Šé™¤ ä¸å¯èƒ½ã®ãŸã‚ï¼Œã‚¯ãƒ­ãƒ¼ã‚ºã™ã‚‹ã—ã‹ãªã„ï¼çŠ¯ã—ãŸç½ªã¯èƒŒè² ã£ã¦ç”Ÿãã¦ã„ã‹ãªã‘ã‚Œã°ãªã‚‰ãªã„ï¼ å‚ç…§ï¼šhttps://stackoverflow.com/questions/18318097/delete-a-closed-pull-request-from-github 02. ãƒ¬ãƒ“ãƒ¥ã‚¢ãƒ¼ã®å ´åˆ ãƒ¬ãƒ“ãƒ¥ãƒ¼è¦³ç‚¹ ãƒ»ãƒ“ã‚¸ãƒã‚¹ãƒ«ãƒ¼ãƒ«ã‚„ä»•æ§˜é€šã‚Šã‹ å®Ÿè£…ã®æ¡ä»¶æ–‡ã‚„ï¼Œã‚³ãƒ¡ãƒ³ãƒˆã‹ã‚‰ï¼Œãƒ“ã‚¸ãƒã‚¹ãƒ«ãƒ¼ãƒ«ã‚„ä»•æ§˜ã‚’ç†è§£ã™ã‚‹ï¼ æ¡ä»¶æ–‡ã§var_dump() ã‚’è¡Œã†ï¼ ã©ã†ã„ã£ãŸå…¥åŠ›ãŒã•ã‚ŒãŸå ´åˆã«ï¼Œtrue ã¨ã—ã¦åˆ¤æ–­ã—ã¦ã„ã‚‹ã®ã‹ã‚’ç¢ºèªï¼ä¾‹ãˆã°ï¼Œå—æ³¨æ¸ˆåŒºåˆ†å€¤ãŒè¨­å®šã•ã‚Œã¦ã„ã‚‹ã¨ãã«ï¼Œãã‚ŒãŒå¤±æ³¨åŒºåˆ†å€¤ã«å¤‰ã‚ã£ãŸå ´åˆã«ï¼Œå€¤ã‚’è¿”å´ã—ã¦ã„ã‚‹ãªã‚‰ã°ï¼Œãã“ã‹ã‚‰ï¼Œã€å¤±æ³¨ã€ã®ãƒ“ã‚¸ãƒã‚¹ãƒ«ãƒ¼ãƒ«ãŒå£é–“è¦‹ãˆã‚‹ï¼ å®šæ•°ã«æ·»ãˆã‚‰ã‚ŒãŸã‚³ãƒ¡ãƒ³ãƒˆã‹ã‚‰ï¼Œä»•æ§˜ã‚’ç†è§£ï¼ ãƒ»ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã¯é©åˆ‡ã‹ empty() ï¼Œisset() ãªã©ã‚’æ­£ã—ãåŒºåˆ¥ã—ã¦ä½¿ãˆã¦ã„ã‚‹ã‹ã‚’ç¢ºèªã™ã‚‹ ãƒ»å†—é•·ã«ãªã£ã¦ã„ãªã„ã‹ é‡è¤‡ã™ã‚‹å‡¦ç†ã‚’foreach()ã«ã¾ã¨ã‚ã‚‰ã‚Œãªã„ã‹ã‚’ç¢ºèªã™ã‚‹ï¼ã¾ãŸï¼Œå¤‰æ•°ã®æ ¼ç´ãŒé‡è¤‡ã—ã¦ã„ãªã„ã‹ã‚’ç¢ºèªã™ã‚‹ï¼ 03. ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ é…ç½®å ´æ‰€ ãƒªãƒã‚¸ãƒˆãƒªã®ç›´ä¸‹ã«.githubãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’é…ç½®ã—ï¼ŒISSUE_TEMPLATE.mdã‚„PULL_REQUEST_TEMPLATE.mdã®åå‰ã§ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç½®ãï¼Issueã®ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã«é–¢ã—ã¦ï¼Œä»£ã‚ã‚Šã«ISSUE_TEMPLATEãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’ç½®ãï¼Œä»»æ„ã®åå‰ã®mdãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç½®ãã¨ï¼Œè¤‡æ•°ã®ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’ä½œæˆã§ãã‚‹ï¼ å‚è€ƒï¼šhttps://qiita.com/nyamogera/items/3fe6985b45fbd5377184 project/ â””â”€â”€ .github â”œâ”€â”€ ISSUE_TEMPLATE.md â””â”€â”€ PULL_REQUEST_TEMPLATE.md project/ â””â”€â”€ .github â”œâ”€â”€ ISSUE_TEMPLATE | â”œâ”€â”€ FIX.md | â””â”€â”€ UPDATE.md | â””â”€â”€ PULL_REQUEST_TEMPLATE.md Issue ãƒ»Issueã®åˆ†å‰² ä¸€ã¤ã®Issueã¨ãƒ–ãƒ©ãƒ³ãƒã«ãŸãã•ã‚“ã®å®Ÿè£…ã‚’Commitã™ã‚‹ã“ã¨ã¯æœ›ã¾ã—ããªã„ï¼ãã“ã§ï¼Œå¤§ããªå¯¾å¿œã‚’å€‹ã€…ã®å¯¾å¿œã«åˆ†å‰²ã™ã‚‹ï¼ãã—ã¦ï¼Œå¤§ããªå¯¾å¿œã«é–¢ã™ã‚‹åŸºç‚¹Issueã¨åŸºç‚¹ãƒ–ãƒ©ãƒ³ãƒã‚’ä½œæˆã—ï¼Œå€‹ã€…ã®å¯¾å¿œã«é–¢é€£ã™ã‚‹å­Issueã¨å­ãƒ–ãƒ©ãƒ³ãƒã‚’ä½œæˆã—ã¦ã„ãï¼å€‹åˆ¥ã®å¯¾å¿œãŒçµ‚ã‚ã£ãŸã‚‰ï¼Œè¦ªãƒ–ãƒ©ãƒ³ãƒã¸ãƒãƒ¼ã‚¸ã—ã¦ã„ãï¼ ãƒ»ã‚¿ã‚¤ãƒˆãƒ« ã‚¿ã‚¤ãƒˆãƒ«ã¯ã€ã€‡ã€‡ã™ã‚‹ï¼ã€ã¨ã™ã‚‹ï¼å¥èª­ç‚¹ã®æœ‰ç„¡ã¯å¥½ã¿ï¼ ãƒ»å†…å®¹ å†…å®¹ã¯ã€èƒŒæ™¯ã€ã¨ã€å¯¾å¿œæ–¹é‡ã€ã•ãˆä¼ã‚ã‚Œã°ï¼Œæ–‡è¨€è‡ªä½“ã¯ãã®ãƒªãƒã‚¸ãƒˆãƒªã®ãƒ«ãƒ¼ãƒ«ã«åˆã‚ã›ã‚‹ï¼ ï¼Šä¾‹ï¼Š # èƒŒæ™¯ # å¯¾å¿œæ–¹é‡ PullReq ãƒ»ã‚¿ã‚¤ãƒˆãƒ« ã‚¿ã‚¤ãƒˆãƒ«ã¯ã€ã€‡ã€‡ã—ãŸï¼ã€ã¨ã™ã‚‹ï¼å¥èª­ç‚¹ã®æœ‰ç„¡ã¯å¥½ã¿ï¼ ãƒ»WIP å®Ÿè£…é€”ä¸­ã®PullReqã§ã‚ã‚Šï¼Œå®Ÿè£…æ–¹æ³•ãªã©ã‚’è³ªå•ã—ãŸã„å ´åˆã«ï¼Œã‚¿ã‚¤ãƒˆãƒ«ã«ã€WIPã€ã¨ã¤ã‘ã¦ãŠãï¼ãƒ¬ãƒ“ãƒ¥ãƒ¼ã—ã¦ã‚‚ã‚‰ã„ãŸããªã£ãŸã‚‰ï¼Œã“ã‚Œã‚’ã¯ãšã™ï¼ãƒ¬ãƒ“ãƒ¥ãƒ¼ä¿®æ­£æ™‚ã«ï¼Œå®Ÿè£…ã«æ™‚é–“ãŒã‹ã‹ã‚Šãã†ã§ã‚ã£ãŸã‚‰ï¼Œå†ã³ä»˜ã‘ã¦ã‚‚è‰¯ã„ï¼ ãƒ»å†…å®¹ å†…å®¹ã¯ã€å¯¾å¿œå†…å®¹ã€ã¨ã€ãƒ¬ãƒ“ãƒ¥ãƒ¼ã—ã¦ã»ã—ã„ã¨ã“ã‚ã€ã•ãˆä¼ã‚ã‚Œã°ï¼Œæ–‡è¨€è‡ªä½“ã¯ãã®ãƒªãƒã‚¸ãƒˆãƒªã®ãƒ«ãƒ¼ãƒ«ã«åˆã‚ã›ã‚‹ï¼ã‚‚ã—ï¼Œãƒ¬ãƒ“ãƒ¥ãƒ¼æœŸé™ã‚„å‹•ä½œç¢ºèªæ‰‹é †ã‚’çŸ¥ã‚‰ã›ã‚‹å¿…è¦ãŒã‚ã‚Œã°ã€ãƒ¬ãƒ“ãƒ¥ãƒ¼æœŸé™ã€ã€ç¢ºèªæ‰‹é †ã€ã®é …ç›®ã‚’è¨­ã‘ã‚‹ï¼ ï¼Šä¾‹ï¼Š # ãƒªãƒªãƒ¼ã‚¹äºˆå®šæ—¥ # å¯¾å¿œå†…å®¹ # ãƒ¬ãƒ“ãƒ¥ãƒ¼ã—ã¦ã„ãŸã ããŸã„ã¨ã“ã‚ 04. Tips åŸºç‚¹ãƒ–ãƒ©ãƒ³ãƒã‹ã‚‰äºŒå›æ´¾ç”Ÿã™ã‚‹ãƒ–ãƒ©ãƒ³ãƒãƒãƒ¼ã‚¸ã™ã‚‹æ™‚ã®æ³¨æ„ç‚¹ ï¼ˆï¼‘ï¼‰åŸºç‚¹ãƒ–ãƒ©ãƒ³ãƒã‹ã‚‰ï¼Œä¸€ã¤ç›®ã®ãƒ–ãƒ©ãƒ³ãƒã«ãƒãƒ¼ã‚¸ã—ï¼Œã“ã‚Œã‚’pushã™ã‚‹ï¼ã“ã“ã§pushã—ãªã„ã¨ï¼Œ2ç•ªç›®ã®ãƒ–ãƒ©ãƒ³ãƒãŒä¸€ã¤ç›®ã®ãƒ–ãƒ©ãƒ³ãƒã¨ã®å·®åˆ†ã‚’æ¤œå‡ºã—ã¦ã—ã¾ã„ï¼Œå¤§é‡ã®å·®åˆ†ã‚³ãƒŸãƒƒãƒˆãŒgithubã«è¡¨ç¤ºã•ã‚Œã¦ã—ã¾ã†ï¼ ï¼ˆï¼’ï¼‰ä¸€ã¤ç›®ã®ãƒ–ãƒ©ãƒ³ãƒã‹ã‚‰äºŒã¤ç›®ã®ãƒ–ãƒ©ãƒ³ãƒã«ãƒãƒ¼ã‚¸ã—ï¼ã“ã‚Œã‚’pushã™ã‚‹ï¼ Conflictã®è§£æ±ºæ–¹æ³•ã¨ãƒãƒ¼ã‚¸ã‚³ãƒŸãƒƒãƒˆã®ä½œæˆ ï¼ˆï¼‘ï¼‰git statusã‚’è¡Œã„ï¼Œç‰¹å®šã®ãƒ•ã‚¡ã‚¤ãƒ«ã§ã®ã‚³ãƒ³ãƒ•ãƒªã‚¯ãƒˆãŒè¡¨ç¤ºã•ã‚Œã‚‹ï¼ Unmerged paths: (use \"git restore --staged ...\" to unstage) (use \"git add ...\" to mark resolution) both modified: XXX/YYY.twig ï¼ˆï¼’ï¼‰ã‚³ãƒ³ãƒ•ãƒªã‚¯ãƒˆã—ã¦ã„ãŸã‚³ãƒ¼ãƒ‰è¡Œã‚’å–æ¨é¸æŠã™ã‚‹ï¼ ï¼ˆï¼“ï¼‰ä¸€åº¦addã‚’è¡Œã„ï¼Œã‚³ãƒ³ãƒ•ãƒªã‚¯ãƒˆã®ä¿®æ­£ã‚’Gitã«èªè­˜ã•ã›ã‚‹ï¼ $ git add XXX/YYY.twig ï¼ˆï¼”ï¼‰git statusã‚’è¡Œã„ï¼Œä»¥ä¸‹ãŒè¡¨ç¤ºã•ã‚Œã‚‹ï¼ã‚³ãƒ³ãƒ•ãƒªã‚¯ãƒˆãŒè§£æ±ºã•ã‚ŒãŸãŒï¼Œãƒãƒ¼ã‚¸ã•ã‚Œã¦ã„ãªã„ã¨å‡ºåŠ›ã•ã‚Œã‚‹ï¼å·®åˆ†ã®ãƒ•ã‚¡ã‚¤ãƒ«ãŒãŸãã•ã‚“è¡¨ç¤ºã•ã‚Œã‚‹å ´åˆãŒã‚ã‚‹ãŒï¼Œå•é¡Œãªã„ï¼ All conflicts fixed but you are still merging. Changes to be committed: modified: XXX modified: XXX ï¼ˆï¼•ï¼‰git commitï¼ˆ-mã¯ã¤ã‘ã¦ã¯ã„ã‘ãªã„ï¼‰ã‚’è¡Œã„ï¼Œvimã‚¨ãƒ‡ã‚£ã‚¿ãŒè¡¨ç¤ºã•ã‚Œã‚‹ï¼ Merge branch \"ãƒ–ãƒ©ãƒ³ãƒå\" into ãƒ–ãƒ©ãƒ³ãƒå ï¼ˆï¼–ï¼‰:wqã§ã‚¨ãƒ‡ã‚£ã‚¿ã‚’çµ‚äº†ã™ã‚Œã°ï¼Œã‚³ãƒ³ãƒ•ãƒªã‚¯ãƒˆã‚’è§£æ¶ˆã—ãŸãƒãƒ¼ã‚¸ã‚³ãƒŸãƒƒãƒˆãŒä½œæˆã•ã‚Œã‚‹ï¼ ï¼ˆï¼—ï¼‰git statusã‚’è¡Œã†ï¼å ´åˆã«ã‚ˆã£ã¦ã¯ï¼Œå·®åˆ†ã®ã‚³ãƒŸãƒƒãƒˆæ•°ãŒè¡¨ç¤ºã•ã‚Œã‚‹ãŒå•é¡Œãªã„ï¼ Your branch is ahead of \"origin/feature/XXXX\" by 10 commits. ï¼ˆï¼˜ï¼‰pushã™ã‚‹ï¼ã“ã®æ™‚ï¼Œãƒãƒ¼ã‚¸ã‚³ãƒŸãƒƒãƒˆã‚’ä½œæˆã™ã‚‹æ™‚ï¼ŒåŸºç‚¹ãƒ–ãƒ©ãƒ³ãƒä»¥å¤–ã‹ã‚‰ãƒãƒ¼ã‚¸ã—ã¦ã„ã‚‹ã¨ï¼Œå·®åˆ†ã®ã‚³ãƒŸãƒƒãƒˆãŒä¸€ã¤ã«ã¾ã¨ã¾ã‚‰ãšï¼Œ å‚è€ƒï¼šhttp://www-creators.com/archives/1938 Commitã®ç²’åº¦ ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‹ã‚‰ãƒ•ãƒ­ãƒ³ãƒˆå‡ºåŠ›ã¾ã§ã«è‡³ã‚‹å®Ÿè£…ã‚’Commitã™ã‚‹å ´åˆï¼Œä»¥ä¸‹ã®3ã¤ã‚’æ„è­˜ã™ã‚‹ï¼ ï¼ˆï¼‘ï¼‰ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‹ã‚‰Commit ï¼ˆï¼’ï¼‰é–¢é€£æ€§ã®ã‚ã‚‹å®Ÿè£…ã‚’ã¾ã¨ã‚ã¦Commit ï¼ˆï¼“ï¼‰ä¸€å›ã®CommitãŒã‚‚ã¤ã‚³ãƒ¼ãƒ‰é‡ãŒå°‘ãªããªã‚‹ã‚ˆã†ã«Commit hotfixãƒ–ãƒ©ãƒ³ãƒã®ä½œæˆ ãƒªãƒªãƒ¼ã‚¹å¾Œã«ä¿®æ­£ç‚¹ãŒè¦‹ã¤ã‹ã£ãŸå ´åˆã«ï¼Œä¿®æ­£ç”¨ãƒ–ãƒ©ãƒ³ãƒã‚’ä½œæˆã—ï¼Œã“ã‚Œã‚’é€Ÿã‚„ã‹ã«ãƒªãƒªãƒ¼ã‚¹ã™ã‚‹å¿…è¦ãŒã‚ã‚‹ï¼ ï¼ˆï¼‘ï¼‰Issueã‚’ä½œæˆã™ã‚‹ï¼ ï¼ˆï¼’ï¼‰mainãƒ–ãƒ©ãƒ³ãƒã‹ã‚‰ï¼Œã€hotfix/ã€ã®åå‰ã§ãƒ–ãƒ©ãƒ³ãƒã‚’ä½œæˆã™ã‚‹ï¼ ï¼ˆï¼“ï¼‰ãƒ—ãƒ«ãƒªã‚¯ã‚’ä½œæˆã—ï¼Œãƒãƒ¼ã‚¸ã®å‘ãå…ˆã‚’mainãƒ–ãƒ©ãƒ³ãƒã¨ã™ã‚‹ï¼ ï¼ˆï¼”ï¼‰é€Ÿæ”»ã§approveã‚’ã‚‚ã‚‰ã„ï¼Œmainãƒ–ãƒ©ãƒ³ãƒã«ãƒãƒ¼ã‚¸ã™ã‚‹ï¼ã“ã®æ™‚ï¼Œhotfixãƒ–ãƒ©ãƒ³ãƒã¯å¾Œã§developãƒ–ãƒ©ãƒ³ãƒã«ãƒãƒ¼ã‚¸ã™ã‚‹ãŸã‚ï¼Œå‰Šé™¤ã—ãªã„ã‚ˆã†ã«ã™ã‚‹ï¼ ï¼ˆï¼•ï¼‰ãƒ‘ãƒƒãƒç•ªå·ã‚’ä¸€ã¤å¢—ã‚„ã—ãŸã‚¿ã‚°ã‚’ä»˜ä¸ã—ï¼Œå†ãƒªãƒªãƒ¼ã‚¹ã™ã‚‹ï¼ ï¼ˆï¼–ï¼‰ãƒªãƒªãƒ¼ã‚¹å¾Œï¼Œã‚¨ãƒ©ãƒ¼ãŒè§£æ¶ˆã•ã‚ŒãŸã‚‰ï¼Œãƒ­ãƒ¼ã‚«ãƒ«PCã§hotfixãƒ–ãƒ©ãƒ³ãƒã‚’developãƒ–ãƒ©ãƒ³ãƒã«ãƒãƒ¼ã‚¸ã™ã‚‹ï¼ "},"public/system_development_methodology/system_development_methodology_git_command.html":{"url":"public/system_development_methodology/system_development_methodology_git_command.html","title":"ğŸ“– ï¸Gitã‚³ãƒãƒ³ãƒ‰","keywords":"","body":"Gitã‚³ãƒãƒ³ãƒ‰ ã¯ã˜ã‚ã« æœ¬ã‚µã‚¤ãƒˆã«ã¤ãã¾ã—ã¦ï¼Œä»¥ä¸‹ã‚’ã”èªè­˜ã®ã»ã©å®œã—ããŠé¡˜ã„ã„ãŸã—ã¾ã™ï¼ å‚è€ƒï¼šhttps://hiroki-it.github.io/tech-notebook-gitbook/ 01. ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ç³»ã‚³ãƒãƒ³ãƒ‰ clone ãƒ»clone ä¸€ç•ªï¼Œã‚¯ãƒ­ãƒ¼ãƒ³ã®é€Ÿåº¦ãŒé€Ÿãï¼Œã‚³ãƒãƒ³ãƒ‰ã®å¼•æ•°ã‚‚ç°¡å˜ï¼ $ git clone https://github.com//.git ãƒ»clone ã‚µãƒ¼ãƒæ¥ç¶šåã¯ï¼Œï¼ŒSSHæ¥ç¶šã®è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆ~/.ssh/configï¼‰ã«è¨˜è¼‰ã•ã‚Œã¦ã„ã‚‹ï¼ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ã¯ï¼ŒGithubã®æ¥ç¶šåã¯ï¼Œã€Œgithub.comã€ã«ãªã£ã¦ã„ã‚‹ï¼ $ git clone git@:/.git config ãƒ» è¨­å®šã®å½±éŸ¿ç¯„å›²ã®ç¨®é¡ å½±éŸ¿ç¯„å›² æ„å‘³ ä¸Šæ›¸ãé † è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã®å ´æ‰€ system å…¨PCãƒ¦ãƒ¼ã‚¶ã®å…¨ãƒªãƒã‚¸ãƒˆãƒª 1 /etc/gitconfig global ç¾åœ¨ã®PCãƒ¦ãƒ¼ã‚¶ãƒ¼ã®å…¨ãƒªãƒã‚¸ãƒˆãƒª 2 ~/.gitconfig local ç¾åœ¨ã®ãƒªãƒã‚¸ãƒˆãƒª 3 /.git/config ãƒ»config -- --list æŒ‡å®šã—ãŸå½±éŸ¿ç¯„å›²ã§é©ç”¨ã•ã‚Œã¦ã„ã‚‹è¨­å®šå€¤ã‚’è¡¨ç¤ºã™ã‚‹ï¼--localã§è¨­å®šã•ã‚Œã¦ã„ãªã„é …ç›®ã¯ï¼Œ--globalã®è¨­å®šå€¤ãŒé©ç”¨ã•ã‚Œã‚‹ï¼ $ git config --local --list Macã§ã¯ï¼Œä¸€ã¤ã®PCã§äºŒã¤ã®GutHubã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’ä½¿ç”¨ã™ã‚‹å ´åˆã«ï¼Œã‚­ãƒ¼ãƒã‚§ãƒ¼ãƒ³ã¨ã„ã†æ©Ÿèƒ½ã§è¨­å®šãŒå¿…è¦ã«ãªã‚‹ï¼ å‚è€ƒï¼šhttps://sy-base.com/myrobotics/others/git-push_403error/ ãƒ»config -- user.name Authorã¨Committerã®åå‰ã‚’è¨­å®šã™ã‚‹ï¼localãŒä¸€ç•ªæœ€å¾Œã«ä¸Šæ›¸ãã•ã‚Œï¼Œé©ç”¨ã•ã‚Œã‚‹ï¼ $ git config --local user.name \"hiroki-it\" ãƒ»config -- user.email Authorã¨Committerã®ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’è¨­å®šã™ã‚‹ï¼localãŒä¸€ç•ªæœ€å¾Œã«ä¸Šæ›¸ãã•ã‚Œï¼Œé©ç”¨ã•ã‚Œã‚‹ï¼ $ git config --local user.email \"example@gmail.com\" Authorã®æƒ…å ±ã¯ï¼Œã‚³ãƒŸãƒƒãƒˆæ™‚ã«åæ˜ ã•ã‚Œã‚‹ï¼ï¼ˆCommitterã¯è¡¨ç¤ºã•ã‚Œãªã„ï¼‰ $ git log commit ee299250a4741555eb5027ad3e56ce782fe90ccb Author: hiroki-it Date: Sat Sep 12 00:00:00 2020 +0900 add â—¯â—¯ã‚’å®Ÿè£…ã—ãŸï¼ ãƒ»config --global core.autocrlf æ”¹è¡Œã‚³ãƒ¼ãƒ‰ã‚’ï¼Œç‰¹å®šã®ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã§è‡ªå‹•å¤‰æ›ã™ã‚‹ã‚ˆã†ã«è¨­å®šã™ã‚‹ï¼inputã¨ã—ã¦ãŠãã®ãŒè‰¯ã„ï¼ $ git config --global core.autocrlf è¨­å®šå€¤ ãƒã‚§ãƒƒã‚¯ã‚¢ã‚¦ãƒˆæ™‚ ã‚³ãƒŸãƒƒãƒˆæ™‚ input å¤‰æ›ã—ãªã„ CRLF -> LF true LF -> CRLF CRLF -> LF false å¤‰æ›ã—ãªã„ å¤‰æ›ã—ãªã„ ãƒ»config --global core.editor gitã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã‚¨ãƒ‡ã‚£ã‚¿ã‚’è¨­å®šã™ã‚‹ï¼ã“ã“ã§ã¯ï¼ŒVimã‚’ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã¨ã™ã‚‹ï¼ $ git config --global core.editor \"vim -c \"set fenc=utf-8\"\" remote ãƒ»remote set-url origin ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆãƒªãƒã‚¸ãƒˆãƒªã«æ¥ç¶šã™ã‚‹ï¼configãƒ•ã‚¡ã‚¤ãƒ«ã«è¨˜è¿°ã•ã‚ŒãŸãƒ¦ãƒ¼ã‚¶åã¨æ¥ç¶šåã‚’è¨­å®šã™ã‚‹ï¼ä¸€ã¤ã®PCã§è¤‡æ•°ã®GitHubã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’ä½¿ç”¨ã—ã¦ã„ã‚‹å ´åˆï¼Œè¨­å®šãŒå¿…é ˆã§ã‚ã‚‹ï¼ $ git remote set-url origin @:/.git # ãƒªãƒã‚¸ãƒˆãƒªï¼‘ Host User Port 22 HostName IdentityFile # ãƒªãƒã‚¸ãƒˆãƒªï¼’ Host User Port 22 HostName IdentityFile ãƒªãƒã‚¸ãƒˆãƒªã«å¯¾ã—ã¦pushã‚’å®Ÿè¡Œã—ã¦ã‚¨ãƒ©ãƒ¼ãŒå‡ºãŸå ´åˆï¼Œç•°ãªã‚‹æ¥ç¶šåãŒé¸ã°ã‚Œã¦ã„ã‚‹å ´åˆã¯ï¼ŒURLã®ã€æ¥ç¶šåã€ã®éƒ¨åˆ†ãŒæ­£ã—ãè¨­å®šã•ã‚Œã¦ã„ã‚‹ã‹ã‚’ç¢ºèªã™ã‚‹ï¼ $ git push ERROR: Permission to hiroki-it/*****.git denied to Foo. fatal: Could not read from remote repository. Please make sure you have the correct access rights and the repository exists. 02. é–‹ç™ºç³»ã‚³ãƒãƒ³ãƒ‰ add ãƒ»add --all å¤‰æ›´ã—ãŸå…¨ã¦ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’addã™ã‚‹ï¼ branch ãƒ»branch --all ä½œæ¥­ä¸­ã®ãƒ­ãƒ¼ã‚«ãƒ«ãƒ–ãƒ©ãƒ³ãƒã¨ãƒªãƒ¢ãƒ¼ãƒˆè¿½è·¡ãƒ–ãƒ©ãƒ³ãƒã‚’è¡¨ç¤ºï¼ ãƒ»branch --delete --force ãƒ­ãƒ¼ã‚«ãƒ«ãƒ–ãƒ©ãƒ³ãƒå} ãƒ—ãƒƒã‚·ãƒ¥ã¨ãƒãƒ¼ã‚¸ã®çŠ¶æ…‹ã«é–¢ä¿‚ãªãï¼Œãƒ­ãƒ¼ã‚«ãƒ«ãƒ–ãƒ©ãƒ³ãƒã‚’å‰Šé™¤ï¼ ãƒ»branch --move ä½œæ¥­ä¸­ã®ãƒ­ãƒ¼ã‚«ãƒ«ãƒ–ãƒ©ãƒ³ãƒã®åå‰ã‚’å¤‰æ›´ï¼ ãƒ»branch --delete --remote origin/ ãƒªãƒ¢ãƒ¼ãƒˆè¿½è·¡ãƒ–ãƒ©ãƒ³ãƒã‚’å‰Šé™¤ï¼ ï¼ˆï¼‘ï¼‰ã¾ãšï¼Œbranch --allã§ä½œæ¥­ä¸­ã®ãƒ­ãƒ¼ã‚«ãƒ«ãƒ–ãƒ©ãƒ³ãƒã¨ãƒªãƒ¢ãƒ¼ãƒˆè¿½è·¡ãƒ–ãƒ©ãƒ³ãƒã‚’è¡¨ç¤ºï¼ $ git branch --all * master remotes/origin/2019/Symfony_Nyumon/master remotes/origin/master ï¼ˆï¼’ï¼‰remotes/origin/2019/Symfony_Nyumon/masterã‚’å‰Šé™¤ï¼ $ git branch -d -r origin/2019/Symfony_Nyumon/master Deleted remote-tracking branch origin/2019/Symfony_Nyumon/master (was 18a31b5). ï¼ˆï¼“ï¼‰å†ã³ï¼Œbranch --allã§å‰Šé™¤ã•ã‚ŒãŸã“ã¨ã‚’ç¢ºèªï¼ $ git branch --all * master remotes/origin/master ãƒ»branch checkout -b $ git checkout -b feature/3 d7e49b04 æŒ‡å®šã®ã‚³ãƒŸãƒƒãƒˆã‹ã‚‰æ–°ã—ã„ãƒ–ãƒ©ãƒ³ãƒã‚’ç”Ÿã‚„ã™ã“ã¨ãŒã§ãã‚‹ï¼ cherry-pick ãƒ»cherry-pick -m 1 ç¾åœ¨ã®ãƒ–ãƒ©ãƒ³ãƒã«å¯¾ã—ã¦ï¼ŒæŒ‡å®šã—ãŸã‚³ãƒŸãƒƒãƒˆãã‚Œå˜ä½“ã‚’ãƒãƒ¼ã‚¸ã™ã‚‹ï¼ $ git cherry-pick 1d0ddeb9e52 ãƒ—ãƒ«ãƒªã‚¯ã®ãƒãƒ¼ã‚¸ã«ã‚ˆã‚‹ãƒãƒ¼ã‚¸ã‚³ãƒŸãƒƒãƒˆã‚’æŒ‡å®šã™ã‚‹ã¨ï¼Œãã®ãƒ—ãƒ«ãƒªã‚¯ã§å¤‰æ›´ã•ã‚ŒãŸãƒ•ã‚¡ã‚¤ãƒ«ã®ã¿ãŒã‚³ãƒŸãƒƒãƒˆã®å†…å®¹ã¨ã—ã¦å–å¾—ã§ãã‚‹ï¼ã“ã‚Œã«ã‚ˆã‚Šï¼Œdevelopãƒ–ãƒ©ãƒ³ãƒä¸Šã®å¿…è¦ãªå¤‰æ›´ã®ã¿ã‚’ãƒªãƒªãƒ¼ã‚¹ã™ã‚‹ã“ã¨ã‚‚å¯èƒ½ã§ã‚ã‚‹ï¼ãŸã ã—ï¼Œãƒãƒ¼ã‚¸ã‚³ãƒŸãƒƒãƒˆã‚’æŒ‡å®šã™ã‚‹æ™‚ã¯mã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’æœ‰åŠ¹åŒ–ã—ãªã„ã¨ã‚¨ãƒ©ãƒ¼ã«ãªã‚‹ã“ã¨ã«æ³¨æ„ã™ã‚‹ï¼ # mã‚ªãƒ—ã‚·ãƒ§ãƒ³ãŒãªã„ã¨ã‚¨ãƒ©ãƒ¼ $ git cherry-pick d7e49b04 error: commit d7e49b04 is a merge but no -m option was given. fatal: cherry-pick failed # mã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’æœ‰åŠ¹åŒ–ã™ã‚‹ $ git cherry-pick -m 1 d7e49b04 [master a9ebcb4] Merge pull request #276 from feature/123 Author: hiroki-it Date: Wed Sep 15 00:00:00 2021 +0900 1 file changed, 7 insertions(+) stash ãƒ»stashã¨ã¯ ãƒ•ã‚¡ã‚¤ãƒ«ãŒï¼Œã€ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã€ï¼ˆ=addï¼‰ã‚ã‚‹ã„ã¯ã€HEADã€ï¼ˆ=commitï¼‰ã«å­˜åœ¨ã—ã¦ã„ã‚‹çŠ¶æ…‹ã§ï¼Œç•°ãªã‚‹ãƒ­ãƒ¼ã‚«ãƒ«ãƒ–ãƒ©ãƒ³ãƒã‚’checkoutã—ã‚ˆã†ã¨ã™ã‚‹ã¨ï¼Œä»¥ä¸‹ã®ã‚¨ãƒ©ãƒ¼ãŒå‡ºã‚‹ï¼ $ git checkout 2019/Symfony2_Ny umon/master error: Your local changes to the following files would be overwritten by checkout: app/config/config.yml src/AppBundle/Entity/Inquiry.php Please commit your changes or stash them before you switch branches. Aborting ã“ã®å ´åˆï¼Œä¸€åº¦stashã‚’è¡Œã„ï¼Œã€ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã€ï¼ˆ=addï¼‰ã‚ã‚‹ã„ã¯ã€HEADã€ï¼ˆ=commitï¼‰ã‚’æ¨ªã«ç½®ã„ã¦ãŠãå¿…è¦ãŒã‚ã‚‹ï¼ ãƒ»stash -u --include-untracked ãƒˆãƒ©ãƒƒã‚­ãƒ³ã‚°ã•ã‚Œã¦ã„ãªã„ãƒ•ã‚¡ã‚¤ãƒ«ã‚‚å«ã‚ã¦ï¼Œå…¨ã¦ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é€€é¿ï¼ git statusã‚’ã—ãŸã¨ã“ã‚ï¼Œä¿®æ­£ãƒ•ã‚¡ã‚¤ãƒ«ãŒï¼“ã¤ï¼Œãƒˆãƒ©ãƒƒã‚¯ã•ã‚Œã¦ã„ãªã„ãƒ•ã‚¡ã‚¤ãƒ«ãŒï¼‘ã¤ã‚ã‚‹ï¼ $ git status On branch 2019/Symfony2_Nyumon/feature/6 Your branch is up to date with \"origin/2019/Symfony2_Nyumon/feature/6\". Changes not staged for commit: (use \"git add ...\" to update what will be committed) (use \"git checkout -- ...\" to discard changes in working directory) modified: app/Resources/views/Inquiry/index.html.twig modified: app/config/config.yml modified: src/AppBundle/Entity/Inquiry.php Untracked files: (use \"git add ...\" to include in what will be committed) app/Resources/views/Toppage/menu.html.twig no changes added to commit (use \"git add\" and/or \"git commit -a\") ã“ã‚Œã‚’ï¼Œstash -uã™ã‚‹ $ git stash -u Saved working directory and index state WIP on 2019/Symfony2_Nyumon/feature/6: 649995e update #6 xxx ã“ã‚Œã‚‰ã®ãƒ•ã‚¡ã‚¤ãƒ«ã®å¤‰æ›´ç‚¹ã‚’ä¸€æ™‚çš„ã«é€€é¿ã§ãã‚‹ï¼ ãƒ»stash -- ç‰¹å®šã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚„ãƒ•ã‚¡ã‚¤ãƒ«ã®ã¿stashã§ãã‚‹ï¼ git stash -- src/... ãƒ»stash list é€€é¿ã—ã¦ã„ã‚‹ã€ãƒ•ã‚¡ã‚¤ãƒ«ç•ªå·ãƒ–ãƒ©ãƒ³ãƒè¦ªã‚³ãƒŸãƒƒãƒˆã¨ã‚³ãƒŸãƒƒãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã€ã‚’ä¸€è¦§ã§è¡¨ç¤ºï¼ $ git stash list stash@{0}: WIP on 2019/Symfony2_Nyumon/feature/6: 649995e update #6 xxx ãƒ»stash pop stash@{} é€€é¿ã—ã¦ã„ã‚‹æŒ‡å®šã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’å¾©å…ƒï¼ $ git stash pop stash@{0} On branch 2019/Symfony2_Nyumon/feature/8 Changes not staged for commit: (use \"git add ...\" to update what will be committed) (use \"git checkout -- ...\" to discard changes in working directory) modified: app/Resources/views/Inquiry/index.html.twig modified: app/config/config.yml modified: src/AppBundle/Entity/Inquiry.php Untracked files: (use \"git add ...\" to include in what will be committed) app/Resources/views/Toppage/menu.html.twig no changes added to commit (use \"git add\" and/or \"git commit -a\") ãƒ»stash drop stash@{} é€€é¿ã—ã¦ã„ã‚‹æŒ‡å®šã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’å¾©å…ƒã›ãšã«å‰Šé™¤ï¼ $ git stash drop stash@{0} Dropped refs/stash@{0} (1d0ddeb9e52a737dcdbff7296272080e9ff71815) ãƒ»stash clear é€€é¿ã—ã¦ã„ã‚‹å…¨ã¦ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’å¾©å…ƒã›ãšã«å‰Šé™¤ï¼ $ git stash clear revert ãƒ»revertã¨ã¯ ä½œæ¥­ä¸­ã®ãƒ­ãƒ¼ã‚«ãƒ«ãƒ–ãƒ©ãƒ³ãƒã«ãŠã„ã¦ï¼ŒæŒ‡å®šã®å±¥æ­´ã‚’å‰Šé™¤ï¼ ãƒ»revert --no-edit æŒ‡å®šã—ãŸã‚³ãƒŸãƒƒãƒˆã®ã¿ã‚’æ‰“ã¡æ¶ˆã™æ–°ã—ã„ã‚³ãƒŸãƒƒãƒˆã‚’ä½œæˆã™ã‚‹ï¼ã‚³ãƒŸãƒƒãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã¯ï¼Œæ‰“ã¡æ¶ˆã™ã‚³ãƒŸãƒƒãƒˆã¨åŒã˜ã‚‚ã®ã«ãªã‚‹ï¼ãƒªãƒªãƒ¼ã‚¹å¾Œã«å…ƒã«æˆ»ã—ãŸã„æ™‚ã«å½¹ç«‹ã¤ï¼ $ git revert --no-edit ãƒ»revert --edit æŒ‡å®šã—ãŸã‚³ãƒŸãƒƒãƒˆã®ã¿ã‚’æ‰“ã¡æ¶ˆã™æ–°ã—ã„ã‚³ãƒŸãƒƒãƒˆã‚’ä½œæˆã™ã‚‹ï¼vimãŒèµ·å‹•ã™ã‚‹ã®ã§ï¼Œã‚³ãƒŸãƒƒãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’æ–°ã—ã„ã‚‚ã®ã«å¤‰æ›´ã™ã‚‹ï¼ $ git revert --edit ãƒ»revert -m æŒ‡å®šã—ãŸãƒãƒ¼ã‚¸ã‚³ãƒŸãƒƒãƒˆã®ã¿ã‚’æ‰“ã¡æ¶ˆã™æ–°ã—ã„ã‚³ãƒŸãƒƒãƒˆã‚’ä½œæˆã™ã‚‹ï¼ã‚³ãƒŸãƒƒãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã¯ï¼Œæ‰“ã¡æ¶ˆã™ã‚³ãƒŸãƒƒãƒˆã¨åŒã˜ã‚‚ã®ã«ãªã‚‹ï¼ãƒãƒ¼ã‚¸ãƒŠãƒ³ãƒãƒ¼ã‚’äº‹å‰ã«ç¢ºèªã—ã¦ãŠãå¿…è¦ãŒã‚ã‚‹ï¼ $ git show commit xyz Merge: 1a1a1a 2b2b2b #ã“ã“ã«æ³¨ç›® Author: xxxx xxxx Date: Thu Jul 13 09:00:00 2017 +0000 Merge commit $ git revert -m 1 xyz reset ãƒ»resetã¨ã¯ ä½œæ¥­ä¸­ã®ãƒ­ãƒ¼ã‚«ãƒ«ãƒ–ãƒ©ãƒ³ãƒã«ãŠã„ã¦ï¼ŒæŒ‡å®šã®å±¥æ­´ã¾ã§æˆ»ã—ï¼Œãã‚Œä»¥é™ã‚’å‰Šé™¤ï¼ ãƒ»reset HEAD ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã‹ã‚‰ï¼ŒæŒ‡å®šã—ãŸãƒ•ã‚¡ã‚¤ãƒ«ã‚’å‰Šé™¤ï¼ $ git reset HEAD ãƒ»reset --soft ä½œæ¥­ä¸­ã®ãƒ­ãƒ¼ã‚«ãƒ«ãƒ–ãƒ©ãƒ³ãƒã«ãŠã„ã¦ï¼Œæœ€æ–°ã®HEADï¼ˆ=commitå¾Œï¼‰ã‚’æŒ‡å®šã®å±¥æ­´ã¾ã§æˆ»ã—ï¼Œãã‚Œä»¥é™ã‚’å‰Šé™¤ã™ã‚‹ï¼commitã®ã¿ã‚’å–ã‚Šæ¶ˆã—ãŸã„å ´åˆã¯ã“ã‚Œï¼ $ git reset --soft ãƒ»reset --mixed ä½œæ¥­ä¸­ã®ãƒ­ãƒ¼ã‚«ãƒ«ãƒ–ãƒ©ãƒ³ãƒã«ãŠã„ã¦ï¼Œã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ï¼ˆ=addå¾Œï¼‰ï¼ŒHEADï¼ˆ=commitå¾Œï¼‰ã‚’æŒ‡å®šã®å±¥æ­´ã¾ã§æˆ»ã—ï¼Œãã‚Œä»¥é™ã‚’å‰Šé™¤ï¼addã¨commitã‚’å–ã‚Šæ¶ˆã—ãŸã„å ´åˆã¯ã“ã‚Œï¼ $ git reset --mixed ãƒ»reset --hard ä½œæ¥­ä¸­ã®ãƒ­ãƒ¼ã‚«ãƒ«ãƒ–ãƒ©ãƒ³ãƒã«ãŠã„ã¦ï¼Œæœ€æ–°ã®ãƒ¯ãƒ¼ã‚¯ãƒ„ãƒªãƒ¼ï¼ˆ=ãƒ•ã‚©ãƒ«ãƒ€ï¼‰ï¼Œã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ï¼ˆ=addå¾Œï¼‰ï¼ŒHEADï¼ˆ=commitå¾Œï¼‰ã‚’æŒ‡å®šã®å±¥æ­´ã¾ã§æˆ»ã—ï¼Œãã‚Œä»¥é™ã‚’å‰Šé™¤ï¼ **ãƒ¯ãƒ¼ã‚¯ãƒ„ãƒªãƒ¼ï¼ˆ=ãƒ•ã‚©ãƒ«ãƒ€ï¼‰å†…ã®ãƒ•ã‚¡ã‚¤ãƒ«ã®çŠ¶æ…‹ã‚‚æˆ»ã£ã¦ã—ã¾ã†ã®ã§ï¼Œå–ã‚Šæ‰±ã„æ³¨æ„ï¼ï¼** $ git reset --hard ãƒ»resetã®ä½¿ç”¨ä¾‹ ã¾ãšï¼Œlogã‚³ãƒãƒ³ãƒ‰ã§ï¼Œä½œæ¥­ä¸­ã®ãƒ­ãƒ¼ã‚«ãƒ«ãƒ–ãƒ©ãƒ³ãƒã«ãŠã‘ã‚‹ã‚³ãƒŸãƒƒãƒˆIDã‚’ç¢ºèªï¼ $ git log commit f17f68e287b7d84318b4c49e133b2d1819f6c3db (HEAD -> master, 2019/Symfony2_Nyumon/master) Merge: 41cc21b f81c813 Author: hiroki-it Date: Wed Mar 20 22:56:32 2019 +0900 Merge remote-tracking branch \"refs/remotes/origin/master\" commit 41cc21bb53a8597270b5deae3259751df18bce81 Author: hiroki-it Date: Wed Mar 20 20:54:34 2019 +0900 add #0 xxxã•ã‚“ã®README_2ã‚’è¿½åŠ  commit f81c813a1ead9a968c109671e6d83934debcab2e Author: hiroki-it Date: Wed Mar 20 20:54:34 2019 +0900 add #0 xxxã•ã‚“ã®README_1ã‚’è¿½åŠ  æŒ‡å®šã®ã‚³ãƒŸãƒƒãƒˆã¾ã§å±¥æ­´ã‚’æˆ»ã™ï¼ $ git reset --soft f81c813a1ead9a968c109671e6d83934debcab2e logã‚³ãƒãƒ³ãƒ‰ã§ï¼Œæ­£ã—ãå¤‰æ›´ã•ã‚Œã¦ã„ã‚‹ã‹ç¢ºèªï¼ $ git log commit f81c813a1ead9a968c109671e6d83934debcab2e (HEAD -> master) Author: Hiroki Hasegawa Date: Wed Mar 20 20:54:34 2019 +0900 add æ–°ã—ã„READMEã‚’è¿½åŠ  push --forceã§ãƒ­ãƒ¼ã‚«ãƒ«ãƒªãƒã‚¸ãƒˆãƒªã®å¤‰æ›´ã‚’ãƒªãƒ¢ãƒ¼ãƒˆãƒªãƒã‚¸ãƒˆãƒªã«å¼·åˆ¶çš„ã«åæ˜ ï¼**ã€å¼·åˆ¶çš„ã«pushã—ãŸã€ã¨ã„ã†ãƒ­ã‚°ã‚‚ï¼Œãƒªãƒ¢ãƒ¼ãƒˆå´ã«ã¯æ®‹ã‚‰ãªã„ï¼** $ git push --force Total 0 (delta 0), reused 0 (delta 0) To github.com:hiroki-it/Symfony2_Nyumon.git + f0d8b1a...f81c813 master -> master (forced update) rebase ãƒ»rebaseã¨ã¯ï¼ˆæ³¨æ„ç‚¹ã‚ã‚Šï¼‰ ä½œæ¥­ä¸­ã®ãƒ­ãƒ¼ã‚«ãƒ«ãƒ–ãƒ©ãƒ³ãƒã«ãŠã„ã¦ï¼Œãƒ–ãƒ©ãƒ³ãƒã®æ´¾ç”Ÿå…ƒã‚’å¤‰æ›´ï¼ãƒªãƒ¢ãƒ¼ãƒˆãƒ–ãƒ©ãƒ³ãƒã«pushã—ãŸå¾Œã¯ä½¿ã£ã¦ã¯ãªã‚‰ãšï¼Œä»–ã®ã‚³ãƒãƒ³ãƒ‰ã‚’ä½¿ã†ï¼ ãƒ»rebase --interactive æ´¾ç”Ÿå…ƒã‚’å¤‰æ›´ã™ã‚‹æ©Ÿèƒ½ã‚’å¿œç”¨ã—ã¦ï¼Œéå»ã®ã‚³ãƒŸãƒƒãƒˆã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å¤‰æ›´ï¼Œå‰Šé™¤ï¼Œçµ±åˆãªã©ã‚’è¡Œã†ï¼ ï¼Šã‚³ãƒãƒ³ãƒ‰ä¾‹ï¼ˆã‚³ãƒŸãƒƒãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®å¤‰æ›´ï¼‰ï¼Š ã¾ãšï¼Œlogã‚³ãƒãƒ³ãƒ‰ã§ï¼Œä½œæ¥­ä¸­ã®ãƒ­ãƒ¼ã‚«ãƒ«ãƒ–ãƒ©ãƒ³ãƒã«ãŠã‘ã‚‹ã‚³ãƒŸãƒƒãƒˆIDã‚’ç¢ºèªï¼ $ git log commit f17f68e287b7d84318b4c49e133b2d1819f6c3db (HEAD -> master, 2019/Symfony2_Nyumon/master) Merge: 41cc21b f81c813 Author: Hiroki Hasegawa Date: Wed Mar 20 22:56:32 2019 +0900 Merge remote-tracking branch \"refs/remotes/origin/master\" commit 41cc21bb53a8597270b5deae3259751df18bce81 Author: Hiroki Hasegawa Date: Wed Mar 20 20:54:34 2019 +0900 add #0 xxxã•ã‚“ã®README_2ã‚’è¿½åŠ  commit f81c813a1ead9a968c109671e6d83934debcab2e Author: Hiroki Hasegawa Date: Wed Mar 20 20:54:34 2019 +0900 add #0 xxxã•ã‚“ã®README_1ã‚’è¿½åŠ  æŒ‡å®šã—ãŸå±¥æ­´ã®å‰Šé™¤ $ git rebase --interactive 41cc21bb53a8597270b5deae3259751df18bce81 ã¨ã™ã‚‹ã¨ï¼Œã‚¿ãƒ–ãŒè¡¨ç¤ºã•ã‚Œï¼ŒæŒ‡å®šã®ã‚³ãƒŸãƒƒãƒˆIDã®å±¥æ­´ãŒè¡¨ç¤ºã•ã‚Œã‚‹ pick b1b5c0f add #0 xxxxxxxxxx ã€æŒ¿å…¥ãƒ¢ãƒ¼ãƒ‰ã€ã«å¤‰æ›´ã—ï¼Œã“ã®ä¸€è¡Œã®pickã‚’editã«å¤‰æ›´ï¼ãã®å¾Œï¼Œ :w ã¨ã—ã¦ä¿å­˜ï¼ãã®å¾Œï¼Œã‚¨ãƒ‡ã‚£ã‚¿ä¸Šã§ã€Ctrl+Cã€ã‚’æŠ¼ã—ï¼Œ :qa! ã§çµ‚äº†ï¼ commit --amendã«mã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’ä»˜ã‘ã¦ï¼Œãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å¤‰æ›´ï¼ $ git commit --amend -m=\"\" rebase --continueã‚’å®Ÿè¡Œã—ï¼Œå¤‰æ›´ã‚’åæ˜ ã•ã›ã‚‹ï¼ $ git rebase --continue Successfully rebased and updated refs/heads/develop. pushã—ã‚ˆã†ã¨ã™ã‚‹ã¨ï¼Œ![rejected] develop -> develop (non-fast-forward)ã¨ã‚¨ãƒ©ãƒ¼ãŒå‡ºã‚‹ã®ã§ï¼Œ $ git merge --allow-unrelated-histories ã§è§£æ±ºã—ï¼Œpushã™ã‚‹ï¼ ï¼Šã‚³ãƒãƒ³ãƒ‰ä¾‹ï¼ˆAuthoråã¨Commiteråã®å¤‰æ›´ï¼‰ï¼Š ãƒãƒƒã‚·ãƒ¥å€¤ã‚’æŒ‡å®šã—ã¦ï¼Œrebaseã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã™ã‚‹ï¼ $ git rebase --interactive 41cc21bb53a8597270b5deae3259751df18bce81 commit --amendã«reset-authorã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’ä»˜ã‘ã¦ï¼Œconfigã§è¨­å®šã—ãŸåå‰ã‚’Authoråã¨Comitteråã«é©ç”¨ã™ã‚‹ï¼ $ git commit --amend --reset-author rebase --continueã‚’å®Ÿè¡Œã—ï¼Œå¤‰æ›´ã‚’åæ˜ ã•ã›ã‚‹ï¼ $ git rebase --continue Successfully rebased and updated refs/heads/develop. éå»ã®å…¨ã¦ã®ã‚³ãƒŸãƒƒãƒˆã«å¯¾ã—ã¦ï¼ŒAuthoråã¨Committeråã‚’é©ç”¨ã™ã‚‹ã‚³ãƒãƒ³ãƒ‰ã‚‚ã‚ã‚‹ï¼ã—ã‹ã—ï¼Œå±é™ºãªæ–¹æ³•ã§ã‚ã‚‹ãŸã‚ï¼Œå€‹äººåˆ©ç”¨ã®ãƒªãƒã‚¸ãƒˆãƒªã®ã¿ã§ä½¿ç”¨ã™ã‚‹ã‚ˆã†ã«ã™ã‚‹ã¹ãã§ã‚ã‚‹ï¼ #!/bin/bash git filter-branch -f --env-filter \" # Authoråã‹Committeråã®ã„ãšã‚Œã‹ãŒèª¤ã£ã¦ã„ã‚Œã°é©ç”¨ã—ã¾ã™ï¼ if [ ${GIT_AUTHOR_NAME}=\"Hiroki-Hasegawa\" -o ${GIT_COMMITTER_NAME}=\"Hiroki-Hasegawa\" ] ; then export GIT_AUTHOR_NAME=\"hiroki-it\" export GIT_AUTHOR_EMAIL=\"example@gmail.com\" export GIT_COMMITTER_NAME=\"hiroki-it\" export GIT_COMMITTER_EMAIL=\"example@gmail.com\" fi\" ãƒ»rebase --onto ä½œæ¥­ä¸­ã®ãƒ­ãƒ¼ã‚«ãƒ«ãƒ–ãƒ©ãƒ³ãƒã®æ´¾ç”Ÿå…ƒã‚’å¤‰æ›´ï¼ $ git rebase --onto ãƒ»rebase --interactive --root ä¸€ç•ªå¤ã„ï¼Œæœ€åˆã®å±¥æ­´ã‚’å‰Šé™¤ï¼ ï¼ˆï¼‘ï¼‰å¤‰æ›´ã‚¿ãƒ–ã®è¡¨ç¤º $ git rebase --interactive --root ã¨ã™ã‚‹ã¨ï¼Œæœ€åˆã®å±¥æ­´ãŒè¨˜è¿°ã•ã‚ŒãŸã‚¿ãƒ–ãŒè¡¨ç¤ºã•ã‚Œã‚‹ pick b1b5c0f add #0 xxxxxxxxxx ï¼ˆï¼’ï¼‰pick b1b5c0f add #0 xxxxxxxxxxã®è¡Œã‚’å‰Šé™¤ã—ã¦ä¿å­˜ã—ï¼Œã‚¿ãƒ–ã‚’é–‰ã˜ï¼Œã‚¨ãƒ‡ã‚£ã‚¿ä¸Šã§ã€Ctrl+Cã€ã‚’æŠ¼ã™ï¼ :qa! ã“ã“ã§æœªçŸ¥ã®ã‚¨ãƒ©ãƒ¼ CONFLICT (modify/delete): README.md deleted in HEAD and modified in 37bee65... update #0 README.mdã«æœ¬ãƒ¬ãƒã‚¸ãƒˆãƒªã®ã‚¿ã‚¤ãƒˆãƒ«ã¨å¼•ç”¨ã‚’è¨˜è¼‰ ã—ãŸ. Version 37bee65... update #0 README.mdã«æœ¬ãƒ¬ãƒã‚¸ãƒˆãƒªã®ã‚¿ã‚¤ãƒˆãƒ«ã¨å¼•ç”¨ã‚’è¨˜è¼‰ã—ãŸ of README.md left in tree. error: could not apply 37bee65... update #0 README.mdã«æœ¬ãƒ¬ãƒã‚¸ãƒˆãƒªã®ã‚¿ã‚¤ãƒˆãƒ«ã¨å¼•ç”¨ã‚’è¨˜è¼‰ã—ãŸ Resolve all conflicts manually, mark them as resolved with \"git add/rm \", then run \"git rebase --continue\". You can instead skip this commit: run \"git rebase --skip\". To abort and get back to the state before \"git rebase\", run \"git rebase --abort\". Could not apply 37bee65... update #0 README.mdã«æœ¬ãƒ¬ãƒã‚¸ãƒˆãƒªã®ã‚¿ã‚¤ãƒˆãƒ«ã¨å¼•ç”¨ã‚’è¨˜è¼‰ã—ãŸ ãƒ»rebase --abort ã‚„ã‚Šã‹ã‘ã®rebaseã‚’å–ã‚Šæ¶ˆã—ï¼ ä½œæ¥­ä¸­ã®ãƒ­ãƒ¼ã‚«ãƒ«ãƒ–ãƒ©ãƒ³ãƒã«ãŠã‘ã‚‹(master|REBASE-i)ãŒï¼Œ(master)ã«å¤‰æ›´ã•ã‚Œã¦ã„ã‚‹ã“ã¨ã‹ã‚‰ã‚‚ç¢ºèªå¯èƒ½ï¼ hasegawahiroki@Hiroki-Fujitsu MINGW64 /c/Projects/Symfony2_Nyumon $ git rebase --interactive hasegawahiroki@Hiroki-Fujitsu MINGW64 /c/Projects/Symfony2_Nyumon (master|REBASE-i) $ git rebase --abort hasegawahiroki@Hiroki-Fujitsu MINGW64 /c/Projects/Symfony2_Nyumon (master) $ pull ãƒ»ã‚³ãƒãƒ³ãƒ‰çµ„ã¿åˆã‚ã› å…¨ã¦ã®ãƒªãƒ¢ãƒ¼ãƒˆãƒ–ãƒ©ãƒ³ãƒã‚’pullã™ã‚‹ï¼ $ git branch -r \\ | grep -v \"\\->\" \\ | grep -v main \\ | while read remote; do git branch --track \"${remote#origin/}\" \"$remote\"; done $ git fetch --all $ git pull --all push ãƒ»push -u origin ãƒ­ãƒ¼ã‚«ãƒ«ã§ä½œæˆã—ãŸãƒ–ãƒ©ãƒ³ãƒã‚’ï¼Œãƒªãƒ¢ãƒ¼ãƒˆã«pushã™ã‚‹ï¼ã‚³ãƒŸãƒƒãƒˆã¯ç„¡ãã¦ã‚‚è‰¯ã„ï¼ ãƒ»push origin :master ãƒˆãƒ©ã‚¦ãƒã‚³ãƒãƒ³ãƒ‰ ãƒ»push --delete origin ãƒªãƒ¢ãƒ¼ãƒˆãƒ–ãƒ©ãƒ³ãƒã®ã‚¿ã‚°ã‚’å‰Šé™¤ã™ã‚‹ï¼ $ git push --delete origin v1.0.0 ãªãŠï¼Œãƒ­ãƒ¼ã‚«ãƒ«ã®ã‚¿ã‚°ã¯åˆ¥ã«å‰Šé™¤ã™ã‚‹å¿…è¦ãŒã‚ã‚‹ï¼ $ git tag -d v1.0.0 ãƒ»push --tags ãƒ­ãƒ¼ã‚«ãƒ«ã®ã‚³ãƒŸãƒƒãƒˆã«ä»˜ä¸ã—ãŸã‚¿ã‚°ã‚’ãƒªãƒ¢ãƒ¼ãƒˆã«pushã™ã‚‹ï¼ show-branch ä½œæ¥­ãƒ–ãƒ©ãƒ³ãƒã®æ´¾ç”Ÿå…ƒã«ãªã£ã¦ã„ã‚‹ãƒ–ãƒ©ãƒ³ãƒã‚’ç¢ºèªï¼ $ git show-branch \\ | grep \"*\" \\ | grep -v \"$(git rev-parse --abbrev-ref HEAD)\" \\ | head -1 \\ | awk -F\"[]~^[]\" \"{print $2}\" filter-branch ãƒ»filter-branch -f --env-filter å…¨ã¦ã®ã‚³ãƒŸãƒƒãƒˆã®åå‰ã¨ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’ä¸Šæ›¸ãã™ã‚‹ï¼ $ git filter-branch -f --env-filter \\ \"GIT_AUTHOR_NAME=\"hiroki-it\"; \\ GIT_AUTHOR_EMAIL=\"example@gmail.com\"; \\ GIT_COMMITTER_NAME=\"hiroki-it\"; \\ GIT_COMMITTER_EMAIL=\"example@gmail.com\";\" \\ HEAD ãƒ»filter-branch -f --tree-filter å…¨ã¦ã®ã‚³ãƒŸãƒƒãƒˆã«å¯¾ã—ã¦ï¼ŒæŒ‡å®šã—ãŸå‡¦ç†ã‚’å®Ÿè¡Œã™ã‚‹ï¼ ï¼Šä¾‹ï¼Š å…¨ã¦ã®ã‚³ãƒŸãƒƒãƒˆã«å¯¾ã—ã¦ï¼Œç‰¹å®šã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’å‰Šé™¤ã™ã‚‹å‡¦ç†ã‚’å®Ÿè¡Œã™ã‚‹ï¼åŠ ãˆã¦ï¼Œãƒ­ãƒ¼ã‚«ãƒ«ãƒªãƒã‚¸ãƒˆãƒªã«å¯¾ã—ã¦ã‚¬ãƒ¼ãƒ™ã‚¸ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã‚’å®Ÿè¡Œã™ã‚‹ã¨ï¼Œãƒ­ãƒ¼ã‚«ãƒ«ãƒªãƒã‚¸ãƒˆãƒªã‹ã‚‰å®Œå…¨ã«å‰Šé™¤ã§ãã‚‹ï¼ $ git filter-branch -f --tree-filter \\ 'rm -f ' HEAD # ã‚¬ãƒ™ãƒ¼ã‚¸ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã‚’å®Ÿè¡Œ $ git gc --aggressive --prune=now "},"public/statistic_analysis/statistic_analysis_r.html":{"url":"public/statistic_analysis/statistic_analysis_r.html","title":"ğŸ“– ï¸Rè¨€èª","keywords":"","body":"çµ±è¨ˆè§£æ ã¯ã˜ã‚ã« æœ¬ã‚µã‚¤ãƒˆã«ã¤ãã¾ã—ã¦ï¼Œä»¥ä¸‹ã‚’ã”èªè­˜ã®ã»ã©å®œã—ããŠé¡˜ã„ã„ãŸã—ã¾ã™ï¼ å‚è€ƒï¼šhttps://hiroki-it.github.io/tech-notebook-gitbook/ ãƒ‡ãƒ¼ã‚¿è§£æã§æ°—ã‚’ã¤ã‘ã‚‹ã“ã¨ ãƒ‡ãƒ¼ã‚¿åˆ†æã«ã‚ˆã£ã¦ï¼Œä½•ã‚’æ˜ã‚‰ã‹ã«ã—ãŸã„ã®ã‹ï¼ æ˜ã‚‰ã‹ã«ã™ã‚‹ã“ã¨ã®ãŸã‚ã«ï¼Œã©ã®ãƒ‡ãƒ¼ã‚¿åˆ†æãŒå¿…è¦ãªã®ã‹ï¼ å¿…è¦ãªãƒ‡ãƒ¼ã‚¿åˆ†æã®ãŸã‚ã«ï¼Œã©ã‚“ãªå½¢å¼ã®ãƒ‡ãƒ¼ã‚¿ã‚’ç”¨æ„ã™ã‚‹å¿…è¦ãŒã‚ã‚‹ã®ã‹ï¼ 01. ç›¸é–¢åˆ†æ ãƒ‡ãƒ¼ã‚¿ã«ï¼Œã©ã®ç¨‹åº¦ã®ç›´ç·šçš„é–¢ä¿‚ãŒã‚ã‚‹ã‹ã‚’æ¤œå‡ºã™ã‚‹åˆ†ææ‰‹æ³•ï¼å›å¸°åˆ†æã‚’è¡Œã†ã‹å¦ã‹ã®åˆ¤æ–­ææ–™ã«ãªã‚‹ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š # ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã‚€ï¼ sample 02. ç·šå½¢å›å¸°åˆ†æ å› æœé–¢ä¿‚ãŒã‚ã‚Šãã†ãªãƒ‡ãƒ¼ã‚¿ã«å¯¾ã—ã¦ï¼Œæ¨ªè»¸ã‚’åŸå› ï¼Œã¾ãŸç¸¦è»¸ã‚’çµæœã¨ã—ï¼Œæœ€ã‚‚å½“ã¦ã¯ã¾ã‚Šã®è‰¯ã„ç·šå½¢ãƒ¢ãƒ‡ãƒ«ã‚’æ¨å®šã™ã‚‹åˆ†ææ‰‹æ³•ï¼ãƒ¢ãƒ‡ãƒ«ã®ç²¾åº¦ãŒé«˜ã‘ã‚Œã°å› æœé–¢ä¿‚ã®è¨¼æ˜ã«ãªã‚Šï¼Œã¾ãŸãƒ¢ãƒ‡ãƒ«ã«åŸå› ã‚’ä»£å…¥ã™ã‚‹ã“ã¨ã§çµæœã‚’äºˆæ¸¬ã§ãã‚‹ï¼ å˜å›å¸°åˆ†æ åŸå› ã¨çµæœãŒä¸€ã¤ãšã¤ã¨ä»®å®šã—ãŸæ™‚ã«ï¼Œæœ€ã‚‚å½“ã¦ã¯ã¾ã‚Šã®è‰¯ã„ç·šå½¢ãƒ¢ãƒ‡ãƒ«ã‚’æ¨å®šã§ãã‚‹ï¼ ãƒ»å›å¸°æ–¹ç¨‹å¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š # ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã‚€ï¼ sample |t|) # (Intercept) 1.099e+01 2.405e+00 4.571 3.11e-05 *** # ç´”åºƒå‘Š 2.239e-05 2.927e-05 0.765 0.448 # // ç´”åºƒå‘Šã®å›å¸°ä¿‚æ•°ã®på€¤ > 0.05 ã‚ˆã‚Šï¼Œå› æœé–¢ä¿‚ãŒãªã„å¯èƒ½æ€§ï¼ é‡å›å¸°åˆ†æ åŸå› ãŒäºŒã¤ä»¥ä¸Šã§çµæœãŒä¸€ã¤ã¨ä»®å®šã—ãŸæ™‚ã«ï¼Œæœ€ã‚‚å½“ã¦ã¯ã¾ã‚Šã®è‰¯ã„ç·šå½¢ãƒ¢ãƒ‡ãƒ«ã‚’æ¨å®šã§ãã‚‹ï¼ãŸã ã—ï¼Œã‚°ãƒ©ãƒ•ã§ã¯ï¼Œãƒ¢ãƒ‡ãƒ«ã¯å¹³é¢ã§è¡¨ã•ã‚Œã‚‹ï¼ ãƒ»å›å¸°æ–¹ç¨‹å¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š # ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã‚€ï¼ sample |t|) # (Intercept) 8.857 1.007 8.797 1.69e-11 *** # days.æœˆæ›œæ—¥ 5.286 1.744 3.031 0.003957 ** # days.ç«æ›œæ—¥ 4.893 1.670 2.930 0.005212 ** # days.æ°´æ›œæ—¥ 6.143 1.670 3.679 0.000601 *** # days.æœ¨æ›œæ—¥ 5.893 1.670 3.529 0.000944 *** # days.é‡‘æ›œæ—¥ 4.393 1.670 2.631 0.011479 * # // æœˆï¼Œæ°´ï¼Œé‡‘ã®å›å¸°ä¿‚æ•°ã®på€¤ 02-02. éç·šå½¢å›å¸°åˆ†æ å› æœé–¢ä¿‚ãŒã‚ã‚Šãã†ãªãƒ‡ãƒ¼ã‚¿ã«å¯¾ã—ã¦ï¼Œæ¨ªè»¸ã‚’åŸå› ï¼Œã¾ãŸç¸¦è»¸ã‚’çµæœã¨ã—ï¼Œæœ€ã‚‚å½“ã¦ã¯ã¾ã‚Šã®è‰¯ã„éç·šå½¢ãƒ¢ãƒ‡ãƒ«ã‚’æ¨å®šã™ã‚‹åˆ†ææ‰‹æ³•ï¼ãƒ¢ãƒ‡ãƒ«ã®ç²¾åº¦ãŒé«˜ã‘ã‚Œã°å› æœé–¢ä¿‚ã®è¨¼æ˜ã«ãªã‚Šï¼Œã¾ãŸãƒ¢ãƒ‡ãƒ«ã«åŸå› ã‚’ä»£å…¥ã™ã‚‹ã“ã¨ã§çµæœã‚’äºˆæ¸¬ã§ãã‚‹ï¼éç·šå½¢ãƒ¢ãƒ‡ãƒ«ã‚’æ¨å®šã™ã‚‹ãŸã‚ã«ã¯ï¼Œãƒ¢ãƒ‡ãƒ«ã‚’ä¸€èˆ¬åŒ–ã—ï¼Œä¸€èˆ¬åŒ–ç·šå½¢ãƒ¢ãƒ‡ãƒ«ã¨ã—ã¦å‡¦ç†ã™ã‚‹å¿…è¦ãŒã‚ã‚‹ï¼ ãƒ­ã‚¸ã‚¹ãƒ†ã‚£ãƒƒã‚¯å›å¸°åˆ†æ èª¬æ˜å¤‰æ•°ãŒè³ªçš„å¤‰æ•°ã®å ´åˆã«ï¼Œæœ€ã‚‚å½“ã¦ã¯ã¾ã‚Šã®è‰¯ã„éç·šå½¢ãƒ¢ãƒ‡ãƒ«ï¼ˆãƒ­ã‚¸ã‚¹ãƒ†ã‚£ãƒƒã‚¯åˆ†å¸ƒï¼‰ã‚’æ¨å®šã™ã‚‹ï¼ ãƒ»å›å¸°æ–¹ç¨‹å¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š # ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã‚€ï¼ sample 03. æ±ºå®šæœ¨åˆ†æ ãƒ‡ãƒ¼ã‚¿ã«å¯¾ã—ã¦ï¼Œæœ€ã‚‚å½“ã¦ã¯ã¾ã‚Šã®è‰¯ã„æ±ºå®šæœ¨ãƒ¢ãƒ‡ãƒ«ã‚’æ¨å®šã™ã‚‹åˆ†ææ‰‹æ³•ï¼ åˆ†é¡æœ¨åˆ†æ æ±ºå®šæœ¨ãƒ¢ãƒ‡ãƒ«ã‚’åˆ†é¡ãƒ¢ãƒ‡ãƒ«ã¨ã—ã¦ç”¨ã„ã‚‹å ´åˆã®æ±ºå®šæœ¨åˆ†æï¼ ãƒ»å›³è§£ä¾‹ èµ¤ã„ç‚¹ï¼šè¢«é¨“è€…ãŒæš‘ã„ã¨æ„Ÿã˜ãŸæ—¥ é’ã„ç‚¹ï¼šè¢«é¨“è€…ãŒæš‘ããªã„ã¨æ„Ÿã˜ãŸæ—¥ ï¼Šå®Ÿè£…ä¾‹ï¼Š # ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã‚€ï¼ sample 04. éšå±¤ã‚¯ãƒ©ã‚¹ã‚¿åˆ†æ ãƒ‡ãƒ¼ã‚¿ã‚’ï¼Œä¼¼ã¦ã„ã‚‹é †ã«éšå±¤çš„ã«ã‚°ãƒ«ãƒ¼ãƒ—åŒ–ï¼ˆã‚¯ãƒ©ã‚¹ã‚¿ãƒªãƒ³ã‚°ï¼‰ã—ã¦ã„ãåˆ†ææ‰‹æ³•ï¼ãƒ‡ãƒ¼ã‚¿é–“ã®åŒä¸€æ€§ã‚’æ˜ã‚‰ã‹ã«ã§ãã‚‹ï¼ ï¼Šå®Ÿè£…ä¾‹ï¼Š # ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã‚€ï¼ sample1 05. ã‚°ãƒ©ãƒ•ç”Ÿæˆé–¢æ•° ggplot() ggplot()ï¼šã‚°ãƒ©ãƒ•ã®ã‚­ãƒ£ãƒ³ãƒã‚¹ã‚’æº–å‚™ geom_XXX()ï¼šã‚°ãƒ©ãƒ•ã‚’ãƒ—ãƒ­ãƒƒãƒˆ theme()ï¼šã‚°ãƒ©ãƒ•ã‚’è¿½åŠ åŠ å·¥ "}}