# 可観測性

## 01. 可観測性

### 可観測性とは

<br>

### テレメトリー

#### ・テレメトリーとは

可観測性を実現するツールに求められる監視対象の要素（『メトリクス』『ログ』『分散トレース』）のこと．NewRelicやDatadogはこれらの要素を持つ．また，AWSではCloudWatch（メトリクス＋ログ）とX-Ray（分散トレース）を両方利用すると，これらの要素を満たせたことになり，可観測性を実現できる．

参考：

- https://www.forbes.com/sites/andythurai/2021/02/02/aiops-vs-observability-vs-monitoringwhat-is-the-difference-are-you-using-the-right-one-for-your-enterprise/
- https://knowledge.sakura.ad.jp/26395/

| テレメトリーコンポーネント | 説明                                                         | 補足 |
| -------------------------- | ------------------------------------------------------------ | ---- |
| メトリクス                 |                                                              |      |
| ログ                       |                                                              |      |
| 分散トレース               | マイクロサービスの各コンポーネントでイベントが発生した時，一連のイベントを因果関係として繋げたデータセットのこと． |      |

<br>

## 02. 監視

### 監視とは

可観測性を実現するための手段のこと．

<br>

### 監視の種類

監視は以下の種類に大別される．

#### ・外部監視

アプリケーション外部からの死活監視．アプリケーションにリクエストを送信し，レスポンスに関して，あらゆる情報を監視する．

#### ・内部監視

アプリケーション内部からの死活監視．アプリケーションのレスポンスからはわからないあらゆる情報を監視する．

#### ・合成監視

プログラムを使用して，実際のユーザを模したリクエストをアプリケーションに送信し，外部監視と内部監視を実行する．ユーザを模したリクエストを生成するという意味合いで，『合成』という．

<br>

### ４大シグナル

#### ・レイテンシー

参考：https://hiroki-it.github.io/tech-notebook-gitbook/public/infrastructure_network_internet.html

#### ・トラフィック

参考：https://hiroki-it.github.io/tech-notebook-gitbook/public/infrastructure_network_internet.html

#### ・エラー

| 種類         | 説明                                                         |
| ------------ | ------------------------------------------------------------ |
| 明示的エラー | 400/500系のレスポンス<                                       |
| 暗黙的エラー | SLOに満たない200/300系のレスポンス，API仕様に合っていないレスポンス |

#### ・サチュレーション

システム利用率（CPU利用率，メモリ理容室，ストレージ利用率，など）の飽和度のこと．例えば，以下の飽和度がある．60～70%で，警告ラインを設けておく必要がある．

<br>

## 03. 可観測性に基づく意思決定

### SLI：Service Level Indicator（サービスレベル指標）

#### ・SLIとは

サービスレベルの指標とするメトリクスのこと．

#### ・SLIの例

- サーバ稼働率
- データベース稼働率
- レイテンシー
- レスポンスタイム
- レスポンスのステータスコード率
- スループット

<br>

### SLO：Service Level Objective（サービスレベル目標）

#### ・SLOとは

SLIとして採用した指標の目標値のこと．99.9%の成功率を目標とすることが多い．

#### ・SLOの例

- サーバ稼働率（日当たり0.1%のダウンタイム）
- データベース稼働率（日当たり0.1%のダウンタイム）
- レイテンシー（日当たり0.1%までのレイテンシー）
- レスポンスのステータスコード率（日当たり99.9%の200ステータスコード
- スループット（日当たり0.1%のスループット低下）

<br>

### エラーバジェット

#### ・エラーバジェットとは

年月当たりで許容するエラーやダウンタイムの程度のこと．エラーやダウンタイムの発生によってビジネスに影響を与える可能性があったとしても，SLOの閾値を超えない限りはこれを許容し，技術を優先する．ビジネスより技術を優先する時に，素早く意思決定できる．