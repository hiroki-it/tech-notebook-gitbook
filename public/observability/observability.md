# 可観測性

## 01. 可観測性

### 可観測性とは

『収集されたデータから，システムのリアルタイムな状態を，どれだけ正確に推測できるか』を表す程度のこと．リアルタイムと結び付けて，『プロアクティブ』と表現される．

参考：

- https://ish-ar.io/observability/
- https://laredoute.io/blog/observability-at-la-redoute/

![observality_and_monitoring](https://raw.githubusercontent.com/hiroki-it/tech-notebook/master/images/observality_and_monitoring.png)

<br>

### テレメトリー

#### ・テレメトリーとは

可観測性を実現するために収集する必要のある３つのデータ要素（『メトリクス』『ログ』『分散トレース』）のこと．

参考：

- https://www.forbes.com/sites/andythurai/2021/02/02/aiops-vs-observability-vs-monitoringwhat-is-the-difference-are-you-using-the-right-one-for-your-enterprise/
- https://knowledge.sakura.ad.jp/26395/

| 種類         | 説明                                                         |
| ------------ | ------------------------------------------------------------ |
| メトリクス   | 一定期間に収集されたデータポイントの集計数値のこと．<br>参考：https://docs.aws.amazon.com/ja_jp/AmazonCloudWatch/latest/monitoring/cloudwatch_concepts.html#Metric |
| ログ         | 特定の時間に発生したイベントの記録のこと．                   |
| 分散トレース | マイクロサービスアーキテクチャにおいて，分散システムに渡った一連の処理を，イベントの因果関係の繋がりと見ることができる．この一連の処理で発生する連続的なデータのこと． |

#### ・テレメトリー搭載ツール

NewRelicやDatadogはテレメトリーの要素を全て持つ．また，AWSではCloudWatch（メトリクス＋ログ）とX-Ray（分散トレース）を両方利用すると，これらの要素を満たせたことになり，可観測性を実現できる．

<br>

## 02. 監視

### 監視とは

システムが正常に稼働することを継続的に見守り，障害の発生を未然に防ぐこと．未然と結び付けて『プロアクティブ』と表現される．

参考：https://en.wikipedia.org/wiki/Website_monitoring

<br>

### 監視の種類

監視は以下の種類に大別される．

#### ・外部監視

アプリケーション外部からの死活監視．アプリケーションにリクエストを送信し，レスポンスに関して，あらゆる情報を監視する．

#### ・内部監視

アプリケーション内部からの死活監視．アプリケーションのレスポンスからはわからないあらゆる情報を監視する．

#### ・合成監視

プログラムを使用して，実際のユーザを模したリクエストをアプリケーションに送信し，外部監視と内部監視を実行する．ユーザを模したリクエストを生成するという意味合いで，『合成』という．

<br>

### ４大シグナル

#### ・レイテンシー

参考：https://hiroki-it.github.io/tech-notebook-gitbook/public/infrastructure_network_internet.html

#### ・トラフィック

参考：https://hiroki-it.github.io/tech-notebook-gitbook/public/infrastructure_network_internet.html

#### ・エラー

| 種類         | 説明                                                         |
| ------------ | ------------------------------------------------------------ |
| 明示的エラー | 400/500系のレスポンス<                                       |
| 暗黙的エラー | SLOに満たない200/300系のレスポンス，API仕様に合っていないレスポンス |

#### ・サチュレーション

システム利用率（CPU利用率，メモリ理容室，ストレージ利用率，など）の飽和度のこと．例えば，以下の飽和度がある．60～70%で，警告ラインを設けておく必要がある．

<br>

## 03. 可観測性に基づく意思決定

### SLI：Service Level Indicator（サービスレベル指標）

#### ・SLIとは

サービスレベルの指標とするメトリクスのこと．

#### ・SLIの例

- サーバ稼働率
- データベース稼働率
- レイテンシー
- レスポンスタイム
- レスポンスのステータスコード率
- スループット

<br>

### SLO：Service Level Objective（サービスレベル目標）

#### ・SLOとは

SLIとして採用した指標の目標値のこと．99.9%の成功率を目標とすることが多い．

#### ・SLOの例

- サーバ稼働率（日当たり0.1%のダウンタイム）
- データベース稼働率（日当たり0.1%のダウンタイム）
- レイテンシー（日当たり0.1%までのレイテンシー）
- レスポンスのステータスコード率（日当たり99.9%の200ステータスコード
- スループット（日当たり0.1%のスループット低下）

<br>

### エラーバジェット

#### ・エラーバジェットとは

年月当たりで許容するエラーやダウンタイムの程度のこと．エラーやダウンタイムの発生によってビジネスに影響を与える可能性があったとしても，SLOの閾値を超えない限りはこれを許容し，技術を優先する．ビジネスより技術を優先する時に，素早く意思決定できる．