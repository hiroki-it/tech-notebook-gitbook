# 可観測性

## 01. 可観測性とは

<br>

### テレメトリー

#### ・テレメトリーとは

可観測性を実現するツールに求められる監視対象の要素（『メトリクス』『ログ』『分散トレース』）のこと．NewRelicやDatadogはこれらの要素を持つ．また，AWSではCloudWatch（メトリクス＋ログ）とX-Ray（分散トレース）を両方利用すると，これらの要素を満たせたことになり，可観測性を実現できる．

参考：

- https://www.forbes.com/sites/andythurai/2021/02/02/aiops-vs-observability-vs-monitoringwhat-is-the-difference-are-you-using-the-right-one-for-your-enterprise/
- https://knowledge.sakura.ad.jp/26395/

| テレメトリーコンポーネント | 説明                                                         | 補足 |
| -------------------------- | ------------------------------------------------------------ | ---- |
| メトリクス                 |                                                              |      |
| ログ                       |                                                              |      |
| 分散トレース               | マイクロサービスの各コンポーネントでイベントが発生した時，一連のイベントを因果関係として繋げたデータセットのこと． |      |

<br>

### 監視

#### ・監視とは

可観測性を実現するための手段のこと．

#### ・監視の種類

監視は以下の種類に大別される．

| 種類     | 説明                                                         |
| -------- | ------------------------------------------------------------ |
| 外部監視 | アプリケーション外部からの死活監視．アプリケーションにリクエストを送信し，レスポンスに関して，あらゆる情報を監視する． |
| 内部監視 | アプリケーション内部からの死活監視．アプリケーションのレスポンスからはわからないあらゆる情報を監視する． |
| 合成監視 | プログラムを使用して，実際のユーザを模したリクエストをアプリケーションに送信し，外部監視と内部監視を実行する．ユーザを模したリクエストを生成するという意味合いで，『合成』という． |

#### ・４大シグナル

| 種類             | 説明                                                         |
| ---------------- | ------------------------------------------------------------ |
| レイテンシー     | 以下のリンクを参考にせよ．<br>参考：https://hiroki-it.github.io/tech-notebook-gitbook/public/infrastructure_network_internet.html |
| トラフィック     | 以下のリンクを参考にせよ．<br>参考：https://hiroki-it.github.io/tech-notebook-gitbook/public/infrastructure_network_internet.html |
| エラー           | 以下の２種類に分類できる．<br>・明示的エラー：400/500系のレスポンス<br>・暗黙的エラー：SLOに満たない200/300系のレスポンス，API仕様に合っていないレスポンス |
| サチュレーション | システムの利用率の飽和度のこと．例えば，以下の飽和度がある．60～70%で，警告ラインを設けておく必要がある．<br>・CPU利用率<br>・メモリ利用率<br>・ストレージ利用率<br> |

<br>

## 02. 意思決定の基準となる指標

### SLI，SLO，エラーバジェット

| 項目                                                   | 説明                                                         |
| ------------------------------------------------------ | ------------------------------------------------------------ |
| SLI：<br>Service Level Indicator（サービスレベル指標） | サービスレベルの指標とするメトリクスのこと．<br>・サーバ稼働率<br>・データベース稼働率<br>・レイテンシー<br>・レスポンスタイム<br>・レスポンスのステータスコード率<br>・スループット<br>などが採用される． |
| SLO：<br>Service Level Objective（サービスレベル目標） | SLIとして採用した指標の目標値のこと．99.9%の成功率を目標とすることが多い．<br/>・サーバ稼働率（日当たり0.1%のダウンタイム）<br/>・データベース稼働率（日当たり0.1%のダウンタイム）<br/>・レイテンシー（日当たり0.1%までのレイテンシー）<br>・レスポンスのステータスコード率（日当たり99.9%の200ステータスコード<br>・スループット（日当たり0.1%のスループット低下）<br> |
| エラーバジェット                                       | SLOが未達の場合は，新規リリースよりもSLOの達成を優先する．   |

<br>