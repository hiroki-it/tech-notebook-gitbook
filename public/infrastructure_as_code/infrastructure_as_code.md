# Infrastructure as Code

## はじめに

本サイトにつきまして、以下をご認識のほど宜しくお願いいたします。

参考：https://hiroki-it.github.io/tech-notebook-gitbook/

<br>

## 01. 仮想サーバー(仮想マシン)のコード化

### 仮想サーバーの構成管理

#### ・コード化ツールの種類

| ツール名 | 対象のProvider |
| -------- | -------------- |
| Ansible  | 要勉強         |
| Puppet   | 要勉強         |
| Chef     | 要勉強         |

#### ・Ansible

Ansibleでは、ymlの文法を用いて関数処理を実行できる。

| ファイル名   | 役割                                   |
| ------------ | -------------------------------------- |
| playbook.yml | ソフトウェアのインストールタスクの手順 |
| inventory/*  | 反映先のサーバーの情報                   |
| group_vars/* | 複数のサーバーへの設定                   |
| host_vars/*  | 単一のサーバーへの設定                   |

<br>

## 02. コンテナのコード化

### コンテナの構成管理

#### ・コード化ツールの種類

| 名前              | 対象のProvider |
| ----------------- | -------------- |
| Dockerfile        | Docker         |
| Ansible Container | 要勉強         |

<br>


## 03. クラウドインフラストラクチャのコード化

### クラウドインフラストラクチャオーケストレーション

#### ・コード化ツールの種類

| 名前                   | 対象のプロバイダー |
| ---------------------- | ------------------ |
| Terraform              | いろいろ           |
| AWS CloudFormation     | AWS                |
| Azure Resource Manager | Azure              |

<br>

### メリット

#### ・変更をコードレビュー可能

画面上からインフラを変更する場合、画面共有しながら操作し、レビューと変更を同時に行うことになる。コード化により、レビューを事前に行ったうえで変更する、という手順を踏める。

#### ・ヒューマンエラーが減る

画面上からの変更であると、ヒューマンエラーが起こってしまう。コード化すれば、これが減る。

#### ・再利用や冗長化が簡単

複数のアプリケーションのために、同様の設定で同様のインフラを構築する場合や、1つのアプリケーションのために、インフラを冗長化する場合、いくつも手動で構築する必要があり、労力がかかる。コード化すれば、これが楽になる。

#### ・過去の変更が記録に残る

画面上からの変更であると、過去の変更履歴が残らない。ソースコードをバージョン管理すれば、Issueと紐付けて、履歴を残せる。

<br>

### デメリット

#### ・運用のスピードが落ちる

運用時に、画面上からの操作であればすぐに終わる変更であるのにもかかわらず、コード化により、変更までに時間がかかる。そのため例えばAWSとすると、運用時に変更する頻度が多いインフラ（例：API Gateway（VPCリンクを含む）、IAMユーザ（紐付けるロールやポリシーを含む））はコード化せず、あえて画面上から構築する。

#### ・プロバイダーの機能追加に追従しにくい

プロバイダーは日々機能を追加している。画面上からの操作であればすぐにこの機能を支えるが、コード化により、ツールのバージョンをアップグレードしなければ、この機能を使えない。運用時に便利な機能をすぐに使えないため、インフラを改善できないことに繋がる。また、エンジニアの『新機能を使ってみたい欲』が行き場を失う。

#### ・リリースの心理的ハードルが高い

画面上から変更すれば、インフラ変更のリリース中に予期せぬエラーが起こることはまずない。しかし、コード化ツールでは、変更のリリース中に予期せぬエラーが起こる可能性は決して低くないため、リリースの心理的ハードルが高くなる。
